var ek=Object.defineProperty;var ik=(n,t,e)=>t in n?ek(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var gr=(n,t,e)=>ik(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var ul,Et,ew,xr,Lm,iw,Mu,sw,C_,Du,Lu,nw,Fa={},rw=[],sk=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,gc=Array.isArray;function fn(n,t){for(var e in t)n[e]=t[e];return n}function A_(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function yt(n,t,e){var i,s,r,o={};for(r in t)r=="key"?i=t[r]:r=="ref"?s=t[r]:o[r]=t[r];if(arguments.length>2&&(o.children=arguments.length>3?ul.call(arguments,2):e),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return Ea(n,o,i,s,null)}function Ea(n,t,e,i,s){var r={type:n,props:t,key:e,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++ew,__i:-1,__u:0};return s==null&&Et.vnode!=null&&Et.vnode(r),r}function ow(){return{current:null}}function qe(n){return n.children}function Cs(n,t){this.props=n,this.context=t}function Co(n,t){if(t==null)return n.__?Co(n.__,n.__i+1):null;for(var e;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null)return e.__e;return typeof n.type=="function"?Co(n):null}function aw(n){var t,e;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,t=0;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null){n.__e=n.__c.base=e.__e;break}return aw(n)}}function Fu(n){(!n.__d&&(n.__d=!0)&&xr.push(n)&&!Mh.__r++||Lm!==Et.debounceRendering)&&((Lm=Et.debounceRendering)||iw)(Mh)}function Mh(){var n,t,e,i,s,r,o,l;for(xr.sort(Mu);n=xr.shift();)n.__d&&(t=xr.length,i=void 0,r=(s=(e=n).__v).__e,o=[],l=[],e.__P&&((i=fn({},s)).__v=s.__v+1,Et.vnode&&Et.vnode(i),S_(e.__P,i,s,e.__n,e.__P.namespaceURI,32&s.__u?[r]:null,o,r??Co(s),!!(32&s.__u),l),i.__v=s.__v,i.__.__k[i.__i]=i,cw(o,i,l),i.__e!=r&&aw(i)),xr.length>t&&xr.sort(Mu));Mh.__r=0}function lw(n,t,e,i,s,r,o,l,c,d,_){var f,g,m,x,C,T,A=i&&i.__k||rw,S=t.length;for(c=nk(e,t,A,c,S),f=0;f<S;f++)(m=e.__k[f])!=null&&(g=m.__i===-1?Fa:A[m.__i]||Fa,m.__i=f,T=S_(n,m,g,s,r,o,l,c,d,_),x=m.__e,m.ref&&g.ref!=m.ref&&(g.ref&&T_(g.ref,null,m),_.push(m.ref,m.__c||x,m)),C==null&&x!=null&&(C=x),4&m.__u||g.__k===m.__k?c=hw(m,c,n):typeof m.type=="function"&&T!==void 0?c=T:x&&(c=x.nextSibling),m.__u&=-7);return e.__e=C,c}function nk(n,t,e,i,s){var r,o,l,c,d,_=e.length,f=_,g=0;for(n.__k=new Array(s),r=0;r<s;r++)(o=t[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(c=r+g,(o=n.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Ea(null,o,null,null,null):gc(o)?Ea(qe,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Ea(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,l=null,(d=o.__i=rk(o,e,c,f))!==-1&&(f--,(l=e[d])&&(l.__u|=2)),l==null||l.__v===null?(d==-1&&g--,typeof o.type!="function"&&(o.__u|=4)):d!=c&&(d==c-1?g--:d==c+1?g++:(d>c?g--:g++,o.__u|=4))):n.__k[r]=null;if(f)for(r=0;r<_;r++)(l=e[r])!=null&&!(2&l.__u)&&(l.__e==i&&(i=Co(l)),dw(l,l));return i}function hw(n,t,e){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,t=hw(i[s],t,e));return t}n.__e!=t&&(t&&n.type&&!e.contains(t)&&(t=Co(n)),e.insertBefore(n.__e,t||null),t=n.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function vn(n,t){return t=t||[],n==null||typeof n=="boolean"||(gc(n)?n.some(function(e){vn(e,t)}):t.push(n)),t}function rk(n,t,e,i){var s,r,o=n.key,l=n.type,c=t[e];if(c===null||c&&o==c.key&&l===c.type&&!(2&c.__u))return e;if(i>(c!=null&&!(2&c.__u)?1:0))for(s=e-1,r=e+1;s>=0||r<t.length;){if(s>=0){if((c=t[s])&&!(2&c.__u)&&o==c.key&&l===c.type)return s;s--}if(r<t.length){if((c=t[r])&&!(2&c.__u)&&o==c.key&&l===c.type)return r;r++}}return-1}function Fm(n,t,e){t[0]=="-"?n.setProperty(t,e??""):n[t]=e==null?"":typeof e!="number"||sk.test(t)?e:e+"px"}function gh(n,t,e,i,s){var r;t:if(t=="style")if(typeof e=="string")n.style.cssText=e;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(t in i)e&&t in e||Fm(n.style,t,"");if(e)for(t in e)i&&e[t]===i[t]||Fm(n.style,t,e[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(sw,"$1")),t=t.toLowerCase()in n||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),n.l||(n.l={}),n.l[t+r]=e,e?i?e.u=i.u:(e.u=C_,n.addEventListener(t,r?Lu:Du,r)):n.removeEventListener(t,r?Lu:Du,r);else{if(s=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in n)try{n[t]=e??"";break t}catch{}typeof e=="function"||(e==null||e===!1&&t[4]!="-"?n.removeAttribute(t):n.setAttribute(t,t=="popover"&&e==1?"":e))}}function Bm(n){return function(t){if(this.l){var e=this.l[t.type+n];if(t.t==null)t.t=C_++;else if(t.t<e.u)return;return e(Et.event?Et.event(t):t)}}}function S_(n,t,e,i,s,r,o,l,c,d){var _,f,g,m,x,C,T,A,S,E,M,O,N,F,K,nt,pt,ht=t.type;if(t.constructor!==void 0)return null;128&e.__u&&(c=!!(32&e.__u),r=[l=t.__e=e.__e]),(_=Et.__b)&&_(t);t:if(typeof ht=="function")try{if(A=t.props,S="prototype"in ht&&ht.prototype.render,E=(_=ht.contextType)&&i[_.__c],M=_?E?E.props.value:_.__:i,e.__c?T=(f=t.__c=e.__c).__=f.__E:(S?t.__c=f=new ht(A,M):(t.__c=f=new Cs(A,M),f.constructor=ht,f.render=ak),E&&E.sub(f),f.props=A,f.state||(f.state={}),f.context=M,f.__n=i,g=f.__d=!0,f.__h=[],f._sb=[]),S&&f.__s==null&&(f.__s=f.state),S&&ht.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=fn({},f.__s)),fn(f.__s,ht.getDerivedStateFromProps(A,f.__s))),m=f.props,x=f.state,f.__v=t,g)S&&ht.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),S&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(S&&ht.getDerivedStateFromProps==null&&A!==m&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(A,M),!f.__e&&(f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(A,f.__s,M)===!1||t.__v==e.__v)){for(t.__v!=e.__v&&(f.props=A,f.state=f.__s,f.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.some(function(ct){ct&&(ct.__=t)}),O=0;O<f._sb.length;O++)f.__h.push(f._sb[O]);f._sb=[],f.__h.length&&o.push(f);break t}f.componentWillUpdate!=null&&f.componentWillUpdate(A,f.__s,M),S&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(m,x,C)})}if(f.context=M,f.props=A,f.__P=n,f.__e=!1,N=Et.__r,F=0,S){for(f.state=f.__s,f.__d=!1,N&&N(t),_=f.render(f.props,f.state,f.context),K=0;K<f._sb.length;K++)f.__h.push(f._sb[K]);f._sb=[]}else do f.__d=!1,N&&N(t),_=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++F<25);f.state=f.__s,f.getChildContext!=null&&(i=fn(fn({},i),f.getChildContext())),S&&!g&&f.getSnapshotBeforeUpdate!=null&&(C=f.getSnapshotBeforeUpdate(m,x)),l=lw(n,gc(nt=_!=null&&_.type===qe&&_.key==null?_.props.children:_)?nt:[nt],t,e,i,s,r,o,l,c,d),f.base=t.__e,t.__u&=-161,f.__h.length&&o.push(f),T&&(f.__E=f.__=null)}catch(ct){if(t.__v=null,c||r!=null)if(ct.then){for(t.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;r[r.indexOf(l)]=null,t.__e=l}else for(pt=r.length;pt--;)A_(r[pt]);else t.__e=e.__e,t.__k=e.__k;Et.__e(ct,t,e)}else r==null&&t.__v==e.__v?(t.__k=e.__k,t.__e=e.__e):l=t.__e=ok(e.__e,t,e,i,s,r,o,c,d);return(_=Et.diffed)&&_(t),128&t.__u?void 0:l}function cw(n,t,e){for(var i=0;i<e.length;i++)T_(e[i],e[++i],e[++i]);Et.__c&&Et.__c(t,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(r){r.call(s)})}catch(r){Et.__e(r,s.__v)}})}function ok(n,t,e,i,s,r,o,l,c){var d,_,f,g,m,x,C,T=e.props,A=t.props,S=t.type;if(S=="svg"?s="http://www.w3.org/2000/svg":S=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((m=r[d])&&"setAttribute"in m==!!S&&(S?m.localName==S:m.nodeType==3)){n=m,r[d]=null;break}}if(n==null){if(S==null)return document.createTextNode(A);n=document.createElementNS(s,S,A.is&&A),l&&(Et.__m&&Et.__m(t,r),l=!1),r=null}if(S===null)T===A||l&&n.data===A||(n.data=A);else{if(r=r&&ul.call(n.childNodes),T=e.props||Fa,!l&&r!=null)for(T={},d=0;d<n.attributes.length;d++)T[(m=n.attributes[d]).name]=m.value;for(d in T)if(m=T[d],d!="children"){if(d=="dangerouslySetInnerHTML")f=m;else if(!(d in A)){if(d=="value"&&"defaultValue"in A||d=="checked"&&"defaultChecked"in A)continue;gh(n,d,null,m,s)}}for(d in A)m=A[d],d=="children"?g=m:d=="dangerouslySetInnerHTML"?_=m:d=="value"?x=m:d=="checked"?C=m:l&&typeof m!="function"||T[d]===m||gh(n,d,m,T[d],s);if(_)l||f&&(_.__html===f.__html||_.__html===n.innerHTML)||(n.innerHTML=_.__html),t.__k=[];else if(f&&(n.innerHTML=""),lw(n,gc(g)?g:[g],t,e,i,S=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:e.__k&&Co(e,0),l,c),r!=null)for(d=r.length;d--;)A_(r[d]);l||(d="value",S=="progress"&&x==null?n.removeAttribute("value"):x!==void 0&&(x!==n[d]||S=="progress"&&!x||S=="option"&&x!==T[d])&&gh(n,d,x,T[d],s),d="checked",C!==void 0&&C!==n[d]&&gh(n,d,C,T[d],s))}return n}function T_(n,t,e){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&t==null||(n.__u=n(t))}else n.current=t}catch(s){Et.__e(s,e)}}function dw(n,t,e){var i,s;if(Et.unmount&&Et.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||T_(i,null,t)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){Et.__e(r,t)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&dw(i[s],t,e||typeof n.type!="function");e||A_(n.__e),n.__c=n.__=n.__e=void 0}function ak(n,t,e){return this.constructor(n,e)}function Ao(n,t,e){var i,s,r,o;t==document&&(t=document.documentElement),Et.__&&Et.__(n,t),s=(i=typeof e=="function")?null:e&&e.__k||t.__k,r=[],o=[],S_(t,n=(!i&&e||t).__k=yt(qe,null,[n]),s||Fa,Fa,t.namespaceURI,!i&&e?[e]:s?null:t.firstChild?ul.call(t.childNodes):null,r,!i&&e?e:s?s.__e:t.firstChild,i,o),cw(r,n,o)}function uw(n,t){Ao(n,t,uw)}function lk(n,t,e){var i,s,r,o,l=fn({},n.props);for(r in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),t)r=="key"?i=t[r]:r=="ref"?s=t[r]:l[r]=t[r]===void 0&&o!==void 0?o[r]:t[r];return arguments.length>2&&(l.children=arguments.length>3?ul.call(arguments,2):e),Ea(n.type,l,i||n.key,s||n.ref,null)}function _l(n,t){var e={__c:t="__cC"+nw++,__:n,Consumer:function(i,s){return i.children(s)},Provider:function(i){var s,r;return this.getChildContext||(s=new Set,(r={})[t]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.forEach(function(l){l.__e=!0,Fu(l)})},this.sub=function(o){s.add(o);var l=o.componentWillUnmount;o.componentWillUnmount=function(){s&&s.delete(o),l&&l.call(o)}}),i.children}};return e.Provider.__=e.Consumer.contextType=e}ul=rw.slice,Et={__e:function(n,t,e,i){for(var s,r,o;t=t.__;)if((s=t.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),o=s.__d),o)return s.__E=s}catch(l){n=l}throw n}},ew=0,Cs.prototype.setState=function(n,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=fn({},this.state),typeof n=="function"&&(n=n(fn({},e),this.props)),n&&fn(e,n),n!=null&&this.__v&&(t&&this._sb.push(t),Fu(this))},Cs.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Fu(this))},Cs.prototype.render=qe,xr=[],iw=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Mu=function(n,t){return n.__v.__b-t.__v.__b},Mh.__r=0,sw=/(PointerCapture)$|Capture$/i,C_=0,Du=Bm(!1),Lu=Bm(!0),nw=0;var hk=/["&<]/;function _w(n){if(n.length===0||hk.test(n)===!1)return n;for(var t=0,e=0,i="",s="";e<n.length;e++){switch(n.charCodeAt(e)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;default:continue}e!==t&&(i+=n.slice(t,e)),i+=s,t=e+1}return e!==t&&(i+=n.slice(t,e)),i}var ck=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,dk=0,uk=Array.isArray;function fi(n,t,e,i,s,r){t||(t={});var o,l,c=t;"ref"in t&&(o=t.ref,delete t.ref);var d={type:n,props:c,key:e,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--dk,__i:-1,__u:0,__source:s,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(l in o)c[l]===void 0&&(c[l]=o[l]);return Et.vnode&&Et.vnode(d),d}function _k(n){var t=fi(qe,{tpl:n,exprs:[].slice.call(arguments,1)});return t.key=t.__v,t}var Om={},fk=/[A-Z]/g;function pk(n,t){if(Et.attr){var e=Et.attr(n,t);if(typeof e=="string")return e}if(n==="ref"||n==="key")return"";if(n==="style"&&typeof t=="object"){var i="";for(var s in t){var r=t[s];if(r!=null&&r!==""){var o=s[0]=="-"?s:Om[s]||(Om[s]=s.replace(fk,"-$&").toLowerCase()),l=";";typeof r!="number"||o.startsWith("--")||ck.test(o)||(l="px;"),i=i+o+":"+r+l}}return n+'="'+i+'"'}return t==null||t===!1||typeof t=="function"||typeof t=="object"?"":t===!0?n:n+'="'+_w(t)+'"'}function fw(n){if(n==null||typeof n=="boolean"||typeof n=="function")return null;if(typeof n=="object"){if(n.constructor===void 0)return n;if(uk(n)){for(var t=0;t<n.length;t++)n[t]=fw(n[t]);return n}}return _w(""+n)}const gk=Object.freeze(Object.defineProperty({__proto__:null,Fragment:qe,jsx:fi,jsxAttr:pk,jsxDEV:fi,jsxEscape:fw,jsxTemplate:_k,jsxs:fi},Symbol.toStringTag,{value:"Module"}));/*!
 * excalibur - 0.30.3 - 2025-1-1
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2025 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var mk={851:(n,t,e)=>{e.d(t,{A:()=>c});var i=e(1),s=e.n(i),r=e(935),o=e.n(r),l=o()(s());l.push([n.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition:
    background 250ms ease-in-out,
    transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Director/Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition:\r
    background 250ms ease-in-out,\r
    transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const c=l},296:(n,t,e)=>{e.d(t,{A:()=>c});var i=e(1),s=e.n(i),r=e(935),o=e.n(r),l=o()(s());l.push([n.id,`#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;

  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}

.ex-toast-message button {
  align-self: flex-start;
}
`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB",sourcesContent:[`#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}\r
`],sourceRoot:""}]);const c=l},935:n=>{n.exports=function(t){var e=[];return e.toString=function(){return this.map(function(s){var r="",o=typeof s[5]<"u";return s[4]&&(r+="@supports (".concat(s[4],") {")),s[2]&&(r+="@media ".concat(s[2]," {")),o&&(r+="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {")),r+=t(s),o&&(r+="}"),s[2]&&(r+="}"),s[4]&&(r+="}"),r}).join("")},e.i=function(s,r,o,l,c){typeof s=="string"&&(s=[[null,s,void 0]]);var d={};if(o)for(var _=0;_<this.length;_++){var f=this[_][0];f!=null&&(d[f]=!0)}for(var g=0;g<s.length;g++){var m=[].concat(s[g]);o&&d[m[0]]||(typeof c<"u"&&(typeof m[5]>"u"||(m[1]="@layer".concat(m[5].length>0?" ".concat(m[5]):""," {").concat(m[1],"}")),m[5]=c),r&&(m[2]&&(m[1]="@media ".concat(m[2]," {").concat(m[1],"}")),m[2]=r),l&&(m[4]?(m[1]="@supports (".concat(m[4],") {").concat(m[1],"}"),m[4]=l):m[4]="".concat(l)),e.push(m))}},e}},1:n=>{n.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if(typeof btoa=="function"){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),o="/*# ".concat(r," */");return[e].concat([o]).join(`
`)}return[e].join(`
`)}}},Um={};function Xe(n){var t=Um[n];if(t!==void 0)return t.exports;var e=Um[n]={id:n,exports:{}};return mk[n](e,e.exports,Xe),e.exports}Xe.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return Xe.d(t,{a:t}),t};Xe.d=(n,t)=>{for(var e in t)Xe.o(t,e)&&!Xe.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};Xe.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);Xe.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var w={};Xe.d(w,{eKr:()=>rf,yVm:()=>Cl,a7j:()=>Uw,U_w:()=>Ef,JF2:()=>nf,htg:()=>fo,HXL:()=>bf,mcg:()=>Q_,Agj:()=>mi,J3_:()=>EI,Wgv:()=>of,u6S:()=>iI,x7M:()=>Fe,X55:()=>vs,m3M:()=>Ba,aE5:()=>Kk,YJU:()=>gs,eZi:()=>Zu,GNv:()=>za,Y56:()=>Ku,_0v:()=>Vh,vhs:()=>Oh,vrQ:()=>yl,Z8b:()=>o0,Yfw:()=>Gt,IcQ:()=>at,kgJ:()=>t_,GTT:()=>H0,ypY:()=>ja,i7d:()=>y0,fQ3:()=>II,HlI:()=>Rw,jlt:()=>yc,VQc:()=>ii,zD7:()=>Sf,AUF:()=>Ns,JoF:()=>nr,MlA:()=>Be,PZh:()=>wr,qA:()=>Ua,CrD:()=>Tn,dQK:()=>Ws,D3r:()=>Ss,Qpo:()=>$h,D9n:()=>Gh,b6v:()=>Oa,mvh:()=>Tc,Bpo:()=>ft,Q1f:()=>$,IKv:()=>U0,fcV:()=>Tr,Glf:()=>O0,uAl:()=>hs,ElT:()=>Ve,Z8r:()=>R_,QSL:()=>k0,sPV:()=>Nh,nAn:()=>En,zCU:()=>Wh,QrV:()=>Ke,fF9:()=>cR,Jqv:()=>u0,d_u:()=>d0,xI8:()=>K_,yar:()=>je,SP7:()=>z0,oRy:()=>Ac,f5X:()=>vf,V1c:()=>M_,Mlx:()=>W0,ZiM:()=>e_,ZCo:()=>Ha,J5p:()=>N0,mL_:()=>Si,Guw:()=>l0,N5j:()=>Bw,pgY:()=>h0,OP3:()=>zh,rl5:()=>q0,eod:()=>zI,q5Z:()=>$e,YUC:()=>cf,saR:()=>qh,hvr:()=>i_,Qol:()=>r0,Wf4:()=>n0,JCs:()=>ee,gJV:()=>Oi,fWD:()=>w0,Va_:()=>Yn,N$8:()=>Ai,_jQ:()=>HI,rxj:()=>ef,rhv:()=>tf,wCu:()=>oi,HAp:()=>oI,Zy1:()=>A0,bkB:()=>de,wfL:()=>Hh,sVA:()=>k_,$Gs:()=>lf,CJ0:()=>jh,NWh:()=>xn,tWi:()=>sf,xAj:()=>J_,zWh:()=>a0,i_4:()=>hR,iIx:()=>Ye,Hxo:()=>c0,c9e:()=>Vu,KQV:()=>Ir,weH:()=>Qt,jXp:()=>aR,zzY:()=>Uh,yRQ:()=>Fh,MtE:()=>G0,rPj:()=>Va,KLc:()=>Yi,Fir:()=>Bt,V5f:()=>O_,Xj7:()=>U_,Wud:()=>Ph,FVg:()=>X_,g5Y:()=>V_,YQB:()=>j_,KPb:()=>q_,nHK:()=>Pc,Jrb:()=>Z0,TX_:()=>rR,Olt:()=>K0,r3n:()=>Eo,Fvk:()=>$I,gpR:()=>Xh,vYh:()=>Ce,hnk:()=>Ae,D2R:()=>So,n1o:()=>mf,h9O:()=>I0,X5j:()=>Bs,p3P:()=>wf,RLG:()=>Y_,fBU:()=>uf,Adb:()=>Oe,bEs:()=>Hs,wCy:()=>qt,CbD:()=>le,x_C:()=>jo,pGf:()=>Af,ibQ:()=>M0,shR:()=>$a,Yjk:()=>yf,_u1:()=>jI,OBI:()=>Y0,klh:()=>ba,s3S:()=>L0,D$R:()=>qa,xth:()=>wc,JU7:()=>WI,h9x:()=>b0,N1A:()=>Pf,e_k:()=>Pe,aHM:()=>Dr,tlv:()=>gI,Vi9:()=>v0,ieR:()=>m0,$bb:()=>Ue,VyI:()=>lt,imn:()=>Pw,uqu:()=>Di,QnL:()=>Bu,vnc:()=>hf,wk_:()=>Xu,GH0:()=>Zt,_1r:()=>Sc,l0X:()=>ju,bT:()=>jw,HHX:()=>qu,jtW:()=>Vw,tjk:()=>$n,rWe:()=>vr,j9l:()=>Lw,l0$:()=>If,sGJ:()=>cn,NVp:()=>_f,cPK:()=>pi,XoL:()=>Cf,RmF:()=>gi,DXI:()=>Cc,tCD:()=>qI,J3D:()=>xc,vCJ:()=>NI,e6k:()=>Iw,f9l:()=>ks,v9m:()=>Ic,yRJ:()=>R0,EU6:()=>Ju,m3O:()=>ln,Ryz:()=>Qn,OxP:()=>ya,LEs:()=>kc,Ec:()=>kr,Pi5:()=>Ec,gmH:()=>hn,tS:()=>kf,XxX:()=>Qe,bCz:()=>vc,nYS:()=>Mr,yiT:()=>N_,NHl:()=>$o,mO8:()=>$_,PXI:()=>B_,bn5:()=>H_,Ywr:()=>sr,cMd:()=>Rr,Bs6:()=>W_,G0k:()=>Go,pyn:()=>G_,QeM:()=>F_,aPX:()=>FI,ITP:()=>z_,BY0:()=>ir,MFw:()=>wl,sBn:()=>ml,S3L:()=>ao,XKQ:()=>Na,ESI:()=>S0,uxz:()=>x0,o8N:()=>zo,u_r:()=>No,RlV:()=>yr,gVA:()=>Yu,M_G:()=>xl,BpG:()=>af,GRB:()=>nI,kM6:()=>zw,dO8:()=>Hw,jgM:()=>Wu,FWq:()=>pl,s3j:()=>Sk,hlw:()=>Qw,L0q:()=>Yw,B7e:()=>Zw,PGN:()=>Xw,H_X:()=>ye,S_d:()=>s0,_Tq:()=>i0,U7E:()=>t0,IOH:()=>Jw,Z58:()=>Vi,yh2:()=>BI,ff$:()=>Nu,cWi:()=>vw,NBt:()=>pf,oNz:()=>uI,QlU:()=>B0,Xey:()=>Vn,jft:()=>pR,_r8:()=>Le,bTC:()=>Ow,Mtr:()=>Ei,ypk:()=>si,mnM:()=>Kt,q7S:()=>dR,bAZ:()=>Wa,ABN:()=>Fw,VK6:()=>pI,Hj2:()=>xf,Df8:()=>Qu,oOx:()=>To,kxk:()=>As,DT1:()=>mc,FLG:()=>Cr,qN_:()=>Tf,Z37:()=>bc,FtL:()=>g0,Z6X:()=>Q0,iQT:()=>Qi,ziO:()=>E0,OEF:()=>Xs,uuE:()=>Ui,tiv:()=>Ga,T$Y:()=>$0,EYj:()=>vl,nOB:()=>Bh,Tap:()=>we,FAs:()=>p0,B_P:()=>f0,aA5:()=>kI,J3s:()=>Rf,Y0Q:()=>gl,M4G:()=>Sr,l$l:()=>j0,dLy:()=>Sn,WZP:()=>J,eB6:()=>Rc,nFK:()=>$u,l9z:()=>C0,YOF:()=>RI,yhB:()=>He,J0N:()=>I_,Miz:()=>I,Bj4:()=>Uu,Rcs:()=>qs,vJ4:()=>In,TqC:()=>df,nM0:()=>Z_,X1u:()=>Ar,SpZ:()=>Dw,DX8:()=>po,Yx$:()=>F0,HK4:()=>P0,yt5:()=>gw,vAR:()=>GI,SE$:()=>wn,qE8:()=>Ut,Pz7:()=>J0,sX_:()=>Pr,JuI:()=>vk,pxT:()=>bn,Nl$:()=>L_,zDr:()=>eR,OwT:()=>YI,P$G:()=>tR,mHV:()=>KI,kEA:()=>iR,Fx_:()=>nR,WFC:()=>sR,vKu:()=>XI,aDq:()=>VI,jIg:()=>JI,UH3:()=>QI,AJO:()=>ZI,U4:()=>Nw,xAc:()=>Gw,_3Y:()=>TI,K6X:()=>sI,C1Y:()=>kw,Aw1:()=>Gu,tm8:()=>$w,LBV:()=>qw,A8$:()=>rI,F5e:()=>SI,ran:()=>AI,c8L:()=>e0,o6M:()=>Kw,hsx:()=>Ls,l9E:()=>_0,aSf:()=>T0,CcK:()=>Ww,nU8:()=>ff,td6:()=>bl,Zex:()=>tx,bkJ:()=>Jt,mXP:()=>_R,vt$:()=>Wo,hCA:()=>Ps,pjR:()=>Mt,U43:()=>Fs,pSZ:()=>bk,y17:()=>xk,Ew7:()=>Vs,hG1:()=>CI,jVr:()=>uR,_SZ:()=>ne,xWn:()=>mw,ehJ:()=>wk,t6s:()=>D,Eyn:()=>E_});var E_={};Xe.r(E_);Xe.d(E_,{getAttributeComponentSize:()=>Tw,getAttributePointerType:()=>Ew,getGLTypeFromSource:()=>Sw,getGlTypeSizeBytes:()=>Ou,getMaxShaderComplexity:()=>D_,isAttributeInSource:()=>Aw});var P_={};Xe.r(P_);Xe.d(P_,{circle:()=>eI,line:()=>zu,point:()=>Jk,roundRect:()=>Hu,vector:()=>tI});var k_={};Xe.r(k_);Xe.d(k_,{ActionCompleteEvent:()=>rf,ActionStartEvent:()=>nf,ActivateEvent:()=>Q_,AddEvent:()=>of,CollisionEndEvent:()=>Ua,CollisionPostSolveEvent:()=>$h,CollisionPreSolveEvent:()=>Gh,CollisionStartEvent:()=>Oa,ContactEndEvent:()=>Nh,ContactStartEvent:()=>Wh,DeactivateEvent:()=>K_,EnterTriggerEvent:()=>ef,EnterViewPortEvent:()=>tf,EventTypes:()=>Hh,ExitTriggerEvent:()=>sf,ExitViewPortEvent:()=>J_,GameEvent:()=>Bt,GameStartEvent:()=>O_,GameStopEvent:()=>U_,GamepadAxisEvent:()=>X_,GamepadButtonEvent:()=>V_,GamepadConnectEvent:()=>j_,GamepadDisconnectEvent:()=>q_,HiddenEvent:()=>Y_,InitializeEvent:()=>jo,KillEvent:()=>wc,PostCollisionEvent:()=>Mr,PostDebugDrawEvent:()=>N_,PostDrawEvent:()=>$o,PostFrameEvent:()=>$_,PostKillEvent:()=>B_,PostTransformDrawEvent:()=>H_,PostUpdateEvent:()=>sr,PreCollisionEvent:()=>Rr,PreDebugDrawEvent:()=>W_,PreDrawEvent:()=>Go,PreFrameEvent:()=>G_,PreKillEvent:()=>F_,PreTransformDrawEvent:()=>z_,PreUpdateEvent:()=>ir,RemoveEvent:()=>af,VisibleEvent:()=>Z_});var I_={};Xe.r(I_);Xe.d(I_,{ConsoleAppender:()=>R_,DrawUtil:()=>P_,EasingFunctions:()=>ee,LogLevel:()=>Ue,Logger:()=>lt,Observable:()=>pi,ScreenAppender:()=>vw,addItemToArray:()=>yk,contains:()=>ww,delay:()=>Dh,fail:()=>xw,getPosition:()=>xa,isObject:()=>Eh,mergeDeep:()=>Lh,omit:()=>bw,removeItemFromArray:()=>Ho});function pw(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setInterval(n,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((i,s)=>{t.call(this,e,i,s)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1),typeof window<"u"&&!window.requestIdleCallback&&(window.requestIdleCallback=window.requestIdleCallback||function(n){const t=Date.now();return setTimeout(function(){n({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(n){clearTimeout(n)})}class Ye{static useCanvasGraphicsContext(){Ye.enable("use-canvas-context")}static useLegacyImageRenderer(){Ye.enable("use-legacy-image-renderer")}static freeze(){Ye._FROZEN=!0}static _reset(){Ye._FROZEN=!1,Ye._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");Ye._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");Ye._FLAGS[t]=!1}static isEnabled(t){return!!Ye._FLAGS[t]}static show(){return Object.keys(Ye._FLAGS)}}Ye._FROZEN=!1;Ye._FLAGS={};function Pr(n,t){return{type:n,value:t}}class Yi{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class de{constructor(){this._paused=!1,this._empty=!0,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0,this._empty=!0}on(t,e){var i;return this._empty=!1,this._listeners[t]=(i=this._listeners[t])!==null&&i!==void 0?i:[],this._listeners[t].push(e),{close:()=>this.off(t,e)}}once(t,e){var i;return this._empty=!1,this._listenersOnce[t]=(i=this._listenersOnce[t])!==null&&i!==void 0?i:[],this._listenersOnce[t].push(e),{close:()=>this.off(t,e)}}off(t,e){var i,s;if(e){const r=(i=this._listeners[t])===null||i===void 0?void 0:i.filter(l=>l!==e);this._listeners[t]=r;const o=(s=this._listenersOnce[t])===null||s===void 0?void 0:s.filter(l=>l!==e);this._listenersOnce[t]=o}else delete this._listeners[t]}emit(t,e){if(this._empty||this._paused)return;const i=this._listeners[t];if(i)for(let r=0;r<i.length;r++)i[r](e);const s=this._listenersOnce[t];if(this._listenersOnce[t]=[],s)for(let r=0;r<s.length;r++)s[r](e);for(let r=0;r<this._pipes.length;r++)this._pipes[r].emit(t,e)}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._empty=!1,this._pipes.push(t),{close:()=>{const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}}}unpipe(t){const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var kr;(function(n){n.Canvas="Canvas",n.Document="Document"})(kr||(kr={}));var ye;(function(n){n.ShortestPath="shortest-path",n.LongestPath="longest-path",n.Clockwise="clockwise",n.CounterClockwise="counter-clockwise"})(ye||(ye={}));const gu=4294967295;class zo{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let e=1;e<this._n;e++){const i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((i&4294901760)>>>16)<<16)+this._f*(i&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[e&1]&gu;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[e&1]&gu;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&gu,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const r=t.slice(0);for(;s<e;){const o=this.integer(0,r.length-1);i[s++]=r[o],r.splice(o,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i;for(let s=0;s<e.length-2;s++){const r=this.integer(s,e.length-1);i=e[s],e[s]=e[r],e[r]=i}return e}range(t,e,i){const s=new Array(t);for(let r=0;r<t;r++)s[r]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const He=Math.PI*2;function vk(n){return n>=0?n-Math.floor(n):n-Math.ceil(n)}function ne(n){return n===0?0:n<0?-1:1}function Ut(n,t,e){return Math.min(Math.max(t,n),e)}function gw(n,t,e){return Math.abs(n-t)<e}function wn(n){let t=n;if(n>=He)for(;t>=He;)t-=He;if(n<0)for(;t<0;)t+=He;return t}function mw(n){return 180/Math.PI*n}function wk(n){return n/180*Math.PI}const xk=(n,t)=>Array.from(new Array(t-n+1),(e,i)=>i+n);function Fs(n,t,e=new zo){return e?e.floating(n,t):n+Math.random()*(t-n)}function bk(n,t,e=new zo){return e?e.integer(n,t):Math.round(Fs(n,t))}class I{static get Zero(){return new I(0,0)}static get One(){return new I(1,1)}static get Half(){return new I(.5,.5)}static get Up(){return new I(0,-1)}static get Down(){return new I(0,1)}static get Left(){return new I(-1,0)}static get Right(){return new I(1,0)}static fromAngle(t){return new I(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new I(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new I(Math.max(t.x,e.x),Math.max(t.y,e.y))}constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=I.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}squareDistance(t){t||(t=I.Zero);const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}clampMagnitude(t){const e=this.magnitude,i=Ut(e,0,t);return this.magnitude=i,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}get magnitude(){return this.distance()}set magnitude(t){this.normalize().scale(t,this)}normalize(){const t=this.distance();return t===0?I.Zero:new I(this.x/t,this.y/t)}average(t){return this.add(t).scale(.5)}scale(t,e){const i=e||new I(0,0);return t instanceof I?(i.x=this.x*t.x,i.y=this.y*t.y):(i.x=this.x*t,i.y=this.y*t),i}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new I(this.x+t.x,this.y+t.y)}sub(t,e){const i=e||new I(0,0),s=this.x-t.x,r=this.y-t.y;return i.x=s,i.y=r,i}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof I)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new I(t*this.y,-t*this.x)}static cross(t,e){return new I(-t*e.y,t*e.x)}perpendicular(){return new I(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return wn(Math.atan2(this.y,this.x))}angleBetween(t,e){const i=this.toAngle(),s=wn(t);let r=0,o=0;switch(s>i?r=s-i:r=(He-i+s)%He,o=(r-He)%He,e){case ye.ShortestPath:return Math.abs(r)<Math.abs(o)?r:o;case ye.LongestPath:return Math.abs(r)>Math.abs(o)?r:o;case ye.Clockwise:return r;case ye.CounterClockwise:return o}}rotate(t,e,i){const s=i||new I(0,0);e||(e=new I(0,0));const r=Math.sin(t),o=Math.cos(t),l=o*(this.x-e.x)-r*(this.y-e.y)+e.x,c=r*(this.x-e.x)+o*(this.y-e.y)+e.y;return s.x=l,s.y=c,s}clone(t){const e=t??new I(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}I.EQUALS_EPSILON=.001;function D(n,t){return new I(n,t)}class ${constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s??1}static fromRGB(t,e,i,s){return new $(t,e,i,s)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],10),r=parseInt(i[2],10),o=parseInt(i[3],10);let l=1;return i[4]&&(l=parseFloat(i[4])),new $(s,r,o,l)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],16),r=parseInt(i[2],16),o=parseInt(i[3],16);let l=1;return i[4]&&(l=parseInt(i[4],16)/255),new $(s,r,o,l)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new ms(t,e,i,s).toRGBA()}lighten(t=.1){const e=ms.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=ms.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=ms.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=ms.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,r=t.a*this.a;return new $(e,i,s,r)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new $(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,r=(t.a+this.a)/2;return new $(e,i,s,r)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=Math.max(Math.round(t),0).toString(16);return e.length===1?"0"+e:e}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return ms.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(t){const e=t||new $(this.r,this.g,this.b,this.a);return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e}static get Black(){return $.fromHex("#000000")}static get White(){return $.fromHex("#FFFFFF")}static get Gray(){return $.fromHex("#808080")}static get LightGray(){return $.fromHex("#D3D3D3")}static get DarkGray(){return $.fromHex("#A9A9A9")}static get Yellow(){return $.fromHex("#FFFF00")}static get Orange(){return $.fromHex("#FFA500")}static get Red(){return $.fromHex("#FF0000")}static get Vermilion(){return $.fromHex("#FF5B31")}static get Rose(){return $.fromHex("#FF007F")}static get Pink(){return $.fromHex("#FFC0CB")}static get Magenta(){return $.fromHex("#FF00FF")}static get Violet(){return $.fromHex("#7F00FF")}static get Purple(){return $.fromHex("#800080")}static get Blue(){return $.fromHex("#0000FF")}static get Azure(){return $.fromHex("#007FFF")}static get Cyan(){return $.fromHex("#00FFFF")}static get Viridian(){return $.fromHex("#59978F")}static get Teal(){return $.fromHex("#008080")}static get Green(){return $.fromHex("#00FF00")}static get Chartreuse(){return $.fromHex("#7FFF00")}static get Transparent(){return $.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return $.fromHex("#176BAA")}static get Brown(){return $.fromHex("#964B00")}}class ms{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const r=Math.max(t,e,i),o=Math.min(t,e,i);let l,c;const d=(r+o)/2;if(r===o)l=c=0;else{const _=r-o;switch(c=d>.5?_/(2-r-o):_/(r+o),r){case t:l=(e-i)/_+(e<i?6:0);break;case e:l=(i-t)/_+2;break;case i:l=(t-e)/_+4;break}l/=6}return new ms(l,c,d,s)}toRGBA(){let t,e,i;if(this.s===0)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-s;t=ms.hue2rgb(r,s,this.h+1/3),e=ms.hue2rgb(r,s,this.h),i=ms.hue2rgb(r,s,this.h-1/3)}return new $(t*255,e*255,i*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),i=this.l.toFixed(0),s=this.a.toFixed(0);return`hsla(${t}, ${e}, ${i}, ${s})`}}var Ue;(function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warn=2]="Warn",n[n.Error=3]="Error",n[n.Fatal=4]="Fatal"})(Ue||(Ue={}));class lt{constructor(){if(this._appenders=[],this.defaultLevel=Ue.Info,this._logOnceSet=new Set,lt._INSTANCE)throw new Error("Logger is a singleton");return lt._INSTANCE=this,lt._INSTANCE.addAppender(new R_),lt._INSTANCE}static getInstance(){return lt._INSTANCE==null&&(lt._INSTANCE=new lt),lt._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}_logOnce(t,e){const i=t+e.join("+");this._logOnceSet.has(i)||(this._logOnceSet.add(i),this._log(t,e))}debug(...t){this._log(Ue.Debug,t)}debugOnce(...t){this._logOnce(Ue.Debug,t)}info(...t){this._log(Ue.Info,t)}infoOnce(...t){this._logOnce(Ue.Info,t)}warn(...t){this._log(Ue.Warn,t)}warnOnce(...t){this._logOnce(Ue.Warn,t)}error(...t){this._log(Ue.Error,t)}errorOnce(...t){this._logOnce(Ue.Error,t)}fatal(...t){this._log(Ue.Fatal,t)}fatalOnce(...t){this._logOnce(Ue.Fatal,t)}}lt._INSTANCE=null;class R_{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+Ue[t]+"] : "),t<Ue.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<Ue.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class vw{constructor(t){var e,i;this._messages=[],this._pos=10,this._color=$.Black,this._options=t,this.canvas=document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.zIndex=(i=(e=t.zIndex)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"99",document.body.appendChild(this.canvas),this._positionScreenAppenderCanvas(),t.engine.screen.events.on("resize",()=>{this._positionScreenAppenderCanvas()})}_positionScreenAppenderCanvas(){var t,e,i,s;const r=this._options;this.canvas.width=(t=r.width)!==null&&t!==void 0?t:r.engine.screen.resolution.width,this.canvas.height=(e=r.height)!==null&&e!==void 0?e:r.engine.screen.resolution.height,this.canvas.style.position="absolute";const o=r.engine.screen.screenToPageCoordinates(D(0,0));this.canvas.style.left=o.x+"px",this.canvas.style.top=o.y+"px",this._pos=(i=r.xPos)!==null&&i!==void 0?i:this._pos,this._color=(s=r.color)!==null&&s!==void 0?s:this._color}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._messages.unshift("["+Ue[t]+"] : "+i);let s=10;this._messages=this._messages.slice(0,1e3);for(let r=0;r<this._messages.length;r++)this._ctx.fillStyle=this._color.toRGBA(),this._ctx.fillText(this._messages[r],this._pos,s),s+=10}}var Kt;(function(n){n.None="None",n.Top="Top",n.Bottom="Bottom",n.Left="Left",n.Right="Right"})(Kt||(Kt={}));(function(n){function t(i){return i===n.Top?n.Bottom:i===n.Bottom?n.Top:i===n.Left?n.Right:i===n.Right?n.Left:n.None}n.getOpposite=t;function e(i){return Math.abs(i.x)>=Math.abs(i.y)?i.x<=0?n.Left:n.Right:i.y<=0?n.Top:n.Bottom}n.fromDirection=e})(Kt||(Kt={}));class at{constructor(t=0,e=0,i=0,s=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}clone(t){const e=t||new at(0,0,0,0);return e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e}reset(){this.left=0,this.top=0,this.bottom=0,this.right=0}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?Kt.Right:Kt.Left:t.y<0?Kt.Bottom:Kt.Top:Kt.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(let o=0;o<t.length;o++)t[o].x<e&&(e=t[o].x),t[o].x>s&&(s=t[o].x),t[o].y<i&&(i=t[o].y),t[o].y>r&&(r=t[o].y);return new at(e,i,s,r)}static fromDimension(t,e,i=I.Half,s=I.Zero){return new at(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new I((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new I(this.left,this.top)}get bottomRight(){return new I(this.right,this.bottom)}get topRight(){return new I(this.right,this.top)}get bottomLeft(){return new I(this.left,this.bottom)}translate(t){return new at(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=I.Zero){const i=this.getPoints().map(s=>s.rotate(t,e));return at.fromPoints(i)}scale(t,e=I.Zero){const i=this.translate(e);return new at(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=t.data[0]*this.left,i=t.data[1]*this.left,s=t.data[0]*this.right,r=t.data[1]*this.right,o=t.data[2]*this.top,l=t.data[3]*this.top,c=t.data[2]*this.bottom,d=t.data[3]*this.bottom,_=t.getPosition(),f=Math.min(e,s)+Math.min(o,c)+_.x,g=Math.min(i,r)+Math.min(l,d)+_.y,m=Math.max(e,s)+Math.max(o,c)+_.x,x=Math.max(i,r)+Math.max(l,d)+_.y;return new at({left:f,top:g,right:m,bottom:x})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new I(this.left,this.top)),this._points.push(new I(this.right,this.top)),this._points.push(new I(this.right,this.bottom)),this._points.push(new I(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,l=(this.left-t.pos.x)*r,c=(this.right-t.pos.x)*r;i=Math.min(l,c),s=Math.max(l,c);const d=(this.top-t.pos.y)*o,_=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(d,_)),s=Math.min(s,Math.max(d,_)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,l=(this.left-t.pos.x)*r,c=(this.right-t.pos.x)*r;i=Math.min(l,c),s=Math.max(l,c);const d=(this.top-t.pos.y)*o,_=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(d,_)),s=Math.min(s,Math.max(d,_)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof I?this.left<=t.x&&this.top<=t.y&&t.y<=this.bottom&&t.x<=this.right:t instanceof at?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t,e){const i=e||new at(0,0,0,0),s=Math.min(this.left,t.left),r=Math.min(this.top,t.top),o=Math.max(this.right,t.right),l=Math.max(this.bottom,t.bottom);return i.left=s,i.top=r,i.right=o,i.bottom=l,i}get dimensions(){return new I(this.width,this.height)}overlaps(t,e){const i=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const s=this.combine(t);return s.width+i<t.width+this.width&&s.height+i<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let i=0;this.right>=t.left&&this.right<=t.right?i=t.left-this.right:i=t.right-this.left;let s=0;return this.top<=t.bottom&&this.top>=t.top?s=t.bottom-this.top:s=t.top-this.bottom,Math.abs(i)<Math.abs(s)?new I(i,0):new I(0,s)}else if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let i=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?i=t.left-this.right:i=t.right-this.left:t.right-this.right<=this.left-t.left?i=this.left-t.right:i=this.right-t.left;let s=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?s=t.top-this.bottom:s=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?s=this.top-t.bottom:s=this.bottom-t.top,Math.abs(i)<Math.abs(s)?new I(i,0):new I(0,s)}else return null}intersectWithSide(t){const e=this.intersect(t);return at.getSideFromIntersection(e)}draw(t,e=$.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}function xa(n){if(n&&n.getBoundingClientRect){const t=n.getBoundingClientRect();return D(t.x+window.scrollX,t.y+window.scrollY)}return I.Zero}function yk(n,t){return t.indexOf(n)===-1?(t.push(n),!0):!1}function Ho(n,t){let e=-1;return(e=t.indexOf(n))>-1?(t.splice(e,1),!0):!1}function ww(n,t){for(let e=0;e<n.length;e++)if(n[e]===t)return!0;return!1}function xw(n){throw new Error(n)}function Dh(n,t){var e;const i=new Yi;return((e=t==null?void 0:t.schedule.bind(t))!==null&&e!==void 0?e:setTimeout)(()=>{i.resolve()},n),i.promise}function bw(n,t){const e={};for(const i in n)t.includes(i)||(e[i]=n[i]);return e}function Eh(n){return n&&typeof n=="object"&&!Array.isArray(n)}function Lh(n,...t){if(!t.length)return n;const e=t.shift();if(Eh(n)&&Eh(e))for(const i in e)Eh(e[i])?(n[i]||Object.assign(n,{[i]:{}}),Lh(n[i],e[i])):Object.assign(n,{[i]:e[i]});return Lh(n,...t)}var Bu;(function(n){n[n.X=12]="X",n[n.Y=13]="Y"})(Bu||(Bu={}));class Di{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,i,s,r,o){const l=new Di;return l.data[0]=2/(e-t),l.data[1]=0,l.data[2]=0,l.data[3]=0,l.data[4]=0,l.data[5]=2/(s-i),l.data[6]=0,l.data[7]=0,l.data[8]=0,l.data[9]=0,l.data[10]=-2/(o-r),l.data[11]=0,l.data[12]=-(e+t)/(e-t),l.data[13]=-(s+i)/(s-i),l.data[14]=-(o+r)/(o-r),l.data[15]=1,l}clone(t){const e=t||new Di;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Di;return e.data=t,e}static identity(){const t=new Di;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=Di.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=Di.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=Di.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof I){const i=e||new I(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[4]+this.data[12],o=s.x*this.data[1]+s.y*this.data[5]+this.data[13];return i.x=r,i.y=o,i}else{const i=e||new Di,s=t,r=this.data[0],o=this.data[1],l=this.data[2],c=this.data[3],d=this.data[4],_=this.data[5],f=this.data[6],g=this.data[7],m=this.data[8],x=this.data[9],C=this.data[10],T=this.data[11],A=this.data[12],S=this.data[13],E=this.data[14],M=this.data[15],O=s.data[0],N=s.data[1],F=s.data[2],K=s.data[3],nt=s.data[4],pt=s.data[5],ht=s.data[6],ct=s.data[7],bt=s.data[8],wt=s.data[9],Ct=s.data[10],dt=s.data[11],G=s.data[12],kt=s.data[13],Ht=s.data[14],At=s.data[15];i.data[0]=r*O+d*N+m*F+A*K,i.data[1]=o*O+_*N+x*F+S*K,i.data[2]=l*O+f*N+C*F+E*K,i.data[3]=c*O+g*N+T*F+M*K,i.data[4]=r*nt+d*pt+m*ht+A*ct,i.data[5]=o*nt+_*pt+x*ht+S*ct,i.data[6]=l*nt+f*pt+C*ht+E*ct,i.data[7]=c*nt+g*pt+T*ht+M*ct,i.data[8]=r*bt+d*wt+m*Ct+A*dt,i.data[9]=o*bt+_*wt+x*Ct+S*dt,i.data[10]=l*bt+f*wt+C*Ct+E*dt,i.data[11]=c*bt+g*wt+T*Ct+M*dt,i.data[12]=r*G+d*kt+m*Ht+A*At,i.data[13]=o*G+_*kt+x*Ht+S*At,i.data[14]=l*G+f*kt+C*Ht+E*At,i.data[15]=c*G+g*kt+T*Ht+M*At;const Dt=this.getScale();return i._scaleSignX=ne(Dt.x)*ne(i._scaleSignX),i._scaleSignY=ne(Dt.y)*ne(i._scaleSignY),i}}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],l=this.data[4],c=this.data[5],d=this.data[6],_=this.data[7],f=this.data[8],g=this.data[9],m=this.data[10],x=this.data[11],C=this.data[12],T=this.data[13],A=this.data[14],S=this.data[15],E=0,M=1;return this.data[12]=i*t+l*e+f*E+C*M,this.data[13]=s*t+c*e+g*E+T*M,this.data[14]=r*t+d*e+m*E+A*M,this.data[15]=o*t+_*e+x*E+S*M,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return D(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=this.data[4],l=this.data[5],c=this.data[6],d=this.data[7],_=Math.sin(t),f=Math.cos(t);return this.data[0]=f*e+_*o,this.data[1]=f*i+_*l,this.data[2]=f*s+_*c,this.data[3]=f*r+_*d,this.data[4]=f*o-_*e,this.data[5]=f*l-_*i,this.data[6]=f*c-_*s,this.data[7]=f*d-_*r,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],l=this.data[4],c=this.data[5],d=this.data[6],_=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*t,this.data[3]=o*t,this.data[4]=l*e,this.data[5]=c*e,this.data[6]=d*e,this.data[7]=_*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return wn(t)}getScaleX(){const t=D(this.data[0],this.data[4]).magnitude;return this._scaleSignX*t}getScaleY(){const t=D(this.data[1],this.data[5]).magnitude;return this._scaleSignY*t}getScale(){return D(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=ne(t);const e=D(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=ne(t);const e=D(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const i=1/this.getBasisDeterminant(),s=this.data[0],r=this.data[4],o=this.data[1],l=this.data[5],c=t||Di.identity();c.data[0]=l*i,c.data[1]=-o*i,c.data[4]=-r*i,c.data[5]=s*i;const d=this.data[12],_=this.data[13];return c.data[12]=-(d*c.data[0]+_*c.data[4]),c.data[13]=-(d*c.data[1]+_*c.data[5]),c}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class Fe{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new Fe;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const i=Fe.identity();return i.data[4]=t,i.data[5]=e,i}static scale(t,e){const i=Fe.identity();return i.data[0]=t,i.data[3]=e,i._scale[0]=t,i._scale[1]=e,i}static rotation(t){const e=Fe.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return D(this.data[4],this.data[5])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=Math.sin(t),l=Math.cos(t);return this.data[0]=l*e+o*s,this.data[1]=l*i+o*r,this.data[2]=l*s-o*e,this.data[3]=l*r-o*i,this}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],l=this.data[4],c=this.data[5];return this.data[4]=i*t+r*e+l,this.data[5]=s*t+o*e+c,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*e,this.data[3]=o*e,this._scale[0]=t,this._scale[1]=e,this._scaleSignX=ne(t),this._scaleSignY=ne(e),this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const e=this.determinant();let i=e;e!==0&&(i=1/e);const s=this.data[0],r=this.data[2],o=this.data[1],l=this.data[3],c=t||Fe.identity();c.data[0]=l*i,c.data[1]=-o*i,c.data[2]=-r*i,c.data[3]=s*i;const d=this.data[4],_=this.data[5];return c.data[4]=-(d*c.data[0]+_*c.data[2]),c.data[5]=-(d*c.data[1]+_*c.data[3]),c}multiply(t,e){if(t instanceof I){const i=e||new I(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[2]+this.data[4],o=s.x*this.data[1]+s.y*this.data[3]+this.data[5];return i.x=r,i.y=o,i}else{const i=e||new Fe,s=t,r=this.data[0],o=this.data[1],l=this.data[2],c=this.data[3],d=this.data[4],_=this.data[5],f=s.data[0],g=s.data[1],m=s.data[2],x=s.data[3],C=s.data[4],T=s.data[5];i.data[0]=r*f+l*g,i.data[1]=o*f+c*g,i.data[2]=r*m+l*x,i.data[3]=o*m+c*x,i.data[4]=r*C+l*T+d,i.data[5]=o*C+c*T+_;const A=this._scaleSignX,S=this._scaleSignY;return i._scaleSignX=A*ne(i._scaleSignX),i._scaleSignY=S*ne(i._scaleSignY),i}}multiplyQuadInPlace(t){const e=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],i=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=e,t[1]=i;const s=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],r=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=s,t[3]=r;const o=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],l=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=o,t[5]=l;const c=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],d=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=c,t[7]=d}to4x4(){const t=new Di;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[2]=-i*e.x,this.data[3]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return wn(t)}getScaleX(){const t=this.data[0]*this.data[0]+this.data[2]*this.data[2];return t===1?this._scaleSignX:this._scaleSignX*Math.sqrt(t)}getScaleY(){const t=this.data[1]*this.data[1]+this.data[3]*this.data[3];return t===1?this._scaleSignY:this._scaleSignY*Math.sqrt(t)}getScale(){return D(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=ne(t);const e=D(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=ne(t);const e=D(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new Fe;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e._scaleSignX=this._scaleSignX,e._scaleSignY=this._scaleSignY,e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class fl{constructor(t,e,i=1){this.builder=t,this.cleaner=e,this._pool=[],this._size=0,this.grow(i)}grow(t){if(t>0){this._size+=t;for(let e=0;e<t;e++)this._pool.push(this.builder())}}rent(t=!1){return this._pool.length===0&&this.grow(this._size),t?this.cleaner(this._pool.pop()):this._pool.pop()}return(t){this._pool.push(t)}}class Ck{constructor(){this._pool=new fl(()=>Fe.identity(),t=>t.reset(),100),this._transforms=[],this._currentTransform=this._pool.rent(!0)}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone(this._pool.rent())}restore(){this._pool.return(this._currentTransform),this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}reset(){this._currentTransform.reset()}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Ak{constructor(){this.opacity=1,this.z=0,this.tint=$.White,this.material=null}}class yw{constructor(){this._pool=new fl(()=>new Ak,t=>(t.opacity=1,t.z=0,t.tint=$.White,t.material=null,t),100),this.current=this._pool.rent(!0),this._states=[]}_cloneState(t){var e;return t.opacity=this.current.opacity,t.z=this.current.z,t.tint=(e=this.current.tint)===null||e===void 0?void 0:e.clone(),t.material=this.current.material,t}save(){this._states.push(this.current),this.current=this._cloneState(this._pool.rent())}restore(){this._pool.return(this.current),this.current=this._states.pop()}}const Sk={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class pl{constructor(t,e,i=!1){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=lt.getInstance(),this.events=new de}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",s=>this.events.emit("loadstart",s)),i.addEventListener("progress",s=>this.events.emit("progress",s)),i.addEventListener("error",s=>this.events.emit("error",s)),i.addEventListener("load",s=>this.events.emit("load",s)),i.addEventListener("load",()=>{if(i.status!==0&&i.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),e(new Error(i.statusText));return}if(i.response instanceof Blob&&i.response.type==="text/html"){const s=`Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!

Check your server configuration, for example Vite serves static files from the /public folder`;this.events.emit("error",i.response),e(new Error(s));return}this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),i.send()})}}function ws(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,{set:(e,i,s)=>(e[i]!==s&&(e[i]=s,typeof i=="string"&&i[0]!=="_"&&t(e)),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):n)}const Cw=(n=[],t,e)=>({get:(i,s)=>s==="__isProxy"?!0:typeof i[s]=="object"&&i[s]!=null?new Proxy(i[s],Cw([...n,s],t,e)):i[s],set:(i,s,r)=>(typeof s=="string"&&s[0]!=="_"&&t(e),i[s]=r,!0)});function Tk(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,Cw([],t,n)):n)}class Ce{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=ws(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){t&&(this._origin=ws(t,()=>{this._transformStale=!0})),this._transformStale=!0}constructor(t){var e,i,s,r,o,l,c;this.id=Ce._ID++,this.transform=Fe.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=I.One,this._width=0,this._height=0,t&&(this.origin=(e=t.origin)!==null&&e!==void 0?e:this.origin,this.flipHorizontal=(i=t.flipHorizontal)!==null&&i!==void 0?i:this.flipHorizontal,this.flipVertical=(s=t.flipVertical)!==null&&s!==void 0?s:this.flipVertical,this.rotation=(r=t.rotation)!==null&&r!==void 0?r:this.rotation,this.opacity=(o=t.opacity)!==null&&o!==void 0?o:this.opacity,this.scale=(l=t.scale)!==null&&l!==void 0?l:this.scale,this.tint=(c=t.tint)!==null&&c!==void 0?c:this.tint,t.width&&(this._width=t.width),t.height&&(this._height=t.height))}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():void 0,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():void 0,tint:this.tint?this.tint.clone():void 0}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return at.fromDimension(this.width,this.height,I.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,r=(e=this.origin)!==null&&e!==void 0?e:D(this.width/2,this.height/2);t.translate(r.x,r.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-r.x,-r.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}Ce._ID=0;class As extends Ce{static from(t,e){return new As({image:t,...e})}constructor(t){var e,i;super(t),this._logger=lt.getInstance(),this._dirty=!0,this.image=t.image;const{width:s,height:r}=t;this.sourceView=(e=t.sourceView)!==null&&e!==void 0?e:{x:0,y:0,width:s??0,height:r??0},this.destSize=(i=t.destSize)!==null&&i!==void 0?i:{width:s??0,height:r??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,s,r,o;const{width:l,height:c}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||l,this.sourceView.height=((e=this.sourceView)===null||e===void 0?void 0:e.height)||c,this.destSize.width=((i=this.destSize)===null||i===void 0?void 0:i.width)||((s=this.sourceView)===null||s===void 0?void 0:s.width)||l,this.destSize.height=((r=this.destSize)===null||r===void 0?void 0:r.height)||((o=this.sourceView)===null||o===void 0?void 0:o.height)||c,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new As({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var Oe;(function(n){n.Pixel="Pixel",n.Blended="Blended"})(Oe||(Oe={}));function Wo(n){switch(n){case Oe.Pixel:return Oe.Pixel;case Oe.Blended:return Oe.Blended;default:return}}var le;(function(n){n.Clamp="Clamp",n.Repeat="Repeat",n.Mirror="Mirror"})(le||(le={}));function Ps(n){switch(n){case le.Clamp:return le.Clamp;case le.Repeat:return le.Repeat;case le.Mirror:return le.Mirror;default:return le.Clamp}}class we{constructor(t,e){var i;this._garbageCollector=e,this._textureMap=new Map,this._collect=s=>{var r;if(this._gl){const o=(r=s.dataset.originalSrc)!==null&&r!==void 0?r:s.constructor.name;return we._LOGGER.debug(`WebGL Texture for ${o} collected`),this.delete(s),!0}return!1},this._gl=t,we._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),this._garbageCollector&&(we._LOGGER.debug("WebGL Texture collection interval:",this._garbageCollector.collectionInterval),(i=this._garbageCollector.garbageCollector)===null||i===void 0||i.registerCollector("texture",this._garbageCollector.collectionInterval,this._collect))}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,e,i=!1){var s,r;const o=this._gl;if(!o)return null;const{filtering:l,wrapping:c}={...e};let d=null;if(this.has(t)&&(d=this.get(t)),d)return i&&(o.bindTexture(o.TEXTURE_2D,d),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),(s=this._garbageCollector)===null||s===void 0||s.garbageCollector.touch(t),d;d=o.createTexture(),we.checkImageSizeSupportedAndLog(t),o.bindTexture(o.TEXTURE_2D,d),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let _;c&&(typeof c=="string"?_={x:c,y:c}:_={x:c.x,y:c.y});const{x:f,y:g}=_??we.wrapping;switch(f){case le.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);break;case le.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT);break;case le.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE)}switch(g){case le.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);break;case le.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT);break;case le.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}const m=l??we.filtering;return o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,m===Oe.Pixel?o.NEAREST:o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,m===Oe.Pixel?o.NEAREST:o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),this._textureMap.set(t,d),(r=this._garbageCollector)===null||r===void 0||r.garbageCollector.addCollectableResource("texture",t),d}delete(t){const e=this._gl;if(e&&this.has(t)){const i=this.get(t);i&&(this._textureMap.delete(t),e.deleteTexture(i))}}static checkImageSizeSupportedAndLog(t){var e;const i=(e=t.dataset.originalSrc)!==null&&e!==void 0?e:"internal canvas bitmap";return t.width>we._MAX_TEXTURE_SIZE||t.height>we._MAX_TEXTURE_SIZE?(we._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${we._MAX_TEXTURE_SIZE}x${we._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&we._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}we._LOGGER=lt.getInstance();we.filtering=Oe.Blended;we.wrapping={x:le.Clamp,y:le.Clamp};we._MAX_TEXTURE_SIZE=4096;const qt={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class Hs{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,e,i){this._logger=lt.getInstance(),this.data=new Image,this._readyFuture=new Yi,this.ready=this._readyFuture.promise,this.path=t;let s=!1,r;typeof e=="boolean"?s=e:{filtering:i,wrapping:r,bustCache:s}={...e},this._resource=new pl(t,"blob",s),this.filtering=i??this.filtering,typeof r=="string"?this.wrapping={x:r,y:r}:this.wrapping=r??this.wrapping,t.endsWith(".gif")&&this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${t} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`)}static fromHtmlImageElement(t,e){const i=new Hs("");if(i._src="image-element",i.data=t,i.data.setAttribute("data-original-src","image-element"),e!=null&&e.filtering?i.data.setAttribute(qt.Filtering,e==null?void 0:e.filtering):i.data.setAttribute(qt.Filtering,Oe.Blended),e!=null&&e.wrapping){let s;typeof e.wrapping=="string"?s={x:e.wrapping,y:e.wrapping}:s={x:e.wrapping.x,y:e.wrapping.y},i.data.setAttribute(qt.WrappingX,s.x),i.data.setAttribute(qt.WrappingY,s.y)}else i.data.setAttribute(qt.WrappingX,le.Clamp),i.data.setAttribute(qt.WrappingY,le.Clamp);return we.checkImageSizeSupportedAndLog(t),i._readyFuture.resolve(t),i}static fromHtmlCanvasElement(t,e){const i=new Hs("");if(i._src="canvas-element-blob",i.data.setAttribute("data-original-src","canvas-element-blob"),e!=null&&e.filtering?i.data.setAttribute(qt.Filtering,e==null?void 0:e.filtering):i.data.setAttribute(qt.Filtering,Oe.Blended),e!=null&&e.wrapping){let s;typeof e.wrapping=="string"?s={x:e.wrapping,y:e.wrapping}:s={x:e.wrapping.x,y:e.wrapping.y},i.data.setAttribute(qt.WrappingX,s.x),i.data.setAttribute(qt.WrappingY,s.y)}else i.data.setAttribute(qt.WrappingX,le.Clamp),i.data.setAttribute(qt.WrappingY,le.Clamp);return we.checkImageSizeSupportedAndLog(t),t.toBlob(s=>{const r=URL.createObjectURL(s);i.image.onload=()=>{URL.revokeObjectURL(r),i.data=i.image,i._readyFuture.resolve(i.image)},i.image.src=r}),i}static fromSvgString(t,e){const i=new Blob([t],{type:"image/svg+xml"}),s=URL.createObjectURL(i);return new Hs(s,e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,e,i,s;if(this.isLoaded())return this.data;try{let r;if(this.path.includes("data:image/"))r=this.path;else{const c=await this._resource.load();r=URL.createObjectURL(c)}const o=new Image,l=new Yi;o.onload=()=>l.resolve(),o.src=r,o.setAttribute("data-original-src",this.path),await l.promise,this.data=o,we.checkImageSizeSupportedAndLog(this.data)}catch(r){throw`Error loading ImageSource from path '${this.path}' with error [${r.message}]`}return this.data.setAttribute(qt.Filtering,this.filtering),this.data.setAttribute(qt.WrappingX,(e=(t=this.wrapping)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:le.Clamp),this.data.setAttribute(qt.WrappingY,(s=(i=this.wrapping)===null||i===void 0?void 0:i.y)!==null&&s!==void 0?s:le.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(t){return As.from(this,t)}unload(){this.data=new Image}}class mc extends Ce{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=void 0,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=lt.getInstance();const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:r,shadow:o,lineHeight:l}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=s??this.caseInsensitive,this.spacing=r??this.spacing,this.shadow=o??this.shadow,this.lineHeight=l??this.lineHeight}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let r=0;r<i.length;r++){const o=i[r];let l=s.indexOf(o);l===-1&&(l=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${o}' in configured alphabet '${s}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const c=this.spriteSheet.sprites[l];c?e.push(c):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${o}' at index '${l}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return e}measureText(t,e){const i=this._getLinesFromText(t,e),s=i.reduce((c,d)=>c.length>d.length?c:d),r=this._getCharacterSprites(s);let o=0,l=0;for(const c of r)o+=c.width+this.spacing,l=Math.max(l,c.height);return at.fromDimension(o*this.scale.x,l*i.length*this.scale.y,I.Zero)}_drawImage(t,e,i,s){var r;let o=0,l=0,c=0;const d=this._getLinesFromText(this._text,s);for(const _ of d){for(const f of this._getCharacterSprites(_))f.draw(t,e+o,i+l),o+=f.width+this.spacing,c=Math.max(c,f.height);o=0,l+=(r=this.lineHeight)!==null&&r!==void 0?r:c}}render(t,e,i,s,r,o){this._text=e;const l=this.measureText(e,o);this.width=l.width,this.height=l.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t),t.restore()),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t)}clone(){return new mc({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){var i;if(this._cachedText===t&&this._cachedRenderWidth===e&&(!((i=this._cachedLines)===null||i===void 0)&&i.length))return this._cachedLines;const s=t.split(`
`);if(e==null)return s;for(let r=0;r<s.length;r++){let o=s[r],l="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)l=o[o.length-1]+l,o=o.slice(0,-1);s[r]=o,s[r+1]=l}}return this._cachedText=t,this._cachedLines=s,this._cachedRenderWidth=e,s}}class gl extends As{constructor(t){super({image:t.image,sourceView:t.sourceView,destSize:{width:t.width,height:t.height},flipHorizontal:t.flipHorizontal,flipVertical:t.flipVertical,rotation:t.rotation,scale:t.scale,opacity:t.opacity,tint:t.tint,origin:t.origin}),this._ready=new Yi,this.ready=this._ready.promise,this._options=t,this.image.isLoaded()?this._applyTiling():this.image.ready.then(()=>this._applyTiling())}static fromSprite(t,e){return new gl({sourceView:{...t.sourceView},width:t.width,height:t.height,...e,image:t.image})}_applyTiling(){const{width:t,height:e,filtering:i,wrapping:s}={...this._options},r=document.createElement("canvas");r.width=this.sourceView.width,r.height=this.sourceView.height,r.getContext("2d").drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,0,0,this.sourceView.width,this.sourceView.height);const l=Hs.fromHtmlCanvasElement(r,{wrapping:s??le.Repeat,filtering:i});t&&(this.destSize.width=t,this.sourceView.width=t),e&&(this.destSize.height=e,this.sourceView.height=e),this.sourceView.x=0,this.sourceView.y=0,this.image=l,this.image.ready.then(()=>this._ready.resolve())}}class Cr{constructor(t){this.sprites=[];const{sprites:e,rows:i,columns:s}=t;this.sprites=e,this.rows=i??1,this.columns=s??this.sprites.length}getSprite(t,e,i){var s,r,o,l,c,d,_,f,g;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const m=t+e*this.columns,x=this.sprites[m];if(x){if(i){const C=x.clone();return C.flipHorizontal=(s=i.flipHorizontal)!==null&&s!==void 0?s:C.flipHorizontal,C.flipVertical=(r=i.flipVertical)!==null&&r!==void 0?r:C.flipVertical,C.width=(o=i.width)!==null&&o!==void 0?o:C.width,C.height=(l=i.height)!==null&&l!==void 0?l:C.height,C.rotation=(c=i.rotation)!==null&&c!==void 0?c:C.rotation,C.scale=(d=i.scale)!==null&&d!==void 0?d:C.scale,C.opacity=(_=i.opacity)!==null&&_!==void 0?_:C.opacity,C.tint=(f=i.tint)!==null&&f!==void 0?f:C.tint,C.origin=(g=i.origin)!==null&&g!==void 0?g:C.origin,C}return x}throw Error(`Invalid sprite coordinates (${t}, ${e})`)}getTiledSprite(t,e,i){if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const s=t+e*this.columns,r=this.sprites[s];if(r)return gl.fromSprite(r,i);throw Error(`Invalid sprite coordinates (${t}, ${e})`)}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(i=>new As({image:t.image,sourceView:i}));return new Cr({sprites:e})}static fromImageSource(t){var e;const i=[];t.spacing=(e=t.spacing)!==null&&e!==void 0?e:{};const{image:s,grid:{rows:r,columns:o,spriteWidth:l,spriteHeight:c},spacing:{originOffset:d,margin:_}}=t,f={x:0,y:0,...d},g={x:0,y:0,..._};for(let m=0;m<o;m++)for(let x=0;x<r;x++)i[m+x*o]=new As({image:s,sourceView:{x:m*l+g.x*m+f.x,y:x*c+g.y*x+f.y,width:l,height:c},destSize:{height:c,width:l}});return new Cr({sprites:i,rows:r,columns:o})}clone(){return new Cr({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const Ek="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAABlFJREFUeJztndmy4yoMRcWt/v9fdr8EWoDAaDD4JntVpeqcxBrMIGQDNhEAAAAAAAAAAAAAAOCrSbMfr+u6yoEpTY+906GV57YtPkjyXj9WZZ+wHWHfo2N3/bU6Tte9Rv6ptruqRyMvKvvIX/zY3I/vjLeqsg6l/CWdp0KHKO/1Y1H2EdsR9j06Ntdfp+N03SvkH2u7i3pu5XkQ+DNTkgNJSok+/183xpcdWZHjgUzpQ2pGD67vaf//KRAGAq3tdhCy2tcMQKPyXyz7iPqrdBjbX5h9g7xbtvWf4ZJvM4D/BKG24Sd+IkQ0TC9aW5NM5FbO2HgrPVzW2vmN50DZNv/QWtl5bfPy85SBtdy9dFmjsf2F2SehTBVE+u+tkE5+lAGcJlFwGuodwRRU2Qe3rx0FhPNflc3HWC7BEh8EDGVR5IMCiLnDONtPp87qhxVH/S/LvzUAuDs/kyGimA5oSONKR1w8vsLpv+v+S9vhmS71JRiX1xB5CWZNw7m6rMrllMag/RJyWb67BEgpDVMWSydc+K47pr35w05kWd7ReEq6116KaG4CsbJ7OmV9PdZLEKkONiC1/7ZONVgDsajLIJPYp2OUAXRpnPcGmnIE6eSK4nv5YQqqSYO52JqnYfYj/PdQXQIY7XszuMofMgZRT/1LdeC5h2I5/0EdWDMY2Yb05WDE1RodVdpSA5r85slArAVnSf+89iP896St0f5bZKVA7Gk/3ja8q+152/+wrLqBWZTem3IBADbRBoDuHgAA4HdAAADgh0EAAOCHQQAA4IdBAADgh0EAAOCHuVsKbJ3P9M7jjuxHzGfv8j9iDt47Dx7hP8cjq5F/o/0T62Aer//ZOgDrajBp6aNlOWTEajKLjgj/Pcs/vfZD/a++3Pc8hNfZ966EVeh5vP75luDRJUAl0KzJfnopaqbaTuzZiulc2BS5lltFXntu3dcQsXadl59Wn1H+dfYNtrt2d6D/LDF9HkCQw6eXFbr8P9X5W/un5Ol8gz1t39p5pWOPn0vLynbgdnfe8maEQw+UIPJdfxdOd/4oTtVD0IYg8wDywGas0I04T5O3P8/qf2UWwPpkn1PbOT1bN2tFe59EM7TvKf+TRFw+erZ2ey4hpS3hp9qBkqq/tjsSU1OYqucBWB1yynt5QxC42Mdk30pAEIio//zRG3feBzLUX+TTjCKwlH83aI/KbpQBVEHgUGF0j/SitcLofHem8q6AyH0wBhFv4WszuOjy0yK2vc/oRWQoP2X9ve78jfaLnpncbBqQSC6s0HnIRT0a2yNZjfxT8+ir8t+yDsDTWaS6X70GP33+d77stp+I5HtBdwEAAPBl8ECApcAA/DBvfSowAGAB7/05ZAAA/DAIAADMMU3fOuS2ggAAwBjrorKoxWiPBxHMAgAg490Ts0VeePdA+ZfJDKcCh7sBqY88mmjklZeOt9iXPrvx2I2QPRnN2/qzyJ84h4gNcbtfasq5mM1rZr+bBWh2A+bIIX13Z9wqL+nQvFno7v3oq4tJItCed7isUT6C/I7BUn9KP95wDicYBYpcjncrO2c/dmW4tBtw4RiRld1IDxDyYsoXMHxF1w3dyz0Nne8033AOFsT6VgRCafl89fenTZUfbm8CGhrgdDcS7anAsvnkkP0IeCfQ+JzYunky6jhNYj5bl7++4fJvN9WDSKS/292A0wyANyKDI91bfkm3kcH7ckaP/SKW/VHKRZAcI14pP3beu0fPyn/DuZQbWMogNnsc16sziE96f7H/iai7uTf0/3N8lwFz/e13T00Djt4OrInCnkeChXT+qOcKOLA21tJpsv/G8/COnGnw97J9QwbTvd6djYSv7fxEVTuV/LzNhj7nOawv6bfbAGCYEpQ6HxFtuxs6sq9tzOYHobQ6Nje+6vo5BwFrPZ4OgMayS4PPt1NlzdLfbRCYBoBc+NaO4JWPwLEf33oN3unY3InKPQBW6Z7nEZzEmrl4iZjC804lqgePPEOguQcwWghUphxm343wyt/pWpWR0OrR+jvyxavHajfb9pTjbt9bH07Z5/expM4TLWfwb7QQqMoC+UDWXZo/4RgA38LOgUvLJAAQ1Td9y9//0ylxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+g79apuVUsS5ZmwAAAABJRU5ErkJggg==";class M_{constructor(){this.fontSheet=Ek,this.size=16,this.load()}load(){return this._imageSource=new Hs(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=Cr.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new mc({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class Pk{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class mh{constructor(t){var e,i;this.antialias=!1,this.samples=1,this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(e=t.antialias)!==null&&e!==void 0?e:this.antialias,this.samples=(i=t.samples)!==null&&i!==void 0?i:this._gl.getParameter(this._gl.MAX_SAMPLES);const s=this._gl;s.drawingBufferFormat?this.bufferFormat=s.drawingBufferFormat:this.transparency?this.bufferFormat=s.RGBA8:this.bufferFormat=s.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),this._renderBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,this._renderBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,Math.min(this.samples,i.getParameter(i.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new Pk(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const e=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const kk=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,Ik=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function Ou(n,t){switch(t){case n.INT:case n.UNSIGNED_INT:case n.FLOAT:return 4;case n.SHORT:return 2;case n.UNSIGNED_SHORT:return 2;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;default:return 1}}function Aw(n,t){const e=`(?<type>[a-z0-9]+)\\s+${t};`,s=new RegExp(e,"g").exec(n);return(s==null?void 0:s.length)>0}function Sw(n,t,e){var i;const s=`(?<type>[a-z0-9]+)\\s+${e};`,o=new RegExp(s,"g").exec(t);switch((i=o==null?void 0:o.groups)===null||i===void 0?void 0:i.type){case"float":case"vec2":case"vec3":case"vec4":return n.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return n.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return n.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return n.BOOL;case"short":return n.SHORT;case"ushort":return n.UNSIGNED_SHORT;case"ubyte":return n.UNSIGNED_BYTE;case"byte":return n.BYTE;default:return n.FLOAT}}function Tw(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:return 1;case n.FLOAT_VEC2:return 2;case n.FLOAT_VEC3:return 3;case n.FLOAT_VEC4:return 4;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;case n.UNSIGNED_SHORT:case n.SHORT:return 1;default:return 1}}function Ew(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:case n.FLOAT_VEC2:case n.FLOAT_VEC3:case n.FLOAT_VEC4:return n.FLOAT;case n.BYTE:return n.BYTE;case n.UNSIGNED_BYTE:return n.UNSIGNED_BYTE;case n.SHORT:return n.SHORT;case n.UNSIGNED_SHORT:return n.UNSIGNED_SHORT;default:return n.FLOAT}}function D_(n,t){const e=s=>{const r=`#version 300 es
    precision mediump float;
    out vec4 fragColor;
    void main() {
      float index = 1.01;
      %%complexity%%
    }`;let o="";for(let l=0;l<s;l++)l===0?o+=`if (index <= ${l}.5) {
`:o+=`   else if (index <= ${l}.5) {
`,o+=`      fragColor = vec4(1.0);
`,o+=`   }
`;return r.replace("%%complexity%%",o)};let i=!1;do{const s=e(t),r=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,s),n.compileShader(r),i=n.getShaderParameter(r,n.COMPILE_STATUS),i||(t=t/2|0)}while(!i);return t}class Ei{get compiled(){return this._compiled}constructor(t){this._logger=lt.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;const{gl:e,vertexSource:i,fragmentSource:s,onPreLink:r,onPostCompile:o}=t;this._gl=e,this.vertexSource=i,this.fragmentSource=s,this._onPreLink=r,this._onPostCompile=o}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),Ei._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ei._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const s=this.getAttributes();for(const o of s)this.attributes[o.name]=o;const r=this.getUniforms();for(const o of r)this.uniforms[o.name]=o;return this._compiled=!0,this._onPostCompile&&this._onPostCompile(this),this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let s=0;s<e;s++){const r=t.getActiveUniform(this.program,s),o=t.getUniformLocation(this.program,r.name);i.push({name:r.name,glType:r.type,location:o})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let s=0;s<e;s++){const r=t.getActiveAttrib(this.program,s),o=t.getAttribLocation(this.program,r.name);i.push({name:r.name,glType:Ew(t,r.type),size:Tw(t,r.type),location:o,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}trySetUniformInt(t,e){return this.trySetUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}trySetUniformIntArray(t,e){return this.trySetUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}trySetUniformBoolean(t,e){return this.trySetUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}trySetUniformFloat(t,e){return this.trySetUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}trySetUniformFloatArray(t,e){return this.trySetUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}trySetUniformFloatVector(t,e){return this.trySetUniform("uniform2f",t,e.x,e.y)}setUniformFloatColor(t,e){this.setUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}trySetUniformFloatColor(t,e){return this.trySetUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniformAffineMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,[e.data[0],e.data[1],0,0,e.data[2],e.data[3],0,0,0,0,1,0,e.data[4],e.data[5],0,1])}trySetUniformMatrix(t,e){return this.trySetUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,e,...i){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${e}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else return!1;return!0}_createProgram(t,e,i){const s=t.createProgram();if(s===null)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),this._onPreLink&&this._onPreLink(s),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.VERTEX_SHADER===i?"vertex":"fragment",r=t.createShader(i);if(r===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const l=t.getShaderInfoLog(r);throw Error(`Could not compile ${s} shader:

${l}${this._processSourceForError(e,l)}`)}return r}_processSourceForError(t,e){if(!t)return e;const i=t.split(`
`),s=e.search(/\d:\d/),r=e.indexOf(" ",s),[o,l]=e.slice(s,r).split(":").map(c=>Number(c));for(let c=0;c<i.length;c++)i[c]=`${c+1}: ${i[c]}${l===c+1?" <----- ERROR!":""}`;return`

Source:
`+i.join(`
`)}}Ei._ACTIVE_SHADER_INSTANCE=null;class qs{constructor(t){this.type="dynamic";const{gl:e,size:i,type:s,data:r}=t;if(this._gl=e,this.buffer=this._gl.createBuffer(),!r&&!i)throw Error("Must either provide data or a size to the VertexBuffer");r?this.bufferData=r:this.bufferData=new Float32Array(i),this.type=s??this.type,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class In{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._logger=lt.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:e,shader:i,vertexBuffer:s,attributes:r,suppressWarnings:o}=t;this._gl=e,this._vertexBuffer=s,this._attributes=r,this._shader=i,this._suppressWarnings=o,i&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const r of this._attributes){const o=t[r[0]];if(!o){if(!Aw(this._shader.vertexSource,r[0]))throw Error(`The attribute named: ${r[0]} size ${r[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${r[0]} size ${r[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${r[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${r[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const l=Sw(this._gl,this._shader.vertexSource,r[0]);this._layout.push({name:r[0],glType:l,size:r[1],location:-1,normalized:!1})}if(o){if(o.size!==r[1])throw Error(`VertexLayout size definition for attribute: [${r[0]}, ${r[1]}], doesn't match shader source size ${o.size}:
 ${this._shader.vertexSource}`);this._layout.push(o)}}let e=0;for(const r of this._layout){const o=Ou(this._gl,r.glType);this._vertexTotalSizeBytes+=o*r.size,e+=r.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const i=this._gl;this._vao=i.createVertexArray(),i.bindVertexArray(this._vao),this._vertexBuffer.bind();let s=0;for(const r of this._layout)r.location!==-1&&(r.glType===i.INT?i.vertexAttribIPointer(r.location,r.size,r.glType,this.totalVertexSizeBytes,s):i.vertexAttribPointer(r.location,r.size,r.glType,r.normalized,this.totalVertexSizeBytes,s),i.enableVertexAttribArray(r.location)),s+=Ou(i,r.glType)*r.size;i.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,e){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const i=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e),i.bindVertexArray(this._vao)}}class ce{static clear(){ce.DrawCallCount=0,ce.DrawnImagesCount=0}}ce.DrawCallCount=0;ce.DrawnImagesCount=0;class Rk{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0,this._startScratch=D(0,0),this._endScratch=D(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ei({gl:t,vertexSource:kk,fragmentSource:Ik}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new qs({gl:t,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new In({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const s=this._context.getTransform(),r=s.multiply(t,this._startScratch),o=s.multiply(e,this._endScratch),l=this._vertexBuffer.bufferData;l[this._vertexIndex++]=r.x,l[this._vertexIndex++]=r.y,l[this._vertexIndex++]=i.r/255,l[this._vertexIndex++]=i.g/255,l[this._vertexIndex++]=i.b/255,l[this._vertexIndex++]=i.a,l[this._vertexIndex++]=o.x,l[this._vertexIndex++]=o.y,l[this._vertexIndex++]=i.r/255,l[this._vertexIndex++]=i.g/255,l[this._vertexIndex++]=i.b/255,l[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),ce.DrawnImagesCount+=this._lineCount,ce.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const Mk=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,Dk=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class Lk{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ei({gl:t,vertexSource:Mk,fragmentSource:Dk}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new qs({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const s=this._context.getTransform(),r=this._context.opacity,o=this._context.snapToPixel,l=s.multiply(t);o&&(l.x=~~(l.x+Mt),l.y=~~(l.y+Mt));const c=this._buffer.bufferData;c[this._vertexIndex++]=l.x,c[this._vertexIndex++]=l.y,c[this._vertexIndex++]=e.r/255,c[this._vertexIndex++]=e.g/255,c[this._vertexIndex++]=e.b/255,c[this._vertexIndex++]=e.a*r,c[this._vertexIndex++]=i*Math.max(s.getScaleX(),s.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),ce.DrawnImagesCount+=this._pointCount,ce.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const Fk=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,Bk=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class Ok{constructor(t){this._gl=t,this._shader=new Ei({gl:t,vertexSource:Fk,fragmentSource:Bk}),this._shader.compile(),this._buffer=new qs({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl,i=t.getShader();i.use(),t.getLayout().use(),e.activeTexture(e.TEXTURE0),i.trySetUniformInt("u_image",0),t.onDraw&&t.onDraw(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class ml{constructor(t,e,i){this._logger=lt.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const s=e*6;if(!i)this.bufferData=new Uint32Array(s);else{const l=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(s),e>l&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${l}) requested quads(${e})`)}let r=0;for(let o=0;o<s;o+=6)this.bufferData[o+0]=r+0,this.bufferData[o+1]=r+1,this.bufferData[o+2]=r+2,this.bufferData[o+3]=r+2,this.bufferData[o+4]=r+1,this.bufferData[o+5]=r+3,r+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const Uk=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
in vec2 v_res;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
  \r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
  \r
  return pixel/texture_size;\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
  \r
  vec4 color=vec4(1.,0,0,1.);\r
  \r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
  \r
  color.rgb=color.rgb*v_opacity;\r
  color.a=color.a*v_opacity;\r
  fragColor=color*v_tint;\r
}`,zk=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity\r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture res\r
in vec2 a_res;\r
out vec2 v_res;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  // Set the vertex position using the ortho transform matrix\r
  gl_Position=u_matrix*vec4(a_position,0.,1.);\r
  \r
  // Pass through the Opacity to the fragment shader\r
  v_opacity=a_opacity;\r
  // Pass through the UV coord to the fragment shader\r
  v_texcoord=a_texcoord;\r
\r
  v_res = a_res;\r
\r
  // Pass through the texture number to the fragment shader\r
  v_textureIndex=a_textureIndex;\r
  // Pass through the tint\r
  v_tint=a_tint;\r
}`;class Hk{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this._defaultTint=$.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=D_(t,i);this._maxTextures=Math.min(i,s);const r=this._transformFragmentSource(Uk,this._maxTextures);this._shader=new Ei({gl:t,fragmentSource:r,vertexSource:zk}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((o,l)=>l)),this._buffer=new qs({gl:t,size:12*4*this._maxImages,type:"dynamic"}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new ml(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let r=0;r<e;r++)r===0?s+=`if (v_textureIndex <= ${r}.5) {
`:s+=`   else if (v_textureIndex <= ${r}.5) {
`,s+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,s+=`      color = texture(u_textures[${r}], uv);
`,s+=`   }
`;return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(qt.Filtering),i=e?Wo(e):void 0,s=Ps(t.getAttribute(qt.WrappingX)),r=Ps(t.getAttribute(qt.WrappingY)),o=t.getAttribute("forceUpload")==="true",l=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);t.removeAttribute("forceUpload"),this._textures.indexOf(l)===-1&&(this._textures.push(l),this._textureToIndex.set(l,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const i=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(i))!==null&&e!==void 0?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,i,s,r,o,l,c,d){var _,f,g,m;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const x=this._getImageWidth(t),C=this._getImageHeight(t);let T=x||s||0,A=C||r||0;this._view[0]=0,this._view[1]=0,this._view[2]=(_=s??x)!==null&&_!==void 0?_:0,this._view[3]=(f=r??C)!==null&&f!==void 0?f:0,this._dest[0]=e??1,this._dest[1]=i??1,o!==void 0&&l!==void 0&&c!==void 0&&d!==void 0&&(this._view[0]=e??1,this._view[1]=i??1,this._view[2]=(g=s??x)!==null&&g!==void 0?g:0,this._view[3]=(m=r??C)!==null&&m!==void 0?m:0,this._dest[0]=o,this._dest[1]=l,T=c,A=d),e=this._view[0],i=this._view[1];const S=this._view[2],E=this._view[3],M=this._context.getTransform(),O=this._context.opacity,N=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+T,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+A,this._quad[6]=this._dest[0]+T,this._quad[7]=this._dest[1]+A,M.multiplyQuadInPlace(this._quad),N&&(this._quad[0]=~~(this._quad[0]+ne(this._quad[0])*Mt),this._quad[1]=~~(this._quad[1]+ne(this._quad[1])*Mt),this._quad[2]=~~(this._quad[2]+ne(this._quad[2])*Mt),this._quad[3]=~~(this._quad[3]+ne(this._quad[3])*Mt),this._quad[4]=~~(this._quad[4]+ne(this._quad[4])*Mt),this._quad[5]=~~(this._quad[5]+ne(this._quad[5])*Mt),this._quad[6]=~~(this._quad[6]+ne(this._quad[6])*Mt),this._quad[7]=~~(this._quad[7]+ne(this._quad[7])*Mt));const F=this._context.tint||this._defaultTint,K=this._getTextureIdForImage(t),nt=x||T,pt=C||A,ht=(e+this.uvPadding)/nt,ct=(i+this.uvPadding)/pt,bt=(e+S-this.uvPadding)/nt,wt=(i+E-this.uvPadding)/pt,Ct=x,dt=C,G=this._layout.vertexBuffer.bufferData;G[this._vertexIndex++]=this._quad[0],G[this._vertexIndex++]=this._quad[1],G[this._vertexIndex++]=O,G[this._vertexIndex++]=Ct,G[this._vertexIndex++]=dt,G[this._vertexIndex++]=ht,G[this._vertexIndex++]=ct,G[this._vertexIndex++]=K,G[this._vertexIndex++]=F.r/255,G[this._vertexIndex++]=F.g/255,G[this._vertexIndex++]=F.b/255,G[this._vertexIndex++]=F.a,G[this._vertexIndex++]=this._quad[4],G[this._vertexIndex++]=this._quad[5],G[this._vertexIndex++]=O,G[this._vertexIndex++]=Ct,G[this._vertexIndex++]=dt,G[this._vertexIndex++]=ht,G[this._vertexIndex++]=wt,G[this._vertexIndex++]=K,G[this._vertexIndex++]=F.r/255,G[this._vertexIndex++]=F.g/255,G[this._vertexIndex++]=F.b/255,G[this._vertexIndex++]=F.a,G[this._vertexIndex++]=this._quad[2],G[this._vertexIndex++]=this._quad[3],G[this._vertexIndex++]=O,G[this._vertexIndex++]=Ct,G[this._vertexIndex++]=dt,G[this._vertexIndex++]=bt,G[this._vertexIndex++]=ct,G[this._vertexIndex++]=K,G[this._vertexIndex++]=F.r/255,G[this._vertexIndex++]=F.g/255,G[this._vertexIndex++]=F.b/255,G[this._vertexIndex++]=F.a,G[this._vertexIndex++]=this._quad[6],G[this._vertexIndex++]=this._quad[7],G[this._vertexIndex++]=O,G[this._vertexIndex++]=Ct,G[this._vertexIndex++]=dt,G[this._vertexIndex++]=bt,G[this._vertexIndex++]=wt,G[this._vertexIndex++]=K,G[this._vertexIndex++]=F.r/255,G[this._vertexIndex++]=F.g/255,G[this._vertexIndex++]=F.b/255,G[this._vertexIndex++]=F.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*12*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),ce.DrawnImagesCount+=this._imageCount,ce.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Wk=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,Nk=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Gk{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0,this._transparent=$.Transparent,this._scratch1=D(0,0),this._scratch2=D(0,0),this._scratch3=D(0,0),this._scratch4=D(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ei({gl:t,fragmentSource:Wk,vertexSource:Nk}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new qs({gl:t,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ml(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof I&&t[1]instanceof I?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,s=1){this._isFull()&&this.flush(),this._rectangleCount++;const r=this._context.getTransform(),o=this._context.opacity,l=this._context.snapToPixel,c=e.sub(t),d=c.magnitude,_=c.normalize().perpendicular(),f=s/2,g=r.multiply(_.scale(f,this._scratch1).add(t,this._scratch1),this._scratch1),m=r.multiply(_.scale(-f,this._scratch2).add(t,this._scratch2),this._scratch2),x=r.multiply(_.scale(f,this._scratch3).add(e,this._scratch3),this._scratch3),C=r.multiply(_.scale(-f,this._scratch4).add(e,this._scratch4),this._scratch4);l&&(g.x=~~(g.x+Mt),g.y=~~(g.y+Mt),x.x=~~(x.x+Mt),x.y=~~(x.y+Mt),m.x=~~(m.x+Mt),m.y=~~(m.y+Mt),C.x=~~(C.x+Mt),C.y=~~(C.y+Mt));const T=0,A=0,S=1,E=1,M=this._transparent,O=0,N=1,F=this._layout.vertexBuffer.bufferData;F[this._vertexIndex++]=g.x,F[this._vertexIndex++]=g.y,F[this._vertexIndex++]=T,F[this._vertexIndex++]=A,F[this._vertexIndex++]=d,F[this._vertexIndex++]=s,F[this._vertexIndex++]=o,F[this._vertexIndex++]=i.r/255,F[this._vertexIndex++]=i.g/255,F[this._vertexIndex++]=i.b/255,F[this._vertexIndex++]=i.a,F[this._vertexIndex++]=M.r/255,F[this._vertexIndex++]=M.g/255,F[this._vertexIndex++]=M.b/255,F[this._vertexIndex++]=M.a,F[this._vertexIndex++]=O/N,F[this._vertexIndex++]=m.x,F[this._vertexIndex++]=m.y,F[this._vertexIndex++]=T,F[this._vertexIndex++]=E,F[this._vertexIndex++]=d,F[this._vertexIndex++]=s,F[this._vertexIndex++]=o,F[this._vertexIndex++]=i.r/255,F[this._vertexIndex++]=i.g/255,F[this._vertexIndex++]=i.b/255,F[this._vertexIndex++]=i.a,F[this._vertexIndex++]=M.r/255,F[this._vertexIndex++]=M.g/255,F[this._vertexIndex++]=M.b/255,F[this._vertexIndex++]=M.a,F[this._vertexIndex++]=O/N,F[this._vertexIndex++]=x.x,F[this._vertexIndex++]=x.y,F[this._vertexIndex++]=S,F[this._vertexIndex++]=A,F[this._vertexIndex++]=d,F[this._vertexIndex++]=s,F[this._vertexIndex++]=o,F[this._vertexIndex++]=i.r/255,F[this._vertexIndex++]=i.g/255,F[this._vertexIndex++]=i.b/255,F[this._vertexIndex++]=i.a,F[this._vertexIndex++]=M.r/255,F[this._vertexIndex++]=M.g/255,F[this._vertexIndex++]=M.b/255,F[this._vertexIndex++]=M.a,F[this._vertexIndex++]=O/N,F[this._vertexIndex++]=C.x,F[this._vertexIndex++]=C.y,F[this._vertexIndex++]=S,F[this._vertexIndex++]=E,F[this._vertexIndex++]=d,F[this._vertexIndex++]=s,F[this._vertexIndex++]=o,F[this._vertexIndex++]=i.r/255,F[this._vertexIndex++]=i.g/255,F[this._vertexIndex++]=i.b/255,F[this._vertexIndex++]=i.a,F[this._vertexIndex++]=M.r/255,F[this._vertexIndex++]=M.g/255,F[this._vertexIndex++]=M.b/255,F[this._vertexIndex++]=M.a,F[this._vertexIndex++]=O/N}drawRectangle(t,e,i,s,r=$.Transparent,o=0){this._isFull()&&this.flush(),this._rectangleCount++;const l=this._context.getTransform(),c=this._context.opacity,d=this._context.snapToPixel,_=l.multiply(t.add(D(0,0))),f=l.multiply(t.add(D(e,0))),g=l.multiply(t.add(D(e,i))),m=l.multiply(t.add(D(0,i)));d&&(_.x=~~(_.x+Mt),_.y=~~(_.y+Mt),f.x=~~(f.x+Mt),f.y=~~(f.y+Mt),m.x=~~(m.x+Mt),m.y=~~(m.y+Mt),g.x=~~(g.x+Mt),g.y=~~(g.y+Mt));const x=0,C=0,T=1,A=1,S=this._layout.vertexBuffer.bufferData;S[this._vertexIndex++]=_.x,S[this._vertexIndex++]=_.y,S[this._vertexIndex++]=x,S[this._vertexIndex++]=C,S[this._vertexIndex++]=e,S[this._vertexIndex++]=i,S[this._vertexIndex++]=c,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=r.r/255,S[this._vertexIndex++]=r.g/255,S[this._vertexIndex++]=r.b/255,S[this._vertexIndex++]=r.a,S[this._vertexIndex++]=o,S[this._vertexIndex++]=m.x,S[this._vertexIndex++]=m.y,S[this._vertexIndex++]=x,S[this._vertexIndex++]=A,S[this._vertexIndex++]=e,S[this._vertexIndex++]=i,S[this._vertexIndex++]=c,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=r.r/255,S[this._vertexIndex++]=r.g/255,S[this._vertexIndex++]=r.b/255,S[this._vertexIndex++]=r.a,S[this._vertexIndex++]=o,S[this._vertexIndex++]=f.x,S[this._vertexIndex++]=f.y,S[this._vertexIndex++]=T,S[this._vertexIndex++]=C,S[this._vertexIndex++]=e,S[this._vertexIndex++]=i,S[this._vertexIndex++]=c,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=r.r/255,S[this._vertexIndex++]=r.g/255,S[this._vertexIndex++]=r.b/255,S[this._vertexIndex++]=r.a,S[this._vertexIndex++]=o,S[this._vertexIndex++]=g.x,S[this._vertexIndex++]=g.y,S[this._vertexIndex++]=T,S[this._vertexIndex++]=A,S[this._vertexIndex++]=e,S[this._vertexIndex++]=i,S[this._vertexIndex++]=c,S[this._vertexIndex++]=s.r/255,S[this._vertexIndex++]=s.g/255,S[this._vertexIndex++]=s.b/255,S[this._vertexIndex++]=s.a,S[this._vertexIndex++]=r.r/255,S[this._vertexIndex++]=r.g/255,S[this._vertexIndex++]=r.b/255,S[this._vertexIndex++]=r.a,S[this._vertexIndex++]=o}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),ce.DrawnImagesCount+=this._rectangleCount,ce.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const $k=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,jk=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class qk{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ei({gl:t,fragmentSource:$k,vertexSource:jk}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new qs({gl:t,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ml(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,s=$.Transparent,r=0){this._isFull()&&this.flush(),this._circleCount++;const o=this._context.getTransform(),l=this._context.opacity,c=this._context.snapToPixel,d=o.multiply(t.add(D(-e,-e))),_=o.multiply(t.add(D(e,-e))),f=o.multiply(t.add(D(e,e))),g=o.multiply(t.add(D(-e,e)));c&&(d.x=~~(d.x+Mt),d.y=~~(d.y+Mt),_.x=~~(_.x+Mt),_.y=~~(_.y+Mt),g.x=~~(g.x+Mt),g.y=~~(g.y+Mt),f.x=~~(f.x+Mt),f.y=~~(f.y+Mt));const m=0,x=0,C=1,T=1,A=this._layout.vertexBuffer.bufferData;A[this._vertexIndex++]=d.x,A[this._vertexIndex++]=d.y,A[this._vertexIndex++]=m,A[this._vertexIndex++]=x,A[this._vertexIndex++]=l,A[this._vertexIndex++]=i.r/255,A[this._vertexIndex++]=i.g/255,A[this._vertexIndex++]=i.b/255,A[this._vertexIndex++]=i.a,A[this._vertexIndex++]=s.r/255,A[this._vertexIndex++]=s.g/255,A[this._vertexIndex++]=s.b/255,A[this._vertexIndex++]=s.a,A[this._vertexIndex++]=r/e,A[this._vertexIndex++]=g.x,A[this._vertexIndex++]=g.y,A[this._vertexIndex++]=m,A[this._vertexIndex++]=T,A[this._vertexIndex++]=l,A[this._vertexIndex++]=i.r/255,A[this._vertexIndex++]=i.g/255,A[this._vertexIndex++]=i.b/255,A[this._vertexIndex++]=i.a,A[this._vertexIndex++]=s.r/255,A[this._vertexIndex++]=s.g/255,A[this._vertexIndex++]=s.b/255,A[this._vertexIndex++]=s.a,A[this._vertexIndex++]=r/e,A[this._vertexIndex++]=_.x,A[this._vertexIndex++]=_.y,A[this._vertexIndex++]=C,A[this._vertexIndex++]=x,A[this._vertexIndex++]=l,A[this._vertexIndex++]=i.r/255,A[this._vertexIndex++]=i.g/255,A[this._vertexIndex++]=i.b/255,A[this._vertexIndex++]=i.a,A[this._vertexIndex++]=s.r/255,A[this._vertexIndex++]=s.g/255,A[this._vertexIndex++]=s.b/255,A[this._vertexIndex++]=s.a,A[this._vertexIndex++]=r/e,A[this._vertexIndex++]=f.x,A[this._vertexIndex++]=f.y,A[this._vertexIndex++]=C,A[this._vertexIndex++]=T,A[this._vertexIndex++]=l,A[this._vertexIndex++]=i.r/255,A[this._vertexIndex++]=i.g/255,A[this._vertexIndex++]=i.b/255,A[this._vertexIndex++]=i.a,A[this._vertexIndex++]=s.r/255,A[this._vertexIndex++]=s.g/255,A[this._vertexIndex++]=s.b/255,A[this._vertexIndex++]=s.a,A[this._vertexIndex++]=r/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),ce.DrawnImagesCount+=this._circleCount,ce.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class vc{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=lt.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler?this.recycler(this.objects[this.index++]):this.objects[this.index++]:(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const e of t){const i=this.objects.indexOf(e);this.objects[i]=this.builder(),this.totalAllocations++}return t}}class Vk{constructor(){this.z=0,this.priority=0,this.renderer="",this.transform=Fe.identity(),this.state={z:0,opacity:1,tint:$.White,material:null},this.args=new Array(10)}}const Xk=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Pw{constructor(t){this._logger=lt.getInstance(),this._color=$.Transparent,this._initialized=!1,this._images=new Map,this._textures=new Map;const{color:e,name:i,vertexSource:s,fragmentSource:r,graphicsContext:o,images:l}=t;if(this._name=i??"anonymous material",this._vertexSource=s??Xk,this._fragmentSource=r,this._color=e??this._color,!o)throw Error(`Material ${i} must be provided an excalibur webgl graphics context`);if(o instanceof xn?(this._graphicsContext=o,this._initialize(o)):this._logger.warn(`Material ${i} was created in 2D Canvas mode, currently only WebGL is supported`),l)for(const c in l)this.addImageSource(c,l[c])}_initialize(t){if(this._initialized)return;const e=t.__gl;this._maxTextureSlots=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)-2,this._shader=t.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0}get color(){return this._color}set color(t){this._color=t}get name(){var t;return(t=this._name)!==null&&t!==void 0?t:"anonymous material"}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,e){this._images.size<this._maxTextureSlots?this._images.set(t,e):this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const e=this._images.get(t);this._graphicsContext.textureLoader.delete(e.image),this._images.delete(t)}_loadImageSource(t){const e=t.image,i=e.getAttribute(qt.Filtering),s=i?Wo(i):void 0,r=Ps(e.getAttribute(qt.WrappingX)),o=Ps(e.getAttribute(qt.WrappingY)),l=e.getAttribute("forceUpload")==="true",c=this._graphicsContext.textureLoader.load(e,{filtering:s,wrapping:{x:r,y:o}},l);return e.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,c),c}uploadAndBind(t,e=2){let i=e;for(const[s,r]of this._images.entries()){if(!r.isLoaded()){this._logger.warnOnce(`Image named ${s} in material ${this.name} not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const o=this._loadImageSource(r);t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,o),this._shader.trySetUniformInt(s,i),i++}}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class zm{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,e){this._gl=t,this._context=e,this._buffer=new qs({gl:t,size:6*4,type:"dynamic"}),this._layout=new In({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new ml(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,e,i,s,r,o,l,c,d){var _,f,g,m;const x=this._gl,C=this._context.material;if(!C)return;const T=this._context.getTransform(),A=this._context.opacity,S=C.getShader(),E=this._layout.vertexBuffer.bufferData;let M=0,O=(t==null?void 0:t.width)||s||0,N=(t==null?void 0:t.height)||r||0,F=[0,0,(_=s??(t==null?void 0:t.width))!==null&&_!==void 0?_:0,(f=r??(t==null?void 0:t.height))!==null&&f!==void 0?f:0],K=[e??1,i??1];o!==void 0&&l!==void 0&&c!==void 0&&d!==void 0&&(F=[e??1,i??1,(g=s??(t==null?void 0:t.width))!==null&&g!==void 0?g:0,(m=r??(t==null?void 0:t.height))!==null&&m!==void 0?m:0],K=[o,l],O=c,N=d),e=F[0],i=F[1];const nt=F[2],pt=F[3],ht=D(K[0],K[1]),ct=D(K[0]+O,K[1]),bt=D(K[0],K[1]+N),wt=D(K[0]+O,K[1]+N),Ct=t.width||O,dt=t.height||N,G=e/Ct,kt=i/dt,Ht=(e+nt-.01)/Ct,At=(i+pt-.01)/dt,Dt=T.getPosition(),me=Dt.add(wt),ke=Dt.x/this._context.width,Se=Dt.y/this._context.height,Vt=me.x/this._context.width,Ie=me.y/this._context.height;E[M++]=ht.x,E[M++]=ht.y,E[M++]=G,E[M++]=kt,E[M++]=ke,E[M++]=Se,E[M++]=bt.x,E[M++]=bt.y,E[M++]=G,E[M++]=At,E[M++]=ke,E[M++]=Ie,E[M++]=ct.x,E[M++]=ct.y,E[M++]=Ht,E[M++]=kt,E[M++]=Vt,E[M++]=Se,E[M++]=wt.x,E[M++]=wt.y,E[M++]=Ht,E[M++]=At,E[M++]=Vt,E[M++]=Ie;const Je=this._addImageAsTexture(t);C.use(),this._layout.shader=S,this._layout.use(!0),S.trySetUniformFloat("u_time_ms",performance.now()),S.trySetUniformFloat("u_opacity",A),S.trySetUniformFloatVector("u_resolution",D(this._context.width,this._context.height)),S.trySetUniformFloatVector("u_graphic_resolution",D(Ct,dt)),S.trySetUniformFloatVector("u_size",D(nt,pt)),S.trySetUniformMatrix("u_matrix",this._context.ortho),S.trySetUniformMatrix("u_transform",T.to4x4()),x.activeTexture(x.TEXTURE0+0),x.bindTexture(x.TEXTURE_2D,Je),S.trySetUniformInt("u_graphic",0),x.activeTexture(x.TEXTURE0+1),x.bindTexture(x.TEXTURE_2D,this._context.materialScreenTexture),S.trySetUniformInt("u_screen_texture",1),C.uploadAndBind(x),this._quads.bind(),x.drawElements(x.TRIANGLES,6,this._quads.bufferGlType,0),ce.DrawnImagesCount++,ce.DrawCallCount++}_addImageAsTexture(t){const e=t.getAttribute(qt.Filtering),i=e?Wo(e):void 0,s=Ps(t.getAttribute(qt.WrappingX)),r=Ps(t.getAttribute(qt.WrappingY)),o=t.getAttribute("forceUpload")==="true",l=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);return t.removeAttribute("forceUpload"),this._textures.indexOf(l)===-1&&this._textures.push(l),l}hasPendingDraws(){return!1}flush(){}}const Zk=`#version 300 es\r
precision mediump float;\r
\r
uniform float deltaMs;\r
uniform float maxLifeMs;\r
uniform vec2 gravity;\r
uniform vec2 focus;\r
uniform float focusAccel;\r
uniform mat4 u_matrix;\r
uniform mat4 u_transform;\r
uniform float startSize;\r
uniform float endSize;\r
// uniform sampler2D obstacle;\r
\r
layout(location=0)in vec2 position;\r
layout(location=1)in vec2 velocity;\r
layout(location=2)in float rotation;\r
layout(location=3)in float angularVelocity;\r
layout(location=4)in float lifeMs;\r
\r
// TODO z index to handle buffer wrapping?\r
\r
// DO NOT RE-ORDER\r
out vec2 finalPosition;\r
out vec2 finalVelocity;\r
out float finalRotation;\r
out float finalAngularVelocity;\r
out float finalLifeMs;\r
void main(){\r
  // Evolve particle\r
  float seconds = deltaMs / 1000.;\r
  // euler integration\r
  // Weird artifact of re-using the same buffer layout for update/draw\r
  // we need differently named variables\r
  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\r
  finalVelocity = velocity + finalGravity * seconds;\r
  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\r
  finalRotation = rotation + angularVelocity * seconds;\r
  finalAngularVelocity = angularVelocity;\r
  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\r
\r
  // Collision mask sampling\r
  // vec2 samplePoint = finalPosition / vec2(width, height);\r
  // vec4 collides = texture(obstacle, samplePoint);\r
  // if (distance(collides,vec4(0.)) > .01) {\r
  //   // non opaque means we collide! recalc final pos/vel\r
  //   vec2 newVelocity = velocity * -.1;// lose energy\r
  //   finalVelocity = newVelocity + gravity * seconds;\r
  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\r
  // }\r
\r
  float lifePercent = finalLifeMs / maxLifeMs;\r
  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\r
  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);\r
  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\r
  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;\r
}`,Yk=`#version 300 es\r
precision mediump float;\r
\r
uniform sampler2D graphic;\r
uniform bool useTexture;\r
uniform float maxLifeMs;\r
\r
uniform vec4 beginColor;\r
uniform vec4 endColor;\r
uniform bool fade;\r
uniform float startOpacity;\r
\r
in float finalRotation;\r
in float finalLifeMs;\r
out vec4 fragColor;\r
\r
void main(){\r
\r
  float lifePct = finalLifeMs / maxLifeMs;\r
\r
  if (useTexture) {\r
    /** Draw texture */\r
    if (lifePct <= 0.) discard;\r
    float mid = .5;\r
    float cosine = cos(finalRotation);\r
    float sine = sin(finalRotation);\r
    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\r
                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\r
    vec4 color = texture(graphic, rotated);\r
    fragColor = color * (fade ? lifePct : 1.0);\r
  } else {\r
    /** Draw circle */\r
    if (lifePct <= 0.) discard;\r
    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\r
    float dist = 1.0 - length(uv);\r
    float edge = fwidth(dot(uv, uv));\r
    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\r
    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);\r
    fragColor.rgb = color;\r
    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);\r
    fragColor.rgb *= fragColor.a;\r
  }\r
}`;var Ke;(function(n){n.World="world",n.Screen="screen"})(Ke||(Ke={}));class Uu extends I{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class qn extends I{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){t!==this._x&&(this.change(t,this._y),this._x=this.original.x=t)}get y(){return this._y=this.original.y}set y(t){t!==this._y&&(this.change(this._x,t),this._y=this.original.y=t)}setTo(t,e){this.x=t,this.y=e}}class Sn{constructor(){this._parent=null,this._children=[],this._pos=new qn(D(0,0),()=>{this.flagDirty()}),this._globalPos=new Uu({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(D(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(D(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}}),this._rotation=0,this._scale=new qn(D(1,1),()=>{this.flagDirty()}),this._globalScale=new Uu({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}}),this._z=0,this._isDirty=!1,this._isInverseDirty=!1,this._matrix=Fe.identity(),this._inverse=Fe.identity(),this._scratch=Fe.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){this._pos.x=t.x,this._pos.y=t.y}get pos(){return this._pos}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return this._globalPos}set rotation(t){const e=wn(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const i=wn(t+e);i!==this._rotation&&this.flagDirty(),this._rotation=i}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){this._scale.x=t.x,this._scale.y=t.y}get scale(){return this._scale}set globalScale(t){let e=D(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(D(1/e.x,1/e.y))}get globalScale(){return this._globalScale}set z(t){this._z=t,this.flagDirty()}get z(){return this._z}set globalZ(t){this.parent?this.z=t-this.parent.globalZ:this.z=t}get globalZ(){return this.parent?this.z+this.parent.globalZ:this.z}get matrix(){return this._isDirty&&(this.parent===null?this._calculateMatrix().clone(this._matrix):this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this.matrix.inverse(this._inverse),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return this._scratch.data[0]=Math.cos(this._rotation),this._scratch.data[1]=Math.sin(this._rotation),this._scratch.data[2]=-Math.sin(this._rotation),this._scratch.data[3]=Math.cos(this.rotation),this._scratch.data[4]=this._pos.x,this._scratch.data[5]=this._pos.y,this._scratch.scale(this._scale.x,this._scale.y),this._scratch}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,i){this._pos.x=t.x,this._pos.y=t.y,this._rotation=wn(e),this._scale.x=i.x,this._scale.y=i.y,this.flagDirty()}isMirrored(){const t=ne(this.scale.x)>>>31,e=ne(this.scale.y)>>>31;return!!(t^e)}clone(t){const e=t??new Sn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty(),e}cloneWithParent(t){const e=t??new Sn;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.parent=this.parent,e.flagDirty(),e}toString(){return this.matrix.toString()}}function kw(n){return!!n&&!!n.prototype&&!!n.prototype.constructor}function Qk(n){return!!(n!=null&&n.clone)}class hs{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const i=this[e];Qk(i)&&e!=="owner"&&e!=="clone"?t[e]=i.clone():t[e]=i}return t}}class pi{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let s=0;s<e;s++)this.observers[s].notify(t);const i=this.subscriptions.length;for(let s=0;s<i;s++)this.subscriptions[s](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class J extends hs{constructor(){super(...arguments),this._logger=lt.getInstance(),this._parentComponent=null,this._transform=new Sn,this._addChildTransform=t=>{const e=t.get(J);e&&(e._transform.parent=this._transform,e._parentComponent=this)},this.zIndexChanged$=new pi,this._coordPlane=Ke.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const i=e.get(J);i&&(i._transform.parent=null,i._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._transform.z}set z(t){const e=this._transform.z;this._transform.z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get globalZ(){return this._transform.globalZ}set globalZ(t){this._transform.globalZ=t}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var e;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(e=this.owner)===null||e===void 0?void 0:e.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new J;return t._transform=this._transform.clone(),t}}var Ba;(function(n){n.Forward="forward",n.Backward="backward"})(Ba||(Ba={}));var gs;(function(n){n.End="end",n.Loop="loop",n.PingPong="pingpong",n.Freeze="freeze"})(gs||(gs={}));const Kk={Frame:"frame",Loop:"loop",End:"end"};class vs extends Ce{constructor(t){var e,i,s;super(t),this.events=new de,this.frames=[],this.strategy=gs.Loop,this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._reversed=!1,this.frames=t.frames,this.speed=(e=t.speed)!==null&&e!==void 0?e:this.speed,this.strategy=(i=t.strategy)!==null&&i!==void 0?i:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(s=t.frameDuration)!==null&&s!==void 0?s:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new vs({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,s=gs.Loop){const r=t.sprites.length-1,o=e.filter(l=>l<0||l>r);return o.length&&vs._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${o.join(",")} no frame will be shown`),new vs({frames:t.sprites.filter((l,c)=>e.indexOf(c)>-1).map(l=>({graphic:l,duration:i})),strategy:s})}static fromSpriteSheetCoordinates(t){var e;const{spriteSheet:i,frameCoordinates:s,durationPerFrame:r,durationPerFrameMs:o,speed:l,strategy:c,reverse:d}=t,_=(e=r??o)!==null&&e!==void 0?e:100,f=[];for(const g of s){const{x:m,y:x,duration:C,options:T}=g,A=i.getSprite(m,x,T);A?f.push({graphic:A,duration:C??_}):vs._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${m}, ${x}), please check your SpriteSheet to confirm that sprite exists`)}return new vs({frames:f,strategy:c,speed:l,reverse:d})}get speed(){return this._speed}set speed(t){this._speed=Ut(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}get isReversed(){return this._reversed}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?Ba.Backward:Ba.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=(t==null?void 0:t.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case gs.End:case gs.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t,e){this._currentFrame=t,this._timeLeftInFrame=e??this.frameDuration;const i=this.frames[this._currentFrame];i&&!this._done&&(this._timeLeftInFrame=e??((i==null?void 0:i.duration)||this.frameDuration),this.events.emit("frame",{...i,frameIndex:this.currentFrameIndex}))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case gs.Loop:{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case gs.End:{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case gs.Freeze:{e=Ut(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case gs.PingPong:{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),e=t+this._pingPongDirection%this.frames.length;break}}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic&&this.currentFrame.graphic.draw(t,e,i)}}vs._LOGGER=lt.getInstance();class So extends Ce{constructor(t){var e;super(t),this._logger=lt.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(e=t.useAnchor)!==null&&e!==void 0?e:this.useAnchor,this._updateDimensions()}clone(){return new So({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){const t=new at;for(const e of this.members)if(e instanceof Ce)e.localBounds.combine(t,t);else{const{graphic:i,offset:s,useBounds:r}=e;i?(r===void 0?!0:r)&&i.localBounds.translate(s).combine(t,t):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(e)}.`)}return t}_isAnimationOrGroup(t){return t instanceof vs||t instanceof So}tick(t,e){for(const i of this.members){let s;i instanceof Ce?s=i:s=i.graphic,this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){let e;t instanceof Ce?e=t:e=t.graphic,this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,this.useAnchor?e:0,this.useAnchor?i:0)}_drawImage(t,e,i){const s=I.Zero;for(const r of this.members){let o;r instanceof Ce?o=r:(o=r.graphic,r.offset.clone(s)),o&&(t.save(),t.translate(e,i),o.draw(t,s.x,s.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}class No extends Ce{constructor(t){var e,i,s,r,o,l,c,d,_,f;super(bw({...t},["width","height"])),this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=ws($.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this.color=(i=t.color)!==null&&i!==void 0?i:$.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(s=t.smoothing)!==null&&s!==void 0?s:this.smoothing,this.lineWidth=(r=t.lineWidth)!==null&&r!==void 0?r:this.lineWidth,this.lineDash=(o=t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineCap=(l=t.lineCap)!==null&&l!==void 0?l:this.lineCap,this.padding=(c=t.padding)!==null&&c!==void 0?c:this.padding,this.filtering=(d=t.filtering)!==null&&d!==void 0?d:this.filtering),this._bitmap=document.createElement("canvas");const g=(_=t==null?void 0:t.width)!==null&&_!==void 0?_:this._bitmap.width,m=(f=t==null?void 0:t.height)!==null&&f!==void 0?f:this._bitmap.height;this.width=g,this.height=m;const x=this._bitmap.getContext("2d");if(x)this._ctx=x;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():void 0,strokeColor:this.strokeColor?this.strokeColor.clone():void 0,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return at.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,I.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=ws(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),t&&(this._strokeColor=ws(t,()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var e,i,s,r;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(s=(i=this.strokeColor)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:"",t.fillStyle=(r=this.color)===null||r===void 0?void 0:r.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,i)}}var Fh;(function(n){n.Em="em",n.Rem="rem",n.Px="px",n.Pt="pt",n.Percent="%"})(Fh||(Fh={}));var Bh;(function(n){n.Left="left",n.Right="right",n.Center="center",n.Start="start",n.End="end"})(Bh||(Bh={}));var Oh;(function(n){n.Top="top",n.Hanging="hanging",n.Middle="middle",n.Alphabetic="alphabetic",n.Ideographic="ideographic",n.Bottom="bottom"})(Oh||(Oh={}));var Uh;(function(n){n.Normal="normal",n.Italic="italic",n.Oblique="oblique"})(Uh||(Uh={}));var zh;(function(n){n.LeftToRight="ltr",n.RightToLeft="rtl"})(zh||(zh={}));function zu(n,t=$.Red,e,i,s,r,o=1,l="butt"){n.save(),n.beginPath(),n.lineWidth=o,n.lineCap=l,n.strokeStyle=t.toString(),n.moveTo(e,i),n.lineTo(s,r),n.closePath(),n.stroke(),n.restore()}function Jk(n,t=$.Red,e){n.beginPath(),n.strokeStyle=t.toString(),n.arc(e.x,e.y,5,0,Math.PI*2),n.closePath(),n.stroke()}function tI(n,t,e,i,s=1){const r=t?t.toString():"blue",o=i.scale(s);n.beginPath(),n.strokeStyle=r,n.moveTo(e.x,e.y),n.lineTo(e.x+o.x,e.y+o.y),n.closePath(),n.stroke()}function Hu(n,t,e,i,s,r=5,o=$.White,l=null){let c;if(typeof r=="number")c={tl:r,tr:r,br:r,bl:r};else{const d={tl:0,tr:0,br:0,bl:0};for(const _ in d)if(d.hasOwnProperty(_)){const f=_;c[f]=r[f]||d[f]}}n.beginPath(),n.moveTo(t+c.tl,e),n.lineTo(t+i-c.tr,e),n.quadraticCurveTo(t+i,e,t+i,e+c.tr),n.lineTo(t+i,e+s-c.br),n.quadraticCurveTo(t+i,e+s,t+i-c.br,e+s),n.lineTo(t+c.bl,e+s),n.quadraticCurveTo(t,e+s,t,e+s-c.bl),n.lineTo(t,e+c.tl),n.quadraticCurveTo(t,e,t+c.tl,e),n.closePath(),l&&(n.fillStyle=l.toString(),n.fill()),o&&(n.strokeStyle=o.toString(),n.stroke())}function eI(n,t,e,i,s=$.White,r=null){n.beginPath(),n.arc(t,e,i,0,Math.PI*2),n.closePath(),r&&(n.fillStyle=r.toString(),n.fill()),s&&(n.strokeStyle=s.toString(),n.stroke())}class _o{constructor(t,e,i,s){this.font=t,this.text=e,this.color=i,this.maxWidth=s,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas");const r=this.canvas.getContext("2d");if(!r)throw new Error("Unable to create FontTextInstance, internal canvas failed to create");this.ctx=r,this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let i=null;e!=null?i=this._getLinesFromText(t,e):i=t.split(`
`);const s=i.reduce((g,m)=>g.length>m.length?g:m);this._applyFont(this.ctx);const r=this.ctx.measureText(s);let o=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);const l=o*i.length;o=l;const c=l-Math.abs(r.actualBoundingBoxAscent),d=0,_=0;return new at({left:d-Math.abs(r.actualBoundingBoxLeft)-this.font.padding,top:_-Math.abs(r.actualBoundingBoxAscent)-this.font.padding,bottom:_+c+this.font.padding,right:d+Math.abs(r.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){let i=1;this.font.lineHeight&&(i=this.font.lineHeight/this.font.size),e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*i}static getHashCode(t,e,i){var s;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((s=t.strokeColor)===null||s===void 0?void 0:s.toString())+(i?i.toString():t.color.toString()))}getHashCode(t=!0){return _o.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,i,s;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.strokeStyle=(s=(i=this.font.strokeColor)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:"",t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(this.font.shadow.color&&(t.shadowColor=this.font.shadow.color.toString()),this.font.shadow.blur&&(t.shadowBlur=this.font.shadow.blur),this.font.shadow.offset&&(t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y))}_drawText(t,e,i){this._applyRasterProperties(t),this._applyFont(t);for(let s=0;s<e.length;s++){const r=e[s];this.color&&t.fillText(r,0,s*i),this.font.strokeColor&&t.strokeText(r,0,s*i)}this.font.showDebug&&(zu(t,$.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),zu(t,$.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let i=0,s=0;const r=Math.min(4096,t.canvas.width),o=Math.min(4096,t.canvas.height);for(;i<t.canvas.width;){for(;s<t.canvas.height;){const l=document.createElement("canvas");l.width=r,l.height=o;const c=l.getContext("2d");if(!c)throw new Error("Unable to split internal FontTextInstance bitmap, failed to create internal canvas");c.drawImage(t.canvas,i,s,r,o,0,0,r,o),e.push({x:i,y:s,canvas:l}),s+=o}i+=r,s=0}return e}flagDirty(){this._dirty=!0}render(t,e,i,s){var r;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const o=this.getHashCode();if(this._lastHashCode!==o&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,s),this._setDimension(this.dimensions,this.ctx);const l=this._getLinesFromText(this.text,s),c=(r=this.font.lineHeight)!==null&&r!==void 0?r:this.dimensions.height/l.length;if(this._drawText(this.ctx,l,c),t instanceof xn)for(const d of this._textFragments)t.textureLoader.delete(d.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof xn)for(const d of this._textFragments)t.textureLoader.load(d.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=o,this._dirty=!1}for(const l of this._textFragments)t.drawImage(l.canvas,0,0,l.canvas.width,l.canvas.height,l.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,l.y/this.font.quality+i-this.ctx.canvas.height/this.font.quality/2,l.canvas.width/this.font.quality,l.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof xn)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){var i;if(this._cachedText===t&&this._cachedRenderWidth===e&&(!((i=this._cachedLines)===null||i===void 0)&&i.length))return this._cachedLines;const s=t.split(`
`);if(e==null)return s;for(let r=0;r<s.length;r++){let o=s[r],l="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)l=o[o.length-1]+l,o=o.slice(0,-1);s[r]=o,s[r+1]=l}}return this._cachedText=t,this._cachedLines=s,this._cachedRenderWidth=e,s}}class Qt{static measureText(t,e,i){const s=_o.getHashCode(e,t);if(Qt._MEASURE_CACHE.has(s))return Qt._MEASURE_CACHE.get(s);Qt._LOGGER.debug("Font text measurement cache miss");const r=e.measureTextWithoutCache(t,i);return Qt._MEASURE_CACHE.set(s,r),r}static getTextInstance(t,e,i){const s=_o.getHashCode(e,t,i);let r=Qt._TEXT_CACHE.get(s);return r||(r=new _o(e,t,i),Qt._TEXT_CACHE.set(s,r),Qt._LOGGER.debug("Font text instance cache miss")),Qt._TEXT_USAGE.set(r,performance.now()),r}static checkAndClearCache(){const t=[],e=new Set;for(const[s,r]of Qt._TEXT_USAGE.entries())if(r+Qt.FONT_TIMEOUT<performance.now())Qt._LOGGER.debug(`Text cache entry timed out ${s.text}`),t.push(s),s.dispose();else{const o=s.getHashCode(!1);e.add(o)}t.forEach(s=>{Qt._TEXT_USAGE.delete(s)}),this._TEXT_CACHE.clear();for(const[s]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(s.getHashCode(),s);const i=new Map;for(const s of e)Qt._MEASURE_CACHE.has(s)&&i.set(s,Qt._MEASURE_CACHE.get(s));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=i}static get cacheSize(){return Qt._TEXT_USAGE.size}static clearCache(){for(const[t]of Qt._TEXT_USAGE.entries())t.dispose();Qt._TEXT_USAGE.clear(),Qt._TEXT_CACHE.clear(),Qt._MEASURE_CACHE.clear()}}Qt.FONT_TIMEOUT=500;Qt._LOGGER=lt.getInstance();Qt._TEXT_USAGE=new Map;Qt._TEXT_CACHE=new Map;Qt._MEASURE_CACHE=new Map;class Ir extends Ce{constructor(t={}){var e,i,s,r,o,l,c,d,_,f,g,m,x,C,T,A,S,E,M,O;super(t),this.filtering=Oe.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=$.Black,this.family="sans-serif",this.style=Uh.Normal,this.bold=!1,this.unit=Fh.Px,this.textAlign=Bh.Left,this.baseAlign=Oh.Top,this.direction=zh.LeftToRight,this.lineHeight=void 0,this.size=10,this._textBounds=new at,this._textMeasurement=new _o(this,"",$.Black),this.smoothing=(e=t==null?void 0:t.smoothing)!==null&&e!==void 0?e:this.smoothing,this.padding=(i=t==null?void 0:t.padding)!==null&&i!==void 0?i:this.padding,this.color=(s=t==null?void 0:t.color)!==null&&s!==void 0?s:this.color,this.strokeColor=(r=t==null?void 0:t.strokeColor)!==null&&r!==void 0?r:this.strokeColor,this.lineDash=(o=t==null?void 0:t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineWidth=(l=t==null?void 0:t.lineWidth)!==null&&l!==void 0?l:this.lineWidth,this.filtering=(c=t==null?void 0:t.filtering)!==null&&c!==void 0?c:this.filtering,this.family=(d=t==null?void 0:t.family)!==null&&d!==void 0?d:this.family,this.style=(_=t==null?void 0:t.style)!==null&&_!==void 0?_:this.style,this.bold=(f=t==null?void 0:t.bold)!==null&&f!==void 0?f:this.bold,this.size=(g=t==null?void 0:t.size)!==null&&g!==void 0?g:this.size,this.unit=(m=t==null?void 0:t.unit)!==null&&m!==void 0?m:this.unit,this.textAlign=(x=t==null?void 0:t.textAlign)!==null&&x!==void 0?x:this.textAlign,this.baseAlign=(C=t==null?void 0:t.baseAlign)!==null&&C!==void 0?C:this.baseAlign,this.direction=(T=t==null?void 0:t.direction)!==null&&T!==void 0?T:this.direction,this.lineHeight=(A=t==null?void 0:t.lineHeight)!==null&&A!==void 0?A:this.lineHeight,this.quality=(S=t==null?void 0:t.quality)!==null&&S!==void 0?S:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(E=t.shadow.blur)!==null&&E!==void 0?E:this.shadow.blur,this.shadow.offset=(M=t.shadow.offset)!==null&&M!==void 0?M:this.shadow.offset,this.shadow.color=(O=t.shadow.color)!==null&&O!==void 0?O:this.shadow.color)}clone(){return new Ir({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:void 0})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=(e=this.origin)!==null&&e!==void 0?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return Qt.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,i,s,r,o){const l=Qt.getTextInstance(e,this,i);this._textBounds=l.dimensions,this._preDraw(t,s,r),l.render(t,s,r,o),this._postDraw(t)}}class vl extends Ce{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!==null&&e!==void 0?e:new Ir,this.color=(i=t.color)!==null&&i!==void 0?i:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new vl({text:this.text.slice(),color:(e=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:$.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,e,i){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,e,i)}_drawImage(t,e,i){var s;let r=$.Black;this.font instanceof Ir&&(r=(s=this.color)!==null&&s!==void 0?s:this.font.color);const{width:o,height:l}=this.font.measureText(this._text,this.maxWidth);this._textWidth=o,this._textHeight=l,this.font.render(t,this._text,r,e,i,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-o,i-l,o*2,l*2),this.maxWidth!=null&&t.debug.drawRect(e,i,this.maxWidth,this.height,{color:$.Yellow}))}}function L_(n){return!!n.tick}class Ae extends hs{get visible(){return this.isVisible}set visible(t){this.isVisible=t}get offset(){return this._offset}set offset(t){this._offset=new qn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get anchor(){return this._anchor}set anchor(t){this._anchor=new qn(t,()=>this.recalculateBounds()),this.recalculateBounds()}get color(){return this._color}set color(t){if(t){this._color=t.clone();const e=this.graphics.current;(e instanceof No||e instanceof vl)&&(e.color=this._color)}}constructor(t){super(),this._logger=lt.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.isVisible=!0,this.forceOnScreen=!1,this.opacity=1,this._offset=new qn(I.Zero,()=>this.recalculateBounds()),this._anchor=new qn(I.Half,()=>this.recalculateBounds()),this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,t={visible:this.isVisible,graphics:{},...t};const{current:e,anchor:i,color:s,opacity:r,visible:o,graphics:l,offset:c,copyGraphics:d,onPreDraw:_,onPostDraw:f,onPreTransformDraw:g,onPostTransformDraw:m}=t;for(const[x,C]of Object.entries(l))C instanceof Ce?this._graphics[x]=C:(this._graphics[x]=C.graphic,this._options[x]=C.options);this.offset=c??this.offset,this.opacity=r??this.opacity,this.anchor=i??this.anchor,this.color=s??this.color,this.copyGraphics=d??this.copyGraphics,this.onPreDraw=_??this.onPreDraw,this.onPostDraw=f??this.onPostDraw,this.onPreDraw=g??this.onPreTransformDraw,this.onPostTransformDraw=m??this.onPostTransformDraw,this.isVisible=!!o,this._current=e??this._current,e&&this._graphics[e]&&this.use(e)}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,e,i){let s="default",r=null,o;if(typeof t=="string"&&e instanceof Ce&&(s=t,r=e,o=i),t instanceof Ce&&!(e instanceof Ce)&&(r=t,o=e),!r)throw new Error("Need to provide a graphic or valid graphic string");return this._graphics[s]=this.copyGraphics?r.clone():r,this._options[s]=this.copyGraphics?{...o}:o,s==="default"&&this.use("default"),r}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}use(t,e){var i;if(t instanceof Ce){let s=t;this.copyGraphics&&(s=t.clone()),this._current="default",this._graphics[this._current]=s,this._options[this._current]=e}else this._current=t,this._options[this._current]=e,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(i=this.owner)===null||i===void 0?void 0:i.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new at;const e=this._graphics[this._current],i=this._options[this._current];if(!e){this._localBounds=t;return}let s=this.anchor,r=this.offset;i!=null&&i.anchor&&(s=i.anchor),i!=null&&i.offset&&(r=i.offset);const o=e.localBounds,l=-o.width*s.x+r.x,c=-o.height*s.y+r.y;e instanceof So&&!e.useAnchor?t=e==null?void 0:e.localBounds.combine(t):t=e==null?void 0:e.localBounds.translate(D(l,c)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const e=this.owner.get(J);e&&(t=t.transform(e.get().matrix))}return t}update(t,e=0){const i=this.current;i&&L_(i)&&i.tick(t,e)}clone(){const t=new Ae;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),this.color&&(t.color=this.color.clone()),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.isVisible=this.isVisible,t}}var Hh;(function(n){n.Kill="kill",n.PreKill="prekill",n.PostKill="postkill",n.PreDraw="predraw",n.PostDraw="postdraw",n.PreDebugDraw="predebugdraw",n.PostDebugDraw="postdebugdraw",n.PreUpdate="preupdate",n.PostUpdate="postupdate",n.PreFrame="preframe",n.PostFrame="postframe",n.PreCollision="precollision",n.CollisionStart="collisionstart",n.CollisionEnd="collisionend",n.PostCollision="postcollision",n.Initialize="initialize",n.Activate="activate",n.Deactivate="deactivate",n.ExitViewport="exitviewport",n.EnterViewport="enterviewport",n.ExitTrigger="exit",n.EnterTrigger="enter",n.Connect="connect",n.Disconnect="disconnect",n.Button="button",n.Axis="axis",n.Visible="visible",n.Hidden="hidden",n.Start="start",n.Stop="stop",n.PointerUp="pointerup",n.PointerDown="pointerdown",n.PointerMove="pointermove",n.PointerEnter="pointerenter",n.PointerLeave="pointerleave",n.PointerCancel="pointercancel",n.PointerWheel="pointerwheel",n.Up="up",n.Down="down",n.Move="move",n.Enter="enter",n.Leave="leave",n.Cancel="cancel",n.Wheel="wheel",n.Press="press",n.Release="release",n.Hold="hold",n.PointerDragStart="pointerdragstart",n.PointerDragEnd="pointerdragend",n.PointerDragEnter="pointerdragenter",n.PointerDragLeave="pointerdragleave",n.PointerDragMove="pointerdragmove",n.ActionStart="actionstart",n.ActionComplete="actioncomplete",n.Add="add",n.Remove="remove"})(Hh||(Hh={}));class Bt{constructor(){this.other=null,this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class wc extends Bt{constructor(t){super(),this.self=t,this.target=t}}class F_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class B_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class O_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class U_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class Go extends Bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class $o extends Bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class z_ extends Bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class H_ extends Bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class W_ extends Bt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class N_ extends Bt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class ir extends Bt{constructor(t,e,i){super(),this.engine=t,this.elapsed=e,this.self=i,this.target=i}}class sr extends Bt{constructor(t,e,i){super(),this.engine=t,this.elapsed=e,this.self=i,this.target=i}}class G_ extends Bt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class $_ extends Bt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class j_ extends Bt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class q_ extends Bt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class V_ extends Bt{constructor(t,e,i,s){super(),this.button=t,this.index=e,this.value=i,this.self=s,this.target=s}}class X_ extends Bt{constructor(t,e,i){super(),this.axis=t,this.value=e,this.self=i,this.target=i}}class Z_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class Y_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class Rr extends Bt{constructor(t,e,i,s,r){super(),this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}}class Mr extends Bt{constructor(t,e,i,s,r){super(),this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}}class Wh{constructor(t,e,i,s){this.self=t,this.other=e,this.side=i,this.contact=s}}class Nh{constructor(t,e,i,s){this.self=t,this.other=e,this.side=i,this.lastContact=s}}class Gh{constructor(t,e,i,s,r){this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class $h{constructor(t,e,i,s,r){this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class Oa extends Bt{constructor(t,e,i,s){super(),this.self=t,this.other=e,this.side=i,this.contact=s,this.target=t}}class Ua extends Bt{constructor(t,e,i,s){super(),this.self=t,this.other=e,this.side=i,this.lastContact=s,this.target=t}}class jo extends Bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class Q_ extends Bt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class K_ extends Bt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class J_ extends Bt{constructor(t){super(),this.self=t,this.target=t}}class tf extends Bt{constructor(t){super(),this.self=t,this.target=t}}class ef extends Bt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class sf extends Bt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class nf extends Bt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class rf extends Bt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class of extends Bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class af extends Bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class iI{constructor(t){this.data=t,this.type="Component Added"}}function sI(n){return!!n&&n.type==="Component Added"}class nI{constructor(t){this.data=t,this.type="Component Removed"}}function rI(n){return!!n&&n.type==="Component Removed"}const oI={Add:"add",Remove:"remove",Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate",Kill:"kill"};class oi{constructor(t,e){this.id=oi._ID++,this.name=`Entity#${this.id}`,this.events=new de,this._tags=new Set,this.componentAdded$=new pi,this.componentRemoved$=new pi,this.tagAdded$=new pi,this.tagRemoved$=new pi,this.components=new Map,this.componentValues=[],this._componentsToRemove=[],this.scene=null,this.isActive=!0,this._parent=null,this.childrenAdded$=new pi,this.childrenRemoved$=new pi,this._children=[],this._isInitialized=!1,this._isAdded=!1;let i,s;if(Array.isArray(t))i=t,s=e;else if(t&&typeof t=="object"){const{components:r,name:o,silenceWarnings:l}=t;i=r??[],s=o}if(s&&(this.name=s),i)for(const r of i)this.addComponent(r)}get active(){return this.isActive}set active(t){this.isActive=t}kill(){this.isActive&&(this.isActive=!1,this.unparent()),this.emit("kill",new wc(this))}isKilled(){return!this.isActive}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let e=0;e<t.length;e++)if(!this.components.has(t[e]))return!1;return!0}hasAllTags(t){for(let e=0;e<t.length;e++)if(!this.tags.has(t[e]))return!1;return!0}get(t){return this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(Ho(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();i&&(e=e.concat(i.children),t=t.concat(i.children))}return t}clone(){const t=new oi;for(const e of this.types){const i=this.get(e);i&&t.addComponent(i.clone())}for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const i of t.children)this.addChild(i.clone().addTemplate(i));return this}_getClassHierarchyRoot(t){var e,i;let s=t,r=(e=Object.getPrototypeOf(s.prototype))===null||e===void 0?void 0:e.constructor;for(;r&&r!==Object&&r!==hs;)s=r,r=(i=Object.getPrototypeOf(s.prototype))===null||i===void 0?void 0:i.constructor;return s}addComponent(t,e=!1){if(this.has(t.constructor))if(e)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const s of t.dependencies)this.addComponent(new s);t.owner=this;const i=this._getClassHierarchyRoot(t.constructor);return this.components.set(i,t),this.components.set(t.constructor,t),this.componentValues.push(t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,e=!1){let i;if(kw(t)?i=t:i=t.constructor,e){const s=this.components.get(i);if(s){this.componentRemoved$.notifyAll(s),s.owner=void 0,s.onRemove&&s.onRemove(this);const o=this.componentValues.indexOf(s);o>-1&&this.componentValues.splice(o,1)}const r=this._getClassHierarchyRoot(i);this.components.delete(r),this.components.delete(i)}else this._componentsToRemove.push(i);return this}clearComponents(){const t=this.types;for(const e of t)this.removeComponent(e)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}get isAdded(){return this._isAdded}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new jo(t,this)),this._isInitialized=!0)}_add(t){!this.isAdded&&this.isActive&&(this.onAdd(t),this.events.emit("add",new of(t,this)),this._isAdded=!0)}_remove(t){this.isAdded&&!this.isActive&&(this.onRemove(t),this.events.emit("remove",new af(t,this)),this._isAdded=!1)}_preupdate(t,e){this.events.emit("preupdate",new ir(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new sr(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onAdd(t){}onRemove(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e),this._remove(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}oi._ID=0;class Zt extends hs{constructor(){super(...arguments),this.vel=I.Zero,this.acc=I.Zero,this.scaleFactor=I.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class ui{static integrate(t,e,i,s){const r=s/1e3;e.vel.addEqual(i.scale(r,ui._ACC)),t.pos.add(e.vel.scale(r,ui._VEL),ui._POS).addEqual(i.scale(.5*r*r,ui._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*r;const o=t.rotation+e.angularVelocity*r;t.scale.add(e.scaleFactor.scale(r,this._SCALE_FACTOR),ui._SCALE),t.get().setTransform(ui._POS,o,ui._SCALE)}}ui._POS=new I(0,0);ui._SCALE=new I(1,1);ui._ACC=new I(0,0);ui._VEL=new I(0,0);ui._VEL_ACC=new I(0,0);ui._SCALE_FACTOR=new I(0,0);class xc extends oi{constructor(t){super({silenceWarnings:!0}),this.beginColor=$.White,this.endColor=$.White,this.life=300,this.fade=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=$.White,this.size=5,this.sizeRate=0,this.visible=!0,this.isOffscreen=!1,this.particleTransform=ks.Global,this.name=`Particle#${this.id}`,this.addComponent(this.transform=new J),this.addComponent(this.motion=new Zt),this.addComponent(this.graphics=new Ae),this.configure(t)}registerEmitter(t){if(this._emitter=t,this.particleTransform===ks.Global){const e=this._emitter.transform.globalPos;this.transform.pos=this.transform.pos.add(e),this.motion.vel=this.motion.vel.rotate(this._emitter.transform.globalRotation)}}configure(t){var e,i,s,r,o,l,c,d,_,f,g,m,x,C;this.particleTransform=(e=t.transform)!==null&&e!==void 0?e:this.particleTransform,this.life=(i=t.life)!==null&&i!==void 0?i:this.life,this.fade=(s=t.fade)!==null&&s!==void 0?s:this.fade,this.size=(r=t.size)!==null&&r!==void 0?r:this.size,this.endColor=(o=t.endColor)!==null&&o!==void 0?o:this.endColor.clone(),this.beginColor=(l=t.beginColor)!==null&&l!==void 0?l:this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.graphic=t.graphic,this.graphics.opacity=(c=t.opacity)!==null&&c!==void 0?c:this.graphics.opacity,this.transform.pos=(d=t.pos)!==null&&d!==void 0?d:this.transform.pos,this.transform.rotation=(_=t.rotation)!==null&&_!==void 0?_:0,this.transform.scale=D(1,1),this.motion.vel=(f=t.vel)!==null&&f!==void 0?f:this.motion.vel,this.motion.angularVelocity=(g=t.angularVelocity)!==null&&g!==void 0?g:0,this.motion.acc=(m=t.acc)!==null&&m!==void 0?m:this.motion.acc,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.graphics.opacity/this.life,this.startSize=(x=t.startSize)!==null&&x!==void 0?x:0,this.endSize=(C=t.endSize)!==null&&C!==void 0?C:0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.size=this.startSize),this.graphic?(this.graphics.use(this.graphic),this.graphics.onPostDraw=void 0):(this.graphics.localBounds=at.fromDimension(this.size,this.size,I.Half),this.graphics.onPostDraw=T=>{T.save(),T.debug.drawPoint(D(0,0),{color:this._currentColor,size:this.size}),T.restore()})}kill(){var t;!((t=this._emitter)===null||t===void 0)&&t.isActive?this._emitter.removeParticle(this):super.kill()}update(t,e){this.life=this.life-e,this.life<0&&this.kill(),this.fade&&(this.graphics.opacity=Ut(this._aRate*this.life,1e-4,1)),this.startSize&&this.endSize&&this.startSize>0&&this.endSize>0&&(this.size=Ut(this.sizeRate*e+this.size,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=Ut(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=Ut(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=Ut(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=this.graphics.opacity;let i=this.motion.acc;this.focus&&(i=this.focus.sub(this.transform.pos).normalize().scale(this.focusAccel||0).scale(e/1e3)),ui.integrate(this.transform,this.motion,i,e)}}xc.DefaultConfig={beginColor:$.White,endColor:$.White,life:300,fade:!1,size:5,graphic:void 0,startSize:void 0,endSize:void 0};var ks;(function(n){n.Global="global",n.Local="local"})(ks||(ks={}));class Iw{constructor(){this.type="ex.particle",this.priority=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ei({gl:t,vertexSource:Zk,fragmentSource:Yk,onPreLink:i=>{t.transformFeedbackVaryings(i,["finalPosition","finalVelocity","finalRotation","finalAngularVelocity","finalLifeMs"],t.INTERLEAVED_ATTRIBS)}}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho)}_getTexture(t){const e=t.getAttribute(qt.Filtering),i=e?Wo(e):void 0,s=Ps(t.getAttribute(qt.WrappingX)),r=Ps(t.getAttribute(qt.WrappingY)),o=t.getAttribute("forceUpload")==="true",l=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);return t.removeAttribute("forceUpload"),l}draw(t,e){var i,s,r,o,l,c,d,_,f;const g=this._gl;this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho);const m=t.particle.transform===ks.Local?this._context.getTransform():this._context.getTransform().multiply(t.emitter.transform.get().inverse);this._shader.setUniformAffineMatrix("u_transform",m),this._shader.setUniformBoolean("fade",!!t.particle.fade),this._shader.setUniformBoolean("useTexture",!!t.particle.graphic),this._shader.setUniformFloat("maxLifeMs",(i=t.particle.life)!==null&&i!==void 0?i:2e3),this._shader.setUniformFloat("deltaMs",e),this._shader.setUniformFloatVector("gravity",(s=t.particle.acc)!==null&&s!==void 0?s:D(0,0)),this._shader.setUniformFloatColor("beginColor",(r=t.particle.beginColor)!==null&&r!==void 0?r:$.Transparent),this._shader.setUniformFloatColor("endColor",(o=t.particle.endColor)!==null&&o!==void 0?o:$.Transparent);let x=(l=t.particle.startSize)!==null&&l!==void 0?l:0,C=(c=t.particle.endSize)!==null&&c!==void 0?c:0;const T=(d=t.particle.size)!==null&&d!==void 0?d:0;if(T>0&&(x=T,C=T),this._shader.setUniformFloat("startSize",x??10),this._shader.setUniformFloat("endSize",C??10),this._shader.setUniformFloat("startOpacity",(_=t.particle.opacity)!==null&&_!==void 0?_:1),t.particle.focus&&(this._shader.setUniformFloatVector("focus",t.particle.focus),this._shader.setUniformFloat("focusAccel",(f=t.particle.focusAccel)!==null&&f!==void 0?f:0)),t.particle.graphic){const A=t.particle.graphic,S=this._getTexture(A.image.image);g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,S),this._shader.setUniformInt("graphic",0)}t.draw(g)}hasPendingDraws(){return!1}flush(){}dispose(){}}const aI=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
in float v_texture_index;\r
\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
// texture resolution\r
in vec2 v_res;\r
\r
in vec2 v_size;\r
\r
in vec2 v_uv_min;\r
in vec2 v_uv_max;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
\r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
\r
  return pixel/texture_size;\r
}\r
\r
float lerp(float from, float to, float rel){\r
  return ((1. - rel) * from) + (rel * to);\r
}\r
\r
float invLerp(float from, float to, float value){\r
  return (value - from) / (to - from);\r
}\r
\r
float remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\r
  float rel = invLerp(origFrom, origTo, value);\r
  return lerp(targetFrom, targetTo, rel);\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
\r
  vec4 color=vec4(1.,0,0,1.);\r
  vec2 remapped_uv = v_texcoord;\r
  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);\r
  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);\r
  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;\r
\r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
\r
  color.rgb = color.rgb * v_opacity;\r
  color.a = color.a * v_opacity;\r
  fragColor = color * v_tint;\r
}`,lI=`#version 300 es\r
layout(location=0) in vec2 pos;\r
layout(location=1) in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
layout(location=2) in vec2 a_offset;\r
layout(location=3) in vec2 a_mat_column1;\r
layout(location=4) in vec2 a_mat_column2;\r
layout(location=5) in vec2 a_mat_column3;\r
\r
layout(location=6) in float a_opacity;\r
out float v_opacity;\r
\r
// Texture resolution (could be bigger than a_size)\r
layout(location=7) in vec2 a_res;\r
out vec2 v_res;\r
\r
// Final size of graphic\r
layout(location=8) in vec2 a_size;\r
out vec2 v_size;\r
\r
layout(location=9) in lowp float a_texture_index;\r
out lowp float v_texture_index;\r
\r
layout(location=10) in vec2 a_uv_min;\r
out vec2 v_uv_min;\r
\r
layout(location=11) in vec2 a_uv_max;\r
out vec2 v_uv_max;\r
\r
layout(location=12) in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  mat4 world_mat = mat4(\r
    a_mat_column1.x, a_mat_column1.y, 0., 0.,\r
    a_mat_column2.x, a_mat_column2.y, 0., 0.,\r
    0.             , 0.             , 1., 0.,\r
    a_mat_column3.x, a_mat_column3.y, 0., 1.\r
  );\r
\r
  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\r
  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\r
\r
  v_opacity = a_opacity;\r
  v_texcoord = a_texcoord;\r
  v_uv_min = a_uv_min;\r
  v_uv_max = a_uv_max;\r
  v_res = a_res;\r
  v_size = a_size;\r
  v_texture_index = a_texture_index;\r
  v_tint = a_tint;\r
}`;class hI{constructor(t){this.type="ex.image-v2",this.priority=0,this._maxImages=2e4,this._maxTextures=0,this._components=22,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._defaultTint=$.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=D_(t,i);this._maxTextures=Math.min(i,s);const r=this._transformFragmentSource(aI,this._maxTextures);this._shader=new Ei({gl:t,fragmentSource:r,vertexSource:lI}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((f,g)=>g)),this._vao=t.createVertexArray(),t.bindVertexArray(this._vao),this._quadMesh=new Float32Array([0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1]),this._meshBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._meshBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadMesh,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,16,0),t.enableVertexAttribArray(0),t.vertexAttribPointer(1,2,t.FLOAT,!1,16,8),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,null);const o=this._components;this._transformData=new qs({gl:t,size:o*this._maxImages,type:"dynamic"}),this._transformData.bind();let l=0,c=2;const d=4,_=o*4;t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(2),l+=2*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(3),l+=2*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(4),l+=2*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(5),l+=2*d,t.vertexAttribPointer(c++,1,t.FLOAT,!1,_,l),t.enableVertexAttribArray(6),l+=1*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(7),l+=2*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(8),l+=2*d,t.vertexAttribPointer(c++,1,t.FLOAT,!1,_,l),t.enableVertexAttribArray(9),l+=1*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(10),l+=2*d,t.vertexAttribPointer(c++,2,t.FLOAT,!1,_,l),t.enableVertexAttribArray(11),l+=2*d,t.vertexAttribPointer(c++,4,t.FLOAT,!1,_,l),t.enableVertexAttribArray(12),l+=4*d,t.vertexAttribDivisor(2,1),t.vertexAttribDivisor(3,1),t.vertexAttribDivisor(4,1),t.vertexAttribDivisor(5,1),t.vertexAttribDivisor(6,1),t.vertexAttribDivisor(7,1),t.vertexAttribDivisor(8,1),t.vertexAttribDivisor(9,1),t.vertexAttribDivisor(10,1),t.vertexAttribDivisor(11,1),t.vertexAttribDivisor(12,1),t.bindVertexArray(null)}_bindData(t){const e=this._components;this._transformData.bind(),this._transformData.upload(e*this._imageCount),t.bindVertexArray(this._vao)}dispose(){this._transformData.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let r=0;r<e;r++)r===0?s+=`if (v_texture_index <= ${r}.5) {
`:s+=`   else if (v_texture_index <= ${r}.5) {
`,s+=`      color = texture(u_textures[${r}], uv);
`,s+=`   }
`;return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(qt.Filtering),i=e?Wo(e):void 0,s=Ps(t.getAttribute(qt.WrappingX)),r=Ps(t.getAttribute(qt.WrappingY)),o=t.getAttribute("forceUpload")==="true",l=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);t.removeAttribute("forceUpload"),this._textures.indexOf(l)===-1&&(this._textures.push(l),this._textureToIndex.set(l,this._textureIndex++),this._images.add(t))}_bindTextures(t){const e=Math.min(this._textureIndex,this._maxTextures);for(let i=0;i<e;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,this._textures[i]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const i=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(i))!==null&&e!==void 0?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,i,s,r,o,l,c,d){var _,f,g,m;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const x=this._getImageWidth(t),C=this._getImageHeight(t);let T=x||s||0,A=C||r||0;this._view[0]=0,this._view[1]=0,this._view[2]=(_=s??x)!==null&&_!==void 0?_:0,this._view[3]=(f=r??C)!==null&&f!==void 0?f:0,this._dest[0]=e??1,this._dest[1]=i??1,o!==void 0&&l!==void 0&&c!==void 0&&d!==void 0&&(this._view[0]=e??1,this._view[1]=i??1,this._view[2]=(g=s??x)!==null&&g!==void 0?g:0,this._view[3]=(m=r??C)!==null&&m!==void 0?m:0,this._dest[0]=o,this._dest[1]=l,T=c,A=d),e=this._view[0],i=this._view[1];const S=this._view[2],E=this._view[3],M=this._context.getTransform(),O=this._context.opacity;this._context.snapToPixel&&(this._dest[0]=~~(this._dest[0]+Mt),this._dest[1]=~~(this._dest[1]+Mt));const F=this._context.tint||this._defaultTint,K=this._getTextureIdForImage(t),nt=x||T,pt=C||A,ht=(e+this.uvPadding)/nt,ct=(i+this.uvPadding)/pt,bt=(e+S-this.uvPadding)/nt,wt=(i+E-this.uvPadding)/pt,Ct=x,dt=C,G=this._transformData.bufferData;G[this._vertexIndex++]=this._dest[0],G[this._vertexIndex++]=this._dest[1],G[this._vertexIndex++]=M.data[0],G[this._vertexIndex++]=M.data[1],G[this._vertexIndex++]=M.data[2],G[this._vertexIndex++]=M.data[3],G[this._vertexIndex++]=M.data[4],G[this._vertexIndex++]=M.data[5],G[this._vertexIndex++]=O,G[this._vertexIndex++]=T,G[this._vertexIndex++]=A,G[this._vertexIndex++]=Ct,G[this._vertexIndex++]=dt,G[this._vertexIndex++]=K,G[this._vertexIndex++]=ht,G[this._vertexIndex++]=ct,G[this._vertexIndex++]=bt,G[this._vertexIndex++]=wt,G[this._vertexIndex++]=F.r/255,G[this._vertexIndex++]=F.g/255,G[this._vertexIndex++]=F.b/255,G[this._vertexIndex++]=F.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._bindData(t),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),t.drawArraysInstanced(t.TRIANGLES,0,6,this._imageCount),ce.DrawnImagesCount+=this._imageCount,ce.DrawCallCount++,t.bindVertexArray(null),this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Mt=1e-4;class cI{constructor(t){this._webglCtx=t,this._debugText=new M_}drawRect(t,e,i,s,r={color:$.Black}){this.drawLine(D(t,e),D(t+i,e),{...r}),this.drawLine(D(t+i,e),D(t+i,e+s),{...r}),this.drawLine(D(t+i,e+s),D(t,e+s),{...r}),this.drawLine(D(t,e+s),D(t,e),{...r})}drawLine(t,e,i){var s;this._webglCtx.draw("ex.line",t,e,(s=i==null?void 0:i.color)!==null&&s!==void 0?s:$.Black)}drawPoint(t,e={color:$.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class xn{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}constructor(t){this._logger=lt.getInstance(),this._renderers=new Map,this._lazyRenderersFactory=new Map,this.imageRenderer=Ye.isEnabled("use-legacy-image-renderer")?"ex.image":"ex.image-v2",this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new vc(()=>new Vk,void 0,4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new Ck,this._state=new yw,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=$.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new cI(this),this._totalPostProcessorTime=0;const{canvasElement:e,context:i,enableTransparency:s,antialiasing:r,uvPadding:o,multiSampleAntialiasing:l,pixelArtSampler:c,powerPreference:d,snapToPixel:_,backgroundColor:f,useDrawSorting:g,garbageCollector:m,handleContextLost:x,handleContextRestored:C}=t;if(this.__gl=i??e.getContext("webgl2",{antialias:r??this.smoothing,premultipliedAlpha:!1,alpha:s??this.transparency,depth:!1,powerPreference:d??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");x&&this.__gl.canvas.addEventListener("webglcontextlost",x,!1),C&&this.__gl.canvas.addEventListener("webglcontextrestored",C,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new we(this.__gl,m),this.snapToPixel=_??this.snapToPixel,this.smoothing=r??this.smoothing,this.transparency=s??this.transparency,this.pixelArtSampler=c??this.pixelArtSampler,this.uvPadding=o??this.uvPadding,this.multiSampleAntialiasing=typeof l=="boolean"?l:this.multiSampleAntialiasing,this.samples=typeof l=="object"?l.samples:void 0,this.backgroundColor=f??this.backgroundColor,this.useDrawSorting=g??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;if(this._ortho=Di.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!1),this.register(new Hk({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new zm),this.register(new Gk),this.register(new qk),this.register(new Lk),this.register(new Rk),this.lazyRegister("ex.particle",()=>new Iw),this.register(new hI({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.materialScreenTexture=t.createTexture(),!this.materialScreenTexture)throw new Error("Could not create screen texture!");t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new Ok(t),this._renderTarget=new mh({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new mh({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new mh({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new mh({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}lazyRegister(t,e){this._lazyRenderersFactory.set(t,e)}get(t){let e=this._renderers.get(t);if(!e){const i=this._lazyRenderersFactory.get(t);i&&(this._logger.debug("lazy init renderer:",t),e=i(),this.register(e))}return e}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const i=this.get(t);if(i)if(this.useDrawSorting){const s=this._drawCallPool.get();s.z=this._state.current.z,s.priority=i.priority,s.renderer=t,this.getTransform().clone(s.transform),s.state.z=this._state.current.z,s.state.opacity=this._state.current.opacity,s.state.tint=this._state.current.tint,s.state.material=this._state.current.material,s.args[0]=e[0],s.args[1]=e[1],s.args[2]=e[2],s.args[3]=e[3],s.args[4]=e[4],s.args[5]=e[5],s.args[6]=e[6],s.args[7]=e[7],s.args[8]=e[8],s.args[9]=e[9],this._drawCalls[this._drawCallIndex++]=s}else this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]),this._currentRenderer=i;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.reset()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Di.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._msaaTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}drawImage(t,e,i,s,r,o,l,c,d){if(!(s===0||r===0)){{if(c===0||d===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){lt.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,e,i,s,r,o,l,c,d):this.imageRenderer==="ex.image"?this.draw(this.imageRenderer,t,e,i,s,r,o,l,c,d):this.draw(this.imageRenderer,t,e,i,s,r,o,l,c,d)}}drawLine(t,e,i,s=1){this.draw("ex.rectangle",t,e,i,s)}drawRectangle(t,e,i,s,r,o){this.draw("ex.rectangle",t,e,i,s,r,o)}drawCircle(t,e,i,s,r){this.draw("ex.circle",t,e,i,s,r)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+Mt):t,this.snapToPixel?~~(e+Mt):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const e of this._postprocessors){const i=e.getShader();i.use();const s=i.getUniforms();this._totalPostProcessorTime+=t,s.find(r=>r.name==="u_time_ms")&&i.setUniformFloat("u_time_ms",this._totalPostProcessorTime),s.find(r=>r.name==="u_elapsed_ms")&&i.setUniformFloat("u_elapsed_ms",t),s.find(r=>r.name==="u_resolution")&&i.setUniformFloatVector("u_resolution",D(this.width,this.height)),e.onUpdate&&e.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Pw({...t,graphicsContext:this})}createShader(t){const e=this.__gl,{vertexSource:i,fragmentSource:s}=t,r=new Ei({gl:e,vertexSource:i,fragmentSource:s});return r.compile(),r}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){var t;if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let e=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(e.use(),this.useDrawSorting){for(let o=this._drawCallIndex;o<this._drawCalls.length;o++)this._drawCalls[o]=null;const i=new Map;for(const[o]of this._renderers){let l=0;for(l=0;l<this._drawCallIndex&&this._drawCalls[l].renderer!==o;l++);i.set(o,l)}this._drawCalls.sort((o,l)=>{if(o===null||l===null)return 0;const c=o.z-l.z,d=i.get(o.renderer)-i.get(l.renderer),_=o.priority-l.priority;return c===0?_===0?d:_:c});const s=this._transform.current,r=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let o=this._drawCalls[0].renderer,l=this.get(o);for(let c=0;c<this._drawCallIndex;c++)this._transform.current=this._drawCalls[c].transform,this._state.current=this._drawCalls[c].state,this._drawCalls[c].renderer!==o&&(l.flush(),o=this._drawCalls[c].renderer,l=this.get(o)),l instanceof zm&&(!((t=this.material)===null||t===void 0)&&t.isUsingScreenTexture)&&(e.copyToTexture(this.materialScreenTexture),e.use()),l.draw(...this._drawCalls[c].args);l.hasPendingDraws()&&l.flush()}this._transform.current=s,this._state.current=r,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const i of this._renderers.values())i.hasPendingDraws()&&i.flush();e.disable(),this._postprocessors.length>0&&e.toRenderSource().use();for(let i=0;i<this._postprocessors.length;i++)e=this._postProcessTargets[i%2],this._postProcessTargets[i%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]),this._postProcessTargets[i%2].toRenderSource().use();e.blitToScreen()}}const Ee=1e-4;class dI{constructor(t){this._ex=t,this._debugText=new M_}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+Ee):t,this._ex.snapToPixel?~~(e+Ee):e,this._ex.snapToPixel?~~(i+Ee):i,this._ex.snapToPixel?~~(s+Ee):s),this._ex.__ctx.restore()}drawLine(t,e,i={color:$.Black}){var s,r;this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=(r=(s=i.color)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+Ee):t.x,this._ex.snapToPixel?~~(t.y+Ee):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+Ee):e.x,this._ex.snapToPixel?~~(e.y+Ee):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:$.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+Ee):t.x,this._ex.snapToPixel?~~(t.y+Ee):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class jh{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=$.ExcaliburBlue,this._state=new yw,this.snapToPixel=!1,this.debug=new dI(this);const{canvasElement:e,context:i,enableTransparency:s,snapToPixel:r,antialiasing:o,backgroundColor:l}=t;if(this.__ctx=i??e.getContext("2d",{alpha:s??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=l??this.backgroundColor,this.snapToPixel=r??this.snapToPixel,this.smoothing=o??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,s,r,o,l,c,d){if(s===0||r===0)return;if(c===0||d===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const _=[t,e,i,s,r,o,l,c,d].filter(f=>f!==void 0).map(f=>typeof f=="number"&&this.snapToPixel?~~f:f);this.__ctx.drawImage.apply(this.__ctx,_),ce.DrawCallCount++,ce.DrawnImagesCount=1}drawLine(t,e,i,s=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+Ee):t.x,this.snapToPixel?~~(t.y+Ee):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+Ee):e.x,this.snapToPixel?~~(e.y+Ee):e.y),this.__ctx.lineWidth=s,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,s){this.__ctx.save(),this.__ctx.fillStyle=s.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+Ee):t.x,this.snapToPixel?~~(t.y+Ee):t.y,this.snapToPixel?~~(e+Ee):e,this.snapToPixel?~~(i+Ee):i),this.__ctx.restore()}drawCircle(t,e,i,s,r){this.__ctx.save(),this.__ctx.beginPath(),s&&(this.__ctx.strokeStyle=s.toString()),r&&(this.__ctx.lineWidth=r),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+Ee):t.x,this.snapToPixel?~~(t.y+Ee):t.y,e,0,Math.PI*2),this.__ctx.fill(),s&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+Ee):t,this.snapToPixel?~~(e+Ee):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),ce.clear()}flush(){}dispose(){this.__ctx=void 0}}var $e;(function(n){n.Fixed="Fixed",n.FitContainerAndFill="FitContainerAndFill",n.FitScreenAndFill="FitScreenAndFill",n.FitContainerAndZoom="FitContainerAndZoom",n.FitScreenAndZoom="FitScreenAndZoom",n.FitScreen="FitScreen",n.FillScreen="FillScreen",n.FitContainer="FitContainer",n.FillContainer="FillContainer"})($e||($e={}));class Wu{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}const uI={ScreenResize:"resize",PixelRatioChange:"pixelratio",FullScreenChange:"fullscreen"};class Nu{constructor(t){var e,i,s,r;this.events=new de,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullscreen=!1,this._isDisposed=!1,this._logger=lt.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullscreen=!this._isFullscreen,this._logger.debug("Fullscreen Change",this._isFullscreen),this.events.emit("fullscreen",{fullscreen:this.isFullscreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const o=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(o),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new at,this._unsafeArea=new at,this.viewport=t.viewport,this.resolution=(e=t.resolution)!==null&&e!==void 0?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(i=t.displayMode)!==null&&i!==void 0?i:$e.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(s=t.antialiasing)!==null&&s!==void 0?s:this._antialiasing,this._canvasImageRendering=(r=t.canvasImageRendering)!==null&&r!==void 0?r:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get worldToPagePixelRatio(){if(this._canvas){const t=this.worldToPageCoordinates(I.Zero);return this.worldToPageCoordinates(D(1,0)).sub(t).x}else return 1}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case $e.FillContainer:case $e.FitContainer:case $e.FitContainerAndFill:case $e.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof xn&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let s=Math.max(1,this.pixelRatio-.5),r=!1;for(;s>1&&!r;){s=Math.max(1,s-.5);const o=this._resolution.width*s,l=this._resolution.height*s;r=this.graphicsContext.checkIfResolutionSupported({width:o,height:l})}this.pixelRatioOverride=s,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",e=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+e,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof jh&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio),document.documentElement.style.setProperty("--ex-pixel-ratio",this.worldToPagePixelRatio.toString())}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullscreen}get isFullscreen(){return this._isFullscreen}goFullScreen(t){return this.enterFullscreen(t)}enterFullscreen(t){var e,i,s,r,o,l;if(t){const c=document.getElementById(t);if(c!=null&&c.requestFullscreen||c!=null&&c.webkitRequestFullscreen){if(c.getAttribute("ex-fullscreen-listener")||(c.setAttribute("ex-fullscreen-listener","true"),c.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),c.requestFullscreen)return(e=c.requestFullscreen())!==null&&e!==void 0?e:Promise.resolve();if(c.webkitRequestFullscreen)return(i=c.webkitRequestFullscreen())!==null&&i!==void 0?i:Promise.resolve()}}return!((s=this._canvas)===null||s===void 0)&&s.requestFullscreen?(o=(r=this._canvas)===null||r===void 0?void 0:r.requestFullscreen())!==null&&o!==void 0?o:Promise.resolve():this._canvas.webkitRequestFullscreen?(l=this._canvas.webkitRequestFullscreen())!==null&&l!==void 0?l:Promise.resolve():(this._logger.warnOnce("Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones"),Promise.resolve())}exitFullScreen(){return this.exitFullscreen()}exitFullscreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let e=t.x,i=t.y;this._isFullscreen||(e-=xa(this._canvas).x,i-=xa(this._canvas).y);const s=this._viewportToPixels(this.viewport);if(this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=(i-o)/r*s.height,e=e/window.innerWidth*s.width}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=(e-o)/r*s.width,i=i/window.innerHeight*s.height}return e=e/s.width*this.resolution.width,i=i/s.height*this.resolution.height,e=e-this.contentArea.left,i=i-this.contentArea.top,new I(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;const s=this._viewportToPixels(this.viewport);if(e=e/this.resolution.width*s.width,i=i/this.resolution.height*s.height,this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=i/s.height*r+o,e=e/s.width*window.innerWidth}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=e/s.width*r+o,i=i/s.height*window.innerHeight}return this._isFullscreen||(e+=xa(this._canvas).x,i+=xa(this._canvas).y),new I(e,i)}screenToWorldCoordinates(t){return t=t.add(D(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(D(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(D(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){return at.fromDimension(this.resolution.width,this.resolution.height,I.Half).scale(D(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return at.fromDimension(this.resolution.width,this.resolution.height,I.Zero,I.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get width(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get height(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return D(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i},this._contentArea=at.fromDimension(this.resolution.width,this.resolution.height,I.Zero),this._unsafeArea=at.fromDimension(this.resolution.width,this.resolution.height,I.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,e,i){if(this.viewport=i??{width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const s=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new at({top:s,left:0,right:this._contentResolution.width,bottom:this.resolution.height-s}),this._unsafeArea=new at({top:-s,left:0,right:this._contentResolution.width,bottom:this.resolution.height+s})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const s=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new at({top:0,left:s,right:this.resolution.width-s,bottom:this._contentResolution.height}),this._unsafeArea=new at({top:0,left:-s,right:this.resolution.width+s,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:e,offsetHeight:i}=this.canvas;this._computeFitAndZoom(e,i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,e){const i=this.aspectRatio;let s=0,r=0;t/i<e?(s=t,r=t/i):(s=e*i,r=e);const o=t/s,l=e/r,c=Math.max(o,l),d=s*c,_=r*c;d>t?this.canvas.style.left=-(d-t)/2+"px":this.canvas.style.left="",_>e?this.canvas.style.top=-(_-e)/2+"px":this.canvas.style.top="",this.viewport={width:d,height:_};const f=at.fromDimension(this.viewport.width,this.viewport.height,I.Zero);if(this.viewport.width>t){const g=(this.viewport.width-t)/this.viewport.width*this.resolution.width;f.top=0,f.left=g/2,f.right=this.resolution.width-g/2,f.bottom=this.resolution.height}if(this.viewport.height>e){const g=(this.viewport.height-e)/this.viewport.height*this.resolution.height;f.top=g/2,f.left=0,f.bottom=this.resolution.height-g/2,f.right=this.resolution.width}this._contentArea=f}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0,s="pixel",r="pixel";const o=this.canvas.parentElement;o.clientWidth/t<o.clientHeight?(this.canvas.style.width="100%",e=100,s="percent",i=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",i=100,r="percent",e=this.canvas.offsetHeight*t),this.viewport={width:e,widthUnit:s,height:i,heightUnit:r},this._contentArea=at.fromDimension(this.resolution.width,this.resolution.height,I.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===$e.FillContainer&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode===$e.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=at.fromDimension(this.resolution.width,this.resolution.height,I.Zero),this.displayMode===$e.FitScreen&&this._computeFit(),this.displayMode===$e.FitContainer&&this._computeFitContainer(),this.displayMode===$e.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===$e.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===$e.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===$e.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class za{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}function _I(n){return!!n.playbackState}class Ar{static unlock(){return new Promise((e,i)=>{if(Ar._UNLOCKED||!za.create())return e(!0);const s=setTimeout(()=>{lt.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),r=za.create();r.resume().then(()=>{const o=r.createBuffer(1,1,22050),l=r.createBufferSource();let c=!1;l.buffer=o,l.connect(r.destination),l.onended=()=>c=!0,l.start(0),setTimeout(()=>{_I(l)?(l.playbackState===l.PLAYING_STATE||l.playbackState===l.FINISHED_STATE)&&(Ar._UNLOCKED=!0):(r.currentTime>0||c)&&(Ar._UNLOCKED=!0)},0),clearTimeout(s),e(!0)},()=>{i()})})}static isUnlocked(){return this._UNLOCKED}}Ar._UNLOCKED=!1;let Rw=class Mw extends No{get ctx(){return this._ctx}constructor(t={}){super(t),this._options=t}clone(){return new Mw({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;!((e=this._options)===null||e===void 0)&&e.draw&&((i=this._options)===null||i===void 0||i.draw(t)),this._options.cache||this.flagDirty()}};class lf{}lf.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class bc{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const i=new bc;i.data=e;for(const s in t.states)i.states.set(s,{name:s,...t.states[s]});for(const s of i.states.values())for(const r of s.transitions)if(r!=="*"&&!i.states.has(r))throw Error(`Invalid state machine, state [${s.name}] has a transition to another state that doesn't exist [${r}]`);return i.currentState=i.startState=i.states.get(t.start),i}in(t){return this.currentState.name===t}go(t,e){var i,s;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const r=this.states.get(t);return this.currentState.onExit&&((i=this.currentState)===null||i===void 0?void 0:i.onExit({to:r.name,data:this.data}))===!1||r!=null&&r.onEnter&&(r==null?void 0:r.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=r,!((s=this.currentState)===null||s===void 0)&&s.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class Dw{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=Ut(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=za.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new Yi,this._stateMachine=bc.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:i})=>{i.pausedAt=(e??0)/this._playbackRate,i.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class hf extends Bt{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}stopPropagation(){}action(){}propagate(){}layPath(t){}}class vr extends hf{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Lw extends hf{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function fI(n){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,i=n.match(e)[1];return!!t.canPlayType("audio/"+i)}catch(t){return lt.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}const pI={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class Fw{set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.events.emit("volumechange",new vr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}constructor(...t){this.events=new de,this.logger=lt.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=za.create(),this._resource=new pl("",lf.type.arraybuffer);for(const e of t)if(fI(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const i=await this._resource.load(),s=await this.decodeAudio(i.slice(0));return this._duration=(e=(t=this._duration)!==null&&t!==void 0?t:s==null?void 0:s.duration)!==null&&e!==void 0?e:void 0,this.events.emit("processed",new Lw(this,s)),this.data=s}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new vr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new vr(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused()){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this._tracks.splice(this.getTrackId(e),1),!0)));this.events.emit("resume",new vr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),e=await t.play(()=>{this.events.emit("playbackstart",new vr(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new vr(this,t));const i=this.getTrackId(t);return i!==-1&&this._tracks.splice(i,1),e}_getTrackInstance(t){var e;const i=new Dw(t);return i.loop=this.loop,i.volume=this.volume,i.duration=(e=this.duration)!==null&&e!==void 0?e:0,i.playbackRate=this._playbackRate,this._tracks.push(i),i}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const gI={BeforeLoad:"beforeload",AfterLoad:"afterload",UserAction:"useraction",LoadResourceStart:"loadresourcestart",LoadResourceEnd:"loadresourceend"};function Gu(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Ha{get resources(){return this._resources}constructor(t){var e;this.events=new de,this.canvas=new Rw({filtering:Oe.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new Yi,t&&(!((e=t.loadables)===null||e===void 0)&&e.length)&&this.addResources(t.loadables)}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await Dh(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let e=0;const i=t.length;for(e;e<i;e++)this.addResource(t[e])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?Ut(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,e){this._totalTimeMs+=e}onDraw(t){const e=this._totalTimeMs/1e3;t.fillStyle=$.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const i=e*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,i,i+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const s=(this.progress*100).toFixed(0)+"%",r=t.measureText(s),o=Math.abs(r.actualBoundingBoxLeft)+Math.abs(r.actualBoundingBoxRight),l=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);t.fillText(s,-o/2,l/2),t.restore()}areResourcesLoaded(){return this._resources.length===0?Promise.resolve():this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof Fw&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await Ar.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const mI="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var vI=Xe(851);class Dr extends Ha{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){const e=Array.isArray(t)?{loadables:t}:t;super(e),this._logger=lt.getInstance(),this._originalOptions={loadables:[]},this.events=new de,this._playButtonShown=!1,this.logo=mI,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=$.White,this.backgroundColor="#176BAA",this._imageLoaded=new Yi,this.suppressPlayButton=!1,this._playButtonStyles=vI.A.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let i=document.getElementById("excalibur-play");return i||(i=document.createElement("button")),i.id="excalibur-play",i.textContent=this.playButtonText,i.style.display="none",i},this._originalOptions={...Dr._DEFAULT_LOADER_OPTIONS,...e}}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Dh(500,(t=this.engine)===null||t===void 0?void 0:t.clock);else{const i=()=>{try{this._positionPlayButton()}catch{}};return!((e=this.engine)===null||e===void 0)&&e.browser&&this.engine.browser.window.on("resize",i),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",r=>{r.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(r=>{const o=l=>{var c;if(l.stopPropagation(),this.hidePlayButton(),!((c=this.engine)===null||c===void 0)&&c.browser&&this.engine.browser.window.off("resize",i),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer)}catch(d){this._logger.error("could not go fullscreen",d)}r()};this._playButton.addEventListener("click",o),this._playButton.addEventListener("touchend",o),this._playButton.addEventListener("pointerup",o),this.engine&&this.engine.input.gamepads.once("button",()=>o(new Event("button")))})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await Dh(200,(t=this.engine)===null||t===void 0?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){this.screen.pushResolutionAndViewport(),this.screen.resolution={width:this.canvas.width,height:this.canvas.height},this.screen.applyResolutionAndViewport();const t=this._image;await this._imageLoaded.promise,await(t==null?void 0:t.decode())}async onAfterLoad(){this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:e,width:i,height:s}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const r=this._playButton.clientWidth,o=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+i/2-r/2}px`,this._playButtonRootElement.style.top=`${e+s/2-o/2+100}px`)}}}onDraw(t){const e=this.engine.canvasHeight/this.engine.pixelRatio,i=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const r=Math.min(this.logoWidth,i*.75);let o=i/2-r/2;this.logoPosition&&(o=this.logoPosition.x,s=this.logoPosition.y);const l=Math.floor(r*(this.logoHeight/this.logoWidth)),c=this.engine.screen.antialiasing;if(this.engine.screen.antialiasing=!0,this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s,r,l):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s-l-20,r,l),!this.suppressPlayButton&&this._playButtonShown){this.engine.screen.antialiasing=c;return}let d=o,_=s;this.loadingBarPosition&&(d=this.loadingBarPosition.x,_=this.loadingBarPosition.y),t.lineWidth=2,Hu(t,d,_,r,20,10,this.loadingBarColor);const f=r*this.progress,g=5,m=f-g*2,x=20-g*2;Hu(t,d+g,_+g,m>10?m:10,x,5,null,this.loadingBarColor),this.engine.screen.antialiasing=c}}Dr._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};const Hm={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Bw{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(Hm))i[s]?(t+="(%c%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Hm[s]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),lt.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||lt.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}var ft;(function(n){n.PreventCollision="PreventCollision",n.Passive="Passive",n.Active="Active",n.Fixed="Fixed"})(ft||(ft={}));class Ws{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const s=this._GROUPS.get(t);if(s.mask===e)return s;throw new Error(`Collision group ${t} already exists with a different mask!`)}const i=new Tn(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}Ws._STARTING_BIT=1;Ws._MAX_GROUPS=32;Ws._CURRENT_GROUP=1;Ws._CURRENT_BIT=Ws._STARTING_BIT;Ws._GROUPS=new Map;class Tn{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const e=this.category&t.mask,i=this.mask&t.category;return e!==0&&i!==0}invert(){const t=Ws.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const e=t.map(r=>r.name).join("+"),s=~t.reduce((r,o)=>o.category|r,0);return Ws.create(e,s)}static collidesWith(t){const e=`collidesWith(${t.map(s=>s.name).join("+")})`,i=t.reduce((s,r)=>r.category|s,0);return Ws.create(e,i)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}}Tn.All=new Tn("Collide with all groups",-1,-1);class gi{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=gi.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,s;if(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions())return!1;const r=(i=t==null?void 0:t.owner)===null||i===void 0?void 0:i.get(Gt),o=(s=e==null?void 0:e.owner)===null||s===void 0?void 0:s.get(Gt);return!(!r||!o||!r.group.canCollide(o.group)||r.collisionType===ft.Fixed&&o.collisionType===ft.Fixed||o.collisionType===ft.PreventCollision||r.collisionType===ft.PreventCollision||!r.isActive||!o.isActive)}get canCollide(){const t=this.colliderA,e=this.colliderB;return gi.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class wl{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class $u{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new at,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class cf{constructor(t,e=new at(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=e,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const l=i.left,c=i.right,d=i.bounds.getPerimeter(),f=i.bounds.combine(e).getPerimeter(),g=2*f,m=2*(f-d);let x=0;const C=e.combine(l.bounds);let T,A;l.isLeaf()?x=C.getPerimeter()+m:(A=l.bounds.getPerimeter(),T=C.getPerimeter(),x=T-A+m);let S=0;const E=e.combine(c.bounds);if(c.isLeaf()?S=E.getPerimeter()+m:(A=c.bounds.getPerimeter(),T=E.getPerimeter(),S=T-A+m),g<x&&g<S)break;x<S?i=l:i=c}const s=i.parent,r=new $u(s);r.bounds=e.combine(i.bounds),r.height=i.height+1,s!==null?(s.left===i?s.left=r:s.right=r,r.left=i,r.right=t,i.parent=r,t.parent=r):(r.left=i,r.right=t,i.parent=r,t.parent=r,this.root=r);let o=t.parent;for(;o;){if(o=this._balance(o),!o.left)throw new Error("Parent of current leaf cannot have a null left child"+o);if(!o.right)throw new Error("Parent of current leaf cannot have a null right child"+o);o.height=1+Math.max(o.left.height,o.right.height),o.bounds=o.left.bounds.combine(o.right.bounds),o=o.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,i=e.parent;let s;if(e.left===t?s=e.right:s=e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let r=i;for(;r;)r=this._balance(r),r.bounds=r.left.bounds.combine(r.right.bounds),r.height=1+Math.max(r.left.height,r.right.height),r=r.parent}else this.root=s,s.parent=null}trackCollider(t){const e=new $u;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const s=t.bounds;if(!this.worldBounds.contains(s))return lt.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(s))return!1;if(this._remove(i),s.left-=this._config.boundsPadding,s.top-=this._config.boundsPadding,s.right+=this._config.boundsPadding,s.bottom+=this._config.boundsPadding,t.owner){const r=(e=t.owner)===null||e===void 0?void 0:e.get(Gt);if(r){const o=r.vel.x*32/1e3*this._config.velocityMultiplier,l=r.vel.y*32/1e3*this._config.velocityMultiplier;o<0?s.left+=o:s.right+=o,l<0?s.top+=l:s.bottom+=l}}return i.bounds=s,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,r=e,o=i,l=e.left,c=e.right,d=i.left,_=i.right,f=o.height-r.height;if(f>1)return o.left=s,o.parent=s.parent,s.parent=o,o.parent?o.parent.left===s?o.parent.left=o:o.parent.right=o:this.root=o,d.height>_.height?(o.right=d,s.right=_,_.parent=s,s.bounds=r.bounds.combine(_.bounds),o.bounds=s.bounds.combine(d.bounds),s.height=1+Math.max(r.height,_.height),o.height=1+Math.max(s.height,d.height)):(o.right=_,s.right=d,d.parent=s,s.bounds=r.bounds.combine(d.bounds),o.bounds=s.bounds.combine(_.bounds),s.height=1+Math.max(r.height,d.height),o.height=1+Math.max(s.height,_.height)),o;if(f<-1){if(r.left=s,r.parent=s.parent,s.parent=r,r.parent)if(r.parent.left===s)r.parent.left=r;else{if(r.parent.right!==s)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return l.height>c.height?(r.right=l,s.left=c,c.parent=s,s.bounds=o.bounds.combine(c.bounds),r.bounds=s.bounds.combine(l.bounds),s.height=1+Math.max(o.height,c.height),r.height=1+Math.max(s.height,l.height)):(r.right=c,s.left=l,l.parent=s,s.bounds=o.bounds.combine(l.bounds),r.bounds=s.bounds.combine(c.bounds),s.height=1+Math.max(o.height,l.height),r.height=1+Math.max(s.height,c.height)),r}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const i=t.bounds,s=r=>{if(r&&r.bounds.overlaps(i))if(r.isLeaf()&&r.data!==t){if(e.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=r=>{if(r&&r.bounds.rayCast(t,e))if(r.isLeaf()){if(i.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,$.Green):i.bounds.draw(t,$.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class yr{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const i=this.dir.cross(t.getSlope());if(i===0)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const r=e.cross(this.dir)/i/t.getLength();if(r>=0&&r<=1)return s}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class qh{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new cf(t.dynamicTree)}getColliders(){return this._colliders}query(t){const e=[];return t instanceof at?this._dynamicCollisionTree.query({id:Pr("collider",-1),owner:null,bounds:t},i=>(e.push(i),!1)):this._dynamicCollisionTree.query({id:Pr("collider",-1),owner:null,bounds:new at(t.x,t.y,t.x,t.y)},i=>(e.push(i),!1)),e}rayCast(t,e){var i,s,r;const o=[],l=(i=e==null?void 0:e.maxDistance)!==null&&i!==void 0?i:1/0,c=e==null?void 0:e.collisionGroup,d=c?c.category:(s=e==null?void 0:e.collisionMask)!==null&&s!==void 0?s:Tn.All.category,_=(r=e==null?void 0:e.searchAllColliders)!==null&&r!==void 0?r:!1;return this._dynamicCollisionTree.rayCastQuery(t,l,f=>{const m=f.owner.get(Gt);if(e!=null&&e.ignoreCollisionGroupAll&&m.group===Tn.All)return!1;const x=(d&m.group.category)!==0;if(m!=null&&m.group&&!x)return!1;const C=f.rayCast(t,l);if(C){if(e!=null&&e.filter){if(e.filter(C)&&(o.push(C),!_))return!0}else if(o.push(C),!_)return!0}return!1}),o}track(t){if(!t){lt.getInstance().warn("Cannot track null collider");return}if(t instanceof Ve){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){lt.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof Ve){const e=t.getColliders();for(const i of e){const s=this._colliders.indexOf(i);s!==-1&&this._colliders.splice(s,1),this._dynamicCollisionTree.untrackCollider(i)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const i=gi.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const s=e/1e3,r=t.filter(l=>{var c,d;const _=(c=l.owner)===null||c===void 0?void 0:c.get(Gt);return((d=l.owner)===null||d===void 0?void 0:d.isActive)&&_.collisionType!==ft.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let o;for(let l=0,c=r.length;l<c;l++)o=r[l],this._dynamicCollisionTree.query(o,d=>{if(!this._pairExists(o,d)&&gi.canCollide(o,d)){const _=new gi(o,d);this._pairs.add(_.id),this._collisionPairCache.push(_)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const l of r){const c=l.owner.get(Gt);if(c.collisionType!==ft.Active)continue;const d=c.vel.magnitude*s+c.acc.magnitude*.5*s*s,_=Math.min(l.bounds.height,l.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||d>_/2){i&&i.physics.fastBodies++;const f=c.globalPos.sub(c.oldPos),g=l.center,m=l.getFurthestPoint(c.vel),x=m.sub(f),C=new yr(x,c.vel);C.pos=C.pos.add(C.dir.scale(-2*this._config.continuous.surfaceEpsilon));let T,A=new I(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(C,d+this._config.continuous.surfaceEpsilon*2,S=>{if(!this._pairExists(l,S)&&gi.canCollide(l,S)){const E=S.rayCast(C,d+this._config.continuous.surfaceEpsilon*10);if(E){const M=E.point.sub(x);M.magnitude<A.magnitude&&(A=M,T=S)}}return!1}),T&&I.isValid(A)){const S=new gi(l,T);this._pairs.has(S.id)||(this._pairs.add(S.id),this._collisionPairCache.push(S));const E=g.sub(m);c.globalPos=x.add(E).add(A).add(C.dir.scale(10*this._config.continuous.surfaceEpsilon)),l.update(c.transform.get()),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let s=0;s<t.length;s++){const r=t[s].collide();if(i=i.concat(r),e&&r.length>0)for(const o of r)e.physics.contacts.set(o.id,o)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateCollider(t[s])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class nr{constructor(){this.id=Pr("collider",nr._ID++),this.composite=null,this.events=new de,this.offset=I.Zero}touching(t){return!!this.collide(t)}}nr._ID=0;var Wa;(function(n){n.Arcade="arcade",n.Realistic="realistic"})(Wa||(Wa={}));var En;(function(n){n.None="none",n.VerticalFirst="vertical-first",n.HorizontalFirst="horizontal-first"})(En||(En={}));const df={vertical:1,horizontal:2},uf={horizontal:1,vertical:2},_f={horizontal:0,vertical:0};var To;(function(n){n.DynamicTree="dynamic-tree",n.SparseHashGrid="sparse-hash-grid"})(To||(To={}));const bn=()=>({enabled:!0,gravity:D(0,0).clone(),solver:Wa.Arcade,substep:1,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},spatialPartition:To.SparseHashGrid,sparseHashGrid:{size:100},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:En.None},realistic:{contactSolveBias:En.None,positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}});class Ve extends nr{set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}constructor(t){super(),this._collisionProcessor=new qh({...bn()}),this._dynamicAABBTree=new cf({boundsPadding:5,velocityMultiplier:2}),this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){let e;t instanceof Ve?(e=t.getColliders(),e.forEach(i=>i.offset.addEqual(t.offset))):e=[t];for(const i of e)i.events.pipe(this.events),i.composite=this,this._colliders.push(i),this._collisionProcessor.track(i),this._dynamicAABBTree.trackCollider(i)}removeCollider(t){t.events.pipe(this.events),t.composite=null,Ho(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:I.Zero).add(this.offset)}get center(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:I.Zero).add(this.offset)}get bounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.bounds),(e=(t=i[0])===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new at().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.localBounds),(e=(t=i[0])===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new at)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const o of e)i.push(o.getFurthestPoint(t));let s=i[0],r=-Number.MAX_VALUE;for(const o of i){const l=o.dot(t);l>r&&(s=o,r=l)}return s}getInertia(t){const e=this.getColliders();let i=0;for(const s of e)i+=s.getInertia(t);return i}collide(t){let e=[t];t instanceof Ve&&(e=t.getColliders());const i=[];for(const r of e)this._dynamicAABBTree.query(r,o=>(i.push(new gi(r,o)),!1));let s=[];for(const r of i)s=s.concat(r.collide());return s}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof Ve){const s=t.getColliders();for(const r of e)for(const o of s){const l=r.getClosestLineBetween(o);l&&i.push(l)}}else for(const s of e){const r=t.getClosestLineBetween(s);r&&i.push(r)}if(i.length){let s=i[0].getLength(),r=i[0];for(const o of i){const l=o.getLength();l<s&&(s=l,r=o)}return r}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),s=[];for(const r of i){const o=r.rayCast(t,e);o&&s.push(o)}if(s.length){let r=s[0],o=r.point.dot(t.dir);for(const l of s){const c=t.dir.dot(l.point);c<o&&(r=l,o=c)}return r}return null}project(t){const e=this.getColliders(),i=[];for(const s of e){const r=s.project(t);r&&i.push(r)}if(i.length){const s=new wl(i[0].min,i[0].max);for(const r of i)s.min=Math.min(r.min,s.min),s.max=Math.max(r.max,s.max);return s}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}debug(t,e,i){const s=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const r of s)r.debug(t,e,i);t.restore()}clone(){const t=new Ve(this._colliders.map(e=>e.clone()));return t.offset=this.offset.clone(),t}}class Pe{constructor(t,e){this.begin=t,this.end=e}clone(t){const e=t||new Pe(this.begin.clone(),this.end.clone());return e.begin=this.begin.clone(e.begin),e.end=this.end.clone(e.end),e}transform(t,e){const i=e||new Pe(I.Zero,I.Zero);return i.begin=t.multiply(this.begin,i.begin),i.end=t.multiply(this.end,i.end),i}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,i=t.distance(e);return this._slope=e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Pe(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e,i=!0){let s=t;i&&(s=s.normalize());const r=s.dot(this.begin)-e,o=s.dot(this.end)-e,l=[];if(r<=0&&l.push(this.begin),o<=0&&l.push(this.end),r*o<0){const c=r/(r-o);l.push(this.begin.add(this.end.sub(this.begin).scale(c)))}return l.length!==2?null:new Pe(l[0],l[1])}distanceToPoint(t,e=!1){const i=t.x,s=t.y,r=this.getLength(),o=this.end.y-this.begin.y,l=this.end.x-this.begin.x,c=(o*i-l*s+this.end.x*this.begin.y-this.end.y*this.begin.x)/r;return e?c:Math.abs(c)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(t!==null)return new I(t,i*t+s);if(e!==null)return new I((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new I(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof I)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const i=t.x-this.begin.x,s=t.y-this.begin.y,r=this.end.x-this.begin.x,o=this.end.y-this.begin.y,l=i*o-s*r;return Math.abs(l)>e?!1:Math.abs(r)>=Math.abs(o)?r>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:o>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function mu(n,t){const i=n.dir(),s=t.dir(),r=i.dot(i),o=s.dot(s);if(r<1e-9&&o<1e-9)return new Pe(n.begin,t.begin);if(r<1e-9){const T=Ut(s.dot(n.begin.sub(t.begin))/o,0,1),A=t.begin.add(s.scale(T));return new Pe(n.begin,A)}if(o<1e-9){const T=Ut(i.dot(t.begin.sub(n.begin))/r,0,1),A=n.begin.add(i.scale(T));return new Pe(A,t.begin)}const l=n.begin.sub(t.begin),c=r,d=o,_=s.dot(l),f=c*d-Math.pow(i.dot(s),2);let g=0,m=0;Math.abs(f)>1e-9?g=Ut((i.dot(s)*_-d*i.dot(l))/f,0,1):g=Ut(i.dot(l)/c,0,1),Math.abs(d)>1e-9?m=Ut((i.dot(s)*g+_)/d,0,1):m=0;const x=n.begin.add(i.scale(g)),C=t.begin.add(s.scale(m));return new Pe(x,C)}const Ns={PolygonPolygonClosestLine(n,t){const e=n.getSides(),i=t.getSides();let s=Number.MAX_VALUE,r=null;for(let o=0;o<e.length;o++)for(let l=0;l<i.length;l++){const c=mu(e[o],i[l]),d=c.getLength();d<s&&(s=d,r=c)}return r},PolygonEdgeClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),s=new yr(n.worldPos,i),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),l=t.asLine();return mu(o.face,l)},PolygonCircleClosestLine(n,t){const e=t.worldPos,i=e.sub(n.worldPos),s=new yr(n.worldPos,i.normalize()),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),l=o.face.begin,c=o.face.getEdge();let d=(c.x*(e.x-l.x)+c.y*(e.y-l.y))/(c.x*c.x+c.y*c.y);d>1?d=1:d<0&&(d=0);const _=Math.sqrt(Math.pow(l.x+c.x*d-e.x,2)+Math.pow(l.y+c.y*d-e.y,2))-t.radius,f=(l.x+c.x*d-e.x)*t.radius/(t.radius+_),g=(l.y+c.y*d-e.y)*t.radius/(t.radius+_);return new Pe(c.scale(d).add(l),new I(e.x+f,e.y+g))},CircleCircleClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),r=n.worldPos.sub(t.worldPos),o=new yr(n.worldPos,i),l=new yr(t.worldPos,r),c=n.rayCast(o),d=t.rayCast(l);return new Pe(c.point,d.point)},CircleEdgeClosestLine(n,t){const e=n.worldPos,i=t.asLine(),s=i.begin,r=i.getEdge(),o=s,l=r;let c=(l.x*(e.x-o.x)+l.y*(e.y-o.y))/(l.x*l.x+l.y*l.y);c>1?c=1:c<0&&(c=0);const d=Math.sqrt(Math.pow(o.x+l.x*c-e.x,2)+Math.pow(o.y+l.y*c-e.y,2))-n.radius,_=(o.x+l.x*c-e.x)*n.radius/(n.radius+d),f=(o.y+l.y*c-e.y)*n.radius/(n.radius+d);return new Pe(l.scale(c).add(o),new I(e.x+_,e.y+f))},EdgeEdgeClosestLine(n,t){const e=n.asLine(),i=t.asLine();return mu(e,i)}};class ii extends nr{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;if(this._radius)return this._radius;const e=this._transform,i=(t=e==null?void 0:e.globalScale)!==null&&t!==void 0?t:I.One;return this._radius=this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,s=(e=i==null?void 0:i.globalScale)!==null&&e!==void 0?e:I.One;this._naturalRadius=t/Math.min(s.x,s.y),this._localBoundsDirty=!0,this._radius=t}constructor(t){super(),this.offset=I.Zero,this._globalMatrix=Fe.identity(),this._localBoundsDirty=!0,this.offset=t.offset||I.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new ii({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,i;return((i=(e=this._transform)===null||e===void 0?void 0:e.pos)!==null&&i!==void 0?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){var i,s;const r=this.center,o=t.dir,l=t.pos,c=r.sub(l),d=o.scale(c.dot(o)),f=c.sub(d).magnitude;if(f>this.radius)return null;{let g=0;if(gw(f,this.radius,1e-4)){if(g=-o.dot(l.sub(r)),g>0&&g<e){const m=t.getPoint(g);return{point:m,normal:m.sub(r).normalize(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Gt),distance:g}}return null}else{const m=Math.sqrt(Math.pow(o.dot(l.sub(r)),2)-Math.pow(l.sub(r).distance(),2)+Math.pow(this.radius,2)),x=-o.dot(l.sub(r))+m,C=-o.dot(l.sub(r))-m,T=[];x>=0&&T.push(x),C>=0&&T.push(C);const A=Math.min(...T);if(A<=e){const S=t.getPoint(A);return{point:S,normal:S.sub(r).normalize(),collider:this,body:(s=this.owner)===null||s===void 0?void 0:s.get(Gt),distance:A}}return null}}}getClosestLineBetween(t){if(t instanceof ii)return Ns.CircleCircleClosestLine(this,t);if(t instanceof Qe)return Ns.PolygonCircleClosestLine(t,this).flip();if(t instanceof Oi)return Ns.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ii)return Ss.CollideCircleCircle(this,t);if(t instanceof Qe)return Ss.CollideCirclePolygon(this,t);if(t instanceof Oi)return Ss.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=new at(-this._naturalRadius,-this._naturalRadius,+this._naturalRadius,+this._naturalRadius),this._localBoundsDirty=!1),this._localBounds}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y),this._radius=void 0}project(t){const e=[],s=this.center.dot(t);return e.push(s),e.push(s+this.radius),e.push(s-this.radius),new wl(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e,i){var s,r,o,l;const{lineWidth:c}={lineWidth:1,...i},d=this._transform,_=(s=d==null?void 0:d.globalScale)!==null&&s!==void 0?s:I.One,f=(r=d==null?void 0:d.globalRotation)!==null&&r!==void 0?r:0,g=(o=d==null?void 0:d.globalPos)!==null&&o!==void 0?o:I.Zero;t.save(),t.translate(g.x,g.y),t.rotate(f),t.scale(_.x,_.y),t.drawCircle((l=this.offset)!==null&&l!==void 0?l:I.Zero,this._naturalRadius,$.Transparent,e,c),t.restore()}}class wr{constructor(t,e,i,s,r,o,l,c){var d,_,f,g,m,x;if(this._canceled=!1,this.bodyA=null,this.bodyB=null,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=s,this.tangent=r,this.points=o,this.localPoints=l,this.info=c,this.id=gi.calculatePairHash(t.id,e.id),t.composite||e.composite){const C=((d=t.composite)===null||d===void 0?void 0:d.compositeStrategy)==="separate"?t.id:(f=(_=t.composite)===null||_===void 0?void 0:_.id)!==null&&f!==void 0?f:t.id,T=((g=e.composite)===null||g===void 0?void 0:g.compositeStrategy)==="separate"?e.id:(x=(m=e.composite)===null||m===void 0?void 0:m.id)!==null&&x!==void 0?x:e.id;this.id+="|"+gi.calculatePairHash(C,T)}this.colliderA.owner&&(this.bodyA=this.colliderA.owner.get(Gt)),this.colliderB.owner&&(this.bodyB=this.colliderB.owner.get(Gt))}matchAwake(){const t=this.bodyA,e=this.bodyB;t&&e&&t.isSleeping!==e.isSleeping&&(t.isSleeping&&t.collisionType!==ft.Fixed&&e.sleepMotion>=t.wakeThreshold&&(t.isSleeping=!1),e.isSleeping&&e.collisionType!==ft.Fixed&&t.sleepMotion>=e.wakeThreshold&&(e.isSleeping=!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}bias(t){if(t!==this.colliderA&&t!==this.colliderB)throw new Error("Collider must be either colliderA or colliderB from this contact");if(t===this.colliderA)return this;const e=this.colliderA,i=this.colliderB;return this.colliderB=e,this.colliderA=i,this.mtv=this.mtv.negate(),this.normal=this.normal.negate(),this.tangent=this.tangent.negate(),this}}class Ow{constructor(){this.axis=D(0,0),this.localAxis=D(0,0),this.side=new Pe(D(0,0),D(0,0)),this.localSide=new Pe(D(0,0),D(0,0)),this.point=D(0,0),this.localPoint=D(0,0)}}class Le{static findPolygonPolygonSeparation(t,e){if(e.transform.matrix.determinant()===0)return Le.findPolygonPolygonSeparationDegenerate(t,e);let i=-Number.MAX_VALUE,s=-1,r;const o=e.transform.inverse.multiply(t.transform.matrix,Le._SCRATCH_MATRIX),l=o.getRotation(),c=t.normals,d=t.points,_=e.points;for(let m=0;m<d.length;m++){const x=c[m].rotate(l,Le._ZERO,Le._SCRATCH_NORMAL),C=o.multiply(d[m],Le._SCRATCH_POINT);let T=Number.MAX_VALUE,A;for(let S=0;S<_.length;S++){const E=x.dot(_[S].sub(C,Le._SCRATCH_SUB_POINT));E<T&&(T=E,A=_[S])}T>i&&(i=T,s=m,r=A)}const f=(s+1)%d.length,g=Le.SeparationPool.get();return g.collider=t,g.separation=i,i>0||(c[s].clone(g.localAxis),c[s].rotate(t.transform.rotation,Le._ZERO,g.axis),t.transform.matrix.multiply(d[s],g.side.begin),t.transform.matrix.multiply(d[f],g.side.end),e.transform.matrix.multiply(r,g.point),g.sideId=s,r.clone(g.localPoint),d[s].clone(g.localSide.begin),d[f].clone(g.localSide.end)),g}static findCirclePolygonSeparation(t,e){const i=e.axes,r=e.center.sub(t.worldPos),o=e.getFurthestPoint(r.negate());i.push(o.sub(t.worldPos).normalize());let l=Number.MAX_VALUE,c=null,d=-1;for(let _=0;_<i.length;_++){const f=e.project(i[_]),g=t.project(i[_]),m=f.getOverlap(g);if(m<=0)return null;m<l&&(l=m,c=i[_],d=_)}return d<0?null:c.normalize().scale(l)}static findPolygonPolygonSeparationDegenerate(t,e){let i=-Number.MAX_VALUE,s=null,r=null,o=-1,l=null;const c=t.getSides(),d=t.getLocalSides();for(let _=0;_<c.length;_++){const f=c[_],g=f.normal(),m=e.getFurthestPoint(g.negate()),x=f.distanceToPoint(m,!0);x>i&&(i=x,s=f,r=g,o=_,l=m)}return{collider:t,separation:r?i:99,axis:r,side:s,localSide:d[o],sideId:o,point:l,localPoint:r?e.getFurthestLocalPoint(r.negate()):null}}}Le.SeparationPool=new vc(()=>new Ow,n=>n,500);Le._ZERO=D(0,0);Le._SCRATCH_POINT=D(0,0);Le._SCRATCH_SUB_POINT=D(0,0);Le._SCRATCH_NORMAL=D(0,0);Le._SCRATCH_MATRIX=Fe.identity();Le.SeparationPool.disableWarnings=!0;const wI=I.Zero,xI=I.Zero,bI=Fe.identity(),Ss={CollideCircleCircle(n,t){const e=n.worldPos,i=t.worldPos,s=n.radius+t.radius,r=e.distance(i);if(r>s)return[];const o=s-r,l=i.sub(e).normalize(),c=l.perpendicular(),d=l.scale(o),_=n.getFurthestPoint(l),f=n.getFurthestLocalPoint(l),g={collider:n,separation:o,axis:l,point:_};return[new wr(n,t,d,l,c,[_],[f],g)]},CollideCirclePolygon(n,t){var e,i;let s=Le.findCirclePolygonSeparation(n,t);if(!s)return[];s=s.dot(t.center.sub(n.center))<0?s.negate():s;const o=n.getFurthestPoint(s),c=((i=(e=n.owner)===null||e===void 0?void 0:e.get(J))!==null&&i!==void 0?i:new J).applyInverse(o),d=s.normalize(),_={collider:n,separation:-s.magnitude,axis:d,point:o,localPoint:c,side:t.findSide(d.negate()),localSide:t.findLocalSide(d.negate())};return[new wr(n,t,s,d,d.perpendicular(),[o],[c],_)]},CollideCircleEdge(n,t){const e=n.center,i=t.asLine(),s=i.end.sub(i.begin),r=s.dot(i.end.sub(e)),o=s.dot(e.sub(i.begin)),l=t.asLine(),c=t.asLocalLine();if(o<=0){const A=i.begin.sub(e),S=A.dot(A);if(S>n.radius*n.radius)return[];const E=A.normalize(),M=n.radius-Math.sqrt(S),O={collider:n,separation:M,axis:E,point:l.begin,side:l,localSide:c};return[new wr(n,t,E.scale(M),E,E.perpendicular(),[l.begin],[c.begin],O)]}if(r<=0){const A=i.end.sub(e),S=A.dot(A);if(S>n.radius*n.radius)return[];const E=A.normalize(),M=n.radius-Math.sqrt(S),O={collider:n,separation:M,axis:E,point:l.end,side:l,localSide:c};return[new wr(n,t,E.scale(M),E,E.perpendicular(),[l.end],[c.end],O)]}const d=s.dot(s),_=i.begin.scale(r).add(i.end.scale(o)).scale(1/d),f=e.sub(_),g=f.dot(f);if(g>n.radius*n.radius)return[];let m=s.perpendicular();m.dot(e.sub(i.begin))<0&&(m.x=-m.x,m.y=-m.y),m=m.normalize();const x=n.radius-Math.sqrt(g),C=m.scale(x),T={collider:n,separation:x,axis:m,point:_,side:l,localSide:c};return[new wr(n,t,C,m.negate(),m.negate().perpendicular(),[_],[_.sub(t.worldPos)],T)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(n,t){var e;const i=n.center,r=t.center.sub(i).normalize(),o=new Qe({points:[t.begin,t.end,t.end.add(r.scale(100)),t.begin.add(r.scale(100))],offset:t.offset});o.owner=t.owner,((e=t.owner)===null||e===void 0?void 0:e.get(J))&&o.update(t.owner.get(J).get());const c=this.CollidePolygonPolygon(n,o);return c.length&&(c[0].colliderB=t,c[0].id=gi.calculatePairHash(n.id,t.id)),c},CollidePolygonPolygon(n,t){const e=Le.findPolygonPolygonSeparation(n,t);if(e.separation>0)return[];const i=Le.findPolygonPolygonSeparation(t,n);if(i.separation>0)return[];const s=e.separation>i.separation?e:i,r=s.collider===n?t:n,o=s.collider===n?n:t,l=r.transform.inverse.multiply(o.transform.matrix,bI),c=l.getRotation(),d=o.normals[s.sideId].rotate(c,wI,xI);let _=Number.MAX_VALUE,f=0;for(let A=0;A<r.normals.length;A++){const S=d.dot(r.normals[A]);S<_&&(_=S,f=A)}if(!s.localSide||!s.localAxis||!s.axis)return[];const g=s.localSide.transform(l),m=s.localAxis.perpendicular().negate().rotate(c),C=new Pe(r.points[f],r.points[(f+1)%r.points.length]).clip(m.negate(),-m.dot(g.begin),!1);let T=null;if(C&&(T=C.clip(m,m.dot(g.end),!1)),T){const A=[],S=[],E=T.getPoints();for(let N=0;N<E.length;N++){const F=E[N];g.below(F)&&(A.push(F),S.push(r.transform.apply(F)))}let M=s.axis,O=M.perpendicular();return t.center.sub(n.center).dot(M)<0&&(M=M.negate(),O=M.perpendicular()),[new wr(n,t,M.scale(-s.separation),M,O,S,A,s)]}return[]},FindContactSeparation(n,t){var e,i,s,r;const o=n.colliderA,l=(i=(e=n.bodyA)===null||e===void 0?void 0:e.transform)!==null&&i!==void 0?i:new J,c=n.colliderB,d=(r=(s=n.bodyB)===null||s===void 0?void 0:s.transform)!==null&&r!==void 0?r:new J;if(o instanceof ii&&c instanceof ii){const _=o.radius+c.radius,f=l.pos.distance(d.pos);return-(_-f)}if(o instanceof Qe&&c instanceof Qe&&n.info.localSide){let _,f;return n.info.collider===o?(_=new Pe(l.apply(n.info.localSide.begin).add(o.offset),l.apply(n.info.localSide.end).add(o.offset)),f=d.apply(t).add(c.offset)):(_=new Pe(d.apply(n.info.localSide.begin).add(c.offset),d.apply(n.info.localSide.end).add(c.offset)),f=l.apply(t).add(o.offset)),_.distanceToPoint(f,!0)}if(o instanceof Qe&&c instanceof ii||c instanceof Qe&&o instanceof ii){const _=l.apply(t);if(n.info.side)return n.info.side.distanceToPoint(_,!0)}if(o instanceof Oi&&c instanceof Qe||c instanceof Oi&&o instanceof Qe){let _;if(n.info.collider===o?_=d.apply(t):_=l.apply(t),n.info.side)return n.info.side.distanceToPoint(_,!0)}if(o instanceof ii&&c instanceof Oi||c instanceof ii&&o instanceof Oi){const _=d.apply(t);let f;o instanceof ii&&(f=o.getFurthestPoint(n.normal));const g=_.distance(f);if(n.info.side)return g>0?-g:0}return 0}};class Oi extends nr{constructor(t){var e;super(),this._globalMatrix=Fe.identity(),this.begin=t.begin||I.Zero,this.end=t.end||I.Zero,this.offset=(e=t.offset)!==null&&e!==void 0?e:I.Zero}clone(){return new Oi({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){var i;const s=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&s.cross(t.dir)!==0)return null;const r=t.dir.cross(this.getSlope());if(r===0)return null;const o=s.cross(this.getSlope())/r;if(o>=0&&o<=e){const l=s.cross(t.dir)/r/this.getLength();if(l>=0&&l<=1)return{distance:o,normal:this.asLine().normal(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Gt),point:t.getPoint(o)}}return null}getClosestLineBetween(t){if(t instanceof ii)return Ns.CircleEdgeClosestLine(t,this);if(t instanceof Qe)return Ns.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Oi)return Ns.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ii)return Ss.CollideCircleEdge(t,this);if(t instanceof Qe)return Ss.CollidePolygonEdge(t,this);if(t instanceof Oi)return Ss.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new at(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Pe(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Pe(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),i=[];return i.push(e),i.push(e.negate()),i.push(e.normal()),i.push(e.normal().negate()),i}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let r=0;r<s;r++)e.push(i[r].dot(t));return new wl(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.drawLine(i,s,e,2),t.drawCircle(i,2,e),t.drawCircle(s,2,e)}}class je{static registerGraphicsContext(t){je._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,e){je.draw(i=>{i.debug.drawPoint(t,e)})}static drawLine(t,e,i){je.draw(s=>{s.debug.drawLine(t,e,i)})}static drawLines(t,e){t.length>1&&je.draw(i=>{for(let s=0;s<t.length-1;s++)i.debug.drawLine(t[s],t[s+1],e)})}static drawText(t,e){je.draw(i=>{i.debug.drawText(t,e)})}static drawPolygon(t,e){t.length>1&&je.draw(i=>{const s=t[0],r=[...t,s];for(let o=0;o<r.length-1;o++)i.debug.drawLine(r[o],r[o+1],e)})}static drawCircle(t,e,i){const{color:s,strokeColor:r,width:o}={color:$.Black,strokeColor:void 0,width:void 0,...i};je.draw(l=>{l.drawCircle(t,e,s,r,o)})}static drawBounds(t,e){je.draw(i=>{i.debug.drawRect(t.left,t.top,t.width,t.height,e)})}static drawRay(t,e){const{distance:i,color:s}={color:$.Blue,distance:10,...e};je.draw(r=>{const o=t.pos,l=t.pos.add(t.dir.scale(i));r.debug.drawLine(o,l,{color:s})})}static flush(t){t.save(),t.z=je.z;for(const e of je._drawCalls)e(t);t.restore(),je.clear()}static clear(){je._drawCalls.length=0}}je._drawCalls=[];je.z=1/0;class Qe extends nr{flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}get normals(){return this._normals}set points(t){if(t.length<3)throw new Error("PolygonCollider cannot be created with less that 3 points");this._points=t,this._checkAndUpdateWinding(this._points),this._calculateNormals(),this.flagDirty()}_calculateNormals(){const t=[];for(let e=0;e<this._points.length;e++)t.push(this._points[(e+1)%this._points.length].sub(this._points[e]).normal());this._normals=t}get points(){return this._points}get transform(){return this._transform}constructor(t){var e;super(),this._logger=lt.getInstance(),this._transform=new Sn,this._transformedPoints=[],this._sides=[],this._localSides=[],this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!==null&&e!==void 0?e:I.Zero,this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y,this.points=t.points,this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_checkAndUpdateWinding(t){this._isCounterClockwiseWinding(t)||t.reverse()}_isCounterClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),s=0,r=0,o=0;for(const[l,c]of this.points.entries()){if(t=e,s=i,e=c,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let d=i-s;if(d<=-Math.PI?d+=Math.PI*2:d>Math.PI&&(d-=Math.PI*2),l===0){if(d===0)return!1;r=d>0?1:-1}else if(r*d<=0)return!1;o+=d}return Math.abs(Math.round(o/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Ve(t.map(e=>si.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],e=[...this.points].reverse();let i=e.length;function s(f){return f===0?i-1:f-1}function r(f){return f===i-1?0:f+1}function o(f){const g=s(f),m=r(f),x=e[g],C=e[f],T=e[m],A=x.sub(C),S=T.sub(C);return!(A.cross(S)<0)}const l=e.map((f,g)=>o(g));function c(f,g,m,x){const C=m.sub(g),T=x.sub(m),A=g.sub(x),S=f.sub(g),E=f.sub(m),M=f.sub(x),O=C.cross(S),N=T.cross(E),F=A.cross(M);return!(O>0||N>0||F>0)}function d(){for(let f=0;f<i;f++)if(l[f]){const g=s(f),m=r(f),x=e[g],C=e[f],T=e[m];let A=!0;for(let S=0;S<i;S++){if(S===f||S===g||S===m)continue;const E=e[S];if(c(E,x,C,T)){A=!1;break}}if(A)return f}for(let f=0;f<i;f++)if(l[f])return f;return 0}function _(f){const g=s(f),m=r(f),x=e[g],C=e[f],T=e[m];t.push([x,C,T]),e.splice(f,1),l.splice(f,1),i--}for(;i>3;){const f=d();_(f);for(let g=0;g<i;g++)l[g]=o(g)}return t.push([e[0],e[1],e[2]]),new Ve(t.map(f=>si.Polygon(f,I.Zero,!0)))}clone(){return new Qe({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform.pos}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let i=0;i<e;i++)this._transformedPoints[i]=this._transform.apply(t[i].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new Pe(e[s],e[(s+1)%i]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,i=e.length;for(let s=0;s<i;s++)t.push(new Pe(e[s],e[(s+1)%i]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],c=o.normal().dot(t);c>s&&(i=o,s=c)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],c=o.normal().dot(t);c>s&&(i=o,s=c)}return i}get axes(){const t=[],e=this.getSides();for(let i=0;i<e.length;i++)t.push(e[i].normal());return t}update(t){t&&(t.cloneWithParent(this._transform),this._transformedPointsDirty=!0,this._sidesDirty=!0,(this.offset.x!==0||this.offset.y!==0)&&(this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y),this._transform.isMirrored()&&(this.points=this.points.map(e=>D(e.x*ne(this._transform.scale.x),e.y*ne(this._transform.scale.y))),this._transform.scale.x=Math.abs(this._transform.scale.x),this._transform.scale.y=Math.abs(this._transform.scale.y)))}contains(t){const e=this._transform.applyInverse(t),i=new yr(e,new I(1,0));let s=0;const r=this.getLocalSides();for(let o=0;o<r.length;o++){const l=r[o];i.intersect(l)>=0&&s++}return s%2!==0}getClosestLineBetween(t){if(t instanceof ii)return Ns.PolygonCircleClosestLine(this,t);if(t instanceof Qe)return Ns.PolygonPolygonClosestLine(this,t);if(t instanceof Oi)return Ns.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ii)return Ss.CollideCirclePolygon(t,this);if(t instanceof Qe)return Ss.CollidePolygonPolygon(this,t);if(t instanceof Oi)return Ss.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,r=-1;for(let o=0;o<e.length;o++){const l=e[o].distanceToPoint(t);l<i&&(i=l,s=o,r=l)}return s!==-1?{distance:e[s].normal().scale(r),face:e[s]}:null}get bounds(){return this.localBounds.transform(this._transform.matrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=at.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,i=0;const s=this.points;for(let r=0;r<s.length;r++){const o=(r+1)%s.length,l=s[o].cross(s[r]);e+=l*(s[r].dot(s[r])+s[r].dot(s[o])+s[o].dot(s[o])),i+=l}return this._cachedMass=t,this._cachedInertia=t/6*(e/i)}rayCast(t,e=1/0){var i;const s=this.getSides(),r=s.length;let o=Number.MAX_VALUE,l,c=-1;for(let d=0;d<r;d++){const _=t.intersect(s[d]);_>=0&&_<o&&_<=e&&(o=_,l=s[d],c=d)}return c>=0?{collider:this,distance:o,body:(i=this.owner)===null||i===void 0?void 0:i.get(Gt),point:t.getPoint(o),normal:l.normal()}:null}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let o=0;o<i;o++){const l=e[o].dot(t);s=Math.min(s,l),r=Math.max(r,l)}return new wl(s,r)}debug(t,e,i){const s=this.getTransformedPoints();je.drawPolygon(s,{color:e})}}class si{static Box(t,e,i=I.Half,s=I.Zero){return new Qe({points:new at(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=I.Zero,i=!1){return new Qe({points:t,offset:e,suppressConvexWarning:i})}static Circle(t,e=I.Zero){return new ii({radius:t,offset:e})}static Edge(t,e){return new Oi({begin:t,end:e})}static Capsule(t,e,i=I.Zero){const s=lt.getInstance();return t===e&&s.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t?new Ve([si.Circle(t/2,D(0,-e/2+t/2).add(i)),si.Box(t,e-t,I.Half,i),si.Circle(t/2,D(0,e/2-t/2).add(i))]):new Ve([si.Circle(e/2,D(-t/2+e/2,0).add(i)),si.Box(t-e,e,I.Half,i),si.Circle(e/2,D(t/2-e/2,0).add(i))])}}class Be extends hs{constructor(t){super(),this.events=new de,this.$colliderAdded=new pi,this.$colliderRemoved=new pi,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new Be(this._collider.clone())}get bounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new at}get localBounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new at}update(){var t;const e=(t=this.owner)===null||t===void 0?void 0:t.get(J);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let s=!1;if(i instanceof Ve&&(e=i,i=this._collider,s=!0),this._collider){const r=e.collide(i);return r?(s&&r.forEach(o=>{o.mtv=o.mtv.negate(),o.normal=o.normal.negate(),o.tangent=o.normal.perpendicular(),o.colliderA=this._collider,o.colliderB=t._collider}),r):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const i=e;t.events.emit("precollision",new Rr(i.self,i.other,i.side,i.intersection,i.contact)),t instanceof mi&&t.onPreCollisionResolve(i.self,i.other,i.side,i.contact)}),this.events.on("postcollision",e=>{const i=e;t.events.emit("postcollision",new Mr(i.self,i.other,i.side,i.intersection,i.contact)),t instanceof mi&&t.onPostCollisionResolve(i.self,i.other,i.side,i.contact)}),this.events.on("collisionstart",e=>{const i=e;t.events.emit("collisionstart",new Oa(i.self,i.other,i.side,i.contact)),t instanceof mi&&t.onCollisionStart(i.self,i.other,i.side,i.contact)}),this.events.on("collisionend",e=>{const i=e;t.events.emit("collisionend",new Ua(i.self,i.other,i.side,i.lastContact)),t instanceof mi&&t.onCollisionEnd(i.self,i.other,i.side,i.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=I.Half,s=I.Zero){const r=si.Box(t,e,i,s);return this.set(r)}usePolygonCollider(t,e=I.Zero){const i=si.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=I.Zero){const i=si.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=si.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new Ve(t))}}var Si;(function(n){n.Rotation="rotation",n.X="x",n.Y="y"})(Si||(Si={}));class Gt extends hs{constructor(t){var e,i,s;super(),this.dependencies=[J,Zt],this.id=Pr("body",Gt._ID++),this.events=new de,this.oldTransform=new Sn,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=ft.PreventCollision,this.group=Tn.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this._oldGlobalPos=I.Zero,this.oldVel=new I(0,0),this.oldAcc=I.Zero,this._impulseScratch=D(0,0),this._distanceFromCenterScratch=D(0,0),t?(this.collisionType=(e=t.type)!==null&&e!==void 0?e:this.collisionType,this.group=(i=t.group)!==null&&i!==void 0?i:this.group,this.useGravity=(s=t.useGravity)!==null&&s!==void 0?s:this.useGravity,this._bodyConfig={...bn().bodies,...t.config}):this._bodyConfig={...bn().bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=Gt._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={...bn().bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){Gt._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===ft.Fixed?0:1/this.mass}get sleeping(){return this.isSleeping}get isSleeping(){return this._sleeping}setSleeping(t){this.isSleeping=t}set isSleeping(t){this._sleeping=t,t?(this.vel=I.Zero,this.acc=I.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&(this.isSleeping=!0);const t=this.vel.magnitude*this.vel.magnitude+Math.abs(this.angularVelocity*this.angularVelocity),e=this._bodyConfig.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=Ut(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&(this.isSleeping=!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Be);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===ft.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.isActive)}get isActive(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.isActive)}get center(){return this.globalPos}onAdd(t){var e,i;this.transform=(e=this.owner)===null||e===void 0?void 0:e.get(J),this.motion=(i=this.owner)===null||i===void 0?void 0:i.get(Zt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get oldGlobalPos(){return this._oldGlobalPos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==ft.Active)return;const i=e.scale(this.inverseMass,this._impulseScratch);if(this.limitDegreeOfFreedom.indexOf(Si.X)>-1&&(i.x=0),this.limitDegreeOfFreedom.indexOf(Si.Y)>-1&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(Si.Rotation)){const s=t.sub(this.globalPos,this._distanceFromCenterScratch);this.angularVelocity+=this.inverseInertia*s.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==ft.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(Si.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(Si.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===ft.Active&&!this.limitDegreeOfFreedom.includes(Si.Rotation)){const i=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldGlobalPos.setTo(this.globalPos.x,this.globalPos.y)}clone(){return super.clone()}}Gt._ID=0;Gt._DEFAULT_CONFIG={...bn().bodies};class xl extends No{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new xl({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class yc extends No{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var e,i,s;super(t),this._radius=0;const r=(e=t.lineWidth)!==null&&e!==void 0?e:t.strokeColor?1:0;this.padding=(i=t.padding)!==null&&i!==void 0?i:2+r/2,this.radius=t.radius,this.filtering=(s=t.filtering)!==null&&s!==void 0?s:Oe.Blended,this.rasterize()}clone(){return new yc({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Qn extends hs{constructor(t){var e,i;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(e=t==null?void 0:t.useColliderShape)!==null&&e!==void 0?e:this.useColliderShape,this.useGraphicsBounds=(i=t==null?void 0:t.useGraphicsBounds)!==null&&i!==void 0?i:this.useGraphicsBounds,this.localBounds=t==null?void 0:t.localBounds}}class ee{static CreateReversibleEasingFunction(t){return(e,i,s,r)=>s<i?i-(t(e,s,i,r)-s):t(e,i,s,r)}static CreateVectorEasingFunction(t){return(e,i,s,r)=>new I(t(e,i.x,s.x,r),t(e,i.y,s.y,r))}}ee.Linear=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,e*n/i+t));ee.EaseInQuad=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n+t));ee.EaseOutQuad=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,-e*n*(n-2)+t));ee.EaseInOutQuad=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n+t:(n--,-e/2*(n*(n-2)-1)+t)));ee.EaseInCubic=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n*n+t));ee.EaseOutCubic=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,n--,e*(n*n*n+1)+t));ee.EaseInOutCubic=ee.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n*n+t:(n-=2,e/2*(n*n*n+2)+t)));class Uw{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}getIncompleteActions(){return this._actions}getCurrentAction(){return this._currentAction}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new nf(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new rf(this._currentAction,this._entity));const e=this._actions.shift();e&&this._completedActions.push(e)}}}let yI=0;function Jt(){return yI++}class zw{constructor(t,e,i){this.id=Jt(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Cl(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Hw{constructor(t,e){this.id=Jt(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Cl(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}function Ww(n,t,e){return(1-e)*n+t*e}function ff(n,t,e,i){const s=(n-t+He)%He>=Math.PI,r=Math.abs(t-n),o=He-r;let l=0,c=0;r>o?(l=o,c=r):(l=r,c=o);let d=0,_=1;switch(e){case ye.ShortestPath:d=l,_=s?1:-1;break;case ye.LongestPath:d=c,_=s?-1:1;break;case ye.Clockwise:_=1,d=s?l:c;break;case ye.CounterClockwise:_=-1,d=s?c:l;break}return n+_*(d*i)}function bl(n,t,e){return n.scale(1-e).add(t.scale(e))}function Nw(n,t,e){return(e-n)/(t-n)}function Gw(n,t,e){const i=e.sub(n),s=t.sub(n),r=i.x/s.x,o=i.y/s.y;return Math.min(r,o)}function Vs(n,t,e,i,s){const r=Nw(n,t,s);return Ww(e,i,r)}function CI(n,t,e,i,s){const r=Gw(n,t,s);return bl(e,i,r)}function $w(n){return n.offset instanceof I&&typeof n.duration=="number"}class jw{constructor(t,e){var i;if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._easing=ee.Linear,this._offset=e.offset,this._easing=(i=e.easing)!==null&&i!==void 0?i:this._easing,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._end=this._start.add(this._offset),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=this._tx.pos,s=this._easing(e,this._start.x,this._end.x,1),r=this._easing(e,this._start.y,this._end.y,1),o=(s-i.x)/(t/1e3),l=(r-i.y)/(t/1e3);this._motion.vel.x=o,this._motion.vel.y=l,this.isComplete(this.entity)&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=D(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class ju{constructor(t,e,i,s){if(this.id=Jt(),this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(J),this._motion=t.get(Zt),this._speed=s,this._offset=new I(e,i),s<=0)throw lt.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new I(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.magnitude,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(J);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function qw(n){return n.pos instanceof I&&typeof n.duration=="number"}class Vw{constructor(t,e){var i;if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._easing=ee.Linear,this._end=e.pos,this._easing=(i=e.easing)!==null&&i!==void 0?i:this._easing,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=this._tx.pos,s=this._easing(e,this._start.x,this._end.x,1),r=this._easing(e,this._start.y,this._end.y,1),o=(s-i.x)/(t/1e3),l=(r-i.y)/(t/1e3);this._motion.vel.x=o,this._motion.vel.y=l,this.isComplete(this.entity)&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=D(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class qu{constructor(t,e,i,s){this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._end=new I(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new I(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=D(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(t){const e=t.get(J);return this._stopped||new I(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function AI(n){return typeof n.angle=="number"&&typeof n.duration=="number"}class Xw{constructor(t,e){var i;if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._endAngle=0,this._startAngle=0,this._endAngle=e.angle,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(i=e.rotationType)!==null&&i!==void 0?i:ye.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=ff(this._startAngle,this._endAngle,this._rotationType,e),s=this._tx.rotation,r=(i-s)/(t/1e3);this._motion.angularVelocity=r,this.isComplete(this.entity)&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class Zw{constructor(t,e,i,s){this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._end=e,this._speed=i,this._rotationType=s||ye.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),i=He-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+He)%He>=Math.PI,this._rotationType){case ye.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ye.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ye.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ye.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function SI(n){return typeof n.angleRadiansOffset=="number"&&typeof n.duration=="number"}class Yw{constructor(t,e){var i;if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._offset=0,this._startAngle=0,this._endAngle=0,this._offset=e.angleRadiansOffset,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(i=e.rotationType)!==null&&i!==void 0?i:ye.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._endAngle=wn(this._startAngle+this._offset),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=ff(this._startAngle,this._endAngle,this._rotationType,e),s=this._tx.rotation,r=(i-s)/(t/1e3);this._motion.angularVelocity=r,this.isComplete()&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class Qw{constructor(t,e,i,s){this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._speed=i,this._offset=e,this._rotationType=s||ye.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),i=He-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+He)%He>=Math.PI,this._rotationType){case ye.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ye.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ye.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ye.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}function Kw(n){return typeof n.scale=="object"&&typeof n.duration=="number"}class Jw{constructor(t,e){if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._endScale=D(1,1),this._startScale=D(1,1),this._endScale=e.scale,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=bl(this._startScale,this._endScale,e),s=this._tx.scale,r=i.sub(s).scale(1/(t/1e3));this._motion.scaleFactor=r,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=I.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class t0{constructor(t,e,i,s,r){this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._endX=e,this._endY=i,this._speedX=s,this._speedY=r}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=D(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function e0(n){return typeof n.scaleOffset=="object"&&typeof n.duration=="number"}class i0{constructor(t,e){if(this.entity=t,this.id=Jt(),this._started=!1,this._stopped=!1,this._endScale=D(1,1),this._scaleOffset=D(0,0),this._startScale=D(1,1),this._scaleOffset=e.scaleOffset,this._tx=t.get(J),this._motion=t.get(Zt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._endScale=this._startScale.add(this._scaleOffset),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=bl(this._startScale,this._endScale,e),s=this._tx.scale,r=i.sub(s).scale(1/(t/1e3));this._motion.scaleFactor=r,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=I.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class s0{constructor(t,e,i,s){this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._offset=new I(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Wm{constructor(t){this.id=Jt(),this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class n0{constructor(t,e,i,s,r){this.easingFcn=r,this.id=Jt(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new I(0,0),this._lerpEnd=new I(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._lerpDuration=s,this._lerpEnd=new I(e,i)}_initialize(){this._lerpStart=new I(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=D((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=D(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=I.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=D(0,0),this._stopped=!0}}class r0{constructor(t,e,i,s,r){this.easingFcn=r,this.id=Jt(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new I(0,0),this._lerpEnd=new I(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._lerpDuration=s,this._offset=new I(e,i)}_initialize(){this._lerpStart=new I(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=D((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=D(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=I.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=D(0,0),this._stopped=!0}}class o0{constructor(t,e,i,s=1){this.id=Jt(),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Ae),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.isVisible&&this._elapsedTime>=this._timeVisible&&(this._graphics.isVisible=!1,this._elapsedTime=0),!this._graphics.isVisible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.isVisible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.isVisible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class a0{constructor(t,e,i){this.id=Jt(),this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Ae),this._endOpacity=e,this._remainingTime=this._originalTime=i}update(t){this._graphics&&(this._started||(this._started=!0,this._remainingTime=this._originalTime,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._remainingTime>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._remainingTime),this._remainingTime-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),lt.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||this._remainingTime<=0}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._remainingTime=this._originalTime}}class l0{constructor(t){this.id=Jt(),this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class h0{constructor(t){this.id=Jt(),this._stopped=!1,this._entity=t}update(t){this._entity.get(fo).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Vu{constructor(t,e,i){this.id=Jt(),this._started=!1,this._stopped=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._followTx=e.get(J),this._followMotion=e.get(Zt),this._current=new I(this._tx.pos.x,this._tx.pos.y),this._end=new I(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=i!==void 0?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=D(this._tx.pos.x,this._tx.pos.y),this._end=D(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const i=this._dir.scale(this._speed);this._motion.vel=D(i.x,i.y)}else this._motion.vel=D(0,0);this.isComplete()&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}stop(){this._motion.vel=D(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class Xu{constructor(t,e,i){this.id=Jt(),this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(J),this._motion=t.get(Zt),this._meetTx=e.get(J),this._meetMotion=e.get(Zt),this._current=new I(this._tx.pos.x,this._tx.pos.y),this._end=new I(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,i!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=D(this._tx.pos.x,this._tx.pos.y),this._end=D(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=D(i.x,i.y),this.isComplete()&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=1/0}}class c0{constructor(t,e,i=1e3){var s;this.id=Jt(),this._stopped=!1,this._started=!1,this._total=0,this._currentDuration=0,this._graphics=t.get(Ae),this._duration=i,this._entity=t,this._material=(s=t.scene)===null||s===void 0?void 0:s.engine.graphicsContext.createMaterial({name:"flash-material",color:e,fragmentSource:`#version 300 es
    
        precision mediump float;
        uniform float u_blend;
        uniform sampler2D u_graphic;
        uniform vec4 u_color;
    
        in vec2 v_uv; 
        out vec4 color;
    
        void main() { 
            vec4 textureColor = texture(u_graphic, v_uv); 
            color = mix(textureColor, u_color, u_blend * textureColor.a);
            color.rgb = color.rgb * color.a;
        }`}),this._total=i}update(t){var e;this._started||(this._started=!0,this._total=this._duration,this._currentDuration=this._duration,this._entity.graphics.material=this._material),this._graphics&&(this._currentDuration-=t,this._graphics&&((e=this._material)===null||e===void 0||e.update(i=>{i.trySetUniformFloat("u_blend",this._currentDuration/this._total)})),this.isComplete()&&(this._entity.graphics.material=null))}isComplete(){return this._stopped||this._currentDuration<=0}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class yl{constructor(t){var e;if(this._distLookup=[],this.quality=4,t.controlPoints.length!==4)throw new Error("Only cubic bezier curves are supported");this._controlPoints=[...t.controlPoints],this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this._calculateLookup()}get arcLength(){return this._arcLength}get controlPoints(){return this._controlPoints}set controlPoints(t){this._controlPoints=[...t],this._calculateLookup()}setControlPoint(t,e){this._controlPoints[t]=e,this._calculateLookup()}_calculateLookup(){let t=0;this._distLookup.length=0;let e=this.controlPoints[0];const i=this.controlPoints.length*this.quality;for(let s=0;s<i;s++){const r=s/(i-1),o=this.getPoint(r),l=e.distance(o);t+=l,this._distLookup.push(t),e=o}this._arcLength=t}_getTimeGivenDistance(t){const e=this._distLookup.length,i=this.arcLength;if(t>=0&&t<i){for(let s=0;s<e-1;s++)if(this._distLookup[s]<=t&&t<this._distLookup[s+1])return Vs(this._distLookup[s],this._distLookup[s+1],s/(e-1),(s+1)/(e-1),t)}return t/i}getPoint(t){const e=[...this.controlPoints];for(let i=1;i<e.length;i++)for(let s=0;s<e.length-i;s++)e[s]=bl(e[s],e[s+1],t);return e[0]}getTangent(t){const e=t*t,i=this.controlPoints[0],s=this.controlPoints[1],r=this.controlPoints[2],o=this.controlPoints[3];return i.scale(-3*e+6*t-3).add(s.scale(9*e-12*t+3).add(r.scale(-9*e+6*t).add(o.scale(3*e)))).normalize()}getUniformTangent(t){const e=t*this.arcLength,i=this._getTimeGivenDistance(e);return this.getTangent(i)}getNormal(t){return this.getTangent(t).normal()}getUniformNormal(t){return this.getUniformTangent(t).normal()}getUniformPoint(t){const e=t*this.arcLength,i=this._getTimeGivenDistance(e);return this.getPoint(i)}clone(){return new yl({controlPoints:[...this.controlPoints],quality:this.quality})}}class d0{constructor(t,e){var i;if(this.id=Jt(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=t,this._tx=this._entity.get(J),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=new yl({controlPoints:[D(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(i=e.mode)!==null&&i!==void 0?i:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos.clone()),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0,this._currentMs=0}}class u0{constructor(t,e){var i;if(this.id=Jt(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=t,this._tx=this._entity.get(J),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=this._curve=new yl({controlPoints:[D(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(i=e.mode)!==null&&i!==void 0?i:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos),this._curve.setControlPoint(1,this._curve.controlPoints[1].add(this._tx.globalPos)),this._curve.setControlPoint(2,this._curve.controlPoints[2].add(this._tx.globalPos)),this._curve.setControlPoint(3,this._curve.controlPoints[3].add(this._tx.globalPos)),this._started=!0),this._currentMs-=t;const e=Ut(Vs(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0}}class Cl{constructor(t){this._entity=t,this._queue=new Uw(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}curveBy(t){return this._queue.add(new u0(this._entity,t)),this}curveTo(t){return this._queue.add(new d0(this._entity,t)),this}easeTo(...t){var e,i;let s=0,r=0,o=0,l=ee.Linear;return t[0]instanceof I?(s=t[0].x,r=t[0].y,o=t[1],l=(e=t[2])!==null&&e!==void 0?e:l):(s=t[0],r=t[1],o=t[2],l=(i=t[3])!==null&&i!==void 0?i:l),this._queue.add(new n0(this._entity,s,r,o,l)),this}easeBy(...t){var e,i;let s=0,r=0,o=0,l=ee.Linear;return t[0]instanceof I?(s=t[0].x,r=t[0].y,o=t[1],l=(e=t[2])!==null&&e!==void 0?e:l):(s=t[0],r=t[1],o=t[2],l=(i=t[3])!==null&&i!==void 0?i:l),this._queue.add(new r0(this._entity,s,r,o,l)),this}moveTo(t,e,i){let s=0,r=0,o=0;return t instanceof I?(s=t.x,r=t.y,o=+(e??0),this._queue.add(new qu(this._entity,s,r,o))):typeof t=="number"&&typeof e=="number"&&typeof i=="number"?(s=t,r=e,o=i,this._queue.add(new qu(this._entity,s,r,o))):qw(t)&&this._queue.add(new Vw(this._entity,t)),this}moveBy(t,e,i){let s=0,r=0,o=0;return t instanceof I&&typeof e=="number"?(s=t.x,r=t.y,o=e,this._queue.add(new ju(this._entity,s,r,o))):typeof t=="number"&&typeof e=="number"&&typeof i=="number"?(s=t,r=e,o=i,this._queue.add(new ju(this._entity,s,r,o))):$w(t)&&this._queue.add(new jw(this._entity,t)),this}rotateTo(t,e,i){return typeof t=="number"&&typeof e=="number"?this._queue.add(new Zw(this._entity,t,e,i)):typeof t=="object"&&this._queue.add(new Xw(this._entity,t)),this}rotateBy(t,e,i){return typeof t=="object"?this._queue.add(new Yw(this._entity,t)):this._queue.add(new Qw(this._entity,t,e,i)),this}scaleTo(t,e,i,s){let r=1,o=1,l=0,c=0;return Kw(t)?(this._queue.add(new Jw(this._entity,t)),this):(t instanceof I&&e instanceof I&&(r=t.x,o=t.y,l=e.x,c=e.y),typeof t=="number"&&typeof e=="number"&&(r=t,o=e,l=i,c=s),this._queue.add(new t0(this._entity,r,o,l,c)),this)}scaleBy(t,e,i){if(e0(t))return this._queue.add(new i0(this._entity,t)),this;let s=1,r=1;return t instanceof I&&(s=t.x,r=t.y,i=e),typeof t=="number"&&typeof e=="number"&&(s=t,r=e),this._queue.add(new s0(this._entity,s,r,i)),this}blink(t,e,i=1){return this._queue.add(new o0(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new a0(this._entity,t,e)),this}flash(t,e=1e3){return this._queue.add(new c0(this._entity,t,e)),this}delay(t){return this._queue.add(new l0(t)),this}die(){return this._queue.add(new h0(this._entity)),this}callMethod(t){return this._queue.add(new Wm(t)),this}repeat(t,e){return e?(this._queue.add(new zw(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Hw(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new Vu(this._entity,t)):this._queue.add(new Vu(this._entity,t,e)),this}meet(t,e){return e===void 0?this._queue.add(new Xu(this._entity,t)):this._queue.add(new Xu(this._entity,t,e)),this}toPromise(){return new Promise(e=>{this._queue.add(new Wm(()=>{e()}))})}}class fo extends hs{constructor(){super(...arguments),this.dependencies=[J,Zt],this._ctx=null}onAdd(t){this._ctx=new Cl(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}curveBy(t){return this._getCtx().curveBy.apply(this._ctx,[t])}curveTo(t){return this._getCtx().curveTo.apply(this._ctx,[t])}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,e,i){return this._getCtx().moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._getCtx().moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._getCtx().rotateTo.apply(this._ctx,[t,e,i])}rotateBy(t,e,i){return this._getCtx().rotateBy.apply(this._ctx,[t,e,i])}scaleTo(t,e,i,s){return this._getCtx().scaleTo.apply(this._ctx,[t,e,i,s])}scaleBy(t,e,i){return this._getCtx().scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._getCtx().blink(t,e,i)}fade(t,e){return this._getCtx().fade(t,e)}flash(t,e=1e3){return this._getCtx().flash(t,e)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,e){return this._getCtx().repeat(t,e)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,e){return this._getCtx().follow(t,e)}meet(t,e){return this._getCtx().meet(t,e)}toPromise(){return this._getCtx().toPromise()}}function TI(n){return n instanceof mi}const EI={CollisionStart:"collisionstart",CollisionEnd:"collisionend",PreCollision:"precollision",PostCollision:"postcollision",Kill:"kill",PreKill:"prekill",PostKill:"postkill",PreDraw:"predraw",PostDraw:"postdraw",PreTransformDraw:"pretransformdraw",PostTransformDraw:"posttransformdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerEnter:"pointerenter",PointerLeave:"pointerleave",PointerMove:"pointermove",PointerCancel:"pointercancel",Wheel:"pointerwheel",PointerDrag:"pointerdragstart",PointerDragEnd:"pointerdragend",PointerDragEnter:"pointerdragenter",PointerDragLeave:"pointerdragleave",PointerDragMove:"pointerdragmove",EnterViewPort:"enterviewport",ExitViewPort:"exitviewport",ActionStart:"actionstart",ActionComplete:"actioncomplete"};class mi extends oi{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}get oldGlobalPos(){return this.body.oldGlobalPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(J).scale}set scale(t){this.get(J).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=ws(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=ws(t,e=>this._handleOffsetChange(e)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this.graphics.color}set color(t){this.graphics.color=t}constructor(t){super(),this.events=new de,this._anchor=ws(I.Half,nt=>this._handleAnchorChange(nt)),this._offset=ws(I.Zero,nt=>this._handleOffsetChange(nt)),this.logger=lt.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=nt=>{this._dragging&&(this.pos=nt.worldPos)},this._pointerDragLeaveHandler=nt=>{this._dragging&&(this.pos=nt.worldPos)};const{name:e,x:i,y:s,pos:r,coordPlane:o,scale:l,width:c,height:d,radius:_,collider:f,vel:g,acc:m,rotation:x,angularVelocity:C,z:T,color:A,visible:S,opacity:E,anchor:M,offset:O,collisionType:N,collisionGroup:F,silenceWarnings:K}={...t};this.name=e??this.name,this.anchor=M??mi.defaults.anchor.clone(),this.offset=O??I.Zero,this.transform=new J,this.addComponent(this.transform),this.pos=r??D(i??0,s??0),this.rotation=x??0,this.scale=l??D(1,1),this.z=T??0,this.transform.coordPlane=o??Ke.World,this._silenceWarnings=K??!1,this.pointer=new Qn,this.addComponent(this.pointer),this.graphics=new Ae({anchor:this.anchor,offset:this.offset,opacity:E}),this.addComponent(this.graphics),this.motion=new Zt,this.addComponent(this.motion),this.vel=g??I.Zero,this.acc=m??I.Zero,this.angularVelocity=C??0,this.actions=new fo,this.addComponent(this.actions),this.body=new Gt,this.addComponent(this.body),this.body.collisionType=N??ft.Passive,F&&(this.body.group=F),A&&(this.color=A),f?(this.collider=new Be(f),this.addComponent(this.collider)):_?(this.collider=new Be(si.Circle(_)),this.addComponent(this.collider),A&&this.graphics.add(new yc({color:A,radius:_}))):c>0&&d>0?(this.collider=new Be(si.Box(c,d,this.anchor)),this.addComponent(this.collider),A&&c&&d&&this.graphics.add(new xl({color:A,width:c,height:d}))):(this.collider=new Be,this.addComponent(this.collider)),this.graphics.isVisible=S??!0}clone(){const t=new mi({silenceWarnings:this._silenceWarnings,color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),t.addComponent(t.collider=this.collider.clone(),!0);const e=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],i=this.getComponents();for(const s of i)e.includes(s)||t.addComponent(s.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_prekill(t){this.events.emit("prekill",new F_(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new B_(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new wc(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.isActive=!0}isKilled(){return!this.isActive}get z(){return this.get(J).z}set z(t){this.get(J).z=t}get center(){const t=this.getGlobalPos();return new I(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new I(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(J).globalRotation}get globalRotation(){return this.get(J).globalRotation}getGlobalPos(){return this.get(J).globalPos}get globalPos(){return this.get(J).globalPos}getGlobalScale(){return this.get(J).globalScale}get globalScale(){return this.get(J).globalScale}get globalZ(){return this.get(J).globalZ}contains(t,e,i=!1){const s=D(t,e),r=this.get(Be);r.update();const o=r.get();if(!o)return!1;const l=o.contains(s);return i?l||this.children.some(c=>c.contains(t,e,!0)):l}within(t,e){const i=this.get(Be),s=t.get(Be),r=i.get(),o=s.get();return r&&o?r.getClosestLineBetween(o).getLength()<=e:!1}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e),this._postupdate(t,e),this._remove(t)}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreCollisionResolve(t,e,i,s){}onPostCollisionResolve(t,e,i,s){}onCollisionStart(t,e,i,s){}onCollisionEnd(t,e,i,s){}_preupdate(t,e){this.events.emit("preupdate",new ir(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new sr(t,e,this)),this.onPostUpdate(t,e)}}mi.defaults={anchor:I.Half};function _0(n){return n instanceof pf}class pf extends mi{constructor(t){var e,i;super({...t}),this.get(J).coordPlane=Ke.Screen,this.anchor=(e=t==null?void 0:t.anchor)!==null&&e!==void 0?e:D(0,0),this.body.collisionType=(i=t==null?void 0:t.collisionType)!==null&&i!==void 0?i:ft.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(t!=null&&t.collider)&&(t==null?void 0:t.width)>0&&(t==null?void 0:t.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new I(t,e));return super.contains(s.x,s.y)}}class Sr{get complete(){return this._complete}constructor(t){var e;this._logger=lt.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null;const i=(e=t.action)!==null&&e!==void 0?e:t.fcn,s=t.interval,r=t.repeats,o=t.numberOfRepeats,l=t.randomRange,c=t.random;if(o&&o>=0&&(this.maxNumberOfRepeats=o,!r))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Sr._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=s,l){if(l[0]>l[1])throw new Error("min value must be lower than max value for range");this.random=c??new zo,this.randomRange=l,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=r||this.repeats,i&&this.on(i)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}Sr._MAX_ID=0;class Cc extends hs{constructor(t){super(),this.parallaxFactor=D(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Ac extends hs{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e}}function Nm(n){return n&&n._dispatchPointerEvents&&n._processPointerToObject}class PI{get events(){return this.object.events}init(t,e,i){this.object=t,this.contains=e,this.active=i}}class gf{constructor(){this._proxyPool=new fl(()=>new PI,t=>t,100),this._objectToProxy=new Map,this._proxies=[],this._lastFrameObjectToPointers=new Map,this._currentFrameObjectToPointers=new Map}addObject(t,e,i){const s=this._proxyPool.rent(!1);s.init(t,e,i),this._proxies.push(s),this._objectToProxy.set(t,s)}_getProxy(t){const e=this._objectToProxy.get(t);if(e)return e;throw new Error("No PointerTargetProxy for object")}removeObject(t){const e=this._objectToProxy.get(t);if(e){const i=this._proxies.indexOf(e);i>-1&&this._proxies.splice(i,1),this._proxyPool.return(e)}}_objectCurrentlyUnderPointer(t,e){return!!(this._currentFrameObjectToPointers.has(t)&&this._currentFrameObjectToPointers.get(t).includes(e))}_objectWasUnderPointer(t,e){return!!(this._lastFrameObjectToPointers.has(t)&&this._lastFrameObjectToPointers.get(t).includes(e))}_entered(t,e){return this._objectCurrentlyUnderPointer(t,e)&&!this._lastFrameObjectToPointers.has(t)}_left(t,e){return!this._currentFrameObjectToPointers.has(t)&&this._objectWasUnderPointer(t,e)}addPointerToObject(t,e){const i=this._objectToProxy.get(t);i&&this._addPointerToProxy(i,e)}_addPointerToProxy(t,e){if(!this._currentFrameObjectToPointers.has(t)){this._currentFrameObjectToPointers.set(t,[e]);return}const i=this._currentFrameObjectToPointers.get(t);this._currentFrameObjectToPointers.set(t,i.concat(e))}dispatchEvents(t,e){const i=new Set(this._lastFrameObjectToPointers.keys()),s=new Set(this._currentFrameObjectToPointers.keys());let r,o,l;for(let c=0;c<e.length;c++){const d=e[c],_=this._getProxy(d);if(Nm(d)&&d._dispatchPointerEvents(t),i.has(_)||s.has(_)){l=this._processDownAndEmit(t,_),o=this._processUpAndEmit(t,_),r=this._processMoveAndEmit(t,_);const f=[...r.values(),...l.values(),...o.values()];this._processEnterLeaveAndEmit(t,_,f),this._processCancelAndEmit(t,_),this._processWheelAndEmit(t,_)}}}processPointerToObject(t,e){for(let i=0;i<e.length;i++){const s=e[i],r=this._getProxy(s);Nm(s)&&s._processPointerToObject(t);for(const[o,l]of t.currentFramePointerCoords.entries())r.contains(l)&&this._addPointerToProxy(r,o)}}clear(){this._lastFrameObjectToPointers.clear(),this._lastFrameObjectToPointers=new Map(this._currentFrameObjectToPointers),this._currentFrameObjectToPointers.clear()}_processDownAndEmit(t,e){const i=new Map;for(const s of t.currentFrameDown)s.active&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointerdown",s),t.isDragStart(s.pointerId)&&e.events.emit("pointerdragstart",s)),i.set(s.pointerId,s);return i}_processUpAndEmit(t,e){const i=new Map;for(const s of t.currentFrameUp)s.active&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointerup",s),t.isDragEnd(s.pointerId)&&e.events.emit("pointerdragend",s)),i.set(s.pointerId,s);return i}_processMoveAndEmit(t,e){const i=new Map;for(const s of t.currentFrameMove)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointermove",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragmove",s)),i.set(s.pointerId,s);return i}_processEnterLeaveAndEmit(t,e,i){for(const s of i){if(s.active&&e.active()&&this._entered(e,s.pointerId)){e.events.emit("pointerenter",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragenter",s);break}if(s.active&&e.active()&&(this._left(e,s.pointerId)||this._objectCurrentlyUnderPointer(e,s.pointerId)&&s.type==="up")){e.events.emit("pointerleave",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragleave",s);break}}}_processCancelAndEmit(t,e){for(const i of t.currentFrameCancel)i.active&&e.active()&&this._objectCurrentlyUnderPointer(e,i.pointerId)&&e.events.emit("pointercancel",i)}_processWheelAndEmit(t,e){for(const i of t.currentFrameWheel)i.active&&e.active()&&this._objectCurrentlyUnderPointer(e,0)&&e.events.emit("pointerwheel",i)}}const kI={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerMove:"pointermove",PointerCancel:"pointercancel"};class f0 extends oi{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.get(J).pos=D(t,this.y))}get y(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.pos.y)!==null&&e!==void 0?e:0}set y(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.transform.pos=D(this.x,t))}get z(){var t;return(t=this.transform.z)!==null&&t!==void 0?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.rotation)!==null&&e!==void 0?e:0}set rotation(t){this.transform&&(this.transform.rotation=t)}get scale(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.scale)!==null&&e!==void 0?e:I.One}set scale(t){var e;!((e=this.transform)===null||e===void 0)&&e.scale&&(this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}get width(){return this.tileWidth*this.columns*this.scale.x}get height(){return this.tileHeight*this.rows*this.scale.y}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s;super([],t.name),this.events=new de,this._token=0,this.logger=lt.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._oldRotation=0,this._originalOffsets=new WeakMap,this.meshingLookBehind=(e=t.meshingLookBehind)!==null&&e!==void 0?e:this.meshingLookBehind,this.addComponent(new J),this.addComponent(new Zt),this.addComponent(new Gt({type:ft.Fixed})),this.addComponent(new Ae({onPostDraw:(o,l)=>this.draw(o,l)})),this.addComponent(new Ac((o,l)=>this.debug(o,l),!1)),this.addComponent(new Be),this.addComponent(new Qn),this.pointer=this.get(Qn),this._graphics=this.get(Ae),this.transform=this.get(J),this._motion=this.get(Zt),this.collider=this.get(Be),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(i=t.pos)!==null&&i!==void 0?i:I.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(s=t.renderFromTopOfGraphic)!==null&&s!==void 0?s:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this._pointerEventDispatcher=new gf,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let r=[];for(let o=0;o<this.columns;o++){for(let l=0;l<this.rows;l++){const c=new p0({x:o,y:l,map:this});c.map=this,this.tiles[o+l*this.columns]=c,this._pointerEventDispatcher.addObject(c,d=>c.bounds.contains(d.worldPos),()=>!0),r.push(c),this._rows[l]||(this._rows[l]=[]),this._rows[l].push(c)}this._cols[o]=r,r=[]}this._graphics.localBounds=new at({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(t){super._initialize(t),this._engine=t}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!==null&&e!==void 0?e:I.Zero;{const i=t.offset;return this._originalOffsets.set(t,i),i}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let e=null;const i=(r,o)=>r&&o?r.top===o.top&&r.bottom===o.bottom&&r.right===o.left:!1,s=(r,o,l=this.meshingLookBehind)=>{if(!r)return!1;for(let c=o.length-1;c>=0;c--){if(l--<0)return!1;const d=o[c];if(i(d,r))return o[c]=d.combine(r),!0}return!1};for(let r=0;r<this.columns;r++){for(let o=0;o<this.rows;o++){const l=this.tiles[r+o*this.columns];if(l.solid)if(l.getColliders().length>0){for(const c of l.getColliders()){const d=this._getOrSetColliderOriginalOffset(c);c.offset=D(l.x*this.tileWidth*this.scale.x,l.y*this.tileHeight*this.scale.y).add(d),c.owner=this,this._composite.addCollider(c)}e&&!s(e,t)&&t.push(e),e=null}else e?e=e.combine(l.defaultGeometry):e=l.defaultGeometry;else e&&!s(e,t)&&t.push(e),e=null}e&&!s(e,t)&&t.push(e),e=null}for(const r of t){const o=si.Box(r.width,r.height,I.Zero,D(r.left-this.pos.x,r.top-this.pos.y));o.owner=this,this._composite.addCollider(o)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){var e;return(e=this.tiles[t])!==null&&e!==void 0?e:null}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const{x:e,y:i}=this._getTileCoordinates(t),s=this.getTile(e,i);return e>=0&&i>=0&&e<this.columns&&i<this.rows&&s?s:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const e=Math.floor(t.x/this.tileWidth),i=Math.floor(t.y/this.tileHeight);return{x:e,y:i}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){let t=this._engine.screen.getWorldBounds();const e=this.get(Cc);if(e&&this.isInitialized){let m=this.pos;const x=I.One.sub(e.parallaxFactor),C=this._engine.currentScene.camera.pos.scale(x);m=m.sub(C),t=t.translate(m)}const i=this.transform.coordPlane===Ke.Screen?this._engine.screen.getScreenBounds():t,s=this._getTileCoordinates(i.topLeft),r=this._getTileCoordinates(i.topRight),o=this._getTileCoordinates(i.bottomRight),l=this._getTileCoordinates(i.bottomLeft),c=Math.min(Ut(s.x,0,this.columns-1),Ut(r.x,0,this.columns-1)),d=Math.min(Ut(s.y,0,this.rows-1),Ut(r.y,0,this.rows-1)),_=Math.max(Ut(o.x,0,this.columns-1),Ut(l.x,0,this.columns-1)),f=Math.max(Ut(o.y,0,this.rows-1),Ut(l.y,0,this.rows-1)),g=[];for(let m=c;m<=_;m++)for(let x=d;x<=f;x++)g.push(this.getTile(m,x));return g}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(t,e){this._initialize(t),this.onPreUpdate(t,e),this.emit("preupdate",new ir(t,e,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._pointerEventDispatcher.clear(),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,e),this.emit("postupdate",new sr(t,e,this))}draw(t,e){if(!this.isInitialized)return;this.emit("predraw",new Go(t,e,this));let i,s,r;const o=this.getOnScreenTiles();for(let l=0;l<o.length;l++){const c=o[l],d=c.getGraphicsOffsets();for(i=c.getGraphics(),s=0,r=i.length;s<r;s++){const _=i[s],f=d[s];if(_){L_(_)&&(_==null||_.tick(e,this._token));const g=this.renderFromTopOfGraphic?0:_.height-this.tileHeight;_.draw(t,c.x*this.tileWidth+f.x,c.y*this.tileHeight-g+f.y)}}}this.emit("postdraw",new $o(t,e,this))}debug(t,e){const{showAll:i,showGrid:s,gridColor:r,gridWidth:o,showSolidBounds:l,solidBoundsColor:c,showColliderGeometry:d}=e.tilemap,{geometryColor:_,geometryLineWidth:f,geometryPointSize:g}=e.collider,m=this.tileWidth*this.columns*this.scale.x,x=this.tileHeight*this.rows*this.scale.y,C=this.pos;if(s||i){for(let T=0;T<this.rows+1;T++){const A=D(0,T*this.tileHeight*this.scale.y);t.drawLine(C.add(A),C.add(D(m,A.y)),r,o)}for(let T=0;T<this.columns+1;T++){const A=D(T*this.tileWidth*this.scale.x,0);t.drawLine(C.add(A),C.add(D(A.x,x)),r,o)}}if(i||l||d){const T=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const A of T){const S=A.localBounds,E=A.worldPos.sub(this.pos);l&&t.drawRectangle(E,S.width,S.height,c)}if(t.restore(),d)for(const A of T)A.debug(t,_,{lineWidth:f,pointSize:g})}if(i||l){if(t.save(),t.z=999,l)for(let T=0;T<this.tiles.length;T++)this.tiles[T].bounds.draw(t);t.restore()}}}class p0{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var e;(e=this.map)===null||e===void 0||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,e){this._graphics.push(t),e!=null&&e.offset?this._offsets.push(e.offset):this._offsets.push(I.Zero)}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&(this._graphics.splice(e,1),this._offsets.splice(e,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var e,i;this._posDirty=!1,this.events=new de,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(e=t.solid)!==null&&e!==void 0?e:this.solid,this._graphics=(i=t.graphics)!==null&&i!==void 0?i:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){const t=this.map.pos.add(D(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new at(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(D(this.x*this._width,this.y*this._height)),this._bounds=new at(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new I(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}class g0{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new m0(t))}lockToActorAxis(t,e){this.camera.addStrategy(new v0(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new w0(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new x0(t,e))}limitCameraBounds(t){this.camera.addStrategy(new b0(t))}}var Vh;(function(n){n[n.X=0]="X",n[n.Y=1]="Y"})(Vh||(Vh={}));class m0{constructor(t){this.target=t,this.action=(e,i,s,r)=>e.center}}class v0{constructor(t,e){this.target=t,this.axis=e,this.action=(i,s,r,o)=>{const l=i.center,c=s.getFocus();return this.axis===Vh.X?new I(l.x,c.y):new I(c.x,l.y)}}}class w0{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(s,r,o,l)=>{const c=s.center;let d=r.getFocus(),_=r.vel.clone();const f=c.sub(d).scale(this.cameraElasticity);_=_.add(f);const g=_.scale(-1).scale(this.cameraFriction);return _=_.add(g),d=d.add(_),d}}}class x0{constructor(t,e){this.target=t,this.radius=e,this.action=(i,s,r,o)=>{const l=i.center,c=s.getFocus(),d=l.sub(c),_=d.magnitude;if(_>=this.radius){const f=_-this.radius;return c.add(d.normalize().scale(f))}return c}}}class b0{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,i,s,r)=>{const o=i.getFocus();this.boundSizeChecked||((e.bottom-e.top<s.drawHeight||e.right-e.left<s.drawWidth)&&lt.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let l=o.x,c=o.y;return o.x<e.left+s.halfDrawWidth?l=e.left+s.halfDrawWidth:o.x>e.right-s.halfDrawWidth&&(l=e.right-s.halfDrawWidth),o.y<e.top+s.halfDrawHeight?c=e.top+s.halfDrawHeight:o.y>e.bottom-s.halfDrawHeight&&(c=e.bottom-s.halfDrawHeight),D(l,c)}}}const II={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class y0{constructor(){this.events=new de,this.transform=Fe.identity(),this.inverse=Fe.identity(),this._cameraStrategies=[],this.strategy=new g0(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=new qn(I.Zero,()=>{this._posChanged=!0}),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=I.Zero,this.acc=I.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=ee.EaseInOutCubic,this._easing=ee.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=D(0,0)}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._posChanged=!0,this._pos=new qn(t,()=>{this._posChanged=!0})}hasChanged(){return this._posChanged}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=D(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=D(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=D(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=D(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=D(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=D(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=ee.EaseInOutCubic){if(typeof i!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(s=>{this._lerpResolve=s}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=ee.EaseInOutCubic){if(this._zoomPromise=new Promise(s=>{this._zoomResolve=s}),e)this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new at(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){Ho(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.events.emit("preupdate",new ir(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.events.emit("postupdate",new sr(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let i=D(e.width/2,e.height/2);if(!this._engine.loadingComplete){const s=this._screen.peekResolution();s&&(i=D(s.width/2,s.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new jo(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new at(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const i=this._zoomEasing,s=i(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=s,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const s=ee.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=s,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const i=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(i)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,e),this._posChanged=!1}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateTimestep){const e=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep,i=this.pos.scale(e).add(this._oldPos.scale(1-e));i.clone(this.drawPos),this.updateTransform(i)}if(t.snapToPixel){const e=this.drawPos.clone(this._snapPos);e.x=~~(e.x+Mt*ne(e.x)),e.y=~~(e.y+Mt*ne(e.y)),e.clone(this.drawPos),this.updateTransform(e)}t.multiply(this.transform)}updateTransform(t){const e=this._screen.resolution.width/this.zoom,i=this._screen.resolution.height/this.zoom,s=D(-t.x+e/2+this._xShake,-t.y+i/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(e/2,i/2),this.transform.rotate(this.rotation),this.transform.translate(-e/2,-i/2),this.transform.translate(s.x,s.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const RI={ExitTrigger:"exit",EnterTrigger:"enter"};class C0 extends mi{constructor(t){var e,i,s,r;super({...t}),this.events=new de,this.filter=(e=t.filter)!==null&&e!==void 0?e:()=>!0,this.repeat=(i=t.repeat)!==null&&i!==void 0?i:-1,this.action=(s=t.action)!==null&&s!==void 0?s:()=>{},this.target=t.target,this.graphics.isVisible=(r=t.visible)!==null&&r!==void 0?r:!1,this.body.collisionType=ft.Passive,this.events.on("collisionstart",({other:o})=>{this._matchesTarget(o.owner)&&(this.events.emit("enter",new ef(this,o.owner)),this._dispatchAction(o.owner),this.repeat===0&&this.kill())}),this.events.on("collisionend",({other:o})=>{this._matchesTarget(o.owner)&&this.events.emit("exit",new sf(this,o.owner))})}_matchesTarget(t){return this.filter(t)&&(this.target===void 0||this.target===t)}_dispatchAction(t){this.repeat!==0&&(this.action.call(this,t),this.repeat--)}}const Xs={Highest:-1/0,Higher:-5,Average:0,Lower:5,Lowest:1/0};var Ui;(function(n){n.Update="update",n.Draw="draw"})(Ui||(Ui={}));class Qi{}Qi.priority=Xs.Average;class A0{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._childAddedHandlerMap=new Map,this._childRemovedHandlerMap=new Map,this._createChildAddedHandler=()=>e=>{this.addEntity(e)},this._createChildRemovedHandler=()=>e=>{this.removeEntity(e,!1)},this._entitiesToRemove=[]}updateEntities(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities[i];s.update(t.engine,e),s.isActive||this.removeEntity(s)}}findEntitiesForRemoval(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e.isActive||this.removeEntity(e)}}addEntity(t){if(t.isActive=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]){this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(s=>{s.scene=t.scene,this.addEntity(s)});const e=this._createChildAddedHandler();this._childAddedHandlerMap.set(t,e);const i=this._createChildRemovedHandler();this._childRemovedHandlerMap.set(t,i),t.childrenAdded$.subscribe(e),t.childrenRemoved$.subscribe(i)}}removeEntity(t,e=!0){var i,s;let r=0;t instanceof oi?r=t.id:r=t;const o=this._entityIndex[r];if(o&&o.isActive&&(o.isActive=!1),o&&e){this._entitiesToRemove.push(o);return}if(delete this._entityIndex[r],o){o.scene=null,Ho(o,this.entities),this._world.queryManager.removeEntity(o),o.children.forEach(d=>{d.scene=null,this.removeEntity(d,e)});const l=this._childAddedHandlerMap.get(o);l&&o.childrenAdded$.unsubscribe(l);const c=this._childRemovedHandlerMap.get(o);c&&o.childrenRemoved$.unsubscribe(c),!((s=(i=this._world)===null||i===void 0?void 0:i.scene)===null||s===void 0)&&s.engine&&this._world.scene.engine.stats.currFrame.actors.killed++}}processEntityRemovals(){for(let t=0;t<this._entitiesToRemove.length;t++){const e=this._entitiesToRemove[t];e.isActive||this.removeEntity(e,!1)}this._entitiesToRemove.length=0}processComponentRemovals(){for(let t=0;t<this.entities.length;t++)this.entities[t].processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class Na{constructor(t){if(this.requiredComponents=t,this.components=new Set,this.entities=[],this.entityAdded$=new pi,this.entityRemoved$=new pi,t.length===0)throw new Error("Cannot create query without components");for(const e of t)this.components.add(e);this.id=Na.createId(t)}static createId(t){return t.slice().map(e=>e.name).sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAll(Array.from(this.components))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class Ga{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new pi,this.entityRemoved$=new pi,t.length===0)throw new Error("Cannot create tag query without tags");for(const e of t)this.tags.add(e);this.id=Ga.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class S0{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=e=>i=>{this.addComponent(e,i)},this._createRemoveComponentHandler=e=>i=>{this.removeComponent(e,i)},this._createAddTagHandler=e=>i=>{this.addTag(e,i)},this._createRemoveTagHandler=e=>i=>{this.removeTag(e,i)}}createQuery(t){const e=Na.createId(t);if(this._queries.has(e))return this._queries.get(e);const i=new Na(t);this._queries.set(i.id,i);for(const s of t){const r=this._componentToQueriesIndex.get(s);r?r.push(i):this._componentToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}createTagQuery(t){const e=Ga.createId(t);if(this._tagQueries.has(e))return this._tagQueries.get(e);const i=new Ga(t);this._tagQueries.set(i.id,i);for(const s of t){const r=this._tagToQueriesIndex.get(s);r?r.push(i):this._tagToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}addEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t),s=e??this._createAddComponentHandler(t),r=i??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,s),this._removeComponentHandlers.set(t,r);const o=this._addTagHandlers.get(t),l=this._removeTagHandlers.get(t),c=o??this._createAddTagHandler(t),d=l??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,c),this._removeTagHandlers.set(t,d);for(const _ of this._queries.values())_.checkAndAdd(t);for(const _ of this._tagQueries.values())_.checkAndAdd(t);t.componentAdded$.subscribe(s),t.componentRemoved$.subscribe(r),t.tagAdded$.subscribe(c),t.tagRemoved$.subscribe(d)}removeEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t);for(const o of this._queries.values())o.removeEntity(t);e&&t.componentAdded$.unsubscribe(e),i&&t.componentRemoved$.unsubscribe(i);const s=this._addTagHandlers.get(t),r=this._removeTagHandlers.get(t);for(const o of this._tagQueries.values())o.removeEntity(t);s&&t.tagAdded$.unsubscribe(s),r&&t.tagRemoved$.unsubscribe(r)}addComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}addTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}}function T0(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class E0{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){let e;t instanceof Qi?e=t:e=new t(this._world),this.systems.push(e),this.systems.sort((i,s)=>i.constructor.priority-s.constructor.priority),this.initialized&&e.initialize&&e.initialize(this._world,this._world.scene)}removeSystem(t){Ho(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,e,i){const s=this.systems.filter(r=>r.systemType===t);for(const r of s)r.preupdate&&r.preupdate(e,i);for(const r of s)r.update(i);for(const r of s)r.postupdate&&r.postupdate(e,i)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class P0{constructor(t){this.scene=t,this._logger=lt.getInstance(),this.queryManager=new S0(this),this.entityManager=new A0(this),this.systemManager=new E0(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,e){t===Ui.Update&&this.entityManager.updateEntities(this.scene,e),this.systemManager.updateSystems(t,this.scene,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){if(t instanceof oi){this.entityManager.addEntity(t);return}if(t instanceof Qi||T0(t)){this.systemManager.addSystem(t);return}this._logger.warn(`Could not add entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get(t){return this.systemManager.get(t)}remove(t,e=!0){if(t instanceof oi){this.entityManager.removeEntity(t,e);return}if(t instanceof Qi){this.systemManager.removeSystem(t);return}this._logger.warn(`Could not remove entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class Sc extends Qi{constructor(t,e){super(),this.world=t,this.physics=e,this.systemType=Ui.Update,this._physicsConfigDirty=!1,e.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([J,Zt])}update(t){let e,i;const s=this.query.entities,r=this.physics.config.substep;for(let o=0;o<s.length;o++){e=s[o].get(J),i=s[o].get(Zt);const l=s[o].get(Gt);if(this._physicsConfigDirty&&l&&l.updatePhysicsConfig(this.physics.config.bodies),l!=null&&l.isSleeping)continue;const c=i.acc.clone();(l==null?void 0:l.collisionType)===ft.Active&&(l!=null&&l.useGravity)&&c.addEqual(this.physics.config.gravity),s[o].parent||this.captureOldTransformWithChildren(s[o]),ui.integrate(e,i,c,t/r)}this._physicsConfigDirty=!1}captureOldTransformWithChildren(t){var e;(e=t.get(Gt))===null||e===void 0||e.captureOldTransform();for(let i=0;i<t.children.length;i++)this.captureOldTransformWithChildren(t.children[i])}}Sc.priority=Xs.Higher;class Zu{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(i=>!i.isCanceled());let e;switch(this.config.contactSolveBias){case En.HorizontalFirst:{e=uf;break}case En.VerticalFirst:{e=df;break}default:e=_f}t.sort((i,s)=>{const r=this.directionMap.get(i.id),o=this.directionMap.get(s.id),l=this.distanceMap.get(i.id),c=this.distanceMap.get(s.id);return e[r]-e[o]||l-c});for(const i of t)this.solvePosition(i),this.solveVelocity(i);return this.postSolve(t),t}preSolve(t){for(let i=0;i<t.length;i++){const s=t[i];if(Math.abs(s.mtv.x)<1e-4&&Math.abs(s.mtv.y)<1e-4){s.cancel();continue}const r=Kt.fromDirection(s.mtv),o=s.mtv.negate(),l=Math.abs(s.info.separation);this.distanceMap.set(s.id,l),this.directionMap.set(s.id,r===Kt.Left||r===Kt.Right?"horizontal":"vertical"),s.colliderA.events.emit("precollision",new Rr(s.colliderA,s.colliderB,r,o,s)),s.colliderB.events.emit("precollision",new Rr(s.colliderB,s.colliderA,Kt.getOpposite(r),o.negate(),s))}}postSolve(t){var e,i;for(let s=0;s<t.length;s++){const r=t[s];if(r.isCanceled())continue;const o=r.colliderA,l=r.colliderB,c=(e=o.owner)===null||e===void 0?void 0:e.get(Gt),d=(i=l.owner)===null||i===void 0?void 0:i.get(Gt);if(c&&d&&(c.collisionType===ft.Passive||d.collisionType===ft.Passive))continue;const _=Kt.fromDirection(r.mtv),f=r.mtv.negate();r.colliderA.events.emit("postcollision",new Mr(r.colliderA,r.colliderB,_,f,r)),r.colliderB.events.emit("postcollision",new Mr(r.colliderB,r.colliderA,Kt.getOpposite(_),f.negate(),r))}}solvePosition(t){var e,i;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let r=t.mtv;const o=t.colliderA,l=t.colliderB,c=(e=o.owner)===null||e===void 0?void 0:e.get(Gt),d=(i=l.owner)===null||i===void 0?void 0:i.get(Gt);if(c&&d){if(c.collisionType===ft.Passive||d.collisionType===ft.Passive)return;c.collisionType===ft.Active&&d.collisionType===ft.Active&&(r=r.scale(.5)),c.collisionType===ft.Active&&(c.globalPos.x-=r.x,c.globalPos.y-=r.y,o.update(c.transform.get())),d.collisionType===ft.Active&&(d.globalPos.x+=r.x,d.globalPos.y+=r.y,l.update(d.transform.get()))}}solveVelocity(t){var e,i;if(t.isCanceled())return;const s=t.colliderA,r=t.colliderB,o=(e=s.owner)===null||e===void 0?void 0:e.get(Gt),l=(i=r.owner)===null||i===void 0?void 0:i.get(Gt);if(o&&l){if(o.collisionType===ft.Passive||l.collisionType===ft.Passive)return;const c=t.normal,d=c.negate();if(o.collisionType===ft.Active&&o.vel.normalize().dot(d)<0){const _=c.scale(c.dot(o.vel.negate()));o.vel=o.vel.add(_)}if(l.collisionType===ft.Active&&l.vel.normalize().dot(c)<0){const _=d.scale(d.dot(l.vel.negate()));l.vel=l.vel.add(_)}}}}class k0{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new I(0,0),this.bToContact=new I(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){const t=this.contact.bodyA,e=this.contact.colliderA,i=this.contact.bodyB,s=this.contact.colliderB;if(t&&i){const r=this.contact.normal,o=this.contact.tangent;this.aToContact=this.point.sub(e.center),this.bToContact=this.point.sub(s.center);const l=this.aToContact.cross(r),c=this.bToContact.cross(r);this.normalMass=t.inverseMass+i.inverseMass+t.inverseInertia*l*l+i.inverseInertia*c*c;const d=this.aToContact.cross(o),_=this.bToContact.cross(o);this.tangentMass=t.inverseMass+i.inverseMass+t.inverseInertia*d*d+i.inverseInertia*_*_}return this}getRelativeVelocity(){const t=this.contact.bodyA,e=this.contact.bodyB;if(t&&e){const i=t.vel.add(I.cross(t.angularVelocity,this.aToContact));return e.vel.add(I.cross(e.angularVelocity,this.bToContact)).sub(i)}return I.Zero}}class Yu{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!==null&&e!==void 0?e:[]}solve(t){this.preSolve(t),t=t.filter(i=>!i.isCanceled());let e;switch(this.config.contactSolveBias){case En.HorizontalFirst:{e=uf;break}case En.VerticalFirst:{e=df;break}default:e=_f}return t.sort((i,s)=>{const r=this.directionMap.get(i.id),o=this.directionMap.get(s.id),l=this.distanceMap.get(i.id),c=this.distanceMap.get(s.id);return e[r]-e[o]||l-c}),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,i,s,r;for(let c=0;c<t.length;c++){const d=t[c];if(Math.abs(d.mtv.x)<1e-4&&Math.abs(d.mtv.y)<1e-4){d.cancel();continue}const _=Kt.fromDirection(d.mtv),f=Math.abs(((e=d==null?void 0:d.info)===null||e===void 0?void 0:e.separation)||0);this.distanceMap.set(d.id,f),this.directionMap.set(d.id,_===Kt.Left||_===Kt.Right?"horizontal":"vertical"),d.colliderA.events.emit("precollision",new Rr(d.colliderA,d.colliderB,_,d.mtv,d)),d.colliderA.events.emit("beforecollisionresolve",new Gh(d.colliderA,d.colliderB,_,d.mtv,d)),d.colliderB.events.emit("precollision",new Rr(d.colliderB,d.colliderA,Kt.getOpposite(_),d.mtv.negate(),d)),d.colliderB.events.emit("beforecollisionresolve",new Gh(d.colliderB,d.colliderA,Kt.getOpposite(_),d.mtv.negate(),d)),d.matchAwake()}const l=Array.from(this.idToContactConstraint.keys());for(let c=0;c<t.length;c++){const d=t[c],_=l.indexOf(d.id);_>-1&&l.splice(_,1);const f=(i=this.idToContactConstraint.get(d.id))!==null&&i!==void 0?i:[];let g=0;const m=d.bodyA,x=d.colliderA,C=d.bodyB,T=d.colliderB;if(m&&C)for(let A=0;A<d.points.length;A++){const S=d.points[A],E=d.normal,M=d.tangent,O=S.sub(x.center),N=S.sub(T.center),F=O.cross(E),K=N.cross(E),nt=m.inverseMass+C.inverseMass+m.inverseInertia*F*F+C.inverseInertia*K*K,pt=O.cross(M),ht=N.cross(M),ct=m.inverseMass+C.inverseMass+m.inverseInertia*pt*pt+C.inverseInertia*ht*ht;f[g]&&((r=(s=f[g])===null||s===void 0?void 0:s.point)===null||r===void 0?void 0:r.squareDistance(S))<4?(f[g].point=S,f[g].local=d.localPoints[g]):f[g]=new k0(S,d.localPoints[g],d),f[g].aToContact=O,f[g].bToContact=N,f[g].normalMass=1/nt,f[g].tangentMass=1/ct;const bt=m.bounciness>C.bounciness?m.bounciness:C.bounciness,wt=d.normal.dot(f[g].getRelativeVelocity());f[g].originalVelocityAndRestitution=0,wt<-.1&&(f[g].originalVelocityAndRestitution=-bt*wt),g++}this.idToContactConstraint.set(d.id,f)}for(const c of l)this.idToContactConstraint.delete(c);if(this.config.warmStart)this.warmStart(t);else for(let c=0;c<t.length;c++){const d=t[c],_=this.getContactConstraints(d.id);for(const f of _)f.normalImpulse=0,f.tangentImpulse=0}}postSolve(t){for(let e=0;e<t.length;e++){const i=t[e],s=i.bodyA,r=i.bodyB;if(s&&r){if(s.collisionType===ft.Passive||r.collisionType===ft.Passive)continue;s.updateMotion(),r.updateMotion()}const o=Kt.fromDirection(i.mtv);i.colliderA.events.emit("postcollision",new Mr(i.colliderA,i.colliderB,o,i.mtv,i)),i.colliderA.events.emit("aftercollisionresolve",new $h(i.colliderA,i.colliderB,o,i.mtv,i)),i.colliderB.events.emit("postcollision",new Mr(i.colliderB,i.colliderA,Kt.getOpposite(o),i.mtv.negate(),i)),i.colliderB.events.emit("aftercollisionresolve",new $h(i.colliderB,i.colliderA,Kt.getOpposite(o),i.mtv.negate(),i))}this.lastFrameContacts.clear();for(let e=0;e<t.length;e++){const i=t[e];this.lastFrameContacts.set(i.id,i)}}warmStart(t){var e;for(let i=0;i<t.length;i++){const s=t[i],r=s.bodyA,o=s.bodyB;if(r&&o){const l=(e=this.idToContactConstraint.get(s.id))!==null&&e!==void 0?e:[];for(const c of l)if(this.config.warmStart){const d=s.normal.scale(c.normalImpulse),_=s.tangent.scale(c.tangentImpulse),f=d.add(_);r.applyImpulse(c.point,f.negate()),o.applyImpulse(c.point,f)}else c.normalImpulse=0,c.tangentImpulse=0}}}solvePosition(t){var e;for(let i=0;i<this.config.positionIterations;i++)for(let s=0;s<t.length;s++){const r=t[s],o=r.bodyA,l=r.bodyB;if(o&&l){if(o.collisionType===ft.Passive||l.collisionType===ft.Passive)continue;const c=(e=this.idToContactConstraint.get(r.id))!==null&&e!==void 0?e:[];for(const d of c){const _=r.normal,f=Ss.FindContactSeparation(r,d.local),g=this.config.steeringFactor,m=-5,x=this.config.slop,C=Ut(g*(f+x),m,0),T=_.scale(-C*d.normalMass);if(o.collisionType===ft.Active){const A=T.negate().scale(o.inverseMass);o.limitDegreeOfFreedom.includes(Si.X)&&(A.x=0),o.limitDegreeOfFreedom.includes(Si.Y)&&(A.y=0),o.globalPos=o.globalPos.add(A),o.limitDegreeOfFreedom.includes(Si.Rotation)||(o.rotation-=d.aToContact.cross(T)*o.inverseInertia)}if(l.collisionType===ft.Active){const A=T.scale(l.inverseMass);l.limitDegreeOfFreedom.includes(Si.X)&&(A.x=0),l.limitDegreeOfFreedom.includes(Si.Y)&&(A.y=0),l.globalPos=l.globalPos.add(A),l.limitDegreeOfFreedom.includes(Si.Rotation)||(l.rotation+=d.bToContact.cross(T)*l.inverseInertia)}}}}}solveVelocity(t){var e;for(let i=0;i<this.config.velocityIterations;i++)for(let s=0;s<t.length;s++){const r=t[s],o=r.bodyA,l=r.bodyB;if(o&&l){if(o.collisionType===ft.Passive||l.collisionType===ft.Passive)continue;const c=Math.min(o.friction,l.friction),d=(e=this.idToContactConstraint.get(r.id))!==null&&e!==void 0?e:[];for(const _ of d){let m=-_.getRelativeVelocity().dot(r.tangent)*_.tangentMass;const x=c*_.normalImpulse,C=Ut(_.tangentImpulse+m,-x,x);m=C-_.tangentImpulse,_.tangentImpulse=C;const T=r.tangent.scale(m);o.applyImpulse(_.point,T.negate()),l.applyImpulse(_.point,T)}for(const _ of d){const g=_.getRelativeVelocity().dot(r.normal);let m=-_.normalMass*(g-_.originalVelocityAndRestitution);const x=Math.max(_.normalImpulse+m,0);m=x-_.normalImpulse,_.normalImpulse=x;const C=r.normal.scale(m);o.applyImpulse(_.point,C.negate()),l.applyImpulse(_.point,C)}}}}}class Tc extends Qi{get _processor(){return this._physics.collisionProcessor}constructor(t,e){super(),this._physics=e,this.systemType=Ui.Update,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new Zu(e.config.arcade),this._realisticSolver=new Yu(e.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=i=>this._processor.track(i),this._untrackCollider=i=>this._processor.untrack(i),this.query=t.query([J,Zt,Be]),this.query.entityAdded$.subscribe(i=>{const s=i.get(Be);s.$colliderAdded.subscribe(this._trackCollider),s.$colliderRemoved.subscribe(this._untrackCollider);const r=s.get();r&&this._processor.track(r)}),this.query.entityRemoved$.subscribe(i=>{const s=i.get(Be),r=s.get();s&&r&&this._processor.untrack(r)}),this._motionSystem=t.get(Sc)}initialize(t,e){this._engine=e.engine}update(t){var e,i,s,r;if(!this._physics.config.enabled)return;let o=[];for(let f=0;f<this.query.entities.length;f++){const m=this.query.entities[f].get(Be),x=m==null?void 0:m.get();if(m&&(!((e=m.owner)===null||e===void 0)&&e.isActive)&&x)if(m.update(),x instanceof Ve){const C=x.getColliders();x.compositeStrategy||(x.compositeStrategy=this._physics.config.colliders.compositeStrategy),o=o.concat(C)}else o.push(x)}this._processor.update(o,t);let l=this._processor.broadphase(o,t);this._currentFrameContacts.clear();let c=[];const d=this.getSolver(),_=this._physics.config.substep;for(let f=0;f<_;f++)if(f>0&&this._motionSystem.update(t),c.length&&(l=c.map(g=>new gi(g.colliderA,g.colliderB))),l.length){c=this._processor.narrowphase(l,(r=(s=(i=this._engine)===null||i===void 0?void 0:i.debug)===null||s===void 0?void 0:s.stats)===null||r===void 0?void 0:r.currFrame),c=d.solve(c);for(const g of c){if(g.isCanceled())continue;const m=g.id.indexOf("|");if(m>0){const x=g.id.substring(m+1);this._currentFrameContacts.set(x,g)}else this._currentFrameContacts.set(g.id,g)}}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const f of this.query.entities){const g=f.get(Be);g&&g.processColliderRemoval()}}postupdate(){Le.SeparationPool.done()}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new Zu(this._physics.config.arcade),this._realisticSolver=new Yu(this._physics.config.realistic)),this._physics.config.solver===Wa.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t,0)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=Kt.fromDirection(e.mtv),o=Kt.getOpposite(r);i.events.emit("collisionstart",new Oa(i,s,r,e)),i.events.emit("contactstart",new Wh(i,s,r,e)),s.events.emit("collisionstart",new Oa(s,i,o,e)),s.events.emit("contactstart",new Wh(s,i,o,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=Kt.fromDirection(e.mtv),o=Kt.getOpposite(r);i.events.emit("collisionend",new Ua(i,s,r,e)),i.events.emit("contactend",new Nh(i,s,r,e)),s.events.emit("collisionend",new Ua(s,i,o,e)),s.events.emit("contactend",new Nh(s,i,o,e))}}}Tc.priority=Xs.Higher;function MI(n,t,e,i){if(n.parent!==t.parent){const _=n.clone(),f=n.globalPos.clone(),g=n.globalScale.clone(),m=n.globalRotation;_.parent=t.parent,_.globalPos=f,_.globalScale=g,_.globalRotation=m,n=_}let s=t.pos,r=t.scale,o=t.rotation;s=t.pos.scale(e).add(n.pos.scale(1-e)),r=t.scale.scale(e).add(n.scale.scale(1-e));const l=(1-e)*Math.cos(n.rotation)+e*Math.cos(t.rotation),c=(1-e)*Math.sin(n.rotation)+e*Math.sin(t.rotation);o=Math.atan2(c,l);const d=i??new Sn;return d.setTransform(s,o,r),d}class mf extends Qi{get sortedTransforms(){return this._sortedTransforms}constructor(t){super(),this.world=t,this.systemType=Ui.Draw,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new Sn,this.query=this.world.query([J,Ae]),this.query.entityAdded$.subscribe(e=>{const i=e.get(J);this._sortedTransforms.push(i),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const i=e.get(J);i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(i);s>-1&&this._sortedTransforms.splice(s,1)})}initialize(t,e){this._camera=e.camera,this._engine=e.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.globalZ-e.globalZ),this._zHasChanged=!1)}update(t){this._token++;let e;Qt.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let i=0;i<this._sortedTransforms.length;i++){const s=this._sortedTransforms[i],r=s.owner;if(r.hasTag("ex.offscreen")||(e=r.get(Ae),!e.isVisible))continue;e.onPreTransformDraw&&e.onPreTransformDraw(this._graphicsContext,t),r.events.emit("pretransformdraw",new z_(this._graphicsContext,t,r)),s.coordPlane===Ke.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),s.coordPlane===Ke.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),e.update(t,this._token);const o=r.get(Cc);if(o){const l=I.One.sub(o.parallaxFactor),c=this._camera.drawPos.scale(l);this._graphicsContext.translate(c.x,c.y)}this._applyTransform(r),e.material&&(this._graphicsContext.material=e.material),e.onPreDraw&&e.onPreDraw(this._graphicsContext,t),r.events.emit("predraw",new Go(this._graphicsContext,t,r)),this._applyOpacity(r),this._drawGraphicsComponent(e,s),e.onPostDraw&&e.onPostDraw(this._graphicsContext,t),r.events.emit("postdraw",new $o(this._graphicsContext,t,r)),this._graphicsContext.restore(),s.coordPlane===Ke.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),e.onPostTransformDraw&&e.onPostTransformDraw(this._graphicsContext,t),r.events.emit("posttransformdraw",new H_(this._graphicsContext,t,r))}this._graphicsContext.restore()}_drawGraphicsComponent(t,e){var i,s;if(t.isVisible){const r=t.flipHorizontal,o=t.flipVertical,l=t.current,c=(i=t.currentOptions)!==null&&i!==void 0?i:{};if(l){let d=t.anchor,_=t.offset,f=1,g=1;c!=null&&c.anchor&&(d=c.anchor),c!=null&&c.offset&&(_=c.offset);const m=e.globalScale;f*=l.scale.x*m.x,g*=l.scale.y*m.y;const x=-l.width*d.x+_.x*f,C=-l.height*d.y+_.y*g,T=l.flipHorizontal,A=l.flipVertical;if((r||o)&&(l.flipHorizontal=r?!T:T,l.flipVertical=o?!A:A),l==null||l.draw(this._graphicsContext,x,C),(r||o)&&(l.flipHorizontal=T,l.flipVertical=A),!((s=this._engine)===null||s===void 0)&&s.isDebug&&this._engine.debug.graphics.showBounds){const S=D(x,C);if(l instanceof So)for(const E of l.members){let M,O=I.Zero;E instanceof Ce?M=E:(M=E.graphic,O=E.offset),l.useAnchor?M==null||M.localBounds.translate(S.add(O)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):M==null||M.localBounds.translate(O).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else l==null||l.localBounds.translate(S).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const e=t.getAncestors();for(let i=0;i<e.length;i++){const s=e[i],r=s==null?void 0:s.get(J),o=s==null?void 0:s.get(Gt);if(r){let l=r.get();if(o&&this._engine.fixedUpdateTimestep&&o.__oldTransformCaptured&&o.enableFixedUpdateInterpolate){const c=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep;l=MI(o.oldTransform,r.get(),c,this._targetInterpolationTransform)}this._graphicsContext.z=r.globalZ,this._graphicsContext.translate(l.pos.x,l.pos.y),this._graphicsContext.scale(l.scale.x,l.scale.y),this._graphicsContext.rotate(l.rotation)}}}_applyOpacity(t){var e;const i=t.getAncestors();for(let s=0;s<i.length;s++){const r=i[s],o=r==null?void 0:r.get(Ae);this._graphicsContext.opacity*=(e=o==null?void 0:o.opacity)!==null&&e!==void 0?e:1}}}mf.priority=Xs.Average;class vf extends Qi{constructor(t){super(),this.world=t,this.systemType=Ui.Draw,this.query=this.world.query([J])}initialize(t,e){this._graphicsContext=e.engine.graphicsContext,this._camera=e.camera,this._engine=e.engine,this._collisionSystem=t.systemManager.get(Tc)}update(){var t;if(!this._engine.isDebug)return;const e=this._engine.debug.filter;let i,s;const r=this._engine.debug.entity;let o;const l=this._engine.debug.transform;let c;const d=this._engine.debug.motion;let _;const f=this._engine.debug.collider,g=this._engine.debug.physics;let m;const x=this._engine.debug.graphics;let C,T;const A=this._engine.debug.body,S=this._engine.debug.camera;for(let E=0;E<this.query.entities.length;E++){const M=this.query.entities[E];if(M.hasTag("offscreen")||M instanceof xc||e.useFilter&&(!(e.ids.length===0||e.ids.includes(M.id))||!(e.nameQuery===""||M.name.includes(e.nameQuery))))continue;let O=I.Zero;const N=D(0,16);if(i=M.id,s=M.name,o=M.get(J),this._pushCameraTransform(o),this._graphicsContext.save(),o.coordPlane===Ke.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=l.debugZIndex,this._applyTransform(M),o&&((l.showAll||l.showPosition)&&this._graphicsContext.debug.drawPoint(I.Zero,{size:4,color:l.positionColor}),(l.showAll||l.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${o.pos.toString(2)}`,O),O=O.add(N)),(l.showAll||l.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${o.z.toFixed(1)})`,O),O=O.add(N)),(r.showAll||r.showId)&&(this._graphicsContext.debug.drawText(`id(${i}) ${M.parent?"child of id("+((t=M.parent)===null||t===void 0?void 0:t.id)+")":""}`,O),O=O.add(N)),(r.showAll||r.showName)&&(this._graphicsContext.debug.drawText(`name(${s})`,O),O=O.add(N)),(l.showAll||l.showRotation)&&(this._graphicsContext.drawLine(I.Zero,I.fromAngle(o.rotation).scale(50).add(I.Zero),l.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${mw(o.rotation).toFixed(2)})`,O),O=O.add(N)),(l.showAll||l.showScale)&&this._graphicsContext.drawLine(I.Zero,o.scale.add(I.Zero),l.scaleColor,2)),m=M.get(Ae),m&&(x.showAll||x.showBounds)&&m.localBounds.draw(this._graphicsContext,x.boundsColor),C=M.get(Ac),C&&(C.useTransform||this._graphicsContext.restore(),C.draw(this._graphicsContext,this._engine.debug),C.useTransform||(this._graphicsContext.save(),this._applyTransform(M))),T=M.get(Gt),T&&((A.showAll||A.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${T.group.name})`,O),O=O.add(N)),(A.showAll||A.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${T.collisionType})`,O),O=O.add(N)),(A.showAll||A.showMass)&&(this._graphicsContext.debug.drawText(`mass(${T.mass})`,O),O=O.add(N)),(A.showAll||A.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${T.sleepMotion})`,O),O=O.add(N)),(A.showAll||A.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${T.canSleep?T.isSleeping:"cant sleep"})`,O),O=O.add(N))),this._graphicsContext.restore(),this._graphicsContext.save(),o.coordPlane===Ke.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=l.debugZIndex,c=M.get(Zt),c&&((d.showAll||d.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${c.vel.toString(2)}`,O.add(o.globalPos)),this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(c.vel),d.velocityColor,2),O=O.add(N)),(d.showAll||d.showAcceleration)&&this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(c.acc),d.accelerationColor,2)),_=M.get(Be),_){const F=_.get();if((f.showAll||f.showGeometry)&&F&&F.debug(this._graphicsContext,f.geometryColor,{lineWidth:f.geometryLineWidth,pointSize:f.geometryPointSize}),f.showAll||f.showBounds){if(F instanceof Ve){const K=F.getColliders();for(const nt of K){const pt=nt.bounds,ht=D(pt.left,pt.top);this._graphicsContext.debug.drawRect(ht.x,ht.y,pt.width,pt.height,{color:f.boundsColor}),(f.showAll||f.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${nt.owner.id})`,ht)}_.bounds.draw(this._graphicsContext,f.boundsColor)}else if(F){const K=_.bounds,nt=D(K.left,K.top);this._graphicsContext.debug.drawRect(nt.x,nt.y,K.width,K.height,{color:f.boundsColor}),(f.showAll||f.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${_.owner.id})`,nt)}}}this._graphicsContext.restore(),this._popCameraTransform(o)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(g.showAll||g.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),g.showAll||g.showCollisionContacts||g.showCollisionNormals)for(const[E,M]of this._engine.debug.stats.currFrame.physics.contacts){if(g.showAll||g.showCollisionContacts)for(const O of M.points)this._graphicsContext.debug.drawPoint(O,{size:g.contactSize,color:g.collisionContactColor});if(g.showAll||g.showCollisionNormals)for(const O of M.points)this._graphicsContext.debug.drawLine(O,M.normal.scale(30).add(O),{color:g.collisionNormalColor})}this._graphicsContext.restore(),S&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(S.showAll||S.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,S.focusColor),(S.showAll||S.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,e){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),je.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const e=t.getAncestors();for(const i of e){const s=i==null?void 0:i.get(J);s&&(this._graphicsContext.translate(s.pos.x,s.pos.y),this._graphicsContext.scale(s.scale.x,s.scale.y),this._graphicsContext.rotate(s.rotation))}}_pushCameraTransform(t){t.coordPlane===Ke.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===Ke.World&&this._graphicsContext.restore()}}vf.priority=Xs.Lowest;class wf{constructor(t,e){this.object=t,this.id=-1,this.cells=[],this.hasZeroBounds=!1,this.gridSize=e,this.bounds=t.bounds,this.hasZeroBounds=this.bounds.hasZeroDimensions(),this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize)}hasChanged(){const t=this.object.bounds,e=Math.floor(t.left/this.gridSize),i=Math.floor(t.right/this.gridSize),s=Math.floor(t.bottom/this.gridSize),r=Math.floor(t.top/this.gridSize);return this.leftX!==e||this.rightX!==i||this.bottomY!==s||this.topY!==r}clear(){for(const t of this.cells){const e=t.proxies.indexOf(this);e>-1&&t.proxies.splice(e,1)}}updateBounds(){this.bounds=this.object.bounds}update(){this.bounds=this.object.bounds,this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize),this.hasZeroBounds=this.object.bounds.hasZeroDimensions()}}class Bs{constructor(){this.proxies=[]}configure(t,e){this.x=t,this.y=e,this.key=Bs.calculateHashKey(t,e)}static calculateHashKey(t,e){return`${t}+${e}`}}class xf{constructor(t){this.bounds=new at,this._hashGridCellPool=new fl(()=>new Bs,e=>(e.configure(0,0),e.proxies.length=0,e),1e3),this.gridSize=t.size,this.sparseHashGrid=new Map,this.objectToProxy=new Map,t.proxyFactory?this._buildProxy=e=>t.proxyFactory(e,this.gridSize):this._buildProxy=e=>new wf(e,this.gridSize)}query(t){const e=new Set;if(t instanceof at){const i=t,s=Math.floor(i.left/this.gridSize),r=Math.floor(i.right/this.gridSize),o=Math.floor(i.bottom/this.gridSize),l=Math.floor(i.top/this.gridSize);for(let c=s;c<=r;c++)for(let d=l;d<=o;d++){const _=Bs.calculateHashKey(c,d),f=this.sparseHashGrid.get(_);if(f)for(let g=0;g<f.proxies.length;g++)f.proxies[g].updateBounds(),f.proxies[g].bounds.intersect(i)&&e.add(f.proxies[g].object)}}else{const i=t,s=Bs.calculateHashKey(Math.floor(i.x/this.gridSize),Math.floor(i.y/this.gridSize)),r=this.sparseHashGrid.get(s);if(r)for(let o=0;o<r.proxies.length;o++)r.proxies[o].updateBounds(),r.proxies[o].bounds.contains(i)&&e.add(r.proxies[o].object)}return Array.from(e)}get(t,e){const i=Bs.calculateHashKey(t,e);return this.sparseHashGrid.get(i)}_insert(t,e,i){const s=Bs.calculateHashKey(t,e);let r=this.sparseHashGrid.get(s);r||(r=this._hashGridCellPool.rent(),r.configure(t,e),this.sparseHashGrid.set(r.key,r)),r.proxies.push(i),i.cells.push(r),this.bounds.combine(i.bounds,this.bounds)}_remove(t,e,i){const s=Bs.calculateHashKey(t,e),r=this.sparseHashGrid.get(s);if(r){const o=r.proxies.indexOf(i);o>-1&&r.proxies.splice(o,1);const l=i.cells.indexOf(r);l>-1&&i.cells.splice(l,1),r.proxies.length===0&&(this._hashGridCellPool.return(r),this.sparseHashGrid.delete(s))}}track(t){const e=this._buildProxy(t);this.objectToProxy.set(t,e);for(let i=e.leftX;i<=e.rightX;i++)for(let s=e.topY;s<=e.bottomY;s++)this._insert(i,s,e)}untrack(t){const e=this.objectToProxy.get(t);e&&(e.clear(),this.objectToProxy.delete(t))}update(t){let e=0;for(const i of t){const s=this.objectToProxy.get(i);if(s&&s.hasChanged()){for(let r=s.leftX;r<=s.rightX;r++)for(let o=s.topY;o<=s.bottomY;o++)this._remove(r,o,s);s.update();for(let r=s.leftX;r<=s.rightX;r++)for(let o=s.topY;o<=s.bottomY;o++)this._insert(r,o,s);e++}}return e}debug(t,e){const i=$.Transparent,s=$.White;for(const r of this.sparseHashGrid.values())t.drawRectangle(D(r.x*this.gridSize,r.y*this.gridSize),this.gridSize,this.gridSize,i,s,2)}}class Ec extends Qi{constructor(t){super(),this.world=t,this.systemType=Ui.Update,this._graphicsHashGrid=new xf({size:100}),this._graphics=[],this._entityToPointer=new Map,this._pointerEventDispatcher=new gf,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([J,Qn]),this.query.entityAdded$.subscribe(e=>{const i=e.get(J),s=e.get(Qn);this._pointerEventDispatcher.addObject(e,o=>s&&s.localBounds?s.localBounds.transform(i.get().matrix).contains(i.coordPlane===Ke.World?o.worldPos:o.screenPos):!1,()=>e.isActive),this._entityToPointer.set(e,s);const r=e.get(Ae);r&&(this._graphics.push(r),this._graphicsHashGrid.track(r)),this._sortedTransforms.push(i),this._sortedEntities.push(i.owner),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{this._pointerEventDispatcher.removeObject(e);const i=e.get(J);this._entityToPointer.delete(e);const s=e.get(Ae);if(s){const o=this._graphics.indexOf(s);o>-1&&this._graphics.splice(o,1),this._graphicsHashGrid.untrack(s)}i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const r=this._sortedTransforms.indexOf(i);r>-1&&(this._sortedTransforms.splice(r,1),this._sortedEntities.splice(r,1))})}initialize(t,e){this._engine=e.engine,this._scene=e}preupdate(){this._scene.camera.hasChanged()&&this._scene.camera.updateTransform(this._scene.camera.pos),this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}update(){this._graphicsHashGrid.update(this._graphics);for(const[t,e]of this._engineReceiver.currentFramePointerCoords.entries()){const i=this._scene.physics.query(e.worldPos);for(let r=0;r<i.length;r++){const o=i[r],l=this._entityToPointer.get(o.owner);l&&(l.useColliderShape||this.overrideUseColliderShape)&&this._pointerEventDispatcher.addPointerToObject(o.owner,t)}const s=this._graphicsHashGrid.query(e.worldPos);for(let r=0;r<s.length;r++){const o=s[r],l=this._entityToPointer.get(o.owner);l&&(l.useGraphicsBounds||this.overrideUseGraphicsBounds)&&this._pointerEventDispatcher.addPointerToObject(o.owner,t)}}this._pointerEventDispatcher.processPointerToObject(this._engineReceiver,this._sortedEntities),this._pointerEventDispatcher.dispatchEvents(this._engineReceiver,this._sortedEntities),this._receivers.forEach(t=>t.update()),this._pointerEventDispatcher.clear(),this._receivers.forEach(t=>t.clear())}}Ec.priority=Xs.Higher;class bf extends Qi{constructor(t){super(),this.world=t,this.systemType=Ui.Update,this._actions=[],this.query=this.world.query([fo]),this.query.entityAdded$.subscribe(e=>this._actions.push(e.get(fo))),this.query.entityRemoved$.subscribe(e=>{const i=e.get(fo),s=this._actions.indexOf(i);s>-1&&this._actions.splice(s,1)})}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}}bf.priority=Xs.Higher;class $a extends hs{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class yf extends Qi{constructor(t){super(),this.world=t,this.systemType=Ui.Update,this.query=this.world.query([J,$a])}update(){let t,e;for(let i=0;i<this.query.entities.length;i++){const s=this.query.entities[i];t=s.get(J),e=s.get($a);const o=Math.max(e.columns*e.tileWidth,e.rows*e.tileHeight)*e.elevation+t.pos.y;t.z=o}}}yf.priority=Xs.Lower;class Cf extends Qi{constructor(t){super(),this.world=t,this.systemType=Ui.Draw,this.query=this.world.query([J,Ae])}initialize(t,e){this._camera=e.camera,this._screen=e.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,e,i;for(let s=0;s<this.query.entities.length;s++){const r=this.query.entities[s];e=r.get(Ae),t=r.get(J),i=r.get(Cc);let o;if(i){const c=I.One.sub(i.parallaxFactor);o=this._camera.pos.scale(c)}const l=this._isOffscreen(t,e,o);l&&!r.hasTag("ex.offscreen")&&(r.events.emit("exitviewport",new J_(r)),r.addTag("ex.offscreen")),!l&&r.hasTag("ex.offscreen")&&(r.events.emit("enterviewport",new tf(r)),r.removeTag("ex.offscreen"))}}_isOffscreen(t,e,i){if(e.forceOnScreen)return!1;if(t.coordPlane===Ke.World){let s=e.localBounds;i&&(s=s.translate(i));const r=s.transform(t.get().matrix);return!this._worldBounds.overlaps(r)}else return!1}}Cf.priority=Xs.Higher;class I0 extends wf{constructor(t,e){var i,s;super(t,e),this.collider=t,this.id=-1,this.hasZeroBounds=!1,this.cells=[],this.gridSize=e;const r=t.bounds;this.hasZeroBounds=r.hasZeroDimensions(),this.leftX=Math.floor(r.left/this.gridSize),this.rightX=Math.floor(r.right/this.gridSize),this.bottomY=Math.floor(r.bottom/this.gridSize),this.topY=Math.floor(r.top/this.gridSize),this.owner=t.owner,this.body=(i=this.owner)===null||i===void 0?void 0:i.get(Gt),this.collisionType=(s=this.body.collisionType)!==null&&s!==void 0?s:ft.PreventCollision}update(){var t,e;super.update(),this.body=(t=this.owner)===null||t===void 0?void 0:t.get(Gt),this.collisionType=(e=this.body.collisionType)!==null&&e!==void 0?e:ft.PreventCollision,this.hasZeroBounds=this.collider.localBounds.hasZeroDimensions()}}class Qu{constructor(t){this._pairs=new Set,this._nonPairs=new Set,this._pairPool=new vc(()=>new gi({id:Pr("collider",0)},{id:Pr("collider",0)}),e=>(e.colliderA=null,e.colliderB=null,e),200),this.gridSize=t.size,this.hashGrid=new xf({size:this.gridSize,proxyFactory:(e,i)=>new I0(e,i)}),this._pairPool.disableWarnings=!0}getColliders(){return Array.from(this.hashGrid.objectToProxy.keys())}query(t){return this.hashGrid.query(t)}rayCast(t,e){var i,s,r;const o=[],l=(i=e==null?void 0:e.maxDistance)!==null&&i!==void 0?i:1/0,c=e==null?void 0:e.collisionGroup,d=c?c.category:(s=e==null?void 0:e.collisionMask)!==null&&s!==void 0?s:Tn.All.category,_=(r=e==null?void 0:e.searchAllColliders)!==null&&r!==void 0?r:!1,f=t.dir.normalize(),g=f.y/f.x,m=f.x/f.y,x=Math.sqrt(1+g*g)*this.gridSize,C=Math.sqrt(1+m*m)*this.gridSize,T=t.pos.x/this.gridSize,A=t.pos.y/this.gridSize,S=D(1,1);let E=~~T,M=~~A,O=0,N=0;f.x<0?(S.x=-1,O=(T-E)*x):(S.x=1,O=(E+1-T)*x),f.y<0?(S.y=-1,N=(A-M)*C):(S.y=1,N=(M+1-A)*C);const F=new Set;let K=!1,nt=9999;for(;!K&&nt>0&&(nt--,!!this.hashGrid.bounds.contains(D(E*this.gridSize,M*this.gridSize)));){const pt=Bs.calculateHashKey(E,M),ht=this.hashGrid.sparseHashGrid.get(pt);if(ht){const ct=[];for(let bt=0;bt<ht.proxies.length;bt++){const wt=ht.proxies[bt];if(!F.has(wt.collider.id.value)){if(F.add(wt.collider.id.value),e!=null&&e.ignoreCollisionGroupAll&&wt.body.group===Tn.All)continue;const Ct=(d&wt.body.group.category)!==0;if(wt.body.group&&!Ct)continue;const dt=wt.collider.rayCast(t,l);dt&&ct.push(dt)}}ct.sort((bt,wt)=>bt.distance-wt.distance);for(let bt=0;bt<ct.length;bt++){const wt=ct[bt];if(e!=null&&e.filter){if(e.filter(wt)&&(o.push(wt),!_)){K=!0;break}}else if(o.push(wt),!_){K=!0;break}}}O<N?(E+=S.x,O+=x):(M+=S.y,N+=C)}return o.sort((pt,ht)=>pt.distance-ht.distance),!_&&o.length?[o[0]]:o}track(t){let e=[t];if(t instanceof Ve){const i=t.getColliders();for(const s of i)s.owner=t.owner;e=i}for(const i of e)this.hashGrid.track(i)}untrack(t){let e=[t];t instanceof Ve&&(e=t.getColliders());for(const i of e)this.hashGrid.untrack(i)}_canCollide(t,e){return!(t.collider.id===e.collider.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.hasZeroBounds||e.hasZeroBounds||!t.body.group.canCollide(e.body.group)||t.collisionType===ft.Fixed&&e.collisionType===ft.Fixed||t.collisionType===ft.PreventCollision||e.collisionType===ft.PreventCollision||!t.owner.isActive||!e.owner.isActive)}broadphase(t,e){const i=[];this._pairs.clear(),this._nonPairs.clear();let s=0;for(const r of this.hashGrid.objectToProxy.values())if(r.id=s++,!(!r.owner.isActive||r.collisionType===ft.PreventCollision))for(let o=0;o<r.cells.length;o++){const l=r.cells[o];for(let c=0;c<l.proxies.length;c++){const d=l.proxies[c];if(d.id===r.id)continue;const _=gi.calculatePairHash(r.collider.id,d.collider.id);if(!this._nonPairs.has(_))if(!this._pairs.has(_)&&this._canCollide(r,d)&&r.object.bounds.overlaps(d.object.bounds)){const f=this._pairPool.get();f.colliderA=r.collider,f.colliderB=d.collider,f.id=_,this._pairs.add(_),i.push(f)}else this._nonPairs.add(_)}}return i}narrowphase(t,e){const i=[];for(let s=0;s<t.length;s++){const r=t[s].collide();for(let o=0;o<r.length;o++){const l=r[o];i.push(l),e&&e.physics.contacts.set(l.id,l)}}return this._pairPool.done(),e&&(e.physics.collisions+=i.length),i}update(t,e){return this.hashGrid.update(t)}debug(t,e){this.hashGrid.debug(t,e)}}class R0{get config(){return Tk(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._config.spatialPartition===To.SparseHashGrid?this._collisionProcessor=new Qu(this._config.sparseHashGrid):this._collisionProcessor=new qh(this._config);for(const e of t)this._collisionProcessor.track(e)}return this._collisionProcessor}constructor(t){this.$configUpdate=new pi,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(e=>{this._configDirty=!0,Gt.updateDefaultPhysicsConfig(e.bodies)}),this._config.spatialPartition===To.SparseHashGrid?this._collisionProcessor=new Qu(this._config.sparseHashGrid):this._collisionProcessor=new qh(this._config)}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}query(t){return this._collisionProcessor.query(t)}}class Pc{constructor(){this.events=new de,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(s=>typeof s!==void 0).length,i=t.buttons.filter(s=>typeof s!==void 0).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}emit(t,e){this.events.emit(t,e)}on(t,e){return this._enableAndUpdate(),this.events.on(t,e)}once(t,e){return this._enableAndUpdate(),this.events.once(t,e)}off(t,e){this._enableAndUpdate(),this.events.off(t,e)}update(){var t,e;if(!this.enabled||!this.supported||!this._enabled)return;this.init();const i=this._navigator.getGamepads();for(let s=0;s<i.length;s++){if(i[s]){const o=this.at(s);!this.at(s).connected&&this._isGamepadValid(i[s])&&(o.events.pipe(this.events),this.events.emit("connect",new j_(s,this.at(s)))),this.at(s).connected=!0}else{const o=this.at(s);o.connected&&(this.events.emit("disconnect",new q_(s,o)),o.events.unpipe(this.events)),o.connected=!1;continue}if(this.at(s).update(),i[s].timestamp&&i[s].timestamp===this._gamePadTimeStamps[s])continue;this._gamePadTimeStamps[s]=i[s].timestamp,this.at(s).navigatorGamepad=i[s];const r=i[s];if(r){for(let o=0;o<r.buttons.length;o++){const l=r.buttons[o],c=l==null?void 0:l.value;c!==((t=this._oldPads[s])===null||t===void 0?void 0:t.getButton(o))&&(l!=null&&l.pressed?(this.at(s).updateButton(o,c),this.at(s).events.emit("button",new V_(o in ja?o:ja.Unknown,o,c,this.at(s)))):this.at(s).updateButton(o,0))}for(let o=0;o<r.axes.length;o++){const l=r.axes[o];l!==((e=this._oldPads[s])===null||e===void 0?void 0:e.getAxes(o))&&(this.at(s).updateAxes(o,l),this.at(s).events.emit("axis",new X_(o,l,this.at(s))))}}this._oldPads[s]=this._clonePad(i[s])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Ph),this._oldPads.push(new Ph);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new Ph;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}Pc.MinAxisMoveThreshold=.05;class Ph{constructor(){this.events=new de,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Pc.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var ja;(function(n){n[n.Unknown=-1]="Unknown",n[n.Face1=0]="Face1",n[n.Face2=1]="Face2",n[n.Face3=2]="Face3",n[n.Face4=3]="Face4",n[n.LeftBumper=4]="LeftBumper",n[n.RightBumper=5]="RightBumper",n[n.LeftTrigger=6]="LeftTrigger",n[n.RightTrigger=7]="RightTrigger",n[n.Select=8]="Select",n[n.Start=9]="Start",n[n.LeftStick=10]="LeftStick",n[n.RightStick=11]="RightStick",n[n.DpadUp=12]="DpadUp",n[n.DpadDown=13]="DpadDown",n[n.DpadLeft=14]="DpadLeft",n[n.DpadRight=15]="DpadRight",n[n.CenterButton=16]="CenterButton",n[n.MiscButton1=17]="MiscButton1"})(ja||(ja={}));var Ku;(function(n){n[n.LeftStickX=0]="LeftStickX",n[n.LeftStickY=1]="LeftStickY",n[n.RightStickX=2]="RightStickX",n[n.RightStickY=3]="RightStickY"})(Ku||(Ku={}));class M0{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,e]of this._handlers.entries()){const i=t(this.inputs);i&&e(i)}}on(t,e){this._handlers.set(t,e)}}function D0(){try{const n=()=>{};window.top.addEventListener("blur",n),window.top.removeEventListener("blur",n)}catch{return!0}return!1}var qa;(function(n){n.Backquote="Backquote",n.Backslash="Backslash",n.BracketLeft="BracketLeft",n.BracketRight="BracketRight",n.Comma="Comma",n.Key0="Digit0",n.Key1="Digit1",n.Key2="Digit2",n.Key3="Digit3",n.Key4="Digit4",n.Key5="Digit5",n.Key6="Digit6",n.Key7="Digit7",n.Key8="Digit8",n.Key9="Digit9",n.Digit0="Digit0",n.Digit1="Digit1",n.Digit2="Digit2",n.Digit3="Digit3",n.Digit4="Digit4",n.Digit5="Digit5",n.Digit6="Digit6",n.Digit7="Digit7",n.Digit8="Digit8",n.Digit9="Digit9",n.Equal="Equal",n.IntlBackslash="IntlBackslash",n.IntlRo="IntlRo",n.IntlYen="IntlYen",n.A="KeyA",n.B="KeyB",n.C="KeyC",n.D="KeyD",n.E="KeyE",n.F="KeyF",n.G="KeyG",n.H="KeyH",n.I="KeyI",n.J="KeyJ",n.K="KeyK",n.L="KeyL",n.M="KeyM",n.N="KeyN",n.O="KeyO",n.P="KeyP",n.Q="KeyQ",n.R="KeyR",n.S="KeyS",n.T="KeyT",n.U="KeyU",n.V="KeyV",n.W="KeyW",n.X="KeyX",n.Y="KeyY",n.Z="KeyZ",n.KeyA="KeyA",n.KeyB="KeyB",n.KeyC="KeyC",n.KeyD="KeyD",n.KeyE="KeyE",n.KeyF="KeyF",n.KeyG="KeyG",n.KeyH="KeyH",n.KeyI="KeyI",n.KeyJ="KeyJ",n.KeyK="KeyK",n.KeyL="KeyL",n.KeyM="KeyM",n.KeyN="KeyN",n.KeyO="KeyO",n.KeyP="KeyP",n.KeyQ="KeyQ",n.KeyR="KeyR",n.KeyS="KeyS",n.KeyT="KeyT",n.KeyU="KeyU",n.KeyV="KeyV",n.KeyW="KeyW",n.KeyX="KeyX",n.KeyY="KeyY",n.KeyZ="KeyZ",n.Minus="Minus",n.Period="Period",n.Quote="Quote",n.Semicolon="Semicolon",n.Slash="Slash",n.AltLeft="AltLeft",n.AltRight="AltRight",n.Alt="Alt",n.AltGraph="AltGraph",n.Backspace="Backspace",n.CapsLock="CapsLock",n.ContextMenu="ContextMenu",n.ControlLeft="ControlLeft",n.ControlRight="ControlRight",n.Enter="Enter",n.MetaLeft="MetaLeft",n.MetaRight="MetaRight",n.ShiftLeft="ShiftLeft",n.ShiftRight="ShiftRight",n.Space="Space",n.Tab="Tab",n.Convert="Convert",n.KanaMode="KanaMode",n.NonConvert="NonConvert",n.Delete="Delete",n.End="End",n.Help="Help",n.Home="Home",n.Insert="Insert",n.PageDown="PageDown",n.PageUp="PageUp",n.Up="ArrowUp",n.Down="ArrowDown",n.Left="ArrowLeft",n.Right="ArrowRight",n.ArrowUp="ArrowUp",n.ArrowDown="ArrowDown",n.ArrowLeft="ArrowLeft",n.ArrowRight="ArrowRight",n.NumLock="NumLock",n.Numpad0="Numpad0",n.Numpad1="Numpad1",n.Numpad2="Numpad2",n.Numpad3="Numpad3",n.Numpad4="Numpad4",n.Numpad5="Numpad5",n.Numpad6="Numpad6",n.Numpad7="Numpad7",n.Numpad8="Numpad8",n.Numpad9="Numpad9",n.Num0="Numpad0",n.Num1="Numpad1",n.Num2="Numpad2",n.Num3="Numpad3",n.Num4="Numpad4",n.Num5="Numpad5",n.Num6="Numpad6",n.Num7="Numpad7",n.Num8="Numpad8",n.Num9="Numpad9",n.NumAdd="NumpadAdd",n.NumpadAdd="NumpadAdd",n.NumDecimal="NumpadDecimal",n.NumpadDecimal="NumpadDecimal",n.NumDivide="NumpadDivide",n.NumpadDivide="NumpadDivide",n.NumEnter="NumpadEnter",n.NumpadEnter="NumpadEnter",n.NumMultiply="NumpadMultiply",n.NumpadMultiply="NumpadMultiply",n.NumSubtract="NumpadSubtract",n.NumpadSubtract="NumpadSubtract",n.Esc="Escape",n.Escape="Escape",n.F1="F1",n.F2="F2",n.F3="F3",n.F4="F4",n.F5="F5",n.F6="F6",n.F7="F7",n.F8="F8",n.F9="F9",n.F10="F10",n.F11="F11",n.F12="F12",n.F13="F13",n.F14="F14",n.F15="F15",n.F16="F16",n.F17="F17",n.F18="F18",n.F19="F19",n.F20="F20",n.PrintScreen="PrintScreen",n.ScrollLock="ScrollLock",n.Pause="Pause",n.Unidentified="Unidentified"})(qa||(qa={}));class ba extends Bt{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class L0{constructor(){this.events=new de,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const e of this._keys){const i=new ba(e,t.key,t);this.events.emit("up",i),this.events.emit("release",i)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes(qa.MetaLeft)||this._keys.includes(qa.MetaRight))&&this._releaseAllKeys(t);const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const i=new ba(e,t.key,t);this.events.emit("down",i),this.events.emit("press",i)}},this._handleKeyUp=t=>{if(!this._enabled)return;const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new ba(e,t.key,t);this.events.emit("up",s),this.events.emit("release",s),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}init(t){let{global:e}=t;const{grabWindowFocus:i}=t;e||(D0()?(e=window,i&&window.focus(),lt.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):e=window.top),e.addEventListener("blur",()=>{this._keys.length=0}),e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}clear(){this._keysDown.length=0,this._keysUp.length=0,this._keys.length=0}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new ba(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._enabled?this._keysDown.indexOf(t)>-1:!1}isHeld(t){return this._enabled?this._keys.indexOf(t)>-1:!1}wasReleased(t){return this._enabled?this._keysUp.indexOf(t)>-1:!1}triggerEvent(t,e,i){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:i??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:i??null}))}}class Eo{static fromPagePosition(t,e,i){let s,r,o,l;arguments.length===3?(s=t,r=e,o=new I(s,r),l=i):(o=t,s=o.x,r=o.y,l=e);const c=l.screen.pageToScreenCoordinates(o),d=l.screen.screenToWorldCoordinates(c);return new Eo(d,o,c)}constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}}class ya{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,e,i,s,r,o){this.type=t,this.pointerId=e,this.button=i,this.pointerType=s,this.coordinates=r,this.nativeEvent=o,this.active=!0}}class F0{cancel(){this.active=!1}constructor(t,e,i,s,r,o,l,c,d,_,f,g){this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=r,this.screenY=o,this.index=l,this.deltaX=c,this.deltaY=d,this.deltaZ=_,this.deltaMode=f,this.ev=g,this.active=!0}}class Ju{constructor(){this.events=new de,this.lastPagePos=I.Zero,this.lastScreenPos=I.Zero,this.lastWorldPos=I.Zero,this._onPointerMove=t=>{this.lastPagePos=new I(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new I(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new I(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new I(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new I(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new I(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_updateWorldPosition(t){const e=Eo.fromPagePosition(this.lastPagePos,t);this.lastScreenPos=e.screenPos,this.lastWorldPos=e.worldPos}}var po;(function(n){n.Pixel="Pixel",n.Line="Line",n.Page="Page"})(po||(po={}));var $n;(function(n){n[n.NoButton=-1]="NoButton",n[n.Left=0]="Left",n[n.Middle=1]="Middle",n[n.Right=2]="Right",n[n.Unknown=3]="Unknown"})($n||($n={}));var ln;(function(n){n.Left="Left",n.Middle="Middle",n.Right="Right",n.Unknown="Unknown",n.NoButton="NoButton"})(ln||(ln={}));var hn;(function(n){n.Touch="Touch",n.Mouse="Mouse",n.Pen="Pen",n.Unknown="Unknown"})(hn||(hn={}));function DI(n){return globalThis.TouchEvent&&n instanceof globalThis.TouchEvent}function LI(n){return globalThis.PointerEvent&&n instanceof globalThis.PointerEvent}class kc{constructor(t,e){this.target=t,this.engine=e,this.events=new de,this.primary=new Ju,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,e){const i=new kc(t,e);return i.primary=this.primary,i._pointers=this._pointers,i}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new Ju);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return this._enabled&&(e=this.currentFramePointerDown.get(t))!==null&&e!==void 0?e:!1}wasDown(t){var e;return this._enabled&&(e=this.lastFramePointerDown.get(t))!==null&&e!==void 0?e:!1}isDragging(t){return this._enabled?this.isDown(t):!1}isDragStart(t){return this._enabled?this.isDown(t)&&!this.wasDown(t):!1}isDragEnd(t){return this._enabled?!this.isDown(t)&&this.wasDown(t):!1}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown){if(!t.active)continue;this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t)}for(const t of this.currentFrameUp){if(!t.active)continue;this.emit("up",t),this.at(t.pointerId).emit("up",t)}for(const t of this.currentFrameMove){if(!t.active)continue;this.emit("move",t),this.at(t.pointerId).emit("move",t)}for(const t of this.currentFrameCancel){if(!t.active)continue;this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t)}for(const t of this.currentFrameWheel)t.active&&(this.emit("pointerwheel",t),this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t));if(this.engine.currentScene.camera.hasChanged())for(const t of this._pointers)t._updateWorldPosition(this.engine)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,s]of e)s===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var e;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const i={passive:!(this.engine.pageScrollPreventionMode===Vn.All||this.engine.pageScrollPreventionMode===Vn.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,i):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,i):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,i),((e=t==null?void 0:t.grabWindowFocus)!==null&&e!==void 0?e:!0)&&D0()){const r=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",r):(this.target.addEventListener("touchstart",r),this.target.addEventListener("mousedown",r))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const i=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((s,r)=>s-r).findIndex(s=>s===t);return this._activeNativePointerIdsToNormalized.set(t,i),i}_handle(t){if(!this._enabled)return;t.preventDefault();const e=new Map;let i,s;if(DI(t)){i=ln.Unknown,s=hn.Touch;for(let r=0;r<t.changedTouches.length;r++){const o=t.changedTouches[r],l=Eo.fromPagePosition(o.pageX,o.pageY,this.engine),c=r+1,d=this._normalizePointerId(c);this.currentFramePointerCoords.set(d,l),e.set(d,l)}}else{i=this._nativeButtonToPointerButton(t.button),s=hn.Mouse;const r=Eo.fromPagePosition(t.pageX,t.pageY,this.engine);let o=1;LI(t)&&(o=t.pointerId,s=this._stringToPointerType(t.pointerType));const l=this._normalizePointerId(o);this.currentFramePointerCoords.set(l,r),e.set(l,r)}for(const[r,o]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new ya("down",r,i,s,o,t)),this.currentFramePointerDown.set(r,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new ya("up",r,i,s,o,t)),this.currentFramePointerDown.set(r,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new ya("move",r,i,s,o,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new ya("cancel",r,i,s,o,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===Vn.All||this.engine.pageScrollPreventionMode===Vn.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(D(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),s=-1/40,r=t.deltaX||t.wheelDeltaX*s||0,o=t.deltaY||t.wheelDeltaY*s||t.wheelDelta*s||t.detail||0,l=t.deltaZ||0;let c=po.Pixel;t.deltaMode&&(t.deltaMode===1?c=po.Line:t.deltaMode===2&&(c=po.Page));const d=new F0(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,r,o,l,c,t);this.currentFrameWheel.push(d)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const s=this.engine.currentScene.world.get(Ec);s.preupdate(this.engine.currentScene,1),s.update(1)}_nativeButtonToPointerButton(t){switch(t){case $n.NoButton:return ln.NoButton;case $n.Left:return ln.Left;case $n.Middle:return ln.Middle;case $n.Right:return ln.Right;case $n.Unknown:return ln.Unknown;default:return xw(t)}}_stringToPointerType(t){switch(t){case"touch":return hn.Touch;case"mouse":return hn.Mouse;case"pen":return hn.Pen;default:return hn.Unknown}}}class Af{constructor(t){this._enabled=!0;const{pointerTarget:e,grabWindowFocus:i,engine:s}=t;this.keyboard=new L0,this.pointers=new kc(e,s),this.gamepads=new Pc,this.keyboard.init({grabWindowFocus:i}),this.pointers.init({grabWindowFocus:i}),this.gamepads.init(),this.inputMapper=new M0({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}clear(){this.keyboard.clear(),this.pointers.clear()}}class FI{}const BI={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PreLoad:"preload"};function Ls(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Vi{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof mi)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof C0)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof f0)}get timers(){return this._timers}constructor(){this._logger=lt.getInstance(),this.events=new de,this.camera=new y0,this.world=new P0(this),this.physics=new R0(bn()),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(bf),this.world.add(new Sc(this.world,this.physics)),this.world.add(new Tc(this.world,this.physics)),this.world.add(Ec),this.world.add(yf),this.world.add(Cf),this.world.add(mf),this.world.add(vf)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var e;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new Af({pointerTarget:t.pointerScope===kr.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new jo(t,this))}catch(i){throw this._logger.error(`Error during scene initialization for scene ${(e=t.director)===null||e===void 0?void 0:e.getSceneName(this)}!`),i}this._isInitialized=!0}}async _activate(t){var e,i;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(s){throw this._logger.error(`Error during scene activation for scene ${(i=(e=this.engine)===null||e===void 0?void 0:e.director)===null||i===void 0?void 0:i.getSceneName(this)}!`),s}}async _deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new ir(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new sr(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Go(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new $o(t,e,this)),this.onPostDraw(t,e)}update(t,e){var i;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(i=t.director)===null||i===void 0?void 0:i.getSceneName(this)}!`);return}this._preupdate(t,e);let s,r;for(s=0,r=this._cancelQueue.length;s<r;s++)this.removeTimer(this._cancelQueue[s]);this._cancelQueue.length=0;for(const o of this._timers)o.update(e);this.world.update(Ui.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e),this.input.update()}draw(t,e){var i;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,e),this.world.update(Ui.Draw,e),!((i=this.engine)===null||i===void 0)&&i.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new W_(t,this)),this.emit("postdebugdraw",new N_(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),t instanceof Sr){ww(this._timers,t)||this.addTimer(t);return}this.world.add(t),t.scene=this}transfer(t){let e;t instanceof oi&&t.scene&&t.scene!==this&&(e=t.scene,t.scene.world.remove(t,!1)),t instanceof Sr&&t.scene&&(e=t.scene,t.scene.removeTimer(t)),e==null||e.emit("entityremoved",{target:t}),this.add(t)}remove(t){this.emit("entityremoved",{target:t}),t instanceof oi&&(t.isActive&&t.kill(),this.world.remove(t)),t instanceof Sr&&this.removeTimer(t)}clear(t=!0){for(let e=this.entities.length-1;e>=0;e--)this.world.remove(this.entities[e],t);for(let e=this.timers.length-1;e>=0;e--)this.removeTimer(this.timers[e])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors;for(let i=0;i<e.length;i++){const s=e[i];s instanceof pf&&t.stats.currFrame.actors.ui++,t.stats.currFrame.actors.alive++;for(let r=0;r<s.children.length;r++){const o=s.children[r];_0(o)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}}var Tr;(function(n){n.Protanope="Protanope",n.Deuteranope="Deuteranope",n.Tritanope="Tritanope"})(Tr||(Tr={}));const OI=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class B0{constructor(t,e){this._shader=new Ei({gl:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_uv;
      out vec2 v_texcoord;
      out vec2 v_uv;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_uv;
        v_uv = a_uv;
      }`,fragmentSource:e}),this._shader.compile(),this._buffer=new qs({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new In({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class O0{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new B0(t,OI),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===Tr.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===Tr.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===Tr.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class U0{constructor(t){this._engine=t,this._colorBlindPostProcessor=new O0(Tr.Protanope)}correct(t){this._engine.graphicsContext instanceof xn&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof xn&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class z0{constructor(t){this.stats={currFrame:new Va,prevFrame:new Va},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:$.Yellow,showZIndex:!1,showScale:!1,scaleColor:$.Green,showRotation:!1,rotationColor:$.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:$.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:$.Blue,showOwner:!1,showGeometry:!0,geometryColor:$.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:$.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:$.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:$.Yellow,showAcceleration:!1,accelerationColor:$.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:$.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:$.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:$.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:$.Yellow,positionSize:1,showGrid:!1,gridColor:$.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new U0(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class Va{constructor(){this._id=0,this._elapsedMs=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Ic,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.elapsedMs=t.elapsedMs,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.elapsedMs=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Va;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get elapsedMs(){return this._elapsedMs}set elapsedMs(t){this._elapsedMs=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Ic{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Ic;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class t_{on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class H0{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new t_(this._windowGlobal),this._documentComponent=new t_(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}const W0={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:Oe.Blended,canvasImageRendering:"auto"},N0={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:Oe.Blended,canvasImageRendering:"auto"};class G0{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!==null&&e!==void 0?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Sf{constructor(t){var e,i,s;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!==null&&e!==void 0?e:0,this._maxFps=(i=t.maxFps)!==null&&i!==void 0?i:this._maxFps,this._onFatalException=(s=t.onFatalException)!==null&&s!==void 0?s:this._onFatalException,this.fpsSampler=new G0({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new $0({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Tf({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0,i="preframe"){const s=this._totalElapsed+e;this._scheduledCbs.push([t,s,i])}__runScheduledCbs(t="preframe"){for(let e=this._scheduledCbs.length-1;e>-1;e--)t===this._scheduledCbs[e][2]&&this._scheduledCbs[e][1]<=this._totalElapsed&&(this._scheduledCbs[e][0](this._elapsed),this._scheduledCbs.splice(e,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const s=1e3/this._maxFps;if(i>=s){let r=0;s!==0&&(r=i%s,i=i-r),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||i),this.__runScheduledCbs("postframe"),s!==0?this._lastTime=e-r:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class Tf extends Sf{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class $0 extends Sf{constructor(t){super({...t}),this._logger=lt.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(e??this._updateMs)}}var UI=Xe(296);class j0{constructor(){this._toasterCss=UI.A.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,i){this._initialize();const s=document.createElement("div");s.className="ex-toast-message";const r=t.split("[LINK]").map(_=>this._createFragment(_));if(e){const _=document.createElement("a");_.href=e,i?_.innerText=i:_.innerText=e,r.splice(1,0,_)}const o=document.createElement("div");r.forEach(_=>{o.appendChild(_)}),s.appendChild(o);const l=document.createElement("button");l.innerText="x",l.addEventListener("click",()=>{this._container.removeChild(s)}),s.appendChild(l);const c=_=>{if(_.key==="Escape")try{this._container.removeChild(s)}catch{}document.removeEventListener("keydown",c)};document.addEventListener("keydown",c);const d=this._container.firstChild;this._container.insertBefore(s,d)}}const zI={NavigationStart:"navigationstart",Navigation:"navigation",NavigationEnd:"navigationend"};class q0{get isTransitioning(){return this._isTransitioning}constructor(t,e){this._engine=t,this.events=new de,this._logger=lt.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Vi,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const i in e){const s=e[i];this.add(i,s),i==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto;this._deferredGoto=void 0;const e=this._deferredTransition;this._deferredTransition=void 0;const i=this.getSceneInstance(t);i&&e&&e._addToTargetScene(this._engine,i),await this.swapScene(t),i&&e&&await this.playTransition(e,i)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,e){const i=e==null?void 0:e.loader;i instanceof Ha?this.mainLoader=i:Gu(i)?this.mainLoader=new i:this.mainLoader=new Dr;let s;if(e!=null&&e.inTransition){const{inTransition:r}=e;s=r}if(this.startScene=t,s){const r=this.getSceneInstance(this.startScene);r&&(s._addToTargetScene(this._engine,r),this.swapScene(this.startScene).then(()=>this.playTransition(s,r)))}else this.swapScene(this.startScene);this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var e;const i=this.scenes[t];if(!(i instanceof Vi||Ls(i)))return(e=i==null?void 0:i.transitions)===null||e===void 0?void 0:e.in}_getOutTransition(t){var e;const i=this.scenes[t];if(!(i instanceof Vi||Ls(i)))return(e=i==null?void 0:i.transitions)===null||e===void 0?void 0:e.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const e=this.scenes[t];if(e instanceof Vi||Ls(e))return e;if(e)return e.scene}getSceneName(t){for(const[e,i]of Object.entries(this.scenes))if(i instanceof Vi){if(t===i)return e}else if(!Ls(i)&&t===i.scene)return e;for(const[e,i]of Object.entries(this.scenes))if(Ls(i)){if(t.constructor===i)return e}else if(!(i instanceof Vi)&&t.constructor===i.scene)return e;return null}assertAdded(t){return this}assertRemoved(t){return this}add(t,e){if(!(e instanceof Vi)&&!Ls(e)){const{loader:i,transitions:s}=e,{in:r,out:o}=s??{};this._sceneToTransition.set(t,{in:r,out:o}),Gu(i)?this._sceneToLoader.set(t,new i):i&&this._sceneToLoader.set(t,i)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,this.assertAdded(t)}remove(t){if(t instanceof Vi||Ls(t)){const e=t;for(const i in this.scenes)if(this.scenes.hasOwnProperty(i)){const s=this.scenes[i];let r;if(s instanceof Vi||Ls(s)?r=s:r=s.scene,r===e){if(i===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${i}`);this._sceneToInstance.delete(i),this._sceneToTransition.delete(i),this._sceneToLoader.delete(i),delete this.scenes[i]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goToScene(t,e){var i,s,r,o,l,c;const d=this.getSceneInstance(t);if(!d){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const _=this.currentScene,f=this.currentSceneName,g=(s=(i=this._engine.input)===null||i===void 0?void 0:i.enabled)!==null&&s!==void 0?s:!0;this._isTransitioning=!0;const m=(r=this.getSceneInstance(f))===null||r===void 0?void 0:r.onTransition("out"),x=d==null?void 0:d.onTransition("in");e={sourceOut:(o=this._getOutTransition(this.currentSceneName))!==null&&o!==void 0?o:m,destinationIn:(l=this._getInTransition(t))!==null&&l!==void 0?l:x,...e};const{sourceOut:C,destinationIn:T,sceneActivationData:A}=e,S=C??this._getOutTransition(this.currentSceneName),E=T??this._getInTransition(t),M=(S==null?void 0:S.hideLoader)||(E==null?void 0:E.hideLoader);M&&this.maybeLoadScene(t,M),this._emitEvent("navigationstart",f,t),S&&await this.playTransition(S,_),await this.maybeLoadScene(t,M),E&&await E.onPreviousSceneDeactivate(this.currentScene),E&&E._addToTargetScene(this._engine,d),await this.swapScene(t,A),this._emitEvent("navigation",f,t),E&&await this.playTransition(E,d),this._emitEvent("navigationend",f,t),(c=this._engine.input)===null||c===void 0||c.toggleEnabled(g),this._isTransitioning=!1}getSceneInstance(t){const e=this.getSceneDefinition(t);if(!e)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(e instanceof Vi)return this._sceneToInstance.set(t,e),e;const i=new e;return this._sceneToInstance.set(t,i),i}async maybeLoadScene(t,e=!1){var i;const s=(i=this._getLoader(t))!==null&&i!==void 0?i:new Ha,r=this.getSceneDefinition(t),o=this.getSceneInstance(t);r&&o&&!this._loadedScenes.has(o)&&(o.onPreLoad(s),o.events.emit("preload",{loader:s}),e?this._engine.load(s,e):await this._engine.load(s),this._loadedScenes.add(o))}async playTransition(t,e){var i,s,r,o,l,c,d;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const _=(s=(i=e.input)===null||i===void 0?void 0:i.enabled)!==null&&s!==void 0?s:!0;(r=e.input)===null||r===void 0||r.toggleEnabled(!t.blockInput),(o=this._engine.input)===null||o===void 0||o.toggleEnabled(!t.blockInput),this.currentTransition._addToTargetScene(this._engine,e),await this.currentTransition._play(),(l=e.input)===null||l===void 0||l.toggleEnabled(_)}(c=this.currentTransition)===null||c===void 0||c.kill(),(d=this.currentTransition)===null||d===void 0||d.reset(),this.currentTransition=void 0}async swapScene(t,e){const i=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const s=this.getSceneInstance(t);if(s){const r=this.currentScene,o=s;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const d={engine:i,previousScene:r,nextScene:o};await this.currentScene._deactivate(d),this.currentScene.events.emit("deactivate",new K_(d,this.currentScene)),this.currentScene.input.clear()}const l=this._sceneToLoader.get(t);await(l==null?void 0:l.areResourcesLoaded()),this.currentScene=o,this.currentSceneName=t,i.screen.setCurrentCamera(o.camera),await this.currentScene._initialize(i);const c={engine:i,previousScene:r,nextScene:o,data:e};await this.currentScene._activate(c),this.currentScene.events.emit("activate",new Q_(c,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,e,i){const s=this.getSceneDefinition(e),r=this.getSceneDefinition(i);this.events.emit(t,{sourceScene:s,sourceName:e,destinationScene:r,destinationName:i})}}function V0(){const n={scope:(t,e)=>{const i=n.value;n.value=t;try{return e()}catch(s){throw s}finally{n.value=i}},value:void 0};return n}function X0(n){return n.value}const e_={textureCollectInterval:6e4};class Z0{constructor(t){this.options=t,this._running=!1,this._collectionMap=new Map,this._collectors=new Map,this.collectStaleResources=e=>{if(this._running){for(const[i,[s,r]]of this._collectors.entries()){const o=this.options.getTimestamp();for(const[l,[c,d]]of this._collectionMap.entries()){if(i!==c||d+r>=o)continue;s(l)&&this._collectionMap.delete(l)}}this._collectHandle=requestIdleCallback(this.collectStaleResources)}}}registerCollector(t,e,i){this._collectors.set(t,[i,e])}addCollectableResource(t,e){this._collectionMap.set(e,[t,this.options.getTimestamp()])}touch(t){const e=this._collectionMap.get(t);e&&this._collectionMap.set(t,[e[0],this.options.getTimestamp()])}forceCollectAll(){for(const[t,[e]]of this._collectors.entries())for(const[i]of this._collectionMap.entries())e(i)&&this._collectionMap.delete(i)}start(){this._running=!0,this.collectStaleResources()}stop(){this._running=!1,cancelIdleCallback(this._collectHandle)}}pw();const HI={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var Vn;(function(n){n[n.None=0]="None",n[n.Canvas=1]="Canvas",n[n.All=2]="All"})(Vn||(Vn={}));class Ai{static useEngine(){const t=X0(Ai.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s,r,o,l,c,d,_;this.scope=M=>Ai.Context.scope(this,M),this.version=i_,this.events=new de,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=M=>{lt.getInstance().fatal(M,M.stack)},this._toaster=new j0,this._timescale=1,this._isInitialized=!1,this._originalOptions={},this._handleWebGLContextLost=M=>{var O;M.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",M);const N=document.createElement("div");N.id="ex-webgl-graphics-context-lost",N.style.position="absolute",N.style.zIndex="99",N.style.left="50%",N.style.top="50%",N.style.display="flex",N.style.flexDirection="column",N.style.transform="translate(-50%, -50%)",N.style.backgroundColor="white",N.style.padding="10px",N.style.borderStyle="solid 1px";const F=document.createElement("div");if(F.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,N.appendChild(F),!((O=this.canvas)===null||O===void 0)&&O.parentElement){this.canvas.parentElement.appendChild(N);const K=F.querySelector("#ex-webgl-graphics-reload");K==null||K.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new Yi,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...Ai._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,Ye.freeze(),this.browser=new H0(window,document);const f=new Bw;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=f.test())){const M=document.createElement("div");if(M.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(M),f.failedTests.forEach(function(O){const N=document.createElement("div");N.innerText="Browser feature missing "+O,document.body.appendChild(N)}),t.canvasElementId){const O=document.getElementById(t.canvasElementId);O&&O.parentElement.removeChild(O)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${i_})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=lt.getInstance(),this._logger.defaultLevel===Ue.Debug&&f.logBrowserFeatures(),this._logger.debug("Building engine..."),t.garbageCollection===!0?this.garbageCollectorConfig={...e_}:t.garbageCollection===!1?(this._logger.warn("WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted"),this.garbageCollectorConfig=null):this.garbageCollectorConfig={...e_,...t.garbageCollection},this._garbageCollector=new Z0({getTimestamp:Date.now}),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId)}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));this.canvas&&!t.enableCanvasContextMenu&&this.canvas.addEventListener("contextmenu",M=>{M.preventDefault()});let g=(e=t.displayMode)!==null&&e!==void 0?e:$e.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(g=$e.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),g=$e.FitScreen),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this._originalDisplayMode=g;let m,x,C,T,A,S;typeof t.antialiasing=="object"?{pixelArtSampler:m,nativeContextAntialiasing:C,multiSampleAntialiasing:S,filtering:A,canvasImageRendering:T}={...t.pixelArt?N0:W0,...t.antialiasing}:(m=!!t.pixelArt,C=!1,S=t.antialiasing,T=t.antialiasing?"auto":"pixelated",A=t.antialiasing?Oe.Blended:Oe.Pixel),C&&S&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(x=.25),(!t.antialiasing||A===Oe.Pixel)&&(x=0),x=(s=(i=t.uvPadding)!==null&&i!==void 0?i:x)!==null&&s!==void 0?s:.01;let E=Ye.isEnabled("use-canvas-context");if(!E)try{this.graphicsContext=new xn({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:m,antialiasing:C,multiSampleAntialiasing:S,uvPadding:x,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,garbageCollector:this.garbageCollectorConfig?{garbageCollector:this._garbageCollector,collectionInterval:this.garbageCollectorConfig.textureCollectInterval}:null,handleContextLost:(r=t.handleContextLost)!==null&&r!==void 0?r:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(M){this._logger.warn(`Excalibur could not load webgl for some reason (${M.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),E=!0}E&&(this.graphicsContext=new jh({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:C,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new Nu({canvas:this.canvas,context:this.graphicsContext,antialiasing:C,canvasImageRendering:T,browser:this.browser,viewport:(o=t.viewport)!==null&&o!==void 0?o:t.width&&t.height?{width:t.width,height:t.height}:Wu.SVGA,resolution:t.resolution,displayMode:g,pixelRatio:t.suppressHiDPIScaling?1:(l=t.pixelRatio)!==null&&l!==void 0?l:null}),we.filtering=A,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(c=t.maxFps)!==null&&c!==void 0?c:this.maxFps,this.fixedUpdateTimestep=(d=t.fixedUpdateTimestep)!==null&&d!==void 0?d:this.fixedUpdateTimestep,this.fixedUpdateFps=(_=t.fixedUpdateFps)!==null&&_!==void 0?_:this.fixedUpdateFps,this.fixedUpdateTimestep=this.fixedUpdateTimestep||1e3/this.fixedUpdateFps,this.clock=new Tf({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:M=>this.onFatalException(M)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={...bn(),enabled:t.physics}:(this.physics={...bn()},Lh(this.physics,t.physics)),this.debug=new z0(this),this.director=new q0(this,t.scenes),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,Ai.InstanceCount++}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:i}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=Ai._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),i===void 0&&(i=Ai._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!Ye.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let s=0;for(let o=0;o<this._fpsSamples.length;o++)s+=this._fpsSamples[o];const r=s/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&r<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),i&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,i;const s=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(s,this.canvas),this.canvas=s;const r={...this._originalOptions,antialiasing:this.screen.antialiasing},o=this._originalDisplayMode;this.graphicsContext=new jh({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:r.antialiasing,backgroundColor:r.backgroundColor,snapToPixel:r.snapToPixel,useDrawSorting:r.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Nu({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=r.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(e=r.viewport)!==null&&e!==void 0?e:r.width&&r.height?{width:r.width,height:r.height}:Wu.SVGA,resolution:r.resolution,displayMode:o,pixelRatio:r.suppressHiDPIScaling?1:(i=r.pixelRatio)!==null&&i!==void 0?i:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const l=r.pointerScope===kr.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(l,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this._garbageCollector.forceCollectAll(),this.input.toggleEnabled(!1),this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,Ai.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<0){lt.getInstance().warnOnce("engine.timescale to a value less than 0 are ignored");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){return this.director.add(t,e),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const e=this.director.getDeferredScene();e instanceof Vi?e.add(t):this.currentScene.add(t)}remove(t){t instanceof oi&&this.currentScene.remove(t),(t instanceof Vi||Ls(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goToScene(t,e){await this.scope(async()=>{await this.director.goToScene(t,e)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var e,i;this.pageScrollPreventionMode=t.scrollPreventionMode;const s=t&&t.pointerScope===kr.Document?document:this.canvas,r=(i=(e=this._originalOptions)===null||e===void 0?void 0:e.grabWindowFocus)!==null&&i!==void 0?i:!0;this.input=new Af({pointerTarget:s,grabWindowFocus:r,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new Y_(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new Z_(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new jo(t,this)),this._isInitialized=!0)}_update(t){var e;if(this._isLoading){(e=this._loader)===null||e===void 0||e.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new ir(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new sr(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){var e,i;if(this.graphicsContext.backgroundColor=(e=this.currentScene.backgroundColor)!==null&&e!==void 0?e:this.backgroundColor,this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((i=this._loader)===null||i===void 0||i.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Go(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new $o(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,e){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let i;return t instanceof Ha?i=t:typeof t=="string"&&(this.director.configureStart(t,e),i=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this.garbageCollectorConfig&&this._garbageCollector.start(),this._logger.debug("Game clock started"),await this.load(i??new Dr),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new O_(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new G_(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.elapsedMs=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,ce.clear();const s=this.clock.now(),r=this.fixedUpdateTimestep;if(this.fixedUpdateTimestep)for(this._lagMs+=e;this._lagMs>=r;)this._update(r),this._lagMs-=r;else this._update(e);const o=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const l=this.clock.now();this.stats.currFrame.duration.update=o-s,this.stats.currFrame.duration.draw=l-o,this.stats.currFrame.graphics.drawnImages=ce.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=ce.DrawCallCount,this.emit("postframe",new $_(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new U_(this)),this.browser.pause(),this.clock.stop(),this._garbageCollector.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(i=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:i})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,s=document.createElement("canvas");s.width=e,s.height=i;const r=s.getContext("2d");r.imageSmoothingEnabled=this.screen.antialiasing,r.drawImage(this.canvas,0,0,e,i);const o=new Image,l=s.toDataURL("image/png");o.onload=()=>{t.resolve(o)},o.src=l}this._screenShotRequests.length=0}async load(t,e=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=e,t instanceof Dr&&(t.suppressPlayButton=t.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(i){this._logger.error("Error loading resources, things may not behave properly",i),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}}Ai.Context=V0();Ai.InstanceCount=0;Ai._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,enableCanvasContextMenu:!1,snapToPixel:!1,antialiasing:!0,pixelArt:!1,garbageCollection:!0,powerPreference:"high-performance",pointerScope:kr.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:Vn.Canvas,backgroundColor:$.fromHex("#2185d0")};class WI extends mi{set maxWidth(t){this._text.maxWidth=t}get maxWidth(){return this._text.maxWidth}get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new Ir,this._text=new vl({text:"",font:this._font});const{text:e,pos:i,x:s,y:r,spriteFont:o,font:l,color:c,maxWidth:d}={text:"",...t};this.pos=i??(s&&r?D(s,r):this.pos),this.text=e??this.text,this.font=l??this.font,this.maxWidth=d??this.maxWidth,this.spriteFont=o??this.spriteFont,this._text.color=c??this.color;const _=this.get(Ae);_.anchor=I.Zero,_.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}var Yn;(function(n){n.Circle="circle",n.Rectangle="rectangle"})(Yn||(Yn={}));class NI extends mi{constructor(t){var e,i;super({width:(e=t.width)!==null&&e!==void 0?e:0,height:(i=t.height)!==null&&i!==void 0?i:0}),this._particlesToEmit=0,this._particlePool=new fl(()=>new xc({}),x=>x,500),this.numParticles=0,this.isEmitting=!0,this.deadParticles=[],this.emitRate=1,this.emitterType=Yn.Rectangle,this.radius=0,this.particle={life:2e3,transform:ks.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this._activeParticles=[];const{particle:s,x:r,y:o,z:l,pos:c,isEmitting:d,emitRate:_,emitterType:f,radius:g,random:m}={...t};this.particle={...this.particle,...s},this.pos=c??D(r??0,o??0),this.z=l??0,this.isEmitting=d??this.isEmitting,this.emitRate=_??this.emitRate,this.emitterType=f??this.emitterType,this.radius=g??this.radius,this.body.collisionType=ft.PreventCollision,this.random=m??new zo}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;if(!(t<=0)){t=t|0;for(let i=0;i<t;i++){const s=this._createParticle();!((e=this===null||this===void 0?void 0:this.scene)===null||e===void 0)&&e.world&&(this.particle.transform===ks.Global?this.scene.world.add(s):this.addChild(s)),this._activeParticles.push(s)}}}clearParticles(){for(let t=0;t<this._activeParticles.length;t++)this.removeParticle(this._activeParticles[t])}_createParticle(){let t=0,e=0;const i=Fs(this.particle.minAngle||0,this.particle.maxAngle||Math.PI*2,this.random),s=Fs(this.particle.minSpeed||0,this.particle.maxSpeed||0,this.random),r=this.particle.startSize||Fs(this.particle.minSize||5,this.particle.maxSize||5,this.random),o=s*Math.cos(i),l=s*Math.sin(i);if(this.emitterType===Yn.Rectangle)t=Fs(0,this.width,this.random),e=Fs(0,this.height,this.random);else if(this.emitterType===Yn.Circle){const d=Fs(0,this.radius,this.random);t=d*Math.cos(i),e=d*Math.sin(i)}const c=this._particlePool.rent();return c.configure({life:this.particle.life,opacity:this.particle.opacity,beginColor:this.particle.beginColor,endColor:this.particle.endColor,pos:D(t,e),vel:D(o,l),acc:this.particle.acc,angularVelocity:this.particle.angularVelocity,startSize:this.particle.startSize,endSize:this.particle.endSize,size:r,graphic:this.particle.graphic,fade:this.particle.fade}),c.registerEmitter(this),this.particle.randomRotation&&(c.transform.rotation=Fs(0,Math.PI*2,this.random)),this.particle.focus&&(c.focus=this.particle.focus.add(D(this.pos.x,this.pos.y)),c.focusAccel=this.particle.focusAccel),c}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let s=0;s<this.deadParticles.length;s++){!((i=this===null||this===void 0?void 0:this.scene)===null||i===void 0)&&i.world&&(this.scene.world.remove(this.deadParticles[s],!1),this._particlePool.return(this.deadParticles[s]));const r=this._activeParticles.indexOf(this.deadParticles[s]);r>-1&&this._activeParticles.splice(r,1)}this.deadParticles.length=0}}function GI(n,t){}class Xh{constructor(t,e,i){var s;this.emitRate=1,this._initialized=!1,this._vaos=[],this._buffers=[],this._drawIndex=0,this._numInputFloats=7,this._particleIndex=0,this._uploadIndex=0,this._wrappedLife=0,this._wrappedParticles=0,this._particleLife=0,this._clearRequested=!1,this._emitted=[],this.emitter=t,this.particle=i,this._particleData=new Float32Array(this.emitter.maxParticles*this._numInputFloats),this._random=e,this._particleLife=(s=this.particle.life)!==null&&s!==void 0?s:2e3}get isInitialized(){return this._initialized}get maxParticles(){return this.emitter.maxParticles}initialize(t,e){if(this._initialized)return;const i=this.emitter.maxParticles,s=this._numInputFloats,r=this._particleData,o=4,l=t.createBuffer(),c=t.createVertexArray();t.bindVertexArray(c),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,i*s*o,t.DYNAMIC_DRAW),t.bufferSubData(t.ARRAY_BUFFER,0,r);let d=0;t.vertexAttribPointer(0,2,t.FLOAT,!1,s*o,0),d+=o*2,t.vertexAttribPointer(1,2,t.FLOAT,!1,s*o,d),d+=o*2,t.vertexAttribPointer(2,1,t.FLOAT,!1,s*o,d),d+=o*1,t.vertexAttribPointer(3,1,t.FLOAT,!1,s*o,d),d+=o*1,t.vertexAttribPointer(4,1,t.FLOAT,!1,s*o,d),d+=o*1,t.enableVertexAttribArray(0),t.enableVertexAttribArray(1),t.enableVertexAttribArray(2),t.enableVertexAttribArray(3),t.enableVertexAttribArray(4),this._vaos.push(c),this._buffers.push(l),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null);const _=t.createBuffer(),f=t.createVertexArray();t.bindVertexArray(f),t.bindBuffer(t.ARRAY_BUFFER,_),t.bufferData(t.ARRAY_BUFFER,i*s*o,t.DYNAMIC_DRAW),d=0,t.vertexAttribPointer(0,2,t.FLOAT,!1,s*o,0),d+=o*2,t.vertexAttribPointer(1,2,t.FLOAT,!1,s*o,d),d+=o*2,t.vertexAttribPointer(2,1,t.FLOAT,!1,s*o,d),d+=o*1,t.vertexAttribPointer(3,1,t.FLOAT,!1,s*o,d),d+=o*1,t.vertexAttribPointer(4,1,t.FLOAT,!1,s*o,d),d+=o*1,t.enableVertexAttribArray(0),t.enableVertexAttribArray(1),t.enableVertexAttribArray(2),t.enableVertexAttribArray(3),t.enableVertexAttribArray(4),this._vaos.push(f),this._buffers.push(_),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._initialized=!0}clearParticles(){this._particleData.fill(0),this._clearRequested=!0}emitParticles(t){const e=this._particleIndex,i=this.maxParticles*this._numInputFloats,s=t*this._numInputFloats+e;for(let r=e;r<s;r+=this._numInputFloats){const o=this._random.floating(this.particle.minAngle||0,this.particle.maxAngle||He),l=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),c=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),d=l*Math.cos(o),_=c*Math.sin(o);let f=0,g=0;if(this.emitter.emitterType===Yn.Rectangle)f=this._random.floating(-.5,.5)*this.emitter.width,g=this._random.floating(-.5,.5)*this.emitter.height;else{const C=this._random.floating(0,this.emitter.radius);f=C*Math.cos(o),g=C*Math.sin(o)}const m=this.emitter.transform.apply(D(f,g)),x=[this.particle.transform===ks.Local?f:m.x,this.particle.transform===ks.Local?g:m.y,d,_,this.particle.randomRotation?Fs(0,He,this._random):this.particle.rotation||0,this.particle.angularVelocity||0,this._particleLife];this._particleData.set(x,r%this._particleData.length)}s>=i?(this._wrappedParticles+=(s-i)/this._numInputFloats,this._wrappedLife=this._particleLife):this._wrappedLife>0&&(this._wrappedParticles+=t),this._particleIndex=s%i,this._emitted.push([this._particleLife,e])}_uploadEmitted(t){this._particleIndex!==this._uploadIndex&&(t.bindBuffer(t.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),this._particleIndex>=this._uploadIndex?t.bufferSubData(t.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleIndex-this._uploadIndex):(t.bufferSubData(t.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleData.length-this._uploadIndex),this._wrappedParticles&&t.bufferSubData(t.ARRAY_BUFFER,0,this._particleData,0,this._wrappedParticles*this._numInputFloats),this._wrappedLife=this._particleLife),t.bindBuffer(t.ARRAY_BUFFER,null)),this._uploadIndex=this._particleIndex%(this.maxParticles*this._numInputFloats)}update(t){var e;if(this._particleLife=(e=this.particle.life)!==null&&e!==void 0?e:this._particleLife,this._wrappedLife>0?this._wrappedLife-=t:(this._wrappedLife=0,this._wrappedParticles=0),!!this._emitted.length){for(let i=this._emitted.length-1;i>=0;i--){const s=this._emitted[i];s[0]-=t,s[0]<=0&&this._emitted.splice(i,1)}this._emitted.sort((i,s)=>i[0]-s[0])}}draw(t){if(this._initialized){if(this._clearRequested?(t.bindBuffer(t.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),t.bufferSubData(t.ARRAY_BUFFER,0,this._particleData),t.bindBuffer(t.ARRAY_BUFFER,null),this._clearRequested=!1):this._uploadEmitted(t),t.bindVertexArray(this._currentVao),t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer),this._wrappedLife&&this._emitted[0]&&this._emitted[0][1]>0){const e=this._emitted[0][1]/this._numInputFloats;t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,this._emitted[0][1]*4,(this.maxParticles-e)*this._numInputFloats*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,e,this.maxParticles-e),t.endTransformFeedback(),t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._emitted[0][1]*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,0,e),t.endTransformFeedback()}else t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._particleData.length*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,0,this.maxParticles),t.endTransformFeedback();t.bindVertexArray(null),t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,0,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._drawIndex=(this._drawIndex+1)%2}}}Xh.GPU_MAX_PARTICLES=1e5;class $I extends mi{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get z(){return this.transform.z}set z(t){this.transform.z=t}constructor(t){super({name:"GpuParticleEmitter",width:t.width,height:t.height}),this.particle={life:2e3,transform:ks.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this.graphics=new Ae,this.isEmitting=!1,this.emitRate=1,this.emitterType=Yn.Rectangle,this.radius=0,this.maxParticles=2e3,this._particlesToEmit=0,this.addComponent(this.graphics,!0),this.graphics.onPostDraw=this.draw.bind(this);const{particle:e,maxParticles:i,x:s,y:r,z:o,pos:l,isEmitting:c,emitRate:d,emitterType:_,radius:f,random:g}={...t};this.maxParticles=Ut(i??this.maxParticles,0,Xh.GPU_MAX_PARTICLES),this.pos=l??D(s??0,r??0),this.z=o??0,this.isEmitting=c??this.isEmitting,this.emitRate=d??this.emitRate,this.emitterType=_??this.emitterType,this.radius=f??this.radius,this.particle={...this.particle,...e},this.random=g??new zo,this.renderer=new Xh(this,this.random,this.particle)}_initialize(t){super._initialize(t);const e=t.graphicsContext;this.renderer.initialize(e.__gl,e)}update(t,e){super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.renderer.update(e)}emitParticles(t){t<=0||this.renderer.emitParticles(t|0)}clearParticles(){this.renderer.clearParticles()}draw(t,e){t.draw("ex.particle",this.renderer,e)}}class Y0 extends oi{getGraphics(){return this._graphics}addGraphic(t,e){this._graphics.push(t),this._gfx.isVisible=this.map.isVisible,this._gfx.opacity=this.map.opacity,e!=null&&e.offset&&(this._gfx.offset=e.offset),this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=D(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.isVisible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(D(this.x,this.y))}get center(){return this.pos.add(D(0,this.map.tileHeight/2))}constructor(t,e,i,s){super([new J,new Ae({offset:i??I.Zero,onPostDraw:(g,m)=>this.draw(g,m)}),new $a(s)]),this.solid=!1,this.events=new de,this._tileBounds=new at,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t,this.y=e,this.map=s,this._transform=this.get(J),this._isometricEntityComponent=this.get($a);const r=this.map.tileWidth/2,o=this.map.tileHeight/2,l=(this.x-this.y)*r,c=(this.x+this.y)*o;this._transform.pos=D(l,c),this._isometricEntityComponent.elevation=s.elevation,this._gfx=this.get(Ae),this._gfx.isVisible=!1;const d=this.map.tileWidth,_=this.map.tileHeight,f=D(0,this.map.renderFromTopOfGraphic?_:0);this._gfx.localBounds=this._tileBounds=new at({left:-d/2,top:-_,right:d/2,bottom:_}).translate(f)}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const s of this._graphics)s.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:s.height-this.map.tileHeight));t.restore()}}class jI extends oi{get visible(){return this.isVisible}set visible(t){this.isVisible=t}constructor(t){super([new J,new Gt({type:ft.Fixed}),new Be,new Qn,new Ac((_,f)=>this.debug(_,f),!1)],t.name),this.elevation=0,this.isVisible=!0,this.opacity=1,this.renderFromTopOfGraphic=!1,this.graphicsOffset=D(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:s,columns:r,rows:o,renderFromTopOfGraphic:l,graphicsOffset:c,elevation:d}=t;this.transform=this.get(J),e&&(this.transform.pos=e),this.collider=this.get(Be),this.collider&&this.collider.set(this._composite=new Ve([])),this.pointer=this.get(Qn),this.renderFromTopOfGraphic=l??this.renderFromTopOfGraphic,this.graphicsOffset=c??this.graphicsOffset,this.elevation=d??this.elevation,this.tileWidth=i,this.tileHeight=s,this.columns=r,this.rows=o,this._pointerEventDispatcher=new gf,this.tiles=new Array(r*o);for(let _=0;_<o;_++)for(let f=0;f<r;f++){const g=new Y0(f,_,this.graphicsOffset,this);this.tiles[f+_*r]=g,this.addChild(g),this._pointerEventDispatcher.addObject(g,m=>this.getTileByPoint(m.worldPos)===g,()=>!0)}this.pointer.localBounds=at.fromDimension(i*r*this.transform.scale.x,s*o*this.transform.scale.y,D(.5,0))}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1),this._pointerEventDispatcher.clear()}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!==null&&e!==void 0?e:I.Zero;{const i=t.offset;return this._originalOffsets.set(t,i),i}}updateColliders(){this._composite.clearColliders();const t=this.get(J).pos;for(const e of this.tiles)if(e.solid)for(const i of e.getColliders()){const s=this._getOrSetColliderOriginalOffset(i);i.offset=this.tileToWorld(D(e.x,e.y)).sub(t).add(s).sub(D(this.tileWidth/2,this.tileHeight)),i.owner=this,this._composite.addCollider(i)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return D(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2,s=(t.x-t.y)*e,r=(t.x+t.y)*i;return D(s,r).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const e of this.tiles){const i=e.get(J).z;i>t&&(t=i)}return t}debug(t,e){const{showAll:i,showPosition:s,positionColor:r,positionSize:o,showGrid:l,gridColor:c,gridWidth:d,showColliderGeometry:_}=e.isometric,{geometryColor:f,geometryLineWidth:g,geometryPointSize:m}=e.collider;if(t.save(),t.z=this._getMaxZIndex()+.5,i||l){for(let x=0;x<this.rows+1;x++){const C=this.tileToWorld(D(0,x)),T=this.tileToWorld(D(this.columns,x));t.drawLine(C,T,c,d)}for(let x=0;x<this.columns+1;x++){const C=this.tileToWorld(D(x,0)),T=this.tileToWorld(D(x,this.rows));t.drawLine(C,T,c,d)}}if(i||s)for(const x of this.tiles)t.drawCircle(this.tileToWorld(D(x.x,x.y)),o,r);if(i||_){for(const x of this.tiles)if(x.solid)for(const C of x.getColliders())C.debug(t,f,{lineWidth:g,pointSize:m})}t.restore()}}class Ef{constructor(t,e){this.id=Jt(),this._stopped=!1,this._sequenceBuilder=e,this._sequenceContext=new Cl(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new Ef(t,this._sequenceBuilder)}}class qI{constructor(t){this.id=Jt(),this._actions=t}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}isComplete(t){return this._actions.every(e=>e.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class ao{constructor(t,e){this.bounds=t,this.options=e,this._defaultOptions={maxDepth:10,capacity:10,level:0},this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null,this.options={...this._defaultOptions,...e},this.halfWidth=t.width/2,this.halfHeight=t.height/2}_split(){this._isDivided=!0;const t={maxDepth:this.options.maxDepth,capacity:this.options.capacity,level:this.options.level+1};this.topLeft=new ao(new at({left:this.bounds.left,top:this.bounds.top,right:this.bounds.left+this.halfWidth,bottom:this.bounds.top+this.halfHeight}),t),this.topRight=new ao(new at({left:this.bounds.left+this.halfWidth,top:this.bounds.top,right:this.bounds.right,bottom:this.bounds.top+this.halfHeight}),t),this.bottomLeft=new ao(new at({left:this.bounds.left,top:this.bounds.top+this.halfHeight,right:this.bounds.left+this.halfWidth,bottom:this.bounds.bottom}),t),this.bottomRight=new ao(new at({left:this.bounds.left+this.halfWidth,top:this.bounds.top+this.halfHeight,right:this.bounds.right,bottom:this.bounds.bottom}),t)}_insertIntoSubNodes(t){var e,i,s,r;!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.insert(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.insert(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.insert(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.insert(t)}insert(t){if(this._isDivided){this._insertIntoSubNodes(t);return}if(this.items.push(t),this.items.length>this.options.capacity&&this.options.level<this.options.maxDepth){this._isDivided||this._split();for(const e of this.items)this._insertIntoSubNodes(e);this.items.length=0}}remove(t){var e,i,s,r;if(this.bounds.overlaps(t.bounds)){if(!this._isDivided){const o=this.items.indexOf(t);o>-1&&this.items.splice(o,1);return}!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.remove(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.remove(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.remove(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.remove(t)}}query(t){let e=this.items;return this._isDivided&&(this.topLeft.bounds.overlaps(t)&&(e=e.concat(this.topLeft.query(t))),this.topRight.bounds.overlaps(t)&&(e=e.concat(this.topRight.query(t))),this.bottomLeft.bounds.overlaps(t)&&(e=e.concat(this.bottomLeft.query(t))),this.bottomRight.bounds.overlaps(t)&&(e=e.concat(this.bottomRight.query(t)))),e=e.filter((i,s)=>e.indexOf(i)>=s),e}clear(){this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}getAllItems(){let t=this.items;return this._isDivided&&(t=t.concat(this.topLeft.getAllItems()),t=t.concat(this.topRight.getAllItems()),t=t.concat(this.bottomLeft.getAllItems()),t=t.concat(this.bottomRight.getAllItems())),t=t.filter((e,i)=>t.indexOf(e)>=i),t}getTreeDepth(){return this._isDivided?1+Math.max(this.topLeft.getTreeDepth(),this.topRight.getTreeDepth(),this.bottomLeft.getTreeDepth(),this.bottomRight.getTreeDepth()):0}debug(t){this.bounds.draw(t,$.Yellow),this._isDivided&&(this.topLeft.bounds.draw(t,$.Yellow),this.topRight.bounds.draw(t,$.Yellow),this.bottomLeft.bounds.draw(t,$.Yellow),this.bottomRight.bounds.draw(t,$.Yellow))}}function VI(n){return!!n._initialize}function XI(n){return!!n.onAdd}function ZI(n){return!!n.onRemove}function YI(n){return!!n.onInitialize}function QI(n){return!!n._preupdate}function KI(n){return!!n.onPreUpdate}function JI(n){return!!n.onPostUpdate}function tR(n){return!!n.onPostUpdate}function eR(n){return!!n.onAdd}function iR(n){return!!n.onRemove}function sR(n){return!!n.onPreDraw}function nR(n){return!!n.onPostDraw}class rR{constructor(t,e=!1){this.path=t,this.width=0,this.height=0,this._images=[],this.data=[],this._sprites=[],this._resource=new pl(t,"arraybuffer",e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){const t=await this._resource.load();this._stream=new Q0(t),this._gif=new K0(this._stream);const e=this._gif.images.map(i=>new Hs(i.src,!1));return await Promise.all(e.map(i=>i.load())),this.data=this._images=e,this._sprites=this._images.map(i=>i.toSprite()),this.data}isLoaded(){return!!this.data}toSprite(t=0){var e;return(e=this._sprites[t])!==null&&e!==void 0?e:null}toSpriteSheet(){const t=this._sprites;return t.length?new Cr({sprites:t}):null}toAnimation(t){var e;const i=(e=this._gif)===null||e===void 0?void 0:e.images;if(i!=null&&i.length){const s=i.map((r,o)=>{var l;return{graphic:this._sprites[o],duration:((l=this._gif)===null||l===void 0?void 0:l.frames[o].delayMs)||void 0}});return this._animation=new vs({frames:s,frameDuration:t}),this._animation}return null}get readCheckBytes(){var t,e;return(e=(t=this._gif)===null||t===void 0?void 0:t.checkBytes)!==null&&e!==void 0?e:[]}}const vh=n=>n.reduce(function(t,e){return t*2+e},0),vu=n=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(n&1<<e));return t};let Q0=class{constructor(t){if(this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=e=>{const i=[];for(let s=0;s<e;s++)i.push(this.readByte());return i},this.read=e=>{let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(this.readByte());return i},this.readUnsigned=()=>{const e=this.readBytes(2);return(e[1]<<8)+e[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}};const oR=function(n,t){let e=0;const i=function(g){let m=0;for(let x=0;x<g;x++)t.charCodeAt(e>>3)&1<<(e&7)&&(m|=1<<x),e++;return m},s=[],r=1<<n,o=r+1;let l=n+1,c=[];const d=function(){c=[],l=n+1;for(let g=0;g<r;g++)c[g]=[g];c[r]=[],c[o]=null};let _=0,f=0;for(;;){if(f=_,_=i(l),_===r){d();continue}if(_===o)break;if(_<c.length)f!==r&&c.push(c[f].concat(c[_][0]));else{if(_!==c.length)throw new Error("Invalid LZW code.");c.push(c[f].concat(c[f][0]))}s.push.apply(s,c[_]),c.length===1<<l&&l<12&&l++}return s};class K0{constructor(t){this._handler={},this.frames=[],this.images=[],this.globalColorTableBytes=[],this.checkBytes=[],this.parseColorTableBytes=e=>{const i=[];for(let s=0;s<e;s++){const r=this._st.readBytes(3);i.push(r)}return i},this.readSubBlocks=()=>{let e,i;i="";do e=this._st.readByte(),i+=this._st.read(e);while(e!==0);return i},this.parseHeader=()=>{const e={sig:"",ver:"",width:0,height:0,colorResolution:0,globalColorTableSize:0,gctFlag:!1,sortedFlag:!1,globalColorTable:[],backgroundColorIndex:0,pixelAspectRatio:0};if(e.sig=this._st.read(3),e.ver=this._st.read(3),e.sig!=="GIF")throw new Error("Not a GIF file.");e.width=this._st.readUnsigned(),e.height=this._st.readUnsigned(),this._currentFrameCanvas.width=e.width,this._currentFrameCanvas.height=e.height;const i=vu(this._st.readByte());e.gctFlag=i.shift(),e.colorResolution=vh(i.splice(0,3)),e.sortedFlag=i.shift(),e.globalColorTableSize=vh(i.splice(0,3)),e.backgroundColorIndex=this._st.readByte(),e.pixelAspectRatio=this._st.readByte(),e.gctFlag&&(this.globalColorTableBytes=this.parseColorTableBytes(1<<e.globalColorTableSize+1)),this._handler.hdr&&this._handler.hdr(e)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=e=>{const i=c=>{this.checkBytes.push(this._st.readByte());const d=vu(this._st.readByte());return c.reserved=d.splice(0,3),c.disposalMethod=vh(d.splice(0,3)),c.userInputFlag=d.shift(),c.transparentColorFlag=d.shift(),c.delayTime=this._st.readUnsigned(),c.transparentColorIndex=this._st.readByte(),c.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(c)&&this.checkBytes.push(this._handler.gce),c},s=c=>{c.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(c)&&this.checkBytes.push(this._handler.com)},r=c=>{this.checkBytes.push(this._st.readByte()),c.ptHeader=this._st.readBytes(12),c.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(c)&&this.checkBytes.push(this._handler.pte)},o=c=>{const d=f=>{this.checkBytes.push(this._st.readByte()),f.unknown=this._st.readByte(),f.iterations=this._st.readUnsigned(),f.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(f)&&this.checkBytes.push(this._handler.app)},_=f=>{f.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[f.identifier]&&this._handler.app[f.identifier](f)&&this.checkBytes.push(this._handler.app[f.identifier])};switch(this.checkBytes.push(this._st.readByte()),c.identifier=this._st.read(8),c.authCode=this._st.read(3),c.identifier){case"NETSCAPE":d(c);break;default:_(c);break}},l=c=>{c.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(c)&&this.checkBytes.push(this._handler.unknown)};switch(e.label=this._st.readByte(),e.label){case 249:e.extType="gce",this._gce=i(e);break;case 254:e.extType="com",s(e);break;case 1:e.extType="pte",r(e);break;case 255:e.extType="app",o(e);break;default:e.extType="unknown",l(e);break}},this.parseImg=e=>{var i;const s=(l,c)=>{const d=new Array(l.length),_=l.length/c,f=(C,T)=>{const A=l.slice(T*c,(T+1)*c);d.splice.apply(d,[C*c,c].concat(A))},g=[0,4,2,1],m=[8,8,4,2];let x=0;for(let C=0;C<4;C++)for(let T=g[C];T<_;T+=m[C])f(T,x),x++;return d};e.leftPos=this._st.readUnsigned(),e.topPos=this._st.readUnsigned(),e.width=this._st.readUnsigned(),e.height=this._st.readUnsigned();const r=vu(this._st.readByte());e.lctFlag=r.shift(),e.interlaced=r.shift(),e.sorted=r.shift(),e.reserved=r.splice(0,2),e.lctSize=vh(r.splice(0,3)),e.lctFlag&&(e.lctBytes=this.parseColorTableBytes(1<<e.lctSize+1)),e.lzwMinCodeSize=this._st.readByte();const o=this.readSubBlocks();e.pixels=oR(e.lzwMinCodeSize,o),e.interlaced&&(e.pixels=s(e.pixels,e.width)),!((i=this._gce)===null||i===void 0)&&i.delayTime&&(e.delayMs=this._gce.delayTime*10),this.frames.push(e),this.arrayToImage(e,e.lctFlag?e.lctBytes:this.globalColorTableBytes),this._handler.img&&this._handler.img(e)&&this.checkBytes.push(this._handler)},this.parseBlocks=()=>{const e={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(e.sentinel)){case"!":e.type="ext",this.parseExt(e);break;case",":e.type="img",this.parseImg(e);break;case";":e.type="eof",this._handler.eof&&this._handler.eof(e)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}e.type!=="eof"&&this.parseBlocks()},this.arrayToImage=(e,i)=>{var s,r,o,l;const c=document.createElement("canvas");c.width=e.width,c.height=e.height;const d=c.getContext("2d"),_=d.getImageData(0,0,c.width,c.height);let f=-1;!((s=this._gce)===null||s===void 0)&&s.transparentColorFlag&&(f=this._gce.transparentColorIndex);for(let m=0;m<e.pixels.length;m++){const x=e.pixels[m],C=i[x];x===f?_.data.set([0,0,0,0],m*4):_.data.set([...C,255],m*4)}if(d.putImageData(_,0,0),((r=this._gce)===null||r===void 0?void 0:r.disposalMethod)===1&&this.images.length)this._currentFrameContext.drawImage(this.images[this.images.length-1],0,0);else if(((o=this._gce)===null||o===void 0?void 0:o.disposalMethod)===2&&(!((l=this._hdr)===null||l===void 0)&&l.gctFlag)){const m=i[this._hdr.backgroundColorIndex];this._currentFrameContext.fillStyle=`rgb(${m[0]}, ${m[1]}, ${m[2]})`,this._currentFrameContext.fillRect(0,0,this._hdr.width,this._hdr.height)}else this._currentFrameContext.clearRect(0,0,this._currentFrameCanvas.width,this._currentFrameCanvas.height);this._currentFrameContext.drawImage(c,e.leftPos,e.topPos,e.width,e.height);const g=new Image;g.src=this._currentFrameCanvas.toDataURL(),this.images.push(g)},this._st=t,this._handler={},this._currentFrameCanvas=document.createElement("canvas"),this._currentFrameContext=this._currentFrameCanvas.getContext("2d"),this.parseHeader(),this.parseBlocks()}}class aR{constructor(t,e,{bustCache:i,...s}={}){this.path=t,this.family=e,this._isLoaded=!1,this._resource=new pl(t,"blob",i),this._options=s}async load(){if(this.isLoaded())return this.data;try{const t=await this._resource.load(),e=URL.createObjectURL(t);this.data||(this.data=new FontFace(this.family,`url(${e})`),document.fonts.add(this.data)),await this.data.load(),this._isLoaded=!0}catch(t){throw`Error loading FontSource from path '${this.path}' with error [${t.message}]`}return this.data}isLoaded(){return this._isLoaded}toFont(t){return new Ir({family:this.family,...this._options,...t})}}const Gm=V0(),lR=/^\s*(?:function)?\*/;function $m(n){return typeof n!="function"?!1:lR.test(Function.prototype.toString.call(n))?!0:Object.getPrototypeOf?Object.getPrototypeOf(n)===Object.getPrototypeOf(new Function("return function * () {}")()):!1}function J0(...n){var t;const e=lt.getInstance();let i,s,r,o;$m(n[0])&&(s=globalThis,i=n[0],r=n[1]),$m(n[1])&&(s=n[0],i=n[1],r=n[2]),n[1]instanceof Ai&&(s=n[0],o=n[1],i=n[2],r=n[3]),n[0]instanceof Ai&&(s=globalThis,o=n[0],i=n[1],r=n[2]);const l=X0(Gm),c=r==null?void 0:r.timing,d=l?!1:(t=r==null?void 0:r.autostart)!==null&&t!==void 0?t:!0;let _;try{_=o??Ai.useEngine()}catch{throw Error(`Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.
Pass an engine parameter to ex.coroutine(engine, function * {...})`)}let f=!1,g=!1,m=!1;const x=i.bind(s),C=x();let T;const A=new Promise((E,M)=>{T=O=>{try{if(m){g=!0,E();return}const{done:N,value:F}=Gm.scope(!0,()=>C.next(O));if(N||m){g=!0,E();return}F instanceof Promise?F.then(()=>{_.clock.schedule(T,0,c)}):F===void 0||F===void 0?_.clock.schedule(T,0,c):_.clock.schedule(T,F||0,c)}catch(N){M(N);return}},d&&(f=!0,T(_.clock.elapsed()))}),S={isRunning:()=>f&&!m&&!g,isComplete:()=>g,cancel:()=>{m=!0},start:()=>(f?e.warn(`.start() was called on a coroutine that was already started, this is probably a bug:
`,Function.prototype.toString.call(x)):(f=!0,T(_.clock.elapsed())),S),generator:C,done:A,then:A.then.bind(A),[Symbol.iterator]:()=>C};return S}class Rc extends oi{get progress(){return this._currentProgress}get complete(){return this.direction==="out"?this.progress>=1:this.progress<=0}constructor(t){var e,i,s,r;super(),this._logger=lt.getInstance(),this.transform=new J,this.graphics=new Ae,this._completeFuture=new Yi,this.started=!1,this._currentDistance=0,this._currentProgress=0,this.done=this._completeFuture.promise,this.name=`Transition#${this.id}`,this.duration=t.duration,this.easing=(e=t.easing)!==null&&e!==void 0?e:ee.Linear,this.direction=(i=t.direction)!==null&&i!==void 0?i:"out",this.hideLoader=(s=t.hideLoader)!==null&&s!==void 0?s:!1,this.blockInput=(r=t.blockInput)!==null&&r!==void 0?r:!1,this.transform.coordPlane=Ke.Screen,this.transform.pos=I.Zero,this.transform.z=1/0,this.graphics.anchor=I.Zero,this.addComponent(this.transform),this.addComponent(this.graphics),this.direction==="out"?this._currentProgress=0:this._currentProgress=1}updateTransition(t,e){this.complete||(this._currentDistance+=Ut(e/this.duration,0,1),this._currentDistance>=1&&(this._currentDistance=1),this.direction==="out"?this._currentProgress=Ut(this.easing(this._currentDistance,0,1,1),0,1):this._currentProgress=Ut(this.easing(this._currentDistance,1,0,1),0,1))}async onPreviousSceneDeactivate(t){}onStart(t){}onUpdate(t){}onEnd(t){}onReset(){}reset(){this.started=!1,this._completeFuture=new Yi,this.done=this._completeFuture.promise,this._currentDistance=0,this.direction==="out"?this._currentProgress=0:this._currentProgress=1,this.onReset()}_addToTargetScene(t,e){const i=e;if(this.started&&this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`),i.world.entityManager.getById(this.id))return this._co;this._engine=t,i.add(this);const s=this;return this._co=J0(t,function*(){for(;!s.complete;){const r=yield;s.updateTransition(s._engine,r),s._execute()}},{autostart:!1}),this._co}async _play(){this.started&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`)),(!this._engine||!this._co)&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`)),this._co&&await this._co.start()}_execute(){this.isInitialized&&(this.started||(this.started=!0,this.onStart(this.progress)),this.onUpdate(this.progress),this.complete&&!this._completeFuture.isCompleted&&(this.onEnd(this.progress),this._completeFuture.resolve()))}}class hR extends Rc{constructor(t){var e,i;super({...t,duration:(e=t.duration)!==null&&e!==void 0?e:2e3}),this.name=`FadeInOut#${this.id}`,this.color=(i=t.color)!==null&&i!==void 0?i:$.Black}onInitialize(t){this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=new xl({width:t.screen.resolution.width,height:t.screen.resolution.height,color:this.color}),this.graphics.add(this.screenCover),this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=t}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class cR extends Rc{constructor(t){super({direction:"in",...t}),this.name=`CrossFade#${this.id}`}async onPreviousSceneDeactivate(t){this.image=await t.engine.screenshot(!0),await this.image.decode()}onInitialize(t){this.engine=t,this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=Hs.fromHtmlImageElement(this.image).toSprite(),this.graphics.add(this.screenCover),this.transform.scale=D(1/t.screen.pixelRatio,1/t.screen.pixelRatio),this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class dR extends Rc{constructor(t){var e;super({direction:"in",...t}),this._easing=ee.Linear,this.name=`Slide#${this.id}`,this.slideDirection=t.slideDirection,this.transform.coordPlane=Ke.World,this.graphics.forceOnScreen=!0,this._easing=(e=t.easingFunction)!==null&&e!==void 0?e:this._easing,this._vectorEasing=ee.CreateVectorEasingFunction(this._easing)}async onPreviousSceneDeactivate(t){this._image=await t.engine.screenshot(!0),await this._image.decode(),this._screenCover=Hs.fromHtmlImageElement(this._image).toSprite()}onInitialize(t){switch(this._engine=t,this.slideDirection){case"up":{this._directionOffset=D(0,-t.screen.resolution.height);break}case"down":{this._directionOffset=D(0,t.screen.resolution.height);break}case"left":{this._directionOffset=D(-t.screen.resolution.width,0);break}case"right":{this._directionOffset=D(t.screen.resolution.width,0);break}}this._camera=this._engine.currentScene.camera,this._destinationCameraPosition=this._camera.pos.clone(),this._camera.pos=this._camera.pos.add(this._directionOffset),this.transform.pos=this.transform.pos.add(this._directionOffset),this._startCameraPosition=this._camera.pos.clone(),this.graphics.use(this._screenCover),this.transform.scale=D(1/t.screen.pixelRatio,1/t.screen.pixelRatio)}onUpdate(t){this._camera.pos=this._vectorEasing(t,this._destinationCameraPosition,this._startCameraPosition,1)}}class Pf extends Ce{constructor(t){super(),this.color=$.Black,this.thickness=1;const{start:e,end:i,color:s,thickness:r}=t;this.start=e,this.end=i,this.color=s??this.color,this.thickness=r??this.thickness,this._localBounds=this._calculateBounds();const{width:o,height:l}=this._localBounds;this.width=o,this.height=l}get localBounds(){return this._localBounds}_calculateBounds(){const t=this.end.sub(this.start).normal(),e=this.thickness/2,i=[this.start.add(t.scale(e)),this.end.add(t.scale(e)),this.end.add(t.scale(-e)),this.start.add(t.scale(-e))];return at.fromPoints(i)}_drawImage(t,e,i){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new Pf({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class kf extends No{get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce((i,s)=>Math.max(s.x,i),0)-e.x,this.height=this._points.reduce((i,s)=>Math.max(s.y,i),0)-e.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((i,s)=>Math.min(s.x,i),1/0),e=this._points.reduce((i,s)=>Math.min(s.y,i),1/0);return D(t,e)}constructor(t){super(t),this._points=[],this.points=t.points,this.filtering=Oe.Blended,this.rasterize()}clone(){return new kf({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach(s=>{t.lineTo(s.x+e.x,s.y+e.y)}),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}var cn;(function(n){n.Stretch="stretch",n.Tile="tile",n.TileFit="tile-fit"})(cn||(cn={}));class If extends Ce{constructor(t){super(t),this._logger=lt.getInstance(),this._config=t,this._imgSource=t.source,this._canvasA=document.createElement("canvas"),this._canvasB=document.createElement("canvas"),this._canvasC=document.createElement("canvas"),this._canvasD=document.createElement("canvas"),this._canvasE=document.createElement("canvas"),this._canvasF=document.createElement("canvas"),this._canvasG=document.createElement("canvas"),this._canvasH=document.createElement("canvas"),this._canvasI=document.createElement("canvas"),this._initialize(),this._imgSource.ready.then(()=>{this._initialize()})}setTargetWidth(t,e=!1){this._config.width=t,e&&this._initialize()}setTargetHeight(t,e=!1){this._config.height=t,e&&this._initialize()}setMargins(t,e,i,s,r=!1){this._config.sourceConfig.leftMargin=t,this._config.sourceConfig.topMargin=e,this._config.sourceConfig.rightMargin=i,this._config.sourceConfig.bottomMargin=s,r&&this._initialize()}setStretch(t,e,i=!1){t==="horizontal"?this._config.destinationConfig.horizontalStretch=e:t==="vertical"?this._config.destinationConfig.verticalStretch=e:(this._config.destinationConfig.horizontalStretch=e,this._config.destinationConfig.verticalStretch=e),i&&this._initialize()}getConfig(){return this._config}_drawTile(t,e,i,s,r,o,l){const c=o||0,d=l||0;let _,f,g,m;const x=this._getNumberOfTiles(e.width,i.x,s),C=this._getNumberOfTiles(e.height,i.y,r);for(let T=0;T<x;T++)for(let A=0;A<C;A++){let{tempSize:S,tempPosition:E}=this._calculateParams(T,x,e.width,i.x,this._config.destinationConfig.horizontalStretch);_=S,f=E,{tempSize:S,tempPosition:E}=this._calculateParams(A,C,e.height,i.y,this._config.destinationConfig.verticalStretch),g=S,m=E,t.drawImage(e,0,0,e.width,e.height,c+f,d+m,_,g)}}_drawImage(t,e,i){this._imgSource.isLoaded()?(this._drawTile(t,this._canvasA,new I(this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch),this._drawTile(t,this._canvasB,new I(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,0),this._drawTile(t,this._canvasC,new I(this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,0),this._drawTile(t,this._canvasD,new I(this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.sourceConfig.topMargin),this._config.destinationConfig.drawCenter&&this._drawTile(t,this._canvasE,new I(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._drawTile(t,this._canvasF,new I(this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._drawTile(t,this._canvasG,new I(this._config.sourceConfig.leftMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(t,this._canvasH,new I(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(t,this._canvasI,new I(this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin)):this._logger.warnOnce(`NineSlice ImageSource ${this._imgSource.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}_initialize(){this._sourceSprite=this._imgSource.image,this._canvasA.width=this._config.sourceConfig.leftMargin,this._canvasA.height=this._config.sourceConfig.topMargin;const t=this._canvasA.getContext("2d");t==null||t.drawImage(this._sourceSprite,0,0,this._canvasA.width,this._canvasA.height,0,0,this._canvasA.width,this._canvasA.height),this._canvasB.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasB.height=this._config.sourceConfig.topMargin;const e=this._canvasB.getContext("2d");e==null||e.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,0,this._canvasB.width,this._canvasB.height,0,0,this._canvasB.width,this._canvasB.height),this._canvasC.width=this._config.sourceConfig.rightMargin,this._canvasC.height=this._config.sourceConfig.topMargin;const i=this._canvasC.getContext("2d");i==null||i.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,0,this._canvasC.width,this._canvasC.height,0,0,this._canvasC.width,this._canvasC.height),this._canvasD.width=this._config.sourceConfig.leftMargin,this._canvasD.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const s=this._canvasD.getContext("2d");s==null||s.drawImage(this._sourceSprite,0,this._config.sourceConfig.topMargin,this._canvasD.width,this._canvasD.height,0,0,this._canvasD.width,this._canvasD.height),this._canvasE.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasE.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const r=this._canvasE.getContext("2d");r==null||r.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin,this._canvasE.width,this._canvasE.height,0,0,this._canvasE.width,this._canvasE.height),this._canvasF.width=this._config.sourceConfig.rightMargin,this._canvasF.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const o=this._canvasF.getContext("2d");o==null||o.drawImage(this._sourceSprite,this._config.sourceConfig.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin,this._canvasF.width,this._canvasF.height,0,0,this._canvasF.width,this._canvasF.height),this._canvasG.width=this._config.sourceConfig.leftMargin,this._canvasG.height=this._config.sourceConfig.bottomMargin;const l=this._canvasG.getContext("2d");l==null||l.drawImage(this._sourceSprite,0,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasG.width,this._canvasG.height,0,0,this._canvasG.width,this._canvasG.height),this._canvasH.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasH.height=this._config.sourceConfig.bottomMargin;const c=this._canvasH.getContext("2d");c==null||c.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasH.width,this._canvasH.height,0,0,this._canvasH.width,this._canvasH.height),this._canvasI.width=this._config.sourceConfig.rightMargin,this._canvasI.height=this._config.sourceConfig.bottomMargin;const d=this._canvasI.getContext("2d");d==null||d.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasI.width,this._canvasI.height,0,0,this._canvasI.width,this._canvasI.height)}clone(){return new If(this._config)}_getNumberOfTiles(t,e,i){switch(i){case cn.Stretch:return 1;case cn.Tile:return Math.ceil(e/t);case cn.TileFit:return Math.ceil(e/t)}}_calculateParams(t,e,i,s,r){switch(r){case cn.Stretch:return{tempPosition:0,tempSize:s};case cn.Tile:return t===e-1?{tempPosition:t*i,tempSize:i-(e*i-s)}:{tempPosition:t*i,tempSize:i};case cn.TileFit:const o=s/e;return{tempPosition:t*o,tempSize:o}}}}class Rf extends vs{constructor(t){super({...t,frames:t.animation.frames.slice(),strategy:t.animation.strategy,frameDuration:t.animation.frameDuration,speed:t.animation.speed,reverse:t.animation.isReversed}),this._ready=new Yi,this.ready=this._ready.promise,this._tiledWidth=0,this._tiledHeight=0,this._sourceView={},this._sourceView={...t.sourceView},this._tiledWidth=t.width,this._tiledHeight=t.height;const e=[];for(let i=0;i<this.frames.length;i++){const s=this.frames[i].graphic;if(s&&s instanceof As){const r=new gl({image:s.image,width:t.width,height:t.height,sourceView:{...s.sourceView},wrapping:t.wrapping,filtering:t.filtering});this.frames[i].graphic=r,r.ready.then(()=>{r.sourceView={...r.sourceView,...this._sourceView}}),e.push(r.ready)}}Promise.all(e).then(()=>this._ready.resolve())}static fromAnimation(t,e){return new Rf({width:t.width,height:t.height,...e,animation:t})}_updateSourceView(){for(let t=0;t<this.frames.length;t++){const e=this.frames[t].graphic;e&&e instanceof As&&(e.sourceView={...e.sourceView,...this._sourceView})}}get sourceView(){return ws(this._sourceView,()=>this._updateSourceView())}set sourceView(t){this._sourceView=ws(t,()=>this._updateSourceView()),this._updateSourceView()}_updateWidthHeight(){for(let t=0;t<this.frames.length;t++){const e=this.frames[t].graphic;e&&e instanceof As&&(e.sourceView.height=this._tiledHeight||e.height,e.destSize.height=this._tiledHeight||e.height,e.sourceView.width=this._tiledWidth||e.width,e.destSize.width=this._tiledWidth||e.width)}}get width(){return this._tiledWidth}get height(){return this._tiledHeight}set width(t){this._tiledWidth=t,this._updateWidthHeight()}set height(t){this._tiledHeight=t,this._updateWidthHeight()}}const tx=5,Po={},uR=()=>{for(const n in Po)Po[n]=0},wh=(n,t)=>{const e=Ye.isEnabled("suppress-obsolete-message");Po[n]<tx&&!e&&(lt.getInstance().warn(n),console.trace&&t.showStackTrace&&console.trace()),Po[n]++};function _R(n){return n={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...n},function(t,e,i){if(i&&!(typeof i.value=="function"||typeof i.get=="function"||typeof i.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const r=`${`${t.name||""}${t.name&&e?".":""}${e||""}`} is marked obsolete: ${n.message}`+(n.alternateMethod?` Use ${n.alternateMethod} instead`:"");Po[r]||(Po[r]=0);const o=i?{...i}:t;if(!i){class l extends o{constructor(...d){wh(r,n),super(...d)}}return l}return i&&i.value?(o.value=function(){return wh(r,n),i.value.apply(this,arguments)},o):(i&&i.get&&(o.get=function(){return wh(r,n),i.get.apply(this,arguments)}),i&&i.set&&(o.set=function(){return wh(r,n),i.set.apply(this,arguments)}),o)}}class fR{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new Yi;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class pR{constructor(t){this._count=t,this._waitQueue=new fR}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const i_="0.30.3";pw();var gR=w.eKr,mR=w.yVm,vR=w.a7j,wR=w.U_w,xR=w.JF2,bR=w.htg,yR=w.HXL,CR=w.mcg,Mc=w.Agj,AR=w.J3_,SR=w.Wgv,TR=w.u6S,ER=w.x7M,zs=w.X55,PR=w.m3M,kR=w.aE5,IR=w.YJU,RR=w.eZi,MR=w.GNv,kh=w.Y56,DR=w._0v,LR=w.vhs,FR=w.vrQ,BR=w.Z8b,OR=w.Yfw,Dc=w.IcQ,UR=w.kgJ,zR=w.GTT,HR=w.ypY,WR=w.i7d,NR=w.fQ3,GR=w.HlI,$R=w.jlt,jR=w.VQc,qR=w.zD7,VR=w.AUF,XR=w.JoF,ZR=w.MlA,YR=w.PZh,QR=w.qA,KR=w.CrD,JR=w.dQK,tM=w.D3r,eM=w.Qpo,iM=w.D9n,sM=w.b6v,nM=w.mvh,Mf=w.Bpo,Lc=w.Q1f,rM=w.IKv,oM=w.fcV,aM=w.Glf,ex=w.uAl,lM=w.ElT,hM=w.Z8r,cM=w.QSL,dM=w.sPV,uM=w.nAn,_M=w.zCU,fM=w.QrV,pM=w.fF9,gM=w.Jqv,mM=w.d_u,vM=w.xI8,wM=w.yar,xM=w.SP7,bM=w.oRy,yM=w.f5X,CM=w.V1c,AM=w.Mlx,SM=w.ZiM,TM=w.ZCo,EM=w.J5p,PM=w.mL_,kM=w.Guw,IM=w.N5j,RM=w.pgY,MM=w.OP3,DM=w.rl5,LM=w.eod,ix=w.q5Z,FM=w.YUC,BM=w.saR,OM=w.hvr,UM=w.Qol,zM=w.Wf4,HM=w.JCs,WM=w.gJV,NM=w.fWD,GM=w.Va_,sx=w.N$8,$M=w._jQ,jM=w.rxj,qM=w.rhv,VM=w.wCu,XM=w.HAp,ZM=w.Zy1,YM=w.bkB,QM=w.wfL,KM=w.sVA,JM=w.$Gs,tD=w.CJ0,eD=w.NWh,iD=w.tWi,sD=w.xAj,nD=w.zWh,rD=w.i_4,oD=w.iIx,aD=w.Hxo,lD=w.c9e,hD=w.KQV,cD=w.weH,dD=w.jXp,uD=w.zzY,_D=w.yRQ,fD=w.MtE,pD=w.rPj,gD=w.KLc,mD=w.Fir,vD=w.V5f,wD=w.Xj7,xD=w.Wud,bD=w.FVg,yD=w.g5Y,CD=w.YQB,AD=w.KPb,SD=w.nHK,TD=w.Jrb,ED=w.TX_,PD=w.Olt,kD=w.r3n,ID=w.Fvk,RD=w.gpR,MD=w.vYh,nx=w.hnk,DD=w.D2R,LD=w.n1o,FD=w.h9O,BD=w.X5j,OD=w.p3P,UD=w.RLG,zD=w.fBU,HD=w.Adb,Df=w.bEs,WD=w.wCy,ND=w.CbD,GD=w.x_C,$D=w.pGf,jD=w.ibQ,qD=w.shR,VD=w.Yjk,XD=w._u1,ZD=w.OBI,YD=w.klh,QD=w.s3S,Ca=w.D$R,KD=w.xth,JD=w.JU7,tL=w.h9x,eL=w.N1A,iL=w.e_k,rx=w.aHM,sL=w.tlv,nL=w.Vi9,rL=w.ieR,oL=w.$bb,aL=w.VyI,lL=w.imn,hL=w.uqu,cL=w.QnL,dL=w.vnc,uL=w.wk_,_L=w.GH0,fL=w._1r,pL=w.l0X,gL=w.bT,mL=w.HHX,vL=w.jtW,wL=w.tjk,xL=w.rWe,bL=w.j9l,yL=w.l0$,CL=w.sGJ,AL=w.NVp,SL=w.cPK,TL=w.XoL,EL=w.RmF,PL=w.DXI,kL=w.tCD,IL=w.J3D,RL=w.vCJ,ML=w.e6k,DL=w.f9l,LL=w.v9m,FL=w.yRJ,BL=w.EU6,OL=w.m3O,UL=w.Ryz,zL=w.OxP,HL=w.LEs,WL=w.Ec,NL=w.Pi5,GL=w.gmH,$L=w.tS,jL=w.XxX,qL=w.bCz,VL=w.nYS,XL=w.yiT,ZL=w.NHl,YL=w.mO8,QL=w.PXI,KL=w.bn5,JL=w.Ywr,tF=w.cMd,eF=w.Bs6,iF=w.G0k,sF=w.pyn,nF=w.QeM,rF=w.aPX,oF=w.ITP,aF=w.BY0,lF=w.MFw,hF=w.sBn,cF=w.S3L,dF=w.XKQ,uF=w.ESI,_F=w.uxz,fF=w.o8N,pF=w.u_r,gF=w.RlV,mF=w.gVA,vF=w.M_G,wF=w.BpG,xF=w.GRB,bF=w.kM6,yF=w.dO8,CF=w.jgM,AF=w.FWq,SF=w.s3j,TF=w.hlw,EF=w.L0q,PF=w.B7e,kF=w.PGN,IF=w.H_X,RF=w.S_d,MF=w._Tq,DF=w.U7E,LF=w.IOH,ox=w.Z58,FF=w.yh2,BF=w.ff$,OF=w.cWi,UF=w.NBt,zF=w.oNz,HF=w.QlU,WF=w.Xey,NF=w.jft,GF=w._r8,$F=w.bTC,jF=w.Mtr,qF=w.ypk,VF=w.mnM,XF=w.q7S,ax=w.bAZ,lx=w.ABN,ZF=w.VK6,YF=w.Hj2,QF=w.Df8,KF=w.oOx,JF=w.kxk,tB=w.DT1,Fc=w.FLG,eB=w.qN_,iB=w.Z37,sB=w.FtL,nB=w.Z6X,hx=w.iQT,rB=w.ziO,oB=w.OEF,cx=w.uuE,aB=w.tiv,lB=w.T$Y,hB=w.EYj,cB=w.nOB,dB=w.Tap,uB=w.FAs,dx=w.B_P,_B=w.aA5,fB=w.J3s,pB=w.Y0Q,gB=w.M4G,mB=w.l$l,vB=w.dLy,ux=w.WZP,wB=w.eB6,xB=w.nFK,bB=w.l9z,yB=w.YOF,CB=w.yhB,AB=w.J0N,_x=w.Miz,SB=w.Bj4,TB=w.Rcs,EB=w.vJ4,PB=w.TqC,kB=w.nM0,IB=w.X1u,RB=w.SpZ,MB=w.DX8,DB=w.Yx$,LB=w.HK4,FB=w.yt5,BB=w.vAR,OB=w.SE$,UB=w.qE8,zB=w.Pz7,HB=w.sX_,WB=w.JuI,NB=w.pxT,GB=w.Nl$,$B=w.zDr,jB=w.OwT,qB=w.P$G,VB=w.mHV,XB=w.kEA,ZB=w.Fx_,YB=w.WFC,QB=w.vKu,KB=w.aDq,JB=w.jIg,tO=w.UH3,eO=w.AJO,iO=w.U4,sO=w.xAc,nO=w._3Y,rO=w.K6X,oO=w.C1Y,aO=w.Aw1,lO=w.tm8,hO=w.LBV,cO=w.A8$,dO=w.F5e,uO=w.ran,_O=w.c8L,fO=w.o6M,pO=w.hsx,gO=w.l9E,mO=w.aSf,vO=w.CcK,wO=w.nU8,xO=w.td6,bO=w.Zex,yO=w.bkJ,CO=w.mXP,AO=w.vt$,SO=w.hCA,TO=w.pjR,EO=w.U43,PO=w.pSZ,lo=w.y17,kO=w.Ew7,IO=w.hG1,RO=w.jVr,MO=w._SZ,DO=w.xWn,LO=w.ehJ,ze=w.t6s,FO=w.Eyn;const BO=Object.freeze(Object.defineProperty({__proto__:null,ActionCompleteEvent:gR,ActionContext:mR,ActionQueue:vR,ActionSequence:wR,ActionStartEvent:xR,ActionsComponent:bR,ActionsSystem:yR,ActivateEvent:CR,Actor:Mc,ActorEvents:AR,AddEvent:SR,AddedComponent:TR,AffineMatrix:ER,Animation:zs,AnimationDirection:PR,AnimationEvents:kR,AnimationStrategy:IR,ArcadeSolver:RR,AudioContextFactory:MR,Axes:kh,Axis:DR,BaseAlign:LR,BezierCurve:FR,Blink:BR,BodyComponent:OR,BoundingBox:Dc,BrowserComponent:UR,BrowserEvents:zR,Buttons:HR,Camera:WR,CameraEvents:NR,Canvas:GR,Circle:$R,CircleCollider:jR,Clock:qR,ClosestLineJumpTable:VR,Collider:XR,ColliderComponent:ZR,CollisionContact:YR,CollisionEndEvent:QR,CollisionGroup:KR,CollisionGroupManager:JR,CollisionJumpTable:tM,CollisionPostSolveEvent:eM,CollisionPreSolveEvent:iM,CollisionStartEvent:sM,CollisionSystem:nM,CollisionType:Mf,Color:Lc,ColorBlindFlags:rM,ColorBlindnessMode:oM,ColorBlindnessPostProcessor:aM,Component:ex,CompositeCollider:lM,ConsoleAppender:hM,ContactConstraintPoint:cM,ContactEndEvent:dM,ContactSolveBias:uM,ContactStartEvent:_M,CoordPlane:fM,CrossFade:pM,CurveBy:gM,CurveTo:mM,DeactivateEvent:vM,Debug:wM,DebugConfig:xM,DebugGraphicsComponent:bM,DebugSystem:yM,DebugText:CM,DefaultAntialiasOptions:AM,DefaultGarbageCollectionOptions:SM,DefaultLoader:TM,DefaultPixelArtOptions:EM,DegreeOfFreedom:PM,Delay:kM,Detector:IM,Die:RM,Direction:MM,Director:DM,DirectorEvents:LM,DisplayMode:ix,DynamicTree:FM,DynamicTreeCollisionProcessor:BM,EX_VERSION:OM,EaseBy:UM,EaseTo:zM,EasingFunctions:HM,EdgeCollider:WM,ElasticToActorStrategy:NM,EmitterType:GM,Engine:sx,EngineEvents:$M,EnterTriggerEvent:jM,EnterViewPortEvent:qM,Entity:VM,EntityEvents:XM,EntityManager:ZM,EventEmitter:YM,EventTypes:QM,Events:KM,ExResponse:JM,ExcaliburGraphicsContext2DCanvas:tD,ExcaliburGraphicsContextWebGL:eD,ExitTriggerEvent:iD,ExitViewPortEvent:sD,Fade:nD,FadeInOut:rD,Flags:oD,Flash:aD,Follow:lD,Font:hD,FontCache:cD,FontSource:dD,FontStyle:uD,FontUnit:_D,FpsSampler:fD,FrameStats:pD,Future:gD,GameEvent:mD,GameStartEvent:vD,GameStopEvent:wD,Gamepad:xD,GamepadAxisEvent:bD,GamepadButtonEvent:yD,GamepadConnectEvent:CD,GamepadDisconnectEvent:AD,Gamepads:SD,GarbageCollector:TD,Gif:ED,GifParser:PD,GlobalCoordinates:kD,GpuParticleEmitter:ID,GpuParticleRenderer:RD,Graphic:MD,GraphicsComponent:nx,GraphicsGroup:DD,GraphicsSystem:LD,HashColliderProxy:FD,HashGridCell:BD,HashGridProxy:OD,HiddenEvent:UD,HorizontalFirst:zD,ImageFiltering:HD,ImageSource:Df,ImageSourceAttributeConstants:WD,ImageWrapping:ND,InitializeEvent:GD,InputHost:$D,InputMapper:jD,IsometricEntityComponent:qD,IsometricEntitySystem:VD,IsometricMap:XD,IsometricTile:ZD,KeyEvent:YD,Keyboard:QD,Keys:Ca,KillEvent:KD,Label:JD,LimitCameraBoundsStrategy:tL,Line:eL,LineSegment:iL,Loader:rx,LoaderEvents:sL,LockCameraToActorAxisStrategy:nL,LockCameraToActorStrategy:rL,LogLevel:oL,Logger:aL,Material:lL,Matrix:hL,MatrixLocations:cL,MediaEvent:dL,Meet:uL,MotionComponent:_L,MotionSystem:fL,MoveBy:pL,MoveByWithOptions:gL,MoveTo:mL,MoveToWithOptions:vL,NativePointerButton:wL,NativeSoundEvent:xL,NativeSoundProcessedEvent:bL,NineSlice:yL,NineSliceStretch:CL,None:AL,Observable:SL,OffscreenSystem:TL,Pair:EL,ParallaxComponent:PL,ParallelActions:kL,Particle:IL,ParticleEmitter:RL,ParticleRenderer:ML,ParticleTransform:DL,PhysicsStats:LL,PhysicsWorld:FL,PointerAbstraction:BL,PointerButton:OL,PointerComponent:UL,PointerEvent:zL,PointerEventReceiver:HL,PointerScope:WL,PointerSystem:NL,PointerType:GL,Polygon:$L,PolygonCollider:jL,Pool:qL,PostCollisionEvent:VL,PostDebugDrawEvent:XL,PostDrawEvent:ZL,PostFrameEvent:YL,PostKillEvent:QL,PostTransformDrawEvent:KL,PostUpdateEvent:JL,PreCollisionEvent:tF,PreDebugDrawEvent:eF,PreDrawEvent:iF,PreFrameEvent:sF,PreKillEvent:nF,PreLoadEvent:rF,PreTransformDrawEvent:oF,PreUpdateEvent:aF,Projection:lF,QuadIndexBuffer:hF,QuadTree:cF,Query:dF,QueryManager:uF,RadiusAroundActorStrategy:_F,Random:fF,Raster:pF,Ray:gF,RealisticSolver:mF,Rectangle:vF,RemoveEvent:wF,RemovedComponent:xF,Repeat:bF,RepeatForever:yF,Resolution:CF,Resource:AF,ResourceEvents:SF,RotateBy:TF,RotateByWithOptions:EF,RotateTo:PF,RotateToWithOptions:kF,RotationType:IF,ScaleBy:RF,ScaleByWithOptions:MF,ScaleTo:DF,ScaleToWithOptions:LF,Scene:ox,SceneEvents:FF,Screen:BF,ScreenAppender:OF,ScreenElement:UF,ScreenEvents:zF,ScreenShader:HF,ScrollPreventionMode:WF,Semaphore:NF,SeparatingAxis:GF,SeparationInfo:$F,Shader:jF,Shape:qF,Side:VF,Slide:XF,SolverStrategy:ax,Sound:lx,SoundEvents:ZF,SparseHashGrid:YF,SparseHashGridCollisionProcessor:QF,SpatialPartitionStrategy:KF,Sprite:JF,SpriteFont:tB,SpriteSheet:Fc,StandardClock:eB,StateMachine:iB,StrategyContainer:sB,Stream:nB,System:hx,SystemManager:rB,SystemPriority:oB,SystemType:cx,TagQuery:aB,TestClock:lB,Text:hB,TextAlign:cB,TextureLoader:dB,Tile:uB,TileMap:dx,TileMapEvents:_B,TiledAnimation:fB,TiledSprite:pB,Timer:gB,Toaster:mB,Transform:vB,TransformComponent:ux,Transition:wB,TreeNode:xB,Trigger:bB,TriggerEvents:yB,TwoPI:CB,Util:AB,Vector:_x,VectorView:SB,VertexBuffer:TB,VertexLayout:EB,VerticalFirst:PB,VisibleEvent:kB,WebAudio:IB,WebAudioInstance:RB,WheelDeltaMode:MB,WheelEvent:DB,World:LB,approximatelyEqual:FB,assert:BB,canonicalizeAngle:OB,clamp:UB,coroutine:zB,createId:HB,frac:WB,getDefaultPhysicsConfig:NB,hasGraphicsTick:GB,hasOnAdd:$B,hasOnInitialize:jB,hasOnPostUpdate:qB,hasOnPreUpdate:VB,hasOnRemove:XB,hasPostDraw:ZB,hasPreDraw:YB,has_add:QB,has_initialize:KB,has_postupdate:JB,has_preupdate:tO,has_remove:eO,inverseLerp:iO,inverseLerpVector:sO,isActor:nO,isAddedComponent:rO,isComponentCtor:oO,isLoaderConstructor:aO,isMoveByOptions:lO,isMoveToOptions:hO,isRemovedComponent:cO,isRotateByOptions:dO,isRotateToOptions:uO,isScaleByOptions:_O,isScaleToOptions:fO,isSceneConstructor:pO,isScreenElement:gO,isSystemConstructor:mO,lerp:vO,lerpAngle:wO,lerpVector:xO,maxMessages:bO,nextActionId:yO,obsolete:CO,parseImageFiltering:AO,parseImageWrapping:SO,pixelSnapEpsilon:TO,randomInRange:EO,randomIntInRange:PO,range:lo,remap:kO,remapVector:IO,resetObsoleteCounter:RO,sign:MO,toDegrees:DO,toRadians:LO,vec:ze,webgl:FO},Symbol.toStringTag,{value:"Module"}));var Pn,re,wu,jm,ko=0,fx=[],xe=Et,qm=xe.__b,Vm=xe.__r,Xm=xe.diffed,Zm=xe.__c,Ym=xe.unmount,Qm=xe.__;function zr(n,t){xe.__h&&xe.__h(re,n,ko||t),ko=0;var e=re.__H||(re.__H={__:[],__h:[]});return n>=e.__.length&&e.__.push({}),e.__[n]}function ni(n){return ko=1,Bc(px,n)}function Bc(n,t,e){var i=zr(Pn++,2);if(i.t=n,!i.__c&&(i.__=[e?e(t):px(void 0,t),function(l){var c=i.__N?i.__N[0]:i.__[0],d=i.t(c,l);c!==d&&(i.__N=[d,i.__[1]],i.__c.setState({}))}],i.__c=re,!re.u)){var s=function(l,c,d){if(!i.__c.__H)return!0;var _=i.__c.__H.__.filter(function(g){return!!g.__c});if(_.every(function(g){return!g.__N}))return!r||r.call(this,l,c,d);var f=i.__c.props!==l;return _.forEach(function(g){if(g.__N){var m=g.__[0];g.__=g.__N,g.__N=void 0,m!==g.__[0]&&(f=!0)}}),r&&r.call(this,l,c,d)||f};re.u=!0;var r=re.shouldComponentUpdate,o=re.componentWillUpdate;re.componentWillUpdate=function(l,c,d){if(this.__e){var _=r;r=void 0,s(l,c,d),r=_}o&&o.call(this,l,c,d)},re.shouldComponentUpdate=s}return i.__N||i.__}function Ti(n,t){var e=zr(Pn++,3);!xe.__s&&Uf(e.__H,t)&&(e.__=n,e.i=t,re.__H.__h.push(e))}function qo(n,t){var e=zr(Pn++,4);!xe.__s&&Uf(e.__H,t)&&(e.__=n,e.i=t,re.__h.push(e))}function Hr(n){return ko=5,Al(function(){return{current:n}},[])}function Lf(n,t,e){ko=6,qo(function(){return typeof n=="function"?(n(t()),function(){return n(null)}):n?(n.current=t(),function(){return n.current=null}):void 0},e==null?e:e.concat(n))}function Al(n,t){var e=zr(Pn++,7);return Uf(e.__H,t)&&(e.__=n(),e.__H=t,e.__h=n),e.__}function Ff(n,t){return ko=8,Al(function(){return n},t)}function _i(n){var t=re.context[n.__c],e=zr(Pn++,9);return e.c=n,t?(e.__==null&&(e.__=!0,t.sub(re)),t.props.value):n.__}function Bf(n,t){xe.useDebugValue&&xe.useDebugValue(t?t(n):n)}function OO(n){var t=zr(Pn++,10),e=ni();return t.__=n,re.componentDidCatch||(re.componentDidCatch=function(i,s){t.__&&t.__(i,s),e[1](i)}),[e[0],function(){e[1](void 0)}]}function Of(){var n=zr(Pn++,11);if(!n.__){for(var t=re.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var e=t.__m||(t.__m=[0,0]);n.__="P"+e[0]+"-"+e[1]++}return n.__}function UO(){for(var n;n=fx.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Ih),n.__H.__h.forEach(s_),n.__H.__h=[]}catch(t){n.__H.__h=[],xe.__e(t,n.__v)}}xe.__b=function(n){re=null,qm&&qm(n)},xe.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),Qm&&Qm(n,t)},xe.__r=function(n){Vm&&Vm(n),Pn=0;var t=(re=n.__c).__H;t&&(wu===re?(t.__h=[],re.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.i=e.__N=void 0})):(t.__h.forEach(Ih),t.__h.forEach(s_),t.__h=[],Pn=0)),wu=re},xe.diffed=function(n){Xm&&Xm(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(fx.push(t)!==1&&jm===xe.requestAnimationFrame||((jm=xe.requestAnimationFrame)||zO)(UO)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.i=void 0})),wu=re=null},xe.__c=function(n,t){t.some(function(e){try{e.__h.forEach(Ih),e.__h=e.__h.filter(function(i){return!i.__||s_(i)})}catch(i){t.some(function(s){s.__h&&(s.__h=[])}),t=[],xe.__e(i,e.__v)}}),Zm&&Zm(n,t)},xe.unmount=function(n){Ym&&Ym(n);var t,e=n.__c;e&&e.__H&&(e.__H.__.forEach(function(i){try{Ih(i)}catch(s){t=s}}),e.__H=void 0,t&&xe.__e(t,e.__v))};var Km=typeof requestAnimationFrame=="function";function zO(n){var t,e=function(){clearTimeout(i),Km&&cancelAnimationFrame(t),setTimeout(n)},i=setTimeout(e,100);Km&&(t=requestAnimationFrame(e))}function Ih(n){var t=re,e=n.__c;typeof e=="function"&&(n.__c=void 0,e()),re=t}function s_(n){var t=re;n.__c=n.__(),re=t}function Uf(n,t){return!n||n.length!==t.length||t.some(function(e,i){return e!==n[i]})}function px(n,t){return typeof t=="function"?t(n):t}var ri=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zf(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),e}var gx={};function n_(n,t){for(var e in n)if(e!=="__source"&&!(e in t))return!0;for(var i in t)if(i!=="__source"&&n[i]!==t[i])return!0;return!1}function Hf(n,t){var e=t(),i=ni({t:{__:e,u:t}}),s=i[0].t,r=i[1];return qo(function(){s.__=e,s.u=t,xu(s)&&r({t:s})},[n,e,t]),Ti(function(){return xu(s)&&r({t:s}),n(function(){xu(s)&&r({t:s})})},[n]),e}function xu(n){var t,e,i=n.u,s=n.__;try{var r=i();return!((t=s)===(e=r)&&(t!==0||1/t==1/e)||t!=t&&e!=e)}catch{return!0}}function Wf(n){n()}function Nf(n){return n}function Gf(){return[!1,Wf]}var $f=qo;function Zh(n,t){this.props=n,this.context=t}function mx(n,t){function e(s){var r=this.props.ref,o=r==s.ref;return!o&&r&&(r.call?r(null):r.current=null),t?!t(this.props,s)||!o:n_(this.props,s)}function i(s){return this.shouldComponentUpdate=e,yt(n,s)}return i.displayName="Memo("+(n.displayName||n.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(Zh.prototype=new Cs).isPureReactComponent=!0,Zh.prototype.shouldComponentUpdate=function(n,t){return n_(this.props,n)||n_(this.state,t)};var Jm=Et.__b;Et.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),Jm&&Jm(n)};var HO=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function vx(n){function t(e){if(!("ref"in e))return n(e,null);var i=e.ref;delete e.ref;var s=n(e,i);return e.ref=i,s}return t.$$typeof=HO,t.render=t,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(n.displayName||n.name)+")",t}var tv=function(n,t){return n==null?null:vn(vn(n).map(t))},wx={map:tv,forEach:tv,count:function(n){return n?vn(n).length:0},only:function(n){var t=vn(n);if(t.length!==1)throw"Children.only";return t[0]},toArray:vn},WO=Et.__e;Et.__e=function(n,t,e,i){if(n.then){for(var s,r=t;r=r.__;)if((s=r.__c)&&s.__c)return t.__e==null&&(t.__e=e.__e,t.__k=e.__k),s.__c(n,t)}WO(n,t,e,i)};var ev=Et.unmount;function xx(n,t,e){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),n.__c.__H=null),(n=function(i,s){for(var r in s)i[r]=s[r];return i}({},n)).__c!=null&&(n.__c.__P===e&&(n.__c.__P=t),n.__c=null),n.__k=n.__k&&n.__k.map(function(i){return xx(i,t,e)})),n}function bx(n,t,e){return n&&e&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(i){return bx(i,t,e)}),n.__c&&n.__c.__P===t&&(n.__e&&e.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=e)),n}function Pa(){this.__u=0,this.o=null,this.__b=null}function yx(n){var t=n.__.__c;return t&&t.__a&&t.__a(n)}function Cx(n){var t,e,i;function s(r){if(t||(t=n()).then(function(o){e=o.default||o},function(o){i=o}),i)throw i;if(!e)throw t;return yt(e,r)}return s.displayName="Lazy",s.__f=!0,s}function ho(){this.i=null,this.l=null}Et.unmount=function(n){var t=n.__c;t&&t.__R&&t.__R(),t&&32&n.__u&&(n.type=null),ev&&ev(n)},(Pa.prototype=new Cs).__c=function(n,t){var e=t.__c,i=this;i.o==null&&(i.o=[]),i.o.push(e);var s=yx(i.__v),r=!1,o=function(){r||(r=!0,e.__R=null,s?s(l):l())};e.__R=o;var l=function(){if(!--i.__u){if(i.state.__a){var c=i.state.__a;i.__v.__k[0]=bx(c,c.__c.__P,c.__c.__O)}var d;for(i.setState({__a:i.__b=null});d=i.o.pop();)d.forceUpdate()}};i.__u++||32&t.__u||i.setState({__a:i.__b=i.__v.__k[0]}),n.then(o,o)},Pa.prototype.componentWillUnmount=function(){this.o=[]},Pa.prototype.render=function(n,t){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=xx(this.__b,e,i.__O=i.__P)}this.__b=null}var s=t.__a&&yt(qe,null,n.fallback);return s&&(s.__u&=-33),[yt(qe,null,t.__a?null:n.children),s]};var iv=function(n,t,e){if(++e[1]===e[0]&&n.l.delete(t),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(e=n.i;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;n.i=e=e[2]}};function NO(n){return this.getChildContext=function(){return n.context},n.children}function GO(n){var t=this,e=n.h;t.componentWillUnmount=function(){Ao(null,t.v),t.v=null,t.h=null},t.h&&t.h!==e&&t.componentWillUnmount(),t.v||(t.h=e,t.v={nodeType:1,parentNode:e,childNodes:[],contains:function(){return!0},appendChild:function(i){this.childNodes.push(i),t.h.appendChild(i)},insertBefore:function(i,s){this.childNodes.push(i),t.h.insertBefore(i,s)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),t.h.removeChild(i)}}),Ao(yt(NO,{context:t.context},n.__v),t.v)}function Ax(n,t){var e=yt(GO,{__v:n,h:t});return e.containerInfo=t,e}(ho.prototype=new Cs).__a=function(n){var t=this,e=yx(t.__v),i=t.l.get(n);return i[0]++,function(s){var r=function(){t.props.revealOrder?(i.push(s),iv(t,n,i)):s()};e?e(r):r()}},ho.prototype.render=function(n){this.i=null,this.l=new Map;var t=vn(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&t.reverse();for(var e=t.length;e--;)this.l.set(t[e],this.i=[1,0,this.i]);return n.children},ho.prototype.componentDidUpdate=ho.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(t,e){iv(n,e,t)})};var Sx=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,$O=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,jO=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,qO=/[A-Z0-9]/g,VO=typeof document<"u",XO=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};function Tx(n,t,e){return t.__k==null&&(t.textContent=""),Ao(n,t),typeof e=="function"&&e(),n?n.__c:null}function Ex(n,t,e){return uw(n,t),typeof e=="function"&&e(),n?n.__c:null}Cs.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Cs.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(t){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:t})}})});var sv=Et.event;function ZO(){}function YO(){return this.cancelBubble}function QO(){return this.defaultPrevented}Et.event=function(n){return sv&&(n=sv(n)),n.persist=ZO,n.isPropagationStopped=YO,n.isDefaultPrevented=QO,n.nativeEvent=n};var jf,KO={enumerable:!1,configurable:!0,get:function(){return this.class}},nv=Et.vnode;Et.vnode=function(n){typeof n.type=="string"&&function(t){var e=t.props,i=t.type,s={},r=i.indexOf("-")===-1;for(var o in e){var l=e[o];if(!(o==="value"&&"defaultValue"in e&&l==null||VO&&o==="children"&&i==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in e&&e.value==null?o="value":o==="download"&&l===!0?l="":c==="translate"&&l==="no"?l=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||i!=="input"&&i!=="textarea"||XO(e.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":jO.test(o)&&(o=c):c=o="oninput":r&&$O.test(o)?o=o.replace(qO,"-$&").toLowerCase():l===null&&(l=void 0),c==="oninput"&&s[o=c]&&(o="oninputCapture"),s[o]=l}}i=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=vn(e.children).forEach(function(d){d.props.selected=s.value.indexOf(d.props.value)!=-1})),i=="select"&&s.defaultValue!=null&&(s.value=vn(e.children).forEach(function(d){d.props.selected=s.multiple?s.defaultValue.indexOf(d.props.value)!=-1:s.defaultValue==d.props.value})),e.class&&!e.className?(s.class=e.class,Object.defineProperty(s,"className",KO)):(e.className&&!e.class||e.class&&e.className)&&(s.class=s.className=e.className),t.props=s}(n),n.$$typeof=Sx,nv&&nv(n)};var rv=Et.__r;Et.__r=function(n){rv&&rv(n),jf=n.__c};var ov=Et.diffed;Et.diffed=function(n){ov&&ov(n);var t=n.props,e=n.__e;e!=null&&n.type==="textarea"&&"value"in t&&t.value!==e.value&&(e.value=t.value==null?"":t.value),jf=null};var Px={ReactCurrentDispatcher:{current:{readContext:function(n){return jf.__n[n.__c].props.value},useCallback:Ff,useContext:_i,useDebugValue:Bf,useDeferredValue:Nf,useEffect:Ti,useId:Of,useImperativeHandle:Lf,useInsertionEffect:$f,useLayoutEffect:qo,useMemo:Al,useReducer:Bc,useRef:Hr,useState:ni,useSyncExternalStore:Hf,useTransition:Gf}}},JO="18.3.1";function kx(n){return yt.bind(null,n)}function Sl(n){return!!n&&n.$$typeof===Sx}function Ix(n){return Sl(n)&&n.type===qe}function Rx(n){return!!n&&!!n.displayName&&(typeof n.displayName=="string"||n.displayName instanceof String)&&n.displayName.startsWith("Memo(")}function Mx(n){return Sl(n)?lk.apply(null,arguments):n}function Dx(n){return!!n.__k&&(Ao(null,n),!0)}function Lx(n){return n&&(n.base||n.nodeType===1&&n)||null}var Fx=function(n,t){return n(t)},Bx=function(n,t){return n(t)},Ox=qe,Ux=Sl,t2={useState:ni,useId:Of,useReducer:Bc,useEffect:Ti,useLayoutEffect:qo,useInsertionEffect:$f,useTransition:Gf,useDeferredValue:Nf,useSyncExternalStore:Hf,startTransition:Wf,useRef:Hr,useImperativeHandle:Lf,useMemo:Al,useCallback:Ff,useContext:_i,useDebugValue:Bf,version:"18.3.1",Children:wx,render:Tx,hydrate:Ex,unmountComponentAtNode:Dx,createPortal:Ax,createElement:yt,createContext:_l,createFactory:kx,cloneElement:Mx,createRef:ow,Fragment:qe,isValidElement:Sl,isElement:Ux,isFragment:Ix,isMemo:Rx,findDOMNode:Lx,Component:Cs,PureComponent:Zh,memo:mx,forwardRef:vx,flushSync:Bx,unstable_batchedUpdates:Fx,StrictMode:Ox,Suspense:Pa,SuspenseList:ho,lazy:Cx,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Px};const e2=Object.freeze(Object.defineProperty({__proto__:null,Children:wx,Component:Cs,Fragment:qe,PureComponent:Zh,StrictMode:Ox,Suspense:Pa,SuspenseList:ho,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Px,cloneElement:Mx,createContext:_l,createElement:yt,createFactory:kx,createPortal:Ax,createRef:ow,default:t2,findDOMNode:Lx,flushSync:Bx,forwardRef:vx,hydrate:Ex,isElement:Ux,isFragment:Ix,isMemo:Rx,isValidElement:Sl,lazy:Cx,memo:mx,render:Tx,startTransition:Wf,unmountComponentAtNode:Dx,unstable_batchedUpdates:Fx,useCallback:Ff,useContext:_i,useDebugValue:Bf,useDeferredValue:Nf,useEffect:Ti,useErrorBoundary:OO,useId:Of,useImperativeHandle:Lf,useInsertionEffect:$f,useLayoutEffect:qo,useMemo:Al,useReducer:Bc,useRef:Hr,useState:ni,useSyncExternalStore:Hf,useTransition:Gf,version:JO},Symbol.toStringTag,{value:"Module"})),zx=zf(e2),i2=zf(gk);var s2=i2;const Hx=document.createElement("div");Hx.innerHTML="<div class=wb-header><div class=wb-control><span class=wb-min></span><span class=wb-max></span><span class=wb-full></span><span class=wb-close></span></div><div class=wb-drag><div class=wb-icon></div><div class=wb-title></div></div></div><div class=wb-body></div><div class=wb-n></div><div class=wb-s></div><div class=wb-w></div><div class=wb-e></div><div class=wb-nw></div><div class=wb-ne></div><div class=wb-se></div><div class=wb-sw></div>";function n2(n){return(n||Hx).cloneNode(!0)}function as(n,t,e,i){n&&n.addEventListener(t,e,i||!1)}function xh(n,t,e,i){n&&n.removeEventListener(t,e,i||!1)}function ka(n,t){n.stopPropagation(),n.cancelable&&n.preventDefault()}function xs(n,t){return n.getElementsByClassName(t)[0]}function Wx(n,t){n.classList.add(t)}function r2(n,t){return n.classList.contains(t)}function Nx(n,t){n.classList.remove(t)}function Bi(n,t,e){e=""+e,n["_s_"+t]!==e&&(n.style.setProperty(t,e),n["_s_"+t]=e)}function o2(n,t){const e=n.firstChild;e?e.nodeValue=t:n.textContent=t}const go=[],ua={capture:!0,passive:!0};let Us,a2=0,Yh=10,Io,Xn,an,Gx,yn,Cn;function ie(n,t){if(!(this instanceof ie))return new ie(n);Us||l2();let e,i,s,r,o,l,c,d,_,f,g,m,x,C,T,A,S,E,M,O,N,F,K,nt,pt,ht,ct,bt,wt,Ct,dt,G,kt,Ht,At,Dt,me,ke,Se,Vt,Ie,Je,zi;if(n&&(t&&(o=n,n=t),typeof n=="string"?o=n:(e=n.id,i=n.index,s=n.root,r=n.template,o=o||n.title,l=n.icon,c=n.mount,d=n.html,_=n.url,f=n.width,g=n.height,m=n.minwidth,x=n.minheight,C=n.maxwidth,T=n.maxheight,A=n.autosize,K=n.min,nt=n.max,pt=n.hidden,ht=n.modal,S=n.x||(ht?"center":0),E=n.y||(ht?"center":0),M=n.top,O=n.left,N=n.bottom,F=n.right,ct=n.background,bt=n.border,wt=n.header,Ct=n.class,G=n.onclose,kt=n.onfocus,Ht=n.onblur,At=n.onmove,Dt=n.onresize,me=n.onfullscreen,ke=n.onmaximize,Se=n.onminimize,Vt=n.onrestore,Ie=n.onhide,Je=n.onshow,zi=n.onload)),this.dom=n2(r),this.dom.id=this.id=e||"winbox-"+ ++a2,this.dom.className="winbox"+(Ct?" "+(typeof Ct=="string"?Ct:Ct.join(" ")):"")+(ht?" modal":""),this.dom.winbox=this,this.window=this.dom,this.body=xs(this.dom,"wb-body"),this.header=wt||35,ct&&this.setBackground(ct),bt?Bi(this.body,"margin",bt+(isNaN(bt)?"":"px")):bt=0,wt){const te=xs(this.dom,"wb-header");Bi(te,"height",wt+"px"),Bi(te,"line-height",wt+"px"),Bi(this.body,"top",wt+"px")}o&&this.setTitle(o),l&&this.setIcon(l),c?this.mount(c):d?this.body.innerHTML=d:_&&this.setUrl(_,zi),M=M?di(M,Cn):0,N=N?di(N,Cn):0,O=O?di(O,yn):0,F=F?di(F,yn):0;const Re=yn-O-F,ue=Cn-M-N;C=C?di(C,Re):Re,T=T?di(T,ue):ue,m=m?di(m,C):150,x=x?di(x,T):this.header,A?((s||Us).appendChild(this.body),f=Math.max(Math.min(this.body.clientWidth+bt*2+1,C),m),g=Math.max(Math.min(this.body.clientHeight+this.header+bt+1,T),x),this.dom.appendChild(this.body)):(f=f?di(f,C):Math.max(C/2,m)|0,g=g?di(g,T):Math.max(T/2,x)|0),S=S?di(S,Re,f):O,E=E?di(E,ue,g):M,this.x=S,this.y=E,this.width=f,this.height=g,this.minwidth=m,this.minheight=x,this.maxwidth=C,this.maxheight=T,this.top=M,this.right=F,this.bottom=N,this.left=O,this.index=i,this.min=!1,this.max=!1,this.full=!1,this.hidden=!1,this.focused=!1,this.onclose=G,this.onfocus=kt,this.onblur=Ht,this.onmove=At,this.onresize=Dt,this.onfullscreen=me,this.onmaximize=ke,this.onminimize=Se,this.onrestore=Vt,this.onhide=Ie,this.onshow=Je,nt?this.maximize():K?this.minimize():this.resize().move(),pt?this.hide():(this.focus(),(i||i===0)&&(this.index=i,Bi(this.dom,"z-index",i),i>Yh&&(Yh=i))),h2(this),(s||Us).appendChild(this.dom),(dt=n.oncreate)&&dt.call(this,n)}ie.new=function(n){return new ie(n)};function di(n,t,e){if(typeof n=="string")if(n==="center")n=(t-e)/2|0;else if(n==="right"||n==="bottom")n=t-e;else{const i=parseFloat(n);(""+i!==n&&n.substring((""+i).length))==="%"?n=t/100*i|0:n=i}return n}function l2(){Us=document.body,Us[an="requestFullscreen"]||Us[an="msRequestFullscreen"]||Us[an="webkitRequestFullscreen"]||Us[an="mozRequestFullscreen"]||(an=""),Gx=an&&an.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),as(window,"resize",function(){av(),qf()}),av()}function h2(n){on(n,"drag"),on(n,"n"),on(n,"s"),on(n,"w"),on(n,"e"),on(n,"nw"),on(n,"ne"),on(n,"se"),on(n,"sw"),as(xs(n.dom,"wb-min"),"click",function(t){ka(t),n.min?n.focus().restore():n.blur().minimize()}),as(xs(n.dom,"wb-max"),"click",function(t){n.max?n.restore():n.maximize()}),an?as(xs(n.dom,"wb-full"),"click",function(t){n.fullscreen()}):n.addClass("no-full"),as(xs(n.dom,"wb-close"),"click",function(t){ka(t),n.close()||(n=null)}),as(n.dom,"click",function(t){n.focus()})}function Oc(n){go.splice(go.indexOf(n),1),qf(),n.removeClass("min"),n.min=!1,n.dom.title=""}function qf(){const n=go.length,t={},e={};for(let i=0,s,r;i<n;i++)s=go[i],r=(s.left||s.right)+":"+(s.top||s.bottom),e[r]?e[r]++:(t[r]=0,e[r]=1);for(let i=0,s,r,o;i<n;i++)s=go[i],r=(s.left||s.right)+":"+(s.top||s.bottom),o=Math.min((yn-s.left-s.right)/e[r],250),s.resize(o+1|0,s.header,!0).move(s.left+t[r]*o|0,Cn-s.bottom-s.header,!0),t[r]++}function on(n,t){const e=xs(n.dom,"wb-"+t);if(!e)return;let i,s,r,o=0;as(e,"mousedown",l),as(e,"touchstart",l,ua);function l(_){if(ka(_),n.focus(),t==="drag"){if(n.min){n.restore();return}const f=Date.now(),g=f-o;if(o=f,g<300){n.max?n.restore():n.maximize();return}}!n.max&&!n.min&&(Wx(Us,"wb-lock"),(i=_.touches)&&(i=i[0])?(_=i,as(window,"touchmove",c,ua),as(window,"touchend",d,ua)):(as(window,"mousemove",c),as(window,"mouseup",d)),s=_.pageX,r=_.pageY)}function c(_){ka(_),i&&(_=_.touches[0]);const f=_.pageX,g=_.pageY,m=f-s,x=g-r,C=n.width,T=n.height,A=n.x,S=n.y;let E,M,O,N;t==="drag"?(n.x+=m,n.y+=x,O=N=1):(t==="e"||t==="se"||t==="ne"?(n.width+=m,E=1):(t==="w"||t==="sw"||t==="nw")&&(n.x+=m,n.width-=m,E=1,O=1),t==="s"||t==="se"||t==="sw"?(n.height+=x,M=1):(t==="n"||t==="ne"||t==="nw")&&(n.y+=x,n.height-=x,M=1,N=1)),E&&(n.width=Math.max(Math.min(n.width,n.maxwidth,yn-n.x-n.right),n.minwidth),E=n.width!==C),M&&(n.height=Math.max(Math.min(n.height,n.maxheight,Cn-n.y-n.bottom),n.minheight),M=n.height!==T),(E||M)&&n.resize(),O&&(n.x=Math.max(Math.min(n.x,yn-n.width-n.right),n.left),O=n.x!==A),N&&(n.y=Math.max(Math.min(n.y,Cn-n.height-n.bottom),n.top),N=n.y!==S),(O||N)&&n.move(),(E||O)&&(s=f),(M||N)&&(r=g)}function d(_){ka(_),Nx(Us,"wb-lock"),i?(xh(window,"touchmove",c,ua),xh(window,"touchend",d,ua)):(xh(window,"mousemove",c),xh(window,"mouseup",d))}}function av(){const n=document.documentElement;yn=n.clientWidth,Cn=n.clientHeight}ie.prototype.mount=function(n){return this.unmount(),n._backstore||(n._backstore=n.parentNode),this.body.textContent="",this.body.appendChild(n),this};ie.prototype.unmount=function(n){const t=this.body.firstChild;if(t){const e=n||t._backstore;e&&e.appendChild(t),t._backstore=n}return this};ie.prototype.setTitle=function(n){const t=xs(this.dom,"wb-title");return o2(t,this.title=n),this};ie.prototype.setIcon=function(n){const t=xs(this.dom,"wb-icon");return Bi(t,"background-image","url("+n+")"),Bi(t,"display","inline-block"),this};ie.prototype.setBackground=function(n){return Bi(this.dom,"background",n),this};ie.prototype.setUrl=function(n,t){const e=this.body.firstChild;return e&&e.tagName.toLowerCase()==="iframe"?e.src=n:(this.body.innerHTML='<iframe src="'+n+'"></iframe>',t&&(this.body.firstChild.onload=t)),this};ie.prototype.focus=function(n){return n===!1?this.blur():(Xn!==this&&this.dom&&(Xn&&Xn.blur(),Bi(this.dom,"z-index",++Yh),this.index=Yh,this.addClass("focus"),Xn=this,this.focused=!0,this.onfocus&&this.onfocus()),this)};ie.prototype.blur=function(n){return n===!1?this.focus():(Xn===this&&(this.removeClass("focus"),this.focused=!1,this.onblur&&this.onblur(),Xn=null),this)};ie.prototype.hide=function(n){if(n===!1)return this.show();if(!this.hidden)return this.onhide&&this.onhide(),this.hidden=!0,this.addClass("hide")};ie.prototype.show=function(n){if(n===!1)return this.hide();if(this.hidden)return this.onshow&&this.onshow(),this.hidden=!1,this.removeClass("hide")};ie.prototype.minimize=function(n){return n===!1?this.restore():(Io&&Uc(),this.max&&(this.removeClass("max"),this.max=!1),this.min||(go.push(this),qf(),this.dom.title=this.title,this.addClass("min"),this.min=!0,this.onminimize&&this.onminimize()),this)};ie.prototype.restore=function(){return Io&&Uc(),this.min&&(Oc(this),this.resize().move(),this.onrestore&&this.onrestore()),this.max&&(this.max=!1,this.removeClass("max").resize().move(),this.onrestore&&this.onrestore()),this};ie.prototype.maximize=function(n){return n===!1?this.restore():(Io&&Uc(),this.min&&Oc(this),this.max||(this.addClass("max").resize(yn-this.left-this.right,Cn-this.top-this.bottom,!0).move(this.left,this.top,!0),this.max=!0,this.onmaximize&&this.onmaximize()),this)};ie.prototype.fullscreen=function(n){if(this.min&&(Oc(this),this.resize().move()),!Io||!Uc())this.body[an](),Io=this,this.full=!0,this.onfullscreen&&this.onfullscreen();else if(n===!1)return this.restore();return this};function c2(){return document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}function Uc(){if(Io.full=!1,c2())return document[Gx](),!0}ie.prototype.close=function(n){if(this.onclose&&this.onclose(n))return!0;this.min&&Oc(this),this.unmount(),this.dom.remove(),this.dom.textContent="",this.dom.winbox=null,this.body=null,this.dom=null,Xn===this&&(Xn=null)};ie.prototype.move=function(n,t,e){return!n&&n!==0?(n=this.x,t=this.y):e||(this.x=n?n=di(n,yn-this.left-this.right,this.width):0,this.y=t?t=di(t,Cn-this.top-this.bottom,this.height):0),Bi(this.dom,"left",n+"px"),Bi(this.dom,"top",t+"px"),this.onmove&&this.onmove(n,t),this};ie.prototype.resize=function(n,t,e){return!n&&n!==0?(n=this.width,t=this.height):e||(this.width=n?n=di(n,this.maxwidth):0,this.height=t?t=di(t,this.maxheight):0,n=Math.max(n,this.minwidth),t=Math.max(t,this.minheight)),Bi(this.dom,"width",n+"px"),Bi(this.dom,"height",t+"px"),this.onresize&&this.onresize(n,t),this};ie.prototype.addControl=function(n){const t=n.class,e=n.image,i=n.click,s=n.index,r=document.createElement("span"),o=xs(this.dom,"wb-control"),l=this;return t&&(r.className=t),e&&Bi(r,"background-image","url("+e+")"),i&&(r.onclick=function(c){i.call(this,c,l)}),o.insertBefore(r,o.childNodes[s||0]),this};ie.prototype.removeControl=function(n){return n=xs(this.dom,n),n&&n.remove(),this};ie.prototype.addClass=function(n){return Wx(this.dom,n),this};ie.prototype.removeClass=function(n){return Nx(this.dom,n),this};ie.prototype.hasClass=function(n){return r2(this.dom,n)};ie.prototype.toggleClass=function(n){return this.hasClass(n)?this.removeClass(n):this.addClass(n)};const d2=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),u2=zf(d2);var _2=ri&&ri.__extends||function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),Qh=ri&&ri.__assign||function(){return Qh=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Qh.apply(this,arguments)},f2=ri&&ri.__createBinding||(Object.create?function(n,t,e,i){i===void 0&&(i=e),Object.defineProperty(n,i,{enumerable:!0,get:function(){return t[e]}})}:function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]}),p2=ri&&ri.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),g2=ri&&ri.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&f2(t,n,e);return p2(t,n),t},$x=ri&&ri.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(gx,"__esModule",{value:!0});var lv=s2,hv=g2(zx),m2=$x(u2),v2=$x(zx),w2=function(n){_2(t,n);function t(e){var i=n.call(this,e)||this;return i.cdmCount=0,i.checkReactVersionGE18=function(){var s=parseInt(hv.default.version.split(".")[0]);return s>=18},i.getId=function(){var s;return(s=i.winBoxObj)===null||s===void 0?void 0:s.id},i.getIndex=function(){var s;return(s=i.winBoxObj)===null||s===void 0?void 0:s.index},i.getPosition=function(){if(i.winBoxObj)return{x:i.winBoxObj.x,y:i.winBoxObj.y}},i.getSize=function(){if(i.winBoxObj)return{width:i.winBoxObj.width,height:i.winBoxObj.height}},i.getSizeLimit=function(){if(i.winBoxObj)return{minWidth:i.winBoxObj.minwidth,minHeight:i.winBoxObj.minheight,maxWidth:i.winBoxObj.maxwidth,maxHeight:i.winBoxObj.maxheight}},i.getViewportBoundary=function(){if(i.winBoxObj)return{top:i.winBoxObj.top,right:i.winBoxObj.right,bottom:i.winBoxObj.bottom,left:i.winBoxObj.left}},i.isFocused=function(){var s,r;return(r=(s=i.winBoxObj)===null||s===void 0?void 0:s.focused)!==null&&r!==void 0?r:!1},i.isHidden=function(){var s,r;return(r=(s=i.winBoxObj)===null||s===void 0?void 0:s.hidden)!==null&&r!==void 0?r:!1},i.isMax=function(){var s,r;return(r=(s=i.winBoxObj)===null||s===void 0?void 0:s.max)!==null&&r!==void 0?r:!1},i.isMin=function(){var s,r;return(r=(s=i.winBoxObj)===null||s===void 0?void 0:s.min)!==null&&r!==void 0?r:!1},i.isFullscreen=function(){var s,r;return(r=(s=i.winBoxObj)===null||s===void 0?void 0:s.full)!==null&&r!==void 0?r:!1},i.isClosed=function(){return i.state.closed},i.focus=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.focus()},i.blur=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.blur()},i.minimize=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.minimize()},i.maximize=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.maximize()},i.fullscreen=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.fullscreen()},i.restore=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.restore()},i.hide=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.hide()},i.show=function(){var s;(s=i.winBoxObj)===null||s===void 0||s.show()},i.maintainStyle=function(){i.winBoxObj&&(i.winBoxObj[i.props.noAnimation?"addClass":"removeClass"]("no-animation"),i.winBoxObj[i.props.noClose?"addClass":"removeClass"]("no-close"),i.winBoxObj[i.props.noFull?"addClass":"removeClass"]("no-full"),i.winBoxObj[i.props.noMin?"addClass":"removeClass"]("no-min"),i.winBoxObj[i.props.noMax?"addClass":"removeClass"]("no-max"),i.winBoxObj[i.props.noMove?"addClass":"removeClass"]("no-move"),i.winBoxObj[i.props.noHeader?"addClass":"removeClass"]("no-header"),i.winBoxObj[i.props.noResize?"addClass":"removeClass"]("no-resize"),i.winBoxObj[i.props.noShadow?"addClass":"removeClass"]("no-shadow"),i.winBoxObj[i.props.modal?"addClass":"removeClass"]("modal"),i.winBoxObj[i.props.hide?"addClass":"removeClass"]("hide"))},i.maintain=function(s){var r,o,l,c,d,_,f,g,m,x,C,T;if(i.winBoxObj){var A=s??{},S=A.force,E=A.prevProps;if((S||(E==null?void 0:E.title)!==i.props.title)&&typeof i.props.title=="string"&&i.winBoxObj.setTitle(i.props.title),(S||(E==null?void 0:E.icon)!==i.props.icon)&&typeof i.props.icon=="string"&&i.winBoxObj.setIcon(i.props.icon),(S||(E==null?void 0:E.url)!==i.props.url)&&i.props.url!=null&&i.winBoxObj.setUrl(i.props.url),(S||(E==null?void 0:E.background)!==i.props.background)&&i.props.background!=null&&i.winBoxObj.setBackground(i.props.background),S||(E==null?void 0:E.minWidth)!==i.props.minWidth||(E==null?void 0:E.minHeight)!==i.props.minHeight||(E==null?void 0:E.maxWidth)!==i.props.maxWidth||(E==null?void 0:E.maxHeight)!==i.props.maxHeight){var M=(r=i.props.minWidth)!==null&&r!==void 0?r:i.winBoxObj.minwidth,O=(o=i.props.minHeight)!==null&&o!==void 0?o:i.winBoxObj.minheight,N=(l=i.props.maxWidth)!==null&&l!==void 0?l:i.winBoxObj.maxwidth,F=(c=i.props.maxHeight)!==null&&c!==void 0?c:i.winBoxObj.maxheight;i.winBoxObj.minwidth=M,i.winBoxObj.minheight=O,i.winBoxObj.maxwidth=N,i.winBoxObj.maxheight=F}if(S||(E==null?void 0:E.width)!==i.props.width||(E==null?void 0:E.height)!==i.props.height){var K=(d=i.props.width)!==null&&d!==void 0?d:i.winBoxObj.width,nt=(_=i.props.height)!==null&&_!==void 0?_:i.winBoxObj.height;i.winBoxObj.resize(K,nt)}if(S||(E==null?void 0:E.x)!==i.props.x||(E==null?void 0:E.y)!==i.props.y){var pt=(f=i.props.x)!==null&&f!==void 0?f:i.winBoxObj.x,ht=(g=i.props.y)!==null&&g!==void 0?g:i.winBoxObj.y;i.winBoxObj.move(pt,ht)}if((S||(E==null?void 0:E.top)!==i.props.top||(E==null?void 0:E.right)!==i.props.right||(E==null?void 0:E.bottom)!==i.props.bottom||(E==null?void 0:E.left)!==i.props.left)&&(i.winBoxObj.top=(m=i.props.top)!==null&&m!==void 0?m:i.winBoxObj.top,i.winBoxObj.right=(x=i.props.right)!==null&&x!==void 0?x:i.winBoxObj.right,i.winBoxObj.bottom=(C=i.props.bottom)!==null&&C!==void 0?C:i.winBoxObj.bottom,i.winBoxObj.left=(T=i.props.left)!==null&&T!==void 0?T:i.winBoxObj.left,i.winBoxObj.move()),(S||(E==null?void 0:E.fullscreen)!==i.props.fullscreen)&&i.props.fullscreen!=null&&i.winBoxObj.fullscreen(i.props.fullscreen),(S||(E==null?void 0:E.min)!==i.props.min)&&i.props.min!=null&&i.winBoxObj.minimize(i.props.min),(S||(E==null?void 0:E.max)!==i.props.max)&&i.props.max!=null&&i.winBoxObj.maximize(i.props.max),S||(E==null?void 0:E.className)!==i.props.className){if((E==null?void 0:E.className)!=null)for(var ct=E.className.replaceAll(/\s+/g," ").split(" ").filter(function(kt){return kt!=""}),bt=0,wt=ct;bt<wt.length;bt++){var Ct=wt[bt];i.winBoxObj.hasClass(Ct)&&i.winBoxObj.removeClass(Ct)}if(i.props.className!=null)for(var ct=i.props.className.replaceAll(/\s+/g," ").split(" ").filter(function(Ht){return Ht!=""}),dt=0,G=ct;dt<G.length;dt++){var Ct=G[dt];i.winBoxObj.hasClass(Ct)||i.winBoxObj.addClass(Ct)}}(S||(E==null?void 0:E.customControls)!==i.props.customControls&&!jx(E==null?void 0:E.customControls,i.props.customControls))&&((E==null?void 0:E.customControls)!=null&&E.customControls.filter(function(kt){return typeof kt=="object"&&kt.class}).forEach(function(kt){return i.winBoxObj.removeControl(kt.class)}),i.props.customControls!=null&&i.props.customControls.filter(function(kt){return typeof kt=="object"&&kt.class}).forEach(function(kt){return i.winBoxObj.addControl(kt)})),i.maintainStyle()}},i.handleClose=function(){i.winBoxObj=void 0,i.setState({closed:!0})},i.state={closed:!1},i.winBoxObj=void 0,i}return t.prototype.componentDidMount=function(){var e=this,i,s,r,o,l,c,d,_,f;if(this.cdmCount++,!(this.checkReactVersionGE18()&&this.cdmCount>=2))try{if(this.props.id!==void 0&&this.props.id!==null&&document.getElementById(this.props.id))throw"duplicated window id";this.winBoxObj=m2.default.new(Qh(Qh({width:300,height:200,top:0,bottom:0,left:0,right:0,hidden:this.props.hide},this.props),{minwidth:(i=this.props.minWidth)!==null&&i!==void 0?i:150,maxwidth:(s=this.props.maxWidth)!==null&&s!==void 0?s:2147483647,minheight:(r=this.props.minHeight)!==null&&r!==void 0?r:35,maxheight:(o=this.props.maxHeight)!==null&&o!==void 0?o:2147483647,max:!1,min:!1,fullscreen:!1,class:""+((l=this.props.className)!==null&&l!==void 0?l:""),onclose:function(g){var m,x,C,T;return!((x=(m=e.props).onClose)===null||x===void 0)&&x.call(m,g??!1)||!((T=(C=e.props).onclose)===null||T===void 0)&&T.call(C,g??!1)?!0:(e.handleClose(),!1)},onmove:(c=this.props.onMove)!==null&&c!==void 0?c:this.props.onmove,onresize:(d=this.props.onResize)!==null&&d!==void 0?d:this.props.onresize,onblur:(_=this.props.onBlur)!==null&&_!==void 0?_:this.props.onblur,onfocus:(f=this.props.onFocus)!==null&&f!==void 0?f:this.props.onfocus,oncreate:this.props.onCreate,onfullscreen:this.props.onFullscreen,onminimize:this.props.onMinimize,onmaximize:this.props.onMaximize,onrestore:this.props.onRestore,onhide:this.props.onHide,onshow:this.props.onShow})),setTimeout(function(){e.forceUpdate()})}catch(g){console.error(g)}},t.prototype.componentDidUpdate=function(e,i){this.maintain({prevProps:e})},t.prototype.componentWillUnmount=function(){var e=this,i,s;try{this.checkReactVersionGE18()?this.cdmCount<=1?setTimeout(function(){var r;e.cdmCount<=1&&((r=e.winBoxObj)===null||r===void 0||r.close(!0))},100):(i=this.winBoxObj)===null||i===void 0||i.close(!0):(s=this.winBoxObj)===null||s===void 0||s.close(!0)}catch{}},t.prototype.forceUpdate=function(e){try{this.maintain({force:!0})}catch(i){console.error(i)}n.prototype.forceUpdate.call(this,e)},t.prototype.render=function(){return Object.keys(this.props).indexOf("url")!==-1&&this.props.url||!this.winBoxObj||!this.winBoxObj.body?null:v2.default.createPortal(lv.jsx(lv.Fragment,{children:this.props.children},void 0),this.winBoxObj.body)},t}(hv.Component),x2=gx.default=w2;function jx(n,t){var e=Object.keys,i=typeof n,s=typeof t;return n&&t&&i==="object"&&i===s?e(n).length===e(t).length&&e(n).every(function(r){return jx(n[r],t[r])}):n===t}var b2="2.0.0",Ro="",cv="?",Kh="function",Zn="undefined",Mo="object",r_="string",Xa="major",Y="model",V="name",q="type",Q="vendor",Z="version",Li="architecture",co="console",Rt="mobile",pe="tablet",ci="smarttv",Aa="wearable",bu="xr",o_="embedded",_a="inapp",dv="user-agent",a_=500,Vf="brands",br="formFactors",Xf="fullVersionList",mo="platform",Zf="platformVersion",zc="bitness",rr="sec-ch-ua",y2=rr+"-full-version-list",C2=rr+"-arch",A2=rr+"-"+zc,S2=rr+"-form-factors",T2=rr+"-"+Rt,E2=rr+"-"+Y,qx=rr+"-"+mo,P2=qx+"-version",Vx=[Vf,Xf,Rt,Y,mo,Zf,Li,br,zc],Xi="browser",_n="cpu",Os="device",pn="engine",ls="os",vo="result",bh="Amazon",fa="Apple",uv="ASUS",_v="BlackBerry",mr="Google",fv="Huawei",pv="Lenovo",k2="Honor",yu="LG",Rh="Microsoft",gv="Motorola",pa="Samsung",mv="Sharp",yh="Sony",Cu="Xiaomi",Au="Zebra",no="Mobile ",ga=" Browser",vv="Chrome",Wn="Chromecast",I2="Edge",ma="Firefox",va="Opera",wv="Facebook",xv="Sogou",l_="Windows",R2=typeof window!==Zn,Fi=R2&&window.navigator?window.navigator:void 0,jn=Fi&&Fi.userAgentData?Fi.userAgentData:void 0,M2=function(n,t){var e={},i=t;if(!Jh(t)){i={};for(var s in t)for(var r in t[s])i[r]=t[s][r].concat(i[r]?i[r]:[])}for(var o in n)e[o]=i[o]&&i[o].length%2===0?i[o].concat(n[o]):n[o];return e},Hc=function(n){for(var t={},e=0;e<n.length;e++)t[n[e].toUpperCase()]=n[e];return t},h_=function(n,t){if(typeof n===Mo&&n.length>0){for(var e in n)if(gn(n[e])==gn(t))return!0;return!1}return Vo(n)?gn(t).indexOf(gn(n))!==-1:!1},Jh=function(n,t){for(var e in n)return/^(browser|cpu|device|engine|os)$/.test(e)||(t?Jh(n[e]):!1)},Vo=function(n){return typeof n===r_},Su=function(n){if(n){for(var t=[],e=Lr(/\\?\"/g,n).split(","),i=0;i<e.length;i++)if(e[i].indexOf(";")>-1){var s=Za(e[i]).split(";v=");t[i]={brand:s[0],version:s[1]}}else t[i]=Za(e[i]);return t}},gn=function(n){return Vo(n)?n.toLowerCase():n},Tu=function(n){return Vo(n)?Lr(/[^\d\.]/g,n).split(".")[0]:void 0},mn=function(n){for(var t in n){var e=n[t];typeof e==Mo&&e.length==2?this[e[0]]=e[1]:this[e]=void 0}return this},Lr=function(n,t){return Vo(t)?t.replace(n,Ro):t},wa=function(n){return Lr(/\\?\"/g,n)},Za=function(n,t){if(Vo(n))return n=Lr(/^\s\s*/,n),typeof t===Zn?n:n.substring(0,a_)},bv=function(n,t){if(!(!n||!t))for(var e=0,i,s,r,o,l,c;e<t.length&&!l;){var d=t[e],_=t[e+1];for(i=s=0;i<d.length&&!l&&d[i];)if(l=d[i++].exec(n),l)for(r=0;r<_.length;r++)c=l[++s],o=_[r],typeof o===Mo&&o.length>0?o.length===2?typeof o[1]==Kh?this[o[0]]=o[1].call(this,c):this[o[0]]=o[1]:o.length===3?typeof o[1]===Kh&&!(o[1].exec&&o[1].test)?this[o[0]]=c?o[1].call(this,c,o[2]):void 0:this[o[0]]=c?c.replace(o[1],o[2]):void 0:o.length===4&&(this[o[0]]=c?o[3].call(this,c.replace(o[1],o[2])):void 0):this[o]=c||void 0;e+=2}},Ia=function(n,t){for(var e in t)if(typeof t[e]===Mo&&t[e].length>0){for(var i=0;i<t[e].length;i++)if(h_(t[e][i],n))return e===cv?void 0:e}else if(h_(t[e],n))return e===cv?void 0:e;return t.hasOwnProperty("*")?t["*"]:n},yv={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Cv={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},Av={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Z,[V,no+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Z,[V,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[V,Z],[/opios[\/ ]+([\w\.]+)/i],[Z,[V,va+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[Z,[V,va+" GX"]],[/\bopr\/([\w\.]+)/i],[Z,[V,va]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[Z,[V,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[Z,[V,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[V,Z],[/quark(?:pc)?\/([-\w\.]+)/i],[Z,[V,"Quark"]],[/\bddg\/([\w\.]+)/i],[Z,[V,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Z,[V,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[Z,[V,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Z,[V,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Z,[V,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[Z,[V,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[Z,[V,"Smart "+pv+ga]],[/(avast|avg)\/([\w\.]+)/i],[[V,/(.+)/,"$1 Secure"+ga],Z],[/\bfocus\/([\w\.]+)/i],[Z,[V,ma+" Focus"]],[/\bopt\/([\w\.]+)/i],[Z,[V,va+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Z,[V,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Z,[V,"Dolphin"]],[/coast\/([\w\.]+)/i],[Z,[V,va+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[Z,[V,"MIUI"+ga]],[/fxios\/([\w\.-]+)/i],[Z,[V,no+ma]],[/\bqihoobrowser\/?([\w\.]*)/i],[Z,[V,"360"]],[/\b(qq)\/([\w\.]+)/i],[[V,/(.+)/,"$1Browser"],Z],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[V,/(.+)/,"$1"+ga],Z],[/samsungbrowser\/([\w\.]+)/i],[Z,[V,pa+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[Z,[V,xv+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[V,xv+" Mobile"],Z],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[V,Z],[/(lbbrowser|rekonq)/i],[V],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[Z,V],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[V,wv],Z,[q,_a]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[V,Z,[q,_a]],[/\bgsa\/([\w\.]+) .*safari\//i],[Z,[V,"GSA"],[q,_a]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[Z,[V,"TikTok"],[q,_a]],[/\[(linkedin)app\]/i],[V,[q,_a]],[/(chromium)[\/ ]([-\w\.]+)/i],[V,Z],[/headlesschrome(?:\/([\w\.]+)| )/i],[Z,[V,vv+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[V,vv+" WebView"],Z],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Z,[V,"Android"+ga]],[/chrome\/([\w\.]+) mobile/i],[Z,[V,no+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[V,Z],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[Z,[V,no+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[V,no+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[Z,V],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[V,[Z,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[V,Z],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[V,no+ma],Z],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[V,"Netscape"],Z],[/(wolvic|librewolf)\/([\w\.]+)/i],[V,Z],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Z,[V,ma+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[V,[Z,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[V,[Z,/[^\d\.]+./,Ro]]],cpu:[[/\b(?:(amd|x|x86[-_]?|wow|win)64)\b/i],[[Li,"amd64"]],[/(ia32(?=;))/i,/((?:i[346]|x)86)[;\)]/i],[[Li,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Li,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Li,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Li,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Li,/ower/,Ro,gn]],[/(sun4\w)[;\)]/i],[[Li,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Li,gn]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[Y,[Q,pa],[q,pe]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[Y,[Q,pa],[q,Rt]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[Y,[Q,fa],[q,Rt]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[Y,[Q,fa],[q,pe]],[/(macintosh);/i],[Y,[Q,fa]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[Y,[Q,mv],[q,Rt]],[/(?:honor)([-\w ]+)[;\)]/i],[Y,[Q,k2],[q,Rt]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[Y,[Q,fv],[q,pe]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[Y,[Q,fv],[q,Rt]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[Y,/_/g," "],[Q,Cu],[q,Rt]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[Y,/_/g," "],[Q,Cu],[q,pe]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[Y,[Q,"OPPO"],[q,Rt]],[/\b(opd2\d{3}a?) bui/i],[Y,[Q,"OPPO"],[q,pe]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[Y,[Q,"Vivo"],[q,Rt]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[Y,[Q,"Realme"],[q,Rt]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[Y,[Q,gv],[q,Rt]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[Y,[Q,gv],[q,pe]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[Y,[Q,yu],[q,pe]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[Y,[Q,yu],[q,Rt]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[Y,[Q,pv],[q,pe]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[Y,/_/g," "],[Q,"Nokia"],[q,Rt]],[/(pixel c)\b/i],[Y,[Q,mr],[q,pe]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[Y,[Q,mr],[q,Rt]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[Y,[Q,yh],[q,Rt]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[Y,"Xperia Tablet"],[Q,yh],[q,pe]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[Y,[Q,"OnePlus"],[q,Rt]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[Y,[Q,bh],[q,pe]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[Y,/(.+)/g,"Fire Phone $1"],[Q,bh],[q,Rt]],[/(playbook);[-\w\),; ]+(rim)/i],[Y,Q,[q,pe]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[Y,[Q,_v],[q,Rt]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[Y,[Q,uv],[q,pe]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[Y,[Q,uv],[q,Rt]],[/(nexus 9)/i],[Y,[Q,"HTC"],[q,pe]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Q,[Y,/_/g," "],[q,Rt]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[Y,[Q,"TCL"],[q,pe]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[Y,[Q,"TCL"],[q,Rt]],[/(itel) ((\w+))/i],[[Q,gn],Y,[q,Ia,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[Y,[Q,"Acer"],[q,pe]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[Y,[Q,"Meizu"],[q,Rt]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[Y,[Q,"Ulefone"],[q,Rt]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[Y,[Q,"Energizer"],[q,Rt]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[Y,[Q,"Cat"],[q,Rt]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[Y,[Q,"Smartfren"],[q,Rt]],[/droid.+; (a(?:015|06[35]|142p?))/i],[Y,[Q,"Nothing"],[q,Rt]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Q,Y,[q,Rt]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[Q,Y,[q,pe]],[/(surface duo)/i],[Y,[Q,Rh],[q,pe]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[Y,[Q,"Fairphone"],[q,Rt]],[/(shield[\w ]+) b/i],[Y,[Q,"Nvidia"],[q,pe]],[/(sprint) (\w+)/i],[Q,Y,[q,Rt]],[/(kin\.[onetw]{3})/i],[[Y,/\./g," "],[Q,Rh],[q,Rt]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[Y,[Q,Au],[q,pe]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[Y,[Q,Au],[q,Rt]],[/smart-tv.+(samsung)/i],[Q,[q,ci]],[/hbbtv.+maple;(\d+)/i],[[Y,/^/,"SmartTV"],[Q,pa],[q,ci]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Q,yu],[q,ci]],[/(apple) ?tv/i],[Q,[Y,fa+" TV"],[q,ci]],[/crkey.*devicetype\/chromecast/i],[[Y,Wn+" Third Generation"],[Q,mr],[q,ci]],[/crkey.*devicetype\/([^/]*)/i],[[Y,/^/,"Chromecast "],[Q,mr],[q,ci]],[/fuchsia.*crkey/i],[[Y,Wn+" Nest Hub"],[Q,mr],[q,ci]],[/crkey/i],[[Y,Wn],[Q,mr],[q,ci]],[/droid.+aft(\w+)( bui|\))/i],[Y,[Q,bh],[q,ci]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[Y,[Q,mv],[q,ci]],[/(bravia[\w ]+)( bui|\))/i],[Y,[Q,yh],[q,ci]],[/(mitv-\w{5}) bui/i],[Y,[Q,Cu],[q,ci]],[/Hbbtv.*(technisat) (.*);/i],[Q,Y,[q,ci]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Q,Za],[Y,Za],[q,ci]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[q,ci]],[/(ouya)/i,/(nintendo) (\w+)/i],[Q,Y,[q,co]],[/droid.+; (shield) bui/i],[Y,[Q,"Nvidia"],[q,co]],[/(playstation \w+)/i],[Y,[Q,yh],[q,co]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[Y,[Q,Rh],[q,co]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[Y,[Q,pa],[q,Aa]],[/((pebble))app/i],[Q,Y,[q,Aa]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[Y,[Q,fa],[q,Aa]],[/droid.+; (wt63?0{2,3})\)/i],[Y,[Q,Au],[q,Aa]],[/droid.+; (glass) \d/i],[Y,[Q,mr],[q,bu]],[/(pico) (4|neo3(?: link|pro)?)/i],[Q,Y,[q,bu]],[/; (quest( \d| pro)?)/i],[Y,[Q,wv],[q,bu]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[Q,[q,o_]],[/(aeobc)\b/i],[Y,[Q,bh],[q,o_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[Y,[q,Rt]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[Y,[q,pe]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[q,pe]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[q,Rt]],[/(android[-\w\. ]{0,9});.+buil/i],[Y,[Q,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Z,[V,I2+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[V,Z],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Z,[V,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[V,Z],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Z,V]],os:[[/microsoft (windows) (vista|xp)/i],[V,Z],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[V,[Z,Ia,yv]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[Z,Ia,yv],[V,l_]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[Z,/_/g,"."],[V,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[V,"macOS"],[Z,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[Z,[V,Wn+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[Z,[V,Wn+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[Z,[V,Wn+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[Z,[V,Wn+" Linux"]],[/crkey\/([\d\.]+)/i],[Z,[V,Wn]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Z,V],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[V,Z],[/\(bb(10);/i],[Z,[V,_v]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[Z,[V,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Z,[V,ma+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Z,[V,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Z,[V,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[V,"Chrome OS"],Z],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[V,Z],[/(sunos) ?([\w\.\d]*)/i],[[V,"Solaris"],Z],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[V,Z]]},Ch=function(){var n={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return mn.call(n.init,[[Xi,[V,Z,Xa,q]],[_n,[Li]],[Os,[q,Y,Q]],[pn,[V,Z]],[ls,[V,Z]]]),mn.call(n.isIgnore,[[Xi,[Z,Xa]],[pn,[Z]],[ls,[Z]]]),mn.call(n.isIgnoreRgx,[[Xi,/ ?browser$/i],[ls,/ ?os$/i]]),mn.call(n.toString,[[Xi,[V,Z]],[_n,[Li]],[Os,[Q,Y]],[pn,[V,Z]],[ls,[V,Z]]]),n}(),D2=function(n,t){var e=Ch.init[t],i=Ch.isIgnore[t]||0,s=Ch.isIgnoreRgx[t]||0,r=Ch.toString[t]||0;function o(){mn.call(this,e)}return o.prototype.getItem=function(){return n},o.prototype.withClientHints=function(){return jn?jn.getHighEntropyValues(Vx).then(function(l){return n.setCH(new Xx(l,!1)).parseCH().get()}):n.parseCH().get()},o.prototype.withFeatureCheck=function(){return n.detectFeature().get()},t!=vo&&(o.prototype.is=function(l){var c=!1;for(var d in this)if(this.hasOwnProperty(d)&&!h_(i,d)&&gn(s?Lr(s,this[d]):this[d])==gn(s?Lr(s,l):l)){if(c=!0,l!=Zn)break}else if(l==Zn&&c){c=!c;break}return c},o.prototype.toString=function(){var l=Ro;for(var c in r)typeof this[r[c]]!==Zn&&(l+=(l?" ":Ro)+this[r[c]]);return l||Zn}),jn||(o.prototype.then=function(l){var c=this,d=function(){for(var f in c)c.hasOwnProperty(f)&&(this[f]=c[f])};d.prototype={is:o.prototype.is,toString:o.prototype.toString};var _=new d;return l(_),_}),new o};function Xx(n,t){if(n=n||{},mn.call(this,Vx),t)mn.call(this,[[Vf,Su(n[rr])],[Xf,Su(n[y2])],[Rt,/\?1/.test(n[T2])],[Y,wa(n[E2])],[mo,wa(n[qx])],[Zf,wa(n[P2])],[Li,wa(n[C2])],[br,Su(n[S2])],[zc,wa(n[A2])]]);else for(var e in n)this.hasOwnProperty(e)&&typeof n[e]!==Zn&&(this[e]=n[e])}function Sv(n,t,e,i){return this.get=function(s){return s?this.data.hasOwnProperty(s)?this.data[s]:void 0:this.data},this.set=function(s,r){return this.data[s]=r,this},this.setCH=function(s){return this.uaCH=s,this},this.detectFeature=function(){if(Fi&&Fi.userAgent==this.ua)switch(this.itemType){case Xi:Fi.brave&&typeof Fi.brave.isBrave==Kh&&this.set(V,"Brave");break;case Os:!this.get(q)&&jn&&jn[Rt]&&this.set(q,Rt),this.get(Y)=="Macintosh"&&Fi&&typeof Fi.standalone!==Zn&&Fi.maxTouchPoints&&Fi.maxTouchPoints>2&&this.set(Y,"iPad").set(q,pe);break;case ls:!this.get(V)&&jn&&jn[mo]&&this.set(V,jn[mo]);break;case vo:var s=this.data,r=function(o){return s[o].getItem().detectFeature().get()};this.set(Xi,r(Xi)).set(_n,r(_n)).set(Os,r(Os)).set(pn,r(pn)).set(ls,r(ls))}return this},this.parseUA=function(){return this.itemType!=vo&&bv.call(this.data,this.ua,this.rgxMap),this.itemType==Xi&&this.set(Xa,Tu(this.get(Z))),this},this.parseCH=function(){var s=this.uaCH,r=this.rgxMap;switch(this.itemType){case Xi:var o=s[Xf]||s[Vf],l;if(o)for(var c in o){var d=Lr(/(Google|Microsoft) /,o[c].brand||o[c]),_=o[c].version;!/not.a.brand/i.test(d)&&(!l||/chrom/i.test(l)&&!/chromi/i.test(d))&&(this.set(V,d).set(Z,_).set(Xa,Tu(_)),l=d)}break;case _n:var f=s[Li];f&&(f&&s[zc]=="64"&&(f+="64"),bv.call(this.data,f+";",r));break;case Os:if(s[Rt]&&this.set(q,Rt),s[Y]&&this.set(Y,s[Y]),s[Y]=="Xbox"&&this.set(q,co).set(Q,Rh),s[br]){var g;if(typeof s[br]!="string")for(var m=0;!g&&m<s[br].length;)g=Ia(s[br][m++],Cv);else g=Ia(s[br],Cv);this.set(q,g)}break;case ls:var x=s[mo];if(x){var C=s[Zf];x==l_&&(C=parseInt(Tu(C),10)>=13?"11":"10"),this.set(V,x).set(Z,C)}this.get(V)==l_&&s[Y]=="Xbox"&&this.set(V,"Xbox").set(Z,void 0);break;case vo:var T=this.data,A=function(S){return T[S].getItem().setCH(s).parseCH().get()};this.set(Xi,A(Xi)).set(_n,A(_n)).set(Os,A(Os)).set(pn,A(pn)).set(ls,A(ls))}return this},mn.call(this,[["itemType",n],["ua",t],["uaCH",i],["rgxMap",e],["data",D2(this,n)]]),this}function kn(n,t,e){if(typeof n===Mo?(Jh(n,!0)?(typeof t===Mo&&(e=t),t=n):(e=n,t=void 0),n=void 0):typeof n===r_&&!Jh(t,!0)&&(e=t,t=void 0),e&&typeof e.append===Kh){var i={};e.forEach(function(c,d){i[d]=c}),e=i}if(!(this instanceof kn))return new kn(n,t,e).getResult();var s=typeof n===r_?n:e&&e[dv]?e[dv]:Fi&&Fi.userAgent?Fi.userAgent:Ro,r=new Xx(e,!0),o=t?M2(Av,t):Av,l=function(c){return c==vo?function(){return new Sv(c,s,o,r).set("ua",s).set(Xi,this.getBrowser()).set(_n,this.getCPU()).set(Os,this.getDevice()).set(pn,this.getEngine()).set(ls,this.getOS()).get()}:function(){return new Sv(c,s,o[c],r).parseUA().get()}};return mn.call(this,[["getBrowser",l(Xi)],["getCPU",l(_n)],["getDevice",l(Os)],["getEngine",l(pn)],["getOS",l(ls)],["getResult",l(vo)],["getUA",function(){return s}],["setUA",function(c){return Vo(c)&&(s=c.length>a_?Za(c,a_):c),this}]]).setUA(s),this}kn.VERSION=b2;kn.BROWSER=Hc([V,Z,Xa,q]);kn.CPU=Hc([Li]);kn.DEVICE=Hc([Y,Q,q,co,Rt,ci,pe,Aa,o_]);kn.ENGINE=kn.OS=Hc([V,Z]);var Ya=function(){return Ya=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++)for(var s in t=arguments[e])Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s]);return n},Ya.apply(this,arguments)};function L2(n,t,e,i){return new(e||(e=Promise))(function(s,r){function o(d){try{c(i.next(d))}catch(_){r(_)}}function l(d){try{c(i.throw(d))}catch(_){r(_)}}function c(d){var _;d.done?s(d.value):(_=d.value,_ instanceof e?_:new e(function(f){f(_)})).then(o,l)}c((i=i.apply(n,[])).next())})}function F2(n,t){var e,i,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=l(0),o.throw=l(1),o.return=l(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(c){return function(d){return function(_){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,_[0]&&(r=0)),r;)try{if(e=1,i&&(s=2&_[0]?i.return:_[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,_[1])).done)return s;switch(i=0,s&&(_=[2&_[0],s.value]),_[0]){case 0:case 1:s=_;break;case 4:return r.label++,{value:_[1],done:!1};case 5:r.label++,i=_[1],_=[0];continue;case 7:_=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!((s=s.length>0&&s[s.length-1])||_[0]!==6&&_[0]!==2)){r=0;continue}if(_[0]===3&&(!s||_[1]>s[0]&&_[1]<s[3])){r.label=_[1];break}if(_[0]===6&&r.label<s[1]){r.label=s[1],s=_;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(_);break}s[2]&&r.ops.pop(),r.trys.pop();continue}_=t.call(n,r)}catch(f){_=[6,f],i=0}finally{e=s=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([c,d])}}}(function(n,t){t===void 0&&(t={});var e=t.insertAt;if(typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",e==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}})(`@import url("https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap");
#index_terminalContainer__4seT6 {
  --control-default-bg-color: #ccc;
  --control-close-bg-color: #fc5b57;
  --control-minimize-bg-color: #e5bf3c;
  --control-maximize-bg-color: #57c038;
}

.index_controls__sXDjs {
  text-align: left;
  height: 26px;
  position: relative;
  top: 4px;
  margin-left: 4px;
}
.index_controls__sXDjs .index_consoleCtrl__DI2H1 {
  display: inline-block;
  width: 13px;
  height: 13px;
  margin: 0 3px;
  border-radius: 50%;
  background: var(--control-default-bg-color);
}
.index_controls__sXDjs .index_close__XGN9U {
  background: var(--control-close-bg-color);
}
.index_controls__sXDjs .index_minimize__pZYTU {
  background: var(--control-minimize-bg-color);
}
.index_controls__sXDjs .index_maximize__szRK7 {
  background: var(--control-maximize-bg-color);
}

.index_editor__JoDSg {
  text-align: left;
  height: 100%;
  padding: 10px 15px;
  overflow-wrap: break-word;
  overflow-y: scroll;
  outline: none;
  font-family: "Source Code Pro", monospace;
  font-size: 18px;
  line-height: 22px;
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
}
.index_editor__JoDSg .index_mobileInput__WloSq {
  position: absolute;
  top: -2000px;
  left: -2000px;
}
.index_editor__JoDSg .index_lineText__j6qNj {
  display: inline;
  position: relative;
  top: -1px;
  margin-left: 8px;
}
.index_editor__JoDSg .index_preWhiteSpace__7KwuG {
  white-space: pre-wrap;
}
.index_editor__JoDSg .index_caret__VS4iV {
  position: relative;
  -webkit-animation: index_blink__FJp0- 0.75s ease-in-out infinite;
  -moz-animation: index_blink__FJp0- 0.75s ease-in-out infinite;
  -o-animation: index_blink__FJp0- 0.75s ease-in-out infinite;
  -ms-animation: index_blink__FJp0- 0.75s ease-in-out infinite;
  animation: index_blink__FJp0- 0.75s ease-in-out infinite;
}
.index_editor__JoDSg .index_caret__VS4iV .index_caretAfter__6aXPx {
  content: "";
  position: absolute;
  top: 2px;
  width: 10px;
  height: 22px;
  z-index: 10;
}
@-moz-keyframes index_blink__FJp0- {
  0% {
    opacity: 0;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
  }
  100% {
    opacity: 1;
    -ms-filter: none;
    filter: none;
  }
}
@-webkit-keyframes index_blink__FJp0- {
  0% {
    opacity: 0;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
  }
  100% {
    opacity: 1;
    -ms-filter: none;
    filter: none;
  }
}
@-o-keyframes index_blink__FJp0- {
  0% {
    opacity: 0;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
  }
  100% {
    opacity: 1;
    -ms-filter: none;
    filter: none;
  }
}
@keyframes index_blink__FJp0- {
  0% {
    opacity: 0;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
  }
  100% {
    opacity: 1;
    -ms-filter: none;
    filter: none;
  }
}
.index_editor__JoDSg a {
  color: #1a87b5;
}

.index_editorWithTopBar__L6XKw {
  height: calc(100% - 46px);
}

.index_curvedTop__LX9XS {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}

#index_terminalContainer__4seT6 {
  height: 100%;
}

.index_terminal__teubZ {
  height: 100%;
  width: 100%;
  margin: auto;
  border-radius: 5px;
}`);var B2={terminalContainer:"index_terminalContainer__4seT6",controls:"index_controls__sXDjs",consoleCtrl:"index_consoleCtrl__DI2H1",close:"index_close__XGN9U",minimize:"index_minimize__pZYTU",maximize:"index_maximize__szRK7",editor:"index_editor__JoDSg",mobileInput:"index_mobileInput__WloSq",lineText:"index_lineText__j6qNj",preWhiteSpace:"index_preWhiteSpace__7KwuG",caret:"index_caret__VS4iV",blink:"index_blink__FJp0-",caretAfter:"index_caretAfter__6aXPx",editorWithTopBar:"index_editorWithTopBar__L6XKw",curvedTop:"index_curvedTop__LX9XS",terminal:"index_terminal__teubZ"},Do=_l(null),O2=function(n){var t=n.children;return yt(Do.Provider,{value:B2},t)},U2={dark:{themeBGColor:"#022833",themeToolbarColor:"#131519",themeColor:"#839496",themePromptColor:"#a917a8"},light:{themeBGColor:"#fdf6e4",themeToolbarColor:"#d8d8d8",themeColor:"#333333",themePromptColor:"#a917a8"},dracula:{themeBGColor:"#272B36",themeToolbarColor:"#DBDBDB",themeColor:"#FFFEFC",themePromptColor:"#a917a8"},"material-dark":{themeBGColor:"#151515",themeToolbarColor:"#424242",themeColor:"#fff",themePromptColor:"#42A5F5"},"material-light":{themeBGColor:"#fafafa",themeToolbarColor:"#424242",themeColor:"#151515",themePromptColor:"#42A5F5"},"material-ocean":{themeBGColor:"#263238",themeToolbarColor:"#37474F",themeColor:"#fff",themePromptColor:"#C3D82C"},matrix:{themeBGColor:"#0D0208",themeToolbarColor:"#0D0208",themeColor:"#00FF41",themePromptColor:"#008F11"}},Qa=_l(null),z2=function(n){var t=n.children,e=Ya(Ya({},U2),t.props.themes||{}),i=e[t.props.theme]||e.light;return yt(Qa.Provider,{value:i},t)},Gn=function(){function n(){}return n.splitStringAtIndex=function(t,e){return t?[t.substring(0,e),t.substring(e)]:["",""]},n.isMobile=function(){return kn(window.navigator.userAgent).device.is("mobile")},n}();function H2(n){var t=_i(Do),e=n.controlButtonLabels,i=n.showControlButtons?e.map(function(s){return yt("div",{key:s,className:"".concat(t.consoleCtrl," ").concat(t[s])})}):null;return yt("div",{className:t.controls},i)}var Ra=_l({bufferedContent:"",temporaryContent:"",setBufferedContent:function(n){},setTemporaryContent:function(n){},appendCommandToHistory:function(){},getNextCommand:function(){return""},getPreviousCommand:function(){return""}}),W2=function(n,t,e,i,s,r,o,l){var c=_i(Do),d=_i(Qa),_=_i(Ra),f=_.appendCommandToHistory,g=_.temporaryContent,m=Hr(null),x=ni(""),C=x[0],T=x[1],A=ni(!1),S=A[0],E=A[1],M=ni(0),O=M[0],N=M[1],F=ni(""),K=F[0],nt=F[1],pt=ni(""),ht=pt[0],ct=pt[1];Ti(function(){Gn.isMobile()},[t]),Ti(function(){S&&f(C)},[S]),Ti(function(){l.current!==null&&m.current!==null&&(l.current.onclick=function(){m.current.focus()})},[]);var bt=Gn.isMobile()&&r?yt("div",{className:c.mobileInput},yt("input",{type:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",value:C,onChange:function(Ct){return T(Ct.target.value)},ref:m,"data-testid":"editor-input"})):null,wt=S?yt(qe,null,bt,yt("div",{className:c.lineText},t&&n?yt("span",{className:c.caret},yt("span",{className:c.caretAfter,style:{background:d.themeColor}})):null,yt("span",{className:c.preWhiteSpace},g))):yt(qe,null,bt,yt("span",{style:{color:d.themePromptColor}},e),yt("div",{className:c.lineText},yt("span",{className:c.preWhiteSpace},K),t&&n?yt("span",{className:c.caret},yt("span",{className:c.caretAfter,style:{background:d.themeColor}})):null,yt("span",{className:c.preWhiteSpace},ht)));return function(Ct,dt,G,kt,Ht,At,Dt,me,ke,Se){var Vt=_i(Ra),Ie=Vt.getPreviousCommand,Je=Vt.getNextCommand,zi=function(Re){if(Ct&&ke){Re.preventDefault();var ue=Re.key;if(ue!=="Enter"){var te=null;if(ue==="Backspace"){var xi=Gn.splitStringAtIndex(dt,Ht),Zs=xi[0],_e=xi[1];te=Zs.slice(0,-1)+_e,dt&&dt.length!==0&&At(Ht-1)}else if(ue==="ArrowUp")(te=Ie())&&At(te.length);else if(ue==="ArrowDown")te=Je(),At(te?te.length:0);else if(ue==="ArrowLeft")Ht>0&&At(Ht-1),te=dt;else if(ue==="ArrowRight")Ht<dt.length&&At(Ht+1),te=dt;else if(ue==="Tab"){var Ki=Object.keys(Se).find(function(Is){return Is.substring(0,dt.length)===dt});if(Ki)return G(Ki),void At(Ki.length)}else if((Re.metaKey||Re.ctrlKey)&&ue.toLowerCase()==="v")navigator.clipboard.readText().then(function(Is){var cs=Gn.splitStringAtIndex(dt||"",Ht),ds=cs[0],Hi=cs[1];te=ds+Is+Hi,At(Ht+Is.length),G(te)});else if((Re.metaKey||Re.ctrlKey)&&ue.toLowerCase()==="c"){var Rn=window.getSelection().toString();navigator.clipboard.writeText(Rn).then(function(){G(te=dt)})}else if(ue&&ue.length===1){var ai=Gn.splitStringAtIndex(dt,Ht);Zs=ai[0],_e=ai[1],te=Zs+ue+_e,At(Ht+1)}else te=dt;G(te),kt(!1)}else kt(!0)}};Ti(function(){return document.addEventListener("keydown",zi),function(){document.removeEventListener("keydown",zi)}}),Ti(function(){var Re=Gn.splitStringAtIndex(dt,Ht),ue=Re[0],te=Re[1];Dt(ue),me(te)},[dt,Ht])}(t,C,T,E,O,N,nt,ct,r,i),function(Ct,dt,G,kt,Ht,At,Dt,me,ke,Se,Vt){var Ie=_i(Ra);Ie.bufferedContent;var Je=Ie.setBufferedContent,zi=Ie.setTemporaryContent;_i(Do);var Re=_i(Qa);Ti(function(){var ue;Ct&&(ue=kt,L2(void 0,void 0,void 0,function(){var te,xi,Zs,_e,Ki,Rn,ai,Is;return F2(this,function(cs){switch(cs.label){case 0:return te=ue.trim().split(" "),xi=te[0],Zs=te.slice(1),_e="",xi==="clear"?(Je(""),Ht(""),dt(!1),At(0),Dt(""),me(""),[2]):(Ki=yt(qe,null,yt("span",{style:{color:Re.themePromptColor}},G," "),yt("span",null,kt),yt("br",null)),Je(function(ds){return yt(qe,null,ds,Ki)}),Ht(""),At(0),Dt(""),me(""),ue?(Rn=Zs.join(" "),xi&&ke[xi]?typeof(ai=ke[xi])!="function"?[3,2]:[4,ai(Rn)]:[3,4]):[3,9]);case 1:return _e=cs.sent(),[3,3];case 2:_e=ai,cs.label=3;case 3:return[3,9];case 4:return typeof Vt!="function"?[3,6]:[4,Vt(xi,Rn)];case 5:return _e=cs.sent(),[3,9];case 6:return typeof Se!="function"?[3,8]:[4,Se(xi,Rn)];case 7:return _e=cs.sent(),[3,9];case 8:_e=Se,cs.label=9;case 9:return Is=yt(qe,null,_e?yt("span",null,_e,yt("br",null)):null),Je(function(ds){return yt(qe,null,ds,Is)}),zi(""),dt(!1),[2]}})}))},[Ct])}(S,E,e,C,T,N,nt,ct,i,s,o),wt};function N2(n){var t=Hr(null),e=_i(Do),i=_i(Qa),s=_i(Ra).bufferedContent;(function(C,T){Ti(function(){T.current&&(T.current.scrollTop=T.current.scrollHeight)},[C])})(s,t);var r=n.enableInput,o=n.caret,l=n.consoleFocused,c=n.prompt,d=n.commands,_=n.welcomeMessage,f=n.errorMessage,g=n.showControlBar,m=n.defaultHandler,x=W2(o,l,c,d,f,r,m,t);return yt("div",{id:"terminalEditor",ref:t,className:"".concat(e.editor," ").concat(g?null:e.curvedTop," ").concat(g?e.editorWithTopBar:null),style:{background:i.themeBGColor}},_,s,x)}var G2=function(n){var t,e,i,s,r=n.enableInput,o=r===void 0||r,l=n.caret,c=l===void 0||l,d=n.theme,_=d===void 0?"light":d,f=n.showControlBar,g=f===void 0||f,m=n.showControlButtons,x=m===void 0||m,C=n.controlButtonLabels,T=C===void 0?["close","minimize","maximize"]:C,A=n.prompt,S=A===void 0?">>>":A,E=n.commands,M=E===void 0?{}:E,O=n.welcomeMessage,N=O===void 0?"":O,F=n.errorMessage,K=F===void 0?"not found!":F,nt=n.defaultHandler,pt=nt===void 0?null:nt,ht=Hr(null),ct=ni(!Gn.isMobile()),bt=ct[0],wt=ct[1],Ct=_i(Do),dt=_i(Qa);t=ht,e=bt,i=wt,s=function(Ht){t.current&&!t.current.contains(Ht.target)?i(!1):Gn.isMobile()?i(!e):i(!0)},Ti(function(){return document.addEventListener("mousedown",s),function(){document.removeEventListener("mousedown",s)}});var G=g?yt(H2,{consoleFocused:bt,showControlButtons:x,controlButtonLabels:T}):null,kt=yt(N2,{caret:c,consoleFocused:bt,prompt:S,commands:M,welcomeMessage:N,errorMessage:K,enableInput:o,showControlBar:g,defaultHandler:pt});return yt("div",{ref:ht,id:Ct.terminalContainer,className:Ct["theme--".concat(_)],"data-testid":"terminal"},yt("div",{className:"".concat(Ct.terminal),style:{background:dt.themeToolbarColor,color:dt.themeColor}},G,kt))};function $2(n){var t=n.children;return yt(O2,null,yt(z2,null,t))}function j2(n){return yt($2,null,yt(G2,Ya({},n)))}var q2=function(n){var t=n.children,e=ni(""),i=e[0],s=e[1],r=ni(""),o=r[0],l=r[1],c=ni([]),d=c[0],_=c[1],f=ni(null),g=f[0],m=f[1];return Ti(function(){m(d.length)},[d]),yt(Ra.Provider,{value:{bufferedContent:i,temporaryContent:o,setTemporaryContent:l,setBufferedContent:s,appendCommandToHistory:function(x){x&&_(d.concat(x))},getPreviousCommand:function(){if(g===0)return d.length===0?"":d[0];var x=d[g-1];return g>0&&m(g-1),x},getNextCommand:function(){if(g+1<=d.length){var x=d[g+1];return m(g+1),x}return""}}},t)};function V2({crtBox:n}){const[t,e]=ni(""),i=Hr(null);Ti(()=>{i.current.minimize()},[]);function s(r){e(r)}return window.visual={flash:s},fi("div",{id:"game",children:[fi("div",{id:"game_overlay",children:[t,fi(x2,{title:"Roke Console",className:"modern",background:"#f005",ref:i,hide:n==null,top:(n==null?void 0:n.top)||0,left:(n==null?void 0:n.left)||0,right:window.innerWidth-(n==null?void 0:n.right)||0,bottom:window.innerHeight-(n==null?void 0:n.bottom)||0,onClose:()=>(i.current.minimize(),!0),noMax:!0,noMin:!0,noFull:!0,children:fi(j2,{showControlBar:!1,theme:"dark",width:"100%"})})]}),fi("div",{id:"game_margin",children:fi("canvas",{tabIndex:"1",id:"game_canvas"})})]})}const X2="modulepreload",Z2=function(n){return"/roke/"+n},Tv={},Eu=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(e.map(c=>{if(c=Z2(c),c in Tv)return;Tv[c]=!0;const d=c.endsWith(".css"),_=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${_}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":X2,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((g,m)=>{f.addEventListener("load",g),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const Y2=n=>{const t=new Map;t.set("web",{name:"web"});const e=n.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},i=(r,o)=>{e.platforms.set(r,o)},s=r=>{e.platforms.has(r)&&(e.currentPlatform=e.platforms.get(r))};return e.addPlatform=i,e.setPlatform=s,e},Q2=n=>n.CapacitorPlatforms=Y2(n),Zx=Q2(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});Zx.addPlatform;Zx.setPlatform;var Lo;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Lo||(Lo={}));class Pu extends Error{constructor(t,e,i){super(t),this.message=t,this.code=e,this.data=i}}const K2=n=>{var t,e;return n!=null&&n.androidBridge?"android":!((e=(t=n==null?void 0:n.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||e===void 0)&&e.bridge?"ios":"web"},J2=n=>{var t,e,i,s,r;const o=n.CapacitorCustomPlatform||null,l=n.Capacitor||{},c=l.Plugins=l.Plugins||{},d=n.CapacitorPlatforms,_=()=>o!==null?o.name:K2(n),f=((t=d==null?void 0:d.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||_,g=()=>f()!=="web",m=((e=d==null?void 0:d.currentPlatform)===null||e===void 0?void 0:e.isNativePlatform)||g,x=F=>{const K=M.get(F);return!!(K!=null&&K.platforms.has(f())||A(F))},C=((i=d==null?void 0:d.currentPlatform)===null||i===void 0?void 0:i.isPluginAvailable)||x,T=F=>{var K;return(K=l.PluginHeaders)===null||K===void 0?void 0:K.find(nt=>nt.name===F)},A=((s=d==null?void 0:d.currentPlatform)===null||s===void 0?void 0:s.getPluginHeader)||T,S=F=>n.console.error(F),E=(F,K,nt)=>Promise.reject(`${nt} does not have an implementation of "${K}".`),M=new Map,O=(F,K={})=>{const nt=M.get(F);if(nt)return console.warn(`Capacitor plugin "${F}" already registered. Cannot register plugins twice.`),nt.proxy;const pt=f(),ht=A(F);let ct;const bt=async()=>(!ct&&pt in K?ct=typeof K[pt]=="function"?ct=await K[pt]():ct=K[pt]:o!==null&&!ct&&"web"in K&&(ct=typeof K.web=="function"?ct=await K.web():ct=K.web),ct),wt=(At,Dt)=>{var me,ke;if(ht){const Se=ht==null?void 0:ht.methods.find(Vt=>Dt===Vt.name);if(Se)return Se.rtype==="promise"?Vt=>l.nativePromise(F,Dt.toString(),Vt):(Vt,Ie)=>l.nativeCallback(F,Dt.toString(),Vt,Ie);if(At)return(me=At[Dt])===null||me===void 0?void 0:me.bind(At)}else{if(At)return(ke=At[Dt])===null||ke===void 0?void 0:ke.bind(At);throw new Pu(`"${F}" plugin is not implemented on ${pt}`,Lo.Unimplemented)}},Ct=At=>{let Dt;const me=(...ke)=>{const Se=bt().then(Vt=>{const Ie=wt(Vt,At);if(Ie){const Je=Ie(...ke);return Dt=Je==null?void 0:Je.remove,Je}else throw new Pu(`"${F}.${At}()" is not implemented on ${pt}`,Lo.Unimplemented)});return At==="addListener"&&(Se.remove=async()=>Dt()),Se};return me.toString=()=>`${At.toString()}() { [capacitor code] }`,Object.defineProperty(me,"name",{value:At,writable:!1,configurable:!1}),me},dt=Ct("addListener"),G=Ct("removeListener"),kt=(At,Dt)=>{const me=dt({eventName:At},Dt),ke=async()=>{const Vt=await me;G({eventName:At,callbackId:Vt},Dt)},Se=new Promise(Vt=>me.then(()=>Vt({remove:ke})));return Se.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await ke()},Se},Ht=new Proxy({},{get(At,Dt){switch(Dt){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ht?kt:dt;case"removeListener":return G;default:return Ct(Dt)}}});return c[F]=Ht,M.set(F,{name:F,proxy:Ht,platforms:new Set([...Object.keys(K),...ht?[pt]:[]])}),Ht},N=((r=d==null?void 0:d.currentPlatform)===null||r===void 0?void 0:r.registerPlugin)||O;return l.convertFileSrc||(l.convertFileSrc=F=>F),l.getPlatform=f,l.handleError=S,l.isNativePlatform=m,l.isPluginAvailable=C,l.pluginMethodNoop=E,l.registerPlugin=N,l.Exception=Pu,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},tU=n=>n.Capacitor=J2(n),tc=tU(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Yf=tc.registerPlugin;tc.Plugins;class Yx{constructor(t){this.listeners={},this.retainedEventArguments={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,e){let i=!1;this.listeners[t]||(this.listeners[t]=[],i=!0),this.listeners[t].push(e);const r=this.windowListeners[t];r&&!r.registered&&this.addWindowListener(r),i&&this.sendRetainedArgumentsForEvent(t);const o=async()=>this.removeListener(t,e);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e,i){const s=this.listeners[t];if(!s){if(i){let r=this.retainedEventArguments[t];r||(r=[]),r.push(e),this.retainedEventArguments[t]=r}return}s.forEach(r=>r(e))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:i=>{this.notifyListeners(e,i)}}}unimplemented(t="not implemented"){return new tc.Exception(t,Lo.Unimplemented)}unavailable(t="not available"){return new tc.Exception(t,Lo.Unavailable)}async removeListener(t,e){const i=this.listeners[t];if(!i)return;const s=i.indexOf(e);this.listeners[t].splice(s,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const e=this.retainedEventArguments[t];e&&(delete this.retainedEventArguments[t],e.forEach(i=>{this.notifyListeners(t,i)}))}}const Ev=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Pv=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class eU extends Yx{async getCookies(){const t=document.cookie,e={};return t.split(";").forEach(i=>{if(i.length<=0)return;let[s,r]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=Pv(s).trim(),r=Pv(r).trim(),e[s]=r}),e}async setCookie(t){try{const e=Ev(t.key),i=Ev(t.value),s=`; expires=${(t.expires||"").replace("expires=","")}`,r=(t.path||"/").replace("path=",""),o=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${e}=${i||""}${s}; path=${r}; ${o};`}catch(e){return Promise.reject(e)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const e of t)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}Yf("CapacitorCookies",{web:()=>new eU});const iU=async n=>new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{const s=i.result;t(s.indexOf(",")>=0?s.split(",")[1]:s)},i.onerror=s=>e(s),i.readAsDataURL(n)}),sU=(n={})=>{const t=Object.keys(n);return Object.keys(n).map(s=>s.toLocaleLowerCase()).reduce((s,r,o)=>(s[r]=n[t[o]],s),{})},nU=(n,t=!0)=>n?Object.entries(n).reduce((i,s)=>{const[r,o]=s;let l,c;return Array.isArray(o)?(c="",o.forEach(d=>{l=t?encodeURIComponent(d):d,c+=`${r}=${l}&`}),c.slice(0,-1)):(l=t?encodeURIComponent(o):o,c=`${r}=${l}`),`${i}&${c}`},"").substr(1):null,rU=(n,t={})=>{const e=Object.assign({method:n.method||"GET",headers:n.headers},t),s=sU(n.headers)["content-type"]||"";if(typeof n.data=="string")e.body=n.data;else if(s.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[o,l]of Object.entries(n.data||{}))r.set(o,l);e.body=r.toString()}else if(s.includes("multipart/form-data")||n.data instanceof FormData){const r=new FormData;if(n.data instanceof FormData)n.data.forEach((l,c)=>{r.append(c,l)});else for(const l of Object.keys(n.data))r.append(l,n.data[l]);e.body=r;const o=new Headers(e.headers);o.delete("content-type"),e.headers=o}else(s.includes("application/json")||typeof n.data=="object")&&(e.body=JSON.stringify(n.data));return e};class oU extends Yx{async request(t){const e=rU(t,t.webFetchExtra),i=nU(t.params,t.shouldEncodeUrlParams),s=i?`${t.url}?${i}`:t.url,r=await fetch(s,e),o=r.headers.get("content-type")||"";let{responseType:l="text"}=r.ok?t:{};o.includes("application/json")&&(l="json");let c,d;switch(l){case"arraybuffer":case"blob":d=await r.blob(),c=await iU(d);break;case"json":c=await r.json();break;case"document":case"text":default:c=await r.text()}const _={};return r.headers.forEach((f,g)=>{_[g]=f}),{data:c,headers:_,status:r.status,url:r.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}Yf("CapacitorHttp",{web:()=>new oU});const aU=Yf("Motion",{android:()=>Eu(()=>import("./web-CdNRlZ_u.js"),[]).then(n=>new n.MotionWeb),ios:()=>Eu(()=>import("./web-CdNRlZ_u.js"),[]).then(n=>new n.MotionWeb),web:()=>Eu(()=>import("./web-CdNRlZ_u.js"),[]).then(n=>new n.MotionWeb)});var ec={d:(n,t)=>{for(var e in t)ec.o(t,e)&&!ec.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},o:(n,t)=>Object.prototype.hasOwnProperty.call(n,t)},We={};ec.d(We,{dd:()=>dc,UZ:()=>Qf,NN:()=>Da,e1:()=>hb,a8:()=>ob,u6:()=>lb,oK:()=>ab,U_:()=>Gc,sn:()=>cb,GY:()=>cl,$t:()=>Jf,RI:()=>ub,_k:()=>cc,eZ:()=>Ma,pf:()=>_b,N5:()=>lU,qD:()=>Qx,hu:()=>Kx,Uk:()=>c_});const he=(n=>{var t={};return ec.d(t,n),t})({Actor:()=>Mc,BoundingBox:()=>Dc,Color:()=>Lc,GraphicsComponent:()=>nx,ImageSource:()=>Df,SpriteSheet:()=>Fc,TileMap:()=>dx,TransformComponent:()=>ux,Vector:()=>_x,vec:()=>ze});class Ma{constructor(t,e,i,s){var r,o,l,c;if(this.order=s,this.worldPos=(0,he.vec)(t.ldtkLevel.worldX,t.ldtkLevel.worldY),this.offset=(0,he.vec)(e.__pxTotalOffsetX,e.__pxTotalOffsetY),this.ldtkLayer=e,this.tilemap=new he.TileMap({name:e.__identifier,pos:this.worldPos.add(this.offset),tileWidth:e.__gridSize,tileHeight:e.__gridSize,rows:e.__cHei,columns:e.__cWid}),this.tilemap.z=s,this.tilemap.get(he.GraphicsComponent).isVisible=e.visible,e.__tilesetDefUid){this.tileset=i.tilesets.get(e.__tilesetDefUid);for(let d of e.gridTiles){const _=Math.floor(d.px[0]/e.__gridSize),f=Math.floor(d.px[1]/e.__gridSize),g=this.tilemap.getTile(_,f);if(this.tileset){const m=Math.floor((d.src[0]-((r=this.tileset.ldtkTileset.padding)!==null&&r!==void 0?r:0))/(this.tileset.ldtkTileset.tileGridSize+((o=this.tileset.ldtkTileset.spacing)!==null&&o!==void 0?o:0))),x=Math.floor((d.src[1]-((l=this.tileset.ldtkTileset.padding)!==null&&l!==void 0?l:0))/(this.tileset.ldtkTileset.tileGridSize+((c=this.tileset.ldtkTileset.spacing)!==null&&c!==void 0?c:0))),C=!!(1&d.f),T=!!(2&d.f);let A=this.tileset.spritesheet.getSprite(m,x);(C||T)&&(A=A.clone(),A.flipHorizontal=C,A.flipVertical=T),A?g.addGraphic(A):console.error("Could not find sprite in LDtk spritesheet at",m,x)}}}else console.error("Could not tileset in LDtk",e.__tilesetDefUid,e.__tilesetRelPath)}}function lU(n){const t=n.match(/[^/\\&\?]+\.\w{2,4}(?=([\#\?&].*$|$))/gi);if(t)return t[0];throw new Error(`Could not locate filename from path: ${n}`)}function Qx(n,t){for(const{path:e,output:i}of t)if(typeof e=="string"){if(n.includes(e))return i}else{const s=n.match(e);if(s)return i.replace("[match]",s[0])}return n}function Kx(n,t){if(!t)return!1;for(const{path:e,output:i}of t)if(typeof e=="string"){if(n.includes(e))return!0}else if(n.match(e))return!0;return!1}function c_(n,t,e){if(Kx(t,e)&&e)return Qx(t,e);if(t.indexOf("/")===0)return t;const i=n.split("/"),s=t.split("/");return i[i.length-1].includes(".")&&i.pop(),i.concat(s).join("/")}const Qf=async(n,t)=>{const e=await fetch(n);switch(t.toLowerCase()){case"xml":default:return await e.text();case"json":return await e.json()}};var $t,d_;(function(n){n.assertEqual=t=>t,n.assertIs=function(t){},n.assertNever=function(t){throw new Error},n.arrayToEnum=t=>{const e={};for(const i of t)e[i]=i;return e},n.getValidEnumValues=t=>{const e=n.objectKeys(t).filter(s=>typeof t[t[s]]!="number"),i={};for(const s of e)i[s]=t[s];return n.objectValues(i)},n.objectValues=t=>n.objectKeys(t).map(function(e){return t[e]}),n.objectKeys=typeof Object.keys=="function"?t=>Object.keys(t):t=>{const e=[];for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e},n.find=(t,e)=>{for(const i of t)if(e(i))return i},n.isInteger=typeof Number.isInteger=="function"?t=>Number.isInteger(t):t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t,n.joinValues=function(t,e=" | "){return t.map(i=>typeof i=="string"?`'${i}'`:i).join(e)},n.jsonStringifyReplacer=(t,e)=>typeof e=="bigint"?e.toString():e})($t||($t={})),function(n){n.mergeShapes=(t,e)=>({...t,...e})}(d_||(d_={}));const it=$t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),dn=n=>{switch(typeof n){case"undefined":return it.undefined;case"string":return it.string;case"number":return isNaN(n)?it.nan:it.number;case"boolean":return it.boolean;case"function":return it.function;case"bigint":return it.bigint;case"symbol":return it.symbol;case"object":return Array.isArray(n)?it.array:n===null?it.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?it.promise:typeof Map<"u"&&n instanceof Map?it.map:typeof Set<"u"&&n instanceof Set?it.set:typeof Date<"u"&&n instanceof Date?it.date:it.object;default:return it.unknown}},X=$t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Zi extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}format(t){const e=t||function(r){return r.message},i={_errors:[]},s=r=>{for(const o of r.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)i._errors.push(e(o));else{let l=i,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(e(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return s(this),i}static assert(t){if(!(t instanceof Zi))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,$t.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},i=[];for(const s of this.issues)s.path.length>0?(e[s.path[0]]=e[s.path[0]]||[],e[s.path[0]].push(t(s))):i.push(t(s));return{formErrors:i,fieldErrors:e}}get formErrors(){return this.flatten()}}Zi.create=n=>new Zi(n);const Fo=(n,t)=>{let e;switch(n.code){case X.invalid_type:e=n.received===it.undefined?"Required":`Expected ${n.expected}, received ${n.received}`;break;case X.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(n.expected,$t.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:e=`Unrecognized key(s) in object: ${$t.joinValues(n.keys,", ")}`;break;case X.invalid_union:e="Invalid input";break;case X.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${$t.joinValues(n.options)}`;break;case X.invalid_enum_value:e=`Invalid enum value. Expected ${$t.joinValues(n.options)}, received '${n.received}'`;break;case X.invalid_arguments:e="Invalid function arguments";break;case X.invalid_return_type:e="Invalid function return type";break;case X.invalid_date:e="Invalid date";break;case X.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(e=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?e=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?e=`Invalid input: must end with "${n.validation.endsWith}"`:$t.assertNever(n.validation):e=n.validation!=="regex"?`Invalid ${n.validation}`:"Invalid";break;case X.too_small:e=n.type==="array"?`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:"Invalid input";break;case X.too_big:e=n.type==="array"?`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:"Invalid input";break;case X.custom:e="Invalid input";break;case X.invalid_intersection_types:e="Intersection results could not be merged";break;case X.not_multiple_of:e=`Number must be a multiple of ${n.multipleOf}`;break;case X.not_finite:e="Number must be finite";break;default:e=t.defaultError,$t.assertNever(n)}return{message:e}};let Jx=Fo;function ic(){return Jx}const sc=n=>{const{data:t,path:e,errorMaps:i,issueData:s}=n,r=[...e,...s.path||[]],o={...s,path:r};if(s.message!==void 0)return{...s,path:r,message:s.message};let l="";const c=i.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:t,defaultError:l}).message;return{...s,path:r,message:l}};function et(n,t){const e=ic(),i=sc({issueData:t,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,e,e===Fo?void 0:Fo].filter(s=>!!s)});n.common.issues.push(i)}class vi{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const i=[];for(const s of e){if(s.status==="aborted")return xt;s.status==="dirty"&&t.dirty(),i.push(s.value)}return{status:t.value,value:i}}static async mergeObjectAsync(t,e){const i=[];for(const s of e){const r=await s.key,o=await s.value;i.push({key:r,value:o})}return vi.mergeObjectSync(t,i)}static mergeObjectSync(t,e){const i={};for(const s of e){const{key:r,value:o}=s;if(r.status==="aborted"||o.status==="aborted")return xt;r.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),r.value==="__proto__"||o.value===void 0&&!s.alwaysSet||(i[r.value]=o.value)}return{status:t.value,value:i}}}const xt=Object.freeze({status:"aborted"}),nc=n=>({status:"dirty",value:n}),Pi=n=>({status:"valid",value:n}),u_=n=>n.status==="aborted",__=n=>n.status==="dirty",Fr=n=>n.status==="valid",Ka=n=>typeof Promise<"u"&&n instanceof Promise;function rc(n,t,e,i){if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(n)}function tb(n,t,e,i,s){if(typeof t=="function"?n!==t||!s:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}var ot,Sa,Ta;typeof SuppressedError=="function"&&SuppressedError,function(n){n.errToObj=t=>typeof t=="string"?{message:t}:t||{},n.toString=t=>typeof t=="string"?t:t==null?void 0:t.message}(ot||(ot={}));class $s{constructor(t,e,i,s){this._cachedPath=[],this.parent=t,this.data=e,this._path=i,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const kv=(n,t)=>{if(Fr(t))return{success:!0,data:t.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new Zi(n.common.issues);return this._error=e,this._error}}};function Pt(n){if(!n)return{};const{errorMap:t,invalid_type_error:e,required_error:i,description:s}=n;if(t&&(e||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(r,o)=>{var l,c;const{message:d}=n;return r.code==="invalid_enum_value"?{message:d??o.defaultError}:o.data===void 0?{message:(l=d??i)!==null&&l!==void 0?l:o.defaultError}:r.code!=="invalid_type"?{message:o.defaultError}:{message:(c=d??e)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Ft{get description(){return this._def.description}_getType(t){return dn(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:dn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new vi,ctx:{common:t.parent.common,data:t.data,parsedType:dn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(Ka(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const i=this.safeParse(t,e);if(i.success)return i.data;throw i.error}safeParse(t,e){var i;const s={common:{issues:[],async:(i=e==null?void 0:e.async)!==null&&i!==void 0&&i,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:dn(t)},r=this._parseSync({data:t,path:s.path,parent:s});return kv(s,r)}"~validate"(t){var e,i;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:dn(t)};if(!this["~standard"].async)try{const r=this._parseSync({data:t,path:[],parent:s});return Fr(r)?{value:r.value}:{issues:s.common.issues}}catch(r){!((i=(e=r==null?void 0:r.message)===null||e===void 0?void 0:e.toLowerCase())===null||i===void 0)&&i.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:s}).then(r=>Fr(r)?{value:r.value}:{issues:s.common.issues})}async parseAsync(t,e){const i=await this.safeParseAsync(t,e);if(i.success)return i.data;throw i.error}async safeParseAsync(t,e){const i={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:dn(t)},s=this._parse({data:t,path:i.path,parent:i}),r=await(Ka(s)?s:Promise.resolve(s));return kv(i,r)}refine(t,e){const i=s=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,r)=>{const o=t(s),l=()=>r.addIssue({code:X.custom,...i(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>!!c||(l(),!1)):!!o||(l(),!1)})}refinement(t,e){return this._refinement((i,s)=>!!t(i)||(s.addIssue(typeof e=="function"?e(i,s):e),!1))}_refinement(t){return new ys({schema:this,typeName:vt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Gs.create(this,this._def)}nullable(){return er.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ts.create(this)}promise(){return Oo.create(this,this._def)}or(t){return il.create([this,t],this._def)}and(t){return sl.create(this,t,this._def)}transform(t){return new ys({...Pt(this._def),schema:this,typeName:vt.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new al({...Pt(this._def),innerType:this,defaultValue:e,typeName:vt.ZodDefault})}brand(){return new Kf({typeName:vt.ZodBranded,type:this,...Pt(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new ll({...Pt(this._def),innerType:this,catchValue:e,typeName:vt.ZodCatch})}describe(t){return new this.constructor({...this._def,description:t})}pipe(t){return Tl.create(this,t)}readonly(){return hl.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const hU=/^c[^\s-]{8,}$/i,cU=/^[0-9a-z]+$/,dU=/^[0-9A-HJKMNP-TV-Z]{26}$/i,uU=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_U=/^[a-z0-9_-]{21}$/i,fU=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,pU=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gU=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ku;const mU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,vU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,wU=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,xU=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bU=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yU=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,eb="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",CU=new RegExp(`^${eb}$`);function ib(n){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?t=`${t}\\.\\d{${n.precision}}`:n.precision==null&&(t=`${t}(\\.\\d+)?`),t}function sb(n){let t=`${eb}T${ib(n)}`;const e=[];return e.push(n.local?"Z?":"Z"),n.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function AU(n,t){if(!fU.test(n))return!1;try{const[e]=n.split("."),i=e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+(4-e.length%4)%4,"="),s=JSON.parse(atob(i));return typeof s=="object"&&s!==null&&!(!s.typ||!s.alg)&&(!t||s.alg===t)}catch{return!1}}function SU(n,t){return!(t!=="v4"&&t||!vU.test(n))||!(t!=="v6"&&t||!xU.test(n))}class bs extends Ft{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==it.string){const o=this._getOrReturnCtx(t);return et(o,{code:X.invalid_type,expected:it.string,received:o.parsedType}),xt}const e=new vi;let i;for(const o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:X.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="max")t.data.length>o.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:X.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="length"){const l=t.data.length>o.value,c=t.data.length<o.value;(l||c)&&(i=this._getOrReturnCtx(t,i),l?et(i,{code:X.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):c&&et(i,{code:X.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),e.dirty())}else if(o.kind==="email")gU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"email",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="emoji")ku||(ku=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ku.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"emoji",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="uuid")uU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"uuid",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="nanoid")_U.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"nanoid",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid")hU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cuid",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid2")cU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cuid2",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="ulid")dU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"ulid",code:X.invalid_string,message:o.message}),e.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),et(i,{validation:"url",code:X.invalid_string,message:o.message}),e.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"regex",code:X.invalid_string,message:o.message}),e.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),e.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:{startsWith:o.value},message:o.message}),e.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:{endsWith:o.value},message:o.message}),e.dirty()):o.kind==="datetime"?sb(o).test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:"datetime",message:o.message}),e.dirty()):o.kind==="date"?CU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:"date",message:o.message}),e.dirty()):o.kind==="time"?new RegExp(`^${ib(o)}$`).test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:X.invalid_string,validation:"time",message:o.message}),e.dirty()):o.kind==="duration"?pU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"duration",code:X.invalid_string,message:o.message}),e.dirty()):o.kind==="ip"?(s=t.data,((r=o.version)!=="v4"&&r||!mU.test(s))&&(r!=="v6"&&r||!wU.test(s))&&(i=this._getOrReturnCtx(t,i),et(i,{validation:"ip",code:X.invalid_string,message:o.message}),e.dirty())):o.kind==="jwt"?AU(t.data,o.alg)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"jwt",code:X.invalid_string,message:o.message}),e.dirty()):o.kind==="cidr"?SU(t.data,o.version)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cidr",code:X.invalid_string,message:o.message}),e.dirty()):o.kind==="base64"?bU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"base64",code:X.invalid_string,message:o.message}),e.dirty()):o.kind==="base64url"?yU.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"base64url",code:X.invalid_string,message:o.message}),e.dirty()):$t.assertNever(o);var s,r;return{status:e.value,value:t.data}}_regex(t,e,i){return this.refinement(s=>t.test(s),{validation:e,code:X.invalid_string,...ot.errToObj(i)})}_addCheck(t){return new bs({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...ot.errToObj(t)})}url(t){return this._addCheck({kind:"url",...ot.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...ot.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...ot.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...ot.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...ot.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...ot.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...ot.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...ot.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...ot.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...ot.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...ot.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...ot.errToObj(t)})}datetime(t){var e,i;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:(t==null?void 0:t.precision)===void 0?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0&&e,local:(i=t==null?void 0:t.local)!==null&&i!==void 0&&i,...ot.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:(t==null?void 0:t.precision)===void 0?null:t==null?void 0:t.precision,...ot.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...ot.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...ot.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e==null?void 0:e.position,...ot.errToObj(e==null?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...ot.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...ot.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...ot.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...ot.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...ot.errToObj(e)})}nonempty(t){return this.min(1,ot.errToObj(t))}trim(){return new bs({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bs({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bs({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}function TU(n,t){const e=(n.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,s=e>i?e:i;return parseInt(n.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}bs.create=n=>{var t;return new bs({checks:[],typeName:vt.ZodString,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0&&t,...Pt(n)})};class Kn extends Ft{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==it.number){const s=this._getOrReturnCtx(t);return et(s,{code:X.invalid_type,expected:it.number,received:s.parsedType}),xt}let e;const i=new vi;for(const s of this._def.checks)s.kind==="int"?$t.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:X.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?TU(t.data,s.value)!==0&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:X.not_finite,message:s.message}),i.dirty()):$t.assertNever(s);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,ot.toString(e))}gt(t,e){return this.setLimit("min",t,!1,ot.toString(e))}lte(t,e){return this.setLimit("max",t,!0,ot.toString(e))}lt(t,e){return this.setLimit("max",t,!1,ot.toString(e))}setLimit(t,e,i,s){return new Kn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:ot.toString(s)}]})}_addCheck(t){return new Kn({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:ot.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ot.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ot.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ot.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ot.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:ot.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:ot.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ot.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ot.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&$t.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(e===null||i.value>e)&&(e=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(e)&&Number.isFinite(t)}}Kn.create=n=>new Kn({checks:[],typeName:vt.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Pt(n)});class Jn extends Ft{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==it.bigint)return this._getInvalidInput(t);let e;const i=new vi;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),et(e,{code:X.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):$t.assertNever(s);return{status:i.value,value:t.data}}_getInvalidInput(t){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.bigint,received:e.parsedType}),xt}gte(t,e){return this.setLimit("min",t,!0,ot.toString(e))}gt(t,e){return this.setLimit("min",t,!1,ot.toString(e))}lte(t,e){return this.setLimit("max",t,!0,ot.toString(e))}lt(t,e){return this.setLimit("max",t,!1,ot.toString(e))}setLimit(t,e,i,s){return new Jn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:ot.toString(s)}]})}_addCheck(t){return new Jn({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ot.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ot.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ot.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ot.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:ot.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Jn.create=n=>{var t;return new Jn({checks:[],typeName:vt.ZodBigInt,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0&&t,...Pt(n)})};class Ja extends Ft{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==it.boolean){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.boolean,received:e.parsedType}),xt}return Pi(t.data)}}Ja.create=n=>new Ja({typeName:vt.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Pt(n)});class Br extends Ft{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==it.date){const s=this._getOrReturnCtx(t);return et(s,{code:X.invalid_type,expected:it.date,received:s.parsedType}),xt}if(isNaN(t.data.getTime()))return et(this._getOrReturnCtx(t),{code:X.invalid_date}),xt;const e=new vi;let i;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:X.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),e.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:X.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),e.dirty()):$t.assertNever(s);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Br({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:ot.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:ot.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}Br.create=n=>new Br({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:vt.ZodDate,...Pt(n)});class oc extends Ft{_parse(t){if(this._getType(t)!==it.symbol){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.symbol,received:e.parsedType}),xt}return Pi(t.data)}}oc.create=n=>new oc({typeName:vt.ZodSymbol,...Pt(n)});class tl extends Ft{_parse(t){if(this._getType(t)!==it.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.undefined,received:e.parsedType}),xt}return Pi(t.data)}}tl.create=n=>new tl({typeName:vt.ZodUndefined,...Pt(n)});class el extends Ft{_parse(t){if(this._getType(t)!==it.null){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.null,received:e.parsedType}),xt}return Pi(t.data)}}el.create=n=>new el({typeName:vt.ZodNull,...Pt(n)});class Bo extends Ft{constructor(){super(...arguments),this._any=!0}_parse(t){return Pi(t.data)}}Bo.create=n=>new Bo({typeName:vt.ZodAny,...Pt(n)});class Er extends Ft{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Pi(t.data)}}Er.create=n=>new Er({typeName:vt.ZodUnknown,...Pt(n)});class An extends Ft{_parse(t){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.never,received:e.parsedType}),xt}}An.create=n=>new An({typeName:vt.ZodNever,...Pt(n)});class ac extends Ft{_parse(t){if(this._getType(t)!==it.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.void,received:e.parsedType}),xt}return Pi(t.data)}}ac.create=n=>new ac({typeName:vt.ZodVoid,...Pt(n)});class Ts extends Ft{_parse(t){const{ctx:e,status:i}=this._processInputParams(t),s=this._def;if(e.parsedType!==it.array)return et(e,{code:X.invalid_type,expected:it.array,received:e.parsedType}),xt;if(s.exactLength!==null){const o=e.data.length>s.exactLength.value,l=e.data.length<s.exactLength.value;(o||l)&&(et(e,{code:o?X.too_big:X.too_small,minimum:l?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&e.data.length<s.minLength.value&&(et(e,{code:X.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&e.data.length>s.maxLength.value&&(et(e,{code:X.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),e.common.async)return Promise.all([...e.data].map((o,l)=>s.type._parseAsync(new $s(e,o,e.path,l)))).then(o=>vi.mergeArray(i,o));const r=[...e.data].map((o,l)=>s.type._parseSync(new $s(e,o,e.path,l)));return vi.mergeArray(i,r)}get element(){return this._def.type}min(t,e){return new Ts({...this._def,minLength:{value:t,message:ot.toString(e)}})}max(t,e){return new Ts({...this._def,maxLength:{value:t,message:ot.toString(e)}})}length(t,e){return new Ts({...this._def,exactLength:{value:t,message:ot.toString(e)}})}nonempty(t){return this.min(1,t)}}function ro(n){if(n instanceof be){const t={};for(const e in n.shape){const i=n.shape[e];t[e]=Gs.create(ro(i))}return new be({...n._def,shape:()=>t})}return n instanceof Ts?new Ts({...n._def,type:ro(n.element)}):n instanceof Gs?Gs.create(ro(n.unwrap())):n instanceof er?er.create(ro(n.unwrap())):n instanceof js?js.create(n.items.map(t=>ro(t))):n}Ts.create=(n,t)=>new Ts({type:n,minLength:null,maxLength:null,exactLength:null,typeName:vt.ZodArray,...Pt(t)});class be extends Ft{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=$t.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==it.object){const c=this._getOrReturnCtx(t);return et(c,{code:X.invalid_type,expected:it.object,received:c.parsedType}),xt}const{status:e,ctx:i}=this._processInputParams(t),{shape:s,keys:r}=this._getCached(),o=[];if(!(this._def.catchall instanceof An&&this._def.unknownKeys==="strip"))for(const c in i.data)r.includes(c)||o.push(c);const l=[];for(const c of r){const d=s[c],_=i.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new $s(i,_,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof An){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of o)l.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")o.length>0&&(et(i,{code:X.unrecognized_keys,keys:o}),e.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of o){const _=i.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new $s(i,_,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of l){const _=await d.key,f=await d.value;c.push({key:_,value:f,alwaysSet:d.alwaysSet})}return c}).then(c=>vi.mergeObjectSync(e,c)):vi.mergeObjectSync(e,l)}get shape(){return this._def.shape()}strict(t){return ot.errToObj,new be({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,i)=>{var s,r,o,l;const c=(o=(r=(s=this._def).errorMap)===null||r===void 0?void 0:r.call(s,e,i).message)!==null&&o!==void 0?o:i.defaultError;return e.code==="unrecognized_keys"?{message:(l=ot.errToObj(t).message)!==null&&l!==void 0?l:c}:{message:c}}}:{}})}strip(){return new be({...this._def,unknownKeys:"strip"})}passthrough(){return new be({...this._def,unknownKeys:"passthrough"})}extend(t){return new be({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new be({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:vt.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new be({...this._def,catchall:t})}pick(t){const e={};return $t.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(e[i]=this.shape[i])}),new be({...this._def,shape:()=>e})}omit(t){const e={};return $t.objectKeys(this.shape).forEach(i=>{t[i]||(e[i]=this.shape[i])}),new be({...this._def,shape:()=>e})}deepPartial(){return ro(this)}partial(t){const e={};return $t.objectKeys(this.shape).forEach(i=>{const s=this.shape[i];t&&!t[i]?e[i]=s:e[i]=s.optional()}),new be({...this._def,shape:()=>e})}required(t){const e={};return $t.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])e[i]=this.shape[i];else{let s=this.shape[i];for(;s instanceof Gs;)s=s._def.innerType;e[i]=s}}),new be({...this._def,shape:()=>e})}keyof(){return nb($t.objectKeys(this.shape))}}be.create=(n,t)=>new be({shape:()=>n,unknownKeys:"strip",catchall:An.create(),typeName:vt.ZodObject,...Pt(t)}),be.strictCreate=(n,t)=>new be({shape:()=>n,unknownKeys:"strict",catchall:An.create(),typeName:vt.ZodObject,...Pt(t)}),be.lazycreate=(n,t)=>new be({shape:n,unknownKeys:"strip",catchall:An.create(),typeName:vt.ZodObject,...Pt(t)});class il extends Ft{_parse(t){const{ctx:e}=this._processInputParams(t),i=this._def.options;if(e.common.async)return Promise.all(i.map(async s=>{const r={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:r}),ctx:r}})).then(function(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;const r=s.map(o=>new Zi(o.ctx.common.issues));return et(e,{code:X.invalid_union,unionErrors:r}),xt});{let s;const r=[];for(const l of i){const c={...e,common:{...e.common,issues:[]},parent:null},d=l._parseSync({data:e.data,path:e.path,parent:c});if(d.status==="valid")return d;d.status!=="dirty"||s||(s={result:d,ctx:c}),c.common.issues.length&&r.push(c.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;const o=r.map(l=>new Zi(l));return et(e,{code:X.invalid_union,unionErrors:o}),xt}}get options(){return this._def.options}}il.create=(n,t)=>new il({options:n,typeName:vt.ZodUnion,...Pt(t)});const Nn=n=>n instanceof nl?Nn(n.schema):n instanceof ys?Nn(n.innerType()):n instanceof rl?[n.value]:n instanceof tr?n.options:n instanceof ol?$t.objectValues(n.enum):n instanceof al?Nn(n._def.innerType):n instanceof tl?[void 0]:n instanceof el?[null]:n instanceof Gs?[void 0,...Nn(n.unwrap())]:n instanceof er?[null,...Nn(n.unwrap())]:n instanceof Kf||n instanceof hl?Nn(n.unwrap()):n instanceof ll?Nn(n._def.innerType):[];class Wc extends Ft{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.object)return et(e,{code:X.invalid_type,expected:it.object,received:e.parsedType}),xt;const i=this.discriminator,s=e.data[i],r=this.optionsMap.get(s);return r?e.common.async?r._parseAsync({data:e.data,path:e.path,parent:e}):r._parseSync({data:e.data,path:e.path,parent:e}):(et(e,{code:X.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),xt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,i){const s=new Map;for(const r of e){const o=Nn(r.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const l of o){if(s.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);s.set(l,r)}}return new Wc({typeName:vt.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:s,...Pt(i)})}}function f_(n,t){const e=dn(n),i=dn(t);if(n===t)return{valid:!0,data:n};if(e===it.object&&i===it.object){const s=$t.objectKeys(t),r=$t.objectKeys(n).filter(l=>s.indexOf(l)!==-1),o={...n,...t};for(const l of r){const c=f_(n[l],t[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}if(e===it.array&&i===it.array){if(n.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<n.length;r++){const o=f_(n[r],t[r]);if(!o.valid)return{valid:!1};s.push(o.data)}return{valid:!0,data:s}}return e===it.date&&i===it.date&&+n==+t?{valid:!0,data:n}:{valid:!1}}class sl extends Ft{_parse(t){const{status:e,ctx:i}=this._processInputParams(t),s=(r,o)=>{if(u_(r)||u_(o))return xt;const l=f_(r.value,o.value);return l.valid?((__(r)||__(o))&&e.dirty(),{status:e.value,value:l.data}):(et(i,{code:X.invalid_intersection_types}),xt)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([r,o])=>s(r,o)):s(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}sl.create=(n,t,e)=>new sl({left:n,right:t,typeName:vt.ZodIntersection,...Pt(e)});class js extends Ft{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.array)return et(i,{code:X.invalid_type,expected:it.array,received:i.parsedType}),xt;if(i.data.length<this._def.items.length)return et(i,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xt;!this._def.rest&&i.data.length>this._def.items.length&&(et(i,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const s=[...i.data].map((r,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new $s(i,r,i.path,o)):null}).filter(r=>!!r);return i.common.async?Promise.all(s).then(r=>vi.mergeArray(e,r)):vi.mergeArray(e,s)}get items(){return this._def.items}rest(t){return new js({...this._def,rest:t})}}js.create=(n,t)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new js({items:n,typeName:vt.ZodTuple,rest:null,...Pt(t)})};class Nc extends Ft{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.object)return et(i,{code:X.invalid_type,expected:it.object,received:i.parsedType}),xt;const s=[],r=this._def.keyType,o=this._def.valueType;for(const l in i.data)s.push({key:r._parse(new $s(i,l,i.path,l)),value:o._parse(new $s(i,i.data[l],i.path,l)),alwaysSet:l in i.data});return i.common.async?vi.mergeObjectAsync(e,s):vi.mergeObjectSync(e,s)}get element(){return this._def.valueType}static create(t,e,i){return new Nc(e instanceof Ft?{keyType:t,valueType:e,typeName:vt.ZodRecord,...Pt(i)}:{keyType:bs.create(),valueType:t,typeName:vt.ZodRecord,...Pt(e)})}}class lc extends Ft{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.map)return et(i,{code:X.invalid_type,expected:it.map,received:i.parsedType}),xt;const s=this._def.keyType,r=this._def.valueType,o=[...i.data.entries()].map(([l,c],d)=>({key:s._parse(new $s(i,l,i.path,[d,"key"])),value:r._parse(new $s(i,c,i.path,[d,"value"]))}));if(i.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,_=await c.value;if(d.status==="aborted"||_.status==="aborted")return xt;d.status!=="dirty"&&_.status!=="dirty"||e.dirty(),l.set(d.value,_.value)}return{status:e.value,value:l}})}{const l=new Map;for(const c of o){const d=c.key,_=c.value;if(d.status==="aborted"||_.status==="aborted")return xt;d.status!=="dirty"&&_.status!=="dirty"||e.dirty(),l.set(d.value,_.value)}return{status:e.value,value:l}}}}lc.create=(n,t,e)=>new lc({valueType:t,keyType:n,typeName:vt.ZodMap,...Pt(e)});class Or extends Ft{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.set)return et(i,{code:X.invalid_type,expected:it.set,received:i.parsedType}),xt;const s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(et(i,{code:X.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),e.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(et(i,{code:X.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),e.dirty());const r=this._def.valueType;function o(c){const d=new Set;for(const _ of c){if(_.status==="aborted")return xt;_.status==="dirty"&&e.dirty(),d.add(_.value)}return{status:e.value,value:d}}const l=[...i.data.values()].map((c,d)=>r._parse(new $s(i,c,i.path,d)));return i.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(t,e){return new Or({...this._def,minSize:{value:t,message:ot.toString(e)}})}max(t,e){return new Or({...this._def,maxSize:{value:t,message:ot.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}Or.create=(n,t)=>new Or({valueType:n,minSize:null,maxSize:null,typeName:vt.ZodSet,...Pt(t)});class wo extends Ft{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.function)return et(e,{code:X.invalid_type,expected:it.function,received:e.parsedType}),xt;function i(l,c){return sc({data:l,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,ic(),Fo].filter(d=>!!d),issueData:{code:X.invalid_arguments,argumentsError:c}})}function s(l,c){return sc({data:l,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,ic(),Fo].filter(d=>!!d),issueData:{code:X.invalid_return_type,returnTypeError:c}})}const r={errorMap:e.common.contextualErrorMap},o=e.data;if(this._def.returns instanceof Oo){const l=this;return Pi(async function(...c){const d=new Zi([]),_=await l._def.args.parseAsync(c,r).catch(g=>{throw d.addIssue(i(c,g)),d}),f=await Reflect.apply(o,this,_);return await l._def.returns._def.type.parseAsync(f,r).catch(g=>{throw d.addIssue(s(f,g)),d})})}{const l=this;return Pi(function(...c){const d=l._def.args.safeParse(c,r);if(!d.success)throw new Zi([i(c,d.error)]);const _=Reflect.apply(o,this,d.data),f=l._def.returns.safeParse(_,r);if(!f.success)throw new Zi([s(_,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new wo({...this._def,args:js.create(t).rest(Er.create())})}returns(t){return new wo({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,i){return new wo({args:t||js.create([]).rest(Er.create()),returns:e||Er.create(),typeName:vt.ZodFunction,...Pt(i)})}}class nl extends Ft{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}nl.create=(n,t)=>new nl({getter:n,typeName:vt.ZodLazy,...Pt(t)});class rl extends Ft{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return et(e,{received:e.data,code:X.invalid_literal,expected:this._def.value}),xt}return{status:"valid",value:t.data}}get value(){return this._def.value}}function nb(n,t){return new tr({values:n,typeName:vt.ZodEnum,...Pt(t)})}rl.create=(n,t)=>new rl({value:n,typeName:vt.ZodLiteral,...Pt(t)});class tr extends Ft{constructor(){super(...arguments),Sa.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),i=this._def.values;return et(e,{expected:$t.joinValues(i),received:e.parsedType,code:X.invalid_type}),xt}if(rc(this,Sa)||tb(this,Sa,new Set(this._def.values)),!rc(this,Sa).has(t.data)){const e=this._getOrReturnCtx(t),i=this._def.values;return et(e,{received:e.data,code:X.invalid_enum_value,options:i}),xt}return Pi(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return tr.create(t,{...this._def,...e})}exclude(t,e=this._def){return tr.create(this.options.filter(i=>!t.includes(i)),{...this._def,...e})}}Sa=new WeakMap,tr.create=nb;class ol extends Ft{constructor(){super(...arguments),Ta.set(this,void 0)}_parse(t){const e=$t.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==it.string&&i.parsedType!==it.number){const s=$t.objectValues(e);return et(i,{expected:$t.joinValues(s),received:i.parsedType,code:X.invalid_type}),xt}if(rc(this,Ta)||tb(this,Ta,new Set($t.getValidEnumValues(this._def.values))),!rc(this,Ta).has(t.data)){const s=$t.objectValues(e);return et(i,{received:i.data,code:X.invalid_enum_value,options:s}),xt}return Pi(t.data)}get enum(){return this._def.values}}Ta=new WeakMap,ol.create=(n,t)=>new ol({values:n,typeName:vt.ZodNativeEnum,...Pt(t)});class Oo extends Ft{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.promise&&e.common.async===!1)return et(e,{code:X.invalid_type,expected:it.promise,received:e.parsedType}),xt;const i=e.parsedType===it.promise?e.data:Promise.resolve(e.data);return Pi(i.then(s=>this._def.type.parseAsync(s,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Oo.create=(n,t)=>new Oo({type:n,typeName:vt.ZodPromise,...Pt(t)});class ys extends Ft{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===vt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:i}=this._processInputParams(t),s=this._def.effect||null,r={addIssue:o=>{et(i,o),o.fatal?e.abort():e.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const o=s.transform(i.data,r);if(i.common.async)return Promise.resolve(o).then(async l=>{if(e.value==="aborted")return xt;const c=await this._def.schema._parseAsync({data:l,path:i.path,parent:i});return c.status==="aborted"?xt:c.status==="dirty"||e.value==="dirty"?nc(c.value):c});{if(e.value==="aborted")return xt;const l=this._def.schema._parseSync({data:o,path:i.path,parent:i});return l.status==="aborted"?xt:l.status==="dirty"||e.value==="dirty"?nc(l.value):l}}if(s.type==="refinement"){const o=l=>{const c=s.refinement(l,r);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(i.common.async===!1){const l=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?xt:(l.status==="dirty"&&e.dirty(),o(l.value),{status:e.value,value:l.value})}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(l=>l.status==="aborted"?xt:(l.status==="dirty"&&e.dirty(),o(l.value).then(()=>({status:e.value,value:l.value}))))}if(s.type==="transform"){if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Fr(o))return o;const l=s.transform(o.value,r);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:l}}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>Fr(o)?Promise.resolve(s.transform(o.value,r)).then(l=>({status:e.value,value:l})):o)}$t.assertNever(s)}}ys.create=(n,t,e)=>new ys({schema:n,typeName:vt.ZodEffects,effect:t,...Pt(e)}),ys.createWithPreprocess=(n,t,e)=>new ys({schema:t,effect:{type:"preprocess",transform:n},typeName:vt.ZodEffects,...Pt(e)});class Gs extends Ft{_parse(t){return this._getType(t)===it.undefined?Pi(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Gs.create=(n,t)=>new Gs({innerType:n,typeName:vt.ZodOptional,...Pt(t)});class er extends Ft{_parse(t){return this._getType(t)===it.null?Pi(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}er.create=(n,t)=>new er({innerType:n,typeName:vt.ZodNullable,...Pt(t)});class al extends Ft{_parse(t){const{ctx:e}=this._processInputParams(t);let i=e.data;return e.parsedType===it.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}al.create=(n,t)=>new al({innerType:n,typeName:vt.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Pt(t)});class ll extends Ft{_parse(t){const{ctx:e}=this._processInputParams(t),i={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Ka(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Zi(i.common.issues)},input:i.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Zi(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}ll.create=(n,t)=>new ll({innerType:n,typeName:vt.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Pt(t)});class hc extends Ft{_parse(t){if(this._getType(t)!==it.nan){const e=this._getOrReturnCtx(t);return et(e,{code:X.invalid_type,expected:it.nan,received:e.parsedType}),xt}return{status:"valid",value:t.data}}}hc.create=n=>new hc({typeName:vt.ZodNaN,...Pt(n)});const EU=Symbol("zod_brand");class Kf extends Ft{_parse(t){const{ctx:e}=this._processInputParams(t),i=e.data;return this._def.type._parse({data:i,path:e.path,parent:e})}unwrap(){return this._def.type}}class Tl extends Ft{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?xt:s.status==="dirty"?(e.dirty(),nc(s.value)):this._def.out._parseAsync({data:s.value,path:i.path,parent:i})})();{const s=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?xt:s.status==="dirty"?(e.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:i.path,parent:i})}}static create(t,e){return new Tl({in:t,out:e,typeName:vt.ZodPipeline})}}class hl extends Ft{_parse(t){const e=this._def.innerType._parse(t),i=s=>(Fr(s)&&(s.value=Object.freeze(s.value)),s);return Ka(e)?e.then(s=>i(s)):i(e)}unwrap(){return this._def.innerType}}function Iv(n,t={},e){return n?Bo.create().superRefine((i,s)=>{var r,o;if(!n(i)){const l=typeof t=="function"?t(i):typeof t=="string"?{message:t}:t,c=(o=(r=l.fatal)!==null&&r!==void 0?r:e)===null||o===void 0||o,d=typeof l=="string"?{message:l}:l;s.addIssue({code:"custom",...d,fatal:c})}}):Bo.create()}hl.create=(n,t)=>new hl({innerType:n,typeName:vt.ZodReadonly,...Pt(t)});const PU={object:be.lazycreate};var vt;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(vt||(vt={}));const Rv=bs.create,Mv=Kn.create,kU=hc.create,IU=Jn.create,Dv=Ja.create,RU=Br.create,MU=oc.create,DU=tl.create,LU=el.create,FU=Bo.create,BU=Er.create,OU=An.create,UU=ac.create,zU=Ts.create,HU=be.create,WU=be.strictCreate,NU=il.create,GU=Wc.create,$U=sl.create,jU=js.create,qU=Nc.create,VU=lc.create,XU=Or.create,ZU=wo.create,YU=nl.create,QU=rl.create,KU=tr.create,JU=ol.create,tz=Oo.create,Lv=ys.create,ez=Gs.create,iz=er.create,sz=ys.createWithPreprocess,nz=Tl.create,rz={string:n=>bs.create({...n,coerce:!0}),number:n=>Kn.create({...n,coerce:!0}),boolean:n=>Ja.create({...n,coerce:!0}),bigint:n=>Jn.create({...n,coerce:!0}),date:n=>Br.create({...n,coerce:!0})},oz=xt;var k=Object.freeze({__proto__:null,defaultErrorMap:Fo,setErrorMap:function(n){Jx=n},getErrorMap:ic,makeIssue:sc,EMPTY_PATH:[],addIssueToContext:et,ParseStatus:vi,INVALID:xt,DIRTY:nc,OK:Pi,isAborted:u_,isDirty:__,isValid:Fr,isAsync:Ka,get util(){return $t},get objectUtil(){return d_},ZodParsedType:it,getParsedType:dn,ZodType:Ft,datetimeRegex:sb,ZodString:bs,ZodNumber:Kn,ZodBigInt:Jn,ZodBoolean:Ja,ZodDate:Br,ZodSymbol:oc,ZodUndefined:tl,ZodNull:el,ZodAny:Bo,ZodUnknown:Er,ZodNever:An,ZodVoid:ac,ZodArray:Ts,ZodObject:be,ZodUnion:il,ZodDiscriminatedUnion:Wc,ZodIntersection:sl,ZodTuple:js,ZodRecord:Nc,ZodMap:lc,ZodSet:Or,ZodFunction:wo,ZodLazy:nl,ZodLiteral:rl,ZodEnum:tr,ZodNativeEnum:ol,ZodPromise:Oo,ZodEffects:ys,ZodTransformer:ys,ZodOptional:Gs,ZodNullable:er,ZodDefault:al,ZodCatch:ll,ZodNaN:hc,BRAND:EU,ZodBranded:Kf,ZodPipeline:Tl,ZodReadonly:hl,custom:Iv,Schema:Ft,ZodSchema:Ft,late:PU,get ZodFirstPartyTypeKind(){return vt},coerce:rz,any:FU,array:zU,bigint:IU,boolean:Dv,date:RU,discriminatedUnion:GU,effect:Lv,enum:KU,function:ZU,instanceof:(n,t={message:`Input not instance of ${n.name}`})=>Iv(e=>e instanceof n,t),intersection:$U,lazy:YU,literal:QU,map:VU,nan:kU,nativeEnum:JU,never:OU,null:LU,nullable:iz,number:Mv,object:HU,oboolean:()=>Dv().optional(),onumber:()=>Mv().optional(),optional:ez,ostring:()=>Rv().optional(),pipeline:nz,preprocess:sz,promise:tz,record:qU,set:XU,strictObject:WU,string:Rv,symbol:MU,transformer:Lv,tuple:jU,undefined:DU,union:NU,unknown:BU,void:UU,NEVER:oz,ZodIssueCode:X,quotelessJson:n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Zi});const Uo=k.object({h:k.number(),tilesetUid:k.number(),w:k.number(),x:k.number(),y:k.number()}),xo=k.tuple([k.number(),k.number()]),rb=k.object({__identifier:k.string(),__tile:Uo.nullable(),__type:k.string(),__value:k.any(),defUid:k.number()}),Fv=k.object({a:k.number(),f:k.number(),px:xo,src:xo,t:k.number()}),ob=k.object({__grid:xo,__identifier:k.string(),__pivot:xo,__smartColor:k.string(),__tags:k.array(k.string()),__tile:Uo.nullable(),__worldX:k.number().nullable(),__worldY:k.number().nullable(),defUid:k.number(),fieldInstances:k.array(rb),height:k.number(),iid:k.string(),px:xo,width:k.number()}),ab=k.object({__cHei:k.number(),__cWid:k.number(),__gridSize:k.number(),__identifier:k.string(),__opacity:k.number(),__pxTotalOffsetX:k.number(),__pxTotalOffsetY:k.number(),__tilesetDefUid:k.number().nullable(),__tilesetRelPath:k.string().nullable(),__type:k.union([k.literal("IntGrid"),k.literal("Entities"),k.literal("Tiles"),k.literal("AutoLayer")]),autoLayerTiles:k.array(Fv),entityInstances:k.array(ob),gridTiles:k.array(Fv),iid:k.string(),intGridCsv:k.array(k.number()),layerDefUid:k.number(),levelId:k.number(),overrideTilesetUid:k.number().nullable(),pxOffsetX:k.number(),pxOffsetY:k.number(),visible:k.boolean()}),Gc=k.object({__bgColor:k.string().nullable(),bgColor:k.string().nullable(),__bgPos:k.object({cropRect:k.array(k.tuple([k.number(),k.number(),k.number(),k.number()])),scale:k.tuple([k.number(),k.number()]),topLeftPx:xo}).nullable(),__neighbours:k.array(k.object({dir:k.union([k.literal("n"),k.literal("s"),k.literal("w"),k.literal("e"),k.literal("ne"),k.literal("nw"),k.literal("se"),k.literal("sw"),k.literal("o"),k.literal("<"),k.literal(">")]),levelIid:k.string()})),bgRelPath:k.string().nullable(),externalRelPath:k.string().nullable(),fieldInstances:k.array(rb),identifier:k.string(),iid:k.string(),layerInstances:k.array(ab).nullable(),pxHei:k.number(),pxWid:k.number(),uid:k.number(),worldDepth:k.number(),worldX:k.number(),worldY:k.number()}),az=k.object({identifier:k.string(),iid:k.string(),levels:k.array(Gc),worldGridHeight:k.number(),worldGridWidth:k.number(),worldLayout:k.union([k.literal("Free"),k.literal("GridVania"),k.literal("LinearHorizontal"),k.literal("LinearVertical")])}),lz=k.object({color:k.number(),id:k.string(),tileRect:Uo.nullable()}),hz=k.object({externalRelPath:k.string().nullable(),iconTilesetUid:k.number().nullable(),identifier:k.string(),tags:k.array(k.string()),uid:k.number(),values:k.array(lz)}),cz=k.object({__cHei:k.number(),__cWid:k.number(),customData:k.array(k.object({data:k.string(),tileId:k.number()})),embedAtlas:k.string().nullable(),enumTags:k.optional(k.array(k.object({enumValueId:k.string(),tileIds:k.array(k.number())}))),identifier:k.string(),padding:k.number(),pxHei:k.number(),pxWid:k.number(),relPath:k.string().nullable(),spacing:k.number(),tags:k.array(k.string()),tagsSourceEnumUid:k.number().nullable(),tileGridSize:k.number(),uid:k.number()}),lb=k.object({__type:k.union([k.literal("IntGrid"),k.literal("Entities"),k.literal("Tiles"),k.literal("AutoLayer")]),autoSourceLayerDefUid:k.number().nullable(),displayOpacity:k.number(),gridSize:k.number(),identifier:k.string(),intGridValues:k.array(k.object({color:k.string(),groupUid:k.number(),identifier:k.string().nullable(),tile:Uo.nullable(),value:k.number()})),intGridValuesGroups:k.array(k.object({color:k.string().nullable(),identifier:k.string().nullable(),uid:k.number()})),parallaxFactorX:k.number(),parallaxFactorY:k.number(),parallaxScaling:k.boolean(),pxOffsetX:k.number(),pxOffsetY:k.number(),tilesetDefUid:k.number().nullable(),uid:k.number()}),hb=k.object({color:k.string(),height:k.number(),identifier:k.string(),nineSliceBorders:k.array(k.number()),pivotX:k.number(),pivotY:k.number(),tileRect:Uo.nullable(),tileRenderMode:k.union([k.literal("Cover"),k.literal("FitInside"),k.literal("Repeat"),k.literal("Stretch"),k.literal("FullSizeCropped"),k.literal("FullSizeUncropped"),k.literal("NineSlice")]),tilesetId:k.number().nullable(),uiTileRect:Uo.nullable(),uid:k.number(),width:k.number()}),dz=k.object({tilesets:k.array(cz),enums:k.array(hz),layers:k.array(lb),entities:k.array(hb)}),cb=k.object({iid:k.string(),bgColor:k.string().nullable(),defs:dz,externalLevels:k.boolean(),jsonVersion:k.string(),levels:k.array(Gc),toc:k.array(k.object({identifier:k.string(),instancesData:k.array(k.object({fields:k.any(),heiPx:k.number(),iids:k.string(),widPix:k.number(),worldX:k.number(),worldY:k.number()}))})),worldGridHeight:k.number().nullable(),worldGridWidth:k.number().nullable(),worldLayout:k.union([k.literal("Free"),k.literal("GridVania"),k.literal("LinearHorizontal"),k.literal("LinearVertical")]).nullable(),worlds:k.array(az)}),uz=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Bv=n=>{if(typeof n!="string")throw new TypeError("Invalid argument expected string");const t=n.match(uz);if(!t)throw new Error(`Invalid argument not valid semver ('${n}' received)`);return t.shift(),t},Ov=n=>n==="*"||n==="x"||n==="X",Uv=n=>{const t=parseInt(n,10);return isNaN(t)?n:t},_z=(n,t)=>{if(Ov(n)||Ov(t))return 0;const[e,i]=((s,r)=>typeof s!=typeof r?[String(s),String(r)]:[s,r])(Uv(n),Uv(t));return e>i?1:e<i?-1:0},zv=(n,t)=>{for(let e=0;e<Math.max(n.length,t.length);e++){const i=_z(n[e]||"0",t[e]||"0");if(i!==0)return i}return 0},fz=(n,t,e)=>{pz(e);const i=((s,r)=>{const o=Bv(s),l=Bv(r),c=o.pop(),d=l.pop(),_=zv(o,l);return _!==0?_:c&&d?zv(c.split("."),d.split(".")):c||d?c?-1:1:0})(n,t);return db[e].includes(i)},db={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},Hv=Object.keys(db),pz=n=>{if(Hv.indexOf(n)===-1)throw new Error(`Invalid operator, expected one of ${Hv.join("|")}`)};class cc{constructor(t){this.type=t,this._loaded=!1,this.cache=new Map}getOrAdd(...t){let e=this.cache.get(t.join("+"));return e||(e=new this.type(...t),this.cache.set(t.join("+"),e),e)}values(){if(this._loaded)return Array.from(this.cache.values());throw new Error("Read through cache not yet loaded! No values to return!")}async load(){const t=Array.from(this.cache.entries()),e=await Promise.allSettled(t.map(s=>s[1].load()));let i=0;for(let s=0;s<e.length;s++){const r=e[s];r.status==="rejected"&&(console.error(`Error loading resource at ${t[s][0]}, is your pathMap correct? or your LDtk map corrupted?`,r.reason),i++)}if(i)throw new Error(`Error loading ${i} resources`);this._loaded=!0}}class dc{constructor(t,e,i,s){var r,o;if(this.ldtkLayer=e,this.resource=i,this.order=s,this.entities=[],this.ldtkToEntity=new Map,this.entityToLdtk=new Map,this.worldPos=(0,he.vec)(t.ldtkLevel.worldX,t.ldtkLevel.worldY),this.offset=(0,he.vec)(e.__pxTotalOffsetX,e.__pxTotalOffsetY),e.entityInstances)for(let l of e.entityInstances){const c=i.projectMetadata.defs.entities.find(d=>d.identifier===l.__identifier);if(i.factories.has(l.__identifier)){const d=i.factories.get(l.__identifier);if(d){const _=d({type:l.__identifier,worldPos:(0,he.vec)(l.px[0],l.px[1]).add(this.worldPos.add(this.offset)),entity:l,definition:c,layer:this});_&&(this.entities.push(_),this.ldtkToEntity.set(l,_),this.entityToLdtk.set(_,l))}}else{const d=new he.Actor({name:l.__identifier,pos:(0,he.vec)(l.px[0],l.px[1]).add(this.worldPos.add(this.offset)),width:l.width,height:l.height,anchor:(0,he.vec)((r=c==null?void 0:c.pivotX)!==null&&r!==void 0?r:0,(o=c==null?void 0:c.pivotY)!==null&&o!==void 0?o:0),z:s});if(l.__tile){const _=i.tilesets.get(l.__tile.tilesetUid);if(_){const f=Math.floor(l.__tile.x/l.__tile.w),g=Math.floor(l.__tile.y/l.__tile.h),m=_.spritesheet.getSprite(f,g);m&&d.graphics.use(m)}}this.entities.push(d),this.ldtkToEntity.set(l,d),this.entityToLdtk.set(d,l)}}}runFactories(){for(let t of this.ldtkLayer.entityInstances){const e=this.resource.factories.get(t.__identifier);if(!e)continue;const i=this.resource.projectMetadata.defs.entities.find(r=>r.identifier===t.__identifier),s=e({type:t.__identifier,worldPos:(0,he.vec)(t.px[0],t.px[1]).add(this.worldPos.add(this.offset)),entity:t,definition:i,layer:this});if(s){const r=this.ldtkToEntity.get(t);if(r){const o=this.entities.indexOf(r);o>-1&&(this.entities.splice(o,1),this.ldtkToEntity.delete(t),this.entityToLdtk.delete(r))}this.entities.push(s),this.ldtkToEntity.set(t,s),this.entityToLdtk.set(s,t)}}}getEntitiesByIdentifier(t){const e=this.getLdtkEntitiesByIdentifier(t);let i=[];for(const s of e){const r=this.ldtkToEntity.get(s);r&&i.push(r)}return i}getEntitiesByField(t,e){const i=this.getLdtkEntitiesByField(t,e);let s=[];for(const r of i){const o=this.ldtkToEntity.get(r);o&&s.push(o)}return s}getLdtkEntitiesByIdentifier(t){return this.ldtkLayer.entityInstances.filter(e=>e.__identifier.toLocaleLowerCase()===t.toLowerCase())}getLdtkEntitiesByField(t,e){return this.ldtkLayer.entityInstances.filter(i=>{if(e!==void 0){let s=e;typeof e=="string"&&(s=e.toLocaleLowerCase());const r=i.fieldInstances.find(o=>o.__identifier.toLocaleLowerCase()===t.toLocaleLowerCase());return!!r&&r.__value===s}return!!i.fieldInstances.find(s=>s.__identifier.toLocaleLowerCase()===t.toLocaleLowerCase())})}}class Da{constructor(t,e,i,s){var r,o,l,c;if(this.order=s,this.worldPos=(0,he.vec)(t.ldtkLevel.worldX,t.ldtkLevel.worldY),this.offset=(0,he.vec)(e.__pxTotalOffsetX,e.__pxTotalOffsetY),this.ldtkLayer=e,e.intGridCsv.length||e.autoLayerTiles.length){const d=e.__cHei,_=e.__cWid;this.tilemap=new he.TileMap({name:e.__identifier,pos:this.worldPos.add(this.offset),tileWidth:e.__gridSize,tileHeight:e.__gridSize,rows:d,columns:_}),this.tilemap.z=s,this.tilemap.get(he.GraphicsComponent).isVisible=e.visible;const f=i.projectMetadata.defs.layers.find(g=>e.__identifier===g.identifier);if(f){const g=f.intGridValues.find(m=>{var x;return((x=m==null?void 0:m.identifier)===null||x===void 0?void 0:x.toLocaleLowerCase())==="solid"});for(let m=0;m<e.intGridCsv.length;m++){const x=m%_,C=Math.floor(m/_),T=this.tilemap.getTile(x,C);g&&e.intGridCsv[m]===g.value&&(T.solid=!0),g||e.intGridCsv[m]!==1||(T.solid=!0)}if(e.__tilesetDefUid){this.tileset=i.tilesets.get(e.__tilesetDefUid);for(let m=0;m<e.autoLayerTiles.length;m++){const x=e.autoLayerTiles[m],C=Math.floor(x.px[0]/e.__gridSize),T=Math.floor(x.px[1]/e.__gridSize),A=this.tilemap.getTile(C,T);if(A&&this.tileset){const S=Math.floor((x.src[0]-((r=this.tileset.ldtkTileset.padding)!==null&&r!==void 0?r:0))/(this.tileset.ldtkTileset.tileGridSize+((o=this.tileset.ldtkTileset.spacing)!==null&&o!==void 0?o:0))),E=Math.floor((x.src[1]-((l=this.tileset.ldtkTileset.padding)!==null&&l!==void 0?l:0))/(this.tileset.ldtkTileset.tileGridSize+((c=this.tileset.ldtkTileset.spacing)!==null&&c!==void 0?c:0))),M=!!(1&x.f),O=!!(2&x.f);let N=this.tileset.spritesheet.getSprite(S,E);(M||O)&&(N=N.clone(),N.flipHorizontal=M,N.flipVertical=O),N?A.addGraphic(N):console.error("Could not find sprite in LDtk spritesheet at",S,E)}}}}}}}class Jf{constructor(t,e){var i,s,r,o;if(this.ldtkLevel=t,this.resource=e,this.layers=[],t.__bgColor&&(this.backgroundColor=he.Color.fromHex(t.__bgColor)),t.layerInstances){let l=e.startZIndex,c=t.layerInstances.slice().reverse();for(let d of c)((i=d.entityInstances)===null||i===void 0?void 0:i.length)!==0&&this.layers.push(new dc(this,d,e,l)),((s=d.gridTiles)===null||s===void 0?void 0:s.length)!==0&&this.layers.push(new Ma(this,d,e,l)),((r=d.intGridCsv)===null||r===void 0?void 0:r.length)===0&&((o=d.autoLayerTiles)===null||o===void 0?void 0:o.length)===0||this.layers.push(new Da(this,d,e,l)),l++}}}class ub{constructor(t,e,i){this.path=t,this.resource=e,this.fileLoader=Qf,this.strict=!0,this.headless=!1;const{headless:s,strict:r,fileLoader:o,imageLoader:l,pathMap:c}={...i};this.fileLoader=o??this.fileLoader,this.strict=r??this.strict,this.headless=s??this.headless,this.imageLoader=l??new cc(he.ImageSource),this.pathMap=c??this.pathMap}async load(){const t=await this.fileLoader(this.path,"json");let e;if(this.strict)try{e=Gc.parse(t)}catch(i){throw console.error(`Could not parse LDtk level data at ${this.path} are you sure a level is there and not corrupt?`),i}else e=t;return this.data=new Jf(e,this.resource)}isLoaded(){return!!this.data}}class _b{constructor(t){var e,i,s,r;const{image:o,ldtkTileset:l}=t;this.image=o,this.ldtkTileset=l,this.spritesheet=he.SpriteSheet.fromImageSource({image:o,grid:{rows:l.pxHei/l.tileGridSize,columns:l.pxWid/l.tileGridSize,spriteHeight:l.tileGridSize,spriteWidth:l.tileGridSize},spacing:{margin:{x:(e=l.spacing)!==null&&e!==void 0?e:0,y:(i=l.spacing)!==null&&i!==void 0?i:0},originOffset:{x:(s=l.padding)!==null&&s!==void 0?s:0,y:(r=l.padding)!==null&&r!==void 0?r:0}}})}}class cl{constructor(t,e){this.path=t,this.tilesets=new Map,this.levels=new Map,this.levelsByName=new Map,this.factories=new Map,this.fileLoader=Qf,this._imageLoader=new cc(he.ImageSource),this._levelLoader=new cc(ub),this.startZIndex=0,this.textQuality=4,this.useExcaliburWiring=!0,this.useMapBackgroundColor=!1,this.useTilemapCameraStrategy=!1,this.headless=!1,this.strict=!0;const{useExcaliburWiring:i,useTilemapCameraStrategy:s,entityIdentifierFactories:r,pathMap:o,useMapBackgroundColor:l,fileLoader:c,strict:d,headless:_,startZIndex:f}={...e};this.strict=d??this.strict,this.headless=_??this.headless,this.useExcaliburWiring=i??this.useExcaliburWiring,this.useTilemapCameraStrategy=s??this.useTilemapCameraStrategy,this.useMapBackgroundColor=l??this.useMapBackgroundColor,this.startZIndex=f??this.startZIndex,this.fileLoader=c??this.fileLoader,this.pathMap=o;for(const g in r)this.registerEntityIdentifierFactory(g,r[g])}async load(){var t;const e=await this.fileLoader(this.path,"json");if(this.strict)try{this.projectMetadata=cb.parse(e)}catch(i){throw console.error(`Could not parse LDtk map from location ${this.path}.
Excalibur only supports the latest version of LDtk formats as of the plugin's release.`),console.error("Is your map file corrupted or being interpreted as the wrong type?"),i}else this.projectMetadata=e;fz(cl.supportedLdtkVersion,(t=this.projectMetadata.jsonVersion)!==null&&t!==void 0?t:"0.0.0",">")&&console.warn(`The excalibur ldtk plugin officially supports ${cl.supportedLdtkVersion}+, the current map has LDtk version ${this.projectMetadata.jsonVersion}`);for(let i of this.projectMetadata.defs.tilesets)if(i.relPath){const s=c_(this.path,i.relPath,this.pathMap),r=this._imageLoader.getOrAdd(s),o=new _b({image:r,ldtkTileset:i});this.tilesets.set(i.uid,o)}else i.identifier!=="Internal_Icons"&&console.warn(`No tileset image provided for ${i.identifier}`);for(let i of this.projectMetadata.levels)if(i.externalRelPath){const s=c_(this.path,i.externalRelPath,this.pathMap);this._levelLoader.getOrAdd(s,this,{headless:this.headless,strict:this.strict,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}else{const s=new Jf(i,this);this.levels.set(i.uid,s),this.levelsByName.set(i.identifier.toLowerCase(),s)}return await Promise.all([this._imageLoader.load(),this._levelLoader.load()]),this._levelLoader.values().forEach(i=>{this.levels.set(i.data.ldtkLevel.uid,i.data),this.levelsByName.set(i.data.ldtkLevel.identifier.toLowerCase(),i.data)}),this.data=this.projectMetadata}isLoaded(){return!!this.data}registerEntityIdentifierFactory(t,e){this.factories.set(t,e)}registerEntityIdentifierFactories(t){for(const e in t)this.registerEntityIdentifierFactory(e,t[e])}getLevel(t){return this.levelsByName.get(t.toLowerCase())}getEntityLayers(t){let e=[];if(t){const i=this.getLevel(t);if(i)for(let s of i.layers)s instanceof dc&&e.push(s)}else for(const i of this.levels.values())for(let s of i.layers)s instanceof dc&&e.push(s);return e}getTileLayers(t){let e=[];if(t){const i=this.getLevel(t);if(i)for(let s of i.layers)s instanceof Ma&&e.push(s)}else for(const i of this.levels.values())for(let s of i.layers)s instanceof Ma&&e.push(s);return e}getIntGridLayers(t){let e=[];if(t){const i=this.getLevel(t);if(i)for(let s of i.layers)s instanceof Da&&e.push(s)}else for(const i of this.levels.values())for(let s of i.layers)s instanceof Da&&e.push(s);return e}getLdtkEntitiesByIdentifier(t,e){let i=[];const s=e??Array.from(this.levels.values()).map(r=>r.ldtkLevel.identifier);for(const r of s){const o=this.getEntityLayers(r);for(let l of o)i=i.concat(l.getLdtkEntitiesByIdentifier(t))}return i}getLdtkEntitiesByField(t,e,i){let s=[];const r=i??Array.from(this.levels.values()).map(o=>o.ldtkLevel.identifier);for(const o of r){const l=this.getEntityLayers(o);for(let c of l)s=s.concat(c.getLdtkEntitiesByField(t,e))}return s}getEntitiesByIdentifier(t,e){let i=[];const s=e??Array.from(this.levels.values()).map(r=>r.ldtkLevel.identifier);for(const r of s){const o=this.getEntityLayers(r);for(let l of o)i=i.concat(l.getEntitiesByIdentifier(t))}return i}getEntitiesByField(t,e,i){let s=[];const r=i??Array.from(this.levels.values()).map(o=>o.ldtkLevel.identifier);for(const o of r){const l=this.getEntityLayers(o);for(let c of l)s=s.concat(c.getEntitiesByField(t,e))}return s}getLevelBounds(t){t=t??Array.from(this.levelsByName.keys());let e=null;for(const i of this.levels.values()){if(!t.includes(i.ldtkLevel.identifier))continue;const s=this.getTileLayers(i.ldtkLevel.identifier)[0];if(s){const r=he.BoundingBox.fromDimension(s.tilemap.tileWidth*s.tilemap.columns,s.tilemap.tileHeight*s.tilemap.rows,he.Vector.Zero,s.tilemap.pos);e=e?e.combine(r):r}}return e??new he.BoundingBox}addToScene(t,e){var i,s;const{pos:r,useLevelOffsets:o}={pos:(0,he.vec)(0,0),useLevelOffsets:!0,...e};for(let[l,c]of this.levels.entries())if(!(!((i=e==null?void 0:e.levelFilter)===null||i===void 0)&&i.length)||e.levelFilter.includes(c.ldtkLevel.identifier))for(let d of c.layers)if(d instanceof Ma||d instanceof Da)d.tilemap.pos=d.tilemap.pos.add(r),o||(d.tilemap.pos=d.tilemap.pos.sub(d.worldPos)),t.add(d.tilemap);else{d.runFactories();for(let _ of d.entities){const f=_.get(he.TransformComponent);f&&(f.pos=f.pos.add(r),o||(f.pos=f.pos.sub(d.worldPos))),t.add(_)}}if(this.useExcaliburWiring){const l=this.getLdtkEntitiesByField("camera",!0)[0];if(l){t.camera.pos=(0,he.vec)(l.px[0],l.px[0]);const c=l.fieldInstances.find(d=>d.__identifier.toLocaleLowerCase()==="zoom");c&&(t.camera.zoom=+c.__value)}}if(this.useTilemapCameraStrategy){let l=this.getLevelBounds(e==null?void 0:e.levelFilter);t.camera.strategy.limitCameraBounds(l)}if(this.useMapBackgroundColor){for(let[l,c]of this.levels.entries())if(!(!((s=e==null?void 0:e.levelFilter)===null||s===void 0)&&s.length)||e.levelFilter.includes(c.ldtkLevel.identifier)){t.backgroundColor=c.backgroundColor;break}}}}cl.supportedLdtkVersion="1.5.3";We.dd;We.UZ;We.NN;We.e1;We.a8;We.u6;We.oK;We.U_;We.sn;var gz=We.GY;We.$t;We.RI;We._k;We.eZ;We.pf;We.N5;We.qD;We.hu;We.Uk;const Ah=23283064365386963e-26;class tp{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*Ah,t=t*69069+1>>>0,this._s1=t*Ah,t=t*69069+1>>>0,this._s2=t*Ah,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*Ah;return this._s0=this._s1,this._s1=this._s2,this._c=t|0,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),s=Math.min(t,e);return Math.floor(this.getUniform()*(i-s+1))+s}getNormal(t=0,e=1){let i,s,r;do i=2*this.getUniform()-1,s=2*this.getUniform()-1,r=i*i+s*s;while(r>1||r==0);let o=i*Math.sqrt(-2*Math.log(r)/r);return t+o*e}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let s=i.indexOf(this.getItem(i));e.push(i.splice(s,1)[0])}return e}getWeightedValue(t){let e=0;for(let o in t)e+=t[o];let i=this.getUniform()*e,s,r=0;for(s in t)if(r+=t[s],i<r)return s;return s}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return new tp().setState(this.getState())}}const _t=new tp().setSeed(Date.now());class mz{getContainer(){return null}setOptions(t){this._options=t}}class vz extends mz{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const i=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=i,this._updateSize(),this._ctx.font=i,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const t=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=t}eventToPosition(t,e){let i=this._ctx.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}class ep extends vz{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){ep.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let[e,i,s,r,o]=t,l=""+s+r+o,c;if(l in this._canvasCache)c=this._canvasCache[l];else{let d=this._options.border;c=document.createElement("canvas");let _=c.getContext("2d");if(c.width=this._spacingX,c.height=this._spacingY,_.fillStyle=o,_.fillRect(d,d,c.width-d,c.height-d),s){_.fillStyle=r,_.font=this._ctx.font,_.textAlign="center",_.textBaseline="middle";let f=[].concat(s);for(let g=0;g<f.length;g++)_.fillText(f[g],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[l]=c}this._ctx.drawImage(c,e*this._spacingX,i*this._spacingY)}_drawNoCache(t,e){let[i,s,r,o,l]=t;if(e){let d=this._options.border;this._ctx.fillStyle=l,this._ctx.fillRect(i*this._spacingX+d,s*this._spacingY+d,this._spacingX-d,this._spacingY-d)}if(!r)return;this._ctx.fillStyle=o;let c=[].concat(r);for(let d=0;d<c.length;d++)this._ctx.fillText(c[d],(i+.5)*this._spacingX,Math.ceil((s+.5)*this._spacingY))}computeSize(t,e){let i=Math.floor(t/this._spacingX),s=Math.floor(e/this._spacingY);return[i,s]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),s=Math.floor(e/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let c=o/100*s/i;return c>1&&(s=Math.floor(s/c)),Math.floor(s/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}ep.cache=!1;let wz=80,xz=25;const un={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]};let Wr=class{constructor(t=wz,e=xz){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let s=0;s<this._height;s++)e[i].push(t)}return e}};class bz extends Wr{create(t){let e=this._width-1,i=this._height-1;for(let s=0;s<=e;s++)for(let r=0;r<=i;r++){let o=s&&r&&s<e&&r<i;t(s,r,o?0:1)}return this}}class fb extends Wr{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class pb{}class uc extends pb{constructor(t,e,i,s,r,o){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=s,this._doors={},r!==void 0&&o!==void 0&&this.addDoor(r,o)}static createRandomAt(t,e,i,s,r){let o=r.roomWidth[0],l=r.roomWidth[1],c=_t.getUniformInt(o,l);o=r.roomHeight[0],l=r.roomHeight[1];let d=_t.getUniformInt(o,l);if(i==1){let _=e-Math.floor(_t.getUniform()*d);return new this(t+1,_,t+c,_+d-1,t,e)}if(i==-1){let _=e-Math.floor(_t.getUniform()*d);return new this(t-c,_,t-1,_+d-1,t,e)}if(s==1){let _=t-Math.floor(_t.getUniform()*c);return new this(_,e+1,_+c-1,e+d,t,e)}if(s==-1){let _=t-Math.floor(_t.getUniform()*c);return new this(_,e-d,_+c-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let s=i.roomWidth[0],r=i.roomWidth[1],o=_t.getUniformInt(s,r);s=i.roomHeight[0],r=i.roomHeight[1];let l=_t.getUniformInt(s,r),c=t-Math.floor(_t.getUniform()*o),d=e-Math.floor(_t.getUniform()*l),_=c+o-1,f=d+l-1;return new this(c,d,_,f)}static createRandom(t,e,i){let s=i.roomWidth[0],r=i.roomWidth[1],o=_t.getUniformInt(s,r);s=i.roomHeight[0],r=i.roomHeight[1];let l=_t.getUniformInt(s,r),c=t-o-1,d=e-l-1,_=1+Math.floor(_t.getUniform()*c),f=1+Math.floor(_t.getUniform()*d),g=_+o-1,m=f+l-1;return new this(_,f,g,m)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,r=this._y2+1;for(let o=e;o<=i;o++)for(let l=s;l<=r;l++)o!=e&&o!=i&&l!=s&&l!=r||t(o,l)||this.addDoor(o,l);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,s=this._x2+1,r=this._y1-1,o=this._y2+1;for(let l=i;l<=s;l++)for(let c=r;c<=o;c++)if(l==i||l==s||c==r||c==o){if(!t(l,c))return!1}else if(!e(l,c))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,s=this._y1-1,r=this._y2+1,o=0;for(let l=e;l<=i;l++)for(let c=s;c<=r;c++)l+","+c in this._doors?o=2:l==e||l==i||c==s||c==r?o=1:o=0,t(l,c,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class ip extends pb{constructor(t,e,i,s){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=s,this._endsWithAWall=!0}static createRandomAt(t,e,i,s,r){let o=r.corridorLength[0],l=r.corridorLength[1],c=_t.getUniformInt(o,l);return new this(t,e,t+i*c,e+s*c)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,s=this._startY,r=this._endX-i,o=this._endY-s,l=1+Math.max(Math.abs(r),Math.abs(o));r&&(r=r/Math.abs(r)),o&&(o=o/Math.abs(o));let c=o,d=-r,_=!0;for(let m=0;m<l;m++){let x=i+m*r,C=s+m*o;if(e(x,C)||(_=!1),t(x+c,C+d)||(_=!1),t(x-c,C-d)||(_=!1),!_){l=m,this._endX=x-r,this._endY=C-o;break}}if(l==0||l==1&&t(this._endX+r,this._endY+o))return!1;let f=!t(this._endX+r+c,this._endY+o+d),g=!t(this._endX+r-c,this._endY+o-d);return this._endsWithAWall=t(this._endX+r,this._endY+o),!((f||g)&&this._endsWithAWall)}create(t){let e=this._startX,i=this._startY,s=this._endX-e,r=this._endY-i,o=1+Math.max(Math.abs(s),Math.abs(r));s&&(s=s/Math.abs(s)),r&&(r=r/Math.abs(r));for(let l=0;l<o;l++){let c=e+l*s,d=i+l*r;t(c,d,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,s=this._endX-e,r=this._endY-i;s&&(s=s/Math.abs(s)),r&&(r=r/Math.abs(r));let o=r,l=-s;t(this._endX+s,this._endY+r),t(this._endX+o,this._endY+l),t(this._endX-o,this._endY-l)}}class yz extends fb{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let i=0;i<this._width;i++)for(let s=0;s<this._height;s++)t(i,s,this._map[i][s]);return this}_generateRooms(){let t=this._width-2,e=this._height-2,i;do if(i=this._generateRoom(),this._dug/(t*e)>this._options.roomDugPercentage)break;while(i)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=uc.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let e=0;e<this._rooms.length;e++){let i=this._rooms[e];i.clearDoors(),i.create(this._digCallback)}for(this._unconnected=_t.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let e=_t.getItem(this._connected);if(!e)break;let i=this._closestRoom(this._unconnected,e);if(!i)break;let s=this._closestRoom(this._connected,i);if(!s||!this._connectRooms(i,s))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,s=e.getCenter(),r=null;for(let o=0;o<t.length;o++){let l=t[o],c=l.getCenter(),d=c[0]-s[0],_=c[1]-s[1],f=d*d+_*_;f<i&&(i=f,r=l)}return r}_connectRooms(t,e){let i=t.getCenter(),s=e.getCenter(),r=s[0]-i[0],o=s[1]-i[1],l,c,d,_,f,g,m;if(Math.abs(r)<Math.abs(o)?(d=o>0?2:0,_=(d+2)%4,f=e.getLeft(),g=e.getRight(),m=0):(d=r>0?1:3,_=(d+2)%4,f=e.getTop(),g=e.getBottom(),m=1),l=this._placeInWall(t,d),!l)return!1;if(l[m]>=f&&l[m]<=g){c=l.slice();let x=0;switch(_){case 0:x=e.getTop()-1;break;case 1:x=e.getRight()+1;break;case 2:x=e.getBottom()+1;break;case 3:x=e.getLeft()-1;break}c[(m+1)%2]=x,this._digLine([l,c])}else if(l[m]<f-1||l[m]>g+1){let x=l[m]-s[m],C=0;switch(_){case 0:case 1:C=x<0?3:1;break;case 2:case 3:C=x<0?1:3;break}if(_=(_+C)%4,c=this._placeInWall(e,_),!c)return!1;let T=[0,0];T[m]=l[m];let A=(m+1)%2;T[A]=c[A],this._digLine([l,T,c])}else{let x=(m+1)%2;if(c=this._placeInWall(e,_),!c)return!1;let C=Math.round((c[x]+l[x])/2),T=[0,0],A=[0,0];T[m]=l[m],T[x]=C,A[m]=c[m],A[x]=C,this._digLine([l,T,A,c])}return t.addDoor(l[0],l[1]),e.addDoor(c[0],c[1]),m=this._unconnected.indexOf(t),m!=-1&&(this._unconnected.splice(m,1),this._connected.push(t)),m=this._unconnected.indexOf(e),m!=-1&&(this._unconnected.splice(m,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],s=[0,0],r=0;switch(e){case 0:s=[1,0],i=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:s=[0,1],i=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:s=[1,0],i=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:s=[0,1],i=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1;break}let o=[],l=-2;for(let c=0;c<r;c++){let d=i[0]+c*s[0],_=i[1]+c*s[1];o.push(null),this._map[d][_]==1?l!=c-1&&(o[c]=[d,_]):(l=c,c&&(o[c-1]=null))}for(let c=o.length-1;c>=0;c--)o[c]||o.splice(c,1);return o.length?_t.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],s=t[e],r=new ip(i[0],i[1],s[0],s[1]);r.create(this._digCallback),this._corridors.push(r)}}_digCallback(t,e,i){this._map[t][e]=i,i==0&&this._dug++}_isWallCallback(t,e){return t<0||e<0||t>=this._width||e>=this._height?!1:this._map[t][e]==1}_canBeDugCallback(t,e){return t<1||e<1||t+1>=this._width||e+1>=this._height?!1:this._map[t][e]==1}}class Cz extends Wr{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=un[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=_t.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,s=this._options.survive;for(let r=0;r<this._height;r++){let o=1,l=0;this._options.topology==6&&(o=2,l=r%2);for(let c=l;c<this._width;c+=o){let d=this._map[c][r],_=this._getNeighbors(c,r);(d&&s.indexOf(_)!=-1||!d&&i.indexOf(_)!=-1)&&(e[c][r]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,s=0;this._options.topology==6&&(i=2,s=e%2);for(let r=s;r<this._width;r+=i)t(r,e,this._map[r][e])}}_getNeighbors(t,e){let i=0;for(let s=0;s<this._dirs.length;s++){let r=this._dirs[s],o=t+r[0],l=e+r[1];o<0||o>=this._width||l<0||l>=this._height||(i+=this._map[o][l]==1?1:0)}return i}connect(t,e,i){e||(e=0);let s=[],r={},o=1,l=[0,0];this._options.topology==6&&(o=2,l=[0,1]);for(let f=0;f<this._height;f++)for(let g=l[f%2];g<this._width;g+=o)if(this._freeSpace(g,f,e)){let m=[g,f];r[this._pointKey(m)]=m,s.push([g,f])}let c=s[_t.getUniformInt(0,s.length-1)],d=this._pointKey(c),_={};for(_[d]=c,delete r[d],this._findConnected(_,r,[c],!1,e);Object.keys(r).length>0;){let f=this._getFromTo(_,r),g=f[0],m=f[1],x={};x[this._pointKey(g)]=g,this._findConnected(x,r,[g],!0,e),(this._options.topology==6?this._tunnelToConnected6:this._tunnelToConnected).call(this,m,g,_,r,e,i);for(let T in x){let A=x[T];this._map[A[0]][A[1]]=e,_[T]=A,delete r[T]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i=[0,0],s=[0,0],r,o=Object.keys(t),l=Object.keys(e);for(let c=0;c<5;c++){if(o.length<l.length){let d=o;s=t[d[_t.getUniformInt(0,d.length-1)]],i=this._getClosest(s,e)}else{let d=l;i=e[d[_t.getUniformInt(0,d.length-1)]],s=this._getClosest(i,t)}if(r=(i[0]-s[0])*(i[0]-s[0])+(i[1]-s[1])*(i[1]-s[1]),r<64)break}return[i,s]}_getClosest(t,e){let i=null,s=null;for(let r in e){let o=e[r],l=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(s==null||l<s)&&(s=l,i=o)}return i}_findConnected(t,e,i,s,r){for(;i.length>0;){let o=i.splice(0,1)[0],l;this._options.topology==6?l=[[o[0]+2,o[1]],[o[0]+1,o[1]-1],[o[0]-1,o[1]-1],[o[0]-2,o[1]],[o[0]-1,o[1]+1],[o[0]+1,o[1]+1]]:l=[[o[0]+1,o[1]],[o[0]-1,o[1]],[o[0],o[1]+1],[o[0],o[1]-1]];for(let c=0;c<l.length;c++){let d=this._pointKey(l[c]);t[d]==null&&this._freeSpace(l[c][0],l[c][1],r)&&(t[d]=l[c],s||delete e[d],i.push(l[c]))}}}_tunnelToConnected(t,e,i,s,r,o){let l,c;e[0]<t[0]?(l=e,c=t):(l=t,c=e);for(let _=l[0];_<=c[0];_++){this._map[_][l[1]]=r;let f=[_,l[1]],g=this._pointKey(f);i[g]=f,delete s[g]}o&&l[0]<c[0]&&o(l,[c[0],l[1]]);let d=c[0];e[1]<t[1]?(l=e,c=t):(l=t,c=e);for(let _=l[1];_<c[1];_++){this._map[d][_]=r;let f=[d,_],g=this._pointKey(f);i[g]=f,delete s[g]}o&&l[1]<c[1]&&o([c[0],l[1]],[c[0],c[1]])}_tunnelToConnected6(t,e,i,s,r,o){let l,c;e[0]<t[0]?(l=e,c=t):(l=t,c=e);let d=l[0],_=l[1];for(;!(d==c[0]&&_==c[1]);){let f=2;_<c[1]?(_++,f=1):_>c[1]&&(_--,f=1),d<c[0]?d+=f:d>c[0]||c[1]%2?d-=f:d+=f,this._map[d][_]=r;let g=[d,_],m=this._pointKey(g);i[m]=g,delete s[m]}o&&o(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}}const Az={room:uc,corridor:ip};class Sz extends fb{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i=Date.now(),s;do{if(s=0,Date.now()-i>this._options.timeLimit)break;let o=this._findWall();if(!o)break;let l=o.split(","),c=parseInt(l[0]),d=parseInt(l[1]),_=this._getDiggingDirection(c,d);if(!_)continue;let f=0;do if(f++,this._tryFeature(c,d,_[0],_[1])){this._removeSurroundingWalls(c,d),this._removeSurroundingWalls(c-_[0],d-_[1]);break}while(f<this._featureAttempts);for(let g in this._walls)this._walls[g]>1&&s++}while(this._dug/e<this._options.dugPercentage||s);if(this._addDoors(),t)for(let r=0;r<this._width;r++)for(let o=0;o<this._height;o++)t(r,o,this._map[r][o]);return this._walls={},this._map=[],this}_digCallback(t,e,i){i==0||i==2?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return t<0||e<0||t>=this._width||e>=this._height?!1:this._map[t][e]==1}_canBeDugCallback(t,e){return t<1||e<1||t+1>=this._width||e+1>=this._height?!1:this._map[t][e]==1}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=uc.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let r in this._walls)this._walls[r]==2?e.push(r):t.push(r);let i=e.length?e:t;if(!i.length)return null;let s=_t.getItem(i.sort());return delete this._walls[s],s}_tryFeature(t,e,i,s){let r=_t.getWeightedValue(this._features),l=Az[r].createRandomAt(t,e,i,s,this._options);return l.isValid(this._isWallCallback,this._canBeDugCallback)?(l.create(this._digCallback),l instanceof uc&&this._rooms.push(l),l instanceof ip&&(l.createPriorityWalls(this._priorityWallCallback),this._corridors.push(l)),!0):!1}_removeSurroundingWalls(t,e){let i=un[4];for(let s=0;s<i.length;s++){let r=i[s],o=t+r[0],l=e+r[1];delete this._walls[o+","+l],o=t+2*r[0],l=e+2*r[1],delete this._walls[o+","+l]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,s=un[4];for(let r=0;r<s.length;r++){let o=s[r],l=t+o[0],c=e+o[1];if(!this._map[l][c]){if(i)return null;i=o}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(i,s){return t[i][s]==1}for(let i=0;i<this._rooms.length;i++){let s=this._rooms[i];s.clearDoors(),s.addDoors(e)}}}function Wv(n,t,e){e[t[n+1]]=e[n],t[e[n]]=t[n+1],e[n]=n+1,t[n+1]=n}function Nv(n,t,e){e[t[n]]=e[n],t[e[n]]=t[n],e[n]=n,t[n]=n}class Tz extends Wr{create(t){let e=this._fillMap(1),i=Math.ceil((this._width-2)/2),s=9/24,r=[],o=[];for(let c=0;c<i;c++)r.push(c),o.push(c);r.push(i-1);let l;for(l=1;l+3<this._height;l+=2)for(let c=0;c<i;c++){let d=2*c+1,_=l;e[d][_]=0,c!=r[c+1]&&_t.getUniform()>s&&(Wv(c,r,o),e[d+1][_]=0),c!=r[c]&&_t.getUniform()>s?Nv(c,r,o):e[d][_+1]=0}for(let c=0;c<i;c++){let d=2*c+1,_=l;e[d][_]=0,c!=r[c+1]&&(c==r[c]||_t.getUniform()>s)&&(Wv(c,r,o),e[d+1][_]=0),Nv(c,r,o)}for(let c=0;c<this._width;c++)for(let d=0;d<this._height;d++)t(c,d,e[c][d]);return this}}class Ez extends Wr{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let s=0;s<e;s++){this._map.push([]);for(let r=0;r<i;r++){let o=s==0||r==0||s+1==e||r+1==i;this._map[s].push(o?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let s=0;s<e;s++)for(let r=0;r<i;r++)t(s,r,this._map[s][r]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let d=t[0]+1;d<t[2];d++){let _=this._map[d][t[1]-1],f=this._map[d][t[3]+1];_&&f&&!(d%2)&&e.push(d)}for(let d=t[1]+1;d<t[3];d++){let _=this._map[t[0]-1][d],f=this._map[t[2]+1][d];_&&f&&!(d%2)&&i.push(d)}if(!e.length||!i.length)return;let s=_t.getItem(e),r=_t.getItem(i);this._map[s][r]=1;let o=[],l=[];o.push(l);for(let d=t[0];d<s;d++)this._map[d][r]=1,d%2&&l.push([d,r]);l=[],o.push(l);for(let d=s+1;d<=t[2];d++)this._map[d][r]=1,d%2&&l.push([d,r]);l=[],o.push(l);for(let d=t[1];d<r;d++)this._map[s][d]=1,d%2&&l.push([s,d]);l=[],o.push(l);for(let d=r+1;d<=t[3];d++)this._map[s][d]=1,d%2&&l.push([s,d]);let c=_t.getItem(o);for(let d=0;d<o.length;d++){let _=o[d];if(_==c)continue;let f=_t.getItem(_);this._map[f[0]][f[1]]=0}this._stack.push([t[0],t[1],s-1,r-1]),this._stack.push([s+1,t[1],t[2],r-1]),this._stack.push([t[0],r+1,s-1,t[3]]),this._stack.push([s+1,r+1,t[2],t[3]])}}class Pz extends Wr{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,s=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let r=0,o=0,l=0,c=0,d=0,_=!1,f=[[0,0],[0,0],[0,0],[0,0]];do if(r=1+2*Math.floor(_t.getUniform()*(e-1)/2),o=1+2*Math.floor(_t.getUniform()*(i-1)/2),d||(s[r][o]=0),!s[r][o]){this._randomize(f);do{Math.floor(_t.getUniform()*(this._regularity+1))==0&&this._randomize(f),_=!0;for(let g=0;g<4;g++)if(l=r+f[g][0]*2,c=o+f[g][1]*2,this._isFree(s,l,c,e,i)){s[l][c]=0,s[r+f[g][0]][o+f[g][1]]=0,r=l,o=c,_=!1,d++;break}}while(!_)}while(d+1<e*i/4);for(let g=0;g<this._width;g++)for(let m=0;m<this._height;m++)t(g,m,s[g][m]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(_t.getUniform()*4)){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1;break}}_isFree(t,e,i,s,r){return e<1||i<1||e>=s||i>=r?!1:t[e][i]}}class kz extends Wr{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],i=Object.assign({cellWidth:3,cellHeight:3},i),i.hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),s=Math.floor(t/e*.25);return s<2&&(s=2),i<2&&(i=2),[s,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t=_t.getUniformInt(0,this._options.cellWidth-1),e=_t.getUniformInt(0,this._options.cellHeight-1),i,s,r,o=!1,l,c,d;do{d=[0,2,4,6],d=_t.shuffle(d);do if(o=!1,i=d.pop(),s=t+un[8][i][0],r=e+un[8][i][1],!(s<0||s>=this._options.cellWidth)&&!(r<0||r>=this._options.cellHeight)){if(l=this.rooms[t][e],l.connections.length>0&&l.connections[0][0]==s&&l.connections[0][1]==r)break;c=this.rooms[s][r],c.connections.length==0&&(c.connections.push([t,e]),this.connectedCells.push([s,r]),t=s,e=r,o=!0)}while(d.length>0&&o==!1)}while(d.length>0)}_connectUnconnectedRooms(){let t=this._options.cellWidth,e=this._options.cellHeight;this.connectedCells=_t.shuffle(this.connectedCells);let i,s,r;for(let o=0;o<this._options.cellWidth;o++)for(let l=0;l<this._options.cellHeight;l++)if(i=this.rooms[o][l],i.connections.length==0){let c=[0,2,4,6];c=_t.shuffle(c),r=!1;do{let d=c.pop(),_=o+un[8][d][0],f=l+un[8][d][1];if(!(_<0||_>=t||f<0||f>=e)){if(s=this.rooms[_][f],r=!0,s.connections.length==0)break;for(let g=0;g<s.connections.length;g++)if(s.connections[g][0]==o&&s.connections[g][1]==l){r=!1;break}if(r)break}}while(c.length);r?i.connections.push([s.cellx,s.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t=this._width,e=this._height,i=this._options.cellWidth,s=this._options.cellHeight,r=Math.floor(this._width/i),o=Math.floor(this._height/s),l,c,d=this._options.roomWidth,_=this._options.roomHeight,f,g,m;for(let x=0;x<i;x++)for(let C=0;C<s;C++){if(f=r*x,g=o*C,f==0&&(f=1),g==0&&(g=1),l=_t.getUniformInt(d[0],d[1]),c=_t.getUniformInt(_[0],_[1]),C>0)for(m=this.rooms[x][C-1];g-(m.y+m.height)<3;)g++;if(x>0)for(m=this.rooms[x-1][C];f-(m.x+m.width)<3;)f++;let T=Math.round(_t.getUniformInt(0,r-l)/2),A=Math.round(_t.getUniformInt(0,o-c)/2);for(;f+T+l>=t;)T?T--:l--;for(;g+A+c>=e;)A?A--:c--;f=f+T,g=g+A,this.rooms[x][C].x=f,this.rooms[x][C].y=g,this.rooms[x][C].width=l,this.rooms[x][C].height=c;for(let S=f;S<f+l;S++)for(let E=g;E<g+c;E++)this.map[S][E]=0}}_getWallPosition(t,e){let i,s,r;return e==1||e==3?(i=_t.getUniformInt(t.x+1,t.x+t.width-2),e==1?(s=t.y-2,r=s+1):(s=t.y+t.height+1,r=s-1),this.map[i][r]=0):(s=_t.getUniformInt(t.y+1,t.y+t.height-2),e==2?(i=t.x+t.width+1,r=i-1):(i=t.x-2,r=i+1),this.map[r][s]=0),[i,s]}_drawCorridor(t,e){let i=e[0]-t[0],s=e[1]-t[1],r=t[0],o=t[1],l,c,d,_,f=[],g=Math.abs(i),m=Math.abs(s),x=_t.getUniform(),C=x,T=1-x;for(c=i>0?2:6,d=s>0?4:0,g<m?(l=Math.ceil(m*C),f.push([d,l]),f.push([c,g]),l=Math.floor(m*T),f.push([d,l])):(l=Math.ceil(g*C),f.push([c,l]),f.push([d,m]),l=Math.floor(g*T),f.push([c,l])),this.map[r][o]=0;f.length>0;)for(_=f.pop();_[1]>0;)r+=un[8][_[0]][0],o+=un[8][_[0]][1],this.map[r][o]=0,_[1]=_[1]-1}_createCorridors(){let t=this._options.cellWidth,e=this._options.cellHeight,i,s,r,o,l;for(let c=0;c<t;c++)for(let d=0;d<e;d++){i=this.rooms[c][d];for(let _=0;_<i.connections.length;_++)s=i.connections[_],r=this.rooms[s[0]][s[1]],r.cellx>i.cellx?(o=2,l=4):r.cellx<i.cellx?(o=4,l=2):r.celly>i.celly?(o=3,l=1):(o=1,l=3),this._drawCorridor(this._getWallPosition(i,o),this._getWallPosition(r,l))}}}const Iz={Arena:bz,Uniform:yz,Cellular:Cz,Digger:Sz,EllerMaze:Tz,DividedMaze:Ez,IceyMaze:Pz,Rogue:kz},gb="/roke/assets/vsm0-CgGz3BuH.ldtk";function Rz(n,t,e,i,s,r){const o=[];function l(c,d){return c<0||c>=e||d<0||d>=i?1:n[d*e+c]}for(let c=0;c<i;c++)for(let d=0;d<e;d++)for(const _ of t)if(_.active)for(const f of _.rules){if(!f.active)continue;let g=!0;for(let m=0;m<f.size;m++){for(let x=0;x<f.size;x++){const C=f.pattern[m*f.size+x],T=l(d+(x-Math.floor(f.size/2)),c+m-Math.floor(f.size/2));if(C==-1&&T==1||C==1&&T==0){g=!1;break}}if(!g)break}if(g){const m=f.tileRectsIds[0],x=d*s,C=c*s;o.push({px:[x,C],src:[r.sprites[m].sourceView.x,r.sprites[m].sourceView.y],f:0,t:m,d:[d,c],a:1});break}}return o}async function Mz(n,t,e,i,s){const l=(await(await fetch(gb)).json()).defs.layers[0].autoRuleGroups;return Rz(n,l,t,e,i,s)}class Dz extends gz{constructor(t,e){super(t,e)}async retile(t=0){const e=this.getIntGridLayers()[0].tilemap,i=this.getIntGridLayers()[0].tileset;window.tileset=i;const s=e.columns,r=e.rows;_t.setSeed(t);const o=new Iz.Uniform(s,r),l=[];function c(f,g,m){e.tiles[f+g*s].solid=m,l[f+g*s]=m?1:0}o.create(c);const d=this.getIntGridLayers()[0].ldtkLayer;this.openSides(o,c);const _=await Mz(l,e.columns,e.rows,e.tileWidth,i.spritesheet);if(e.tiles.forEach(f=>{f.clearGraphics()}),d.__tilesetDefUid){const f=this.tilesets.get(d.__tilesetDefUid);for(let g=0;g<_.length;g++){const m=_[g],x=Math.floor(m.px[0]/d.__gridSize),C=Math.floor(m.px[1]/d.__gridSize),T=e.getTile(x,C);if(T&&f){const A=Math.floor((m.src[0]-(f.ldtkTileset.padding??0))/(f.ldtkTileset.tileGridSize+(f.ldtkTileset.spacing??0))),S=Math.floor((m.src[1]-(f.ldtkTileset.padding??0))/(f.ldtkTileset.tileGridSize+(f.ldtkTileset.spacing??0))),E=!!(m.f&1),M=!!(m.f&2);let O=f.spritesheet.getSprite(A,S);(E||M)&&(O=O.clone(),O.flipHorizontal=E,O.flipVertical=M),O?T.addGraphic(O):console.error("Could not find sprite in LDtk spritesheet at",A,S)}}}return o}openSides(t,e){const i=t.getRooms();i.sort((o,l)=>o.getLeft()<l.getLeft()?-1:1);const s=i[0],r=i[i.length-1];for(let o=s.getLeft();o>=0;o--)e(o,s.getBottom(),0);for(let o=r.getRight();o<t._width;o++)e(o,r.getBottom(),0)}}const mb="/roke/assets/obj_Idle000-i9pCXwgB.png",p_="/roke/assets/obj_Idle001-BRPWzyy5.png",g_="/roke/assets/obj_Idle002-Ctd3xmyQ.png",vb="/roke/assets/obj_Idle003-Bgcq_I2t.png",wb="/roke/assets/obj_Walk000-CsY9yx1v.png",xb="/roke/assets/obj_Walk001-DxlVFu8s.png",bb="/roke/assets/obj_Walk002-DZrJYcyT.png",yb="/roke/assets/obj_Walk003-C0ulW498.png",Cb="/roke/assets/obj_Walk004-BY9D8wIO.png",Ab="/roke/assets/obj_Walk005-CbI1zowy.png",Sb="/roke/assets/obj_Walk006-GQW229K6.png",Tb="/roke/assets/obj_Walk007-ALBjbHaj.png",Eb="/roke/assets/obj_Run000-DgiSq-9B.png",Pb="/roke/assets/obj_Run001-9jJOcIuM.png",kb="/roke/assets/obj_Run002-PIw5APUp.png",Ib="/roke/assets/obj_Run003-DzI5jIj0.png",Rb="/roke/assets/obj_Run004-D4NS3tiI.png",Mb="/roke/assets/obj_Run005-eRZAf4eN.png",Db="/roke/assets/obj_Run006-BFLwEGbS.png",Lb="/roke/assets/obj_Run007-D5C_OUBF.png",Fb="/roke/assets/obj_Flying000-C0v0O6eR.png",Bb="/roke/assets/obj_Flying001-DaKuWiBU.png",Ob="/roke/assets/coins-CySCqBf3.png",Ub="/roke/assets/portalsSpriteSheet-DCDMImtw.png",zb="/roke/assets/Cavernas_by_Adam_Saltsman-CDCGIlrX.png",Hb="/roke/assets/scifi_platformTiles_32x32-Bkxv9-UB.png",Lz="/roke/assets/Level_0-CjkPGMIJ.ldtkl",Wb="/roke/assets/10-CAUTu1f7.png",Fz="/roke/assets/elemental-magic-spell-impact-outgoing-228342-6EDxYMfj.mp3",m_=new Dz(gb,{pathMap:[{path:"vsm0/Level_0.ldtk",output:Lz},{path:"Cavernas_by_Adam_Saltsman.png",output:zb},{path:"scifi_platformTiles_32x32.png",output:Hb}]}),sp={enter:new lx(Fz)},Nb=[mb,p_,g_,vb,wb,xb,bb,yb,Cb,Ab,Sb,Tb,Eb,Pb,kb,Ib,Rb,Mb,Db,Lb,Fb,Bb,zb,Wb,Hb,Ob,Ub].map(n=>new Df(n));function Nr(n){return Nb.find(t=>t.path===n)}const $c=100,Bz=new zs({frames:[mb,p_,g_,vb,g_,p_].map(n=>({graphic:Nr(n).toSprite(),duration:$c}))}),Oz=new zs({frames:[wb,xb,bb,yb,Cb,Ab,Sb,Tb].map(n=>({graphic:Nr(n).toSprite(),duration:$c}))}),Uz=new zs({frames:[Eb,Pb,kb,Ib,Rb,Mb,Db,Lb].map(n=>({graphic:Nr(n).toSprite(),duration:$c}))}),Gv=new zs({frames:[Fb,Bb].map(n=>({graphic:Nr(n).toSprite(),duration:$c}))}),zz=Fc.fromImageSource({image:Nr(Ob),grid:{rows:1,columns:8,spriteWidth:16,spriteHeight:16}}),Sh=Fc.fromImageSource({image:Nr(Ub),grid:{rows:4,columns:4,spriteWidth:32,spriteHeight:48}});zs.fromSpriteSheet(zz,lo(0,7),200);const Hz=[zs.fromSpriteSheet(Sh,lo(0,3),100),zs.fromSpriteSheet(Sh,lo(4,7),100),zs.fromSpriteSheet(Sh,lo(8,11),100),zs.fromSpriteSheet(Sh,lo(12,15),100)];Nr(Wb).toSprite();const Wz=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function Nz(){typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"&&(alert("El soporte de sensor de movimiento es experimental. Debes otorgar permiso para activar."),DeviceMotionEvent.requestPermission().then(n=>{console.log("Permission status:",n)}).catch(console.error))}const Gb=[{level:"Level 0",name:"The Lobby",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:null,entrances:["The Frontrooms","Level 283"],entities:["Bacteria"],exits:["Level 1","Level 27","Level -12","Level -0","The Basement"]},{level:"Level 0.1",name:"Zenith Station",class:"0",class_details:"Safe, Secure, Devoid of Entities",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0","Level 1"]},{level:"Level 0.2",name:"Remodeled Mess",class:"3",class_details:"Unsafe, Secure, Low Entity Count",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0"]},{level:"Level 0.3",name:"The Icy Rooms",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0"]},{level:"Level 1",name:"Habitable Zone",class:1,class_details:"Safe, Secure, Minimal Entity Count",bases:["M.E.G.","B.N.T.G.","Tom's Diner"],entities:["Smilers","Skin-Stealers","Hounds","Dullers","Facelings"],entrances:["Level 0","Level 11.1","Level 92","Level 94"],exits:["Level 2","Level 19","Level Fun"]},{level:"Level 1.1",name:"Corrupted Corridor",class:"Variable",class_varible:["0","2","4","Deadzone","N/A"],class_details:"Varied Safety, Unsecured, Varied Entity Count",class_details_variable:["Safe, Secure, Devoid of Enetities","Unsafe, Secure, Low Entity Count","Unsafe, Unsecure, Medium Entity Count","Environmental Hazards, Strictly Uninhabitable, Potential for Anomalous Entities","Existence Unconfirmed, Likely Inaccessible, Unfit for Life"],bases:["M.E.G.","The Tunnel Gang","Outpost 1","Outpost 2","Outpost 3","Jakob's Hut","Outpost 4"],entities:["Smilers","Hounds","Skin-Stealers"],entrances:["level 1"],exits:["Level 1"]},{level:"Level 1.3",name:"Malignance",class:"0",class_details:"Safe, Secure, Devoid of Entities",bases:["The Ward"],entities:[null],entrances:[null],exits:[null]},{level:"Level 2",name:null,class:"Sigma",class_details:"Unreliable Files, Non-Euclidean Space, Unidentified Entities",bases:[null],entities:["The eternal nature of numbers"],entrances:["Level 81"],exits:["Level 1"]},{level:"Level 2",name:"Pipe Dreams",class:"3",class_details:"Unsafe, Unsecure, Low Entity Count",bases:["Followers of Jerry","M.E.G.","B.N.T.G."],entities:["Windows","Smilers","Deathmoths","Clumps","Jerry","Hounds","Facelings","Skin-Stealers","Wretches","Nguithr'xurhs","Deathrats","Cannibal Cuisines","Wranglers","Photoshop","Growlers","Swindlebirds"],entrances:["The Frontrooms","Level 1","Level 55","Level 287","Level 2.2","Level 8","Level 11","Level 43","Level 84","Level 127","Level 141","Level 158","Level 173","Level 309","Level 480","Level 522","Level 997"],exits:["Level 3","Level 4","Level 31","Level 127","Level 137","Level 70","Level 283","Level 101","Level 126","Level 141","Level 175","Level 997","Level 811","Level 998","The Hub","Level 606","Level 38","Level 64","Level 127","Level 158","Level 902","Level 189"]},{level:"Level 2.2",name:"Constant Buzz",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:[""],entities:["Phantom Bees","Smilers","Howlers","Lighters","Deathrats"],entrances:["Level 3"],exits:["Level 2","Level 3","Level 98"]},{level:" ",name:"Office Space EL3A",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:["B.N.T.G."],entities:["Smilers","Hounds","Skin-Stealers","Photoshop"],entrances:["Level 2"],exits:["Level 2"]},{level:"Level 3",name:"Electrical Station",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:["M.E.G.","B.N.T.G.","Followers of Jerry","The Masked Maidens","U.E.C."],entities:["Hounds","Facelings","Wretches","Deathmoths","Skin-Stealers","Dullers","Smilers","Clumps","Bursters","Crawler Fungus"],entrances:["Level 2","Level 4","Level 5","Level 10","Level 11","Level 13","The Metro"],exits:["Level 4","Level 5","Level 31","Level 69"]},{level:"Level 4",name:"Abandoned Office",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:["M.E.G.","Amor Incrementum","T.B.D"],entities:["Hounds","Dullers"],entrances:["Level 3","The Hub","Level 2","Level 283"],exits:["Level 5","Level 6","Level 3","Level 71"]},{level:"Level 5",name:"Terror Hotel",class:"2",class_details:"Unsafe, Secure, Low Entity Count",bases:["M.E.G.","Homely Hotel","The Originals","The Lost Hall Society"],entities:["Deathmoths","Hounds","Woodlins","Skin-Stealers","Watchers","Nguithr'xurhs","Growlers","Deathrats","Wranglers","Samantha","Ants"],entrances:["Level 4","Level 3","Level 19","Level 126","Level 54","Level 10","Level 82","Level 92","Level 4.2"],exits:["Level 6","Level 3","Level 4","Level 9","Level 63","Level 98","Level 427","Level 40","Level 78","Level 84","Level 171"]},{level:"Level 6",name:"Lights Out",class:"Pending",class_details:"Safety Undetermined, Unsecured, Presence of Enetities Undetermined",bases:["The World's Quietest Room","Mimicry"],entities:[null],entrances:["Level 5","Level 4"],exits:["Level 7","Level 129","Level 6.1"]},{level:"Level 7",name:"Talassophobia",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:["Fort Surrender"],entities:["Tiny","The Thing On Level 7"],entrances:["Level 6","Level 8"],exits:["Level 8","Level 83","Level 9","Level 880"]},{level:"Level 8",name:"Cave System",class:"5",class_details:"Unsafe, Unsecure, Entity Infestation",bases:["M.E.G.","The Town of Kavragost"],entities:["Smilers","Skin-Stealers","Wretches","Camo Crawlers","Transporters","Deathmoths","Facelings","Hens","Hounds","Deathrats","Paralies","Clumps","Reviooks","Wranglers","Crawlers","Wranglers","Windows","Stalkers"],entrances:["Level 7","Level 103","Level 64","Level 135","Level 52","Level 283"],exits:["Level 9","Level 75","Level 2","Level 7","Level 91","Level 93","Level 205","Level 104","Level 69"]},{level:"",name:"",class:"",class_details:"",bases:[""],entities:[""],entrances:[""],exits:[""]}],oo="0.9.1";let $v=!1,La,$b,jb,v_,qb,Vb,Xb,Zb,Yb;function Gz(n,t={auto:!1}){if($v)throw new Error(`you must \`import 'groq-sdk/shims/${n.kind}'\` before importing anything else from groq-sdk`);if(La)throw new Error(`can't \`import 'groq-sdk/shims/${n.kind}'\` after \`import 'groq-sdk/shims/${La}'\``);$v=t.auto,La=n.kind,$b=n.fetch,jb=n.FormData,v_=n.File,qb=n.ReadableStream,Vb=n.getMultipartRequestOptions,Xb=n.getDefaultAgent,Zb=n.fileFromPath,Yb=n.isFsReadStream}class $z{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}}function jz({manuallyImported:n}={}){const t=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n";let e,i,s,r;try{e=fetch,i=Request,s=Response,r=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${t}`)}return{kind:"web",fetch:e,Request:i,Response:s,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(o,l)=>({...l,body:new $z(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:o=>!1}}La||Gz(jz(),{auto:!0});class Es extends Error{}class wi extends Es{constructor(t,e,i,s){super(`${wi.makeMessage(t,e,i)}`),this.status=t,this.headers=s,this.error=e}static makeMessage(t,e,i){const s=e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):i;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,e,i,s){if(!t||!s)return new jc({message:i,cause:b_(e)});const r=e;return t===400?new Kb(t,r,i,s):t===401?new Jb(t,r,i,s):t===403?new ty(t,r,i,s):t===404?new ey(t,r,i,s):t===409?new iy(t,r,i,s):t===422?new sy(t,r,i,s):t===429?new ny(t,r,i,s):t>=500?new ry(t,r,i,s):new wi(t,r,i,s)}}class w_ extends wi{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class jc extends wi{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class Qb extends jc{constructor({message:t}={}){super({message:t??"Request timed out."})}}class Kb extends wi{}class Jb extends wi{}class ty extends wi{}class ey extends wi{}class iy extends wi{}class sy extends wi{}class ny extends wi{}class ry extends wi{}class uo{constructor(t,e){this.iterator=t,this.controller=e}static fromSSEResponse(t,e){let i=!1;const s=new qz;async function*r(){if(!t.body)throw e.abort(),new Es("Attempted to iterate over a response with no body");const l=new Ur,c=jv(t.body);for await(const d of c)for(const _ of l.decode(d)){const f=s.decode(_);f&&(yield f)}for(const d of l.flush()){const _=s.decode(d);_&&(yield _)}}async function*o(){if(i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let l=!1;try{for await(const c of r())if(!l){if(c.data.startsWith("[DONE]")){l=!0;continue}if(c.event===null||c.event==="error"){let d;try{d=JSON.parse(c.data)}catch(_){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),_}if(d&&d.error)throw new wi(d.error.status_code,d.error,d.error.message,void 0);yield d}}l=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{l||e.abort()}}return new uo(o,e)}static fromReadableStream(t,e){let i=!1;async function*s(){const o=new Ur,l=jv(t);for await(const c of l)for(const d of o.decode(c))yield d;for(const c of o.flush())yield c}async function*r(){if(i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let o=!1;try{for await(const l of s())o||l&&(yield JSON.parse(l));o=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{o||e.abort()}}return new uo(r,e)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],e=[],i=this.iterator(),s=r=>({next:()=>{if(r.length===0){const o=i.next();t.push(o),e.push(o)}return r.shift()}});return[new uo(()=>s(t),this.controller),new uo(()=>s(e),this.controller)]}toReadableStream(){const t=this;let e;const i=new TextEncoder;return new qb({async start(){e=t[Symbol.asyncIterator]()},async pull(s){try{const{value:r,done:o}=await e.next();if(o)return s.close();const l=i.encode(JSON.stringify(r)+`
`);s.enqueue(l)}catch(r){s.error(r)}},async cancel(){var s;await((s=e.return)==null?void 0:s.call(e))}})}}class qz{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,i,s]=Vz(t,":");return s.startsWith(" ")&&(s=s.substring(1)),e==="event"?this.event=s:e==="data"&&this.data.push(s),null}}class Ur{constructor(){this.buffer=[],this.trailingCR=!1}decode(t){let e=this.decodeText(t);if(this.trailingCR&&(e="\r"+e,this.trailingCR=!1),e.endsWith("\r")&&(this.trailingCR=!0,e=e.slice(0,-1)),!e)return[];const i=Ur.NEWLINE_CHARS.has(e[e.length-1]||"");let s=e.split(Ur.NEWLINE_REGEXP);return s.length===1&&!i?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),i||(this.buffer=[s.pop()||""]),s)}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof Buffer<"u"){if(t instanceof Buffer)return t.toString();if(t instanceof Uint8Array)return Buffer.from(t).toString();throw new Es(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new Es(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new Es("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const t=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,t}}Ur.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]);Ur.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Vz(n,t){const e=n.indexOf(t);return e!==-1?[n.substring(0,e),t,n.substring(e+t.length)]:[n,"",""]}function jv(n){if(n[Symbol.asyncIterator])return n;const t=n.getReader();return{async next(){try{const e=await t.read();return e!=null&&e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const oy=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ay=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&qc(n),qc=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Xz=n=>ay(n)||oy(n)||Yb(n);async function ly(n,t,e){var s;if(n=await n,ay(n))return n;if(oy(n)){const r=await n.blob();t||(t=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=qc(r)?[await r.arrayBuffer()]:[r];return new v_(o,t,e)}const i=await Zz(n);if(t||(t=Qz(n)??"unknown_file"),!(e!=null&&e.type)){const r=(s=i[0])==null?void 0:s.type;typeof r=="string"&&(e={...e,type:r})}return new v_(i,t,e)}async function Zz(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(qc(n))t.push(await n.arrayBuffer());else if(Kz(n))for await(const i of n)t.push(i);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)==null?void 0:e.name}; props: ${Yz(n)}`);return t}function Yz(n){return`[${Object.getOwnPropertyNames(n).map(e=>`"${e}"`).join(", ")}]`}function Qz(n){var t;return Iu(n.name)||Iu(n.filename)||((t=Iu(n.path))==null?void 0:t.split(/[\\/]/).pop())}const Iu=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Kz=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",qv=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",hy=async n=>{const t=await Jz(n.body);return Vb(t,n)},Jz=async n=>{const t=new jb;return await Promise.all(Object.entries(n||{}).map(([e,i])=>x_(t,e,i))),t},x_=async(n,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")n.append(t,String(e));else if(Xz(e)){const i=await ly(e);n.append(t,i)}else if(Array.isArray(e))await Promise.all(e.map(i=>x_(n,t+"[]",i)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([i,s])=>x_(n,`${t}[${i}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}};var bo={};async function cy(n){const{response:t}=n;if(n.options.stream)return yo("response",t.status,t.url,t.headers,t.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(t,n.controller):uo.fromSSEResponse(t,n.controller);if(t.status===204)return null;if(n.options.__binaryResponse)return t;const e=t.headers.get("content-type");if((e==null?void 0:e.includes("application/json"))||(e==null?void 0:e.includes("application/vnd.api+json"))){const r=await t.json();return yo("response",t.status,t.url,t.headers,r),r}const s=await t.text();return yo("response",t.status,t.url,t.headers,s),s}class Vc extends Promise{constructor(t,e=cy){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=e}_thenUnwrap(t){return new Vc(this.responsePromise,async e=>t(await this.parseResponse(e),e))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}class tH{constructor({baseURL:t,maxRetries:e=2,timeout:i=6e4,httpAgent:s,fetch:r}){this.baseURL=t,this.maxRetries=Ru("maxRetries",e),this.timeout=Ru("timeout",i),this.httpAgent=s,this.fetch=r??$b}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...rH(),...this.authHeaders(t)}}validateHeaders(t,e){}defaultIdempotencyKey(){return`stainless-node-retry-${uH()}`}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,i){return this.request(Promise.resolve(i).then(async s=>{const r=s&&qc(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:t,path:e,...s,body:r}}))}getAPIList(t,e,i){return this.requestAPIList(e,{method:"get",path:t,...i})}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}buildRequest(t,{retryCount:e=0}={}){var C;const{method:i,path:s,query:r,headers:o={}}=t,l=ArrayBuffer.isView(t.body)||t.__binaryRequest&&typeof t.body=="string"?t.body:qv(t.body)?t.body.body:t.body?JSON.stringify(t.body,null,2):null,c=this.calculateContentLength(l),d=this.buildURL(s,r);"timeout"in t&&Ru("timeout",t.timeout);const _=t.timeout??this.timeout,f=t.httpAgent??this.httpAgent??Xb(d),g=_+1e3;typeof((C=f==null?void 0:f.options)==null?void 0:C.timeout)=="number"&&g>(f.options.timeout??0)&&(f.options.timeout=g),this.idempotencyHeader&&i!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const m=this.buildHeaders({options:t,headers:o,contentLength:c,retryCount:e});return{req:{method:i,...l&&{body:l},headers:m,...f&&{agent:f},signal:t.signal??null},url:d,timeout:_}}buildHeaders({options:t,headers:e,contentLength:i,retryCount:s}){const r={};i&&(r["content-length"]=i);const o=this.defaultHeaders(t);return Qv(r,o),Qv(r,e),qv(t.body)&&La!=="node"&&delete r["content-type"],Kv(o,"x-stainless-retry-count")===void 0&&Kv(e,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(s)),this.validateHeaders(r,e),r}async prepareOptions(t){}async prepareRequest(t,{url:e,options:i}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(e=>[...e])):{...t}:{}}makeStatusError(t,e,i,s){return wi.generate(t,e,i,s)}request(t,e=null){return new Vc(this.makeRequest(t,e))}async makeRequest(t,e){var f,g;const i=await t,s=i.maxRetries??this.maxRetries;e==null&&(e=s),await this.prepareOptions(i);const{req:r,url:o,timeout:l}=this.buildRequest(i,{retryCount:s-e});if(await this.prepareRequest(r,{url:o,options:i}),yo("request",o,i,r.headers),(f=i.signal)!=null&&f.aborted)throw new w_;const c=new AbortController,d=await this.fetchWithTimeout(o,r,l,c).catch(b_);if(d instanceof Error){if((g=i.signal)!=null&&g.aborted)throw new w_;if(e)return this.retryRequest(i,e);throw d.name==="AbortError"?new Qb:new jc({cause:d})}const _=iH(d.headers);if(!d.ok){if(e&&this.shouldRetry(d)){const S=`retrying, ${e} attempts remaining`;return yo(`response (error; ${S})`,d.status,o,_),this.retryRequest(i,e,_)}const m=await d.text().catch(S=>b_(S).message),x=oH(m),C=x?void 0:m;throw yo(`response (error; ${e?"(error; no more retries left)":"(error; not retryable)"})`,d.status,o,_,C),this.makeStatusError(d.status,x,C,_)}return{response:d,options:i,controller:c}}requestAPIList(t,e){const i=this.makeRequest(e,null);return new eH(this,i,t)}buildURL(t,e){const i=lH(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return cH(s)||(e={...s,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(i.search=this.stringifyQuery(e)),i.toString()}stringifyQuery(t){return Object.entries(t).filter(([e,i])=>typeof i<"u").map(([e,i])=>{if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")return`${encodeURIComponent(e)}=${encodeURIComponent(i)}`;if(i===null)return`${encodeURIComponent(e)}=`;throw new Es(`Cannot stringify type ${typeof i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,e,i,s){const{signal:r,...o}=e||{};r&&r.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),i);return this.fetch.call(void 0,t,{signal:s.signal,...o}).finally(()=>{clearTimeout(l)})}shouldRetry(t){const e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,i){let s;const r=i==null?void 0:i["retry-after-ms"];if(r){const l=parseFloat(r);Number.isNaN(l)||(s=l)}const o=i==null?void 0:i["retry-after"];if(o&&!s){const l=parseFloat(o);Number.isNaN(l)?s=Date.parse(o)-Date.now():s=l*1e3}if(!(s&&0<=s&&s<60*1e3)){const l=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(e,l)}return await hH(s),this.makeRequest(t,e-1)}calculateDefaultRetryTimeoutMillis(t,e){const r=e-t,o=Math.min(.5*Math.pow(2,r),8),l=1-Math.random()*.25;return o*l*1e3}getUserAgent(){return`${this.constructor.name}/JS ${oo}`}}class eH extends Vc{constructor(t,e,i){super(e,async s=>new i(t,s.response,await cy(s),s.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const e of t)yield e}}const iH=n=>new Proxy(Object.fromEntries(n.entries()),{get(t,e){const i=e.toString();return t[i.toLowerCase()]||t[i]}}),sH=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oo,"X-Stainless-OS":Xv(Deno.build.os),"X-Stainless-Arch":Vv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oo,"X-Stainless-OS":Xv(process.platform),"X-Stainless-Arch":Vv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=nH();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function nH(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:e}of n){const i=e.exec(navigator.userAgent);if(i){const s=i[1]||0,r=i[2]||0,o=i[3]||0;return{browser:t,version:`${s}.${r}.${o}`}}}return null}const Vv=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Xv=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Zv;const rH=()=>Zv??(Zv=sH()),oH=n=>{try{return JSON.parse(n)}catch{return}},aH=/^[a-z][a-z0-9+.-]*:/i,lH=n=>aH.test(n),hH=n=>new Promise(t=>setTimeout(t,n)),Ru=(n,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Es(`${n} must be an integer`);if(t<0)throw new Es(`${n} must be a positive integer`);return t},b_=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Yv=n=>{var t,e,i,s;if(typeof process<"u")return((t=bo==null?void 0:bo[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(s=(i=(e=Deno.env)==null?void 0:e.get)==null?void 0:i.call(e,n))==null?void 0:s.trim()};function cH(n){if(!n)return!0;for(const t in n)return!1;return!0}function dH(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function Qv(n,t){for(const e in t){if(!dH(t,e))continue;const i=e.toLowerCase();if(!i)continue;const s=t[e];s===null?delete n[i]:s!==void 0&&(n[i]=s)}}function yo(n,...t){typeof process<"u"&&(bo==null?void 0:bo.DEBUG)==="true"&&console.log(`Groq:DEBUG:${n}`,...t)}const uH=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)}),_H=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",fH=n=>typeof(n==null?void 0:n.get)=="function",Kv=(n,t)=>{var i;const e=t.toLowerCase();if(fH(n)){const s=((i=t[0])==null?void 0:i.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,(r,o,l)=>o+l.toUpperCase());for(const r of[t,e,t.toUpperCase(),s]){const o=n.get(r);if(o)return o}}for(const[s,r]of Object.entries(n))if(s.toLowerCase()===e)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${t} header, using the first entry.`),r[0]):r};class or{constructor(t){this._client=t}}class dy extends or{create(t,e){return this._client.post("/openai/v1/audio/transcriptions",hy({body:t,...e}))}}class uy extends or{create(t,e){return this._client.post("/openai/v1/audio/translations",hy({body:t,...e}))}}let Xc=class extends or{constructor(){super(...arguments),this.transcriptions=new dy(this._client),this.translations=new uy(this._client)}};Xc.Transcriptions=dy;Xc.Translations=uy;let _y=class extends or{create(t,e){return this._client.post("/openai/v1/chat/completions",{body:t,...e,stream:t.stream??!1})}};class np extends or{constructor(){super(...arguments),this.completions=new _y(this._client)}}np.Completions=_y;class fy extends or{}class py extends or{create(t,e){return this._client.post("/openai/v1/embeddings",{body:t,...e})}}class gy extends or{retrieve(t,e){return this._client.get(`/openai/v1/models/${t}`,e)}list(t){return this._client.get("/openai/v1/models",t)}delete(t,e){return this._client.delete(`/openai/v1/models/${t}`,e)}}var my;class ge extends tH{constructor({baseURL:t=Yv("GROQ_BASE_URL"),apiKey:e=Yv("GROQ_API_KEY"),...i}={}){if(e===void 0)throw new Es("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");const s={apiKey:e,...i,baseURL:t||"https://api.groq.com"};if(!s.dangerouslyAllowBrowser&&_H())throw new Es(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:s.baseURL,timeout:s.timeout??6e4,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new fy(this),this.chat=new np(this),this.embeddings=new py(this),this.audio=new Xc(this),this.models=new gy(this),this._options=s,this.apiKey=e}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}}my=ge;ge.Groq=my;ge.DEFAULT_TIMEOUT=6e4;ge.GroqError=Es;ge.APIError=wi;ge.APIConnectionError=jc;ge.APIConnectionTimeoutError=Qb;ge.APIUserAbortError=w_;ge.NotFoundError=ey;ge.ConflictError=iy;ge.RateLimitError=ny;ge.BadRequestError=Kb;ge.AuthenticationError=Jb;ge.InternalServerError=ry;ge.PermissionDeniedError=ty;ge.UnprocessableEntityError=sy;ge.toFile=ly;ge.fileFromPath=Zb;ge.Completions=fy;ge.Chat=np;ge.Embeddings=py;ge.Audio=Xc;ge.Models=gy;var _c={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */_c.exports;(function(n,t){(function(){var e,i="4.17.21",s=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",d=500,_="__lodash_placeholder__",f=1,g=2,m=4,x=1,C=2,T=1,A=2,S=4,E=8,M=16,O=32,N=64,F=128,K=256,nt=512,pt=30,ht="...",ct=800,bt=16,wt=1,Ct=2,dt=3,G=1/0,kt=9007199254740991,Ht=17976931348623157e292,At=NaN,Dt=4294967295,me=Dt-1,ke=Dt>>>1,Se=[["ary",F],["bind",T],["bindKey",A],["curry",E],["curryRight",M],["flip",nt],["partial",O],["partialRight",N],["rearg",K]],Vt="[object Arguments]",Ie="[object Array]",Je="[object AsyncFunction]",zi="[object Boolean]",Re="[object Date]",ue="[object DOMException]",te="[object Error]",xi="[object Function]",Zs="[object GeneratorFunction]",_e="[object Map]",Ki="[object Number]",Rn="[object Null]",ai="[object Object]",Is="[object Promise]",cs="[object Proxy]",ds="[object RegExp]",Hi="[object Set]",Xo="[object String]",El="[object Symbol]",xy="[object Undefined]",Zo="[object WeakMap]",by="[object WeakSet]",Yo="[object ArrayBuffer]",Gr="[object DataView]",Zc="[object Float32Array]",Yc="[object Float64Array]",Qc="[object Int8Array]",Kc="[object Int16Array]",Jc="[object Int32Array]",td="[object Uint8Array]",ed="[object Uint8ClampedArray]",id="[object Uint16Array]",sd="[object Uint32Array]",yy=/\b__p \+= '';/g,Cy=/\b(__p \+=) '' \+/g,Ay=/(__e\(.*?\)|\b__t\)) \+\n'';/g,rp=/&(?:amp|lt|gt|quot|#39);/g,op=/[&<>"']/g,Sy=RegExp(rp.source),Ty=RegExp(op.source),Ey=/<%-([\s\S]+?)%>/g,Py=/<%([\s\S]+?)%>/g,ap=/<%=([\s\S]+?)%>/g,ky=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Iy=/^\w*$/,Ry=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nd=/[\\^$.*+?()[\]{}|]/g,My=RegExp(nd.source),rd=/^\s+/,Dy=/\s/,Ly=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Fy=/\{\n\/\* \[wrapped with (.+)\] \*/,By=/,? & /,Oy=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uy=/[()=,{}\[\]\/\s]/,zy=/\\(\\)?/g,Hy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,lp=/\w*$/,Wy=/^[-+]0x[0-9a-f]+$/i,Ny=/^0b[01]+$/i,Gy=/^\[object .+?Constructor\]$/,$y=/^0o[0-7]+$/i,jy=/^(?:0|[1-9]\d*)$/,qy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pl=/($^)/,Vy=/['\n\r\u2028\u2029\\]/g,kl="\\ud800-\\udfff",Xy="\\u0300-\\u036f",Zy="\\ufe20-\\ufe2f",Yy="\\u20d0-\\u20ff",hp=Xy+Zy+Yy,cp="\\u2700-\\u27bf",dp="a-z\\xdf-\\xf6\\xf8-\\xff",Qy="\\xac\\xb1\\xd7\\xf7",Ky="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jy="\\u2000-\\u206f",tC=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",up="A-Z\\xc0-\\xd6\\xd8-\\xde",_p="\\ufe0e\\ufe0f",fp=Qy+Ky+Jy+tC,od="[']",eC="["+kl+"]",pp="["+fp+"]",Il="["+hp+"]",gp="\\d+",iC="["+cp+"]",mp="["+dp+"]",vp="[^"+kl+fp+gp+cp+dp+up+"]",ad="\\ud83c[\\udffb-\\udfff]",sC="(?:"+Il+"|"+ad+")",wp="[^"+kl+"]",ld="(?:\\ud83c[\\udde6-\\uddff]){2}",hd="[\\ud800-\\udbff][\\udc00-\\udfff]",$r="["+up+"]",xp="\\u200d",bp="(?:"+mp+"|"+vp+")",nC="(?:"+$r+"|"+vp+")",yp="(?:"+od+"(?:d|ll|m|re|s|t|ve))?",Cp="(?:"+od+"(?:D|LL|M|RE|S|T|VE))?",Ap=sC+"?",Sp="["+_p+"]?",rC="(?:"+xp+"(?:"+[wp,ld,hd].join("|")+")"+Sp+Ap+")*",oC="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",aC="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Tp=Sp+Ap+rC,lC="(?:"+[iC,ld,hd].join("|")+")"+Tp,hC="(?:"+[wp+Il+"?",Il,ld,hd,eC].join("|")+")",cC=RegExp(od,"g"),dC=RegExp(Il,"g"),cd=RegExp(ad+"(?="+ad+")|"+hC+Tp,"g"),uC=RegExp([$r+"?"+mp+"+"+yp+"(?="+[pp,$r,"$"].join("|")+")",nC+"+"+Cp+"(?="+[pp,$r+bp,"$"].join("|")+")",$r+"?"+bp+"+"+yp,$r+"+"+Cp,aC,oC,gp,lC].join("|"),"g"),_C=RegExp("["+xp+kl+hp+_p+"]"),fC=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pC=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],gC=-1,ae={};ae[Zc]=ae[Yc]=ae[Qc]=ae[Kc]=ae[Jc]=ae[td]=ae[ed]=ae[id]=ae[sd]=!0,ae[Vt]=ae[Ie]=ae[Yo]=ae[zi]=ae[Gr]=ae[Re]=ae[te]=ae[xi]=ae[_e]=ae[Ki]=ae[ai]=ae[ds]=ae[Hi]=ae[Xo]=ae[Zo]=!1;var oe={};oe[Vt]=oe[Ie]=oe[Yo]=oe[Gr]=oe[zi]=oe[Re]=oe[Zc]=oe[Yc]=oe[Qc]=oe[Kc]=oe[Jc]=oe[_e]=oe[Ki]=oe[ai]=oe[ds]=oe[Hi]=oe[Xo]=oe[El]=oe[td]=oe[ed]=oe[id]=oe[sd]=!0,oe[te]=oe[xi]=oe[Zo]=!1;var mC={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},vC={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},wC={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},xC={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},bC=parseFloat,yC=parseInt,Ep=typeof ri=="object"&&ri&&ri.Object===Object&&ri,CC=typeof self=="object"&&self&&self.Object===Object&&self,ti=Ep||CC||Function("return this")(),dd=t&&!t.nodeType&&t,ar=dd&&!0&&n&&!n.nodeType&&n,Pp=ar&&ar.exports===dd,ud=Pp&&Ep.process,Ji=function(){try{var L=ar&&ar.require&&ar.require("util").types;return L||ud&&ud.binding&&ud.binding("util")}catch{}}(),kp=Ji&&Ji.isArrayBuffer,Ip=Ji&&Ji.isDate,Rp=Ji&&Ji.isMap,Mp=Ji&&Ji.isRegExp,Dp=Ji&&Ji.isSet,Lp=Ji&&Ji.isTypedArray;function Wi(L,z,U){switch(U.length){case 0:return L.call(z);case 1:return L.call(z,U[0]);case 2:return L.call(z,U[0],U[1]);case 3:return L.call(z,U[0],U[1],U[2])}return L.apply(z,U)}function AC(L,z,U,st){for(var St=-1,jt=L==null?0:L.length;++St<jt;){var Ne=L[St];z(st,Ne,U(Ne),L)}return st}function ts(L,z){for(var U=-1,st=L==null?0:L.length;++U<st&&z(L[U],U,L)!==!1;);return L}function SC(L,z){for(var U=L==null?0:L.length;U--&&z(L[U],U,L)!==!1;);return L}function Fp(L,z){for(var U=-1,st=L==null?0:L.length;++U<st;)if(!z(L[U],U,L))return!1;return!0}function Mn(L,z){for(var U=-1,st=L==null?0:L.length,St=0,jt=[];++U<st;){var Ne=L[U];z(Ne,U,L)&&(jt[St++]=Ne)}return jt}function Rl(L,z){var U=L==null?0:L.length;return!!U&&jr(L,z,0)>-1}function _d(L,z,U){for(var st=-1,St=L==null?0:L.length;++st<St;)if(U(z,L[st]))return!0;return!1}function fe(L,z){for(var U=-1,st=L==null?0:L.length,St=Array(st);++U<st;)St[U]=z(L[U],U,L);return St}function Dn(L,z){for(var U=-1,st=z.length,St=L.length;++U<st;)L[St+U]=z[U];return L}function fd(L,z,U,st){var St=-1,jt=L==null?0:L.length;for(st&&jt&&(U=L[++St]);++St<jt;)U=z(U,L[St],St,L);return U}function TC(L,z,U,st){var St=L==null?0:L.length;for(st&&St&&(U=L[--St]);St--;)U=z(U,L[St],St,L);return U}function pd(L,z){for(var U=-1,st=L==null?0:L.length;++U<st;)if(z(L[U],U,L))return!0;return!1}var EC=gd("length");function PC(L){return L.split("")}function kC(L){return L.match(Oy)||[]}function Bp(L,z,U){var st;return U(L,function(St,jt,Ne){if(z(St,jt,Ne))return st=jt,!1}),st}function Ml(L,z,U,st){for(var St=L.length,jt=U+(st?1:-1);st?jt--:++jt<St;)if(z(L[jt],jt,L))return jt;return-1}function jr(L,z,U){return z===z?WC(L,z,U):Ml(L,Op,U)}function IC(L,z,U,st){for(var St=U-1,jt=L.length;++St<jt;)if(st(L[St],z))return St;return-1}function Op(L){return L!==L}function Up(L,z){var U=L==null?0:L.length;return U?vd(L,z)/U:At}function gd(L){return function(z){return z==null?e:z[L]}}function md(L){return function(z){return L==null?e:L[z]}}function zp(L,z,U,st,St){return St(L,function(jt,Ne,se){U=st?(st=!1,jt):z(U,jt,Ne,se)}),U}function RC(L,z){var U=L.length;for(L.sort(z);U--;)L[U]=L[U].value;return L}function vd(L,z){for(var U,st=-1,St=L.length;++st<St;){var jt=z(L[st]);jt!==e&&(U=U===e?jt:U+jt)}return U}function wd(L,z){for(var U=-1,st=Array(L);++U<L;)st[U]=z(U);return st}function MC(L,z){return fe(z,function(U){return[U,L[U]]})}function Hp(L){return L&&L.slice(0,$p(L)+1).replace(rd,"")}function Ni(L){return function(z){return L(z)}}function xd(L,z){return fe(z,function(U){return L[U]})}function Qo(L,z){return L.has(z)}function Wp(L,z){for(var U=-1,st=L.length;++U<st&&jr(z,L[U],0)>-1;);return U}function Np(L,z){for(var U=L.length;U--&&jr(z,L[U],0)>-1;);return U}function DC(L,z){for(var U=L.length,st=0;U--;)L[U]===z&&++st;return st}var LC=md(mC),FC=md(vC);function BC(L){return"\\"+xC[L]}function OC(L,z){return L==null?e:L[z]}function qr(L){return _C.test(L)}function UC(L){return fC.test(L)}function zC(L){for(var z,U=[];!(z=L.next()).done;)U.push(z.value);return U}function bd(L){var z=-1,U=Array(L.size);return L.forEach(function(st,St){U[++z]=[St,st]}),U}function Gp(L,z){return function(U){return L(z(U))}}function Ln(L,z){for(var U=-1,st=L.length,St=0,jt=[];++U<st;){var Ne=L[U];(Ne===z||Ne===_)&&(L[U]=_,jt[St++]=U)}return jt}function Dl(L){var z=-1,U=Array(L.size);return L.forEach(function(st){U[++z]=st}),U}function HC(L){var z=-1,U=Array(L.size);return L.forEach(function(st){U[++z]=[st,st]}),U}function WC(L,z,U){for(var st=U-1,St=L.length;++st<St;)if(L[st]===z)return st;return-1}function NC(L,z,U){for(var st=U+1;st--;)if(L[st]===z)return st;return st}function Vr(L){return qr(L)?$C(L):EC(L)}function us(L){return qr(L)?jC(L):PC(L)}function $p(L){for(var z=L.length;z--&&Dy.test(L.charAt(z)););return z}var GC=md(wC);function $C(L){for(var z=cd.lastIndex=0;cd.test(L);)++z;return z}function jC(L){return L.match(cd)||[]}function qC(L){return L.match(uC)||[]}var VC=function L(z){z=z==null?ti:Xr.defaults(ti.Object(),z,Xr.pick(ti,pC));var U=z.Array,st=z.Date,St=z.Error,jt=z.Function,Ne=z.Math,se=z.Object,yd=z.RegExp,XC=z.String,es=z.TypeError,Ll=U.prototype,ZC=jt.prototype,Zr=se.prototype,Fl=z["__core-js_shared__"],Bl=ZC.toString,Yt=Zr.hasOwnProperty,YC=0,jp=function(){var a=/[^.]+$/.exec(Fl&&Fl.keys&&Fl.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),Ol=Zr.toString,QC=Bl.call(se),KC=ti._,JC=yd("^"+Bl.call(Yt).replace(nd,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ul=Pp?z.Buffer:e,Fn=z.Symbol,zl=z.Uint8Array,qp=Ul?Ul.allocUnsafe:e,Hl=Gp(se.getPrototypeOf,se),Vp=se.create,Xp=Zr.propertyIsEnumerable,Wl=Ll.splice,Zp=Fn?Fn.isConcatSpreadable:e,Ko=Fn?Fn.iterator:e,lr=Fn?Fn.toStringTag:e,Nl=function(){try{var a=_r(se,"defineProperty");return a({},"",{}),a}catch{}}(),t1=z.clearTimeout!==ti.clearTimeout&&z.clearTimeout,e1=st&&st.now!==ti.Date.now&&st.now,i1=z.setTimeout!==ti.setTimeout&&z.setTimeout,Gl=Ne.ceil,$l=Ne.floor,Cd=se.getOwnPropertySymbols,s1=Ul?Ul.isBuffer:e,Yp=z.isFinite,n1=Ll.join,r1=Gp(se.keys,se),Ge=Ne.max,li=Ne.min,o1=st.now,a1=z.parseInt,Qp=Ne.random,l1=Ll.reverse,Ad=_r(z,"DataView"),Jo=_r(z,"Map"),Sd=_r(z,"Promise"),Yr=_r(z,"Set"),ta=_r(z,"WeakMap"),ea=_r(se,"create"),jl=ta&&new ta,Qr={},h1=fr(Ad),c1=fr(Jo),d1=fr(Sd),u1=fr(Yr),_1=fr(ta),ql=Fn?Fn.prototype:e,ia=ql?ql.valueOf:e,Kp=ql?ql.toString:e;function b(a){if(Te(a)&&!Tt(a)&&!(a instanceof Wt)){if(a instanceof is)return a;if(Yt.call(a,"__wrapped__"))return Jg(a)}return new is(a)}var Kr=function(){function a(){}return function(h){if(!ve(h))return{};if(Vp)return Vp(h);a.prototype=h;var u=new a;return a.prototype=e,u}}();function Vl(){}function is(a,h){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!h,this.__index__=0,this.__values__=e}b.templateSettings={escape:Ey,evaluate:Py,interpolate:ap,variable:"",imports:{_:b}},b.prototype=Vl.prototype,b.prototype.constructor=b,is.prototype=Kr(Vl.prototype),is.prototype.constructor=is;function Wt(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Dt,this.__views__=[]}function f1(){var a=new Wt(this.__wrapped__);return a.__actions__=ki(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=ki(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=ki(this.__views__),a}function p1(){if(this.__filtered__){var a=new Wt(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function g1(){var a=this.__wrapped__.value(),h=this.__dir__,u=Tt(a),p=h<0,v=u?a.length:0,y=PA(0,v,this.__views__),P=y.start,R=y.end,B=R-P,H=p?R:P-1,W=this.__iteratees__,j=W.length,tt=0,rt=li(B,this.__takeCount__);if(!u||!p&&v==B&&rt==B)return yg(a,this.__actions__);var gt=[];t:for(;B--&&tt<rt;){H+=h;for(var Lt=-1,mt=a[H];++Lt<j;){var zt=W[Lt],Nt=zt.iteratee,ji=zt.type,Ci=Nt(mt);if(ji==Ct)mt=Ci;else if(!Ci){if(ji==wt)continue t;break t}}gt[tt++]=mt}return gt}Wt.prototype=Kr(Vl.prototype),Wt.prototype.constructor=Wt;function hr(a){var h=-1,u=a==null?0:a.length;for(this.clear();++h<u;){var p=a[h];this.set(p[0],p[1])}}function m1(){this.__data__=ea?ea(null):{},this.size=0}function v1(a){var h=this.has(a)&&delete this.__data__[a];return this.size-=h?1:0,h}function w1(a){var h=this.__data__;if(ea){var u=h[a];return u===c?e:u}return Yt.call(h,a)?h[a]:e}function x1(a){var h=this.__data__;return ea?h[a]!==e:Yt.call(h,a)}function b1(a,h){var u=this.__data__;return this.size+=this.has(a)?0:1,u[a]=ea&&h===e?c:h,this}hr.prototype.clear=m1,hr.prototype.delete=v1,hr.prototype.get=w1,hr.prototype.has=x1,hr.prototype.set=b1;function Ys(a){var h=-1,u=a==null?0:a.length;for(this.clear();++h<u;){var p=a[h];this.set(p[0],p[1])}}function y1(){this.__data__=[],this.size=0}function C1(a){var h=this.__data__,u=Xl(h,a);if(u<0)return!1;var p=h.length-1;return u==p?h.pop():Wl.call(h,u,1),--this.size,!0}function A1(a){var h=this.__data__,u=Xl(h,a);return u<0?e:h[u][1]}function S1(a){return Xl(this.__data__,a)>-1}function T1(a,h){var u=this.__data__,p=Xl(u,a);return p<0?(++this.size,u.push([a,h])):u[p][1]=h,this}Ys.prototype.clear=y1,Ys.prototype.delete=C1,Ys.prototype.get=A1,Ys.prototype.has=S1,Ys.prototype.set=T1;function Qs(a){var h=-1,u=a==null?0:a.length;for(this.clear();++h<u;){var p=a[h];this.set(p[0],p[1])}}function E1(){this.size=0,this.__data__={hash:new hr,map:new(Jo||Ys),string:new hr}}function P1(a){var h=oh(this,a).delete(a);return this.size-=h?1:0,h}function k1(a){return oh(this,a).get(a)}function I1(a){return oh(this,a).has(a)}function R1(a,h){var u=oh(this,a),p=u.size;return u.set(a,h),this.size+=u.size==p?0:1,this}Qs.prototype.clear=E1,Qs.prototype.delete=P1,Qs.prototype.get=k1,Qs.prototype.has=I1,Qs.prototype.set=R1;function cr(a){var h=-1,u=a==null?0:a.length;for(this.__data__=new Qs;++h<u;)this.add(a[h])}function M1(a){return this.__data__.set(a,c),this}function D1(a){return this.__data__.has(a)}cr.prototype.add=cr.prototype.push=M1,cr.prototype.has=D1;function _s(a){var h=this.__data__=new Ys(a);this.size=h.size}function L1(){this.__data__=new Ys,this.size=0}function F1(a){var h=this.__data__,u=h.delete(a);return this.size=h.size,u}function B1(a){return this.__data__.get(a)}function O1(a){return this.__data__.has(a)}function U1(a,h){var u=this.__data__;if(u instanceof Ys){var p=u.__data__;if(!Jo||p.length<s-1)return p.push([a,h]),this.size=++u.size,this;u=this.__data__=new Qs(p)}return u.set(a,h),this.size=u.size,this}_s.prototype.clear=L1,_s.prototype.delete=F1,_s.prototype.get=B1,_s.prototype.has=O1,_s.prototype.set=U1;function Jp(a,h){var u=Tt(a),p=!u&&pr(a),v=!u&&!p&&Hn(a),y=!u&&!p&&!v&&io(a),P=u||p||v||y,R=P?wd(a.length,XC):[],B=R.length;for(var H in a)(h||Yt.call(a,H))&&!(P&&(H=="length"||v&&(H=="offset"||H=="parent")||y&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||en(H,B)))&&R.push(H);return R}function tg(a){var h=a.length;return h?a[Bd(0,h-1)]:e}function z1(a,h){return ah(ki(a),dr(h,0,a.length))}function H1(a){return ah(ki(a))}function Td(a,h,u){(u!==e&&!fs(a[h],u)||u===e&&!(h in a))&&Ks(a,h,u)}function sa(a,h,u){var p=a[h];(!(Yt.call(a,h)&&fs(p,u))||u===e&&!(h in a))&&Ks(a,h,u)}function Xl(a,h){for(var u=a.length;u--;)if(fs(a[u][0],h))return u;return-1}function W1(a,h,u,p){return Bn(a,function(v,y,P){h(p,v,u(v),P)}),p}function eg(a,h){return a&&Ms(h,Ze(h),a)}function N1(a,h){return a&&Ms(h,Ri(h),a)}function Ks(a,h,u){h=="__proto__"&&Nl?Nl(a,h,{configurable:!0,enumerable:!0,value:u,writable:!0}):a[h]=u}function Ed(a,h){for(var u=-1,p=h.length,v=U(p),y=a==null;++u<p;)v[u]=y?e:au(a,h[u]);return v}function dr(a,h,u){return a===a&&(u!==e&&(a=a<=u?a:u),h!==e&&(a=a>=h?a:h)),a}function ss(a,h,u,p,v,y){var P,R=h&f,B=h&g,H=h&m;if(u&&(P=v?u(a,p,v,y):u(a)),P!==e)return P;if(!ve(a))return a;var W=Tt(a);if(W){if(P=IA(a),!R)return ki(a,P)}else{var j=hi(a),tt=j==xi||j==Zs;if(Hn(a))return Sg(a,R);if(j==ai||j==Vt||tt&&!v){if(P=B||tt?{}:$g(a),!R)return B?wA(a,N1(P,a)):vA(a,eg(P,a))}else{if(!oe[j])return v?a:{};P=RA(a,j,R)}}y||(y=new _s);var rt=y.get(a);if(rt)return rt;y.set(a,P),wm(a)?a.forEach(function(mt){P.add(ss(mt,h,u,mt,a,y))}):mm(a)&&a.forEach(function(mt,zt){P.set(zt,ss(mt,h,u,zt,a,y))});var gt=H?B?Vd:qd:B?Ri:Ze,Lt=W?e:gt(a);return ts(Lt||a,function(mt,zt){Lt&&(zt=mt,mt=a[zt]),sa(P,zt,ss(mt,h,u,zt,a,y))}),P}function G1(a){var h=Ze(a);return function(u){return ig(u,a,h)}}function ig(a,h,u){var p=u.length;if(a==null)return!p;for(a=se(a);p--;){var v=u[p],y=h[v],P=a[v];if(P===e&&!(v in a)||!y(P))return!1}return!0}function sg(a,h,u){if(typeof a!="function")throw new es(o);return ca(function(){a.apply(e,u)},h)}function na(a,h,u,p){var v=-1,y=Rl,P=!0,R=a.length,B=[],H=h.length;if(!R)return B;u&&(h=fe(h,Ni(u))),p?(y=_d,P=!1):h.length>=s&&(y=Qo,P=!1,h=new cr(h));t:for(;++v<R;){var W=a[v],j=u==null?W:u(W);if(W=p||W!==0?W:0,P&&j===j){for(var tt=H;tt--;)if(h[tt]===j)continue t;B.push(W)}else y(h,j,p)||B.push(W)}return B}var Bn=Ig(Rs),ng=Ig(kd,!0);function $1(a,h){var u=!0;return Bn(a,function(p,v,y){return u=!!h(p,v,y),u}),u}function Zl(a,h,u){for(var p=-1,v=a.length;++p<v;){var y=a[p],P=h(y);if(P!=null&&(R===e?P===P&&!$i(P):u(P,R)))var R=P,B=y}return B}function j1(a,h,u,p){var v=a.length;for(u=It(u),u<0&&(u=-u>v?0:v+u),p=p===e||p>v?v:It(p),p<0&&(p+=v),p=u>p?0:bm(p);u<p;)a[u++]=h;return a}function rg(a,h){var u=[];return Bn(a,function(p,v,y){h(p,v,y)&&u.push(p)}),u}function ei(a,h,u,p,v){var y=-1,P=a.length;for(u||(u=DA),v||(v=[]);++y<P;){var R=a[y];h>0&&u(R)?h>1?ei(R,h-1,u,p,v):Dn(v,R):p||(v[v.length]=R)}return v}var Pd=Rg(),og=Rg(!0);function Rs(a,h){return a&&Pd(a,h,Ze)}function kd(a,h){return a&&og(a,h,Ze)}function Yl(a,h){return Mn(h,function(u){return sn(a[u])})}function ur(a,h){h=Un(h,a);for(var u=0,p=h.length;a!=null&&u<p;)a=a[Ds(h[u++])];return u&&u==p?a:e}function ag(a,h,u){var p=h(a);return Tt(a)?p:Dn(p,u(a))}function bi(a){return a==null?a===e?xy:Rn:lr&&lr in se(a)?EA(a):HA(a)}function Id(a,h){return a>h}function q1(a,h){return a!=null&&Yt.call(a,h)}function V1(a,h){return a!=null&&h in se(a)}function X1(a,h,u){return a>=li(h,u)&&a<Ge(h,u)}function Rd(a,h,u){for(var p=u?_d:Rl,v=a[0].length,y=a.length,P=y,R=U(y),B=1/0,H=[];P--;){var W=a[P];P&&h&&(W=fe(W,Ni(h))),B=li(W.length,B),R[P]=!u&&(h||v>=120&&W.length>=120)?new cr(P&&W):e}W=a[0];var j=-1,tt=R[0];t:for(;++j<v&&H.length<B;){var rt=W[j],gt=h?h(rt):rt;if(rt=u||rt!==0?rt:0,!(tt?Qo(tt,gt):p(H,gt,u))){for(P=y;--P;){var Lt=R[P];if(!(Lt?Qo(Lt,gt):p(a[P],gt,u)))continue t}tt&&tt.push(gt),H.push(rt)}}return H}function Z1(a,h,u,p){return Rs(a,function(v,y,P){h(p,u(v),y,P)}),p}function ra(a,h,u){h=Un(h,a),a=Xg(a,h);var p=a==null?a:a[Ds(rs(h))];return p==null?e:Wi(p,a,u)}function lg(a){return Te(a)&&bi(a)==Vt}function Y1(a){return Te(a)&&bi(a)==Yo}function Q1(a){return Te(a)&&bi(a)==Re}function oa(a,h,u,p,v){return a===h?!0:a==null||h==null||!Te(a)&&!Te(h)?a!==a&&h!==h:K1(a,h,u,p,oa,v)}function K1(a,h,u,p,v,y){var P=Tt(a),R=Tt(h),B=P?Ie:hi(a),H=R?Ie:hi(h);B=B==Vt?ai:B,H=H==Vt?ai:H;var W=B==ai,j=H==ai,tt=B==H;if(tt&&Hn(a)){if(!Hn(h))return!1;P=!0,W=!1}if(tt&&!W)return y||(y=new _s),P||io(a)?Wg(a,h,u,p,v,y):SA(a,h,B,u,p,v,y);if(!(u&x)){var rt=W&&Yt.call(a,"__wrapped__"),gt=j&&Yt.call(h,"__wrapped__");if(rt||gt){var Lt=rt?a.value():a,mt=gt?h.value():h;return y||(y=new _s),v(Lt,mt,u,p,y)}}return tt?(y||(y=new _s),TA(a,h,u,p,v,y)):!1}function J1(a){return Te(a)&&hi(a)==_e}function Md(a,h,u,p){var v=u.length,y=v,P=!p;if(a==null)return!y;for(a=se(a);v--;){var R=u[v];if(P&&R[2]?R[1]!==a[R[0]]:!(R[0]in a))return!1}for(;++v<y;){R=u[v];var B=R[0],H=a[B],W=R[1];if(P&&R[2]){if(H===e&&!(B in a))return!1}else{var j=new _s;if(p)var tt=p(H,W,B,a,h,j);if(!(tt===e?oa(W,H,x|C,p,j):tt))return!1}}return!0}function hg(a){if(!ve(a)||FA(a))return!1;var h=sn(a)?JC:Gy;return h.test(fr(a))}function tA(a){return Te(a)&&bi(a)==ds}function eA(a){return Te(a)&&hi(a)==Hi}function iA(a){return Te(a)&&_h(a.length)&&!!ae[bi(a)]}function cg(a){return typeof a=="function"?a:a==null?Mi:typeof a=="object"?Tt(a)?_g(a[0],a[1]):ug(a):Mm(a)}function Dd(a){if(!ha(a))return r1(a);var h=[];for(var u in se(a))Yt.call(a,u)&&u!="constructor"&&h.push(u);return h}function sA(a){if(!ve(a))return zA(a);var h=ha(a),u=[];for(var p in a)p=="constructor"&&(h||!Yt.call(a,p))||u.push(p);return u}function Ld(a,h){return a<h}function dg(a,h){var u=-1,p=Ii(a)?U(a.length):[];return Bn(a,function(v,y,P){p[++u]=h(v,y,P)}),p}function ug(a){var h=Zd(a);return h.length==1&&h[0][2]?qg(h[0][0],h[0][1]):function(u){return u===a||Md(u,a,h)}}function _g(a,h){return Qd(a)&&jg(h)?qg(Ds(a),h):function(u){var p=au(u,a);return p===e&&p===h?lu(u,a):oa(h,p,x|C)}}function Ql(a,h,u,p,v){a!==h&&Pd(h,function(y,P){if(v||(v=new _s),ve(y))nA(a,h,P,u,Ql,p,v);else{var R=p?p(Jd(a,P),y,P+"",a,h,v):e;R===e&&(R=y),Td(a,P,R)}},Ri)}function nA(a,h,u,p,v,y,P){var R=Jd(a,u),B=Jd(h,u),H=P.get(B);if(H){Td(a,u,H);return}var W=y?y(R,B,u+"",a,h,P):e,j=W===e;if(j){var tt=Tt(B),rt=!tt&&Hn(B),gt=!tt&&!rt&&io(B);W=B,tt||rt||gt?Tt(R)?W=R:Me(R)?W=ki(R):rt?(j=!1,W=Sg(B,!0)):gt?(j=!1,W=Tg(B,!0)):W=[]:da(B)||pr(B)?(W=R,pr(R)?W=ym(R):(!ve(R)||sn(R))&&(W=$g(B))):j=!1}j&&(P.set(B,W),v(W,B,p,y,P),P.delete(B)),Td(a,u,W)}function fg(a,h){var u=a.length;if(u)return h+=h<0?u:0,en(h,u)?a[h]:e}function pg(a,h,u){h.length?h=fe(h,function(y){return Tt(y)?function(P){return ur(P,y.length===1?y[0]:y)}:y}):h=[Mi];var p=-1;h=fe(h,Ni(ut()));var v=dg(a,function(y,P,R){var B=fe(h,function(H){return H(y)});return{criteria:B,index:++p,value:y}});return RC(v,function(y,P){return mA(y,P,u)})}function rA(a,h){return gg(a,h,function(u,p){return lu(a,p)})}function gg(a,h,u){for(var p=-1,v=h.length,y={};++p<v;){var P=h[p],R=ur(a,P);u(R,P)&&aa(y,Un(P,a),R)}return y}function oA(a){return function(h){return ur(h,a)}}function Fd(a,h,u,p){var v=p?IC:jr,y=-1,P=h.length,R=a;for(a===h&&(h=ki(h)),u&&(R=fe(a,Ni(u)));++y<P;)for(var B=0,H=h[y],W=u?u(H):H;(B=v(R,W,B,p))>-1;)R!==a&&Wl.call(R,B,1),Wl.call(a,B,1);return a}function mg(a,h){for(var u=a?h.length:0,p=u-1;u--;){var v=h[u];if(u==p||v!==y){var y=v;en(v)?Wl.call(a,v,1):zd(a,v)}}return a}function Bd(a,h){return a+$l(Qp()*(h-a+1))}function aA(a,h,u,p){for(var v=-1,y=Ge(Gl((h-a)/(u||1)),0),P=U(y);y--;)P[p?y:++v]=a,a+=u;return P}function Od(a,h){var u="";if(!a||h<1||h>kt)return u;do h%2&&(u+=a),h=$l(h/2),h&&(a+=a);while(h);return u}function Ot(a,h){return tu(Vg(a,h,Mi),a+"")}function lA(a){return tg(so(a))}function hA(a,h){var u=so(a);return ah(u,dr(h,0,u.length))}function aa(a,h,u,p){if(!ve(a))return a;h=Un(h,a);for(var v=-1,y=h.length,P=y-1,R=a;R!=null&&++v<y;){var B=Ds(h[v]),H=u;if(B==="__proto__"||B==="constructor"||B==="prototype")return a;if(v!=P){var W=R[B];H=p?p(W,B,R):e,H===e&&(H=ve(W)?W:en(h[v+1])?[]:{})}sa(R,B,H),R=R[B]}return a}var vg=jl?function(a,h){return jl.set(a,h),a}:Mi,cA=Nl?function(a,h){return Nl(a,"toString",{configurable:!0,enumerable:!1,value:cu(h),writable:!0})}:Mi;function dA(a){return ah(so(a))}function ns(a,h,u){var p=-1,v=a.length;h<0&&(h=-h>v?0:v+h),u=u>v?v:u,u<0&&(u+=v),v=h>u?0:u-h>>>0,h>>>=0;for(var y=U(v);++p<v;)y[p]=a[p+h];return y}function uA(a,h){var u;return Bn(a,function(p,v,y){return u=h(p,v,y),!u}),!!u}function Kl(a,h,u){var p=0,v=a==null?p:a.length;if(typeof h=="number"&&h===h&&v<=ke){for(;p<v;){var y=p+v>>>1,P=a[y];P!==null&&!$i(P)&&(u?P<=h:P<h)?p=y+1:v=y}return v}return Ud(a,h,Mi,u)}function Ud(a,h,u,p){var v=0,y=a==null?0:a.length;if(y===0)return 0;h=u(h);for(var P=h!==h,R=h===null,B=$i(h),H=h===e;v<y;){var W=$l((v+y)/2),j=u(a[W]),tt=j!==e,rt=j===null,gt=j===j,Lt=$i(j);if(P)var mt=p||gt;else H?mt=gt&&(p||tt):R?mt=gt&&tt&&(p||!rt):B?mt=gt&&tt&&!rt&&(p||!Lt):rt||Lt?mt=!1:mt=p?j<=h:j<h;mt?v=W+1:y=W}return li(y,me)}function wg(a,h){for(var u=-1,p=a.length,v=0,y=[];++u<p;){var P=a[u],R=h?h(P):P;if(!u||!fs(R,B)){var B=R;y[v++]=P===0?0:P}}return y}function xg(a){return typeof a=="number"?a:$i(a)?At:+a}function Gi(a){if(typeof a=="string")return a;if(Tt(a))return fe(a,Gi)+"";if($i(a))return Kp?Kp.call(a):"";var h=a+"";return h=="0"&&1/a==-G?"-0":h}function On(a,h,u){var p=-1,v=Rl,y=a.length,P=!0,R=[],B=R;if(u)P=!1,v=_d;else if(y>=s){var H=h?null:CA(a);if(H)return Dl(H);P=!1,v=Qo,B=new cr}else B=h?[]:R;t:for(;++p<y;){var W=a[p],j=h?h(W):W;if(W=u||W!==0?W:0,P&&j===j){for(var tt=B.length;tt--;)if(B[tt]===j)continue t;h&&B.push(j),R.push(W)}else v(B,j,u)||(B!==R&&B.push(j),R.push(W))}return R}function zd(a,h){return h=Un(h,a),a=Xg(a,h),a==null||delete a[Ds(rs(h))]}function bg(a,h,u,p){return aa(a,h,u(ur(a,h)),p)}function Jl(a,h,u,p){for(var v=a.length,y=p?v:-1;(p?y--:++y<v)&&h(a[y],y,a););return u?ns(a,p?0:y,p?y+1:v):ns(a,p?y+1:0,p?v:y)}function yg(a,h){var u=a;return u instanceof Wt&&(u=u.value()),fd(h,function(p,v){return v.func.apply(v.thisArg,Dn([p],v.args))},u)}function Hd(a,h,u){var p=a.length;if(p<2)return p?On(a[0]):[];for(var v=-1,y=U(p);++v<p;)for(var P=a[v],R=-1;++R<p;)R!=v&&(y[v]=na(y[v]||P,a[R],h,u));return On(ei(y,1),h,u)}function Cg(a,h,u){for(var p=-1,v=a.length,y=h.length,P={};++p<v;){var R=p<y?h[p]:e;u(P,a[p],R)}return P}function Wd(a){return Me(a)?a:[]}function Nd(a){return typeof a=="function"?a:Mi}function Un(a,h){return Tt(a)?a:Qd(a,h)?[a]:Kg(Xt(a))}var _A=Ot;function zn(a,h,u){var p=a.length;return u=u===e?p:u,!h&&u>=p?a:ns(a,h,u)}var Ag=t1||function(a){return ti.clearTimeout(a)};function Sg(a,h){if(h)return a.slice();var u=a.length,p=qp?qp(u):new a.constructor(u);return a.copy(p),p}function Gd(a){var h=new a.constructor(a.byteLength);return new zl(h).set(new zl(a)),h}function fA(a,h){var u=h?Gd(a.buffer):a.buffer;return new a.constructor(u,a.byteOffset,a.byteLength)}function pA(a){var h=new a.constructor(a.source,lp.exec(a));return h.lastIndex=a.lastIndex,h}function gA(a){return ia?se(ia.call(a)):{}}function Tg(a,h){var u=h?Gd(a.buffer):a.buffer;return new a.constructor(u,a.byteOffset,a.length)}function Eg(a,h){if(a!==h){var u=a!==e,p=a===null,v=a===a,y=$i(a),P=h!==e,R=h===null,B=h===h,H=$i(h);if(!R&&!H&&!y&&a>h||y&&P&&B&&!R&&!H||p&&P&&B||!u&&B||!v)return 1;if(!p&&!y&&!H&&a<h||H&&u&&v&&!p&&!y||R&&u&&v||!P&&v||!B)return-1}return 0}function mA(a,h,u){for(var p=-1,v=a.criteria,y=h.criteria,P=v.length,R=u.length;++p<P;){var B=Eg(v[p],y[p]);if(B){if(p>=R)return B;var H=u[p];return B*(H=="desc"?-1:1)}}return a.index-h.index}function Pg(a,h,u,p){for(var v=-1,y=a.length,P=u.length,R=-1,B=h.length,H=Ge(y-P,0),W=U(B+H),j=!p;++R<B;)W[R]=h[R];for(;++v<P;)(j||v<y)&&(W[u[v]]=a[v]);for(;H--;)W[R++]=a[v++];return W}function kg(a,h,u,p){for(var v=-1,y=a.length,P=-1,R=u.length,B=-1,H=h.length,W=Ge(y-R,0),j=U(W+H),tt=!p;++v<W;)j[v]=a[v];for(var rt=v;++B<H;)j[rt+B]=h[B];for(;++P<R;)(tt||v<y)&&(j[rt+u[P]]=a[v++]);return j}function ki(a,h){var u=-1,p=a.length;for(h||(h=U(p));++u<p;)h[u]=a[u];return h}function Ms(a,h,u,p){var v=!u;u||(u={});for(var y=-1,P=h.length;++y<P;){var R=h[y],B=p?p(u[R],a[R],R,u,a):e;B===e&&(B=a[R]),v?Ks(u,R,B):sa(u,R,B)}return u}function vA(a,h){return Ms(a,Yd(a),h)}function wA(a,h){return Ms(a,Ng(a),h)}function th(a,h){return function(u,p){var v=Tt(u)?AC:W1,y=h?h():{};return v(u,a,ut(p,2),y)}}function Jr(a){return Ot(function(h,u){var p=-1,v=u.length,y=v>1?u[v-1]:e,P=v>2?u[2]:e;for(y=a.length>3&&typeof y=="function"?(v--,y):e,P&&yi(u[0],u[1],P)&&(y=v<3?e:y,v=1),h=se(h);++p<v;){var R=u[p];R&&a(h,R,p,y)}return h})}function Ig(a,h){return function(u,p){if(u==null)return u;if(!Ii(u))return a(u,p);for(var v=u.length,y=h?v:-1,P=se(u);(h?y--:++y<v)&&p(P[y],y,P)!==!1;);return u}}function Rg(a){return function(h,u,p){for(var v=-1,y=se(h),P=p(h),R=P.length;R--;){var B=P[a?R:++v];if(u(y[B],B,y)===!1)break}return h}}function xA(a,h,u){var p=h&T,v=la(a);function y(){var P=this&&this!==ti&&this instanceof y?v:a;return P.apply(p?u:this,arguments)}return y}function Mg(a){return function(h){h=Xt(h);var u=qr(h)?us(h):e,p=u?u[0]:h.charAt(0),v=u?zn(u,1).join(""):h.slice(1);return p[a]()+v}}function to(a){return function(h){return fd(Im(km(h).replace(cC,"")),a,"")}}function la(a){return function(){var h=arguments;switch(h.length){case 0:return new a;case 1:return new a(h[0]);case 2:return new a(h[0],h[1]);case 3:return new a(h[0],h[1],h[2]);case 4:return new a(h[0],h[1],h[2],h[3]);case 5:return new a(h[0],h[1],h[2],h[3],h[4]);case 6:return new a(h[0],h[1],h[2],h[3],h[4],h[5]);case 7:return new a(h[0],h[1],h[2],h[3],h[4],h[5],h[6])}var u=Kr(a.prototype),p=a.apply(u,h);return ve(p)?p:u}}function bA(a,h,u){var p=la(a);function v(){for(var y=arguments.length,P=U(y),R=y,B=eo(v);R--;)P[R]=arguments[R];var H=y<3&&P[0]!==B&&P[y-1]!==B?[]:Ln(P,B);if(y-=H.length,y<u)return Og(a,h,eh,v.placeholder,e,P,H,e,e,u-y);var W=this&&this!==ti&&this instanceof v?p:a;return Wi(W,this,P)}return v}function Dg(a){return function(h,u,p){var v=se(h);if(!Ii(h)){var y=ut(u,3);h=Ze(h),u=function(R){return y(v[R],R,v)}}var P=a(h,u,p);return P>-1?v[y?h[P]:P]:e}}function Lg(a){return tn(function(h){var u=h.length,p=u,v=is.prototype.thru;for(a&&h.reverse();p--;){var y=h[p];if(typeof y!="function")throw new es(o);if(v&&!P&&rh(y)=="wrapper")var P=new is([],!0)}for(p=P?p:u;++p<u;){y=h[p];var R=rh(y),B=R=="wrapper"?Xd(y):e;B&&Kd(B[0])&&B[1]==(F|E|O|K)&&!B[4].length&&B[9]==1?P=P[rh(B[0])].apply(P,B[3]):P=y.length==1&&Kd(y)?P[R]():P.thru(y)}return function(){var H=arguments,W=H[0];if(P&&H.length==1&&Tt(W))return P.plant(W).value();for(var j=0,tt=u?h[j].apply(this,H):W;++j<u;)tt=h[j].call(this,tt);return tt}})}function eh(a,h,u,p,v,y,P,R,B,H){var W=h&F,j=h&T,tt=h&A,rt=h&(E|M),gt=h&nt,Lt=tt?e:la(a);function mt(){for(var zt=arguments.length,Nt=U(zt),ji=zt;ji--;)Nt[ji]=arguments[ji];if(rt)var Ci=eo(mt),qi=DC(Nt,Ci);if(p&&(Nt=Pg(Nt,p,v,rt)),y&&(Nt=kg(Nt,y,P,rt)),zt-=qi,rt&&zt<H){var De=Ln(Nt,Ci);return Og(a,h,eh,mt.placeholder,u,Nt,De,R,B,H-zt)}var ps=j?u:this,rn=tt?ps[a]:a;return zt=Nt.length,R?Nt=WA(Nt,R):gt&&zt>1&&Nt.reverse(),W&&B<zt&&(Nt.length=B),this&&this!==ti&&this instanceof mt&&(rn=Lt||la(rn)),rn.apply(ps,Nt)}return mt}function Fg(a,h){return function(u,p){return Z1(u,a,h(p),{})}}function ih(a,h){return function(u,p){var v;if(u===e&&p===e)return h;if(u!==e&&(v=u),p!==e){if(v===e)return p;typeof u=="string"||typeof p=="string"?(u=Gi(u),p=Gi(p)):(u=xg(u),p=xg(p)),v=a(u,p)}return v}}function $d(a){return tn(function(h){return h=fe(h,Ni(ut())),Ot(function(u){var p=this;return a(h,function(v){return Wi(v,p,u)})})})}function sh(a,h){h=h===e?" ":Gi(h);var u=h.length;if(u<2)return u?Od(h,a):h;var p=Od(h,Gl(a/Vr(h)));return qr(h)?zn(us(p),0,a).join(""):p.slice(0,a)}function yA(a,h,u,p){var v=h&T,y=la(a);function P(){for(var R=-1,B=arguments.length,H=-1,W=p.length,j=U(W+B),tt=this&&this!==ti&&this instanceof P?y:a;++H<W;)j[H]=p[H];for(;B--;)j[H++]=arguments[++R];return Wi(tt,v?u:this,j)}return P}function Bg(a){return function(h,u,p){return p&&typeof p!="number"&&yi(h,u,p)&&(u=p=e),h=nn(h),u===e?(u=h,h=0):u=nn(u),p=p===e?h<u?1:-1:nn(p),aA(h,u,p,a)}}function nh(a){return function(h,u){return typeof h=="string"&&typeof u=="string"||(h=os(h),u=os(u)),a(h,u)}}function Og(a,h,u,p,v,y,P,R,B,H){var W=h&E,j=W?P:e,tt=W?e:P,rt=W?y:e,gt=W?e:y;h|=W?O:N,h&=~(W?N:O),h&S||(h&=~(T|A));var Lt=[a,h,v,rt,j,gt,tt,R,B,H],mt=u.apply(e,Lt);return Kd(a)&&Zg(mt,Lt),mt.placeholder=p,Yg(mt,a,h)}function jd(a){var h=Ne[a];return function(u,p){if(u=os(u),p=p==null?0:li(It(p),292),p&&Yp(u)){var v=(Xt(u)+"e").split("e"),y=h(v[0]+"e"+(+v[1]+p));return v=(Xt(y)+"e").split("e"),+(v[0]+"e"+(+v[1]-p))}return h(u)}}var CA=Yr&&1/Dl(new Yr([,-0]))[1]==G?function(a){return new Yr(a)}:_u;function Ug(a){return function(h){var u=hi(h);return u==_e?bd(h):u==Hi?HC(h):MC(h,a(h))}}function Js(a,h,u,p,v,y,P,R){var B=h&A;if(!B&&typeof a!="function")throw new es(o);var H=p?p.length:0;if(H||(h&=~(O|N),p=v=e),P=P===e?P:Ge(It(P),0),R=R===e?R:It(R),H-=v?v.length:0,h&N){var W=p,j=v;p=v=e}var tt=B?e:Xd(a),rt=[a,h,u,p,v,W,j,y,P,R];if(tt&&UA(rt,tt),a=rt[0],h=rt[1],u=rt[2],p=rt[3],v=rt[4],R=rt[9]=rt[9]===e?B?0:a.length:Ge(rt[9]-H,0),!R&&h&(E|M)&&(h&=~(E|M)),!h||h==T)var gt=xA(a,h,u);else h==E||h==M?gt=bA(a,h,R):(h==O||h==(T|O))&&!v.length?gt=yA(a,h,u,p):gt=eh.apply(e,rt);var Lt=tt?vg:Zg;return Yg(Lt(gt,rt),a,h)}function zg(a,h,u,p){return a===e||fs(a,Zr[u])&&!Yt.call(p,u)?h:a}function Hg(a,h,u,p,v,y){return ve(a)&&ve(h)&&(y.set(h,a),Ql(a,h,e,Hg,y),y.delete(h)),a}function AA(a){return da(a)?e:a}function Wg(a,h,u,p,v,y){var P=u&x,R=a.length,B=h.length;if(R!=B&&!(P&&B>R))return!1;var H=y.get(a),W=y.get(h);if(H&&W)return H==h&&W==a;var j=-1,tt=!0,rt=u&C?new cr:e;for(y.set(a,h),y.set(h,a);++j<R;){var gt=a[j],Lt=h[j];if(p)var mt=P?p(Lt,gt,j,h,a,y):p(gt,Lt,j,a,h,y);if(mt!==e){if(mt)continue;tt=!1;break}if(rt){if(!pd(h,function(zt,Nt){if(!Qo(rt,Nt)&&(gt===zt||v(gt,zt,u,p,y)))return rt.push(Nt)})){tt=!1;break}}else if(!(gt===Lt||v(gt,Lt,u,p,y))){tt=!1;break}}return y.delete(a),y.delete(h),tt}function SA(a,h,u,p,v,y,P){switch(u){case Gr:if(a.byteLength!=h.byteLength||a.byteOffset!=h.byteOffset)return!1;a=a.buffer,h=h.buffer;case Yo:return!(a.byteLength!=h.byteLength||!y(new zl(a),new zl(h)));case zi:case Re:case Ki:return fs(+a,+h);case te:return a.name==h.name&&a.message==h.message;case ds:case Xo:return a==h+"";case _e:var R=bd;case Hi:var B=p&x;if(R||(R=Dl),a.size!=h.size&&!B)return!1;var H=P.get(a);if(H)return H==h;p|=C,P.set(a,h);var W=Wg(R(a),R(h),p,v,y,P);return P.delete(a),W;case El:if(ia)return ia.call(a)==ia.call(h)}return!1}function TA(a,h,u,p,v,y){var P=u&x,R=qd(a),B=R.length,H=qd(h),W=H.length;if(B!=W&&!P)return!1;for(var j=B;j--;){var tt=R[j];if(!(P?tt in h:Yt.call(h,tt)))return!1}var rt=y.get(a),gt=y.get(h);if(rt&&gt)return rt==h&&gt==a;var Lt=!0;y.set(a,h),y.set(h,a);for(var mt=P;++j<B;){tt=R[j];var zt=a[tt],Nt=h[tt];if(p)var ji=P?p(Nt,zt,tt,h,a,y):p(zt,Nt,tt,a,h,y);if(!(ji===e?zt===Nt||v(zt,Nt,u,p,y):ji)){Lt=!1;break}mt||(mt=tt=="constructor")}if(Lt&&!mt){var Ci=a.constructor,qi=h.constructor;Ci!=qi&&"constructor"in a&&"constructor"in h&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof qi=="function"&&qi instanceof qi)&&(Lt=!1)}return y.delete(a),y.delete(h),Lt}function tn(a){return tu(Vg(a,e,im),a+"")}function qd(a){return ag(a,Ze,Yd)}function Vd(a){return ag(a,Ri,Ng)}var Xd=jl?function(a){return jl.get(a)}:_u;function rh(a){for(var h=a.name+"",u=Qr[h],p=Yt.call(Qr,h)?u.length:0;p--;){var v=u[p],y=v.func;if(y==null||y==a)return v.name}return h}function eo(a){var h=Yt.call(b,"placeholder")?b:a;return h.placeholder}function ut(){var a=b.iteratee||du;return a=a===du?cg:a,arguments.length?a(arguments[0],arguments[1]):a}function oh(a,h){var u=a.__data__;return LA(h)?u[typeof h=="string"?"string":"hash"]:u.map}function Zd(a){for(var h=Ze(a),u=h.length;u--;){var p=h[u],v=a[p];h[u]=[p,v,jg(v)]}return h}function _r(a,h){var u=OC(a,h);return hg(u)?u:e}function EA(a){var h=Yt.call(a,lr),u=a[lr];try{a[lr]=e;var p=!0}catch{}var v=Ol.call(a);return p&&(h?a[lr]=u:delete a[lr]),v}var Yd=Cd?function(a){return a==null?[]:(a=se(a),Mn(Cd(a),function(h){return Xp.call(a,h)}))}:fu,Ng=Cd?function(a){for(var h=[];a;)Dn(h,Yd(a)),a=Hl(a);return h}:fu,hi=bi;(Ad&&hi(new Ad(new ArrayBuffer(1)))!=Gr||Jo&&hi(new Jo)!=_e||Sd&&hi(Sd.resolve())!=Is||Yr&&hi(new Yr)!=Hi||ta&&hi(new ta)!=Zo)&&(hi=function(a){var h=bi(a),u=h==ai?a.constructor:e,p=u?fr(u):"";if(p)switch(p){case h1:return Gr;case c1:return _e;case d1:return Is;case u1:return Hi;case _1:return Zo}return h});function PA(a,h,u){for(var p=-1,v=u.length;++p<v;){var y=u[p],P=y.size;switch(y.type){case"drop":a+=P;break;case"dropRight":h-=P;break;case"take":h=li(h,a+P);break;case"takeRight":a=Ge(a,h-P);break}}return{start:a,end:h}}function kA(a){var h=a.match(Fy);return h?h[1].split(By):[]}function Gg(a,h,u){h=Un(h,a);for(var p=-1,v=h.length,y=!1;++p<v;){var P=Ds(h[p]);if(!(y=a!=null&&u(a,P)))break;a=a[P]}return y||++p!=v?y:(v=a==null?0:a.length,!!v&&_h(v)&&en(P,v)&&(Tt(a)||pr(a)))}function IA(a){var h=a.length,u=new a.constructor(h);return h&&typeof a[0]=="string"&&Yt.call(a,"index")&&(u.index=a.index,u.input=a.input),u}function $g(a){return typeof a.constructor=="function"&&!ha(a)?Kr(Hl(a)):{}}function RA(a,h,u){var p=a.constructor;switch(h){case Yo:return Gd(a);case zi:case Re:return new p(+a);case Gr:return fA(a,u);case Zc:case Yc:case Qc:case Kc:case Jc:case td:case ed:case id:case sd:return Tg(a,u);case _e:return new p;case Ki:case Xo:return new p(a);case ds:return pA(a);case Hi:return new p;case El:return gA(a)}}function MA(a,h){var u=h.length;if(!u)return a;var p=u-1;return h[p]=(u>1?"& ":"")+h[p],h=h.join(u>2?", ":" "),a.replace(Ly,`{
/* [wrapped with `+h+`] */
`)}function DA(a){return Tt(a)||pr(a)||!!(Zp&&a&&a[Zp])}function en(a,h){var u=typeof a;return h=h??kt,!!h&&(u=="number"||u!="symbol"&&jy.test(a))&&a>-1&&a%1==0&&a<h}function yi(a,h,u){if(!ve(u))return!1;var p=typeof h;return(p=="number"?Ii(u)&&en(h,u.length):p=="string"&&h in u)?fs(u[h],a):!1}function Qd(a,h){if(Tt(a))return!1;var u=typeof a;return u=="number"||u=="symbol"||u=="boolean"||a==null||$i(a)?!0:Iy.test(a)||!ky.test(a)||h!=null&&a in se(h)}function LA(a){var h=typeof a;return h=="string"||h=="number"||h=="symbol"||h=="boolean"?a!=="__proto__":a===null}function Kd(a){var h=rh(a),u=b[h];if(typeof u!="function"||!(h in Wt.prototype))return!1;if(a===u)return!0;var p=Xd(u);return!!p&&a===p[0]}function FA(a){return!!jp&&jp in a}var BA=Fl?sn:pu;function ha(a){var h=a&&a.constructor,u=typeof h=="function"&&h.prototype||Zr;return a===u}function jg(a){return a===a&&!ve(a)}function qg(a,h){return function(u){return u==null?!1:u[a]===h&&(h!==e||a in se(u))}}function OA(a){var h=dh(a,function(p){return u.size===d&&u.clear(),p}),u=h.cache;return h}function UA(a,h){var u=a[1],p=h[1],v=u|p,y=v<(T|A|F),P=p==F&&u==E||p==F&&u==K&&a[7].length<=h[8]||p==(F|K)&&h[7].length<=h[8]&&u==E;if(!(y||P))return a;p&T&&(a[2]=h[2],v|=u&T?0:S);var R=h[3];if(R){var B=a[3];a[3]=B?Pg(B,R,h[4]):R,a[4]=B?Ln(a[3],_):h[4]}return R=h[5],R&&(B=a[5],a[5]=B?kg(B,R,h[6]):R,a[6]=B?Ln(a[5],_):h[6]),R=h[7],R&&(a[7]=R),p&F&&(a[8]=a[8]==null?h[8]:li(a[8],h[8])),a[9]==null&&(a[9]=h[9]),a[0]=h[0],a[1]=v,a}function zA(a){var h=[];if(a!=null)for(var u in se(a))h.push(u);return h}function HA(a){return Ol.call(a)}function Vg(a,h,u){return h=Ge(h===e?a.length-1:h,0),function(){for(var p=arguments,v=-1,y=Ge(p.length-h,0),P=U(y);++v<y;)P[v]=p[h+v];v=-1;for(var R=U(h+1);++v<h;)R[v]=p[v];return R[h]=u(P),Wi(a,this,R)}}function Xg(a,h){return h.length<2?a:ur(a,ns(h,0,-1))}function WA(a,h){for(var u=a.length,p=li(h.length,u),v=ki(a);p--;){var y=h[p];a[p]=en(y,u)?v[y]:e}return a}function Jd(a,h){if(!(h==="constructor"&&typeof a[h]=="function")&&h!="__proto__")return a[h]}var Zg=Qg(vg),ca=i1||function(a,h){return ti.setTimeout(a,h)},tu=Qg(cA);function Yg(a,h,u){var p=h+"";return tu(a,MA(p,NA(kA(p),u)))}function Qg(a){var h=0,u=0;return function(){var p=o1(),v=bt-(p-u);if(u=p,v>0){if(++h>=ct)return arguments[0]}else h=0;return a.apply(e,arguments)}}function ah(a,h){var u=-1,p=a.length,v=p-1;for(h=h===e?p:h;++u<h;){var y=Bd(u,v),P=a[y];a[y]=a[u],a[u]=P}return a.length=h,a}var Kg=OA(function(a){var h=[];return a.charCodeAt(0)===46&&h.push(""),a.replace(Ry,function(u,p,v,y){h.push(v?y.replace(zy,"$1"):p||u)}),h});function Ds(a){if(typeof a=="string"||$i(a))return a;var h=a+"";return h=="0"&&1/a==-G?"-0":h}function fr(a){if(a!=null){try{return Bl.call(a)}catch{}try{return a+""}catch{}}return""}function NA(a,h){return ts(Se,function(u){var p="_."+u[0];h&u[1]&&!Rl(a,p)&&a.push(p)}),a.sort()}function Jg(a){if(a instanceof Wt)return a.clone();var h=new is(a.__wrapped__,a.__chain__);return h.__actions__=ki(a.__actions__),h.__index__=a.__index__,h.__values__=a.__values__,h}function GA(a,h,u){(u?yi(a,h,u):h===e)?h=1:h=Ge(It(h),0);var p=a==null?0:a.length;if(!p||h<1)return[];for(var v=0,y=0,P=U(Gl(p/h));v<p;)P[y++]=ns(a,v,v+=h);return P}function $A(a){for(var h=-1,u=a==null?0:a.length,p=0,v=[];++h<u;){var y=a[h];y&&(v[p++]=y)}return v}function jA(){var a=arguments.length;if(!a)return[];for(var h=U(a-1),u=arguments[0],p=a;p--;)h[p-1]=arguments[p];return Dn(Tt(u)?ki(u):[u],ei(h,1))}var qA=Ot(function(a,h){return Me(a)?na(a,ei(h,1,Me,!0)):[]}),VA=Ot(function(a,h){var u=rs(h);return Me(u)&&(u=e),Me(a)?na(a,ei(h,1,Me,!0),ut(u,2)):[]}),XA=Ot(function(a,h){var u=rs(h);return Me(u)&&(u=e),Me(a)?na(a,ei(h,1,Me,!0),e,u):[]});function ZA(a,h,u){var p=a==null?0:a.length;return p?(h=u||h===e?1:It(h),ns(a,h<0?0:h,p)):[]}function YA(a,h,u){var p=a==null?0:a.length;return p?(h=u||h===e?1:It(h),h=p-h,ns(a,0,h<0?0:h)):[]}function QA(a,h){return a&&a.length?Jl(a,ut(h,3),!0,!0):[]}function KA(a,h){return a&&a.length?Jl(a,ut(h,3),!0):[]}function JA(a,h,u,p){var v=a==null?0:a.length;return v?(u&&typeof u!="number"&&yi(a,h,u)&&(u=0,p=v),j1(a,h,u,p)):[]}function tm(a,h,u){var p=a==null?0:a.length;if(!p)return-1;var v=u==null?0:It(u);return v<0&&(v=Ge(p+v,0)),Ml(a,ut(h,3),v)}function em(a,h,u){var p=a==null?0:a.length;if(!p)return-1;var v=p-1;return u!==e&&(v=It(u),v=u<0?Ge(p+v,0):li(v,p-1)),Ml(a,ut(h,3),v,!0)}function im(a){var h=a==null?0:a.length;return h?ei(a,1):[]}function tS(a){var h=a==null?0:a.length;return h?ei(a,G):[]}function eS(a,h){var u=a==null?0:a.length;return u?(h=h===e?1:It(h),ei(a,h)):[]}function iS(a){for(var h=-1,u=a==null?0:a.length,p={};++h<u;){var v=a[h];p[v[0]]=v[1]}return p}function sm(a){return a&&a.length?a[0]:e}function sS(a,h,u){var p=a==null?0:a.length;if(!p)return-1;var v=u==null?0:It(u);return v<0&&(v=Ge(p+v,0)),jr(a,h,v)}function nS(a){var h=a==null?0:a.length;return h?ns(a,0,-1):[]}var rS=Ot(function(a){var h=fe(a,Wd);return h.length&&h[0]===a[0]?Rd(h):[]}),oS=Ot(function(a){var h=rs(a),u=fe(a,Wd);return h===rs(u)?h=e:u.pop(),u.length&&u[0]===a[0]?Rd(u,ut(h,2)):[]}),aS=Ot(function(a){var h=rs(a),u=fe(a,Wd);return h=typeof h=="function"?h:e,h&&u.pop(),u.length&&u[0]===a[0]?Rd(u,e,h):[]});function lS(a,h){return a==null?"":n1.call(a,h)}function rs(a){var h=a==null?0:a.length;return h?a[h-1]:e}function hS(a,h,u){var p=a==null?0:a.length;if(!p)return-1;var v=p;return u!==e&&(v=It(u),v=v<0?Ge(p+v,0):li(v,p-1)),h===h?NC(a,h,v):Ml(a,Op,v,!0)}function cS(a,h){return a&&a.length?fg(a,It(h)):e}var dS=Ot(nm);function nm(a,h){return a&&a.length&&h&&h.length?Fd(a,h):a}function uS(a,h,u){return a&&a.length&&h&&h.length?Fd(a,h,ut(u,2)):a}function _S(a,h,u){return a&&a.length&&h&&h.length?Fd(a,h,e,u):a}var fS=tn(function(a,h){var u=a==null?0:a.length,p=Ed(a,h);return mg(a,fe(h,function(v){return en(v,u)?+v:v}).sort(Eg)),p});function pS(a,h){var u=[];if(!(a&&a.length))return u;var p=-1,v=[],y=a.length;for(h=ut(h,3);++p<y;){var P=a[p];h(P,p,a)&&(u.push(P),v.push(p))}return mg(a,v),u}function eu(a){return a==null?a:l1.call(a)}function gS(a,h,u){var p=a==null?0:a.length;return p?(u&&typeof u!="number"&&yi(a,h,u)?(h=0,u=p):(h=h==null?0:It(h),u=u===e?p:It(u)),ns(a,h,u)):[]}function mS(a,h){return Kl(a,h)}function vS(a,h,u){return Ud(a,h,ut(u,2))}function wS(a,h){var u=a==null?0:a.length;if(u){var p=Kl(a,h);if(p<u&&fs(a[p],h))return p}return-1}function xS(a,h){return Kl(a,h,!0)}function bS(a,h,u){return Ud(a,h,ut(u,2),!0)}function yS(a,h){var u=a==null?0:a.length;if(u){var p=Kl(a,h,!0)-1;if(fs(a[p],h))return p}return-1}function CS(a){return a&&a.length?wg(a):[]}function AS(a,h){return a&&a.length?wg(a,ut(h,2)):[]}function SS(a){var h=a==null?0:a.length;return h?ns(a,1,h):[]}function TS(a,h,u){return a&&a.length?(h=u||h===e?1:It(h),ns(a,0,h<0?0:h)):[]}function ES(a,h,u){var p=a==null?0:a.length;return p?(h=u||h===e?1:It(h),h=p-h,ns(a,h<0?0:h,p)):[]}function PS(a,h){return a&&a.length?Jl(a,ut(h,3),!1,!0):[]}function kS(a,h){return a&&a.length?Jl(a,ut(h,3)):[]}var IS=Ot(function(a){return On(ei(a,1,Me,!0))}),RS=Ot(function(a){var h=rs(a);return Me(h)&&(h=e),On(ei(a,1,Me,!0),ut(h,2))}),MS=Ot(function(a){var h=rs(a);return h=typeof h=="function"?h:e,On(ei(a,1,Me,!0),e,h)});function DS(a){return a&&a.length?On(a):[]}function LS(a,h){return a&&a.length?On(a,ut(h,2)):[]}function FS(a,h){return h=typeof h=="function"?h:e,a&&a.length?On(a,e,h):[]}function iu(a){if(!(a&&a.length))return[];var h=0;return a=Mn(a,function(u){if(Me(u))return h=Ge(u.length,h),!0}),wd(h,function(u){return fe(a,gd(u))})}function rm(a,h){if(!(a&&a.length))return[];var u=iu(a);return h==null?u:fe(u,function(p){return Wi(h,e,p)})}var BS=Ot(function(a,h){return Me(a)?na(a,h):[]}),OS=Ot(function(a){return Hd(Mn(a,Me))}),US=Ot(function(a){var h=rs(a);return Me(h)&&(h=e),Hd(Mn(a,Me),ut(h,2))}),zS=Ot(function(a){var h=rs(a);return h=typeof h=="function"?h:e,Hd(Mn(a,Me),e,h)}),HS=Ot(iu);function WS(a,h){return Cg(a||[],h||[],sa)}function NS(a,h){return Cg(a||[],h||[],aa)}var GS=Ot(function(a){var h=a.length,u=h>1?a[h-1]:e;return u=typeof u=="function"?(a.pop(),u):e,rm(a,u)});function om(a){var h=b(a);return h.__chain__=!0,h}function $S(a,h){return h(a),a}function lh(a,h){return h(a)}var jS=tn(function(a){var h=a.length,u=h?a[0]:0,p=this.__wrapped__,v=function(y){return Ed(y,a)};return h>1||this.__actions__.length||!(p instanceof Wt)||!en(u)?this.thru(v):(p=p.slice(u,+u+(h?1:0)),p.__actions__.push({func:lh,args:[v],thisArg:e}),new is(p,this.__chain__).thru(function(y){return h&&!y.length&&y.push(e),y}))});function qS(){return om(this)}function VS(){return new is(this.value(),this.__chain__)}function XS(){this.__values__===e&&(this.__values__=xm(this.value()));var a=this.__index__>=this.__values__.length,h=a?e:this.__values__[this.__index__++];return{done:a,value:h}}function ZS(){return this}function YS(a){for(var h,u=this;u instanceof Vl;){var p=Jg(u);p.__index__=0,p.__values__=e,h?v.__wrapped__=p:h=p;var v=p;u=u.__wrapped__}return v.__wrapped__=a,h}function QS(){var a=this.__wrapped__;if(a instanceof Wt){var h=a;return this.__actions__.length&&(h=new Wt(this)),h=h.reverse(),h.__actions__.push({func:lh,args:[eu],thisArg:e}),new is(h,this.__chain__)}return this.thru(eu)}function KS(){return yg(this.__wrapped__,this.__actions__)}var JS=th(function(a,h,u){Yt.call(a,u)?++a[u]:Ks(a,u,1)});function tT(a,h,u){var p=Tt(a)?Fp:$1;return u&&yi(a,h,u)&&(h=e),p(a,ut(h,3))}function eT(a,h){var u=Tt(a)?Mn:rg;return u(a,ut(h,3))}var iT=Dg(tm),sT=Dg(em);function nT(a,h){return ei(hh(a,h),1)}function rT(a,h){return ei(hh(a,h),G)}function oT(a,h,u){return u=u===e?1:It(u),ei(hh(a,h),u)}function am(a,h){var u=Tt(a)?ts:Bn;return u(a,ut(h,3))}function lm(a,h){var u=Tt(a)?SC:ng;return u(a,ut(h,3))}var aT=th(function(a,h,u){Yt.call(a,u)?a[u].push(h):Ks(a,u,[h])});function lT(a,h,u,p){a=Ii(a)?a:so(a),u=u&&!p?It(u):0;var v=a.length;return u<0&&(u=Ge(v+u,0)),fh(a)?u<=v&&a.indexOf(h,u)>-1:!!v&&jr(a,h,u)>-1}var hT=Ot(function(a,h,u){var p=-1,v=typeof h=="function",y=Ii(a)?U(a.length):[];return Bn(a,function(P){y[++p]=v?Wi(h,P,u):ra(P,h,u)}),y}),cT=th(function(a,h,u){Ks(a,u,h)});function hh(a,h){var u=Tt(a)?fe:dg;return u(a,ut(h,3))}function dT(a,h,u,p){return a==null?[]:(Tt(h)||(h=h==null?[]:[h]),u=p?e:u,Tt(u)||(u=u==null?[]:[u]),pg(a,h,u))}var uT=th(function(a,h,u){a[u?0:1].push(h)},function(){return[[],[]]});function _T(a,h,u){var p=Tt(a)?fd:zp,v=arguments.length<3;return p(a,ut(h,4),u,v,Bn)}function fT(a,h,u){var p=Tt(a)?TC:zp,v=arguments.length<3;return p(a,ut(h,4),u,v,ng)}function pT(a,h){var u=Tt(a)?Mn:rg;return u(a,uh(ut(h,3)))}function gT(a){var h=Tt(a)?tg:lA;return h(a)}function mT(a,h,u){(u?yi(a,h,u):h===e)?h=1:h=It(h);var p=Tt(a)?z1:hA;return p(a,h)}function vT(a){var h=Tt(a)?H1:dA;return h(a)}function wT(a){if(a==null)return 0;if(Ii(a))return fh(a)?Vr(a):a.length;var h=hi(a);return h==_e||h==Hi?a.size:Dd(a).length}function xT(a,h,u){var p=Tt(a)?pd:uA;return u&&yi(a,h,u)&&(h=e),p(a,ut(h,3))}var bT=Ot(function(a,h){if(a==null)return[];var u=h.length;return u>1&&yi(a,h[0],h[1])?h=[]:u>2&&yi(h[0],h[1],h[2])&&(h=[h[0]]),pg(a,ei(h,1),[])}),ch=e1||function(){return ti.Date.now()};function yT(a,h){if(typeof h!="function")throw new es(o);return a=It(a),function(){if(--a<1)return h.apply(this,arguments)}}function hm(a,h,u){return h=u?e:h,h=a&&h==null?a.length:h,Js(a,F,e,e,e,e,h)}function cm(a,h){var u;if(typeof h!="function")throw new es(o);return a=It(a),function(){return--a>0&&(u=h.apply(this,arguments)),a<=1&&(h=e),u}}var su=Ot(function(a,h,u){var p=T;if(u.length){var v=Ln(u,eo(su));p|=O}return Js(a,p,h,u,v)}),dm=Ot(function(a,h,u){var p=T|A;if(u.length){var v=Ln(u,eo(dm));p|=O}return Js(h,p,a,u,v)});function um(a,h,u){h=u?e:h;var p=Js(a,E,e,e,e,e,e,h);return p.placeholder=um.placeholder,p}function _m(a,h,u){h=u?e:h;var p=Js(a,M,e,e,e,e,e,h);return p.placeholder=_m.placeholder,p}function fm(a,h,u){var p,v,y,P,R,B,H=0,W=!1,j=!1,tt=!0;if(typeof a!="function")throw new es(o);h=os(h)||0,ve(u)&&(W=!!u.leading,j="maxWait"in u,y=j?Ge(os(u.maxWait)||0,h):y,tt="trailing"in u?!!u.trailing:tt);function rt(De){var ps=p,rn=v;return p=v=e,H=De,P=a.apply(rn,ps),P}function gt(De){return H=De,R=ca(zt,h),W?rt(De):P}function Lt(De){var ps=De-B,rn=De-H,Dm=h-ps;return j?li(Dm,y-rn):Dm}function mt(De){var ps=De-B,rn=De-H;return B===e||ps>=h||ps<0||j&&rn>=y}function zt(){var De=ch();if(mt(De))return Nt(De);R=ca(zt,Lt(De))}function Nt(De){return R=e,tt&&p?rt(De):(p=v=e,P)}function ji(){R!==e&&Ag(R),H=0,p=B=v=R=e}function Ci(){return R===e?P:Nt(ch())}function qi(){var De=ch(),ps=mt(De);if(p=arguments,v=this,B=De,ps){if(R===e)return gt(B);if(j)return Ag(R),R=ca(zt,h),rt(B)}return R===e&&(R=ca(zt,h)),P}return qi.cancel=ji,qi.flush=Ci,qi}var CT=Ot(function(a,h){return sg(a,1,h)}),AT=Ot(function(a,h,u){return sg(a,os(h)||0,u)});function ST(a){return Js(a,nt)}function dh(a,h){if(typeof a!="function"||h!=null&&typeof h!="function")throw new es(o);var u=function(){var p=arguments,v=h?h.apply(this,p):p[0],y=u.cache;if(y.has(v))return y.get(v);var P=a.apply(this,p);return u.cache=y.set(v,P)||y,P};return u.cache=new(dh.Cache||Qs),u}dh.Cache=Qs;function uh(a){if(typeof a!="function")throw new es(o);return function(){var h=arguments;switch(h.length){case 0:return!a.call(this);case 1:return!a.call(this,h[0]);case 2:return!a.call(this,h[0],h[1]);case 3:return!a.call(this,h[0],h[1],h[2])}return!a.apply(this,h)}}function TT(a){return cm(2,a)}var ET=_A(function(a,h){h=h.length==1&&Tt(h[0])?fe(h[0],Ni(ut())):fe(ei(h,1),Ni(ut()));var u=h.length;return Ot(function(p){for(var v=-1,y=li(p.length,u);++v<y;)p[v]=h[v].call(this,p[v]);return Wi(a,this,p)})}),nu=Ot(function(a,h){var u=Ln(h,eo(nu));return Js(a,O,e,h,u)}),pm=Ot(function(a,h){var u=Ln(h,eo(pm));return Js(a,N,e,h,u)}),PT=tn(function(a,h){return Js(a,K,e,e,e,h)});function kT(a,h){if(typeof a!="function")throw new es(o);return h=h===e?h:It(h),Ot(a,h)}function IT(a,h){if(typeof a!="function")throw new es(o);return h=h==null?0:Ge(It(h),0),Ot(function(u){var p=u[h],v=zn(u,0,h);return p&&Dn(v,p),Wi(a,this,v)})}function RT(a,h,u){var p=!0,v=!0;if(typeof a!="function")throw new es(o);return ve(u)&&(p="leading"in u?!!u.leading:p,v="trailing"in u?!!u.trailing:v),fm(a,h,{leading:p,maxWait:h,trailing:v})}function MT(a){return hm(a,1)}function DT(a,h){return nu(Nd(h),a)}function LT(){if(!arguments.length)return[];var a=arguments[0];return Tt(a)?a:[a]}function FT(a){return ss(a,m)}function BT(a,h){return h=typeof h=="function"?h:e,ss(a,m,h)}function OT(a){return ss(a,f|m)}function UT(a,h){return h=typeof h=="function"?h:e,ss(a,f|m,h)}function zT(a,h){return h==null||ig(a,h,Ze(h))}function fs(a,h){return a===h||a!==a&&h!==h}var HT=nh(Id),WT=nh(function(a,h){return a>=h}),pr=lg(function(){return arguments}())?lg:function(a){return Te(a)&&Yt.call(a,"callee")&&!Xp.call(a,"callee")},Tt=U.isArray,NT=kp?Ni(kp):Y1;function Ii(a){return a!=null&&_h(a.length)&&!sn(a)}function Me(a){return Te(a)&&Ii(a)}function GT(a){return a===!0||a===!1||Te(a)&&bi(a)==zi}var Hn=s1||pu,$T=Ip?Ni(Ip):Q1;function jT(a){return Te(a)&&a.nodeType===1&&!da(a)}function qT(a){if(a==null)return!0;if(Ii(a)&&(Tt(a)||typeof a=="string"||typeof a.splice=="function"||Hn(a)||io(a)||pr(a)))return!a.length;var h=hi(a);if(h==_e||h==Hi)return!a.size;if(ha(a))return!Dd(a).length;for(var u in a)if(Yt.call(a,u))return!1;return!0}function VT(a,h){return oa(a,h)}function XT(a,h,u){u=typeof u=="function"?u:e;var p=u?u(a,h):e;return p===e?oa(a,h,e,u):!!p}function ru(a){if(!Te(a))return!1;var h=bi(a);return h==te||h==ue||typeof a.message=="string"&&typeof a.name=="string"&&!da(a)}function ZT(a){return typeof a=="number"&&Yp(a)}function sn(a){if(!ve(a))return!1;var h=bi(a);return h==xi||h==Zs||h==Je||h==cs}function gm(a){return typeof a=="number"&&a==It(a)}function _h(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=kt}function ve(a){var h=typeof a;return a!=null&&(h=="object"||h=="function")}function Te(a){return a!=null&&typeof a=="object"}var mm=Rp?Ni(Rp):J1;function YT(a,h){return a===h||Md(a,h,Zd(h))}function QT(a,h,u){return u=typeof u=="function"?u:e,Md(a,h,Zd(h),u)}function KT(a){return vm(a)&&a!=+a}function JT(a){if(BA(a))throw new St(r);return hg(a)}function tE(a){return a===null}function eE(a){return a==null}function vm(a){return typeof a=="number"||Te(a)&&bi(a)==Ki}function da(a){if(!Te(a)||bi(a)!=ai)return!1;var h=Hl(a);if(h===null)return!0;var u=Yt.call(h,"constructor")&&h.constructor;return typeof u=="function"&&u instanceof u&&Bl.call(u)==QC}var ou=Mp?Ni(Mp):tA;function iE(a){return gm(a)&&a>=-kt&&a<=kt}var wm=Dp?Ni(Dp):eA;function fh(a){return typeof a=="string"||!Tt(a)&&Te(a)&&bi(a)==Xo}function $i(a){return typeof a=="symbol"||Te(a)&&bi(a)==El}var io=Lp?Ni(Lp):iA;function sE(a){return a===e}function nE(a){return Te(a)&&hi(a)==Zo}function rE(a){return Te(a)&&bi(a)==by}var oE=nh(Ld),aE=nh(function(a,h){return a<=h});function xm(a){if(!a)return[];if(Ii(a))return fh(a)?us(a):ki(a);if(Ko&&a[Ko])return zC(a[Ko]());var h=hi(a),u=h==_e?bd:h==Hi?Dl:so;return u(a)}function nn(a){if(!a)return a===0?a:0;if(a=os(a),a===G||a===-G){var h=a<0?-1:1;return h*Ht}return a===a?a:0}function It(a){var h=nn(a),u=h%1;return h===h?u?h-u:h:0}function bm(a){return a?dr(It(a),0,Dt):0}function os(a){if(typeof a=="number")return a;if($i(a))return At;if(ve(a)){var h=typeof a.valueOf=="function"?a.valueOf():a;a=ve(h)?h+"":h}if(typeof a!="string")return a===0?a:+a;a=Hp(a);var u=Ny.test(a);return u||$y.test(a)?yC(a.slice(2),u?2:8):Wy.test(a)?At:+a}function ym(a){return Ms(a,Ri(a))}function lE(a){return a?dr(It(a),-kt,kt):a===0?a:0}function Xt(a){return a==null?"":Gi(a)}var hE=Jr(function(a,h){if(ha(h)||Ii(h)){Ms(h,Ze(h),a);return}for(var u in h)Yt.call(h,u)&&sa(a,u,h[u])}),Cm=Jr(function(a,h){Ms(h,Ri(h),a)}),ph=Jr(function(a,h,u,p){Ms(h,Ri(h),a,p)}),cE=Jr(function(a,h,u,p){Ms(h,Ze(h),a,p)}),dE=tn(Ed);function uE(a,h){var u=Kr(a);return h==null?u:eg(u,h)}var _E=Ot(function(a,h){a=se(a);var u=-1,p=h.length,v=p>2?h[2]:e;for(v&&yi(h[0],h[1],v)&&(p=1);++u<p;)for(var y=h[u],P=Ri(y),R=-1,B=P.length;++R<B;){var H=P[R],W=a[H];(W===e||fs(W,Zr[H])&&!Yt.call(a,H))&&(a[H]=y[H])}return a}),fE=Ot(function(a){return a.push(e,Hg),Wi(Am,e,a)});function pE(a,h){return Bp(a,ut(h,3),Rs)}function gE(a,h){return Bp(a,ut(h,3),kd)}function mE(a,h){return a==null?a:Pd(a,ut(h,3),Ri)}function vE(a,h){return a==null?a:og(a,ut(h,3),Ri)}function wE(a,h){return a&&Rs(a,ut(h,3))}function xE(a,h){return a&&kd(a,ut(h,3))}function bE(a){return a==null?[]:Yl(a,Ze(a))}function yE(a){return a==null?[]:Yl(a,Ri(a))}function au(a,h,u){var p=a==null?e:ur(a,h);return p===e?u:p}function CE(a,h){return a!=null&&Gg(a,h,q1)}function lu(a,h){return a!=null&&Gg(a,h,V1)}var AE=Fg(function(a,h,u){h!=null&&typeof h.toString!="function"&&(h=Ol.call(h)),a[h]=u},cu(Mi)),SE=Fg(function(a,h,u){h!=null&&typeof h.toString!="function"&&(h=Ol.call(h)),Yt.call(a,h)?a[h].push(u):a[h]=[u]},ut),TE=Ot(ra);function Ze(a){return Ii(a)?Jp(a):Dd(a)}function Ri(a){return Ii(a)?Jp(a,!0):sA(a)}function EE(a,h){var u={};return h=ut(h,3),Rs(a,function(p,v,y){Ks(u,h(p,v,y),p)}),u}function PE(a,h){var u={};return h=ut(h,3),Rs(a,function(p,v,y){Ks(u,v,h(p,v,y))}),u}var kE=Jr(function(a,h,u){Ql(a,h,u)}),Am=Jr(function(a,h,u,p){Ql(a,h,u,p)}),IE=tn(function(a,h){var u={};if(a==null)return u;var p=!1;h=fe(h,function(y){return y=Un(y,a),p||(p=y.length>1),y}),Ms(a,Vd(a),u),p&&(u=ss(u,f|g|m,AA));for(var v=h.length;v--;)zd(u,h[v]);return u});function RE(a,h){return Sm(a,uh(ut(h)))}var ME=tn(function(a,h){return a==null?{}:rA(a,h)});function Sm(a,h){if(a==null)return{};var u=fe(Vd(a),function(p){return[p]});return h=ut(h),gg(a,u,function(p,v){return h(p,v[0])})}function DE(a,h,u){h=Un(h,a);var p=-1,v=h.length;for(v||(v=1,a=e);++p<v;){var y=a==null?e:a[Ds(h[p])];y===e&&(p=v,y=u),a=sn(y)?y.call(a):y}return a}function LE(a,h,u){return a==null?a:aa(a,h,u)}function FE(a,h,u,p){return p=typeof p=="function"?p:e,a==null?a:aa(a,h,u,p)}var Tm=Ug(Ze),Em=Ug(Ri);function BE(a,h,u){var p=Tt(a),v=p||Hn(a)||io(a);if(h=ut(h,4),u==null){var y=a&&a.constructor;v?u=p?new y:[]:ve(a)?u=sn(y)?Kr(Hl(a)):{}:u={}}return(v?ts:Rs)(a,function(P,R,B){return h(u,P,R,B)}),u}function OE(a,h){return a==null?!0:zd(a,h)}function UE(a,h,u){return a==null?a:bg(a,h,Nd(u))}function zE(a,h,u,p){return p=typeof p=="function"?p:e,a==null?a:bg(a,h,Nd(u),p)}function so(a){return a==null?[]:xd(a,Ze(a))}function HE(a){return a==null?[]:xd(a,Ri(a))}function WE(a,h,u){return u===e&&(u=h,h=e),u!==e&&(u=os(u),u=u===u?u:0),h!==e&&(h=os(h),h=h===h?h:0),dr(os(a),h,u)}function NE(a,h,u){return h=nn(h),u===e?(u=h,h=0):u=nn(u),a=os(a),X1(a,h,u)}function GE(a,h,u){if(u&&typeof u!="boolean"&&yi(a,h,u)&&(h=u=e),u===e&&(typeof h=="boolean"?(u=h,h=e):typeof a=="boolean"&&(u=a,a=e)),a===e&&h===e?(a=0,h=1):(a=nn(a),h===e?(h=a,a=0):h=nn(h)),a>h){var p=a;a=h,h=p}if(u||a%1||h%1){var v=Qp();return li(a+v*(h-a+bC("1e-"+((v+"").length-1))),h)}return Bd(a,h)}var $E=to(function(a,h,u){return h=h.toLowerCase(),a+(u?Pm(h):h)});function Pm(a){return hu(Xt(a).toLowerCase())}function km(a){return a=Xt(a),a&&a.replace(qy,LC).replace(dC,"")}function jE(a,h,u){a=Xt(a),h=Gi(h);var p=a.length;u=u===e?p:dr(It(u),0,p);var v=u;return u-=h.length,u>=0&&a.slice(u,v)==h}function qE(a){return a=Xt(a),a&&Ty.test(a)?a.replace(op,FC):a}function VE(a){return a=Xt(a),a&&My.test(a)?a.replace(nd,"\\$&"):a}var XE=to(function(a,h,u){return a+(u?"-":"")+h.toLowerCase()}),ZE=to(function(a,h,u){return a+(u?" ":"")+h.toLowerCase()}),YE=Mg("toLowerCase");function QE(a,h,u){a=Xt(a),h=It(h);var p=h?Vr(a):0;if(!h||p>=h)return a;var v=(h-p)/2;return sh($l(v),u)+a+sh(Gl(v),u)}function KE(a,h,u){a=Xt(a),h=It(h);var p=h?Vr(a):0;return h&&p<h?a+sh(h-p,u):a}function JE(a,h,u){a=Xt(a),h=It(h);var p=h?Vr(a):0;return h&&p<h?sh(h-p,u)+a:a}function tP(a,h,u){return u||h==null?h=0:h&&(h=+h),a1(Xt(a).replace(rd,""),h||0)}function eP(a,h,u){return(u?yi(a,h,u):h===e)?h=1:h=It(h),Od(Xt(a),h)}function iP(){var a=arguments,h=Xt(a[0]);return a.length<3?h:h.replace(a[1],a[2])}var sP=to(function(a,h,u){return a+(u?"_":"")+h.toLowerCase()});function nP(a,h,u){return u&&typeof u!="number"&&yi(a,h,u)&&(h=u=e),u=u===e?Dt:u>>>0,u?(a=Xt(a),a&&(typeof h=="string"||h!=null&&!ou(h))&&(h=Gi(h),!h&&qr(a))?zn(us(a),0,u):a.split(h,u)):[]}var rP=to(function(a,h,u){return a+(u?" ":"")+hu(h)});function oP(a,h,u){return a=Xt(a),u=u==null?0:dr(It(u),0,a.length),h=Gi(h),a.slice(u,u+h.length)==h}function aP(a,h,u){var p=b.templateSettings;u&&yi(a,h,u)&&(h=e),a=Xt(a),h=ph({},h,p,zg);var v=ph({},h.imports,p.imports,zg),y=Ze(v),P=xd(v,y),R,B,H=0,W=h.interpolate||Pl,j="__p += '",tt=yd((h.escape||Pl).source+"|"+W.source+"|"+(W===ap?Hy:Pl).source+"|"+(h.evaluate||Pl).source+"|$","g"),rt="//# sourceURL="+(Yt.call(h,"sourceURL")?(h.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++gC+"]")+`
`;a.replace(tt,function(mt,zt,Nt,ji,Ci,qi){return Nt||(Nt=ji),j+=a.slice(H,qi).replace(Vy,BC),zt&&(R=!0,j+=`' +
__e(`+zt+`) +
'`),Ci&&(B=!0,j+=`';
`+Ci+`;
__p += '`),Nt&&(j+=`' +
((__t = (`+Nt+`)) == null ? '' : __t) +
'`),H=qi+mt.length,mt}),j+=`';
`;var gt=Yt.call(h,"variable")&&h.variable;if(!gt)j=`with (obj) {
`+j+`
}
`;else if(Uy.test(gt))throw new St(l);j=(B?j.replace(yy,""):j).replace(Cy,"$1").replace(Ay,"$1;"),j="function("+(gt||"obj")+`) {
`+(gt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(R?", __e = _.escape":"")+(B?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+j+`return __p
}`;var Lt=Rm(function(){return jt(y,rt+"return "+j).apply(e,P)});if(Lt.source=j,ru(Lt))throw Lt;return Lt}function lP(a){return Xt(a).toLowerCase()}function hP(a){return Xt(a).toUpperCase()}function cP(a,h,u){if(a=Xt(a),a&&(u||h===e))return Hp(a);if(!a||!(h=Gi(h)))return a;var p=us(a),v=us(h),y=Wp(p,v),P=Np(p,v)+1;return zn(p,y,P).join("")}function dP(a,h,u){if(a=Xt(a),a&&(u||h===e))return a.slice(0,$p(a)+1);if(!a||!(h=Gi(h)))return a;var p=us(a),v=Np(p,us(h))+1;return zn(p,0,v).join("")}function uP(a,h,u){if(a=Xt(a),a&&(u||h===e))return a.replace(rd,"");if(!a||!(h=Gi(h)))return a;var p=us(a),v=Wp(p,us(h));return zn(p,v).join("")}function _P(a,h){var u=pt,p=ht;if(ve(h)){var v="separator"in h?h.separator:v;u="length"in h?It(h.length):u,p="omission"in h?Gi(h.omission):p}a=Xt(a);var y=a.length;if(qr(a)){var P=us(a);y=P.length}if(u>=y)return a;var R=u-Vr(p);if(R<1)return p;var B=P?zn(P,0,R).join(""):a.slice(0,R);if(v===e)return B+p;if(P&&(R+=B.length-R),ou(v)){if(a.slice(R).search(v)){var H,W=B;for(v.global||(v=yd(v.source,Xt(lp.exec(v))+"g")),v.lastIndex=0;H=v.exec(W);)var j=H.index;B=B.slice(0,j===e?R:j)}}else if(a.indexOf(Gi(v),R)!=R){var tt=B.lastIndexOf(v);tt>-1&&(B=B.slice(0,tt))}return B+p}function fP(a){return a=Xt(a),a&&Sy.test(a)?a.replace(rp,GC):a}var pP=to(function(a,h,u){return a+(u?" ":"")+h.toUpperCase()}),hu=Mg("toUpperCase");function Im(a,h,u){return a=Xt(a),h=u?e:h,h===e?UC(a)?qC(a):kC(a):a.match(h)||[]}var Rm=Ot(function(a,h){try{return Wi(a,e,h)}catch(u){return ru(u)?u:new St(u)}}),gP=tn(function(a,h){return ts(h,function(u){u=Ds(u),Ks(a,u,su(a[u],a))}),a});function mP(a){var h=a==null?0:a.length,u=ut();return a=h?fe(a,function(p){if(typeof p[1]!="function")throw new es(o);return[u(p[0]),p[1]]}):[],Ot(function(p){for(var v=-1;++v<h;){var y=a[v];if(Wi(y[0],this,p))return Wi(y[1],this,p)}})}function vP(a){return G1(ss(a,f))}function cu(a){return function(){return a}}function wP(a,h){return a==null||a!==a?h:a}var xP=Lg(),bP=Lg(!0);function Mi(a){return a}function du(a){return cg(typeof a=="function"?a:ss(a,f))}function yP(a){return ug(ss(a,f))}function CP(a,h){return _g(a,ss(h,f))}var AP=Ot(function(a,h){return function(u){return ra(u,a,h)}}),SP=Ot(function(a,h){return function(u){return ra(a,u,h)}});function uu(a,h,u){var p=Ze(h),v=Yl(h,p);u==null&&!(ve(h)&&(v.length||!p.length))&&(u=h,h=a,a=this,v=Yl(h,Ze(h)));var y=!(ve(u)&&"chain"in u)||!!u.chain,P=sn(a);return ts(v,function(R){var B=h[R];a[R]=B,P&&(a.prototype[R]=function(){var H=this.__chain__;if(y||H){var W=a(this.__wrapped__),j=W.__actions__=ki(this.__actions__);return j.push({func:B,args:arguments,thisArg:a}),W.__chain__=H,W}return B.apply(a,Dn([this.value()],arguments))})}),a}function TP(){return ti._===this&&(ti._=KC),this}function _u(){}function EP(a){return a=It(a),Ot(function(h){return fg(h,a)})}var PP=$d(fe),kP=$d(Fp),IP=$d(pd);function Mm(a){return Qd(a)?gd(Ds(a)):oA(a)}function RP(a){return function(h){return a==null?e:ur(a,h)}}var MP=Bg(),DP=Bg(!0);function fu(){return[]}function pu(){return!1}function LP(){return{}}function FP(){return""}function BP(){return!0}function OP(a,h){if(a=It(a),a<1||a>kt)return[];var u=Dt,p=li(a,Dt);h=ut(h),a-=Dt;for(var v=wd(p,h);++u<a;)h(u);return v}function UP(a){return Tt(a)?fe(a,Ds):$i(a)?[a]:ki(Kg(Xt(a)))}function zP(a){var h=++YC;return Xt(a)+h}var HP=ih(function(a,h){return a+h},0),WP=jd("ceil"),NP=ih(function(a,h){return a/h},1),GP=jd("floor");function $P(a){return a&&a.length?Zl(a,Mi,Id):e}function jP(a,h){return a&&a.length?Zl(a,ut(h,2),Id):e}function qP(a){return Up(a,Mi)}function VP(a,h){return Up(a,ut(h,2))}function XP(a){return a&&a.length?Zl(a,Mi,Ld):e}function ZP(a,h){return a&&a.length?Zl(a,ut(h,2),Ld):e}var YP=ih(function(a,h){return a*h},1),QP=jd("round"),KP=ih(function(a,h){return a-h},0);function JP(a){return a&&a.length?vd(a,Mi):0}function tk(a,h){return a&&a.length?vd(a,ut(h,2)):0}return b.after=yT,b.ary=hm,b.assign=hE,b.assignIn=Cm,b.assignInWith=ph,b.assignWith=cE,b.at=dE,b.before=cm,b.bind=su,b.bindAll=gP,b.bindKey=dm,b.castArray=LT,b.chain=om,b.chunk=GA,b.compact=$A,b.concat=jA,b.cond=mP,b.conforms=vP,b.constant=cu,b.countBy=JS,b.create=uE,b.curry=um,b.curryRight=_m,b.debounce=fm,b.defaults=_E,b.defaultsDeep=fE,b.defer=CT,b.delay=AT,b.difference=qA,b.differenceBy=VA,b.differenceWith=XA,b.drop=ZA,b.dropRight=YA,b.dropRightWhile=QA,b.dropWhile=KA,b.fill=JA,b.filter=eT,b.flatMap=nT,b.flatMapDeep=rT,b.flatMapDepth=oT,b.flatten=im,b.flattenDeep=tS,b.flattenDepth=eS,b.flip=ST,b.flow=xP,b.flowRight=bP,b.fromPairs=iS,b.functions=bE,b.functionsIn=yE,b.groupBy=aT,b.initial=nS,b.intersection=rS,b.intersectionBy=oS,b.intersectionWith=aS,b.invert=AE,b.invertBy=SE,b.invokeMap=hT,b.iteratee=du,b.keyBy=cT,b.keys=Ze,b.keysIn=Ri,b.map=hh,b.mapKeys=EE,b.mapValues=PE,b.matches=yP,b.matchesProperty=CP,b.memoize=dh,b.merge=kE,b.mergeWith=Am,b.method=AP,b.methodOf=SP,b.mixin=uu,b.negate=uh,b.nthArg=EP,b.omit=IE,b.omitBy=RE,b.once=TT,b.orderBy=dT,b.over=PP,b.overArgs=ET,b.overEvery=kP,b.overSome=IP,b.partial=nu,b.partialRight=pm,b.partition=uT,b.pick=ME,b.pickBy=Sm,b.property=Mm,b.propertyOf=RP,b.pull=dS,b.pullAll=nm,b.pullAllBy=uS,b.pullAllWith=_S,b.pullAt=fS,b.range=MP,b.rangeRight=DP,b.rearg=PT,b.reject=pT,b.remove=pS,b.rest=kT,b.reverse=eu,b.sampleSize=mT,b.set=LE,b.setWith=FE,b.shuffle=vT,b.slice=gS,b.sortBy=bT,b.sortedUniq=CS,b.sortedUniqBy=AS,b.split=nP,b.spread=IT,b.tail=SS,b.take=TS,b.takeRight=ES,b.takeRightWhile=PS,b.takeWhile=kS,b.tap=$S,b.throttle=RT,b.thru=lh,b.toArray=xm,b.toPairs=Tm,b.toPairsIn=Em,b.toPath=UP,b.toPlainObject=ym,b.transform=BE,b.unary=MT,b.union=IS,b.unionBy=RS,b.unionWith=MS,b.uniq=DS,b.uniqBy=LS,b.uniqWith=FS,b.unset=OE,b.unzip=iu,b.unzipWith=rm,b.update=UE,b.updateWith=zE,b.values=so,b.valuesIn=HE,b.without=BS,b.words=Im,b.wrap=DT,b.xor=OS,b.xorBy=US,b.xorWith=zS,b.zip=HS,b.zipObject=WS,b.zipObjectDeep=NS,b.zipWith=GS,b.entries=Tm,b.entriesIn=Em,b.extend=Cm,b.extendWith=ph,uu(b,b),b.add=HP,b.attempt=Rm,b.camelCase=$E,b.capitalize=Pm,b.ceil=WP,b.clamp=WE,b.clone=FT,b.cloneDeep=OT,b.cloneDeepWith=UT,b.cloneWith=BT,b.conformsTo=zT,b.deburr=km,b.defaultTo=wP,b.divide=NP,b.endsWith=jE,b.eq=fs,b.escape=qE,b.escapeRegExp=VE,b.every=tT,b.find=iT,b.findIndex=tm,b.findKey=pE,b.findLast=sT,b.findLastIndex=em,b.findLastKey=gE,b.floor=GP,b.forEach=am,b.forEachRight=lm,b.forIn=mE,b.forInRight=vE,b.forOwn=wE,b.forOwnRight=xE,b.get=au,b.gt=HT,b.gte=WT,b.has=CE,b.hasIn=lu,b.head=sm,b.identity=Mi,b.includes=lT,b.indexOf=sS,b.inRange=NE,b.invoke=TE,b.isArguments=pr,b.isArray=Tt,b.isArrayBuffer=NT,b.isArrayLike=Ii,b.isArrayLikeObject=Me,b.isBoolean=GT,b.isBuffer=Hn,b.isDate=$T,b.isElement=jT,b.isEmpty=qT,b.isEqual=VT,b.isEqualWith=XT,b.isError=ru,b.isFinite=ZT,b.isFunction=sn,b.isInteger=gm,b.isLength=_h,b.isMap=mm,b.isMatch=YT,b.isMatchWith=QT,b.isNaN=KT,b.isNative=JT,b.isNil=eE,b.isNull=tE,b.isNumber=vm,b.isObject=ve,b.isObjectLike=Te,b.isPlainObject=da,b.isRegExp=ou,b.isSafeInteger=iE,b.isSet=wm,b.isString=fh,b.isSymbol=$i,b.isTypedArray=io,b.isUndefined=sE,b.isWeakMap=nE,b.isWeakSet=rE,b.join=lS,b.kebabCase=XE,b.last=rs,b.lastIndexOf=hS,b.lowerCase=ZE,b.lowerFirst=YE,b.lt=oE,b.lte=aE,b.max=$P,b.maxBy=jP,b.mean=qP,b.meanBy=VP,b.min=XP,b.minBy=ZP,b.stubArray=fu,b.stubFalse=pu,b.stubObject=LP,b.stubString=FP,b.stubTrue=BP,b.multiply=YP,b.nth=cS,b.noConflict=TP,b.noop=_u,b.now=ch,b.pad=QE,b.padEnd=KE,b.padStart=JE,b.parseInt=tP,b.random=GE,b.reduce=_T,b.reduceRight=fT,b.repeat=eP,b.replace=iP,b.result=DE,b.round=QP,b.runInContext=L,b.sample=gT,b.size=wT,b.snakeCase=sP,b.some=xT,b.sortedIndex=mS,b.sortedIndexBy=vS,b.sortedIndexOf=wS,b.sortedLastIndex=xS,b.sortedLastIndexBy=bS,b.sortedLastIndexOf=yS,b.startCase=rP,b.startsWith=oP,b.subtract=KP,b.sum=JP,b.sumBy=tk,b.template=aP,b.times=OP,b.toFinite=nn,b.toInteger=It,b.toLength=bm,b.toLower=lP,b.toNumber=os,b.toSafeInteger=lE,b.toString=Xt,b.toUpper=hP,b.trim=cP,b.trimEnd=dP,b.trimStart=uP,b.truncate=_P,b.unescape=fP,b.uniqueId=zP,b.upperCase=pP,b.upperFirst=hu,b.each=am,b.eachRight=lm,b.first=sm,uu(b,function(){var a={};return Rs(b,function(h,u){Yt.call(b.prototype,u)||(a[u]=h)}),a}(),{chain:!1}),b.VERSION=i,ts(["bind","bindKey","curry","curryRight","partial","partialRight"],function(a){b[a].placeholder=b}),ts(["drop","take"],function(a,h){Wt.prototype[a]=function(u){u=u===e?1:Ge(It(u),0);var p=this.__filtered__&&!h?new Wt(this):this.clone();return p.__filtered__?p.__takeCount__=li(u,p.__takeCount__):p.__views__.push({size:li(u,Dt),type:a+(p.__dir__<0?"Right":"")}),p},Wt.prototype[a+"Right"]=function(u){return this.reverse()[a](u).reverse()}}),ts(["filter","map","takeWhile"],function(a,h){var u=h+1,p=u==wt||u==dt;Wt.prototype[a]=function(v){var y=this.clone();return y.__iteratees__.push({iteratee:ut(v,3),type:u}),y.__filtered__=y.__filtered__||p,y}}),ts(["head","last"],function(a,h){var u="take"+(h?"Right":"");Wt.prototype[a]=function(){return this[u](1).value()[0]}}),ts(["initial","tail"],function(a,h){var u="drop"+(h?"":"Right");Wt.prototype[a]=function(){return this.__filtered__?new Wt(this):this[u](1)}}),Wt.prototype.compact=function(){return this.filter(Mi)},Wt.prototype.find=function(a){return this.filter(a).head()},Wt.prototype.findLast=function(a){return this.reverse().find(a)},Wt.prototype.invokeMap=Ot(function(a,h){return typeof a=="function"?new Wt(this):this.map(function(u){return ra(u,a,h)})}),Wt.prototype.reject=function(a){return this.filter(uh(ut(a)))},Wt.prototype.slice=function(a,h){a=It(a);var u=this;return u.__filtered__&&(a>0||h<0)?new Wt(u):(a<0?u=u.takeRight(-a):a&&(u=u.drop(a)),h!==e&&(h=It(h),u=h<0?u.dropRight(-h):u.take(h-a)),u)},Wt.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},Wt.prototype.toArray=function(){return this.take(Dt)},Rs(Wt.prototype,function(a,h){var u=/^(?:filter|find|map|reject)|While$/.test(h),p=/^(?:head|last)$/.test(h),v=b[p?"take"+(h=="last"?"Right":""):h],y=p||/^find/.test(h);v&&(b.prototype[h]=function(){var P=this.__wrapped__,R=p?[1]:arguments,B=P instanceof Wt,H=R[0],W=B||Tt(P),j=function(zt){var Nt=v.apply(b,Dn([zt],R));return p&&tt?Nt[0]:Nt};W&&u&&typeof H=="function"&&H.length!=1&&(B=W=!1);var tt=this.__chain__,rt=!!this.__actions__.length,gt=y&&!tt,Lt=B&&!rt;if(!y&&W){P=Lt?P:new Wt(this);var mt=a.apply(P,R);return mt.__actions__.push({func:lh,args:[j],thisArg:e}),new is(mt,tt)}return gt&&Lt?a.apply(this,R):(mt=this.thru(j),gt?p?mt.value()[0]:mt.value():mt)})}),ts(["pop","push","shift","sort","splice","unshift"],function(a){var h=Ll[a],u=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",p=/^(?:pop|shift)$/.test(a);b.prototype[a]=function(){var v=arguments;if(p&&!this.__chain__){var y=this.value();return h.apply(Tt(y)?y:[],v)}return this[u](function(P){return h.apply(Tt(P)?P:[],v)})}}),Rs(Wt.prototype,function(a,h){var u=b[h];if(u){var p=u.name+"";Yt.call(Qr,p)||(Qr[p]=[]),Qr[p].push({name:h,func:u})}}),Qr[eh(e,A).name]=[{name:"wrapper",func:e}],Wt.prototype.clone=f1,Wt.prototype.reverse=p1,Wt.prototype.value=g1,b.prototype.at=jS,b.prototype.chain=qS,b.prototype.commit=VS,b.prototype.next=XS,b.prototype.plant=YS,b.prototype.reverse=QS,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=KS,b.prototype.first=b.prototype.head,Ko&&(b.prototype[Ko]=ZS),b},Xr=VC();ar?((ar.exports=Xr)._=Xr,dd._=Xr):ti._=Xr}).call(ri)})(_c,_c.exports);var vy=_c.exports;const pH="llama-3.3-70b-versatile";window.levels=Gb;let dl;function Jv(n){dl=new ge({apiKey:n,dangerouslyAllowBrowser:!0})}localStorage.getItem("groqApiKey")?Jv(localStorage.getItem("groqApiKey")):window.location.hash.startsWith("#gsk_")&&window.location.hash.length==57&&Jv(window.location.hash.slice(1));const fc=[];vy.debounce(gH,2e3);async function gH(n,t){if(!dl)return;let e;try{e=await dl.chat.completions.create({messages:[{role:"system",content:`Eres el guionista y dramaturgo de un videojuego llamado R.O.K.E. - 
          que consiste en explorar un espacio infinito del lore del Internet 
          llamado "Backrooms". 
          
          Tu respuesta debe ser un objeto json que contenga al menos:
           "response", "advice" y "demotivationalQuote".

           El input del usuario vendr en el campo "content" y el estatus del
           usuario en el campo "status" del objeto json que recibiris.
          `},...fc,{role:"user",content:JSON.stringify({content:n,status:t.status})}],response_format:{type:"json_object"},model:pH,temperature:1.4,max_tokens:5e3,top_p:1,stream:!1,stop:null})}catch(s){console.error(s)}finally{}const i=JSON.parse(e.choices[0].message.content);return fc.push(e.choices[0].message),i}const mH=vy.debounce(vH,5e3);async function vH(n,t){if(!dl)return;let e;try{e=await dl.chat.completions.create({messages:[{role:"system",content:`Eres el guionista y dramaturgo de un videojuego llamado R.O.K.E. - 
          que consiste en explorar un espacio infinito del lore del Internet 
          llamado "Backrooms". En cada cambio de pantalla el front-end del 
          juego te enviar un json describiendo el nivel y opcionalmente el 
          estatus del jugador. Tu tarea es retornar una prosa del nivel y/o 
          la situacin, muy breve y levemente sarcstica. No alucines.
          
          Piensa bien tu respuesta, que sea narrativa y no mucho ms.
          Usa oraciones completas y gramtica correcta en todos los campos.
          
          El jugador acaba de entrar a: ${t.status.location.level} - ${t.status.location.room}.
          Haz una referencia a la habitacin.

          Tu respuesta debe ser un objeto que contenga al menos:
           "shortDescription", "longDescription" y "easterEgg".
           
           Recuerda ser breve.
           `},...fc,{role:"user",content:JSON.stringify({room:n,player_status:t.status})}],response_format:{type:"json_object"},model:"llama-3.3-70b-versatile",temperature:1.6,max_tokens:5e3,top_p:1,stream:!1,stop:null})}catch(i){console.error(i)}finally{}return JSON.parse(e.choices[0].message.content),fc.push(e.choices[0].message),e}function wH(n){let t=0;for(let e=0;e<n.length;e++)t+=n.charCodeAt(e);return t%256}function wy(n){const t=Gb.find(i=>i.level==n.status.location.level),e=n.status.location.room;return mH(t,n),window.visual.flash(fi(qe,{children:[fi("h2",{children:['"',t.name,'"']}),fi("h3",{children:["Sector ",e]})]})),{...t,checksum:wH(t.level+"#"+e)}}function Th(n,t){return localStorage.getItem(n)===null&&localStorage.setItem(n,t),localStorage.getItem(n)}class pc extends ex{constructor(){super()}}gr(pc,"type","movement");class xH extends hx{constructor(e){super();gr(this,"types",["movement"]);gr(this,"systemType",cx.Update);this.query=e.query([pc])}initialize(e,i){this.engine=i.engine}update(e){const i=this.engine;this.query.entities.forEach(s=>{s.get(pc)&&(i.input.keyboard.isHeld(Ca.Space)&&s.vel.addEqual(ze(0,-50)),(i.input.keyboard.isHeld(Ca.Up)||i.input.gamepads.at(0).getAxes(kh.LeftStickY)>.5)&&s.vel.addEqual(ze(0,-10)),(i.input.keyboard.isHeld(Ca.Left)||i.input.gamepads.at(0).getAxes(kh.LeftStickX)<-.5)&&s.vel.addEqual(ze(-10,0)),(i.input.keyboard.isHeld(Ca.Right)||i.input.gamepads.at(0).getAxes(kh.LeftStickX)>.5)&&s.vel.addEqual(ze(10,0)))})}}class bH extends Mc{constructor(e,i,s){super({name:Th("name","Roke"),pos:ze(i,s),width:36,height:72,anchor:ze(.5,.95),scale:ze(.4,.4),z:1,collisionType:Mf.Active});gr(this,"status",{firstGame:Th("firstGame",Date.now()),location:{level:Th("level","Level 0"),room:parseInt(Th("room",0))}});gr(this,"world",null);gr(this,"scene",null);this.addComponent(new pc),aU.addListener("accel",r=>this.handleAccel(r)),this.world=wy(this),this.scene=e,window._player=this,window._flyman=Gv}update(e,i){super.update(e,i),this.vel.y>90?this.graphics.use(Gv):Math.abs(this.vel.x)>120?this.graphics.use(Uz):Math.abs(this.vel.x)>2?this.graphics.use(Oz):this.graphics.use(Bz),this.vel.x>.1?this.graphics.flipHorizontal=!1:this.vel.x<-.1&&(this.graphics.flipHorizontal=!0)}experiment(){sp.enter.play(.5)}handleAccel(e){ze(e.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y).magnitude>2&&(Wz?this.vel.addEqual(ze(e.accelerationIncludingGravity.x,-e.accelerationIncludingGravity.y<0?-e.accelerationIncludingGravity.y:0)):this.vel.addEqual(ze(-e.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y<0?e.accelerationIncludingGravity.y:0)))}}window.rng=_t;class yH extends Mc{constructor(t,e){super({x:t,y:e,width:32,height:48,z:0,collisionType:Mf.Passive}),this.graphics.add(_t.getItem(Hz))}}const y_={portals:[]};function tw(n,t,e){const i=new yH(t,e);return n.add(i),y_.portals.push(i),i}function CH(){y_.portals.forEach(n=>{n.kill()}),y_.portals=[]}class AH extends ox{constructor(){super(),this.dsml1=m_,window._dsml1=m_}onInitialize(t){this.setupLevel(t)}async gotoRoom(t,e){const i=this.dsml1.getIntGridLayers()[0].tilemap;t.status.enteredRoom=Date.now(),t.status.location={level:t.world.level,room:e},t.world=wy(t);let s=ze(t.pos.x%32+16,t.pos.y%32),r=await this.dsml1.retile(t.world.checksum),o=r.getRooms()[0],l=r.getRooms()[r.getRooms().length-1];t.pos.x<0?t.pos=ze(r._width*32-32,l.getBottom()*32).add(s):t.pos.x>i.width&&(t.pos=ze(0,o.getBottom()*32).add(s)),CH();const[c,d]=_t.getItem(r.getRooms().slice(1)).getCenter();tw(this,c*32+16,d*32),this.engine.currentScene.camera.pos=t.pos}setupLevel(t){t.currentScene.physics.config.gravity=ze(0,200);let e=new bH(this,492,60);this.dsml1.addToScene(this);let i=tw(this,492,50);i.rotation=-Math.PI/2,this.add(i),this.world.add(xH),sp.enter.play(.5),this.add(e),t.currentScene.camera.strategy.elasticToActor(e,.3,.8),t.currentScene.camera.pos=e.pos.clone(),t.currentScene.camera.zoom=.7;let s=new Dc(0,0,this.dsml1.data.levels[0].pxWid,this.dsml1.data.levels[0].pxHei);t.currentScene.camera.strategy.limitCameraBounds(s),t.currentScene.camera.zoomOverTime(2,2e3);const r=e.update;e.update=o=>{r&&r.call(e,o);const l=this.dsml1.getIntGridLayers()[0].tilemap;e.pos.x>=l.width&&(o.stop(),this.gotoRoom(e,e.status.location.room+1).then(()=>o.start())),e.pos.x<=0&&(o.stop(),this.gotoRoom(e,e.status.location.room-1).then(()=>o.start()))}}}function SH(n,t,e){const i=new rx(t);return i.backgroundColor="#020610",i.logo=e,i.logoHeight=322,i.logoWidth=512,i.loadingBarHeight=10,i.loadingBarColor=Lc.Yellow,i.playButtonText="Enter",i.events.on("beforeload",()=>{const s=n.screen.width,r=n.screen.height;i.logoPosition=ze(s/2-256,0),i.loadingBarPosition=ze(s/2-250,r-40)}),i}const TH="/roke/assets/logo512-C6TCsj5H.png";function EH(){let n=null,[t,e]=ni(null);function i(){const s=n.screen.screenToPageCoordinates(ze(0,0)),r=n.screen.screenToPageCoordinates(ze(800,480));e(new Dc(s.x,s.y,r.x,r.y))}return Ti(()=>{n=new sx({width:800,height:480,displayMode:ix.FitContainer,canvasElementId:"game_canvas",backgroundColor:Lc.Black,pixelArt:!0,physics:{solver:ax.Arcade}}),window._game=n;const s=SH(n,[m_,...Nb,...Object.values(sp)],TH);n.start(s).then(()=>{i();const r=new AH;n.add("main",r),n.goToScene("main"),n.screen.events.on("resize",i)})},[]),fi(q2,{children:fi(V2,{crtBox:t})})}Ao(fi(EH,{}),document.getElementById("app"));document.body.addEventListener("click",function n(){this.removeEventListener("click",n),Nz()});document.getElementById("game").onclick=n=>{n.target.focus()};window.ex=BO;export{Yx as W};
//# sourceMappingURL=index-CXqeonhW.js.map
