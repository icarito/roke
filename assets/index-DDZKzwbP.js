var Wv=Object.defineProperty;var Nv=(fi,ci,hi)=>ci in fi?Wv(fi,ci,{enumerable:!0,configurable:!0,writable:!0,value:hi}):fi[ci]=hi;var Sl=(fi,ci,hi)=>Nv(fi,typeof ci!="symbol"?ci+"":ci,hi);(function(){const ci=document.createElement("link").relList;if(ci&&ci.supports&&ci.supports("modulepreload"))return;for(const pi of document.querySelectorAll('link[rel="modulepreload"]'))_i(pi);new MutationObserver(pi=>{for(const gi of pi)if(gi.type==="childList")for(const mi of gi.addedNodes)mi.tagName==="LINK"&&mi.rel==="modulepreload"&&_i(mi)}).observe(document,{childList:!0,subtree:!0});function hi(pi){const gi={};return pi.integrity&&(gi.integrity=pi.integrity),pi.referrerPolicy&&(gi.referrerPolicy=pi.referrerPolicy),pi.crossOrigin==="use-credentials"?gi.credentials="include":pi.crossOrigin==="anonymous"?gi.credentials="omit":gi.credentials="same-origin",gi}function _i(pi){if(pi.ep)return;pi.ep=!0;const gi=hi(pi);fetch(pi.href,gi)}})();var n$1,l$2,u$3,i$2,r$2,o$2,e$1,f$3,c$2,s$2,a$2,h$2,p$2={},v$2=[],y$2=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,d$2=Array.isArray;function w$3(fi,ci){for(var hi in ci)fi[hi]=ci[hi];return fi}function _$2(fi){fi&&fi.parentNode&&fi.parentNode.removeChild(fi)}function g$3(fi,ci,hi){var _i,pi,gi,mi={};for(gi in ci)gi=="key"?_i=ci[gi]:gi=="ref"?pi=ci[gi]:mi[gi]=ci[gi];if(arguments.length>2&&(mi.children=arguments.length>3?n$1.call(arguments,2):hi),typeof fi=="function"&&fi.defaultProps!=null)for(gi in fi.defaultProps)mi[gi]===void 0&&(mi[gi]=fi.defaultProps[gi]);return m$2(fi,mi,_i,pi,null)}function m$2(fi,ci,hi,_i,pi){var gi={type:fi,props:ci,key:hi,ref:_i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:pi??++u$3,__i:-1,__u:0};return pi==null&&l$2.vnode!=null&&l$2.vnode(gi),gi}function b$1(){return{current:null}}function k$3(fi){return fi.children}function x$3(fi,ci){this.props=fi,this.context=ci}function C$3(fi,ci){if(ci==null)return fi.__?C$3(fi.__,fi.__i+1):null;for(var hi;ci<fi.__k.length;ci++)if((hi=fi.__k[ci])!=null&&hi.__e!=null)return hi.__e;return typeof fi.type=="function"?C$3(fi):null}function S$1(fi){var ci,hi;if((fi=fi.__)!=null&&fi.__c!=null){for(fi.__e=fi.__c.base=null,ci=0;ci<fi.__k.length;ci++)if((hi=fi.__k[ci])!=null&&hi.__e!=null){fi.__e=fi.__c.base=hi.__e;break}return S$1(fi)}}function M$2(fi){(!fi.__d&&(fi.__d=!0)&&i$2.push(fi)&&!P$3.__r++||r$2!==l$2.debounceRendering)&&((r$2=l$2.debounceRendering)||o$2)(P$3)}function P$3(){var fi,ci,hi,_i,pi,gi,mi,xi;for(i$2.sort(e$1);fi=i$2.shift();)fi.__d&&(ci=i$2.length,_i=void 0,gi=(pi=(hi=fi).__v).__e,mi=[],xi=[],hi.__P&&((_i=w$3({},pi)).__v=pi.__v+1,l$2.vnode&&l$2.vnode(_i),j$3(hi.__P,_i,pi,hi.__n,hi.__P.namespaceURI,32&pi.__u?[gi]:null,mi,gi??C$3(pi),!!(32&pi.__u),xi),_i.__v=pi.__v,_i.__.__k[_i.__i]=_i,z$3(mi,_i,xi),_i.__e!=gi&&S$1(_i)),i$2.length>ci&&i$2.sort(e$1));P$3.__r=0}function $$2(fi,ci,hi,_i,pi,gi,mi,xi,yi,Ci,Ei){var Ai,ki,Pi,Ii,Di,Fi,Li=_i&&_i.__k||v$2,Bi=ci.length;for(yi=I$2(hi,ci,Li,yi,Bi),Ai=0;Ai<Bi;Ai++)(Pi=hi.__k[Ai])!=null&&(ki=Pi.__i===-1?p$2:Li[Pi.__i]||p$2,Pi.__i=Ai,Fi=j$3(fi,Pi,ki,pi,gi,mi,xi,yi,Ci,Ei),Ii=Pi.__e,Pi.ref&&ki.ref!=Pi.ref&&(ki.ref&&V$2(ki.ref,null,Pi),Ei.push(Pi.ref,Pi.__c||Ii,Pi)),Di==null&&Ii!=null&&(Di=Ii),4&Pi.__u||ki.__k===Pi.__k?yi=A$3(Pi,yi,fi):typeof Pi.type=="function"&&Fi!==void 0?yi=Fi:Ii&&(yi=Ii.nextSibling),Pi.__u&=-7);return hi.__e=Di,yi}function I$2(fi,ci,hi,_i,pi){var gi,mi,xi,yi,Ci,Ei=hi.length,Ai=Ei,ki=0;for(fi.__k=new Array(pi),gi=0;gi<pi;gi++)(mi=ci[gi])!=null&&typeof mi!="boolean"&&typeof mi!="function"?(yi=gi+ki,(mi=fi.__k[gi]=typeof mi=="string"||typeof mi=="number"||typeof mi=="bigint"||mi.constructor==String?m$2(null,mi,null,null,null):d$2(mi)?m$2(k$3,{children:mi},null,null,null):mi.constructor===void 0&&mi.__b>0?m$2(mi.type,mi.props,mi.key,mi.ref?mi.ref:null,mi.__v):mi).__=fi,mi.__b=fi.__b+1,xi=null,(Ci=mi.__i=L$2(mi,hi,yi,Ai))!==-1&&(Ai--,(xi=hi[Ci])&&(xi.__u|=2)),xi==null||xi.__v===null?(Ci==-1&&ki--,typeof mi.type!="function"&&(mi.__u|=4)):Ci!=yi&&(Ci==yi-1?ki--:Ci==yi+1?ki++:(Ci>yi?ki--:ki++,mi.__u|=4))):fi.__k[gi]=null;if(Ai)for(gi=0;gi<Ei;gi++)(xi=hi[gi])!=null&&!(2&xi.__u)&&(xi.__e==_i&&(_i=C$3(xi)),q$3(xi,xi));return _i}function A$3(fi,ci,hi){var _i,pi;if(typeof fi.type=="function"){for(_i=fi.__k,pi=0;_i&&pi<_i.length;pi++)_i[pi]&&(_i[pi].__=fi,ci=A$3(_i[pi],ci,hi));return ci}fi.__e!=ci&&(ci&&fi.type&&!hi.contains(ci)&&(ci=C$3(fi)),hi.insertBefore(fi.__e,ci||null),ci=fi.__e);do ci=ci&&ci.nextSibling;while(ci!=null&&ci.nodeType==8);return ci}function H$2(fi,ci){return ci=ci||[],fi==null||typeof fi=="boolean"||(d$2(fi)?fi.some(function(hi){H$2(hi,ci)}):ci.push(fi)),ci}function L$2(fi,ci,hi,_i){var pi,gi,mi=fi.key,xi=fi.type,yi=ci[hi];if(yi===null||yi&&mi==yi.key&&xi===yi.type&&!(2&yi.__u))return hi;if(_i>(yi!=null&&!(2&yi.__u)?1:0))for(pi=hi-1,gi=hi+1;pi>=0||gi<ci.length;){if(pi>=0){if((yi=ci[pi])&&!(2&yi.__u)&&mi==yi.key&&xi===yi.type)return pi;pi--}if(gi<ci.length){if((yi=ci[gi])&&!(2&yi.__u)&&mi==yi.key&&xi===yi.type)return gi;gi++}}return-1}function T$3(fi,ci,hi){ci[0]=="-"?fi.setProperty(ci,hi??""):fi[ci]=hi==null?"":typeof hi!="number"||y$2.test(ci)?hi:hi+"px"}function F$3(fi,ci,hi,_i,pi){var gi;t:if(ci=="style")if(typeof hi=="string")fi.style.cssText=hi;else{if(typeof _i=="string"&&(fi.style.cssText=_i=""),_i)for(ci in _i)hi&&ci in hi||T$3(fi.style,ci,"");if(hi)for(ci in hi)_i&&hi[ci]===_i[ci]||T$3(fi.style,ci,hi[ci])}else if(ci[0]=="o"&&ci[1]=="n")gi=ci!=(ci=ci.replace(f$3,"$1")),ci=ci.toLowerCase()in fi||ci=="onFocusOut"||ci=="onFocusIn"?ci.toLowerCase().slice(2):ci.slice(2),fi.l||(fi.l={}),fi.l[ci+gi]=hi,hi?_i?hi.u=_i.u:(hi.u=c$2,fi.addEventListener(ci,gi?a$2:s$2,gi)):fi.removeEventListener(ci,gi?a$2:s$2,gi);else{if(pi=="http://www.w3.org/2000/svg")ci=ci.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(ci!="width"&&ci!="height"&&ci!="href"&&ci!="list"&&ci!="form"&&ci!="tabIndex"&&ci!="download"&&ci!="rowSpan"&&ci!="colSpan"&&ci!="role"&&ci!="popover"&&ci in fi)try{fi[ci]=hi??"";break t}catch{}typeof hi=="function"||(hi==null||hi===!1&&ci[4]!="-"?fi.removeAttribute(ci):fi.setAttribute(ci,ci=="popover"&&hi==1?"":hi))}}function O$2(fi){return function(ci){if(this.l){var hi=this.l[ci.type+fi];if(ci.t==null)ci.t=c$2++;else if(ci.t<hi.u)return;return hi(l$2.event?l$2.event(ci):ci)}}}function j$3(fi,ci,hi,_i,pi,gi,mi,xi,yi,Ci){var Ei,Ai,ki,Pi,Ii,Di,Fi,Li,Bi,Ri,$i,Ni,ji,Ui,qi,Ji,rs,ss=ci.type;if(ci.constructor!==void 0)return null;128&hi.__u&&(yi=!!(32&hi.__u),gi=[xi=ci.__e=hi.__e]),(Ei=l$2.__b)&&Ei(ci);t:if(typeof ss=="function")try{if(Li=ci.props,Bi="prototype"in ss&&ss.prototype.render,Ri=(Ei=ss.contextType)&&_i[Ei.__c],$i=Ei?Ri?Ri.props.value:Ei.__:_i,hi.__c?Fi=(Ai=ci.__c=hi.__c).__=Ai.__E:(Bi?ci.__c=Ai=new ss(Li,$i):(ci.__c=Ai=new x$3(Li,$i),Ai.constructor=ss,Ai.render=B$3),Ri&&Ri.sub(Ai),Ai.props=Li,Ai.state||(Ai.state={}),Ai.context=$i,Ai.__n=_i,ki=Ai.__d=!0,Ai.__h=[],Ai._sb=[]),Bi&&Ai.__s==null&&(Ai.__s=Ai.state),Bi&&ss.getDerivedStateFromProps!=null&&(Ai.__s==Ai.state&&(Ai.__s=w$3({},Ai.__s)),w$3(Ai.__s,ss.getDerivedStateFromProps(Li,Ai.__s))),Pi=Ai.props,Ii=Ai.state,Ai.__v=ci,ki)Bi&&ss.getDerivedStateFromProps==null&&Ai.componentWillMount!=null&&Ai.componentWillMount(),Bi&&Ai.componentDidMount!=null&&Ai.__h.push(Ai.componentDidMount);else{if(Bi&&ss.getDerivedStateFromProps==null&&Li!==Pi&&Ai.componentWillReceiveProps!=null&&Ai.componentWillReceiveProps(Li,$i),!Ai.__e&&(Ai.shouldComponentUpdate!=null&&Ai.shouldComponentUpdate(Li,Ai.__s,$i)===!1||ci.__v==hi.__v)){for(ci.__v!=hi.__v&&(Ai.props=Li,Ai.state=Ai.__s,Ai.__d=!1),ci.__e=hi.__e,ci.__k=hi.__k,ci.__k.some(function(zi){zi&&(zi.__=ci)}),Ni=0;Ni<Ai._sb.length;Ni++)Ai.__h.push(Ai._sb[Ni]);Ai._sb=[],Ai.__h.length&&mi.push(Ai);break t}Ai.componentWillUpdate!=null&&Ai.componentWillUpdate(Li,Ai.__s,$i),Bi&&Ai.componentDidUpdate!=null&&Ai.__h.push(function(){Ai.componentDidUpdate(Pi,Ii,Di)})}if(Ai.context=$i,Ai.props=Li,Ai.__P=fi,Ai.__e=!1,ji=l$2.__r,Ui=0,Bi){for(Ai.state=Ai.__s,Ai.__d=!1,ji&&ji(ci),Ei=Ai.render(Ai.props,Ai.state,Ai.context),qi=0;qi<Ai._sb.length;qi++)Ai.__h.push(Ai._sb[qi]);Ai._sb=[]}else do Ai.__d=!1,ji&&ji(ci),Ei=Ai.render(Ai.props,Ai.state,Ai.context),Ai.state=Ai.__s;while(Ai.__d&&++Ui<25);Ai.state=Ai.__s,Ai.getChildContext!=null&&(_i=w$3(w$3({},_i),Ai.getChildContext())),Bi&&!ki&&Ai.getSnapshotBeforeUpdate!=null&&(Di=Ai.getSnapshotBeforeUpdate(Pi,Ii)),xi=$$2(fi,d$2(Ji=Ei!=null&&Ei.type===k$3&&Ei.key==null?Ei.props.children:Ei)?Ji:[Ji],ci,hi,_i,pi,gi,mi,xi,yi,Ci),Ai.base=ci.__e,ci.__u&=-161,Ai.__h.length&&mi.push(Ai),Fi&&(Ai.__E=Ai.__=null)}catch(zi){if(ci.__v=null,yi||gi!=null)if(zi.then){for(ci.__u|=yi?160:128;xi&&xi.nodeType==8&&xi.nextSibling;)xi=xi.nextSibling;gi[gi.indexOf(xi)]=null,ci.__e=xi}else for(rs=gi.length;rs--;)_$2(gi[rs]);else ci.__e=hi.__e,ci.__k=hi.__k;l$2.__e(zi,ci,hi)}else gi==null&&ci.__v==hi.__v?(ci.__k=hi.__k,ci.__e=hi.__e):xi=ci.__e=N$2(hi.__e,ci,hi,_i,pi,gi,mi,yi,Ci);return(Ei=l$2.diffed)&&Ei(ci),128&ci.__u?void 0:xi}function z$3(fi,ci,hi){for(var _i=0;_i<hi.length;_i++)V$2(hi[_i],hi[++_i],hi[++_i]);l$2.__c&&l$2.__c(ci,fi),fi.some(function(pi){try{fi=pi.__h,pi.__h=[],fi.some(function(gi){gi.call(pi)})}catch(gi){l$2.__e(gi,pi.__v)}})}function N$2(fi,ci,hi,_i,pi,gi,mi,xi,yi){var Ci,Ei,Ai,ki,Pi,Ii,Di,Fi=hi.props,Li=ci.props,Bi=ci.type;if(Bi=="svg"?pi="http://www.w3.org/2000/svg":Bi=="math"?pi="http://www.w3.org/1998/Math/MathML":pi||(pi="http://www.w3.org/1999/xhtml"),gi!=null){for(Ci=0;Ci<gi.length;Ci++)if((Pi=gi[Ci])&&"setAttribute"in Pi==!!Bi&&(Bi?Pi.localName==Bi:Pi.nodeType==3)){fi=Pi,gi[Ci]=null;break}}if(fi==null){if(Bi==null)return document.createTextNode(Li);fi=document.createElementNS(pi,Bi,Li.is&&Li),xi&&(l$2.__m&&l$2.__m(ci,gi),xi=!1),gi=null}if(Bi===null)Fi===Li||xi&&fi.data===Li||(fi.data=Li);else{if(gi=gi&&n$1.call(fi.childNodes),Fi=hi.props||p$2,!xi&&gi!=null)for(Fi={},Ci=0;Ci<fi.attributes.length;Ci++)Fi[(Pi=fi.attributes[Ci]).name]=Pi.value;for(Ci in Fi)if(Pi=Fi[Ci],Ci!="children"){if(Ci=="dangerouslySetInnerHTML")Ai=Pi;else if(!(Ci in Li)){if(Ci=="value"&&"defaultValue"in Li||Ci=="checked"&&"defaultChecked"in Li)continue;F$3(fi,Ci,null,Pi,pi)}}for(Ci in Li)Pi=Li[Ci],Ci=="children"?ki=Pi:Ci=="dangerouslySetInnerHTML"?Ei=Pi:Ci=="value"?Ii=Pi:Ci=="checked"?Di=Pi:xi&&typeof Pi!="function"||Fi[Ci]===Pi||F$3(fi,Ci,Pi,Fi[Ci],pi);if(Ei)xi||Ai&&(Ei.__html===Ai.__html||Ei.__html===fi.innerHTML)||(fi.innerHTML=Ei.__html),ci.__k=[];else if(Ai&&(fi.innerHTML=""),$$2(fi,d$2(ki)?ki:[ki],ci,hi,_i,Bi=="foreignObject"?"http://www.w3.org/1999/xhtml":pi,gi,mi,gi?gi[0]:hi.__k&&C$3(hi,0),xi,yi),gi!=null)for(Ci=gi.length;Ci--;)_$2(gi[Ci]);xi||(Ci="value",Bi=="progress"&&Ii==null?fi.removeAttribute("value"):Ii!==void 0&&(Ii!==fi[Ci]||Bi=="progress"&&!Ii||Bi=="option"&&Ii!==Fi[Ci])&&F$3(fi,Ci,Ii,Fi[Ci],pi),Ci="checked",Di!==void 0&&Di!==fi[Ci]&&F$3(fi,Ci,Di,Fi[Ci],pi))}return fi}function V$2(fi,ci,hi){try{if(typeof fi=="function"){var _i=typeof fi.__u=="function";_i&&fi.__u(),_i&&ci==null||(fi.__u=fi(ci))}else fi.current=ci}catch(pi){l$2.__e(pi,hi)}}function q$3(fi,ci,hi){var _i,pi;if(l$2.unmount&&l$2.unmount(fi),(_i=fi.ref)&&(_i.current&&_i.current!==fi.__e||V$2(_i,null,ci)),(_i=fi.__c)!=null){if(_i.componentWillUnmount)try{_i.componentWillUnmount()}catch(gi){l$2.__e(gi,ci)}_i.base=_i.__P=null}if(_i=fi.__k)for(pi=0;pi<_i.length;pi++)_i[pi]&&q$3(_i[pi],ci,hi||typeof fi.type!="function");hi||_$2(fi.__e),fi.__c=fi.__=fi.__e=void 0}function B$3(fi,ci,hi){return this.constructor(fi,hi)}function D$3(fi,ci,hi){var _i,pi,gi,mi;ci==document&&(ci=document.documentElement),l$2.__&&l$2.__(fi,ci),pi=(_i=typeof hi=="function")?null:hi&&hi.__k||ci.__k,gi=[],mi=[],j$3(ci,fi=(!_i&&hi||ci).__k=g$3(k$3,null,[fi]),pi||p$2,p$2,ci.namespaceURI,!_i&&hi?[hi]:pi?null:ci.firstChild?n$1.call(ci.childNodes):null,gi,!_i&&hi?hi:pi?pi.__e:ci.firstChild,_i,mi),z$3(gi,fi,mi)}function E$2(fi,ci){D$3(fi,ci,E$2)}function G$2(fi,ci,hi){var _i,pi,gi,mi,xi=w$3({},fi.props);for(gi in fi.type&&fi.type.defaultProps&&(mi=fi.type.defaultProps),ci)gi=="key"?_i=ci[gi]:gi=="ref"?pi=ci[gi]:xi[gi]=ci[gi]===void 0&&mi!==void 0?mi[gi]:ci[gi];return arguments.length>2&&(xi.children=arguments.length>3?n$1.call(arguments,2):hi),m$2(fi.type,xi,_i||fi.key,pi||fi.ref,null)}function J$2(fi,ci){var hi={__c:ci="__cC"+h$2++,__:fi,Consumer:function(_i,pi){return _i.children(pi)},Provider:function(_i){var pi,gi;return this.getChildContext||(pi=new Set,(gi={})[ci]=this,this.getChildContext=function(){return gi},this.componentWillUnmount=function(){pi=null},this.shouldComponentUpdate=function(mi){this.props.value!==mi.value&&pi.forEach(function(xi){xi.__e=!0,M$2(xi)})},this.sub=function(mi){pi.add(mi);var xi=mi.componentWillUnmount;mi.componentWillUnmount=function(){pi&&pi.delete(mi),xi&&xi.call(mi)}}),_i.children}};return hi.Provider.__=hi.Consumer.contextType=hi}n$1=v$2.slice,l$2={__e:function(fi,ci,hi,_i){for(var pi,gi,mi;ci=ci.__;)if((pi=ci.__c)&&!pi.__)try{if((gi=pi.constructor)&&gi.getDerivedStateFromError!=null&&(pi.setState(gi.getDerivedStateFromError(fi)),mi=pi.__d),pi.componentDidCatch!=null&&(pi.componentDidCatch(fi,_i||{}),mi=pi.__d),mi)return pi.__E=pi}catch(xi){fi=xi}throw fi}},u$3=0,x$3.prototype.setState=function(fi,ci){var hi;hi=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=w$3({},this.state),typeof fi=="function"&&(fi=fi(w$3({},hi),this.props)),fi&&w$3(hi,fi),fi!=null&&this.__v&&(ci&&this._sb.push(ci),M$2(this))},x$3.prototype.forceUpdate=function(fi){this.__v&&(this.__e=!0,fi&&this.__h.push(fi),M$2(this))},x$3.prototype.render=k$3,i$2=[],o$2=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e$1=function(fi,ci){return fi.__v.__b-ci.__v.__b},P$3.__r=0,f$3=/(PointerCapture)$|Capture$/i,c$2=0,s$2=O$2(!1),a$2=O$2(!0),h$2=0;var f$2=0;function u$2(fi,ci,hi,_i,pi,gi){ci||(ci={});var mi,xi,yi=ci;"ref"in ci&&(mi=ci.ref,delete ci.ref);var Ci={type:fi,props:yi,key:hi,ref:mi,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--f$2,__i:-1,__u:0,__source:pi,__self:gi};if(typeof fi=="function"&&(mi=fi.defaultProps))for(xi in mi)yi[xi]===void 0&&(yi[xi]=mi[xi]);return l$2.vnode&&l$2.vnode(Ci),Ci}/*!
 * excalibur - 0.30.3 - 2025-1-1
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2025 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var __webpack_modules__={851:(fi,ci,hi)=>{hi.d(ci,{A:()=>yi});var _i=hi(1),pi=hi.n(_i),gi=hi(935),mi=hi.n(gi),xi=mi()(pi());xi.push([fi.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition:
    background 250ms ease-in-out,
    transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Director/Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition:\r
    background 250ms ease-in-out,\r
    transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const yi=xi},296:(fi,ci,hi)=>{hi.d(ci,{A:()=>yi});var _i=hi(1),pi=hi.n(_i),gi=hi(935),mi=hi.n(gi),xi=mi()(pi());xi.push([fi.id,`#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;

  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}

.ex-toast-message button {
  align-self: flex-start;
}
`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB",sourcesContent:[`#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}\r
`],sourceRoot:""}]);const yi=xi},935:fi=>{fi.exports=function(ci){var hi=[];return hi.toString=function(){return this.map(function(pi){var gi="",mi=typeof pi[5]<"u";return pi[4]&&(gi+="@supports (".concat(pi[4],") {")),pi[2]&&(gi+="@media ".concat(pi[2]," {")),mi&&(gi+="@layer".concat(pi[5].length>0?" ".concat(pi[5]):""," {")),gi+=ci(pi),mi&&(gi+="}"),pi[2]&&(gi+="}"),pi[4]&&(gi+="}"),gi}).join("")},hi.i=function(pi,gi,mi,xi,yi){typeof pi=="string"&&(pi=[[null,pi,void 0]]);var Ci={};if(mi)for(var Ei=0;Ei<this.length;Ei++){var Ai=this[Ei][0];Ai!=null&&(Ci[Ai]=!0)}for(var ki=0;ki<pi.length;ki++){var Pi=[].concat(pi[ki]);mi&&Ci[Pi[0]]||(typeof yi<"u"&&(typeof Pi[5]>"u"||(Pi[1]="@layer".concat(Pi[5].length>0?" ".concat(Pi[5]):""," {").concat(Pi[1],"}")),Pi[5]=yi),gi&&(Pi[2]&&(Pi[1]="@media ".concat(Pi[2]," {").concat(Pi[1],"}")),Pi[2]=gi),xi&&(Pi[4]?(Pi[1]="@supports (".concat(Pi[4],") {").concat(Pi[1],"}"),Pi[4]=xi):Pi[4]="".concat(xi)),hi.push(Pi))}},hi}},1:fi=>{fi.exports=function(ci){var hi=ci[1],_i=ci[3];if(!_i)return hi;if(typeof btoa=="function"){var pi=btoa(unescape(encodeURIComponent(JSON.stringify(_i)))),gi="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(pi),mi="/*# ".concat(gi," */");return[hi].concat([mi]).join(`
`)}return[hi].join(`
`)}}},__webpack_module_cache__={};function __webpack_require__(fi){var ci=__webpack_module_cache__[fi];if(ci!==void 0)return ci.exports;var hi=__webpack_module_cache__[fi]={id:fi,exports:{}};return __webpack_modules__[fi](hi,hi.exports,__webpack_require__),hi.exports}__webpack_require__.n=fi=>{var ci=fi&&fi.__esModule?()=>fi.default:()=>fi;return __webpack_require__.d(ci,{a:ci}),ci};__webpack_require__.d=(fi,ci)=>{for(var hi in ci)__webpack_require__.o(ci,hi)&&!__webpack_require__.o(fi,hi)&&Object.defineProperty(fi,hi,{enumerable:!0,get:ci[hi]})};__webpack_require__.o=(fi,ci)=>Object.prototype.hasOwnProperty.call(fi,ci);__webpack_require__.r=fi=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(fi,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(fi,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{eKr:()=>ActionCompleteEvent,yVm:()=>ActionContext,a7j:()=>ActionQueue,U_w:()=>ActionSequence,JF2:()=>ActionStartEvent,htg:()=>ActionsComponent,HXL:()=>ActionsSystem,mcg:()=>ActivateEvent,Agj:()=>Actor,J3_:()=>ActorEvents,Wgv:()=>AddEvent,u6S:()=>AddedComponent,x7M:()=>AffineMatrix,X55:()=>Animation,m3M:()=>AnimationDirection,aE5:()=>AnimationEvents,YJU:()=>AnimationStrategy,eZi:()=>ArcadeSolver,GNv:()=>AudioContextFactory,Y56:()=>Axes,_0v:()=>Axis,vhs:()=>BaseAlign,vrQ:()=>BezierCurve,Z8b:()=>Blink,Yfw:()=>BodyComponent,IcQ:()=>BoundingBox,kgJ:()=>BrowserComponent,GTT:()=>BrowserEvents,ypY:()=>Buttons,i7d:()=>Camera,fQ3:()=>CameraEvents,HlI:()=>Canvas$1,jlt:()=>Circle,VQc:()=>CircleCollider,zD7:()=>Clock,AUF:()=>ClosestLineJumpTable,JoF:()=>Collider,MlA:()=>ColliderComponent,PZh:()=>CollisionContact,qA:()=>CollisionEndEvent,CrD:()=>CollisionGroup,dQK:()=>CollisionGroupManager,D3r:()=>CollisionJumpTable,Qpo:()=>CollisionPostSolveEvent,D9n:()=>CollisionPreSolveEvent,b6v:()=>CollisionStartEvent,mvh:()=>CollisionSystem,Bpo:()=>CollisionType,Q1f:()=>Color,IKv:()=>ColorBlindFlags,fcV:()=>ColorBlindnessMode,Glf:()=>ColorBlindnessPostProcessor,uAl:()=>Component,ElT:()=>CompositeCollider,Z8r:()=>ConsoleAppender,QSL:()=>ContactConstraintPoint,sPV:()=>ContactEndEvent,nAn:()=>ContactSolveBias,zCU:()=>ContactStartEvent,QrV:()=>CoordPlane,fF9:()=>CrossFade,Jqv:()=>CurveBy,d_u:()=>CurveTo,xI8:()=>DeactivateEvent,yar:()=>Debug,SP7:()=>DebugConfig,oRy:()=>DebugGraphicsComponent,f5X:()=>DebugSystem,V1c:()=>DebugText,Mlx:()=>DefaultAntialiasOptions,ZiM:()=>DefaultGarbageCollectionOptions,ZCo:()=>DefaultLoader,J5p:()=>DefaultPixelArtOptions,mL_:()=>DegreeOfFreedom,Guw:()=>Delay,N5j:()=>Detector,pgY:()=>Die,OP3:()=>Direction,rl5:()=>Director,eod:()=>DirectorEvents,q5Z:()=>DisplayMode,YUC:()=>DynamicTree,saR:()=>DynamicTreeCollisionProcessor,hvr:()=>EX_VERSION,Qol:()=>EaseBy,Wf4:()=>EaseTo,JCs:()=>EasingFunctions,gJV:()=>EdgeCollider,fWD:()=>ElasticToActorStrategy,Va_:()=>EmitterType,N$8:()=>Engine,_jQ:()=>EngineEvents,rxj:()=>EnterTriggerEvent,rhv:()=>EnterViewPortEvent,wCu:()=>Entity,HAp:()=>EntityEvents,Zy1:()=>EntityManager,bkB:()=>EventEmitter,wfL:()=>EventTypes,sVA:()=>Events_namespaceObject,$Gs:()=>ExResponse,CJ0:()=>ExcaliburGraphicsContext2DCanvas,NWh:()=>ExcaliburGraphicsContextWebGL,tWi:()=>ExitTriggerEvent,xAj:()=>ExitViewPortEvent,zWh:()=>Fade,i_4:()=>FadeInOut,iIx:()=>Flags,Hxo:()=>Flash,c9e:()=>Follow,KQV:()=>Font,weH:()=>FontCache,jXp:()=>FontSource,zzY:()=>FontStyle,yRQ:()=>FontUnit,MtE:()=>FpsSampler,rPj:()=>FrameStats,KLc:()=>Future,Fir:()=>GameEvent,V5f:()=>GameStartEvent,Xj7:()=>GameStopEvent,Wud:()=>Gamepad,FVg:()=>GamepadAxisEvent,g5Y:()=>GamepadButtonEvent,YQB:()=>GamepadConnectEvent,KPb:()=>GamepadDisconnectEvent,nHK:()=>Gamepads,Jrb:()=>GarbageCollector,TX_:()=>Gif,Olt:()=>GifParser,r3n:()=>GlobalCoordinates,Fvk:()=>GpuParticleEmitter,gpR:()=>GpuParticleRenderer,vYh:()=>Graphic,hnk:()=>GraphicsComponent,D2R:()=>GraphicsGroup,n1o:()=>GraphicsSystem,h9O:()=>HashColliderProxy,X5j:()=>HashGridCell,p3P:()=>HashGridProxy,RLG:()=>HiddenEvent,fBU:()=>HorizontalFirst,Adb:()=>ImageFiltering,bEs:()=>ImageSource,wCy:()=>ImageSourceAttributeConstants,CbD:()=>ImageWrapping,x_C:()=>InitializeEvent,pGf:()=>InputHost,ibQ:()=>InputMapper,shR:()=>IsometricEntityComponent,Yjk:()=>IsometricEntitySystem,_u1:()=>IsometricMap,OBI:()=>IsometricTile,klh:()=>KeyEvent,s3S:()=>Keyboard$1,D$R:()=>Keys,xth:()=>KillEvent,JU7:()=>Label,h9x:()=>LimitCameraBoundsStrategy,N1A:()=>Line,e_k:()=>LineSegment,aHM:()=>Loader,tlv:()=>LoaderEvents,Vi9:()=>LockCameraToActorAxisStrategy,ieR:()=>LockCameraToActorStrategy,$bb:()=>LogLevel,VyI:()=>Logger,imn:()=>Material,uqu:()=>Matrix,QnL:()=>MatrixLocations,vnc:()=>MediaEvent,wk_:()=>Meet,GH0:()=>MotionComponent,_1r:()=>MotionSystem,l0X:()=>MoveBy,bT:()=>MoveByWithOptions,HHX:()=>MoveTo,jtW:()=>MoveToWithOptions,tjk:()=>NativePointerButton,rWe:()=>NativeSoundEvent,j9l:()=>NativeSoundProcessedEvent,l0$:()=>NineSlice,sGJ:()=>NineSliceStretch,NVp:()=>None,cPK:()=>Observable,XoL:()=>OffscreenSystem,RmF:()=>Pair,DXI:()=>ParallaxComponent,tCD:()=>ParallelActions,J3D:()=>Particle,vCJ:()=>ParticleEmitter,e6k:()=>ParticleRenderer,f9l:()=>ParticleTransform,v9m:()=>PhysicsStats,yRJ:()=>PhysicsWorld,EU6:()=>PointerAbstraction,m3O:()=>PointerButton,Ryz:()=>PointerComponent,OxP:()=>PointerEvent,LEs:()=>PointerEventReceiver,Ec:()=>PointerScope,Pi5:()=>PointerSystem,gmH:()=>PointerType,tS:()=>Polygon,XxX:()=>PolygonCollider,bCz:()=>Pool,nYS:()=>PostCollisionEvent,yiT:()=>PostDebugDrawEvent,NHl:()=>PostDrawEvent,mO8:()=>PostFrameEvent,PXI:()=>PostKillEvent,bn5:()=>PostTransformDrawEvent,Ywr:()=>PostUpdateEvent,cMd:()=>PreCollisionEvent,Bs6:()=>PreDebugDrawEvent,G0k:()=>PreDrawEvent,pyn:()=>PreFrameEvent,QeM:()=>PreKillEvent,aPX:()=>PreLoadEvent,ITP:()=>PreTransformDrawEvent,BY0:()=>PreUpdateEvent,MFw:()=>Projection,sBn:()=>QuadIndexBuffer,S3L:()=>QuadTree,XKQ:()=>Query,ESI:()=>QueryManager,uxz:()=>RadiusAroundActorStrategy,o8N:()=>Random,u_r:()=>Raster,RlV:()=>Ray,gVA:()=>RealisticSolver,M_G:()=>Rectangle,BpG:()=>RemoveEvent,GRB:()=>RemovedComponent,kM6:()=>Repeat,dO8:()=>RepeatForever,jgM:()=>Resolution,FWq:()=>Resource,s3j:()=>ResourceEvents,hlw:()=>RotateBy,L0q:()=>RotateByWithOptions,B7e:()=>RotateTo,PGN:()=>RotateToWithOptions,H_X:()=>RotationType,S_d:()=>ScaleBy,_Tq:()=>ScaleByWithOptions,U7E:()=>ScaleTo,IOH:()=>ScaleToWithOptions,Z58:()=>Scene,yh2:()=>SceneEvents,ff$:()=>Screen,cWi:()=>ScreenAppender,NBt:()=>ScreenElement,oNz:()=>ScreenEvents,QlU:()=>ScreenShader,Xey:()=>ScrollPreventionMode,jft:()=>Semaphore,_r8:()=>SeparatingAxis,bTC:()=>SeparationInfo,Mtr:()=>Shader,ypk:()=>Shape,mnM:()=>Side,q7S:()=>Slide,bAZ:()=>SolverStrategy,ABN:()=>Sound,VK6:()=>SoundEvents,Hj2:()=>SparseHashGrid,Df8:()=>SparseHashGridCollisionProcessor,oOx:()=>SpatialPartitionStrategy,kxk:()=>Sprite,DT1:()=>SpriteFont,FLG:()=>SpriteSheet,qN_:()=>StandardClock,Z37:()=>StateMachine,FtL:()=>StrategyContainer,Z6X:()=>Stream$1,iQT:()=>System,ziO:()=>SystemManager,OEF:()=>SystemPriority,uuE:()=>SystemType,tiv:()=>TagQuery,T$Y:()=>TestClock,EYj:()=>Text,nOB:()=>TextAlign,Tap:()=>TextureLoader,FAs:()=>Tile,B_P:()=>TileMap,aA5:()=>TileMapEvents,J3s:()=>TiledAnimation,Y0Q:()=>TiledSprite,M4G:()=>Timer,l$l:()=>Toaster,dLy:()=>transform_Transform,WZP:()=>TransformComponent,eB6:()=>Transition,nFK:()=>TreeNode,l9z:()=>Trigger,YOF:()=>TriggerEvents,yhB:()=>TwoPI,J0N:()=>Util_Index_namespaceObject,Miz:()=>Vector,Bj4:()=>VectorView,Rcs:()=>VertexBuffer,vJ4:()=>VertexLayout,TqC:()=>VerticalFirst,nM0:()=>VisibleEvent,X1u:()=>WebAudio,SpZ:()=>WebAudioInstance,DX8:()=>WheelDeltaMode,Yx$:()=>WheelEvent,HK4:()=>World,yt5:()=>approximatelyEqual,vAR:()=>assert,SE$:()=>canonicalizeAngle,qE8:()=>clamp,Pz7:()=>coroutine,sX_:()=>createId,JuI:()=>frac,pxT:()=>getDefaultPhysicsConfig,Nl$:()=>hasGraphicsTick,zDr:()=>hasOnAdd,OwT:()=>hasOnInitialize,P$G:()=>hasOnPostUpdate,mHV:()=>hasOnPreUpdate,kEA:()=>hasOnRemove,Fx_:()=>hasPostDraw,WFC:()=>hasPreDraw,vKu:()=>has_add,aDq:()=>has_initialize,jIg:()=>has_postupdate,UH3:()=>has_preupdate,AJO:()=>has_remove,U4:()=>inverseLerp,xAc:()=>inverseLerpVector,_3Y:()=>isActor,K6X:()=>isAddedComponent,C1Y:()=>isComponentCtor,Aw1:()=>isLoaderConstructor,tm8:()=>isMoveByOptions,LBV:()=>isMoveToOptions,A8$:()=>isRemovedComponent,F5e:()=>isRotateByOptions,ran:()=>isRotateToOptions,c8L:()=>isScaleByOptions,o6M:()=>isScaleToOptions,hsx:()=>isSceneConstructor,l9E:()=>isScreenElement,aSf:()=>isSystemConstructor,CcK:()=>lerp,nU8:()=>lerpAngle,td6:()=>lerpVector,Zex:()=>maxMessages,bkJ:()=>nextActionId,mXP:()=>obsolete,vt$:()=>parseImageFiltering,hCA:()=>parseImageWrapping,pjR:()=>pixelSnapEpsilon,U43:()=>randomInRange,pSZ:()=>randomIntInRange,y17:()=>range,Ew7:()=>remap,hG1:()=>remapVector,jVr:()=>resetObsoleteCounter,_SZ:()=>sign,xWn:()=>toDegrees,ehJ:()=>toRadians,t6s:()=>vec,Eyn:()=>webgl_util_namespaceObject});var webgl_util_namespaceObject={};__webpack_require__.r(webgl_util_namespaceObject);__webpack_require__.d(webgl_util_namespaceObject,{getAttributeComponentSize:()=>getAttributeComponentSize,getAttributePointerType:()=>getAttributePointerType,getGLTypeFromSource:()=>getGLTypeFromSource,getGlTypeSizeBytes:()=>getGlTypeSizeBytes,getMaxShaderComplexity:()=>getMaxShaderComplexity,isAttributeInSource:()=>isAttributeInSource});var DrawUtil_namespaceObject={};__webpack_require__.r(DrawUtil_namespaceObject);__webpack_require__.d(DrawUtil_namespaceObject,{circle:()=>circle,line:()=>line,point:()=>point,roundRect:()=>roundRect,vector:()=>vector});var Events_namespaceObject={};__webpack_require__.r(Events_namespaceObject);__webpack_require__.d(Events_namespaceObject,{ActionCompleteEvent:()=>ActionCompleteEvent,ActionStartEvent:()=>ActionStartEvent,ActivateEvent:()=>ActivateEvent,AddEvent:()=>AddEvent,CollisionEndEvent:()=>CollisionEndEvent,CollisionPostSolveEvent:()=>CollisionPostSolveEvent,CollisionPreSolveEvent:()=>CollisionPreSolveEvent,CollisionStartEvent:()=>CollisionStartEvent,ContactEndEvent:()=>ContactEndEvent,ContactStartEvent:()=>ContactStartEvent,DeactivateEvent:()=>DeactivateEvent,EnterTriggerEvent:()=>EnterTriggerEvent,EnterViewPortEvent:()=>EnterViewPortEvent,EventTypes:()=>EventTypes,ExitTriggerEvent:()=>ExitTriggerEvent,ExitViewPortEvent:()=>ExitViewPortEvent,GameEvent:()=>GameEvent,GameStartEvent:()=>GameStartEvent,GameStopEvent:()=>GameStopEvent,GamepadAxisEvent:()=>GamepadAxisEvent,GamepadButtonEvent:()=>GamepadButtonEvent,GamepadConnectEvent:()=>GamepadConnectEvent,GamepadDisconnectEvent:()=>GamepadDisconnectEvent,HiddenEvent:()=>HiddenEvent,InitializeEvent:()=>InitializeEvent,KillEvent:()=>KillEvent,PostCollisionEvent:()=>PostCollisionEvent,PostDebugDrawEvent:()=>PostDebugDrawEvent,PostDrawEvent:()=>PostDrawEvent,PostFrameEvent:()=>PostFrameEvent,PostKillEvent:()=>PostKillEvent,PostTransformDrawEvent:()=>PostTransformDrawEvent,PostUpdateEvent:()=>PostUpdateEvent,PreCollisionEvent:()=>PreCollisionEvent,PreDebugDrawEvent:()=>PreDebugDrawEvent,PreDrawEvent:()=>PreDrawEvent,PreFrameEvent:()=>PreFrameEvent,PreKillEvent:()=>PreKillEvent,PreTransformDrawEvent:()=>PreTransformDrawEvent,PreUpdateEvent:()=>PreUpdateEvent,RemoveEvent:()=>RemoveEvent,VisibleEvent:()=>VisibleEvent});var Util_Index_namespaceObject={};__webpack_require__.r(Util_Index_namespaceObject);__webpack_require__.d(Util_Index_namespaceObject,{ConsoleAppender:()=>ConsoleAppender,DrawUtil:()=>DrawUtil_namespaceObject,EasingFunctions:()=>EasingFunctions,LogLevel:()=>LogLevel,Logger:()=>Logger,Observable:()=>Observable,ScreenAppender:()=>ScreenAppender,addItemToArray:()=>addItemToArray,contains:()=>contains,delay:()=>delay,fail:()=>fail,getPosition:()=>getPosition,isObject:()=>isObject,mergeDeep:()=>mergeDeep,omit:()=>omit,removeItemFromArray:()=>removeItemFromArray});function polyfill(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(fi){window.setInterval(fi,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const ci=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(hi){return new Promise((_i,pi)=>{ci.call(this,hi,_i,pi)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1),typeof window<"u"&&!window.requestIdleCallback&&(window.requestIdleCallback=window.requestIdleCallback||function(fi){const ci=Date.now();return setTimeout(function(){fi({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-ci))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(fi){clearTimeout(fi)})}class Flags{static useCanvasGraphicsContext(){Flags.enable("use-canvas-context")}static useLegacyImageRenderer(){Flags.enable("use-legacy-image-renderer")}static freeze(){Flags._FROZEN=!0}static _reset(){Flags._FROZEN=!1,Flags._FLAGS={}}static enable(ci){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");Flags._FLAGS[ci]=!0}static disable(ci){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");Flags._FLAGS[ci]=!1}static isEnabled(ci){return!!Flags._FLAGS[ci]}static show(){return Object.keys(Flags._FLAGS)}}Flags._FROZEN=!1;Flags._FLAGS={};function createId(fi,ci){return{type:fi,value:ci}}class Future{constructor(){this._isCompleted=!1,this.promise=new Promise((ci,hi)=>{this._resolver=ci,this._rejecter=hi})}get isCompleted(){return this._isCompleted}resolve(ci){this._isCompleted||(this._isCompleted=!0,this._resolver(ci))}reject(ci){this._isCompleted||(this._isCompleted=!0,this._rejecter(ci))}}class EventEmitter{constructor(){this._paused=!1,this._empty=!0,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0,this._empty=!0}on(ci,hi){var _i;return this._empty=!1,this._listeners[ci]=(_i=this._listeners[ci])!==null&&_i!==void 0?_i:[],this._listeners[ci].push(hi),{close:()=>this.off(ci,hi)}}once(ci,hi){var _i;return this._empty=!1,this._listenersOnce[ci]=(_i=this._listenersOnce[ci])!==null&&_i!==void 0?_i:[],this._listenersOnce[ci].push(hi),{close:()=>this.off(ci,hi)}}off(ci,hi){var _i,pi;if(hi){const gi=(_i=this._listeners[ci])===null||_i===void 0?void 0:_i.filter(xi=>xi!==hi);this._listeners[ci]=gi;const mi=(pi=this._listenersOnce[ci])===null||pi===void 0?void 0:pi.filter(xi=>xi!==hi);this._listenersOnce[ci]=mi}else delete this._listeners[ci]}emit(ci,hi){if(this._empty||this._paused)return;const _i=this._listeners[ci];if(_i)for(let gi=0;gi<_i.length;gi++)_i[gi](hi);const pi=this._listenersOnce[ci];if(this._listenersOnce[ci]=[],pi)for(let gi=0;gi<pi.length;gi++)pi[gi](hi);for(let gi=0;gi<this._pipes.length;gi++)this._pipes[gi].emit(ci,hi)}pipe(ci){if(this===ci)throw Error("Cannot pipe to self");return this._empty=!1,this._pipes.push(ci),{close:()=>{const hi=this._pipes.indexOf(ci);hi>-1&&this._pipes.splice(hi,1)}}}unpipe(ci){const hi=this._pipes.indexOf(ci);hi>-1&&this._pipes.splice(hi,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var PointerScope;(function(fi){fi.Canvas="Canvas",fi.Document="Document"})(PointerScope||(PointerScope={}));var RotationType;(function(fi){fi.ShortestPath="shortest-path",fi.LongestPath="longest-path",fi.Clockwise="clockwise",fi.CounterClockwise="counter-clockwise"})(RotationType||(RotationType={}));const BITMASK32=4294967295;class Random{constructor(ci){this.seed=ci,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(ci||Date.now())>>>0;for(let hi=1;hi<this._n;hi++){const _i=this._mt[hi-1]^this._mt[hi-1]>>>this._w-2;this._mt[hi]=(this._f*((_i&4294901760)>>>16)<<16)+this._f*(_i&65535)+hi>>>0}this._index=this._n}_twist(){const ci=[0,this._a];let hi=0,_i=0;for(;_i<this._n-this._m;_i++)hi=this._mt[_i]&this._upperMask|this._mt[_i+1]&this._lowerMask,this._mt[_i]=this._mt[_i+this._m]^hi>>>1^ci[hi&1]&BITMASK32;for(;_i<this._n-1;_i++)hi=this._mt[_i]&this._upperMask|this._mt[_i+1]&this._lowerMask,this._mt[_i]=this._mt[_i+(this._m-this._n)]^hi>>>1^ci[hi&1]&BITMASK32;hi=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^hi>>>1^ci[hi&1]&BITMASK32,this._index=0}nextInt(){this._index>=this._n&&this._twist();let ci=this._mt[this._index++];return ci^=ci>>>this._u,ci^=ci<<this._s&this._b,ci^=ci<<this._t&this._c,ci^=ci>>>this._l,ci>>>0}next(){return this.nextInt()*(1/4294967296)}floating(ci,hi){return(hi-ci)*this.next()+ci}integer(ci,hi){return Math.floor((hi-ci+1)*this.next()+ci)}bool(ci=.5){return this.next()<=ci}pickOne(ci){return ci[this.integer(0,ci.length-1)]}pickSet(ci,hi,_i=!1){return _i?this._pickSetWithDuplicates(ci,hi):this._pickSetWithoutDuplicates(ci,hi)}_pickSetWithoutDuplicates(ci,hi){if(hi>ci.length||hi<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(hi===ci.length)return ci;const _i=new Array(hi);let pi=0;const gi=ci.slice(0);for(;pi<hi;){const mi=this.integer(0,gi.length-1);_i[pi++]=gi[mi],gi.splice(mi,1)}return _i}_pickSetWithDuplicates(ci,hi){if(hi<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const _i=new Array(hi);for(let pi=0;pi<hi;pi++)_i[pi]=this.pickOne(ci);return _i}shuffle(ci){const hi=ci.slice(0);let _i;for(let pi=0;pi<hi.length-2;pi++){const gi=this.integer(pi,hi.length-1);_i=hi[pi],hi[pi]=hi[gi],hi[gi]=_i}return hi}range(ci,hi,_i){const pi=new Array(ci);for(let gi=0;gi<ci;gi++)pi[gi]=this.integer(hi,_i);return pi}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const TwoPI=Math.PI*2;function frac(fi){return fi>=0?fi-Math.floor(fi):fi-Math.ceil(fi)}function sign(fi){return fi===0?0:fi<0?-1:1}function clamp(fi,ci,hi){return Math.min(Math.max(ci,fi),hi)}function approximatelyEqual(fi,ci,hi){return Math.abs(fi-ci)<hi}function canonicalizeAngle(fi){let ci=fi;if(fi>=TwoPI)for(;ci>=TwoPI;)ci-=TwoPI;if(fi<0)for(;ci<0;)ci+=TwoPI;return ci}function toDegrees(fi){return 180/Math.PI*fi}function toRadians(fi){return fi/180*Math.PI}const range=(fi,ci)=>Array.from(new Array(ci-fi+1),(hi,_i)=>_i+fi);function randomInRange(fi,ci,hi=new Random){return hi?hi.floating(fi,ci):fi+Math.random()*(ci-fi)}function randomIntInRange(fi,ci,hi=new Random){return hi?hi.integer(fi,ci):Math.round(randomInRange(fi,ci))}class Vector{static get Zero(){return new Vector(0,0)}static get One(){return new Vector(1,1)}static get Half(){return new Vector(.5,.5)}static get Up(){return new Vector(0,-1)}static get Down(){return new Vector(0,1)}static get Left(){return new Vector(-1,0)}static get Right(){return new Vector(1,0)}static fromAngle(ci){return new Vector(Math.cos(ci),Math.sin(ci))}static isValid(ci){return!(ci==null||isNaN(ci.x)||isNaN(ci.y)||ci.x===1/0||ci.y===1/0||ci.x===-1/0||ci.y===-1/0)}static distance(ci,hi){return Math.sqrt(Math.pow(ci.x-hi.x,2)+Math.pow(ci.y-hi.y,2))}static min(ci,hi){return new Vector(Math.min(ci.x,hi.x),Math.min(ci.y,hi.y))}static max(ci,hi){return new Vector(Math.max(ci.x,hi.x),Math.max(ci.y,hi.y))}constructor(ci,hi){this._x=0,this._y=0,this._x=ci,this._y=hi}get x(){return this._x}set x(ci){this._x=ci}get y(){return this._y}set y(ci){this._y=ci}setTo(ci,hi){this.x=ci,this.y=hi}equals(ci,hi=Vector.EQUALS_EPSILON){return Math.abs(this.x-ci.x)<=hi&&Math.abs(this.y-ci.y)<=hi}distance(ci){if(!ci)return Math.sqrt(this.x*this.x+this.y*this.y);const hi=this.x-ci.x,_i=this.y-ci.y;return Math.sqrt(hi*hi+_i*_i)}squareDistance(ci){ci||(ci=Vector.Zero);const hi=this.x-ci.x,_i=this.y-ci.y;return hi*hi+_i*_i}clampMagnitude(ci){const hi=this.magnitude,_i=clamp(hi,0,ci);return this.magnitude=_i,this}get size(){return this.distance()}set size(ci){const hi=this.normalize().scale(ci);this.setTo(hi.x,hi.y)}get magnitude(){return this.distance()}set magnitude(ci){this.normalize().scale(ci,this)}normalize(){const ci=this.distance();return ci===0?Vector.Zero:new Vector(this.x/ci,this.y/ci)}average(ci){return this.add(ci).scale(.5)}scale(ci,hi){const _i=hi||new Vector(0,0);return ci instanceof Vector?(_i.x=this.x*ci.x,_i.y=this.y*ci.y):(_i.x=this.x*ci,_i.y=this.y*ci),_i}add(ci,hi){return hi?(hi.x=this.x+ci.x,hi.y=this.y+ci.y,hi):new Vector(this.x+ci.x,this.y+ci.y)}sub(ci,hi){const _i=hi||new Vector(0,0),pi=this.x-ci.x,gi=this.y-ci.y;return _i.x=pi,_i.y=gi,_i}addEqual(ci){return this.setTo(this.x+ci.x,this.y+ci.y),this}subEqual(ci){return this.setTo(this.x-ci.x,this.y-ci.y),this}scaleEqual(ci){return this.setTo(this.x*ci,this.y*ci),this}dot(ci){return this.x*ci.x+this.y*ci.y}cross(ci){if(ci instanceof Vector)return this.x*ci.y-this.y*ci.x;if(typeof ci=="number")return new Vector(ci*this.y,-ci*this.x)}static cross(ci,hi){return new Vector(-ci*hi.y,ci*hi.x)}perpendicular(){return new Vector(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return canonicalizeAngle(Math.atan2(this.y,this.x))}angleBetween(ci,hi){const _i=this.toAngle(),pi=canonicalizeAngle(ci);let gi=0,mi=0;switch(pi>_i?gi=pi-_i:gi=(TwoPI-_i+pi)%TwoPI,mi=(gi-TwoPI)%TwoPI,hi){case RotationType.ShortestPath:return Math.abs(gi)<Math.abs(mi)?gi:mi;case RotationType.LongestPath:return Math.abs(gi)>Math.abs(mi)?gi:mi;case RotationType.Clockwise:return gi;case RotationType.CounterClockwise:return mi}}rotate(ci,hi,_i){const pi=_i||new Vector(0,0);hi||(hi=new Vector(0,0));const gi=Math.sin(ci),mi=Math.cos(ci),xi=mi*(this.x-hi.x)-gi*(this.y-hi.y)+hi.x,yi=gi*(this.x-hi.x)+mi*(this.y-hi.y)+hi.y;return pi.x=xi,pi.y=yi,pi}clone(ci){const hi=ci??new Vector(0,0);return hi.x=this.x,hi.y=this.y,hi}toString(ci){return ci?`(${this.x.toFixed(ci)}, ${this.y.toFixed(ci)})`:`(${this.x}, ${this.y})`}}Vector.EQUALS_EPSILON=.001;function vec(fi,ci){return new Vector(fi,ci)}class Color{constructor(ci,hi,_i,pi){this.r=ci,this.g=hi,this.b=_i,this.a=pi??1}static fromRGB(ci,hi,_i,pi){return new Color(ci,hi,_i,pi)}static fromRGBString(ci){const hi=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let _i=null;if(_i=ci.match(hi)){const pi=parseInt(_i[1],10),gi=parseInt(_i[2],10),mi=parseInt(_i[3],10);let xi=1;return _i[4]&&(xi=parseFloat(_i[4])),new Color(pi,gi,mi,xi)}else throw new Error("Invalid rgb/a string: "+ci)}static fromHex(ci){const hi=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let _i=null;if(_i=ci.match(hi)){const pi=parseInt(_i[1],16),gi=parseInt(_i[2],16),mi=parseInt(_i[3],16);let xi=1;return _i[4]&&(xi=parseInt(_i[4],16)/255),new Color(pi,gi,mi,xi)}else throw new Error("Invalid hex string: "+ci)}static fromHSL(ci,hi,_i,pi=1){return new HSLColor(ci,hi,_i,pi).toRGBA()}lighten(ci=.1){const hi=HSLColor.fromRGBA(this.r,this.g,this.b,this.a);return hi.l+=(1-hi.l)*ci,hi.toRGBA()}darken(ci=.1){const hi=HSLColor.fromRGBA(this.r,this.g,this.b,this.a);return hi.l-=hi.l*ci,hi.toRGBA()}saturate(ci=.1){const hi=HSLColor.fromRGBA(this.r,this.g,this.b,this.a);return hi.s+=hi.s*ci,hi.toRGBA()}desaturate(ci=.1){const hi=HSLColor.fromRGBA(this.r,this.g,this.b,this.a);return hi.s-=hi.s*ci,hi.toRGBA()}multiply(ci){const hi=ci.r/255*this.r/255*255,_i=ci.g/255*this.g/255*255,pi=ci.b/255*this.b/255*255,gi=ci.a*this.a;return new Color(hi,_i,pi,gi)}screen(ci){const hi=ci.invert(),_i=ci.invert();return hi.multiply(_i).invert()}invert(){return new Color(255-this.r,255-this.g,255-this.b,1-this.a)}average(ci){const hi=(ci.r+this.r)/2,_i=(ci.g+this.g)/2,pi=(ci.b+this.b)/2,gi=(ci.a+this.a)/2;return new Color(hi,_i,pi,gi)}equal(ci){return this.toString()===ci.toString()}toString(ci="rgb"){switch(ci){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(ci){const hi=Math.max(Math.round(ci),0).toString(16);return hi.length===1?"0"+hi:hi}toHex(){let ci="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(ci+=this._componentToHex(this.a*255)),ci}toRGBA(){const ci=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+ci+", "+String(this.a)+")":"rgb("+ci+")"}toHSLA(){return HSLColor.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(ci){const hi=ci||new Color(this.r,this.g,this.b,this.a);return hi.r=this.r,hi.g=this.g,hi.b=this.b,hi.a=this.a,hi}static get Black(){return Color.fromHex("#000000")}static get White(){return Color.fromHex("#FFFFFF")}static get Gray(){return Color.fromHex("#808080")}static get LightGray(){return Color.fromHex("#D3D3D3")}static get DarkGray(){return Color.fromHex("#A9A9A9")}static get Yellow(){return Color.fromHex("#FFFF00")}static get Orange(){return Color.fromHex("#FFA500")}static get Red(){return Color.fromHex("#FF0000")}static get Vermilion(){return Color.fromHex("#FF5B31")}static get Rose(){return Color.fromHex("#FF007F")}static get Pink(){return Color.fromHex("#FFC0CB")}static get Magenta(){return Color.fromHex("#FF00FF")}static get Violet(){return Color.fromHex("#7F00FF")}static get Purple(){return Color.fromHex("#800080")}static get Blue(){return Color.fromHex("#0000FF")}static get Azure(){return Color.fromHex("#007FFF")}static get Cyan(){return Color.fromHex("#00FFFF")}static get Viridian(){return Color.fromHex("#59978F")}static get Teal(){return Color.fromHex("#008080")}static get Green(){return Color.fromHex("#00FF00")}static get Chartreuse(){return Color.fromHex("#7FFF00")}static get Transparent(){return Color.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return Color.fromHex("#176BAA")}static get Brown(){return Color.fromHex("#964B00")}}class HSLColor{constructor(ci,hi,_i,pi){this.h=ci,this.s=hi,this.l=_i,this.a=pi}static hue2rgb(ci,hi,_i){return _i<0&&(_i+=1),_i>1&&(_i-=1),_i<1/6?ci+(hi-ci)*6*_i:_i<1/2?hi:_i<2/3?ci+(hi-ci)*(2/3-_i)*6:ci}static fromRGBA(ci,hi,_i,pi){ci/=255,hi/=255,_i/=255;const gi=Math.max(ci,hi,_i),mi=Math.min(ci,hi,_i);let xi,yi;const Ci=(gi+mi)/2;if(gi===mi)xi=yi=0;else{const Ei=gi-mi;switch(yi=Ci>.5?Ei/(2-gi-mi):Ei/(gi+mi),gi){case ci:xi=(hi-_i)/Ei+(hi<_i?6:0);break;case hi:xi=(_i-ci)/Ei+2;break;case _i:xi=(ci-hi)/Ei+4;break}xi/=6}return new HSLColor(xi,yi,Ci,pi)}toRGBA(){let ci,hi,_i;if(this.s===0)ci=hi=_i=this.l;else{const pi=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,gi=2*this.l-pi;ci=HSLColor.hue2rgb(gi,pi,this.h+1/3),hi=HSLColor.hue2rgb(gi,pi,this.h),_i=HSLColor.hue2rgb(gi,pi,this.h-1/3)}return new Color(ci*255,hi*255,_i*255,this.a)}toString(){const ci=this.h.toFixed(0),hi=this.s.toFixed(0),_i=this.l.toFixed(0),pi=this.a.toFixed(0);return`hsla(${ci}, ${hi}, ${_i}, ${pi})`}}var LogLevel;(function(fi){fi[fi.Debug=0]="Debug",fi[fi.Info=1]="Info",fi[fi.Warn=2]="Warn",fi[fi.Error=3]="Error",fi[fi.Fatal=4]="Fatal"})(LogLevel||(LogLevel={}));class Logger{constructor(){if(this._appenders=[],this.defaultLevel=LogLevel.Info,this._logOnceSet=new Set,Logger._INSTANCE)throw new Error("Logger is a singleton");return Logger._INSTANCE=this,Logger._INSTANCE.addAppender(new ConsoleAppender),Logger._INSTANCE}static getInstance(){return Logger._INSTANCE==null&&(Logger._INSTANCE=new Logger),Logger._INSTANCE}addAppender(ci){this._appenders.push(ci)}clearAppenders(){this._appenders.length=0}_log(ci,hi){ci==null&&(ci=this.defaultLevel);const _i=this._appenders.length;for(let pi=0;pi<_i;pi++)ci>=this.defaultLevel&&this._appenders[pi].log(ci,hi)}_logOnce(ci,hi){const _i=ci+hi.join("+");this._logOnceSet.has(_i)||(this._logOnceSet.add(_i),this._log(ci,hi))}debug(...ci){this._log(LogLevel.Debug,ci)}debugOnce(...ci){this._logOnce(LogLevel.Debug,ci)}info(...ci){this._log(LogLevel.Info,ci)}infoOnce(...ci){this._logOnce(LogLevel.Info,ci)}warn(...ci){this._log(LogLevel.Warn,ci)}warnOnce(...ci){this._logOnce(LogLevel.Warn,ci)}error(...ci){this._log(LogLevel.Error,ci)}errorOnce(...ci){this._logOnce(LogLevel.Error,ci)}fatal(...ci){this._log(LogLevel.Fatal,ci)}fatalOnce(...ci){this._logOnce(LogLevel.Fatal,ci)}}Logger._INSTANCE=null;class ConsoleAppender{log(ci,hi){if(!console&&!console.log&&console.warn&&console.error)return;const _i=[];_i.unshift.apply(_i,hi),_i.unshift("["+LogLevel[ci]+"] : "),ci<LogLevel.Warn?console.log.apply?console.log.apply(console,_i):console.log(_i.join(" ")):ci<LogLevel.Error?console.warn.apply?console.warn.apply(console,_i):console.warn(_i.join(" ")):console.error.apply?console.error.apply(console,_i):console.error(_i.join(" "))}}class ScreenAppender{constructor(ci){var hi,_i;this._messages=[],this._pos=10,this._color=Color.Black,this._options=ci,this.canvas=document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.zIndex=(_i=(hi=ci.zIndex)===null||hi===void 0?void 0:hi.toString())!==null&&_i!==void 0?_i:"99",document.body.appendChild(this.canvas),this._positionScreenAppenderCanvas(),ci.engine.screen.events.on("resize",()=>{this._positionScreenAppenderCanvas()})}_positionScreenAppenderCanvas(){var ci,hi,_i,pi;const gi=this._options;this.canvas.width=(ci=gi.width)!==null&&ci!==void 0?ci:gi.engine.screen.resolution.width,this.canvas.height=(hi=gi.height)!==null&&hi!==void 0?hi:gi.engine.screen.resolution.height,this.canvas.style.position="absolute";const mi=gi.engine.screen.screenToPageCoordinates(vec(0,0));this.canvas.style.left=mi.x+"px",this.canvas.style.top=mi.y+"px",this._pos=(_i=gi.xPos)!==null&&_i!==void 0?_i:this._pos,this._color=(pi=gi.color)!==null&&pi!==void 0?pi:this._color}log(ci,hi){const _i=hi.join(",");this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._messages.unshift("["+LogLevel[ci]+"] : "+_i);let pi=10;this._messages=this._messages.slice(0,1e3);for(let gi=0;gi<this._messages.length;gi++)this._ctx.fillStyle=this._color.toRGBA(),this._ctx.fillText(this._messages[gi],this._pos,pi),pi+=10}}var Side;(function(fi){fi.None="None",fi.Top="Top",fi.Bottom="Bottom",fi.Left="Left",fi.Right="Right"})(Side||(Side={}));(function(fi){function ci(_i){return _i===fi.Top?fi.Bottom:_i===fi.Bottom?fi.Top:_i===fi.Left?fi.Right:_i===fi.Right?fi.Left:fi.None}fi.getOpposite=ci;function hi(_i){return Math.abs(_i.x)>=Math.abs(_i.y)?_i.x<=0?fi.Left:fi.Right:_i.y<=0?fi.Top:fi.Bottom}fi.fromDirection=hi})(Side||(Side={}));class BoundingBox{constructor(ci=0,hi=0,_i=0,pi=0){this._points=[],typeof ci=="object"?(this.left=ci.left,this.top=ci.top,this.right=ci.right,this.bottom=ci.bottom):typeof ci=="number"&&(this.left=ci,this.top=hi,this.right=_i,this.bottom=pi)}clone(ci){const hi=ci||new BoundingBox(0,0,0,0);return hi.left=this.left,hi.right=this.right,hi.top=this.top,hi.bottom=this.bottom,hi}reset(){this.left=0,this.top=0,this.bottom=0,this.right=0}static getSideFromIntersection(ci){return ci&&ci?Math.abs(ci.x)>Math.abs(ci.y)?ci.x<0?Side.Right:Side.Left:ci.y<0?Side.Bottom:Side.Top:Side.None}static fromPoints(ci){let hi=1/0,_i=1/0,pi=-1/0,gi=-1/0;for(let mi=0;mi<ci.length;mi++)ci[mi].x<hi&&(hi=ci[mi].x),ci[mi].x>pi&&(pi=ci[mi].x),ci[mi].y<_i&&(_i=ci[mi].y),ci[mi].y>gi&&(gi=ci[mi].y);return new BoundingBox(hi,_i,pi,gi)}static fromDimension(ci,hi,_i=Vector.Half,pi=Vector.Zero){return new BoundingBox(-ci*_i.x+pi.x,-hi*_i.y+pi.y,ci-ci*_i.x+pi.x,hi-hi*_i.y+pi.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new Vector((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new Vector(this.left,this.top)}get bottomRight(){return new Vector(this.right,this.bottom)}get topRight(){return new Vector(this.right,this.top)}get bottomLeft(){return new Vector(this.left,this.bottom)}translate(ci){return new BoundingBox(this.left+ci.x,this.top+ci.y,this.right+ci.x,this.bottom+ci.y)}rotate(ci,hi=Vector.Zero){const _i=this.getPoints().map(pi=>pi.rotate(ci,hi));return BoundingBox.fromPoints(_i)}scale(ci,hi=Vector.Zero){const _i=this.translate(hi);return new BoundingBox(_i.left*ci.x,_i.top*ci.y,_i.right*ci.x,_i.bottom*ci.y)}transform(ci){const hi=ci.data[0]*this.left,_i=ci.data[1]*this.left,pi=ci.data[0]*this.right,gi=ci.data[1]*this.right,mi=ci.data[2]*this.top,xi=ci.data[3]*this.top,yi=ci.data[2]*this.bottom,Ci=ci.data[3]*this.bottom,Ei=ci.getPosition(),Ai=Math.min(hi,pi)+Math.min(mi,yi)+Ei.x,ki=Math.min(_i,gi)+Math.min(xi,Ci)+Ei.y,Pi=Math.max(hi,pi)+Math.max(mi,yi)+Ei.x,Ii=Math.max(_i,gi)+Math.max(xi,Ci)+Ei.y;return new BoundingBox({left:Ai,top:ki,right:Pi,bottom:Ii})}getPerimeter(){const ci=this.width,hi=this.height;return 2*(ci+hi)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new Vector(this.left,this.top)),this._points.push(new Vector(this.right,this.top)),this._points.push(new Vector(this.right,this.bottom)),this._points.push(new Vector(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(ci,hi=1/0){let _i=-1/0,pi=1/0;const gi=ci.dir.x===0?Number.MAX_VALUE:1/ci.dir.x,mi=ci.dir.y===0?Number.MAX_VALUE:1/ci.dir.y,xi=(this.left-ci.pos.x)*gi,yi=(this.right-ci.pos.x)*gi;_i=Math.min(xi,yi),pi=Math.max(xi,yi);const Ci=(this.top-ci.pos.y)*mi,Ei=(this.bottom-ci.pos.y)*mi;return _i=Math.max(_i,Math.min(Ci,Ei)),pi=Math.min(pi,Math.max(Ci,Ei)),pi>=Math.max(0,_i)&&_i<hi}rayCastTime(ci,hi=1/0){let _i=-1/0,pi=1/0;const gi=ci.dir.x===0?Number.MAX_VALUE:1/ci.dir.x,mi=ci.dir.y===0?Number.MAX_VALUE:1/ci.dir.y,xi=(this.left-ci.pos.x)*gi,yi=(this.right-ci.pos.x)*gi;_i=Math.min(xi,yi),pi=Math.max(xi,yi);const Ci=(this.top-ci.pos.y)*mi,Ei=(this.bottom-ci.pos.y)*mi;return _i=Math.max(_i,Math.min(Ci,Ei)),pi=Math.min(pi,Math.max(Ci,Ei)),pi>=Math.max(0,_i)&&_i<hi?_i:-1}contains(ci){return ci instanceof Vector?this.left<=ci.x&&this.top<=ci.y&&ci.y<=this.bottom&&ci.x<=this.right:ci instanceof BoundingBox?this.left<=ci.left&&this.top<=ci.top&&ci.bottom<=this.bottom&&ci.right<=this.right:!1}combine(ci,hi){const _i=hi||new BoundingBox(0,0,0,0),pi=Math.min(this.left,ci.left),gi=Math.min(this.top,ci.top),mi=Math.max(this.right,ci.right),xi=Math.max(this.bottom,ci.bottom);return _i.left=pi,_i.top=gi,_i.right=mi,_i.bottom=xi,_i}get dimensions(){return new Vector(this.width,this.height)}overlaps(ci,hi){const _i=hi||0;if(ci.hasZeroDimensions())return this.contains(ci);if(this.hasZeroDimensions())return ci.contains(this);const pi=this.combine(ci);return pi.width+_i<ci.width+this.width&&pi.height+_i<ci.height+this.height}intersect(ci){const hi=this.combine(ci);if(hi.width<ci.width+this.width&&hi.height<ci.height+this.height&&!hi.dimensions.equals(ci.dimensions)&&!hi.dimensions.equals(this.dimensions)){let _i=0;this.right>=ci.left&&this.right<=ci.right?_i=ci.left-this.right:_i=ci.right-this.left;let pi=0;return this.top<=ci.bottom&&this.top>=ci.top?pi=ci.bottom-this.top:pi=ci.top-this.bottom,Math.abs(_i)<Math.abs(pi)?new Vector(_i,0):new Vector(0,pi)}else if(hi.dimensions.equals(ci.dimensions)||hi.dimensions.equals(this.dimensions)){let _i=0;this.width-ci.width>=0?this.right-ci.right<=ci.left-this.left?_i=ci.left-this.right:_i=ci.right-this.left:ci.right-this.right<=this.left-ci.left?_i=this.left-ci.right:_i=this.right-ci.left;let pi=0;return this.height-ci.height>=0?this.bottom-ci.bottom<=ci.top-this.top?pi=ci.top-this.bottom:pi=ci.bottom-this.top:ci.bottom-this.bottom<=this.top-ci.top?pi=this.top-ci.bottom:pi=this.bottom-ci.top,Math.abs(_i)<Math.abs(pi)?new Vector(_i,0):new Vector(0,pi)}else return null}intersectWithSide(ci){const hi=this.intersect(ci);return BoundingBox.getSideFromIntersection(hi)}draw(ci,hi=Color.Yellow){ci.debug.drawRect(this.left,this.top,this.width,this.height,{color:hi})}}function getPosition(fi){if(fi&&fi.getBoundingClientRect){const ci=fi.getBoundingClientRect();return vec(ci.x+window.scrollX,ci.y+window.scrollY)}return Vector.Zero}function addItemToArray(fi,ci){return ci.indexOf(fi)===-1?(ci.push(fi),!0):!1}function removeItemFromArray(fi,ci){let hi=-1;return(hi=ci.indexOf(fi))>-1?(ci.splice(hi,1),!0):!1}function contains(fi,ci){for(let hi=0;hi<fi.length;hi++)if(fi[hi]===ci)return!0;return!1}function fail(fi){throw new Error(fi)}function delay(fi,ci){var hi;const _i=new Future;return((hi=ci==null?void 0:ci.schedule.bind(ci))!==null&&hi!==void 0?hi:setTimeout)(()=>{_i.resolve()},fi),_i.promise}function omit(fi,ci){const hi={};for(const _i in fi)ci.includes(_i)||(hi[_i]=fi[_i]);return hi}function isObject(fi){return fi&&typeof fi=="object"&&!Array.isArray(fi)}function mergeDeep(fi,...ci){if(!ci.length)return fi;const hi=ci.shift();if(isObject(fi)&&isObject(hi))for(const _i in hi)isObject(hi[_i])?(fi[_i]||Object.assign(fi,{[_i]:{}}),mergeDeep(fi[_i],hi[_i])):Object.assign(fi,{[_i]:hi[_i]});return mergeDeep(fi,...ci)}var MatrixLocations;(function(fi){fi[fi.X=12]="X",fi[fi.Y=13]="Y"})(MatrixLocations||(MatrixLocations={}));class Matrix{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(ci,hi,_i,pi,gi,mi){const xi=new Matrix;return xi.data[0]=2/(hi-ci),xi.data[1]=0,xi.data[2]=0,xi.data[3]=0,xi.data[4]=0,xi.data[5]=2/(pi-_i),xi.data[6]=0,xi.data[7]=0,xi.data[8]=0,xi.data[9]=0,xi.data[10]=-2/(mi-gi),xi.data[11]=0,xi.data[12]=-(hi+ci)/(hi-ci),xi.data[13]=-(pi+_i)/(pi-_i),xi.data[14]=-(mi+gi)/(mi-gi),xi.data[15]=1,xi}clone(ci){const hi=ci||new Matrix;return hi.data[0]=this.data[0],hi.data[1]=this.data[1],hi.data[2]=this.data[2],hi.data[3]=this.data[3],hi.data[4]=this.data[4],hi.data[5]=this.data[5],hi.data[6]=this.data[6],hi.data[7]=this.data[7],hi.data[8]=this.data[8],hi.data[9]=this.data[9],hi.data[10]=this.data[10],hi.data[11]=this.data[11],hi.data[12]=this.data[12],hi.data[13]=this.data[13],hi.data[14]=this.data[14],hi.data[15]=this.data[15],hi}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(ci){const hi=new Matrix;return hi.data=ci,hi}static identity(){const ci=new Matrix;return ci.data[0]=1,ci.data[1]=0,ci.data[2]=0,ci.data[3]=0,ci.data[4]=0,ci.data[5]=1,ci.data[6]=0,ci.data[7]=0,ci.data[8]=0,ci.data[9]=0,ci.data[10]=1,ci.data[11]=0,ci.data[12]=0,ci.data[13]=0,ci.data[14]=0,ci.data[15]=1,ci}reset(){const ci=this;return ci.data[0]=1,ci.data[1]=0,ci.data[2]=0,ci.data[3]=0,ci.data[4]=0,ci.data[5]=1,ci.data[6]=0,ci.data[7]=0,ci.data[8]=0,ci.data[9]=0,ci.data[10]=1,ci.data[11]=0,ci.data[12]=0,ci.data[13]=0,ci.data[14]=0,ci.data[15]=1,ci}static translation(ci,hi){const _i=Matrix.identity();return _i.data[12]=ci,_i.data[13]=hi,_i}static scale(ci,hi){const _i=Matrix.identity();return _i.data[0]=ci,_i.data[5]=hi,_i.data[10]=1,_i.data[15]=1,_i}static rotation(ci){const hi=Matrix.identity();return hi.data[0]=Math.cos(ci),hi.data[4]=-Math.sin(ci),hi.data[1]=Math.sin(ci),hi.data[5]=Math.cos(ci),hi}multiply(ci,hi){if(ci instanceof Vector){const _i=hi||new Vector(0,0),pi=ci,gi=pi.x*this.data[0]+pi.y*this.data[4]+this.data[12],mi=pi.x*this.data[1]+pi.y*this.data[5]+this.data[13];return _i.x=gi,_i.y=mi,_i}else{const _i=hi||new Matrix,pi=ci,gi=this.data[0],mi=this.data[1],xi=this.data[2],yi=this.data[3],Ci=this.data[4],Ei=this.data[5],Ai=this.data[6],ki=this.data[7],Pi=this.data[8],Ii=this.data[9],Di=this.data[10],Fi=this.data[11],Li=this.data[12],Bi=this.data[13],Ri=this.data[14],$i=this.data[15],Ni=pi.data[0],ji=pi.data[1],Ui=pi.data[2],qi=pi.data[3],Ji=pi.data[4],rs=pi.data[5],ss=pi.data[6],zi=pi.data[7],Gi=pi.data[8],Vi=pi.data[9],Qi=pi.data[10],is=pi.data[11],Zi=pi.data[12],ts=pi.data[13],cs=pi.data[14],ls=pi.data[15];_i.data[0]=gi*Ni+Ci*ji+Pi*Ui+Li*qi,_i.data[1]=mi*Ni+Ei*ji+Ii*Ui+Bi*qi,_i.data[2]=xi*Ni+Ai*ji+Di*Ui+Ri*qi,_i.data[3]=yi*Ni+ki*ji+Fi*Ui+$i*qi,_i.data[4]=gi*Ji+Ci*rs+Pi*ss+Li*zi,_i.data[5]=mi*Ji+Ei*rs+Ii*ss+Bi*zi,_i.data[6]=xi*Ji+Ai*rs+Di*ss+Ri*zi,_i.data[7]=yi*Ji+ki*rs+Fi*ss+$i*zi,_i.data[8]=gi*Gi+Ci*Vi+Pi*Qi+Li*is,_i.data[9]=mi*Gi+Ei*Vi+Ii*Qi+Bi*is,_i.data[10]=xi*Gi+Ai*Vi+Di*Qi+Ri*is,_i.data[11]=yi*Gi+ki*Vi+Fi*Qi+$i*is,_i.data[12]=gi*Zi+Ci*ts+Pi*cs+Li*ls,_i.data[13]=mi*Zi+Ei*ts+Ii*cs+Bi*ls,_i.data[14]=xi*Zi+Ai*ts+Di*cs+Ri*ls,_i.data[15]=yi*Zi+ki*ts+Fi*cs+$i*ls;const us=this.getScale();return _i._scaleSignX=sign(us.x)*sign(_i._scaleSignX),_i._scaleSignY=sign(us.y)*sign(_i._scaleSignY),_i}}translate(ci,hi){const _i=this.data[0],pi=this.data[1],gi=this.data[2],mi=this.data[3],xi=this.data[4],yi=this.data[5],Ci=this.data[6],Ei=this.data[7],Ai=this.data[8],ki=this.data[9],Pi=this.data[10],Ii=this.data[11],Di=this.data[12],Fi=this.data[13],Li=this.data[14],Bi=this.data[15],Ri=0,$i=1;return this.data[12]=_i*ci+xi*hi+Ai*Ri+Di*$i,this.data[13]=pi*ci+yi*hi+ki*Ri+Fi*$i,this.data[14]=gi*ci+Ci*hi+Pi*Ri+Li*$i,this.data[15]=mi*ci+Ei*hi+Ii*Ri+Bi*$i,this}setPosition(ci,hi){this.data[12]=ci,this.data[13]=hi}getPosition(){return vec(this.data[12],this.data[13])}rotate(ci){const hi=this.data[0],_i=this.data[1],pi=this.data[2],gi=this.data[3],mi=this.data[4],xi=this.data[5],yi=this.data[6],Ci=this.data[7],Ei=Math.sin(ci),Ai=Math.cos(ci);return this.data[0]=Ai*hi+Ei*mi,this.data[1]=Ai*_i+Ei*xi,this.data[2]=Ai*pi+Ei*yi,this.data[3]=Ai*gi+Ei*Ci,this.data[4]=Ai*mi-Ei*hi,this.data[5]=Ai*xi-Ei*_i,this.data[6]=Ai*yi-Ei*pi,this.data[7]=Ai*Ci-Ei*gi,this}scale(ci,hi){const _i=this.data[0],pi=this.data[1],gi=this.data[2],mi=this.data[3],xi=this.data[4],yi=this.data[5],Ci=this.data[6],Ei=this.data[7];return this.data[0]=_i*ci,this.data[1]=pi*ci,this.data[2]=gi*ci,this.data[3]=mi*ci,this.data[4]=xi*hi,this.data[5]=yi*hi,this.data[6]=Ci*hi,this.data[7]=Ei*hi,this}setRotation(ci){const hi=this.getScale(),_i=Math.sin(ci),pi=Math.cos(ci);this.data[0]=pi*hi.x,this.data[1]=_i*hi.y,this.data[4]=-_i*hi.x,this.data[5]=pi*hi.y}getRotation(){const ci=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return canonicalizeAngle(ci)}getScaleX(){const ci=vec(this.data[0],this.data[4]).magnitude;return this._scaleSignX*ci}getScaleY(){const ci=vec(this.data[1],this.data[5]).magnitude;return this._scaleSignY*ci}getScale(){return vec(this.getScaleX(),this.getScaleY())}setScaleX(ci){if(this._scaleX===ci)return;this._scaleSignX=sign(ci);const hi=vec(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=hi.x*ci,this.data[4]=hi.y*ci,this._scaleX=ci}setScaleY(ci){if(this._scaleY===ci)return;this._scaleSignY=sign(ci);const hi=vec(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=hi.x*ci,this.data[5]=hi.y*ci,this._scaleY=ci}setScale(ci){this.setScaleX(ci.x),this.setScaleY(ci.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(ci){const _i=1/this.getBasisDeterminant(),pi=this.data[0],gi=this.data[4],mi=this.data[1],xi=this.data[5],yi=ci||Matrix.identity();yi.data[0]=xi*_i,yi.data[1]=-mi*_i,yi.data[4]=-gi*_i,yi.data[5]=pi*_i;const Ci=this.data[12],Ei=this.data[13];return yi.data[12]=-(Ci*yi.data[0]+Ei*yi.data[4]),yi.data[13]=-(Ci*yi.data[1]+Ei*yi.data[5]),yi}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class AffineMatrix{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const ci=new AffineMatrix;return ci.data[0]=1,ci.data[1]=0,ci.data[2]=0,ci.data[3]=1,ci.data[4]=0,ci.data[5]=0,ci}static translation(ci,hi){const _i=AffineMatrix.identity();return _i.data[4]=ci,_i.data[5]=hi,_i}static scale(ci,hi){const _i=AffineMatrix.identity();return _i.data[0]=ci,_i.data[3]=hi,_i._scale[0]=ci,_i._scale[1]=hi,_i}static rotation(ci){const hi=AffineMatrix.identity();return hi.data[0]=Math.cos(ci),hi.data[1]=Math.sin(ci),hi.data[2]=-Math.sin(ci),hi.data[3]=Math.cos(ci),hi}setPosition(ci,hi){this.data[4]=ci,this.data[5]=hi}getPosition(){return vec(this.data[4],this.data[5])}rotate(ci){const hi=this.data[0],_i=this.data[1],pi=this.data[2],gi=this.data[3],mi=Math.sin(ci),xi=Math.cos(ci);return this.data[0]=xi*hi+mi*pi,this.data[1]=xi*_i+mi*gi,this.data[2]=xi*pi-mi*hi,this.data[3]=xi*gi-mi*_i,this}translate(ci,hi){const _i=this.data[0],pi=this.data[1],gi=this.data[2],mi=this.data[3],xi=this.data[4],yi=this.data[5];return this.data[4]=_i*ci+gi*hi+xi,this.data[5]=pi*ci+mi*hi+yi,this}scale(ci,hi){const _i=this.data[0],pi=this.data[1],gi=this.data[2],mi=this.data[3];return this.data[0]=_i*ci,this.data[1]=pi*ci,this.data[2]=gi*hi,this.data[3]=mi*hi,this._scale[0]=ci,this._scale[1]=hi,this._scaleSignX=sign(ci),this._scaleSignY=sign(hi),this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(ci){const hi=this.determinant();let _i=hi;hi!==0&&(_i=1/hi);const pi=this.data[0],gi=this.data[2],mi=this.data[1],xi=this.data[3],yi=ci||AffineMatrix.identity();yi.data[0]=xi*_i,yi.data[1]=-mi*_i,yi.data[2]=-gi*_i,yi.data[3]=pi*_i;const Ci=this.data[4],Ei=this.data[5];return yi.data[4]=-(Ci*yi.data[0]+Ei*yi.data[2]),yi.data[5]=-(Ci*yi.data[1]+Ei*yi.data[3]),yi}multiply(ci,hi){if(ci instanceof Vector){const _i=hi||new Vector(0,0),pi=ci,gi=pi.x*this.data[0]+pi.y*this.data[2]+this.data[4],mi=pi.x*this.data[1]+pi.y*this.data[3]+this.data[5];return _i.x=gi,_i.y=mi,_i}else{const _i=hi||new AffineMatrix,pi=ci,gi=this.data[0],mi=this.data[1],xi=this.data[2],yi=this.data[3],Ci=this.data[4],Ei=this.data[5],Ai=pi.data[0],ki=pi.data[1],Pi=pi.data[2],Ii=pi.data[3],Di=pi.data[4],Fi=pi.data[5];_i.data[0]=gi*Ai+xi*ki,_i.data[1]=mi*Ai+yi*ki,_i.data[2]=gi*Pi+xi*Ii,_i.data[3]=mi*Pi+yi*Ii,_i.data[4]=gi*Di+xi*Fi+Ci,_i.data[5]=mi*Di+yi*Fi+Ei;const Li=this._scaleSignX,Bi=this._scaleSignY;return _i._scaleSignX=Li*sign(_i._scaleSignX),_i._scaleSignY=Bi*sign(_i._scaleSignY),_i}}multiplyQuadInPlace(ci){const hi=ci[0]*this.data[0]+ci[1]*this.data[2]+this.data[4],_i=ci[0]*this.data[1]+ci[1]*this.data[3]+this.data[5];ci[0]=hi,ci[1]=_i;const pi=ci[2]*this.data[0]+ci[3]*this.data[2]+this.data[4],gi=ci[2]*this.data[1]+ci[3]*this.data[3]+this.data[5];ci[2]=pi,ci[3]=gi;const mi=ci[4]*this.data[0]+ci[5]*this.data[2]+this.data[4],xi=ci[4]*this.data[1]+ci[5]*this.data[3]+this.data[5];ci[4]=mi,ci[5]=xi;const yi=ci[6]*this.data[0]+ci[7]*this.data[2]+this.data[4],Ci=ci[6]*this.data[1]+ci[7]*this.data[3]+this.data[5];ci[6]=yi,ci[7]=Ci}to4x4(){const ci=new Matrix;return ci.data[0]=this.data[0],ci.data[1]=this.data[1],ci.data[2]=0,ci.data[3]=0,ci.data[4]=this.data[2],ci.data[5]=this.data[3],ci.data[6]=0,ci.data[7]=0,ci.data[8]=0,ci.data[9]=0,ci.data[10]=1,ci.data[11]=0,ci.data[12]=this.data[4],ci.data[13]=this.data[5],ci.data[14]=0,ci.data[15]=1,ci}setRotation(ci){const hi=this.getScale(),_i=Math.sin(ci),pi=Math.cos(ci);this.data[0]=pi*hi.x,this.data[1]=_i*hi.y,this.data[2]=-_i*hi.x,this.data[3]=pi*hi.y}getRotation(){const ci=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return canonicalizeAngle(ci)}getScaleX(){const ci=this.data[0]*this.data[0]+this.data[2]*this.data[2];return ci===1?this._scaleSignX:this._scaleSignX*Math.sqrt(ci)}getScaleY(){const ci=this.data[1]*this.data[1]+this.data[3]*this.data[3];return ci===1?this._scaleSignY:this._scaleSignY*Math.sqrt(ci)}getScale(){return vec(this.getScaleX(),this.getScaleY())}setScaleX(ci){if(ci===this._scale[0])return;this._scaleSignX=sign(ci);const hi=vec(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=hi.x*ci,this.data[2]=hi.y*ci,this._scale[0]=ci}setScaleY(ci){if(ci===this._scale[1])return;this._scaleSignY=sign(ci);const hi=vec(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=hi.x*ci,this.data[3]=hi.y*ci,this._scale[1]=ci}setScale(ci){this.setScaleX(ci.x),this.setScaleY(ci.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const ci=this;return ci.data[0]=1,ci.data[1]=0,ci.data[2]=0,ci.data[3]=1,ci.data[4]=0,ci.data[5]=0,ci}clone(ci){const hi=ci||new AffineMatrix;return hi.data[0]=this.data[0],hi.data[1]=this.data[1],hi.data[2]=this.data[2],hi.data[3]=this.data[3],hi.data[4]=this.data[4],hi.data[5]=this.data[5],hi._scaleSignX=this._scaleSignX,hi._scaleSignY=this._scaleSignY,hi}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class RentalPool{constructor(ci,hi,_i=1){this.builder=ci,this.cleaner=hi,this._pool=[],this._size=0,this.grow(_i)}grow(ci){if(ci>0){this._size+=ci;for(let hi=0;hi<ci;hi++)this._pool.push(this.builder())}}rent(ci=!1){return this._pool.length===0&&this.grow(this._size),ci?this.cleaner(this._pool.pop()):this._pool.pop()}return(ci){this._pool.push(ci)}}class TransformStack{constructor(){this._pool=new RentalPool(()=>AffineMatrix.identity(),ci=>ci.reset(),100),this._transforms=[],this._currentTransform=this._pool.rent(!0)}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone(this._pool.rent())}restore(){this._pool.return(this._currentTransform),this._currentTransform=this._transforms.pop()}translate(ci,hi){return this._currentTransform.translate(ci,hi)}rotate(ci){return this._currentTransform.rotate(ci)}scale(ci,hi){return this._currentTransform.scale(ci,hi)}reset(){this._currentTransform.reset()}set current(ci){this._currentTransform=ci}get current(){return this._currentTransform}}class ContextState{constructor(){this.opacity=1,this.z=0,this.tint=Color.White,this.material=null}}class StateStack{constructor(){this._pool=new RentalPool(()=>new ContextState,ci=>(ci.opacity=1,ci.z=0,ci.tint=Color.White,ci.material=null,ci),100),this.current=this._pool.rent(!0),this._states=[]}_cloneState(ci){var hi;return ci.opacity=this.current.opacity,ci.z=this.current.z,ci.tint=(hi=this.current.tint)===null||hi===void 0?void 0:hi.clone(),ci.material=this.current.material,ci}save(){this._states.push(this.current),this.current=this._cloneState(this._pool.rent())}restore(){this._pool.return(this.current),this.current=this._states.pop()}}const ResourceEvents={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class Resource{constructor(ci,hi,_i=!1){this.path=ci,this.responseType=hi,this.bustCache=_i,this.data=null,this.logger=Logger.getInstance(),this.events=new EventEmitter}isLoaded(){return this.data!==null}_cacheBust(ci){return/\?\w*=\w*/.test(ci)?ci+="&__="+Date.now():ci+="?__="+Date.now(),ci}load(){return new Promise((ci,hi)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),ci(this.data);return}const _i=new XMLHttpRequest;_i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),_i.responseType=this.responseType,_i.addEventListener("loadstart",pi=>this.events.emit("loadstart",pi)),_i.addEventListener("progress",pi=>this.events.emit("progress",pi)),_i.addEventListener("error",pi=>this.events.emit("error",pi)),_i.addEventListener("load",pi=>this.events.emit("load",pi)),_i.addEventListener("load",()=>{if(_i.status!==0&&_i.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",_i.status),this.events.emit("error",_i.response),hi(new Error(_i.statusText));return}if(_i.response instanceof Blob&&_i.response.type==="text/html"){const pi=`Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!

Check your server configuration, for example Vite serves static files from the /public folder`;this.events.emit("error",_i.response),hi(new Error(pi));return}this.data=_i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),ci(this.data)}),_i.send()})}}function watch(fi,ci){return fi&&(fi.__isProxy===void 0?new Proxy(fi,{set:(hi,_i,pi)=>(hi[_i]!==pi&&(hi[_i]=pi,typeof _i=="string"&&_i[0]!=="_"&&ci(hi)),!0),get:(hi,_i)=>_i!=="__isProxy"?hi[_i]:!0}):fi)}const createHandler=(fi=[],ci,hi)=>({get:(_i,pi)=>pi==="__isProxy"?!0:typeof _i[pi]=="object"&&_i[pi]!=null?new Proxy(_i[pi],createHandler([...fi,pi],ci,hi)):_i[pi],set:(_i,pi,gi)=>(typeof pi=="string"&&pi[0]!=="_"&&ci(hi),_i[pi]=gi,!0)});function watchDeep(fi,ci){return fi&&(fi.__isProxy===void 0?new Proxy(fi,createHandler([],ci,fi)):fi)}class Graphic{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(ci){this._flipHorizontal=ci,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(ci){this._flipVertical=ci,this._transformStale=!0}get rotation(){return this._rotation}set rotation(ci){this._rotation=ci,this._transformStale=!0}get scale(){return this._scale}set scale(ci){this._scale=watch(ci,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(ci){ci&&(this._origin=watch(ci,()=>{this._transformStale=!0})),this._transformStale=!0}constructor(ci){var hi,_i,pi,gi,mi,xi,yi;this.id=Graphic._ID++,this.transform=AffineMatrix.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=Vector.One,this._width=0,this._height=0,ci&&(this.origin=(hi=ci.origin)!==null&&hi!==void 0?hi:this.origin,this.flipHorizontal=(_i=ci.flipHorizontal)!==null&&_i!==void 0?_i:this.flipHorizontal,this.flipVertical=(pi=ci.flipVertical)!==null&&pi!==void 0?pi:this.flipVertical,this.rotation=(gi=ci.rotation)!==null&&gi!==void 0?gi:this.rotation,this.opacity=(mi=ci.opacity)!==null&&mi!==void 0?mi:this.opacity,this.scale=(xi=ci.scale)!==null&&xi!==void 0?xi:this.scale,this.tint=(yi=ci.tint)!==null&&yi!==void 0?yi:this.tint,ci.width&&(this._width=ci.width),ci.height&&(this._height=ci.height))}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():void 0,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():void 0,tint:this.tint?this.tint.clone():void 0}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(ci){this._width=ci,this._transformStale=!0}set height(ci){this._height=ci,this._transformStale=!0}get localBounds(){return BoundingBox.fromDimension(this.width,this.height,Vector.Zero)}draw(ci,hi,_i){this._preDraw(ci,hi,_i),this._drawImage(ci,0,0),this._postDraw(ci)}_preDraw(ci,hi,_i){ci.save(),ci.translate(hi,_i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),ci.multiply(this.transform),ci.opacity=ci.opacity*this.opacity,this.tint&&(ci.tint=this.tint)}_rotate(ci){var hi;const _i=this.scale.x>0?1:-1,pi=this.scale.y>0?1:-1,gi=(hi=this.origin)!==null&&hi!==void 0?hi:vec(this.width/2,this.height/2);ci.translate(gi.x,gi.y),ci.rotate(this.rotation),ci.scale(_i,pi),ci.translate(-gi.x,-gi.y)}_flip(ci){this.flipHorizontal&&(ci.translate(this.width/this.scale.x,0),ci.scale(-1,1)),this.flipVertical&&(ci.translate(0,this.height/this.scale.y),ci.scale(1,-1))}_postDraw(ci){this.showDebug&&ci.debug.drawRect(0,0,this.width,this.height),ci.restore()}}Graphic._ID=0;class Sprite extends Graphic{static from(ci,hi){return new Sprite({image:ci,...hi})}constructor(ci){var hi,_i;super(ci),this._logger=Logger.getInstance(),this._dirty=!0,this.image=ci.image;const{width:pi,height:gi}=ci;this.sourceView=(hi=ci.sourceView)!==null&&hi!==void 0?hi:{x:0,y:0,width:pi??0,height:gi??0},this.destSize=(_i=ci.destSize)!==null&&_i!==void 0?_i:{width:pi??0,height:gi??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(ci){ci/=Math.abs(this.scale.x),this.destSize.width=ci,super.width=Math.ceil(this.destSize.width)}set height(ci){ci/=Math.abs(this.scale.y),this.destSize.height=ci,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var ci,hi,_i,pi,gi,mi;const{width:xi,height:yi}=this.image;this.sourceView.width=((ci=this.sourceView)===null||ci===void 0?void 0:ci.width)||xi,this.sourceView.height=((hi=this.sourceView)===null||hi===void 0?void 0:hi.height)||yi,this.destSize.width=((_i=this.destSize)===null||_i===void 0?void 0:_i.width)||((pi=this.sourceView)===null||pi===void 0?void 0:pi.width)||xi,this.destSize.height=((gi=this.destSize)===null||gi===void 0?void 0:gi.height)||((mi=this.sourceView)===null||mi===void 0?void 0:mi.height)||yi,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(ci,hi,_i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(ci,hi,_i)}_drawImage(ci,hi,_i){this.image.isLoaded()?ci.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,hi,_i,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new Sprite({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var ImageFiltering;(function(fi){fi.Pixel="Pixel",fi.Blended="Blended"})(ImageFiltering||(ImageFiltering={}));function parseImageFiltering(fi){switch(fi){case ImageFiltering.Pixel:return ImageFiltering.Pixel;case ImageFiltering.Blended:return ImageFiltering.Blended;default:return}}var ImageWrapping;(function(fi){fi.Clamp="Clamp",fi.Repeat="Repeat",fi.Mirror="Mirror"})(ImageWrapping||(ImageWrapping={}));function parseImageWrapping(fi){switch(fi){case ImageWrapping.Clamp:return ImageWrapping.Clamp;case ImageWrapping.Repeat:return ImageWrapping.Repeat;case ImageWrapping.Mirror:return ImageWrapping.Mirror;default:return ImageWrapping.Clamp}}class TextureLoader{constructor(ci,hi){var _i;this._garbageCollector=hi,this._textureMap=new Map,this._collect=pi=>{var gi;if(this._gl){const mi=(gi=pi.dataset.originalSrc)!==null&&gi!==void 0?gi:pi.constructor.name;return TextureLoader._LOGGER.debug(`WebGL Texture for ${mi} collected`),this.delete(pi),!0}return!1},this._gl=ci,TextureLoader._MAX_TEXTURE_SIZE=ci.getParameter(ci.MAX_TEXTURE_SIZE),this._garbageCollector&&(TextureLoader._LOGGER.debug("WebGL Texture collection interval:",this._garbageCollector.collectionInterval),(_i=this._garbageCollector.garbageCollector)===null||_i===void 0||_i.registerCollector("texture",this._garbageCollector.collectionInterval,this._collect))}dispose(){for(const[ci]of this._textureMap)this.delete(ci);this._textureMap.clear(),this._gl=null}get(ci){return this._textureMap.get(ci)}has(ci){return this._textureMap.has(ci)}load(ci,hi,_i=!1){var pi,gi;const mi=this._gl;if(!mi)return null;const{filtering:xi,wrapping:yi}={...hi};let Ci=null;if(this.has(ci)&&(Ci=this.get(ci)),Ci)return _i&&(mi.bindTexture(mi.TEXTURE_2D,Ci),mi.texImage2D(mi.TEXTURE_2D,0,mi.RGBA,mi.RGBA,mi.UNSIGNED_BYTE,ci)),(pi=this._garbageCollector)===null||pi===void 0||pi.garbageCollector.touch(ci),Ci;Ci=mi.createTexture(),TextureLoader.checkImageSizeSupportedAndLog(ci),mi.bindTexture(mi.TEXTURE_2D,Ci),mi.pixelStorei(mi.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let Ei;yi&&(typeof yi=="string"?Ei={x:yi,y:yi}:Ei={x:yi.x,y:yi.y});const{x:Ai,y:ki}=Ei??TextureLoader.wrapping;switch(Ai){case ImageWrapping.Clamp:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_S,mi.CLAMP_TO_EDGE);break;case ImageWrapping.Repeat:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_S,mi.REPEAT);break;case ImageWrapping.Mirror:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_S,mi.MIRRORED_REPEAT);break;default:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_S,mi.CLAMP_TO_EDGE)}switch(ki){case ImageWrapping.Clamp:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_T,mi.CLAMP_TO_EDGE);break;case ImageWrapping.Repeat:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_T,mi.REPEAT);break;case ImageWrapping.Mirror:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_T,mi.MIRRORED_REPEAT);break;default:mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_WRAP_T,mi.CLAMP_TO_EDGE)}const Pi=xi??TextureLoader.filtering;return mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_MIN_FILTER,Pi===ImageFiltering.Pixel?mi.NEAREST:mi.LINEAR),mi.texParameteri(mi.TEXTURE_2D,mi.TEXTURE_MAG_FILTER,Pi===ImageFiltering.Pixel?mi.NEAREST:mi.LINEAR),mi.texImage2D(mi.TEXTURE_2D,0,mi.RGBA,mi.RGBA,mi.UNSIGNED_BYTE,ci),this._textureMap.set(ci,Ci),(gi=this._garbageCollector)===null||gi===void 0||gi.garbageCollector.addCollectableResource("texture",ci),Ci}delete(ci){const hi=this._gl;if(hi&&this.has(ci)){const _i=this.get(ci);_i&&(this._textureMap.delete(ci),hi.deleteTexture(_i))}}static checkImageSizeSupportedAndLog(ci){var hi;const _i=(hi=ci.dataset.originalSrc)!==null&&hi!==void 0?hi:"internal canvas bitmap";return ci.width>TextureLoader._MAX_TEXTURE_SIZE||ci.height>TextureLoader._MAX_TEXTURE_SIZE?(TextureLoader._LOGGER.error(`The image [${_i}] provided to Excalibur is too large for the device's maximum texture size of (${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((ci.width>4096||ci.height>4096)&&TextureLoader._LOGGER.warn(`The image [${_i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}TextureLoader._LOGGER=Logger.getInstance();TextureLoader.filtering=ImageFiltering.Blended;TextureLoader.wrapping={x:ImageWrapping.Clamp,y:ImageWrapping.Clamp};TextureLoader._MAX_TEXTURE_SIZE=4096;const ImageSourceAttributeConstants={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class ImageSource{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(ci,hi,_i){this._logger=Logger.getInstance(),this.data=new Image,this._readyFuture=new Future,this.ready=this._readyFuture.promise,this.path=ci;let pi=!1,gi;typeof hi=="boolean"?pi=hi:{filtering:_i,wrapping:gi,bustCache:pi}={...hi},this._resource=new Resource(ci,"blob",pi),this.filtering=_i??this.filtering,typeof gi=="string"?this.wrapping={x:gi,y:gi}:this.wrapping=gi??this.wrapping,ci.endsWith(".gif")&&this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${ci} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`)}static fromHtmlImageElement(ci,hi){const _i=new ImageSource("");if(_i._src="image-element",_i.data=ci,_i.data.setAttribute("data-original-src","image-element"),hi!=null&&hi.filtering?_i.data.setAttribute(ImageSourceAttributeConstants.Filtering,hi==null?void 0:hi.filtering):_i.data.setAttribute(ImageSourceAttributeConstants.Filtering,ImageFiltering.Blended),hi!=null&&hi.wrapping){let pi;typeof hi.wrapping=="string"?pi={x:hi.wrapping,y:hi.wrapping}:pi={x:hi.wrapping.x,y:hi.wrapping.y},_i.data.setAttribute(ImageSourceAttributeConstants.WrappingX,pi.x),_i.data.setAttribute(ImageSourceAttributeConstants.WrappingY,pi.y)}else _i.data.setAttribute(ImageSourceAttributeConstants.WrappingX,ImageWrapping.Clamp),_i.data.setAttribute(ImageSourceAttributeConstants.WrappingY,ImageWrapping.Clamp);return TextureLoader.checkImageSizeSupportedAndLog(ci),_i._readyFuture.resolve(ci),_i}static fromHtmlCanvasElement(ci,hi){const _i=new ImageSource("");if(_i._src="canvas-element-blob",_i.data.setAttribute("data-original-src","canvas-element-blob"),hi!=null&&hi.filtering?_i.data.setAttribute(ImageSourceAttributeConstants.Filtering,hi==null?void 0:hi.filtering):_i.data.setAttribute(ImageSourceAttributeConstants.Filtering,ImageFiltering.Blended),hi!=null&&hi.wrapping){let pi;typeof hi.wrapping=="string"?pi={x:hi.wrapping,y:hi.wrapping}:pi={x:hi.wrapping.x,y:hi.wrapping.y},_i.data.setAttribute(ImageSourceAttributeConstants.WrappingX,pi.x),_i.data.setAttribute(ImageSourceAttributeConstants.WrappingY,pi.y)}else _i.data.setAttribute(ImageSourceAttributeConstants.WrappingX,ImageWrapping.Clamp),_i.data.setAttribute(ImageSourceAttributeConstants.WrappingY,ImageWrapping.Clamp);return TextureLoader.checkImageSizeSupportedAndLog(ci),ci.toBlob(pi=>{const gi=URL.createObjectURL(pi);_i.image.onload=()=>{URL.revokeObjectURL(gi),_i.data=_i.image,_i._readyFuture.resolve(_i.image)},_i.image.src=gi}),_i}static fromSvgString(ci,hi){const _i=new Blob([ci],{type:"image/svg+xml"}),pi=URL.createObjectURL(_i);return new ImageSource(pi,hi)}get bustCache(){return this._resource.bustCache}set bustCache(ci){this._resource.bustCache=ci}async load(){var ci,hi,_i,pi;if(this.isLoaded())return this.data;try{let gi;if(this.path.includes("data:image/"))gi=this.path;else{const yi=await this._resource.load();gi=URL.createObjectURL(yi)}const mi=new Image,xi=new Future;mi.onload=()=>xi.resolve(),mi.src=gi,mi.setAttribute("data-original-src",this.path),await xi.promise,this.data=mi,TextureLoader.checkImageSizeSupportedAndLog(this.data)}catch(gi){throw`Error loading ImageSource from path '${this.path}' with error [${gi.message}]`}return this.data.setAttribute(ImageSourceAttributeConstants.Filtering,this.filtering),this.data.setAttribute(ImageSourceAttributeConstants.WrappingX,(hi=(ci=this.wrapping)===null||ci===void 0?void 0:ci.x)!==null&&hi!==void 0?hi:ImageWrapping.Clamp),this.data.setAttribute(ImageSourceAttributeConstants.WrappingY,(pi=(_i=this.wrapping)===null||_i===void 0?void 0:_i.y)!==null&&pi!==void 0?pi:ImageWrapping.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(ci){return Sprite.from(this,ci)}unload(){this.data=new Image}}class SpriteFont extends Graphic{constructor(ci){super(ci),this._text="",this.alphabet="",this.shadow=void 0,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=Logger.getInstance();const{alphabet:hi,spriteSheet:_i,caseInsensitive:pi,spacing:gi,shadow:mi,lineHeight:xi}=ci;this.alphabet=hi,this.spriteSheet=_i,this.caseInsensitive=pi??this.caseInsensitive,this.spacing=gi??this.spacing,this.shadow=mi??this.shadow,this.lineHeight=xi??this.lineHeight}_getCharacterSprites(ci){const hi=[],_i=this.caseInsensitive?ci.toLocaleLowerCase():ci,pi=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let gi=0;gi<_i.length;gi++){const mi=_i[gi];let xi=pi.indexOf(mi);xi===-1&&(xi=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${mi}' in configured alphabet '${pi}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const yi=this.spriteSheet.sprites[xi];yi?hi.push(yi):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${mi}' at index '${xi}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return hi}measureText(ci,hi){const _i=this._getLinesFromText(ci,hi),pi=_i.reduce((yi,Ci)=>yi.length>Ci.length?yi:Ci),gi=this._getCharacterSprites(pi);let mi=0,xi=0;for(const yi of gi)mi+=yi.width+this.spacing,xi=Math.max(xi,yi.height);return BoundingBox.fromDimension(mi*this.scale.x,xi*_i.length*this.scale.y,Vector.Zero)}_drawImage(ci,hi,_i,pi){var gi;let mi=0,xi=0,yi=0;const Ci=this._getLinesFromText(this._text,pi);for(const Ei of Ci){for(const Ai of this._getCharacterSprites(Ei))Ai.draw(ci,hi+mi,_i+xi),mi+=Ai.width+this.spacing,yi=Math.max(yi,Ai.height);mi=0,xi+=(gi=this.lineHeight)!==null&&gi!==void 0?gi:yi}}render(ci,hi,_i,pi,gi,mi){this._text=hi;const xi=this.measureText(hi,mi);this.width=xi.width,this.height=xi.height,this.shadow&&(ci.save(),ci.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(ci,pi,gi),this._drawImage(ci,0,0,mi),this._postDraw(ci),ci.restore()),this._preDraw(ci,pi,gi),this._drawImage(ci,0,0,mi),this._postDraw(ci)}clone(){return new SpriteFont({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(ci,hi){var _i;if(this._cachedText===ci&&this._cachedRenderWidth===hi&&(!((_i=this._cachedLines)===null||_i===void 0)&&_i.length))return this._cachedLines;const pi=ci.split(`
`);if(hi==null)return pi;for(let gi=0;gi<pi.length;gi++){let mi=pi[gi],xi="";if(this.measureText(mi).width>hi){for(;this.measureText(mi).width>hi;)xi=mi[mi.length-1]+xi,mi=mi.slice(0,-1);pi[gi]=mi,pi[gi+1]=xi}}return this._cachedText=ci,this._cachedLines=pi,this._cachedRenderWidth=hi,pi}}class TiledSprite extends Sprite{constructor(ci){super({image:ci.image,sourceView:ci.sourceView,destSize:{width:ci.width,height:ci.height},flipHorizontal:ci.flipHorizontal,flipVertical:ci.flipVertical,rotation:ci.rotation,scale:ci.scale,opacity:ci.opacity,tint:ci.tint,origin:ci.origin}),this._ready=new Future,this.ready=this._ready.promise,this._options=ci,this.image.isLoaded()?this._applyTiling():this.image.ready.then(()=>this._applyTiling())}static fromSprite(ci,hi){return new TiledSprite({sourceView:{...ci.sourceView},width:ci.width,height:ci.height,...hi,image:ci.image})}_applyTiling(){const{width:ci,height:hi,filtering:_i,wrapping:pi}={...this._options},gi=document.createElement("canvas");gi.width=this.sourceView.width,gi.height=this.sourceView.height,gi.getContext("2d").drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,0,0,this.sourceView.width,this.sourceView.height);const xi=ImageSource.fromHtmlCanvasElement(gi,{wrapping:pi??ImageWrapping.Repeat,filtering:_i});ci&&(this.destSize.width=ci,this.sourceView.width=ci),hi&&(this.destSize.height=hi,this.sourceView.height=hi),this.sourceView.x=0,this.sourceView.y=0,this.image=xi,this.image.ready.then(()=>this._ready.resolve())}}class SpriteSheet{constructor(ci){this.sprites=[];const{sprites:hi,rows:_i,columns:pi}=ci;this.sprites=hi,this.rows=_i??1,this.columns=pi??this.sprites.length}getSprite(ci,hi,_i){var pi,gi,mi,xi,yi,Ci,Ei,Ai,ki;if(ci>=this.columns||ci<0)throw Error(`No sprite exists in the SpriteSheet at (${ci}, ${hi}), x: ${ci} should be between 0 and ${this.columns-1} columns`);if(hi>=this.rows||hi<0)throw Error(`No sprite exists in the SpriteSheet at (${ci}, ${hi}), y: ${hi} should be between 0 and ${this.rows-1} rows`);const Pi=ci+hi*this.columns,Ii=this.sprites[Pi];if(Ii){if(_i){const Di=Ii.clone();return Di.flipHorizontal=(pi=_i.flipHorizontal)!==null&&pi!==void 0?pi:Di.flipHorizontal,Di.flipVertical=(gi=_i.flipVertical)!==null&&gi!==void 0?gi:Di.flipVertical,Di.width=(mi=_i.width)!==null&&mi!==void 0?mi:Di.width,Di.height=(xi=_i.height)!==null&&xi!==void 0?xi:Di.height,Di.rotation=(yi=_i.rotation)!==null&&yi!==void 0?yi:Di.rotation,Di.scale=(Ci=_i.scale)!==null&&Ci!==void 0?Ci:Di.scale,Di.opacity=(Ei=_i.opacity)!==null&&Ei!==void 0?Ei:Di.opacity,Di.tint=(Ai=_i.tint)!==null&&Ai!==void 0?Ai:Di.tint,Di.origin=(ki=_i.origin)!==null&&ki!==void 0?ki:Di.origin,Di}return Ii}throw Error(`Invalid sprite coordinates (${ci}, ${hi})`)}getTiledSprite(ci,hi,_i){if(ci>=this.columns||ci<0)throw Error(`No sprite exists in the SpriteSheet at (${ci}, ${hi}), x: ${ci} should be between 0 and ${this.columns-1} columns`);if(hi>=this.rows||hi<0)throw Error(`No sprite exists in the SpriteSheet at (${ci}, ${hi}), y: ${hi} should be between 0 and ${this.rows-1} rows`);const pi=ci+hi*this.columns,gi=this.sprites[pi];if(gi)return TiledSprite.fromSprite(gi,_i);throw Error(`Invalid sprite coordinates (${ci}, ${hi})`)}static fromImageSourceWithSourceViews(ci){const hi=ci.sourceViews.map(_i=>new Sprite({image:ci.image,sourceView:_i}));return new SpriteSheet({sprites:hi})}static fromImageSource(ci){var hi;const _i=[];ci.spacing=(hi=ci.spacing)!==null&&hi!==void 0?hi:{};const{image:pi,grid:{rows:gi,columns:mi,spriteWidth:xi,spriteHeight:yi},spacing:{originOffset:Ci,margin:Ei}}=ci,Ai={x:0,y:0,...Ci},ki={x:0,y:0,...Ei};for(let Pi=0;Pi<mi;Pi++)for(let Ii=0;Ii<gi;Ii++)_i[Pi+Ii*mi]=new Sprite({image:pi,sourceView:{x:Pi*xi+ki.x*Pi+Ai.x,y:Ii*yi+ki.y*Ii+Ai.y,width:xi,height:yi},destSize:{height:yi,width:xi}});return new SpriteSheet({sprites:_i,rows:gi,columns:mi})}clone(){return new SpriteSheet({sprites:this.sprites.map(ci=>ci.clone()),rows:this.rows,columns:this.columns})}}const debug_font="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAABlFJREFUeJztndmy4yoMRcWt/v9fdr8EWoDAaDD4JntVpeqcxBrMIGQDNhEAAAAAAAAAAAAAAOCrSbMfr+u6yoEpTY+906GV57YtPkjyXj9WZZ+wHWHfo2N3/bU6Tte9Rv6ptruqRyMvKvvIX/zY3I/vjLeqsg6l/CWdp0KHKO/1Y1H2EdsR9j06Ntdfp+N03SvkH2u7i3pu5XkQ+DNTkgNJSok+/183xpcdWZHjgUzpQ2pGD67vaf//KRAGAq3tdhCy2tcMQKPyXyz7iPqrdBjbX5h9g7xbtvWf4ZJvM4D/BKG24Sd+IkQ0TC9aW5NM5FbO2HgrPVzW2vmN50DZNv/QWtl5bfPy85SBtdy9dFmjsf2F2SehTBVE+u+tkE5+lAGcJlFwGuodwRRU2Qe3rx0FhPNflc3HWC7BEh8EDGVR5IMCiLnDONtPp87qhxVH/S/LvzUAuDs/kyGimA5oSONKR1w8vsLpv+v+S9vhmS71JRiX1xB5CWZNw7m6rMrllMag/RJyWb67BEgpDVMWSydc+K47pr35w05kWd7ReEq6116KaG4CsbJ7OmV9PdZLEKkONiC1/7ZONVgDsajLIJPYp2OUAXRpnPcGmnIE6eSK4nv5YQqqSYO52JqnYfYj/PdQXQIY7XszuMofMgZRT/1LdeC5h2I5/0EdWDMY2Yb05WDE1RodVdpSA5r85slArAVnSf+89iP896St0f5bZKVA7Gk/3ja8q+152/+wrLqBWZTem3IBADbRBoDuHgAA4HdAAADgh0EAAOCHQQAA4IdBAADgh0EAAOCHuVsKbJ3P9M7jjuxHzGfv8j9iDt47Dx7hP8cjq5F/o/0T62Aer//ZOgDrajBp6aNlOWTEajKLjgj/Pcs/vfZD/a++3Pc8hNfZ966EVeh5vP75luDRJUAl0KzJfnopaqbaTuzZiulc2BS5lltFXntu3dcQsXadl59Wn1H+dfYNtrt2d6D/LDF9HkCQw6eXFbr8P9X5W/un5Ol8gz1t39p5pWOPn0vLynbgdnfe8maEQw+UIPJdfxdOd/4oTtVD0IYg8wDywGas0I04T5O3P8/qf2UWwPpkn1PbOT1bN2tFe59EM7TvKf+TRFw+erZ2ey4hpS3hp9qBkqq/tjsSU1OYqucBWB1yynt5QxC42Mdk30pAEIio//zRG3feBzLUX+TTjCKwlH83aI/KbpQBVEHgUGF0j/SitcLofHem8q6AyH0wBhFv4WszuOjy0yK2vc/oRWQoP2X9ve78jfaLnpncbBqQSC6s0HnIRT0a2yNZjfxT8+ir8t+yDsDTWaS6X70GP33+d77stp+I5HtBdwEAAPBl8ECApcAA/DBvfSowAGAB7/05ZAAA/DAIAADMMU3fOuS2ggAAwBjrorKoxWiPBxHMAgAg490Ts0VeePdA+ZfJDKcCh7sBqY88mmjklZeOt9iXPrvx2I2QPRnN2/qzyJ84h4gNcbtfasq5mM1rZr+bBWh2A+bIIX13Z9wqL+nQvFno7v3oq4tJItCed7isUT6C/I7BUn9KP95wDicYBYpcjncrO2c/dmW4tBtw4RiRld1IDxDyYsoXMHxF1w3dyz0Nne8033AOFsT6VgRCafl89fenTZUfbm8CGhrgdDcS7anAsvnkkP0IeCfQ+JzYunky6jhNYj5bl7++4fJvN9WDSKS/292A0wyANyKDI91bfkm3kcH7ckaP/SKW/VHKRZAcI14pP3beu0fPyn/DuZQbWMogNnsc16sziE96f7H/iai7uTf0/3N8lwFz/e13T00Djt4OrInCnkeChXT+qOcKOLA21tJpsv/G8/COnGnw97J9QwbTvd6djYSv7fxEVTuV/LzNhj7nOawv6bfbAGCYEpQ6HxFtuxs6sq9tzOYHobQ6Nje+6vo5BwFrPZ4OgMayS4PPt1NlzdLfbRCYBoBc+NaO4JWPwLEf33oN3unY3InKPQBW6Z7nEZzEmrl4iZjC804lqgePPEOguQcwWghUphxm343wyt/pWpWR0OrR+jvyxavHajfb9pTjbt9bH07Z5/expM4TLWfwb7QQqMoC+UDWXZo/4RgA38LOgUvLJAAQ1Td9y9//0ylxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+g79apuVUsS5ZmwAAAABJRU5ErkJggg==";class DebugText{constructor(){this.fontSheet=debug_font,this.size=16,this.load()}load(){return this._imageSource=new ImageSource(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=SpriteSheet.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new SpriteFont({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(ci,hi,_i){this._imageSource.isLoaded()&&this._spriteFont.render(ci,hi,null,_i.x,_i.y)}}class RenderSource{constructor(ci,hi){this._gl=ci,this._texture=hi}use(){const ci=this._gl;ci.activeTexture(ci.TEXTURE0),ci.bindTexture(ci.TEXTURE_2D,this._texture)}disable(){const ci=this._gl;ci.bindTexture(ci.TEXTURE_2D,null)}}class RenderTarget{constructor(ci){var hi,_i;this.antialias=!1,this.samples=1,this._gl=ci.gl,this.width=ci.width,this.height=ci.height,this.transparency=ci.transparency,this.antialias=(hi=ci.antialias)!==null&&hi!==void 0?hi:this.antialias,this.samples=(_i=ci.samples)!==null&&_i!==void 0?_i:this._gl.getParameter(this._gl.MAX_SAMPLES);const pi=this._gl;pi.drawingBufferFormat?this.bufferFormat=pi.drawingBufferFormat:this.transparency?this.bufferFormat=pi.RGBA8:this.bufferFormat=pi.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(ci,hi){const _i=this._gl;this.width=ci,this.height=hi,_i.bindTexture(_i.TEXTURE_2D,this._frameTexture),_i.texImage2D(_i.TEXTURE_2D,0,_i.RGBA,this.width,this.height,0,_i.RGBA,_i.UNSIGNED_BYTE,null),this._renderBuffer&&(_i.bindRenderbuffer(_i.RENDERBUFFER,this._renderBuffer),_i.renderbufferStorageMultisample(_i.RENDERBUFFER,Math.min(this.samples,_i.getParameter(_i.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const ci=this._gl;this._renderBuffer=ci.createRenderbuffer(),this._renderFrameBuffer=ci.createFramebuffer(),ci.bindRenderbuffer(ci.RENDERBUFFER,this._renderBuffer),ci.renderbufferStorageMultisample(ci.RENDERBUFFER,Math.min(this.samples,ci.getParameter(ci.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),ci.bindFramebuffer(ci.FRAMEBUFFER,this._renderFrameBuffer),ci.framebufferRenderbuffer(ci.FRAMEBUFFER,ci.COLOR_ATTACHMENT0,ci.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const ci=this._gl;this._frameTexture=ci.createTexture(),ci.bindTexture(ci.TEXTURE_2D,this._frameTexture),ci.texImage2D(ci.TEXTURE_2D,0,ci.RGBA,this.width,this.height,0,ci.RGBA,ci.UNSIGNED_BYTE,null),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_MIN_FILTER,ci.NEAREST),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_MAG_FILTER,ci.NEAREST),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_WRAP_S,ci.CLAMP_TO_EDGE),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_WRAP_T,ci.CLAMP_TO_EDGE);const hi=ci.COLOR_ATTACHMENT0;this._frameBuffer=ci.createFramebuffer(),ci.bindFramebuffer(ci.FRAMEBUFFER,this._frameBuffer),ci.framebufferTexture2D(ci.FRAMEBUFFER,hi,ci.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new RenderSource(this._gl,this._frameTexture)}blitToScreen(){const ci=this._gl;this._renderBuffer?(ci.bindFramebuffer(ci.READ_FRAMEBUFFER,this.renderFrameBuffer),ci.bindFramebuffer(ci.DRAW_FRAMEBUFFER,null),ci.clearBufferfv(ci.COLOR,0,[0,0,1,1]),ci.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,ci.COLOR_BUFFER_BIT,ci.LINEAR)):(ci.bindFramebuffer(ci.READ_FRAMEBUFFER,this.frameBuffer),ci.bindFramebuffer(ci.DRAW_FRAMEBUFFER,null),ci.clearBufferfv(ci.COLOR,0,[0,0,1,1]),ci.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,ci.COLOR_BUFFER_BIT,ci.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const ci=this._gl;ci.bindFramebuffer(ci.READ_FRAMEBUFFER,this.renderFrameBuffer),ci.bindFramebuffer(ci.DRAW_FRAMEBUFFER,this.frameBuffer),ci.clearBufferfv(ci.COLOR,0,[0,0,1,1]),ci.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,ci.COLOR_BUFFER_BIT,ci.LINEAR)}}copyToTexture(ci){const hi=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),hi.bindFramebuffer(hi.FRAMEBUFFER,this._frameBuffer),hi.bindTexture(hi.TEXTURE_2D,ci),hi.copyTexImage2D(hi.TEXTURE_2D,0,hi.RGBA,0,0,this.width,this.height,0)}use(){const ci=this._gl;this.antialias?ci.bindFramebuffer(ci.FRAMEBUFFER,this._renderFrameBuffer):ci.bindFramebuffer(ci.FRAMEBUFFER,this._frameBuffer),ci.viewport(0,0,this.width,this.height)}disable(){const ci=this._gl;ci.bindFramebuffer(ci.FRAMEBUFFER,null),ci.bindTexture(ci.TEXTURE_2D,null)}}const line_vertex=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,line_fragment=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function getGlTypeSizeBytes(fi,ci){switch(ci){case fi.INT:case fi.UNSIGNED_INT:case fi.FLOAT:return 4;case fi.SHORT:return 2;case fi.UNSIGNED_SHORT:return 2;case fi.BYTE:return 1;case fi.UNSIGNED_BYTE:return 1;default:return 1}}function isAttributeInSource(fi,ci){const hi=`(?<type>[a-z0-9]+)\\s+${ci};`,pi=new RegExp(hi,"g").exec(fi);return(pi==null?void 0:pi.length)>0}function getGLTypeFromSource(fi,ci,hi){var _i;const pi=`(?<type>[a-z0-9]+)\\s+${hi};`,mi=new RegExp(pi,"g").exec(ci);switch((_i=mi==null?void 0:mi.groups)===null||_i===void 0?void 0:_i.type){case"float":case"vec2":case"vec3":case"vec4":return fi.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return fi.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return fi.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return fi.BOOL;case"short":return fi.SHORT;case"ushort":return fi.UNSIGNED_SHORT;case"ubyte":return fi.UNSIGNED_BYTE;case"byte":return fi.BYTE;default:return fi.FLOAT}}function getAttributeComponentSize(fi,ci){switch(ci){case fi.LOW_FLOAT:case fi.HIGH_FLOAT:case fi.FLOAT:return 1;case fi.FLOAT_VEC2:return 2;case fi.FLOAT_VEC3:return 3;case fi.FLOAT_VEC4:return 4;case fi.BYTE:return 1;case fi.UNSIGNED_BYTE:return 1;case fi.UNSIGNED_SHORT:case fi.SHORT:return 1;default:return 1}}function getAttributePointerType(fi,ci){switch(ci){case fi.LOW_FLOAT:case fi.HIGH_FLOAT:case fi.FLOAT:case fi.FLOAT_VEC2:case fi.FLOAT_VEC3:case fi.FLOAT_VEC4:return fi.FLOAT;case fi.BYTE:return fi.BYTE;case fi.UNSIGNED_BYTE:return fi.UNSIGNED_BYTE;case fi.SHORT:return fi.SHORT;case fi.UNSIGNED_SHORT:return fi.UNSIGNED_SHORT;default:return fi.FLOAT}}function getMaxShaderComplexity(fi,ci){const hi=pi=>{const gi=`#version 300 es
    precision mediump float;
    out vec4 fragColor;
    void main() {
      float index = 1.01;
      %%complexity%%
    }`;let mi="";for(let xi=0;xi<pi;xi++)xi===0?mi+=`if (index <= ${xi}.5) {
`:mi+=`   else if (index <= ${xi}.5) {
`,mi+=`      fragColor = vec4(1.0);
`,mi+=`   }
`;return gi.replace("%%complexity%%",mi)};let _i=!1;do{const pi=hi(ci),gi=fi.createShader(fi.FRAGMENT_SHADER);fi.shaderSource(gi,pi),fi.compileShader(gi),_i=fi.getShaderParameter(gi,fi.COMPILE_STATUS),_i||(ci=ci/2|0)}while(!_i);return ci}class Shader{get compiled(){return this._compiled}constructor(ci){this._logger=Logger.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;const{gl:hi,vertexSource:_i,fragmentSource:pi,onPreLink:gi,onPostCompile:mi}=ci;this._gl=hi,this.vertexSource=_i,this.fragmentSource=pi,this._onPreLink=gi,this._onPostCompile=mi}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),Shader._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Shader._ACTIVE_SHADER_INSTANCE===this}compile(){const ci=this._gl,hi=this._compileShader(ci,this.vertexSource,ci.VERTEX_SHADER),_i=this._compileShader(ci,this.fragmentSource,ci.FRAGMENT_SHADER);this.program=this._createProgram(ci,hi,_i);const pi=this.getAttributes();for(const mi of pi)this.attributes[mi.name]=mi;const gi=this.getUniforms();for(const mi of gi)this.uniforms[mi.name]=mi;return this._compiled=!0,this._onPostCompile&&this._onPostCompile(this),this.program}getUniforms(){const ci=this._gl,hi=ci.getProgramParameter(this.program,ci.ACTIVE_UNIFORMS),_i=[];for(let pi=0;pi<hi;pi++){const gi=ci.getActiveUniform(this.program,pi),mi=ci.getUniformLocation(this.program,gi.name);_i.push({name:gi.name,glType:gi.type,location:mi})}return _i}getAttributes(){const ci=this._gl,hi=ci.getProgramParameter(this.program,ci.ACTIVE_ATTRIBUTES),_i=[];for(let pi=0;pi<hi;pi++){const gi=ci.getActiveAttrib(this.program,pi),mi=ci.getAttribLocation(this.program,gi.name);_i.push({name:gi.name,glType:getAttributePointerType(ci,gi.type),size:getAttributeComponentSize(ci,gi.type),location:mi,normalized:!1})}return _i}setTexture(ci,hi){const _i=this._gl;_i.activeTexture(_i.TEXTURE0+ci),_i.bindTexture(_i.TEXTURE_2D,hi)}setUniformInt(ci,hi){this.setUniform("uniform1i",ci,~~hi)}trySetUniformInt(ci,hi){return this.trySetUniform("uniform1i",ci,~~hi)}setUniformIntArray(ci,hi){this.setUniform("uniform1iv",ci,hi)}trySetUniformIntArray(ci,hi){return this.trySetUniform("uniform1iv",ci,hi)}setUniformBoolean(ci,hi){this.setUniform("uniform1i",ci,hi?1:0)}trySetUniformBoolean(ci,hi){return this.trySetUniform("uniform1i",ci,hi?1:0)}setUniformFloat(ci,hi){this.setUniform("uniform1f",ci,hi)}trySetUniformFloat(ci,hi){return this.trySetUniform("uniform1f",ci,hi)}setUniformFloatArray(ci,hi){this.setUniform("uniform1fv",ci,hi)}trySetUniformFloatArray(ci,hi){return this.trySetUniform("uniform1fv",ci,hi)}setUniformFloatVector(ci,hi){this.setUniform("uniform2f",ci,hi.x,hi.y)}trySetUniformFloatVector(ci,hi){return this.trySetUniform("uniform2f",ci,hi.x,hi.y)}setUniformFloatColor(ci,hi){this.setUniform("uniform4f",ci,hi.r/255,hi.g/255,hi.b/255,hi.a)}trySetUniformFloatColor(ci,hi){return this.trySetUniform("uniform4f",ci,hi.r/255,hi.g/255,hi.b/255,hi.a)}setUniformMatrix(ci,hi){this.setUniform("uniformMatrix4fv",ci,!1,hi.data)}setUniformAffineMatrix(ci,hi){this.setUniform("uniformMatrix4fv",ci,!1,[hi.data[0],hi.data[1],0,0,hi.data[2],hi.data[3],0,0,0,0,1,0,hi.data[4],hi.data[5],0,1])}trySetUniformMatrix(ci,hi){return this.trySetUniform("uniformMatrix4fv",ci,!1,hi.data)}setUniform(ci,hi,..._i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${ci}:${hi}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const gi=this._gl.getUniformLocation(this.program,hi);if(gi){const mi=[gi,..._i];this._gl[ci].apply(this._gl,mi)}else throw Error(`Uniform ${ci}:${hi} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(ci,hi,..._i){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${ci}:${hi}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const gi=this._gl.getUniformLocation(this.program,hi);if(gi){const mi=[gi,..._i];this._gl[ci].apply(this._gl,mi)}else return!1;return!0}_createProgram(ci,hi,_i){const pi=ci.createProgram();if(pi===null)throw Error("Could not create graphics shader program");if(ci.attachShader(pi,hi),ci.attachShader(pi,_i),this._onPreLink&&this._onPreLink(pi),ci.linkProgram(pi),!ci.getProgramParameter(pi,ci.LINK_STATUS))throw Error(`Could not link the program: [${ci.getProgramInfoLog(pi)}]`);return pi}_compileShader(ci,hi,_i){const pi=ci.VERTEX_SHADER===_i?"vertex":"fragment",gi=ci.createShader(_i);if(gi===null)throw Error(`Could not build shader: [${hi}]`);if(ci.shaderSource(gi,hi),ci.compileShader(gi),!ci.getShaderParameter(gi,ci.COMPILE_STATUS)){const xi=ci.getShaderInfoLog(gi);throw Error(`Could not compile ${pi} shader:

${xi}${this._processSourceForError(hi,xi)}`)}return gi}_processSourceForError(ci,hi){if(!ci)return hi;const _i=ci.split(`
`),pi=hi.search(/\d:\d/),gi=hi.indexOf(" ",pi),[mi,xi]=hi.slice(pi,gi).split(":").map(yi=>Number(yi));for(let yi=0;yi<_i.length;yi++)_i[yi]=`${yi+1}: ${_i[yi]}${xi===yi+1?" <----- ERROR!":""}`;return`

Source:
`+_i.join(`
`)}}Shader._ACTIVE_SHADER_INSTANCE=null;class VertexBuffer{constructor(ci){this.type="dynamic";const{gl:hi,size:_i,type:pi,data:gi}=ci;if(this._gl=hi,this.buffer=this._gl.createBuffer(),!gi&&!_i)throw Error("Must either provide data or a size to the VertexBuffer");gi?this.bufferData=gi:this.bufferData=new Float32Array(_i),this.type=pi??this.type,hi.bindBuffer(hi.ARRAY_BUFFER,this.buffer),hi.bufferData(hi.ARRAY_BUFFER,this.bufferData,this.type==="static"?hi.STATIC_DRAW:hi.DYNAMIC_DRAW)}bind(){const ci=this._gl;ci.bindBuffer(ci.ARRAY_BUFFER,this.buffer)}unbind(){const ci=this._gl;ci.bindBuffer(ci.ARRAY_BUFFER,null)}upload(ci){const hi=this._gl;hi.bindBuffer(hi.ARRAY_BUFFER,this.buffer),ci?hi.bufferSubData(hi.ARRAY_BUFFER,0,this.bufferData,0,ci):hi.bufferData(hi.ARRAY_BUFFER,this.bufferData,this.type==="static"?hi.STATIC_DRAW:hi.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class VertexLayout{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(ci){this._logger=Logger.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:hi,shader:_i,vertexBuffer:pi,attributes:gi,suppressWarnings:mi}=ci;this._gl=hi,this._vertexBuffer=pi,this._attributes=gi,this._shader=_i,this._suppressWarnings=mi,_i&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(ci){ci&&this._shader!==ci&&(this._shader=ci,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const ci=this._shader.attributes;for(const gi of this._attributes){const mi=ci[gi[0]];if(!mi){if(!isAttributeInSource(this._shader.vertexSource,gi[0]))throw Error(`The attribute named: ${gi[0]} size ${gi[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${gi[0]} size ${gi[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${gi[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${gi[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const xi=getGLTypeFromSource(this._gl,this._shader.vertexSource,gi[0]);this._layout.push({name:gi[0],glType:xi,size:gi[1],location:-1,normalized:!1})}if(mi){if(mi.size!==gi[1])throw Error(`VertexLayout size definition for attribute: [${gi[0]}, ${gi[1]}], doesn't match shader source size ${mi.size}:
 ${this._shader.vertexSource}`);this._layout.push(mi)}}let hi=0;for(const gi of this._layout){const mi=getGlTypeSizeBytes(this._gl,gi.glType);this._vertexTotalSizeBytes+=mi*gi.size,hi+=gi.size}this._vertexBuffer.bufferData.length%hi!==0&&this._logger.warn(`The vertex component size (${hi})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const _i=this._gl;this._vao=_i.createVertexArray(),_i.bindVertexArray(this._vao),this._vertexBuffer.bind();let pi=0;for(const gi of this._layout)gi.location!==-1&&(gi.glType===_i.INT?_i.vertexAttribIPointer(gi.location,gi.size,gi.glType,this.totalVertexSizeBytes,pi):_i.vertexAttribPointer(gi.location,gi.size,gi.glType,gi.normalized,this.totalVertexSizeBytes,pi),_i.enableVertexAttribArray(gi.location)),pi+=getGlTypeSizeBytes(_i,gi.glType)*gi.size;_i.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(ci=!1,hi){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const _i=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),ci&&this._vertexBuffer.upload(hi),_i.bindVertexArray(this._vao)}}class GraphicsDiagnostics{static clear(){GraphicsDiagnostics.DrawCallCount=0,GraphicsDiagnostics.DrawnImagesCount=0}}GraphicsDiagnostics.DrawCallCount=0;GraphicsDiagnostics.DrawnImagesCount=0;class LineRenderer{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0,this._startScratch=vec(0,0),this._endScratch=vec(0,0)}initialize(ci,hi){this._gl=ci,this._context=hi,this._shader=new Shader({gl:ci,vertexSource:line_vertex,fragmentSource:line_fragment}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new VertexBuffer({gl:ci,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(ci,hi,_i){this._isFull()&&this.flush(),this._lineCount++;const pi=this._context.getTransform(),gi=pi.multiply(ci,this._startScratch),mi=pi.multiply(hi,this._endScratch),xi=this._vertexBuffer.bufferData;xi[this._vertexIndex++]=gi.x,xi[this._vertexIndex++]=gi.y,xi[this._vertexIndex++]=_i.r/255,xi[this._vertexIndex++]=_i.g/255,xi[this._vertexIndex++]=_i.b/255,xi[this._vertexIndex++]=_i.a,xi[this._vertexIndex++]=mi.x,xi[this._vertexIndex++]=mi.y,xi[this._vertexIndex++]=_i.r/255,xi[this._vertexIndex++]=_i.g/255,xi[this._vertexIndex++]=_i.b/255,xi[this._vertexIndex++]=_i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const ci=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),ci.drawArrays(ci.LINES,0,this._lineCount*2),GraphicsDiagnostics.DrawnImagesCount+=this._lineCount,GraphicsDiagnostics.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const point_vertex=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,point_fragment=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class PointRenderer{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(ci,hi){this._gl=ci,this._context=hi,this._shader=new Shader({gl:ci,vertexSource:point_vertex,fragmentSource:point_fragment}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new VertexBuffer({gl:ci,size:7*this._maxPoints,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(ci,hi,_i){this._isFull()&&this.flush(),this._pointCount++;const pi=this._context.getTransform(),gi=this._context.opacity,mi=this._context.snapToPixel,xi=pi.multiply(ci);mi&&(xi.x=~~(xi.x+pixelSnapEpsilon),xi.y=~~(xi.y+pixelSnapEpsilon));const yi=this._buffer.bufferData;yi[this._vertexIndex++]=xi.x,yi[this._vertexIndex++]=xi.y,yi[this._vertexIndex++]=hi.r/255,yi[this._vertexIndex++]=hi.g/255,yi[this._vertexIndex++]=hi.b/255,yi[this._vertexIndex++]=hi.a*gi,yi[this._vertexIndex++]=_i*Math.max(pi.getScaleX(),pi.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const ci=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),ci.drawArrays(ci.POINTS,0,this._pointCount),GraphicsDiagnostics.DrawnImagesCount+=this._pointCount,GraphicsDiagnostics.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const screen_vertex=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,screen_fragment=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class ScreenPassPainter{constructor(ci){this._gl=ci,this._shader=new Shader({gl:ci,vertexSource:screen_vertex,fragmentSource:screen_fragment}),this._shader.compile(),this._buffer=new VertexBuffer({gl:ci,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(ci){const hi=this._gl,_i=ci.getShader();_i.use(),ci.getLayout().use(),hi.activeTexture(hi.TEXTURE0),_i.trySetUniformInt("u_image",0),ci.onDraw&&ci.onDraw(),hi.drawArrays(hi.TRIANGLES,0,6)}renderToScreen(){const ci=this._gl;this._shader.use(),this._layout.use(),ci.drawArrays(ci.TRIANGLES,0,6)}}class QuadIndexBuffer{constructor(ci,hi,_i){this._logger=Logger.getInstance(),this._gl=ci,this.buffer=ci.createBuffer(),ci.bindBuffer(ci.ELEMENT_ARRAY_BUFFER,this.buffer);const pi=hi*6;if(!_i)this.bufferData=new Uint32Array(pi);else{const xi=Math.floor(16383.5);this.bufferGlType=ci.UNSIGNED_SHORT,this.bufferData=new Uint16Array(pi),hi>xi&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${xi}) requested quads(${hi})`)}let gi=0;for(let mi=0;mi<pi;mi+=6)this.bufferData[mi+0]=gi+0,this.bufferData[mi+1]=gi+1,this.bufferData[mi+2]=gi+2,this.bufferData[mi+3]=gi+2,this.bufferData[mi+4]=gi+1,this.bufferData[mi+5]=gi+3,gi+=4;ci.bufferData(ci.ELEMENT_ARRAY_BUFFER,this.bufferData,ci.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const ci=this._gl;ci.bindBuffer(ci.ELEMENT_ARRAY_BUFFER,this.buffer),ci.bufferData(ci.ELEMENT_ARRAY_BUFFER,this.bufferData,ci.STATIC_DRAW)}bind(){const ci=this._gl;ci.bindBuffer(ci.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const image_renderer_frag=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
in vec2 v_res;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
  \r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
  \r
  return pixel/texture_size;\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
  \r
  vec4 color=vec4(1.,0,0,1.);\r
  \r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
  \r
  color.rgb=color.rgb*v_opacity;\r
  color.a=color.a*v_opacity;\r
  fragColor=color*v_tint;\r
}`,image_renderer_vert=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity\r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture res\r
in vec2 a_res;\r
out vec2 v_res;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  // Set the vertex position using the ortho transform matrix\r
  gl_Position=u_matrix*vec4(a_position,0.,1.);\r
  \r
  // Pass through the Opacity to the fragment shader\r
  v_opacity=a_opacity;\r
  // Pass through the UV coord to the fragment shader\r
  v_texcoord=a_texcoord;\r
\r
  v_res = a_res;\r
\r
  // Pass through the texture number to the fragment shader\r
  v_textureIndex=a_textureIndex;\r
  // Pass through the tint\r
  v_tint=a_tint;\r
}`;class ImageRenderer{constructor(ci){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this._defaultTint=Color.White,this.pixelArtSampler=ci.pixelArtSampler,this.uvPadding=ci.uvPadding}initialize(ci,hi){this._gl=ci,this._context=hi;const _i=ci.getParameter(ci.MAX_TEXTURE_IMAGE_UNITS),pi=getMaxShaderComplexity(ci,_i);this._maxTextures=Math.min(_i,pi);const gi=this._transformFragmentSource(image_renderer_frag,this._maxTextures);this._shader=new Shader({gl:ci,fragmentSource:gi,vertexSource:image_renderer_vert}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",hi.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((mi,xi)=>xi)),this._buffer=new VertexBuffer({gl:ci,size:12*4*this._maxImages,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new QuadIndexBuffer(ci,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(ci,hi){let _i=ci.replace("%%count%%",hi.toString()),pi="";for(let gi=0;gi<hi;gi++)gi===0?pi+=`if (v_textureIndex <= ${gi}.5) {
`:pi+=`   else if (v_textureIndex <= ${gi}.5) {
`,pi+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,pi+=`      color = texture(u_textures[${gi}], uv);
`,pi+=`   }
`;return _i=_i.replace("%%texture_picker%%",pi),_i}_addImageAsTexture(ci){if(this._images.has(ci))return;const hi=ci.getAttribute(ImageSourceAttributeConstants.Filtering),_i=hi?parseImageFiltering(hi):void 0,pi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingX)),gi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingY)),mi=ci.getAttribute("forceUpload")==="true",xi=this._context.textureLoader.load(ci,{filtering:_i,wrapping:{x:pi,y:gi}},mi);ci.removeAttribute("forceUpload"),this._textures.indexOf(xi)===-1&&(this._textures.push(xi),this._textureToIndex.set(xi,this._textureIndex++),this._images.add(ci))}_bindTextures(ci){for(let hi=0;hi<this._maxTextures;hi++)ci.activeTexture(ci.TEXTURE0+hi),ci.bindTexture(ci.TEXTURE_2D,this._textures[hi]||this._textures[0])}_getTextureIdForImage(ci){var hi;if(ci){const _i=this._context.textureLoader.get(ci);return(hi=this._textureToIndex.get(_i))!==null&&hi!==void 0?hi:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(ci){let hi=this._imageToWidth.get(ci);return hi===void 0&&(hi=ci.width,this._imageToWidth.set(ci,hi)),hi}_getImageHeight(ci){let hi=this._imageToHeight.get(ci);return hi===void 0&&(hi=ci.height,this._imageToHeight.set(ci,hi)),hi}draw(ci,hi,_i,pi,gi,mi,xi,yi,Ci){var Ei,Ai,ki,Pi;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(ci);const Ii=this._getImageWidth(ci),Di=this._getImageHeight(ci);let Fi=Ii||pi||0,Li=Di||gi||0;this._view[0]=0,this._view[1]=0,this._view[2]=(Ei=pi??Ii)!==null&&Ei!==void 0?Ei:0,this._view[3]=(Ai=gi??Di)!==null&&Ai!==void 0?Ai:0,this._dest[0]=hi??1,this._dest[1]=_i??1,mi!==void 0&&xi!==void 0&&yi!==void 0&&Ci!==void 0&&(this._view[0]=hi??1,this._view[1]=_i??1,this._view[2]=(ki=pi??Ii)!==null&&ki!==void 0?ki:0,this._view[3]=(Pi=gi??Di)!==null&&Pi!==void 0?Pi:0,this._dest[0]=mi,this._dest[1]=xi,Fi=yi,Li=Ci),hi=this._view[0],_i=this._view[1];const Bi=this._view[2],Ri=this._view[3],$i=this._context.getTransform(),Ni=this._context.opacity,ji=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+Fi,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+Li,this._quad[6]=this._dest[0]+Fi,this._quad[7]=this._dest[1]+Li,$i.multiplyQuadInPlace(this._quad),ji&&(this._quad[0]=~~(this._quad[0]+sign(this._quad[0])*pixelSnapEpsilon),this._quad[1]=~~(this._quad[1]+sign(this._quad[1])*pixelSnapEpsilon),this._quad[2]=~~(this._quad[2]+sign(this._quad[2])*pixelSnapEpsilon),this._quad[3]=~~(this._quad[3]+sign(this._quad[3])*pixelSnapEpsilon),this._quad[4]=~~(this._quad[4]+sign(this._quad[4])*pixelSnapEpsilon),this._quad[5]=~~(this._quad[5]+sign(this._quad[5])*pixelSnapEpsilon),this._quad[6]=~~(this._quad[6]+sign(this._quad[6])*pixelSnapEpsilon),this._quad[7]=~~(this._quad[7]+sign(this._quad[7])*pixelSnapEpsilon));const Ui=this._context.tint||this._defaultTint,qi=this._getTextureIdForImage(ci),Ji=Ii||Fi,rs=Di||Li,ss=(hi+this.uvPadding)/Ji,zi=(_i+this.uvPadding)/rs,Gi=(hi+Bi-this.uvPadding)/Ji,Vi=(_i+Ri-this.uvPadding)/rs,Qi=Ii,is=Di,Zi=this._layout.vertexBuffer.bufferData;Zi[this._vertexIndex++]=this._quad[0],Zi[this._vertexIndex++]=this._quad[1],Zi[this._vertexIndex++]=Ni,Zi[this._vertexIndex++]=Qi,Zi[this._vertexIndex++]=is,Zi[this._vertexIndex++]=ss,Zi[this._vertexIndex++]=zi,Zi[this._vertexIndex++]=qi,Zi[this._vertexIndex++]=Ui.r/255,Zi[this._vertexIndex++]=Ui.g/255,Zi[this._vertexIndex++]=Ui.b/255,Zi[this._vertexIndex++]=Ui.a,Zi[this._vertexIndex++]=this._quad[4],Zi[this._vertexIndex++]=this._quad[5],Zi[this._vertexIndex++]=Ni,Zi[this._vertexIndex++]=Qi,Zi[this._vertexIndex++]=is,Zi[this._vertexIndex++]=ss,Zi[this._vertexIndex++]=Vi,Zi[this._vertexIndex++]=qi,Zi[this._vertexIndex++]=Ui.r/255,Zi[this._vertexIndex++]=Ui.g/255,Zi[this._vertexIndex++]=Ui.b/255,Zi[this._vertexIndex++]=Ui.a,Zi[this._vertexIndex++]=this._quad[2],Zi[this._vertexIndex++]=this._quad[3],Zi[this._vertexIndex++]=Ni,Zi[this._vertexIndex++]=Qi,Zi[this._vertexIndex++]=is,Zi[this._vertexIndex++]=Gi,Zi[this._vertexIndex++]=zi,Zi[this._vertexIndex++]=qi,Zi[this._vertexIndex++]=Ui.r/255,Zi[this._vertexIndex++]=Ui.g/255,Zi[this._vertexIndex++]=Ui.b/255,Zi[this._vertexIndex++]=Ui.a,Zi[this._vertexIndex++]=this._quad[6],Zi[this._vertexIndex++]=this._quad[7],Zi[this._vertexIndex++]=Ni,Zi[this._vertexIndex++]=Qi,Zi[this._vertexIndex++]=is,Zi[this._vertexIndex++]=Gi,Zi[this._vertexIndex++]=Vi,Zi[this._vertexIndex++]=qi,Zi[this._vertexIndex++]=Ui.r/255,Zi[this._vertexIndex++]=Ui.g/255,Zi[this._vertexIndex++]=Ui.b/255,Zi[this._vertexIndex++]=Ui.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const ci=this._gl;this._shader.use(),this._layout.use(!0,4*12*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(ci),this._quads.bind(),ci.drawElements(ci.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),GraphicsDiagnostics.DrawnImagesCount+=this._imageCount,GraphicsDiagnostics.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const rectangle_renderer_frag=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,rectangle_renderer_vert=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class RectangleRenderer{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0,this._transparent=Color.Transparent,this._scratch1=vec(0,0),this._scratch2=vec(0,0),this._scratch3=vec(0,0),this._scratch4=vec(0,0)}initialize(ci,hi){this._gl=ci,this._context=hi,this._shader=new Shader({gl:ci,fragmentSource:rectangle_renderer_frag,vertexSource:rectangle_renderer_vert}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",hi.ortho),this._buffer=new VertexBuffer({gl:ci,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new QuadIndexBuffer(ci,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...ci){ci[0]instanceof Vector&&ci[1]instanceof Vector?this.drawLine.apply(this,ci):this.drawRectangle.apply(this,ci)}drawLine(ci,hi,_i,pi=1){this._isFull()&&this.flush(),this._rectangleCount++;const gi=this._context.getTransform(),mi=this._context.opacity,xi=this._context.snapToPixel,yi=hi.sub(ci),Ci=yi.magnitude,Ei=yi.normalize().perpendicular(),Ai=pi/2,ki=gi.multiply(Ei.scale(Ai,this._scratch1).add(ci,this._scratch1),this._scratch1),Pi=gi.multiply(Ei.scale(-Ai,this._scratch2).add(ci,this._scratch2),this._scratch2),Ii=gi.multiply(Ei.scale(Ai,this._scratch3).add(hi,this._scratch3),this._scratch3),Di=gi.multiply(Ei.scale(-Ai,this._scratch4).add(hi,this._scratch4),this._scratch4);xi&&(ki.x=~~(ki.x+pixelSnapEpsilon),ki.y=~~(ki.y+pixelSnapEpsilon),Ii.x=~~(Ii.x+pixelSnapEpsilon),Ii.y=~~(Ii.y+pixelSnapEpsilon),Pi.x=~~(Pi.x+pixelSnapEpsilon),Pi.y=~~(Pi.y+pixelSnapEpsilon),Di.x=~~(Di.x+pixelSnapEpsilon),Di.y=~~(Di.y+pixelSnapEpsilon));const Fi=0,Li=0,Bi=1,Ri=1,$i=this._transparent,Ni=0,ji=1,Ui=this._layout.vertexBuffer.bufferData;Ui[this._vertexIndex++]=ki.x,Ui[this._vertexIndex++]=ki.y,Ui[this._vertexIndex++]=Fi,Ui[this._vertexIndex++]=Li,Ui[this._vertexIndex++]=Ci,Ui[this._vertexIndex++]=pi,Ui[this._vertexIndex++]=mi,Ui[this._vertexIndex++]=_i.r/255,Ui[this._vertexIndex++]=_i.g/255,Ui[this._vertexIndex++]=_i.b/255,Ui[this._vertexIndex++]=_i.a,Ui[this._vertexIndex++]=$i.r/255,Ui[this._vertexIndex++]=$i.g/255,Ui[this._vertexIndex++]=$i.b/255,Ui[this._vertexIndex++]=$i.a,Ui[this._vertexIndex++]=Ni/ji,Ui[this._vertexIndex++]=Pi.x,Ui[this._vertexIndex++]=Pi.y,Ui[this._vertexIndex++]=Fi,Ui[this._vertexIndex++]=Ri,Ui[this._vertexIndex++]=Ci,Ui[this._vertexIndex++]=pi,Ui[this._vertexIndex++]=mi,Ui[this._vertexIndex++]=_i.r/255,Ui[this._vertexIndex++]=_i.g/255,Ui[this._vertexIndex++]=_i.b/255,Ui[this._vertexIndex++]=_i.a,Ui[this._vertexIndex++]=$i.r/255,Ui[this._vertexIndex++]=$i.g/255,Ui[this._vertexIndex++]=$i.b/255,Ui[this._vertexIndex++]=$i.a,Ui[this._vertexIndex++]=Ni/ji,Ui[this._vertexIndex++]=Ii.x,Ui[this._vertexIndex++]=Ii.y,Ui[this._vertexIndex++]=Bi,Ui[this._vertexIndex++]=Li,Ui[this._vertexIndex++]=Ci,Ui[this._vertexIndex++]=pi,Ui[this._vertexIndex++]=mi,Ui[this._vertexIndex++]=_i.r/255,Ui[this._vertexIndex++]=_i.g/255,Ui[this._vertexIndex++]=_i.b/255,Ui[this._vertexIndex++]=_i.a,Ui[this._vertexIndex++]=$i.r/255,Ui[this._vertexIndex++]=$i.g/255,Ui[this._vertexIndex++]=$i.b/255,Ui[this._vertexIndex++]=$i.a,Ui[this._vertexIndex++]=Ni/ji,Ui[this._vertexIndex++]=Di.x,Ui[this._vertexIndex++]=Di.y,Ui[this._vertexIndex++]=Bi,Ui[this._vertexIndex++]=Ri,Ui[this._vertexIndex++]=Ci,Ui[this._vertexIndex++]=pi,Ui[this._vertexIndex++]=mi,Ui[this._vertexIndex++]=_i.r/255,Ui[this._vertexIndex++]=_i.g/255,Ui[this._vertexIndex++]=_i.b/255,Ui[this._vertexIndex++]=_i.a,Ui[this._vertexIndex++]=$i.r/255,Ui[this._vertexIndex++]=$i.g/255,Ui[this._vertexIndex++]=$i.b/255,Ui[this._vertexIndex++]=$i.a,Ui[this._vertexIndex++]=Ni/ji}drawRectangle(ci,hi,_i,pi,gi=Color.Transparent,mi=0){this._isFull()&&this.flush(),this._rectangleCount++;const xi=this._context.getTransform(),yi=this._context.opacity,Ci=this._context.snapToPixel,Ei=xi.multiply(ci.add(vec(0,0))),Ai=xi.multiply(ci.add(vec(hi,0))),ki=xi.multiply(ci.add(vec(hi,_i))),Pi=xi.multiply(ci.add(vec(0,_i)));Ci&&(Ei.x=~~(Ei.x+pixelSnapEpsilon),Ei.y=~~(Ei.y+pixelSnapEpsilon),Ai.x=~~(Ai.x+pixelSnapEpsilon),Ai.y=~~(Ai.y+pixelSnapEpsilon),Pi.x=~~(Pi.x+pixelSnapEpsilon),Pi.y=~~(Pi.y+pixelSnapEpsilon),ki.x=~~(ki.x+pixelSnapEpsilon),ki.y=~~(ki.y+pixelSnapEpsilon));const Ii=0,Di=0,Fi=1,Li=1,Bi=this._layout.vertexBuffer.bufferData;Bi[this._vertexIndex++]=Ei.x,Bi[this._vertexIndex++]=Ei.y,Bi[this._vertexIndex++]=Ii,Bi[this._vertexIndex++]=Di,Bi[this._vertexIndex++]=hi,Bi[this._vertexIndex++]=_i,Bi[this._vertexIndex++]=yi,Bi[this._vertexIndex++]=pi.r/255,Bi[this._vertexIndex++]=pi.g/255,Bi[this._vertexIndex++]=pi.b/255,Bi[this._vertexIndex++]=pi.a,Bi[this._vertexIndex++]=gi.r/255,Bi[this._vertexIndex++]=gi.g/255,Bi[this._vertexIndex++]=gi.b/255,Bi[this._vertexIndex++]=gi.a,Bi[this._vertexIndex++]=mi,Bi[this._vertexIndex++]=Pi.x,Bi[this._vertexIndex++]=Pi.y,Bi[this._vertexIndex++]=Ii,Bi[this._vertexIndex++]=Li,Bi[this._vertexIndex++]=hi,Bi[this._vertexIndex++]=_i,Bi[this._vertexIndex++]=yi,Bi[this._vertexIndex++]=pi.r/255,Bi[this._vertexIndex++]=pi.g/255,Bi[this._vertexIndex++]=pi.b/255,Bi[this._vertexIndex++]=pi.a,Bi[this._vertexIndex++]=gi.r/255,Bi[this._vertexIndex++]=gi.g/255,Bi[this._vertexIndex++]=gi.b/255,Bi[this._vertexIndex++]=gi.a,Bi[this._vertexIndex++]=mi,Bi[this._vertexIndex++]=Ai.x,Bi[this._vertexIndex++]=Ai.y,Bi[this._vertexIndex++]=Fi,Bi[this._vertexIndex++]=Di,Bi[this._vertexIndex++]=hi,Bi[this._vertexIndex++]=_i,Bi[this._vertexIndex++]=yi,Bi[this._vertexIndex++]=pi.r/255,Bi[this._vertexIndex++]=pi.g/255,Bi[this._vertexIndex++]=pi.b/255,Bi[this._vertexIndex++]=pi.a,Bi[this._vertexIndex++]=gi.r/255,Bi[this._vertexIndex++]=gi.g/255,Bi[this._vertexIndex++]=gi.b/255,Bi[this._vertexIndex++]=gi.a,Bi[this._vertexIndex++]=mi,Bi[this._vertexIndex++]=ki.x,Bi[this._vertexIndex++]=ki.y,Bi[this._vertexIndex++]=Fi,Bi[this._vertexIndex++]=Li,Bi[this._vertexIndex++]=hi,Bi[this._vertexIndex++]=_i,Bi[this._vertexIndex++]=yi,Bi[this._vertexIndex++]=pi.r/255,Bi[this._vertexIndex++]=pi.g/255,Bi[this._vertexIndex++]=pi.b/255,Bi[this._vertexIndex++]=pi.a,Bi[this._vertexIndex++]=gi.r/255,Bi[this._vertexIndex++]=gi.g/255,Bi[this._vertexIndex++]=gi.b/255,Bi[this._vertexIndex++]=gi.a,Bi[this._vertexIndex++]=mi}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const ci=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),ci.drawElements(ci.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),GraphicsDiagnostics.DrawnImagesCount+=this._rectangleCount,GraphicsDiagnostics.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const circle_renderer_frag=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,circle_renderer_vert=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class CircleRenderer{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(ci,hi){this._gl=ci,this._context=hi,this._shader=new Shader({gl:ci,fragmentSource:circle_renderer_frag,vertexSource:circle_renderer_vert}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",hi.ortho),this._buffer=new VertexBuffer({gl:ci,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new QuadIndexBuffer(ci,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(ci,hi,_i,pi=Color.Transparent,gi=0){this._isFull()&&this.flush(),this._circleCount++;const mi=this._context.getTransform(),xi=this._context.opacity,yi=this._context.snapToPixel,Ci=mi.multiply(ci.add(vec(-hi,-hi))),Ei=mi.multiply(ci.add(vec(hi,-hi))),Ai=mi.multiply(ci.add(vec(hi,hi))),ki=mi.multiply(ci.add(vec(-hi,hi)));yi&&(Ci.x=~~(Ci.x+pixelSnapEpsilon),Ci.y=~~(Ci.y+pixelSnapEpsilon),Ei.x=~~(Ei.x+pixelSnapEpsilon),Ei.y=~~(Ei.y+pixelSnapEpsilon),ki.x=~~(ki.x+pixelSnapEpsilon),ki.y=~~(ki.y+pixelSnapEpsilon),Ai.x=~~(Ai.x+pixelSnapEpsilon),Ai.y=~~(Ai.y+pixelSnapEpsilon));const Pi=0,Ii=0,Di=1,Fi=1,Li=this._layout.vertexBuffer.bufferData;Li[this._vertexIndex++]=Ci.x,Li[this._vertexIndex++]=Ci.y,Li[this._vertexIndex++]=Pi,Li[this._vertexIndex++]=Ii,Li[this._vertexIndex++]=xi,Li[this._vertexIndex++]=_i.r/255,Li[this._vertexIndex++]=_i.g/255,Li[this._vertexIndex++]=_i.b/255,Li[this._vertexIndex++]=_i.a,Li[this._vertexIndex++]=pi.r/255,Li[this._vertexIndex++]=pi.g/255,Li[this._vertexIndex++]=pi.b/255,Li[this._vertexIndex++]=pi.a,Li[this._vertexIndex++]=gi/hi,Li[this._vertexIndex++]=ki.x,Li[this._vertexIndex++]=ki.y,Li[this._vertexIndex++]=Pi,Li[this._vertexIndex++]=Fi,Li[this._vertexIndex++]=xi,Li[this._vertexIndex++]=_i.r/255,Li[this._vertexIndex++]=_i.g/255,Li[this._vertexIndex++]=_i.b/255,Li[this._vertexIndex++]=_i.a,Li[this._vertexIndex++]=pi.r/255,Li[this._vertexIndex++]=pi.g/255,Li[this._vertexIndex++]=pi.b/255,Li[this._vertexIndex++]=pi.a,Li[this._vertexIndex++]=gi/hi,Li[this._vertexIndex++]=Ei.x,Li[this._vertexIndex++]=Ei.y,Li[this._vertexIndex++]=Di,Li[this._vertexIndex++]=Ii,Li[this._vertexIndex++]=xi,Li[this._vertexIndex++]=_i.r/255,Li[this._vertexIndex++]=_i.g/255,Li[this._vertexIndex++]=_i.b/255,Li[this._vertexIndex++]=_i.a,Li[this._vertexIndex++]=pi.r/255,Li[this._vertexIndex++]=pi.g/255,Li[this._vertexIndex++]=pi.b/255,Li[this._vertexIndex++]=pi.a,Li[this._vertexIndex++]=gi/hi,Li[this._vertexIndex++]=Ai.x,Li[this._vertexIndex++]=Ai.y,Li[this._vertexIndex++]=Di,Li[this._vertexIndex++]=Fi,Li[this._vertexIndex++]=xi,Li[this._vertexIndex++]=_i.r/255,Li[this._vertexIndex++]=_i.g/255,Li[this._vertexIndex++]=_i.b/255,Li[this._vertexIndex++]=_i.a,Li[this._vertexIndex++]=pi.r/255,Li[this._vertexIndex++]=pi.g/255,Li[this._vertexIndex++]=pi.b/255,Li[this._vertexIndex++]=pi.a,Li[this._vertexIndex++]=gi/hi}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const ci=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),ci.drawElements(ci.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),GraphicsDiagnostics.DrawnImagesCount+=this._circleCount,GraphicsDiagnostics.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class Pool{constructor(ci,hi,_i=100){this.builder=ci,this.recycler=hi,this.maxObjects=_i,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=Logger.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let ci=0;ci<this.maxObjects;ci++)this.objects[ci]=this.builder()}using(ci){const hi=ci(this);return hi?this.done(...hi):this.done()}borrow(ci){const hi=this.get();ci(hi),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler?this.recycler(this.objects[this.index++]):this.objects[this.index++]:(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...ci){this.index=0;for(const hi of ci){const _i=this.objects.indexOf(hi);this.objects[_i]=this.builder(),this.totalAllocations++}return ci}}class DrawCall{constructor(){this.z=0,this.priority=0,this.renderer="",this.transform=AffineMatrix.identity(),this.state={z:0,opacity:1,tint:Color.White,material:null},this.args=new Array(10)}}const defaultVertexSource=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Material{constructor(ci){this._logger=Logger.getInstance(),this._color=Color.Transparent,this._initialized=!1,this._images=new Map,this._textures=new Map;const{color:hi,name:_i,vertexSource:pi,fragmentSource:gi,graphicsContext:mi,images:xi}=ci;if(this._name=_i??"anonymous material",this._vertexSource=pi??defaultVertexSource,this._fragmentSource=gi,this._color=hi??this._color,!mi)throw Error(`Material ${_i} must be provided an excalibur webgl graphics context`);if(mi instanceof ExcaliburGraphicsContextWebGL?(this._graphicsContext=mi,this._initialize(mi)):this._logger.warn(`Material ${_i} was created in 2D Canvas mode, currently only WebGL is supported`),xi)for(const yi in xi)this.addImageSource(yi,xi[yi])}_initialize(ci){if(this._initialized)return;const hi=ci.__gl;this._maxTextureSlots=hi.getParameter(hi.MAX_TEXTURE_IMAGE_UNITS)-2,this._shader=ci.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0}get color(){return this._color}set color(ci){this._color=ci}get name(){var ci;return(ci=this._name)!==null&&ci!==void 0?ci:"anonymous material"}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(ci){this._shader&&(this._shader.use(),ci(this._shader))}getShader(){return this._shader}addImageSource(ci,hi){this._images.size<this._maxTextureSlots?this._images.set(ci,hi):this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(ci){const hi=this._images.get(ci);this._graphicsContext.textureLoader.delete(hi.image),this._images.delete(ci)}_loadImageSource(ci){const hi=ci.image,_i=hi.getAttribute(ImageSourceAttributeConstants.Filtering),pi=_i?parseImageFiltering(_i):void 0,gi=parseImageWrapping(hi.getAttribute(ImageSourceAttributeConstants.WrappingX)),mi=parseImageWrapping(hi.getAttribute(ImageSourceAttributeConstants.WrappingY)),xi=hi.getAttribute("forceUpload")==="true",yi=this._graphicsContext.textureLoader.load(hi,{filtering:pi,wrapping:{x:gi,y:mi}},xi);return hi.removeAttribute("forceUpload"),this._textures.has(ci)||this._textures.set(ci,yi),yi}uploadAndBind(ci,hi=2){let _i=hi;for(const[pi,gi]of this._images.entries()){if(!gi.isLoaded()){this._logger.warnOnce(`Image named ${pi} in material ${this.name} not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const mi=this._loadImageSource(gi);ci.activeTexture(ci.TEXTURE0+_i),ci.bindTexture(ci.TEXTURE_2D,mi),this._shader.trySetUniformInt(pi,_i),_i++}}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class MaterialRenderer{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(ci,hi){this._gl=ci,this._context=hi,this._buffer=new VertexBuffer({gl:ci,size:6*4,type:"dynamic"}),this._layout=new VertexLayout({gl:ci,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new QuadIndexBuffer(ci,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(ci,hi,_i,pi,gi,mi,xi,yi,Ci){var Ei,Ai,ki,Pi;const Ii=this._gl,Di=this._context.material;if(!Di)return;const Fi=this._context.getTransform(),Li=this._context.opacity,Bi=Di.getShader(),Ri=this._layout.vertexBuffer.bufferData;let $i=0,Ni=(ci==null?void 0:ci.width)||pi||0,ji=(ci==null?void 0:ci.height)||gi||0,Ui=[0,0,(Ei=pi??(ci==null?void 0:ci.width))!==null&&Ei!==void 0?Ei:0,(Ai=gi??(ci==null?void 0:ci.height))!==null&&Ai!==void 0?Ai:0],qi=[hi??1,_i??1];mi!==void 0&&xi!==void 0&&yi!==void 0&&Ci!==void 0&&(Ui=[hi??1,_i??1,(ki=pi??(ci==null?void 0:ci.width))!==null&&ki!==void 0?ki:0,(Pi=gi??(ci==null?void 0:ci.height))!==null&&Pi!==void 0?Pi:0],qi=[mi,xi],Ni=yi,ji=Ci),hi=Ui[0],_i=Ui[1];const Ji=Ui[2],rs=Ui[3],ss=vec(qi[0],qi[1]),zi=vec(qi[0]+Ni,qi[1]),Gi=vec(qi[0],qi[1]+ji),Vi=vec(qi[0]+Ni,qi[1]+ji),Qi=ci.width||Ni,is=ci.height||ji,Zi=hi/Qi,ts=_i/is,cs=(hi+Ji-.01)/Qi,ls=(_i+rs-.01)/is,us=Fi.getPosition(),fs=us.add(Vi),xs=us.x/this._context.width,bs=us.y/this._context.height,Cs=fs.x/this._context.width,Ds=fs.y/this._context.height;Ri[$i++]=ss.x,Ri[$i++]=ss.y,Ri[$i++]=Zi,Ri[$i++]=ts,Ri[$i++]=xs,Ri[$i++]=bs,Ri[$i++]=Gi.x,Ri[$i++]=Gi.y,Ri[$i++]=Zi,Ri[$i++]=ls,Ri[$i++]=xs,Ri[$i++]=Ds,Ri[$i++]=zi.x,Ri[$i++]=zi.y,Ri[$i++]=cs,Ri[$i++]=ts,Ri[$i++]=Cs,Ri[$i++]=bs,Ri[$i++]=Vi.x,Ri[$i++]=Vi.y,Ri[$i++]=cs,Ri[$i++]=ls,Ri[$i++]=Cs,Ri[$i++]=Ds;const Hs=this._addImageAsTexture(ci);Di.use(),this._layout.shader=Bi,this._layout.use(!0),Bi.trySetUniformFloat("u_time_ms",performance.now()),Bi.trySetUniformFloat("u_opacity",Li),Bi.trySetUniformFloatVector("u_resolution",vec(this._context.width,this._context.height)),Bi.trySetUniformFloatVector("u_graphic_resolution",vec(Qi,is)),Bi.trySetUniformFloatVector("u_size",vec(Ji,rs)),Bi.trySetUniformMatrix("u_matrix",this._context.ortho),Bi.trySetUniformMatrix("u_transform",Fi.to4x4()),Ii.activeTexture(Ii.TEXTURE0+0),Ii.bindTexture(Ii.TEXTURE_2D,Hs),Bi.trySetUniformInt("u_graphic",0),Ii.activeTexture(Ii.TEXTURE0+1),Ii.bindTexture(Ii.TEXTURE_2D,this._context.materialScreenTexture),Bi.trySetUniformInt("u_screen_texture",1),Di.uploadAndBind(Ii),this._quads.bind(),Ii.drawElements(Ii.TRIANGLES,6,this._quads.bufferGlType,0),GraphicsDiagnostics.DrawnImagesCount++,GraphicsDiagnostics.DrawCallCount++}_addImageAsTexture(ci){const hi=ci.getAttribute(ImageSourceAttributeConstants.Filtering),_i=hi?parseImageFiltering(hi):void 0,pi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingX)),gi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingY)),mi=ci.getAttribute("forceUpload")==="true",xi=this._context.textureLoader.load(ci,{filtering:_i,wrapping:{x:pi,y:gi}},mi);return ci.removeAttribute("forceUpload"),this._textures.indexOf(xi)===-1&&this._textures.push(xi),xi}hasPendingDraws(){return!1}flush(){}}const particle_vertex=`#version 300 es\r
precision mediump float;\r
\r
uniform float deltaMs;\r
uniform float maxLifeMs;\r
uniform vec2 gravity;\r
uniform vec2 focus;\r
uniform float focusAccel;\r
uniform mat4 u_matrix;\r
uniform mat4 u_transform;\r
uniform float startSize;\r
uniform float endSize;\r
// uniform sampler2D obstacle;\r
\r
layout(location=0)in vec2 position;\r
layout(location=1)in vec2 velocity;\r
layout(location=2)in float rotation;\r
layout(location=3)in float angularVelocity;\r
layout(location=4)in float lifeMs;\r
\r
// TODO z index to handle buffer wrapping?\r
\r
// DO NOT RE-ORDER\r
out vec2 finalPosition;\r
out vec2 finalVelocity;\r
out float finalRotation;\r
out float finalAngularVelocity;\r
out float finalLifeMs;\r
void main(){\r
  // Evolve particle\r
  float seconds = deltaMs / 1000.;\r
  // euler integration\r
  // Weird artifact of re-using the same buffer layout for update/draw\r
  // we need differently named variables\r
  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\r
  finalVelocity = velocity + finalGravity * seconds;\r
  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\r
  finalRotation = rotation + angularVelocity * seconds;\r
  finalAngularVelocity = angularVelocity;\r
  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\r
\r
  // Collision mask sampling\r
  // vec2 samplePoint = finalPosition / vec2(width, height);\r
  // vec4 collides = texture(obstacle, samplePoint);\r
  // if (distance(collides,vec4(0.)) > .01) {\r
  //   // non opaque means we collide! recalc final pos/vel\r
  //   vec2 newVelocity = velocity * -.1;// lose energy\r
  //   finalVelocity = newVelocity + gravity * seconds;\r
  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\r
  // }\r
\r
  float lifePercent = finalLifeMs / maxLifeMs;\r
  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\r
  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);\r
  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\r
  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;\r
}`,particle_fragment=`#version 300 es\r
precision mediump float;\r
\r
uniform sampler2D graphic;\r
uniform bool useTexture;\r
uniform float maxLifeMs;\r
\r
uniform vec4 beginColor;\r
uniform vec4 endColor;\r
uniform bool fade;\r
uniform float startOpacity;\r
\r
in float finalRotation;\r
in float finalLifeMs;\r
out vec4 fragColor;\r
\r
void main(){\r
\r
  float lifePct = finalLifeMs / maxLifeMs;\r
\r
  if (useTexture) {\r
    /** Draw texture */\r
    if (lifePct <= 0.) discard;\r
    float mid = .5;\r
    float cosine = cos(finalRotation);\r
    float sine = sin(finalRotation);\r
    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\r
                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\r
    vec4 color = texture(graphic, rotated);\r
    fragColor = color * (fade ? lifePct : 1.0);\r
  } else {\r
    /** Draw circle */\r
    if (lifePct <= 0.) discard;\r
    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\r
    float dist = 1.0 - length(uv);\r
    float edge = fwidth(dot(uv, uv));\r
    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\r
    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);\r
    fragColor.rgb = color;\r
    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);\r
    fragColor.rgb *= fragColor.a;\r
  }\r
}`;var CoordPlane;(function(fi){fi.World="world",fi.Screen="screen"})(CoordPlane||(CoordPlane={}));class VectorView extends Vector{constructor(ci){super(0,0),this._getX=ci.getX,this._getY=ci.getY,this._setX=ci.setX,this._setY=ci.setY}get x(){return this._x=this._getX()}set x(ci){this._setX(ci),this._x=ci}get y(){return this._y=this._getY()}set y(ci){this._setY(ci),this._y=ci}}class WatchVector extends Vector{constructor(ci,hi){super(ci.x,ci.y),this.original=ci,this.change=hi}get x(){return this._x=this.original.x}set x(ci){ci!==this._x&&(this.change(ci,this._y),this._x=this.original.x=ci)}get y(){return this._y=this.original.y}set y(ci){ci!==this._y&&(this.change(this._x,ci),this._y=this.original.y=ci)}setTo(ci,hi){this.x=ci,this.y=hi}}class transform_Transform{constructor(){this._parent=null,this._children=[],this._pos=new WatchVector(vec(0,0),()=>{this.flagDirty()}),this._globalPos=new VectorView({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:ci=>{if(this.parent){const{x:hi}=this.parent.inverse.multiply(vec(ci,this.pos.y));this.pos.x=hi}else this.pos.x=ci;ci!==this.matrix.data[4]&&this.flagDirty()},setY:ci=>{if(this.parent){const{y:hi}=this.parent.inverse.multiply(vec(this.pos.x,ci));this.pos.y=hi}else this.pos.y=ci;ci!==this.matrix.data[5]&&this.flagDirty()}}),this._rotation=0,this._scale=new WatchVector(vec(1,1),()=>{this.flagDirty()}),this._globalScale=new VectorView({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:ci=>{if(this.parent){const hi=this.parent.globalScale.x;this.scale.x=ci/hi}else this.scale.x=ci},setY:ci=>{if(this.parent){const hi=this.parent.globalScale.y;this.scale.y=ci/hi}else this.scale.y=ci}}),this._z=0,this._isDirty=!1,this._isInverseDirty=!1,this._matrix=AffineMatrix.identity(),this._inverse=AffineMatrix.identity(),this._scratch=AffineMatrix.identity()}get parent(){return this._parent}set parent(ci){if(this._parent){const hi=this._parent._children.indexOf(this);hi>-1&&this._parent._children.splice(hi,1)}this._parent=ci,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(ci){this._pos.x=ci.x,this._pos.y=ci.y}get pos(){return this._pos}set globalPos(ci){let hi=ci.clone();this.parent&&(hi=this.parent.inverse.multiply(ci)),hi.equals(this._pos)||(this._pos=hi,this.flagDirty())}get globalPos(){return this._globalPos}set rotation(ci){const hi=canonicalizeAngle(ci);hi!==this._rotation&&this.flagDirty(),this._rotation=hi}get rotation(){return this._rotation}set globalRotation(ci){let hi=0;this.parent&&(hi=this.parent.globalRotation);const _i=canonicalizeAngle(ci+hi);_i!==this._rotation&&this.flagDirty(),this._rotation=_i}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(ci){this._scale.x=ci.x,this._scale.y=ci.y}get scale(){return this._scale}set globalScale(ci){let hi=vec(1,1);this.parent&&(hi=this.parent.globalScale),this.scale=ci.scale(vec(1/hi.x,1/hi.y))}get globalScale(){return this._globalScale}set z(ci){this._z=ci,this.flagDirty()}get z(){return this._z}set globalZ(ci){this.parent?this.z=ci-this.parent.globalZ:this.z=ci}get globalZ(){return this.parent?this.z+this.parent.globalZ:this.z}get matrix(){return this._isDirty&&(this.parent===null?this._calculateMatrix().clone(this._matrix):this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this.matrix.inverse(this._inverse),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return this._scratch.data[0]=Math.cos(this._rotation),this._scratch.data[1]=Math.sin(this._rotation),this._scratch.data[2]=-Math.sin(this._rotation),this._scratch.data[3]=Math.cos(this.rotation),this._scratch.data[4]=this._pos.x,this._scratch.data[5]=this._pos.y,this._scratch.scale(this._scale.x,this._scale.y),this._scratch}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let ci=0;ci<this._children.length;ci++)this._children[ci].flagDirty()}apply(ci){return this.matrix.multiply(ci)}applyInverse(ci){return this.inverse.multiply(ci)}setTransform(ci,hi,_i){this._pos.x=ci.x,this._pos.y=ci.y,this._rotation=canonicalizeAngle(hi),this._scale.x=_i.x,this._scale.y=_i.y,this.flagDirty()}isMirrored(){const ci=sign(this.scale.x)>>>31,hi=sign(this.scale.y)>>>31;return!!(ci^hi)}clone(ci){const hi=ci??new transform_Transform;return this._pos.clone(hi._pos),hi._z=this._z,hi._rotation=this._rotation,this._scale.clone(hi._scale),hi.flagDirty(),hi}cloneWithParent(ci){const hi=ci??new transform_Transform;return this._pos.clone(hi._pos),hi._z=this._z,hi._rotation=this._rotation,this._scale.clone(hi._scale),hi.parent=this.parent,hi.flagDirty(),hi}toString(){return this.matrix.toString()}}function isComponentCtor(fi){return!!fi&&!!fi.prototype&&!!fi.prototype.constructor}function hasClone(fi){return!!(fi!=null&&fi.clone)}class Component{constructor(){this.owner=void 0}clone(){const ci=new this.constructor;for(const hi in this)if(this.hasOwnProperty(hi)){const _i=this[hi];hasClone(_i)&&hi!=="owner"&&hi!=="clone"?ci[hi]=_i.clone():ci[hi]=_i}return ci}}class Observable{constructor(){this.observers=[],this.subscriptions=[]}register(ci){this.observers.push(ci)}subscribe(ci){this.subscriptions.push(ci)}unregister(ci){const hi=this.observers.indexOf(ci);hi!==-1&&this.observers.splice(hi,1)}unsubscribe(ci){const hi=this.subscriptions.indexOf(ci);hi!==-1&&this.subscriptions.splice(hi,1)}notifyAll(ci){const hi=this.observers.length;for(let pi=0;pi<hi;pi++)this.observers[pi].notify(ci);const _i=this.subscriptions.length;for(let pi=0;pi<_i;pi++)this.subscriptions[pi](ci)}clear(){this.observers.length=0,this.subscriptions.length=0}}class TransformComponent extends Component{constructor(){super(...arguments),this._logger=Logger.getInstance(),this._parentComponent=null,this._transform=new transform_Transform,this._addChildTransform=ci=>{const hi=ci.get(TransformComponent);hi&&(hi._transform.parent=this._transform,hi._parentComponent=this)},this.zIndexChanged$=new Observable,this._coordPlane=CoordPlane.World}get(){return this._transform}onAdd(ci){for(const hi of ci.children)this._addChildTransform(hi);ci.childrenAdded$.subscribe(hi=>this._addChildTransform(hi)),ci.childrenRemoved$.subscribe(hi=>{const _i=hi.get(TransformComponent);_i&&(_i._transform.parent=null,_i._parentComponent=null)})}onRemove(ci){this._transform.parent=null,this._parentComponent=null}get z(){return this._transform.z}set z(ci){const hi=this._transform.z;this._transform.z=ci,hi!==ci&&this.zIndexChanged$.notifyAll(ci)}get globalZ(){return this._transform.globalZ}set globalZ(ci){this._transform.globalZ=ci}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(ci){var hi;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(hi=this.owner)===null||hi===void 0?void 0:hi.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=ci}get pos(){return this._transform.pos}set pos(ci){this._transform.pos=ci}get globalPos(){return this._transform.globalPos}set globalPos(ci){this._transform.globalPos=ci}get rotation(){return this._transform.rotation}set rotation(ci){this._transform.rotation=ci}get globalRotation(){return this._transform.globalRotation}set globalRotation(ci){this._transform.globalRotation=ci}get scale(){return this._transform.scale}set scale(ci){this._transform.scale=ci}get globalScale(){return this._transform.globalScale}set globalScale(ci){this._transform.globalScale=ci}applyInverse(ci){return this._transform.applyInverse(ci)}apply(ci){return this._transform.apply(ci)}clone(){const ci=new TransformComponent;return ci._transform=this._transform.clone(),ci}}var AnimationDirection;(function(fi){fi.Forward="forward",fi.Backward="backward"})(AnimationDirection||(AnimationDirection={}));var AnimationStrategy;(function(fi){fi.End="end",fi.Loop="loop",fi.PingPong="pingpong",fi.Freeze="freeze"})(AnimationStrategy||(AnimationStrategy={}));const AnimationEvents={Frame:"frame",Loop:"loop",End:"end"};class Animation extends Graphic{constructor(ci){var hi,_i,pi;super(ci),this.events=new EventEmitter,this.frames=[],this.strategy=AnimationStrategy.Loop,this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._reversed=!1,this.frames=ci.frames,this.speed=(hi=ci.speed)!==null&&hi!==void 0?hi:this.speed,this.strategy=(_i=ci.strategy)!==null&&_i!==void 0?_i:this.strategy,this.frameDuration=ci.totalDuration?ci.totalDuration/this.frames.length:(pi=ci.frameDuration)!==null&&pi!==void 0?pi:this.frameDuration,ci.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new Animation({frames:this.frames.map(ci=>({...ci})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const ci=this.currentFrame;return ci&&ci.graphic?Math.abs(ci.graphic.width*this.scale.x):0}get height(){const ci=this.currentFrame;return ci&&ci.graphic?Math.abs(ci.graphic.height*this.scale.y):0}static fromSpriteSheet(ci,hi,_i,pi=AnimationStrategy.Loop){const gi=ci.sprites.length-1,mi=hi.filter(xi=>xi<0||xi>gi);return mi.length&&Animation._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${mi.join(",")} no frame will be shown`),new Animation({frames:ci.sprites.filter((xi,yi)=>hi.indexOf(yi)>-1).map(xi=>({graphic:xi,duration:_i})),strategy:pi})}static fromSpriteSheetCoordinates(ci){var hi;const{spriteSheet:_i,frameCoordinates:pi,durationPerFrame:gi,durationPerFrameMs:mi,speed:xi,strategy:yi,reverse:Ci}=ci,Ei=(hi=gi??mi)!==null&&hi!==void 0?hi:100,Ai=[];for(const ki of pi){const{x:Pi,y:Ii,duration:Di,options:Fi}=ki,Li=_i.getSprite(Pi,Ii,Fi);Li?Ai.push({graphic:Li,duration:Di??Ei}):Animation._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${Pi}, ${Ii}), please check your SpriteSheet to confirm that sprite exists`)}return new Animation({frames:Ai,strategy:yi,speed:xi,reverse:Ci})}get speed(){return this._speed}set speed(ci){this._speed=clamp(Math.abs(ci),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}get isReversed(){return this._reversed}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?AnimationDirection.Backward:AnimationDirection.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const ci=this.frames[this._currentFrame];ci&&(this._timeLeftInFrame=(ci==null?void 0:ci.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case AnimationStrategy.End:case AnimationStrategy.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(ci,hi){this._currentFrame=ci,this._timeLeftInFrame=hi??this.frameDuration;const _i=this.frames[this._currentFrame];_i&&!this._done&&(this._timeLeftInFrame=hi??((_i==null?void 0:_i.duration)||this.frameDuration),this.events.emit("frame",{..._i,frameIndex:this.currentFrameIndex}))}_nextFrame(){const ci=this._currentFrame;if(this._done)return ci;let hi=-1;switch(this.strategy){case AnimationStrategy.Loop:{hi=(ci+1)%this.frames.length,hi===0&&this.events.emit("loop",this);break}case AnimationStrategy.End:{hi=ci+1,hi>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case AnimationStrategy.Freeze:{hi=clamp(ci+1,0,this.frames.length-1),hi>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case AnimationStrategy.PingPong:{ci+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),ci+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),hi=ci+this._pingPongDirection%this.frames.length;break}}return hi}tick(ci,hi=0){this._idempotencyToken!==hi&&(this._idempotencyToken=hi,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=ci*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(ci,hi,_i){this.currentFrame&&this.currentFrame.graphic&&this.currentFrame.graphic.draw(ci,hi,_i)}}Animation._LOGGER=Logger.getInstance();class GraphicsGroup extends Graphic{constructor(ci){var hi;super(ci),this._logger=Logger.getInstance(),this.useAnchor=!0,this.members=[],this.members=ci.members,this.useAnchor=(hi=ci.useAnchor)!==null&&hi!==void 0?hi:this.useAnchor,this._updateDimensions()}clone(){return new GraphicsGroup({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const ci=this.localBounds;return this.width=ci.width,this.height=ci.height,ci}get localBounds(){const ci=new BoundingBox;for(const hi of this.members)if(hi instanceof Graphic)hi.localBounds.combine(ci,ci);else{const{graphic:_i,offset:pi,useBounds:gi}=hi;_i?(gi===void 0?!0:gi)&&_i.localBounds.translate(pi).combine(ci,ci):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(hi)}.`)}return ci}_isAnimationOrGroup(ci){return ci instanceof Animation||ci instanceof GraphicsGroup}tick(ci,hi){for(const _i of this.members){let pi;_i instanceof Graphic?pi=_i:pi=_i.graphic,this._isAnimationOrGroup(pi)&&pi.tick(ci,hi)}}reset(){for(const ci of this.members){let hi;ci instanceof Graphic?hi=ci:hi=ci.graphic,this._isAnimationOrGroup(hi)&&hi.reset()}}_preDraw(ci,hi,_i){this._updateDimensions(),super._preDraw(ci,this.useAnchor?hi:0,this.useAnchor?_i:0)}_drawImage(ci,hi,_i){const pi=Vector.Zero;for(const gi of this.members){let mi;gi instanceof Graphic?mi=gi:(mi=gi.graphic,gi.offset.clone(pi)),mi&&(ci.save(),ci.translate(hi,_i),mi.draw(ci,pi.x,pi.y),this.showDebug&&ci.debug.drawRect(0,0,this.width,this.height),ci.restore())}}}class Raster extends Graphic{constructor(ci){var hi,_i,pi,gi,mi,xi,yi,Ci,Ei,Ai;super(omit({...ci},["width","height"])),this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=watch(Color.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,ci&&(this.quality=(hi=ci.quality)!==null&&hi!==void 0?hi:this.quality,this.color=(_i=ci.color)!==null&&_i!==void 0?_i:Color.Black,this.strokeColor=ci==null?void 0:ci.strokeColor,this.smoothing=(pi=ci.smoothing)!==null&&pi!==void 0?pi:this.smoothing,this.lineWidth=(gi=ci.lineWidth)!==null&&gi!==void 0?gi:this.lineWidth,this.lineDash=(mi=ci.lineDash)!==null&&mi!==void 0?mi:this.lineDash,this.lineCap=(xi=ci.lineCap)!==null&&xi!==void 0?xi:this.lineCap,this.padding=(yi=ci.padding)!==null&&yi!==void 0?yi:this.padding,this.filtering=(Ci=ci.filtering)!==null&&Ci!==void 0?Ci:this.filtering),this._bitmap=document.createElement("canvas");const ki=(Ei=ci==null?void 0:ci.width)!==null&&Ei!==void 0?Ei:this._bitmap.width,Pi=(Ai=ci==null?void 0:ci.height)!==null&&Ai!==void 0?Ai:this._bitmap.height;this.width=ki,this.height=Pi;const Ii=this._bitmap.getContext("2d");if(Ii)this._ctx=Ii;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():void 0,strokeColor:this.strokeColor?this.strokeColor.clone():void 0,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(ci){ci/=Math.abs(this.scale.x),this._bitmap.width=ci,this._originalWidth=ci,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(ci){ci/=Math.abs(this.scale.y),this._bitmap.height=ci,this._originalHeight=ci,this.flagDirty()}_getTotalWidth(){var ci;return(((ci=this._originalWidth)!==null&&ci!==void 0?ci:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var ci;return(((ci=this._originalHeight)!==null&&ci!==void 0?ci:this._bitmap.height)+this.padding*2)*1}get localBounds(){return BoundingBox.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,Vector.Zero)}get smoothing(){return this._smoothing}set smoothing(ci){this._smoothing=ci,this.flagDirty()}get color(){return this._color}set color(ci){this.flagDirty(),this._color=watch(ci,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(ci){this.flagDirty(),ci&&(this._strokeColor=watch(ci,()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(ci){this._lineWidth=ci,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(ci){this._lineDash=ci,this.flagDirty()}get padding(){return this._padding}set padding(ci){this._padding=ci,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(ci){var hi,_i,pi,gi;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),ci.scale(this.quality,this.quality),ci.translate(this.padding,this.padding),ci.imageSmoothingEnabled=this.smoothing,ci.lineWidth=this.lineWidth,ci.setLineDash((hi=this.lineDash)!==null&&hi!==void 0?hi:ci.getLineDash()),ci.lineCap=this.lineCap,ci.strokeStyle=(pi=(_i=this.strokeColor)===null||_i===void 0?void 0:_i.toString())!==null&&pi!==void 0?pi:"",ci.fillStyle=(gi=this.color)===null||gi===void 0?void 0:gi.toString()}_drawImage(ci,hi,_i){this._dirty&&this.rasterize(),ci.scale(1/this.quality,1/this.quality),ci.drawImage(this._bitmap,hi,_i)}}var FontUnit;(function(fi){fi.Em="em",fi.Rem="rem",fi.Px="px",fi.Pt="pt",fi.Percent="%"})(FontUnit||(FontUnit={}));var TextAlign;(function(fi){fi.Left="left",fi.Right="right",fi.Center="center",fi.Start="start",fi.End="end"})(TextAlign||(TextAlign={}));var BaseAlign;(function(fi){fi.Top="top",fi.Hanging="hanging",fi.Middle="middle",fi.Alphabetic="alphabetic",fi.Ideographic="ideographic",fi.Bottom="bottom"})(BaseAlign||(BaseAlign={}));var FontStyle;(function(fi){fi.Normal="normal",fi.Italic="italic",fi.Oblique="oblique"})(FontStyle||(FontStyle={}));var Direction;(function(fi){fi.LeftToRight="ltr",fi.RightToLeft="rtl"})(Direction||(Direction={}));function line(fi,ci=Color.Red,hi,_i,pi,gi,mi=1,xi="butt"){fi.save(),fi.beginPath(),fi.lineWidth=mi,fi.lineCap=xi,fi.strokeStyle=ci.toString(),fi.moveTo(hi,_i),fi.lineTo(pi,gi),fi.closePath(),fi.stroke(),fi.restore()}function point(fi,ci=Color.Red,hi){fi.beginPath(),fi.strokeStyle=ci.toString(),fi.arc(hi.x,hi.y,5,0,Math.PI*2),fi.closePath(),fi.stroke()}function vector(fi,ci,hi,_i,pi=1){const gi=ci?ci.toString():"blue",mi=_i.scale(pi);fi.beginPath(),fi.strokeStyle=gi,fi.moveTo(hi.x,hi.y),fi.lineTo(hi.x+mi.x,hi.y+mi.y),fi.closePath(),fi.stroke()}function roundRect(fi,ci,hi,_i,pi,gi=5,mi=Color.White,xi=null){let yi;if(typeof gi=="number")yi={tl:gi,tr:gi,br:gi,bl:gi};else{const Ci={tl:0,tr:0,br:0,bl:0};for(const Ei in Ci)if(Ci.hasOwnProperty(Ei)){const Ai=Ei;yi[Ai]=gi[Ai]||Ci[Ai]}}fi.beginPath(),fi.moveTo(ci+yi.tl,hi),fi.lineTo(ci+_i-yi.tr,hi),fi.quadraticCurveTo(ci+_i,hi,ci+_i,hi+yi.tr),fi.lineTo(ci+_i,hi+pi-yi.br),fi.quadraticCurveTo(ci+_i,hi+pi,ci+_i-yi.br,hi+pi),fi.lineTo(ci+yi.bl,hi+pi),fi.quadraticCurveTo(ci,hi+pi,ci,hi+pi-yi.bl),fi.lineTo(ci,hi+yi.tl),fi.quadraticCurveTo(ci,hi,ci+yi.tl,hi),fi.closePath(),xi&&(fi.fillStyle=xi.toString(),fi.fill()),mi&&(fi.strokeStyle=mi.toString(),fi.stroke())}function circle(fi,ci,hi,_i,pi=Color.White,gi=null){fi.beginPath(),fi.arc(ci,hi,_i,0,Math.PI*2),fi.closePath(),gi&&(fi.fillStyle=gi.toString(),fi.fill()),pi&&(fi.strokeStyle=pi.toString(),fi.stroke())}class FontTextInstance{constructor(ci,hi,_i,pi){this.font=ci,this.text=hi,this.color=_i,this.maxWidth=pi,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas");const gi=this.canvas.getContext("2d");if(!gi)throw new Error("Unable to create FontTextInstance, internal canvas failed to create");this.ctx=gi,this.dimensions=this.measureText(hi),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(ci,hi){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let _i=null;hi!=null?_i=this._getLinesFromText(ci,hi):_i=ci.split(`
`);const pi=_i.reduce((ki,Pi)=>ki.length>Pi.length?ki:Pi);this._applyFont(this.ctx);const gi=this.ctx.measureText(pi);let mi=Math.abs(gi.actualBoundingBoxAscent)+Math.abs(gi.actualBoundingBoxDescent);const xi=mi*_i.length;mi=xi;const yi=xi-Math.abs(gi.actualBoundingBoxAscent),Ci=0,Ei=0;return new BoundingBox({left:Ci-Math.abs(gi.actualBoundingBoxLeft)-this.font.padding,top:Ei-Math.abs(gi.actualBoundingBoxAscent)-this.font.padding,bottom:Ei+yi+this.font.padding,right:Ci+Math.abs(gi.actualBoundingBoxRight)+this.font.padding})}_setDimension(ci,hi){let _i=1;this.font.lineHeight&&(_i=this.font.lineHeight/this.font.size),hi.canvas.width=(ci.width+this.font.padding*2)*2*this.font.quality,hi.canvas.height=(ci.height+this.font.padding*2)*2*this.font.quality*_i}static getHashCode(ci,hi,_i){var pi;return hi+"__hashcode__"+ci.fontString+ci.showDebug+ci.textAlign+ci.baseAlign+ci.direction+ci.lineHeight+JSON.stringify(ci.shadow)+(ci.padding.toString()+ci.smoothing.toString()+ci.lineWidth.toString()+ci.lineDash.toString()+((pi=ci.strokeColor)===null||pi===void 0?void 0:pi.toString())+(_i?_i.toString():ci.color.toString()))}getHashCode(ci=!0){return FontTextInstance.getHashCode(this.font,this.text,ci?this.color:void 0)}_applyRasterProperties(ci){var hi,_i,pi;ci.translate(this.font.padding,this.font.padding),ci.imageSmoothingEnabled=this.font.smoothing,ci.lineWidth=this.font.lineWidth,ci.setLineDash((hi=this.font.lineDash)!==null&&hi!==void 0?hi:ci.getLineDash()),ci.strokeStyle=(pi=(_i=this.font.strokeColor)===null||_i===void 0?void 0:_i.toString())!==null&&pi!==void 0?pi:"",ci.fillStyle=this.color.toString()}_applyFont(ci){ci.resetTransform(),ci.translate(this.font.padding+ci.canvas.width/2,this.font.padding+ci.canvas.height/2),ci.scale(this.font.quality,this.font.quality),ci.textAlign=this.font.textAlign,ci.textBaseline=this.font.baseAlign,ci.font=this.font.fontString,ci.direction=this.font.direction,this.font.shadow&&(this.font.shadow.color&&(ci.shadowColor=this.font.shadow.color.toString()),this.font.shadow.blur&&(ci.shadowBlur=this.font.shadow.blur),this.font.shadow.offset&&(ci.shadowOffsetX=this.font.shadow.offset.x,ci.shadowOffsetY=this.font.shadow.offset.y))}_drawText(ci,hi,_i){this._applyRasterProperties(ci),this._applyFont(ci);for(let pi=0;pi<hi.length;pi++){const gi=hi[pi];this.color&&ci.fillText(gi,0,pi*_i),this.font.strokeColor&&ci.strokeText(gi,0,pi*_i)}this.font.showDebug&&(line(ci,Color.Green,-ci.canvas.width/2,0,ci.canvas.width/2,0,2),line(ci,Color.Red,0,-ci.canvas.height/2,0,ci.canvas.height/2,2))}_splitTextBitmap(ci){const hi=[];let _i=0,pi=0;const gi=Math.min(4096,ci.canvas.width),mi=Math.min(4096,ci.canvas.height);for(;_i<ci.canvas.width;){for(;pi<ci.canvas.height;){const xi=document.createElement("canvas");xi.width=gi,xi.height=mi;const yi=xi.getContext("2d");if(!yi)throw new Error("Unable to split internal FontTextInstance bitmap, failed to create internal canvas");yi.drawImage(ci.canvas,_i,pi,gi,mi,0,0,gi,mi),hi.push({x:_i,y:pi,canvas:xi}),pi+=mi}_i+=gi,pi=0}return hi}flagDirty(){this._dirty=!0}render(ci,hi,_i,pi){var gi;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=ci;const mi=this.getHashCode();if(this._lastHashCode!==mi&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,pi),this._setDimension(this.dimensions,this.ctx);const xi=this._getLinesFromText(this.text,pi),yi=(gi=this.font.lineHeight)!==null&&gi!==void 0?gi:this.dimensions.height/xi.length;if(this._drawText(this.ctx,xi,yi),ci instanceof ExcaliburGraphicsContextWebGL)for(const Ci of this._textFragments)ci.textureLoader.delete(Ci.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),ci instanceof ExcaliburGraphicsContextWebGL)for(const Ci of this._textFragments)ci.textureLoader.load(Ci.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=mi,this._dirty=!1}for(const xi of this._textFragments)ci.drawImage(xi.canvas,0,0,xi.canvas.width,xi.canvas.height,xi.x/this.font.quality+hi-this.ctx.canvas.width/this.font.quality/2,xi.y/this.font.quality+_i-this.ctx.canvas.height/this.font.quality/2,xi.canvas.width/this.font.quality,xi.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof ExcaliburGraphicsContextWebGL)for(const ci of this._textFragments)this._ex.textureLoader.delete(ci.canvas);this._textFragments.length=0}_getLinesFromText(ci,hi){var _i;if(this._cachedText===ci&&this._cachedRenderWidth===hi&&(!((_i=this._cachedLines)===null||_i===void 0)&&_i.length))return this._cachedLines;const pi=ci.split(`
`);if(hi==null)return pi;for(let gi=0;gi<pi.length;gi++){let mi=pi[gi],xi="";if(this.measureText(mi).width>hi){for(;this.measureText(mi).width>hi;)xi=mi[mi.length-1]+xi,mi=mi.slice(0,-1);pi[gi]=mi,pi[gi+1]=xi}}return this._cachedText=ci,this._cachedLines=pi,this._cachedRenderWidth=hi,pi}}class FontCache{static measureText(ci,hi,_i){const pi=FontTextInstance.getHashCode(hi,ci);if(FontCache._MEASURE_CACHE.has(pi))return FontCache._MEASURE_CACHE.get(pi);FontCache._LOGGER.debug("Font text measurement cache miss");const gi=hi.measureTextWithoutCache(ci,_i);return FontCache._MEASURE_CACHE.set(pi,gi),gi}static getTextInstance(ci,hi,_i){const pi=FontTextInstance.getHashCode(hi,ci,_i);let gi=FontCache._TEXT_CACHE.get(pi);return gi||(gi=new FontTextInstance(hi,ci,_i),FontCache._TEXT_CACHE.set(pi,gi),FontCache._LOGGER.debug("Font text instance cache miss")),FontCache._TEXT_USAGE.set(gi,performance.now()),gi}static checkAndClearCache(){const ci=[],hi=new Set;for(const[pi,gi]of FontCache._TEXT_USAGE.entries())if(gi+FontCache.FONT_TIMEOUT<performance.now())FontCache._LOGGER.debug(`Text cache entry timed out ${pi.text}`),ci.push(pi),pi.dispose();else{const mi=pi.getHashCode(!1);hi.add(mi)}ci.forEach(pi=>{FontCache._TEXT_USAGE.delete(pi)}),this._TEXT_CACHE.clear();for(const[pi]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(pi.getHashCode(),pi);const _i=new Map;for(const pi of hi)FontCache._MEASURE_CACHE.has(pi)&&_i.set(pi,FontCache._MEASURE_CACHE.get(pi));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=_i}static get cacheSize(){return FontCache._TEXT_USAGE.size}static clearCache(){for(const[ci]of FontCache._TEXT_USAGE.entries())ci.dispose();FontCache._TEXT_USAGE.clear(),FontCache._TEXT_CACHE.clear(),FontCache._MEASURE_CACHE.clear()}}FontCache.FONT_TIMEOUT=500;FontCache._LOGGER=Logger.getInstance();FontCache._TEXT_USAGE=new Map;FontCache._TEXT_CACHE=new Map;FontCache._MEASURE_CACHE=new Map;class Font extends Graphic{constructor(ci={}){var hi,_i,pi,gi,mi,xi,yi,Ci,Ei,Ai,ki,Pi,Ii,Di,Fi,Li,Bi,Ri,$i,Ni;super(ci),this.filtering=ImageFiltering.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=Color.Black,this.family="sans-serif",this.style=FontStyle.Normal,this.bold=!1,this.unit=FontUnit.Px,this.textAlign=TextAlign.Left,this.baseAlign=BaseAlign.Top,this.direction=Direction.LeftToRight,this.lineHeight=void 0,this.size=10,this._textBounds=new BoundingBox,this._textMeasurement=new FontTextInstance(this,"",Color.Black),this.smoothing=(hi=ci==null?void 0:ci.smoothing)!==null&&hi!==void 0?hi:this.smoothing,this.padding=(_i=ci==null?void 0:ci.padding)!==null&&_i!==void 0?_i:this.padding,this.color=(pi=ci==null?void 0:ci.color)!==null&&pi!==void 0?pi:this.color,this.strokeColor=(gi=ci==null?void 0:ci.strokeColor)!==null&&gi!==void 0?gi:this.strokeColor,this.lineDash=(mi=ci==null?void 0:ci.lineDash)!==null&&mi!==void 0?mi:this.lineDash,this.lineWidth=(xi=ci==null?void 0:ci.lineWidth)!==null&&xi!==void 0?xi:this.lineWidth,this.filtering=(yi=ci==null?void 0:ci.filtering)!==null&&yi!==void 0?yi:this.filtering,this.family=(Ci=ci==null?void 0:ci.family)!==null&&Ci!==void 0?Ci:this.family,this.style=(Ei=ci==null?void 0:ci.style)!==null&&Ei!==void 0?Ei:this.style,this.bold=(Ai=ci==null?void 0:ci.bold)!==null&&Ai!==void 0?Ai:this.bold,this.size=(ki=ci==null?void 0:ci.size)!==null&&ki!==void 0?ki:this.size,this.unit=(Pi=ci==null?void 0:ci.unit)!==null&&Pi!==void 0?Pi:this.unit,this.textAlign=(Ii=ci==null?void 0:ci.textAlign)!==null&&Ii!==void 0?Ii:this.textAlign,this.baseAlign=(Di=ci==null?void 0:ci.baseAlign)!==null&&Di!==void 0?Di:this.baseAlign,this.direction=(Fi=ci==null?void 0:ci.direction)!==null&&Fi!==void 0?Fi:this.direction,this.lineHeight=(Li=ci==null?void 0:ci.lineHeight)!==null&&Li!==void 0?Li:this.lineHeight,this.quality=(Bi=ci==null?void 0:ci.quality)!==null&&Bi!==void 0?Bi:this.quality,ci!=null&&ci.shadow&&(this.shadow={},this.shadow.blur=(Ri=ci.shadow.blur)!==null&&Ri!==void 0?Ri:this.shadow.blur,this.shadow.offset=($i=ci.shadow.offset)!==null&&$i!==void 0?$i:this.shadow.offset,this.shadow.color=(Ni=ci.shadow.color)!==null&&Ni!==void 0?Ni:this.shadow.color)}clone(){return new Font({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:void 0})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(ci,hi,_i){}_rotate(ci){var hi;const _i=(hi=this.origin)!==null&&hi!==void 0?hi:this._textBounds.center;ci.translate(_i.x,_i.y),ci.rotate(this.rotation),ci.translate(-_i.x,-_i.y)}_flip(ci){this.flipHorizontal&&(ci.translate(this._textBounds.width/this.scale.x,0),ci.scale(-1,1)),this.flipVertical&&(ci.translate(0,-this._textBounds.height/2/this.scale.y),ci.scale(1,-1))}measureTextWithoutCache(ci,hi){return this._textMeasurement.measureText(ci,hi)}measureText(ci,hi){return FontCache.measureText(ci,this,hi)}_postDraw(ci){ci.restore()}render(ci,hi,_i,pi,gi,mi){const xi=FontCache.getTextInstance(hi,this,_i);this._textBounds=xi.dimensions,this._preDraw(ci,pi,gi),xi.render(ci,pi,gi,mi),this._postDraw(ci)}}class Text extends Graphic{constructor(ci){var hi,_i;super(ci),this._text="",this._textWidth=0,this._textHeight=0,this.font=(hi=ci.font)!==null&&hi!==void 0?hi:new Font,this.color=(_i=ci.color)!==null&&_i!==void 0?_i:this.color,this.text=ci.text,this.maxWidth=ci.maxWidth}clone(){var ci,hi;return new Text({text:this.text.slice(),color:(hi=(ci=this.color)===null||ci===void 0?void 0:ci.clone())!==null&&hi!==void 0?hi:Color.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(ci){this._text=ci,this._calculateDimension()}get font(){return this._font}set font(ci){this._font=ci}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:ci,height:hi}=this.font.measureText(this._text,this.maxWidth);this._textWidth=ci,this._textHeight=hi}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(ci){}_flip(ci){}_preDraw(ci,hi,_i){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(ci,hi,_i)}_drawImage(ci,hi,_i){var pi;let gi=Color.Black;this.font instanceof Font&&(gi=(pi=this.color)!==null&&pi!==void 0?pi:this.font.color);const{width:mi,height:xi}=this.font.measureText(this._text,this.maxWidth);this._textWidth=mi,this._textHeight=xi,this.font.render(ci,this._text,gi,hi,_i,this.maxWidth),this.font.showDebug&&(ci.debug.drawRect(hi-mi,_i-xi,mi*2,xi*2),this.maxWidth!=null&&ci.debug.drawRect(hi,_i,this.maxWidth,this.height,{color:Color.Yellow}))}}function hasGraphicsTick(fi){return!!fi.tick}class GraphicsComponent extends Component{get visible(){return this.isVisible}set visible(ci){this.isVisible=ci}get offset(){return this._offset}set offset(ci){this._offset=new WatchVector(ci,()=>this.recalculateBounds()),this.recalculateBounds()}get anchor(){return this._anchor}set anchor(ci){this._anchor=new WatchVector(ci,()=>this.recalculateBounds()),this.recalculateBounds()}get color(){return this._color}set color(ci){if(ci){this._color=ci.clone();const hi=this.graphics.current;(hi instanceof Raster||hi instanceof Text)&&(hi.color=this._color)}}constructor(ci){super(),this._logger=Logger.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.isVisible=!0,this.forceOnScreen=!1,this.opacity=1,this._offset=new WatchVector(Vector.Zero,()=>this.recalculateBounds()),this._anchor=new WatchVector(Vector.Half,()=>this.recalculateBounds()),this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,ci={visible:this.isVisible,graphics:{},...ci};const{current:hi,anchor:_i,color:pi,opacity:gi,visible:mi,graphics:xi,offset:yi,copyGraphics:Ci,onPreDraw:Ei,onPostDraw:Ai,onPreTransformDraw:ki,onPostTransformDraw:Pi}=ci;for(const[Ii,Di]of Object.entries(xi))Di instanceof Graphic?this._graphics[Ii]=Di:(this._graphics[Ii]=Di.graphic,this._options[Ii]=Di.options);this.offset=yi??this.offset,this.opacity=gi??this.opacity,this.anchor=_i??this.anchor,this.color=pi??this.color,this.copyGraphics=Ci??this.copyGraphics,this.onPreDraw=Ei??this.onPreDraw,this.onPostDraw=Ai??this.onPostDraw,this.onPreDraw=ki??this.onPreTransformDraw,this.onPostTransformDraw=Pi??this.onPostTransformDraw,this.isVisible=!!mi,this._current=hi??this._current,hi&&this._graphics[hi]&&this.use(hi)}getGraphic(ci){return this._graphics[ci]}getOptions(ci){return this._options[ci]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(ci,hi,_i){let pi="default",gi=null,mi;if(typeof ci=="string"&&hi instanceof Graphic&&(pi=ci,gi=hi,mi=_i),ci instanceof Graphic&&!(hi instanceof Graphic)&&(gi=ci,mi=hi),!gi)throw new Error("Need to provide a graphic or valid graphic string");return this._graphics[pi]=this.copyGraphics?gi.clone():gi,this._options[pi]=this.copyGraphics?{...mi}:mi,pi==="default"&&this.use("default"),gi}remove(ci){delete this._graphics[ci],delete this._options[ci],this._current===ci&&(this._current="default",this.recalculateBounds())}use(ci,hi){var _i;if(ci instanceof Graphic){let pi=ci;this.copyGraphics&&(pi=ci.clone()),this._current="default",this._graphics[this._current]=pi,this._options[this._current]=hi}else this._current=ci,this._options[this._current]=hi,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(_i=this.owner)===null||_i===void 0?void 0:_i.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(ci){this._localBounds=ci}recalculateBounds(){let ci=new BoundingBox;const hi=this._graphics[this._current],_i=this._options[this._current];if(!hi){this._localBounds=ci;return}let pi=this.anchor,gi=this.offset;_i!=null&&_i.anchor&&(pi=_i.anchor),_i!=null&&_i.offset&&(gi=_i.offset);const mi=hi.localBounds,xi=-mi.width*pi.x+gi.x,yi=-mi.height*pi.y+gi.y;hi instanceof GraphicsGroup&&!hi.useAnchor?ci=hi==null?void 0:hi.localBounds.combine(ci):ci=hi==null?void 0:hi.localBounds.translate(vec(xi,yi)).combine(ci),this._localBounds=ci}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let ci=this.localBounds;if(this.owner){const hi=this.owner.get(TransformComponent);hi&&(ci=ci.transform(hi.get().matrix))}return ci}update(ci,hi=0){const _i=this.current;_i&&hasGraphicsTick(_i)&&_i.tick(ci,hi)}clone(){const ci=new GraphicsComponent;return ci._graphics={...this._graphics},ci._options={...this._options},ci.offset=this.offset.clone(),this.color&&(ci.color=this.color.clone()),ci.opacity=this.opacity,ci.anchor=this.anchor.clone(),ci.copyGraphics=this.copyGraphics,ci.onPreDraw=this.onPreDraw,ci.onPostDraw=this.onPostDraw,ci.isVisible=this.isVisible,ci}}var EventTypes;(function(fi){fi.Kill="kill",fi.PreKill="prekill",fi.PostKill="postkill",fi.PreDraw="predraw",fi.PostDraw="postdraw",fi.PreDebugDraw="predebugdraw",fi.PostDebugDraw="postdebugdraw",fi.PreUpdate="preupdate",fi.PostUpdate="postupdate",fi.PreFrame="preframe",fi.PostFrame="postframe",fi.PreCollision="precollision",fi.CollisionStart="collisionstart",fi.CollisionEnd="collisionend",fi.PostCollision="postcollision",fi.Initialize="initialize",fi.Activate="activate",fi.Deactivate="deactivate",fi.ExitViewport="exitviewport",fi.EnterViewport="enterviewport",fi.ExitTrigger="exit",fi.EnterTrigger="enter",fi.Connect="connect",fi.Disconnect="disconnect",fi.Button="button",fi.Axis="axis",fi.Visible="visible",fi.Hidden="hidden",fi.Start="start",fi.Stop="stop",fi.PointerUp="pointerup",fi.PointerDown="pointerdown",fi.PointerMove="pointermove",fi.PointerEnter="pointerenter",fi.PointerLeave="pointerleave",fi.PointerCancel="pointercancel",fi.PointerWheel="pointerwheel",fi.Up="up",fi.Down="down",fi.Move="move",fi.Enter="enter",fi.Leave="leave",fi.Cancel="cancel",fi.Wheel="wheel",fi.Press="press",fi.Release="release",fi.Hold="hold",fi.PointerDragStart="pointerdragstart",fi.PointerDragEnd="pointerdragend",fi.PointerDragEnter="pointerdragenter",fi.PointerDragLeave="pointerdragleave",fi.PointerDragMove="pointerdragmove",fi.ActionStart="actionstart",fi.ActionComplete="actioncomplete",fi.Add="add",fi.Remove="remove"})(EventTypes||(EventTypes={}));class GameEvent{constructor(){this.other=null,this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(ci){this._bubbles=ci}stopPropagation(){this.bubbles=!1}}class KillEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class PreKillEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class PostKillEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class GameStartEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class GameStopEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class PreDrawEvent extends GameEvent{constructor(ci,hi,_i){super(),this.ctx=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PostDrawEvent extends GameEvent{constructor(ci,hi,_i){super(),this.ctx=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PreTransformDrawEvent extends GameEvent{constructor(ci,hi,_i){super(),this.ctx=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PostTransformDrawEvent extends GameEvent{constructor(ci,hi,_i){super(),this.ctx=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PreDebugDrawEvent extends GameEvent{constructor(ci,hi){super(),this.ctx=ci,this.self=hi,this.target=hi}}class PostDebugDrawEvent extends GameEvent{constructor(ci,hi){super(),this.ctx=ci,this.self=hi,this.target=hi}}class PreUpdateEvent extends GameEvent{constructor(ci,hi,_i){super(),this.engine=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PostUpdateEvent extends GameEvent{constructor(ci,hi,_i){super(),this.engine=ci,this.elapsed=hi,this.self=_i,this.target=_i}}class PreFrameEvent extends GameEvent{constructor(ci,hi){super(),this.engine=ci,this.prevStats=hi,this.target=ci}}class PostFrameEvent extends GameEvent{constructor(ci,hi){super(),this.engine=ci,this.stats=hi,this.target=ci}}class GamepadConnectEvent extends GameEvent{constructor(ci,hi){super(),this.index=ci,this.gamepad=hi,this.target=hi}}class GamepadDisconnectEvent extends GameEvent{constructor(ci,hi){super(),this.index=ci,this.gamepad=hi,this.target=hi}}class GamepadButtonEvent extends GameEvent{constructor(ci,hi,_i,pi){super(),this.button=ci,this.index=hi,this.value=_i,this.self=pi,this.target=pi}}class GamepadAxisEvent extends GameEvent{constructor(ci,hi,_i){super(),this.axis=ci,this.value=hi,this.self=_i,this.target=_i}}class VisibleEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class HiddenEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class PreCollisionEvent extends GameEvent{constructor(ci,hi,_i,pi,gi){super(),this.self=ci,this.other=hi,this.side=_i,this.intersection=pi,this.contact=gi,this.target=ci}}class PostCollisionEvent extends GameEvent{constructor(ci,hi,_i,pi,gi){super(),this.self=ci,this.other=hi,this.side=_i,this.intersection=pi,this.contact=gi,this.target=ci}}class ContactStartEvent{constructor(ci,hi,_i,pi){this.self=ci,this.other=hi,this.side=_i,this.contact=pi}}class ContactEndEvent{constructor(ci,hi,_i,pi){this.self=ci,this.other=hi,this.side=_i,this.lastContact=pi}}class CollisionPreSolveEvent{constructor(ci,hi,_i,pi,gi){this.self=ci,this.other=hi,this.side=_i,this.intersection=pi,this.contact=gi}}class CollisionPostSolveEvent{constructor(ci,hi,_i,pi,gi){this.self=ci,this.other=hi,this.side=_i,this.intersection=pi,this.contact=gi}}class CollisionStartEvent extends GameEvent{constructor(ci,hi,_i,pi){super(),this.self=ci,this.other=hi,this.side=_i,this.contact=pi,this.target=ci}}class CollisionEndEvent extends GameEvent{constructor(ci,hi,_i,pi){super(),this.self=ci,this.other=hi,this.side=_i,this.lastContact=pi,this.target=ci}}class InitializeEvent extends GameEvent{constructor(ci,hi){super(),this.engine=ci,this.self=hi,this.target=hi}}class ActivateEvent extends GameEvent{constructor(ci,hi){super(),this.context=ci,this.self=hi,this.target=hi}}class DeactivateEvent extends GameEvent{constructor(ci,hi){super(),this.context=ci,this.self=hi,this.target=hi}}class ExitViewPortEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class EnterViewPortEvent extends GameEvent{constructor(ci){super(),this.self=ci,this.target=ci}}class EnterTriggerEvent extends GameEvent{constructor(ci,hi){super(),this.self=ci,this.entity=hi,this.target=ci}}class ExitTriggerEvent extends GameEvent{constructor(ci,hi){super(),this.self=ci,this.entity=hi,this.target=ci}}class ActionStartEvent extends GameEvent{constructor(ci,hi){super(),this.action=ci,this.self=hi,this.target=hi}}class ActionCompleteEvent extends GameEvent{constructor(ci,hi){super(),this.action=ci,this.self=hi,this.target=hi}}class AddEvent extends GameEvent{constructor(ci,hi){super(),this.engine=ci,this.self=hi,this.target=hi}}class RemoveEvent extends GameEvent{constructor(ci,hi){super(),this.engine=ci,this.self=hi,this.target=hi}}class AddedComponent{constructor(ci){this.data=ci,this.type="Component Added"}}function isAddedComponent(fi){return!!fi&&fi.type==="Component Added"}class RemovedComponent{constructor(ci){this.data=ci,this.type="Component Removed"}}function isRemovedComponent(fi){return!!fi&&fi.type==="Component Removed"}const EntityEvents={Add:"add",Remove:"remove",Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate",Kill:"kill"};class Entity{constructor(ci,hi){this.id=Entity._ID++,this.name=`Entity#${this.id}`,this.events=new EventEmitter,this._tags=new Set,this.componentAdded$=new Observable,this.componentRemoved$=new Observable,this.tagAdded$=new Observable,this.tagRemoved$=new Observable,this.components=new Map,this.componentValues=[],this._componentsToRemove=[],this.scene=null,this.isActive=!0,this._parent=null,this.childrenAdded$=new Observable,this.childrenRemoved$=new Observable,this._children=[],this._isInitialized=!1,this._isAdded=!1;let _i,pi;if(Array.isArray(ci))_i=ci,pi=hi;else if(ci&&typeof ci=="object"){const{components:gi,name:mi,silenceWarnings:xi}=ci;_i=gi??[],pi=mi}if(pi&&(this.name=pi),_i)for(const gi of _i)this.addComponent(gi)}get active(){return this.isActive}set active(ci){this.isActive=ci}kill(){this.isActive&&(this.isActive=!1,this.unparent()),this.emit("kill",new KillEvent(this))}isKilled(){return!this.isActive}get tags(){return this._tags}hasTag(ci){return this._tags.has(ci)}addTag(ci){return this._tags.add(ci),this.tagAdded$.notifyAll(ci),this}removeTag(ci){return this._tags.delete(ci),this.tagRemoved$.notifyAll(ci),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(ci){for(let hi=0;hi<ci.length;hi++)if(!this.components.has(ci[hi]))return!1;return!0}hasAllTags(ci){for(let hi=0;hi<ci.length;hi++)if(!this.tags.has(ci[hi]))return!1;return!0}get(ci){return this.components.get(ci)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(ci){if(ci.parent===null){if(this.getAncestors().includes(ci))throw new Error("Cycle detected, cannot add entity");this._children.push(ci),ci._parent=this,this.childrenAdded$.notifyAll(ci)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(ci){return ci.parent===this&&(removeItemFromArray(ci,this._children),ci._parent=null,this.childrenRemoved$.notifyAll(ci)),this}removeAllChildren(){for(let ci=this.children.length-1;ci>=0;ci--)this.removeChild(this.children[ci]);return this}getAncestors(){const ci=[this];let hi=this.parent;for(;hi;)ci.push(hi),hi=hi.parent;return ci.reverse()}getDescendants(){let ci=[this],hi=[this];for(;hi.length>0;){const _i=hi.pop();_i&&(hi=hi.concat(_i.children),ci=ci.concat(_i.children))}return ci}clone(){const ci=new Entity;for(const hi of this.types){const _i=this.get(hi);_i&&ci.addComponent(_i.clone())}for(const hi of this.children)ci.addChild(hi.clone());return ci}addTemplate(ci,hi=!1){for(const _i of ci.getComponents())this.addComponent(_i.clone(),hi);for(const _i of ci.children)this.addChild(_i.clone().addTemplate(_i));return this}_getClassHierarchyRoot(ci){var hi,_i;let pi=ci,gi=(hi=Object.getPrototypeOf(pi.prototype))===null||hi===void 0?void 0:hi.constructor;for(;gi&&gi!==Object&&gi!==Component;)pi=gi,gi=(_i=Object.getPrototypeOf(pi.prototype))===null||_i===void 0?void 0:_i.constructor;return pi}addComponent(ci,hi=!1){if(this.has(ci.constructor))if(hi)this.removeComponent(ci.constructor,!0);else return this;if(ci.dependencies&&ci.dependencies.length)for(const pi of ci.dependencies)this.addComponent(new pi);ci.owner=this;const _i=this._getClassHierarchyRoot(ci.constructor);return this.components.set(_i,ci),this.components.set(ci.constructor,ci),this.componentValues.push(ci),ci.onAdd&&ci.onAdd(this),this.componentAdded$.notifyAll(ci),this}removeComponent(ci,hi=!1){let _i;if(isComponentCtor(ci)?_i=ci:_i=ci.constructor,hi){const pi=this.components.get(_i);if(pi){this.componentRemoved$.notifyAll(pi),pi.owner=void 0,pi.onRemove&&pi.onRemove(this);const mi=this.componentValues.indexOf(pi);mi>-1&&this.componentValues.splice(mi,1)}const gi=this._getClassHierarchyRoot(_i);this.components.delete(gi),this.components.delete(_i)}else this._componentsToRemove.push(_i);return this}clearComponents(){const ci=this.types;for(const hi of ci)this.removeComponent(hi)}processComponentRemoval(){for(const ci of this._componentsToRemove)this.removeComponent(ci,!0);this._componentsToRemove.length=0}has(ci){return this.components.has(ci)}get isInitialized(){return this._isInitialized}get isAdded(){return this._isAdded}_initialize(ci){this.isInitialized||(this.onInitialize(ci),this.events.emit("initialize",new InitializeEvent(ci,this)),this._isInitialized=!0)}_add(ci){!this.isAdded&&this.isActive&&(this.onAdd(ci),this.events.emit("add",new AddEvent(ci,this)),this._isAdded=!0)}_remove(ci){this.isAdded&&!this.isActive&&(this.onRemove(ci),this.events.emit("remove",new RemoveEvent(ci,this)),this._isAdded=!1)}_preupdate(ci,hi){this.events.emit("preupdate",new PreUpdateEvent(ci,hi,this)),this.onPreUpdate(ci,hi)}_postupdate(ci,hi){this.events.emit("postupdate",new PostUpdateEvent(ci,hi,this)),this.onPostUpdate(ci,hi)}onInitialize(ci){}onAdd(ci){}onRemove(ci){}onPreUpdate(ci,hi){}onPostUpdate(ci,hi){}update(ci,hi){this._initialize(ci),this._add(ci),this._preupdate(ci,hi);for(const _i of this.children)_i.update(ci,hi);this._postupdate(ci,hi),this._remove(ci)}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){hi?this.events.off(ci,hi):this.events.off(ci)}}Entity._ID=0;class MotionComponent extends Component{constructor(){super(...arguments),this.vel=Vector.Zero,this.acc=Vector.Zero,this.scaleFactor=Vector.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class EulerIntegrator{static integrate(ci,hi,_i,pi){const gi=pi/1e3;hi.vel.addEqual(_i.scale(gi,EulerIntegrator._ACC)),ci.pos.add(hi.vel.scale(gi,EulerIntegrator._VEL),EulerIntegrator._POS).addEqual(_i.scale(.5*gi*gi,EulerIntegrator._VEL_ACC)),hi.angularVelocity+=hi.torque*(1/hi.inertia)*gi;const mi=ci.rotation+hi.angularVelocity*gi;ci.scale.add(hi.scaleFactor.scale(gi,this._SCALE_FACTOR),EulerIntegrator._SCALE),ci.get().setTransform(EulerIntegrator._POS,mi,EulerIntegrator._SCALE)}}EulerIntegrator._POS=new Vector(0,0);EulerIntegrator._SCALE=new Vector(1,1);EulerIntegrator._ACC=new Vector(0,0);EulerIntegrator._VEL=new Vector(0,0);EulerIntegrator._VEL_ACC=new Vector(0,0);EulerIntegrator._SCALE_FACTOR=new Vector(0,0);class Particle extends Entity{constructor(ci){super({silenceWarnings:!0}),this.beginColor=Color.White,this.endColor=Color.White,this.life=300,this.fade=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=Color.White,this.size=5,this.sizeRate=0,this.visible=!0,this.isOffscreen=!1,this.particleTransform=ParticleTransform.Global,this.name=`Particle#${this.id}`,this.addComponent(this.transform=new TransformComponent),this.addComponent(this.motion=new MotionComponent),this.addComponent(this.graphics=new GraphicsComponent),this.configure(ci)}registerEmitter(ci){if(this._emitter=ci,this.particleTransform===ParticleTransform.Global){const hi=this._emitter.transform.globalPos;this.transform.pos=this.transform.pos.add(hi),this.motion.vel=this.motion.vel.rotate(this._emitter.transform.globalRotation)}}configure(ci){var hi,_i,pi,gi,mi,xi,yi,Ci,Ei,Ai,ki,Pi,Ii,Di;this.particleTransform=(hi=ci.transform)!==null&&hi!==void 0?hi:this.particleTransform,this.life=(_i=ci.life)!==null&&_i!==void 0?_i:this.life,this.fade=(pi=ci.fade)!==null&&pi!==void 0?pi:this.fade,this.size=(gi=ci.size)!==null&&gi!==void 0?gi:this.size,this.endColor=(mi=ci.endColor)!==null&&mi!==void 0?mi:this.endColor.clone(),this.beginColor=(xi=ci.beginColor)!==null&&xi!==void 0?xi:this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.graphic=ci.graphic,this.graphics.opacity=(yi=ci.opacity)!==null&&yi!==void 0?yi:this.graphics.opacity,this.transform.pos=(Ci=ci.pos)!==null&&Ci!==void 0?Ci:this.transform.pos,this.transform.rotation=(Ei=ci.rotation)!==null&&Ei!==void 0?Ei:0,this.transform.scale=vec(1,1),this.motion.vel=(Ai=ci.vel)!==null&&Ai!==void 0?Ai:this.motion.vel,this.motion.angularVelocity=(ki=ci.angularVelocity)!==null&&ki!==void 0?ki:0,this.motion.acc=(Pi=ci.acc)!==null&&Pi!==void 0?Pi:this.motion.acc,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.graphics.opacity/this.life,this.startSize=(Ii=ci.startSize)!==null&&Ii!==void 0?Ii:0,this.endSize=(Di=ci.endSize)!==null&&Di!==void 0?Di:0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.size=this.startSize),this.graphic?(this.graphics.use(this.graphic),this.graphics.onPostDraw=void 0):(this.graphics.localBounds=BoundingBox.fromDimension(this.size,this.size,Vector.Half),this.graphics.onPostDraw=Fi=>{Fi.save(),Fi.debug.drawPoint(vec(0,0),{color:this._currentColor,size:this.size}),Fi.restore()})}kill(){var ci;!((ci=this._emitter)===null||ci===void 0)&&ci.isActive?this._emitter.removeParticle(this):super.kill()}update(ci,hi){this.life=this.life-hi,this.life<0&&this.kill(),this.fade&&(this.graphics.opacity=clamp(this._aRate*this.life,1e-4,1)),this.startSize&&this.endSize&&this.startSize>0&&this.endSize>0&&(this.size=clamp(this.sizeRate*hi+this.size,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=clamp(this._currentColor.r+this._rRate*hi,0,255),this._currentColor.g=clamp(this._currentColor.g+this._gRate*hi,0,255),this._currentColor.b=clamp(this._currentColor.b+this._bRate*hi,0,255),this._currentColor.a=this.graphics.opacity;let _i=this.motion.acc;this.focus&&(_i=this.focus.sub(this.transform.pos).normalize().scale(this.focusAccel||0).scale(hi/1e3)),EulerIntegrator.integrate(this.transform,this.motion,_i,hi)}}Particle.DefaultConfig={beginColor:Color.White,endColor:Color.White,life:300,fade:!1,size:5,graphic:void 0,startSize:void 0,endSize:void 0};var ParticleTransform;(function(fi){fi.Global="global",fi.Local="local"})(ParticleTransform||(ParticleTransform={}));class ParticleRenderer{constructor(){this.type="ex.particle",this.priority=0}initialize(ci,hi){this._gl=ci,this._context=hi,this._shader=new Shader({gl:ci,vertexSource:particle_vertex,fragmentSource:particle_fragment,onPreLink:_i=>{ci.transformFeedbackVaryings(_i,["finalPosition","finalVelocity","finalRotation","finalAngularVelocity","finalLifeMs"],ci.INTERLEAVED_ATTRIBS)}}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho)}_getTexture(ci){const hi=ci.getAttribute(ImageSourceAttributeConstants.Filtering),_i=hi?parseImageFiltering(hi):void 0,pi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingX)),gi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingY)),mi=ci.getAttribute("forceUpload")==="true",xi=this._context.textureLoader.load(ci,{filtering:_i,wrapping:{x:pi,y:gi}},mi);return ci.removeAttribute("forceUpload"),xi}draw(ci,hi){var _i,pi,gi,mi,xi,yi,Ci,Ei,Ai;const ki=this._gl;this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho);const Pi=ci.particle.transform===ParticleTransform.Local?this._context.getTransform():this._context.getTransform().multiply(ci.emitter.transform.get().inverse);this._shader.setUniformAffineMatrix("u_transform",Pi),this._shader.setUniformBoolean("fade",!!ci.particle.fade),this._shader.setUniformBoolean("useTexture",!!ci.particle.graphic),this._shader.setUniformFloat("maxLifeMs",(_i=ci.particle.life)!==null&&_i!==void 0?_i:2e3),this._shader.setUniformFloat("deltaMs",hi),this._shader.setUniformFloatVector("gravity",(pi=ci.particle.acc)!==null&&pi!==void 0?pi:vec(0,0)),this._shader.setUniformFloatColor("beginColor",(gi=ci.particle.beginColor)!==null&&gi!==void 0?gi:Color.Transparent),this._shader.setUniformFloatColor("endColor",(mi=ci.particle.endColor)!==null&&mi!==void 0?mi:Color.Transparent);let Ii=(xi=ci.particle.startSize)!==null&&xi!==void 0?xi:0,Di=(yi=ci.particle.endSize)!==null&&yi!==void 0?yi:0;const Fi=(Ci=ci.particle.size)!==null&&Ci!==void 0?Ci:0;if(Fi>0&&(Ii=Fi,Di=Fi),this._shader.setUniformFloat("startSize",Ii??10),this._shader.setUniformFloat("endSize",Di??10),this._shader.setUniformFloat("startOpacity",(Ei=ci.particle.opacity)!==null&&Ei!==void 0?Ei:1),ci.particle.focus&&(this._shader.setUniformFloatVector("focus",ci.particle.focus),this._shader.setUniformFloat("focusAccel",(Ai=ci.particle.focusAccel)!==null&&Ai!==void 0?Ai:0)),ci.particle.graphic){const Li=ci.particle.graphic,Bi=this._getTexture(Li.image.image);ki.activeTexture(ki.TEXTURE0),ki.bindTexture(ki.TEXTURE_2D,Bi),this._shader.setUniformInt("graphic",0)}ci.draw(ki)}hasPendingDraws(){return!1}flush(){}dispose(){}}const image_renderer_v2_frag=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
in float v_texture_index;\r
\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
// texture resolution\r
in vec2 v_res;\r
\r
in vec2 v_size;\r
\r
in vec2 v_uv_min;\r
in vec2 v_uv_max;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
\r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
\r
  return pixel/texture_size;\r
}\r
\r
float lerp(float from, float to, float rel){\r
  return ((1. - rel) * from) + (rel * to);\r
}\r
\r
float invLerp(float from, float to, float value){\r
  return (value - from) / (to - from);\r
}\r
\r
float remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\r
  float rel = invLerp(origFrom, origTo, value);\r
  return lerp(targetFrom, targetTo, rel);\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
\r
  vec4 color=vec4(1.,0,0,1.);\r
  vec2 remapped_uv = v_texcoord;\r
  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);\r
  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);\r
  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;\r
\r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
\r
  color.rgb = color.rgb * v_opacity;\r
  color.a = color.a * v_opacity;\r
  fragColor = color * v_tint;\r
}`,image_renderer_v2_vert=`#version 300 es\r
layout(location=0) in vec2 pos;\r
layout(location=1) in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
layout(location=2) in vec2 a_offset;\r
layout(location=3) in vec2 a_mat_column1;\r
layout(location=4) in vec2 a_mat_column2;\r
layout(location=5) in vec2 a_mat_column3;\r
\r
layout(location=6) in float a_opacity;\r
out float v_opacity;\r
\r
// Texture resolution (could be bigger than a_size)\r
layout(location=7) in vec2 a_res;\r
out vec2 v_res;\r
\r
// Final size of graphic\r
layout(location=8) in vec2 a_size;\r
out vec2 v_size;\r
\r
layout(location=9) in lowp float a_texture_index;\r
out lowp float v_texture_index;\r
\r
layout(location=10) in vec2 a_uv_min;\r
out vec2 v_uv_min;\r
\r
layout(location=11) in vec2 a_uv_max;\r
out vec2 v_uv_max;\r
\r
layout(location=12) in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  mat4 world_mat = mat4(\r
    a_mat_column1.x, a_mat_column1.y, 0., 0.,\r
    a_mat_column2.x, a_mat_column2.y, 0., 0.,\r
    0.             , 0.             , 1., 0.,\r
    a_mat_column3.x, a_mat_column3.y, 0., 1.\r
  );\r
\r
  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\r
  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\r
\r
  v_opacity = a_opacity;\r
  v_texcoord = a_texcoord;\r
  v_uv_min = a_uv_min;\r
  v_uv_max = a_uv_max;\r
  v_res = a_res;\r
  v_size = a_size;\r
  v_texture_index = a_texture_index;\r
  v_tint = a_tint;\r
}`;class ImageRendererV2{constructor(ci){this.type="ex.image-v2",this.priority=0,this._maxImages=2e4,this._maxTextures=0,this._components=22,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._defaultTint=Color.White,this.pixelArtSampler=ci.pixelArtSampler,this.uvPadding=ci.uvPadding}initialize(ci,hi){this._gl=ci,this._context=hi;const _i=ci.getParameter(ci.MAX_TEXTURE_IMAGE_UNITS),pi=getMaxShaderComplexity(ci,_i);this._maxTextures=Math.min(_i,pi);const gi=this._transformFragmentSource(image_renderer_v2_frag,this._maxTextures);this._shader=new Shader({gl:ci,fragmentSource:gi,vertexSource:image_renderer_v2_vert}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",hi.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((Ai,ki)=>ki)),this._vao=ci.createVertexArray(),ci.bindVertexArray(this._vao),this._quadMesh=new Float32Array([0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1]),this._meshBuffer=ci.createBuffer(),ci.bindBuffer(ci.ARRAY_BUFFER,this._meshBuffer),ci.bufferData(ci.ARRAY_BUFFER,this._quadMesh,ci.STATIC_DRAW),ci.vertexAttribPointer(0,2,ci.FLOAT,!1,16,0),ci.enableVertexAttribArray(0),ci.vertexAttribPointer(1,2,ci.FLOAT,!1,16,8),ci.enableVertexAttribArray(1),ci.bindBuffer(ci.ARRAY_BUFFER,null);const mi=this._components;this._transformData=new VertexBuffer({gl:ci,size:mi*this._maxImages,type:"dynamic"}),this._transformData.bind();let xi=0,yi=2;const Ci=4,Ei=mi*4;ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(2),xi+=2*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(3),xi+=2*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(4),xi+=2*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(5),xi+=2*Ci,ci.vertexAttribPointer(yi++,1,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(6),xi+=1*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(7),xi+=2*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(8),xi+=2*Ci,ci.vertexAttribPointer(yi++,1,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(9),xi+=1*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(10),xi+=2*Ci,ci.vertexAttribPointer(yi++,2,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(11),xi+=2*Ci,ci.vertexAttribPointer(yi++,4,ci.FLOAT,!1,Ei,xi),ci.enableVertexAttribArray(12),xi+=4*Ci,ci.vertexAttribDivisor(2,1),ci.vertexAttribDivisor(3,1),ci.vertexAttribDivisor(4,1),ci.vertexAttribDivisor(5,1),ci.vertexAttribDivisor(6,1),ci.vertexAttribDivisor(7,1),ci.vertexAttribDivisor(8,1),ci.vertexAttribDivisor(9,1),ci.vertexAttribDivisor(10,1),ci.vertexAttribDivisor(11,1),ci.vertexAttribDivisor(12,1),ci.bindVertexArray(null)}_bindData(ci){const hi=this._components;this._transformData.bind(),this._transformData.upload(hi*this._imageCount),ci.bindVertexArray(this._vao)}dispose(){this._transformData.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(ci,hi){let _i=ci.replace("%%count%%",hi.toString()),pi="";for(let gi=0;gi<hi;gi++)gi===0?pi+=`if (v_texture_index <= ${gi}.5) {
`:pi+=`   else if (v_texture_index <= ${gi}.5) {
`,pi+=`      color = texture(u_textures[${gi}], uv);
`,pi+=`   }
`;return _i=_i.replace("%%texture_picker%%",pi),_i}_addImageAsTexture(ci){if(this._images.has(ci))return;const hi=ci.getAttribute(ImageSourceAttributeConstants.Filtering),_i=hi?parseImageFiltering(hi):void 0,pi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingX)),gi=parseImageWrapping(ci.getAttribute(ImageSourceAttributeConstants.WrappingY)),mi=ci.getAttribute("forceUpload")==="true",xi=this._context.textureLoader.load(ci,{filtering:_i,wrapping:{x:pi,y:gi}},mi);ci.removeAttribute("forceUpload"),this._textures.indexOf(xi)===-1&&(this._textures.push(xi),this._textureToIndex.set(xi,this._textureIndex++),this._images.add(ci))}_bindTextures(ci){const hi=Math.min(this._textureIndex,this._maxTextures);for(let _i=0;_i<hi;_i++)ci.activeTexture(ci.TEXTURE0+_i),ci.bindTexture(ci.TEXTURE_2D,this._textures[_i]||this._textures[0])}_getTextureIdForImage(ci){var hi;if(ci){const _i=this._context.textureLoader.get(ci);return(hi=this._textureToIndex.get(_i))!==null&&hi!==void 0?hi:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(ci){let hi=this._imageToWidth.get(ci);return hi===void 0&&(hi=ci.width,this._imageToWidth.set(ci,hi)),hi}_getImageHeight(ci){let hi=this._imageToHeight.get(ci);return hi===void 0&&(hi=ci.height,this._imageToHeight.set(ci,hi)),hi}draw(ci,hi,_i,pi,gi,mi,xi,yi,Ci){var Ei,Ai,ki,Pi;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(ci);const Ii=this._getImageWidth(ci),Di=this._getImageHeight(ci);let Fi=Ii||pi||0,Li=Di||gi||0;this._view[0]=0,this._view[1]=0,this._view[2]=(Ei=pi??Ii)!==null&&Ei!==void 0?Ei:0,this._view[3]=(Ai=gi??Di)!==null&&Ai!==void 0?Ai:0,this._dest[0]=hi??1,this._dest[1]=_i??1,mi!==void 0&&xi!==void 0&&yi!==void 0&&Ci!==void 0&&(this._view[0]=hi??1,this._view[1]=_i??1,this._view[2]=(ki=pi??Ii)!==null&&ki!==void 0?ki:0,this._view[3]=(Pi=gi??Di)!==null&&Pi!==void 0?Pi:0,this._dest[0]=mi,this._dest[1]=xi,Fi=yi,Li=Ci),hi=this._view[0],_i=this._view[1];const Bi=this._view[2],Ri=this._view[3],$i=this._context.getTransform(),Ni=this._context.opacity;this._context.snapToPixel&&(this._dest[0]=~~(this._dest[0]+pixelSnapEpsilon),this._dest[1]=~~(this._dest[1]+pixelSnapEpsilon));const Ui=this._context.tint||this._defaultTint,qi=this._getTextureIdForImage(ci),Ji=Ii||Fi,rs=Di||Li,ss=(hi+this.uvPadding)/Ji,zi=(_i+this.uvPadding)/rs,Gi=(hi+Bi-this.uvPadding)/Ji,Vi=(_i+Ri-this.uvPadding)/rs,Qi=Ii,is=Di,Zi=this._transformData.bufferData;Zi[this._vertexIndex++]=this._dest[0],Zi[this._vertexIndex++]=this._dest[1],Zi[this._vertexIndex++]=$i.data[0],Zi[this._vertexIndex++]=$i.data[1],Zi[this._vertexIndex++]=$i.data[2],Zi[this._vertexIndex++]=$i.data[3],Zi[this._vertexIndex++]=$i.data[4],Zi[this._vertexIndex++]=$i.data[5],Zi[this._vertexIndex++]=Ni,Zi[this._vertexIndex++]=Fi,Zi[this._vertexIndex++]=Li,Zi[this._vertexIndex++]=Qi,Zi[this._vertexIndex++]=is,Zi[this._vertexIndex++]=qi,Zi[this._vertexIndex++]=ss,Zi[this._vertexIndex++]=zi,Zi[this._vertexIndex++]=Gi,Zi[this._vertexIndex++]=Vi,Zi[this._vertexIndex++]=Ui.r/255,Zi[this._vertexIndex++]=Ui.g/255,Zi[this._vertexIndex++]=Ui.b/255,Zi[this._vertexIndex++]=Ui.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const ci=this._gl;this._shader.use(),this._bindData(ci),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(ci),ci.drawArraysInstanced(ci.TRIANGLES,0,6,this._imageCount),GraphicsDiagnostics.DrawnImagesCount+=this._imageCount,GraphicsDiagnostics.DrawCallCount++,ci.bindVertexArray(null),this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const pixelSnapEpsilon=1e-4;class ExcaliburGraphicsContextWebGLDebug{constructor(ci){this._webglCtx=ci,this._debugText=new DebugText}drawRect(ci,hi,_i,pi,gi={color:Color.Black}){this.drawLine(vec(ci,hi),vec(ci+_i,hi),{...gi}),this.drawLine(vec(ci+_i,hi),vec(ci+_i,hi+pi),{...gi}),this.drawLine(vec(ci+_i,hi+pi),vec(ci,hi+pi),{...gi}),this.drawLine(vec(ci,hi+pi),vec(ci,hi),{...gi})}drawLine(ci,hi,_i){var pi;this._webglCtx.draw("ex.line",ci,hi,(pi=_i==null?void 0:_i.color)!==null&&pi!==void 0?pi:Color.Black)}drawPoint(ci,hi={color:Color.Black,size:5}){this._webglCtx.draw("ex.point",ci,hi.color,hi.size)}drawText(ci,hi){this._debugText.write(this._webglCtx,ci,hi)}}class ExcaliburGraphicsContextWebGL{get z(){return this._state.current.z}set z(ci){this._state.current.z=ci}get opacity(){return this._state.current.opacity}set opacity(ci){this._state.current.opacity=ci}get tint(){return this._state.current.tint}set tint(ci){this._state.current.tint=ci}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(ci){let hi=!0;return(ci.width>4096||ci.height>4096)&&(hi=!1),hi}constructor(ci){this._logger=Logger.getInstance(),this._renderers=new Map,this._lazyRenderersFactory=new Map,this.imageRenderer=Flags.isEnabled("use-legacy-image-renderer")?"ex.image":"ex.image-v2",this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new Pool(()=>new DrawCall,void 0,4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new TransformStack,this._state=new StateStack,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=Color.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new ExcaliburGraphicsContextWebGLDebug(this),this._totalPostProcessorTime=0;const{canvasElement:hi,context:_i,enableTransparency:pi,antialiasing:gi,uvPadding:mi,multiSampleAntialiasing:xi,pixelArtSampler:yi,powerPreference:Ci,snapToPixel:Ei,backgroundColor:Ai,useDrawSorting:ki,garbageCollector:Pi,handleContextLost:Ii,handleContextRestored:Di}=ci;if(this.__gl=_i??hi.getContext("webgl2",{antialias:gi??this.smoothing,premultipliedAlpha:!1,alpha:pi??this.transparency,depth:!1,powerPreference:Ci??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");Ii&&this.__gl.canvas.addEventListener("webglcontextlost",Ii,!1),Di&&this.__gl.canvas.addEventListener("webglcontextrestored",Di,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new TextureLoader(this.__gl,Pi),this.snapToPixel=Ei??this.snapToPixel,this.smoothing=gi??this.smoothing,this.transparency=pi??this.transparency,this.pixelArtSampler=yi??this.pixelArtSampler,this.uvPadding=mi??this.uvPadding,this.multiSampleAntialiasing=typeof xi=="boolean"?xi:this.multiSampleAntialiasing,this.samples=typeof xi=="object"?xi.samples:void 0,this.backgroundColor=Ai??this.backgroundColor,this.useDrawSorting=ki??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const ci of this._renderers.values())ci.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const ci=this.__gl;if(this._ortho=Matrix.ortho(0,ci.canvas.width,ci.canvas.height,0,400,-400),ci.viewport(0,0,ci.canvas.width,ci.canvas.height),ci.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),ci.clear(ci.COLOR_BUFFER_BIT),ci.enable(ci.BLEND),ci.blendEquation(ci.FUNC_ADD),ci.blendFunc(ci.ONE,ci.ONE_MINUS_SRC_ALPHA),ci.blendEquationSeparate(ci.FUNC_ADD,ci.FUNC_ADD),ci.blendFuncSeparate(ci.ONE,ci.ONE_MINUS_SRC_ALPHA,ci.ONE,ci.ONE_MINUS_SRC_ALPHA),ci.depthMask(!1),this.register(new ImageRenderer({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new MaterialRenderer),this.register(new RectangleRenderer),this.register(new CircleRenderer),this.register(new PointRenderer),this.register(new LineRenderer),this.lazyRegister("ex.particle",()=>new ParticleRenderer),this.register(new ImageRendererV2({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.materialScreenTexture=ci.createTexture(),!this.materialScreenTexture)throw new Error("Could not create screen texture!");ci.bindTexture(ci.TEXTURE_2D,this.materialScreenTexture),ci.texImage2D(ci.TEXTURE_2D,0,ci.RGBA,this.width,this.height,0,ci.RGBA,ci.UNSIGNED_BYTE,null),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_MIN_FILTER,ci.NEAREST),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_MAG_FILTER,ci.NEAREST),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_WRAP_S,ci.REPEAT),ci.texParameteri(ci.TEXTURE_2D,ci.TEXTURE_WRAP_T,ci.REPEAT),ci.bindTexture(ci.TEXTURE_2D,null),this._screenRenderer=new ScreenPassPainter(ci),this._renderTarget=new RenderTarget({gl:ci,transparency:this.transparency,width:ci.canvas.width,height:ci.canvas.height}),this._postProcessTargets=[new RenderTarget({gl:ci,transparency:this.transparency,width:ci.canvas.width,height:ci.canvas.height}),new RenderTarget({gl:ci,transparency:this.transparency,width:ci.canvas.width,height:ci.canvas.height})],this._msaaTarget=new RenderTarget({gl:ci,transparency:this.transparency,width:ci.canvas.width,height:ci.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(ci){this._renderers.set(ci.type,ci),ci.initialize(this.__gl,this)}lazyRegister(ci,hi){this._lazyRenderersFactory.set(ci,hi)}get(ci){let hi=this._renderers.get(ci);if(!hi){const _i=this._lazyRenderersFactory.get(ci);_i&&(this._logger.debug("lazy init renderer:",ci),hi=_i(),this.register(hi))}return hi}_isCurrentRenderer(ci){return!this._currentRenderer||this._currentRenderer===ci}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(ci,...hi){if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${ci}, the webgl context is lost`);return}const _i=this.get(ci);if(_i)if(this.useDrawSorting){const pi=this._drawCallPool.get();pi.z=this._state.current.z,pi.priority=_i.priority,pi.renderer=ci,this.getTransform().clone(pi.transform),pi.state.z=this._state.current.z,pi.state.opacity=this._state.current.opacity,pi.state.tint=this._state.current.tint,pi.state.material=this._state.current.material,pi.args[0]=hi[0],pi.args[1]=hi[1],pi.args[2]=hi[2],pi.args[3]=hi[3],pi.args[4]=hi[4],pi.args[5]=hi[5],pi.args[6]=hi[6],pi.args[7]=hi[7],pi.args[8]=hi[8],pi.args[9]=hi[9],this._drawCalls[this._drawCallIndex++]=pi}else this._currentRenderer||(this._currentRenderer=_i),this._isCurrentRenderer(_i)||this._currentRenderer.flush(),_i.draw(hi[0],hi[1],hi[2],hi[3],hi[4],hi[5],hi[6],hi[7],hi[8],hi[9]),this._currentRenderer=_i;else throw Error(`No renderer with name ${ci} has been registered`)}resetTransform(){this._transform.reset()}updateViewport(ci){const hi=this.__gl;this._ortho=this._ortho=Matrix.ortho(0,ci.width,ci.height,0,400,-400),this._renderTarget.setResolution(hi.canvas.width,hi.canvas.height),this._msaaTarget.setResolution(hi.canvas.width,hi.canvas.height),this._postProcessTargets[0].setResolution(hi.canvas.width,hi.canvas.height),this._postProcessTargets[1].setResolution(hi.canvas.width,hi.canvas.height)}_getImageWidth(ci){let hi=this._imageToWidth.get(ci);return hi===void 0&&(hi=ci.width,this._imageToWidth.set(ci,hi)),hi}_getImageHeight(ci){let hi=this._imageToHeight.get(ci);return hi===void 0&&(hi=ci.height,this._imageToHeight.set(ci,hi)),hi}drawImage(ci,hi,_i,pi,gi,mi,xi,yi,Ci){if(!(pi===0||gi===0)){{if(yi===0||Ci===0)return;if(this._getImageWidth(ci)===0||this._getImageHeight(ci)===0)return}if(!ci){Logger.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",ci,hi,_i,pi,gi,mi,xi,yi,Ci):this.imageRenderer==="ex.image"?this.draw(this.imageRenderer,ci,hi,_i,pi,gi,mi,xi,yi,Ci):this.draw(this.imageRenderer,ci,hi,_i,pi,gi,mi,xi,yi,Ci)}}drawLine(ci,hi,_i,pi=1){this.draw("ex.rectangle",ci,hi,_i,pi)}drawRectangle(ci,hi,_i,pi,gi,mi){this.draw("ex.rectangle",ci,hi,_i,pi,gi,mi)}drawCircle(ci,hi,_i,pi,gi){this.draw("ex.circle",ci,hi,_i,pi,gi)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(ci,hi){this._transform.translate(this.snapToPixel?~~(ci+pixelSnapEpsilon):ci,this.snapToPixel?~~(hi+pixelSnapEpsilon):hi)}rotate(ci){this._transform.rotate(ci)}scale(ci,hi){this._transform.scale(ci,hi)}transform(ci){this._transform.current=ci}getTransform(){return this._transform.current}multiply(ci){this._transform.current.multiply(ci,this._transform.current)}addPostProcessor(ci){this._postprocessors.push(ci),ci.initialize(this.__gl)}removePostProcessor(ci){const hi=this._postprocessors.indexOf(ci);hi!==-1&&this._postprocessors.splice(hi,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(ci){for(const hi of this._postprocessors){const _i=hi.getShader();_i.use();const pi=_i.getUniforms();this._totalPostProcessorTime+=ci,pi.find(gi=>gi.name==="u_time_ms")&&_i.setUniformFloat("u_time_ms",this._totalPostProcessorTime),pi.find(gi=>gi.name==="u_elapsed_ms")&&_i.setUniformFloat("u_elapsed_ms",ci),pi.find(gi=>gi.name==="u_resolution")&&_i.setUniformFloatVector("u_resolution",vec(this.width,this.height)),hi.onUpdate&&hi.onUpdate(ci)}}set material(ci){this._state.current.material=ci}get material(){return this._state.current.material}createMaterial(ci){return new Material({...ci,graphicsContext:this})}createShader(ci){const hi=this.__gl,{vertexSource:_i,fragmentSource:pi}=ci,gi=new Shader({gl:hi,vertexSource:_i,fragmentSource:pi});return gi.compile(),gi}clear(){const ci=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),ci.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),ci.clear(ci.COLOR_BUFFER_BIT)}flush(){var ci;if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let hi=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(hi.use(),this.useDrawSorting){for(let mi=this._drawCallIndex;mi<this._drawCalls.length;mi++)this._drawCalls[mi]=null;const _i=new Map;for(const[mi]of this._renderers){let xi=0;for(xi=0;xi<this._drawCallIndex&&this._drawCalls[xi].renderer!==mi;xi++);_i.set(mi,xi)}this._drawCalls.sort((mi,xi)=>{if(mi===null||xi===null)return 0;const yi=mi.z-xi.z,Ci=_i.get(mi.renderer)-_i.get(xi.renderer),Ei=mi.priority-xi.priority;return yi===0?Ei===0?Ci:Ei:yi});const pi=this._transform.current,gi=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let mi=this._drawCalls[0].renderer,xi=this.get(mi);for(let yi=0;yi<this._drawCallIndex;yi++)this._transform.current=this._drawCalls[yi].transform,this._state.current=this._drawCalls[yi].state,this._drawCalls[yi].renderer!==mi&&(xi.flush(),mi=this._drawCalls[yi].renderer,xi=this.get(mi)),xi instanceof MaterialRenderer&&(!((ci=this.material)===null||ci===void 0)&&ci.isUsingScreenTexture)&&(hi.copyToTexture(this.materialScreenTexture),hi.use()),xi.draw(...this._drawCalls[yi].args);xi.hasPendingDraws()&&xi.flush()}this._transform.current=pi,this._state.current=gi,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const _i of this._renderers.values())_i.hasPendingDraws()&&_i.flush();hi.disable(),this._postprocessors.length>0&&hi.toRenderSource().use();for(let _i=0;_i<this._postprocessors.length;_i++)hi=this._postProcessTargets[_i%2],this._postProcessTargets[_i%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[_i]),this._postProcessTargets[_i%2].toRenderSource().use();hi.blitToScreen()}}const ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon=1e-4;class ExcaliburGraphicsContext2DCanvasDebug{constructor(ci){this._ex=ci,this._debugText=new DebugText}drawRect(ci,hi,_i,pi){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(ci+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci,this._ex.snapToPixel?~~(hi+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi,this._ex.snapToPixel?~~(_i+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):_i,this._ex.snapToPixel?~~(pi+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):pi),this._ex.__ctx.restore()}drawLine(ci,hi,_i={color:Color.Black}){var pi,gi;this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=(gi=(pi=_i.color)===null||pi===void 0?void 0:pi.toString())!==null&&gi!==void 0?gi:"",this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(ci.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.x,this._ex.snapToPixel?~~(ci.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(hi.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi.x,this._ex.snapToPixel?~~(hi.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(ci,hi={color:Color.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=hi.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(ci.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.x,this._ex.snapToPixel?~~(ci.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.y,hi.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(ci,hi){this._debugText.write(this._ex,ci,hi)}}class ExcaliburGraphicsContext2DCanvas{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(ci){this._state.current.opacity=ci}get tint(){return this._state.current.tint}set tint(ci){this._state.current.tint=ci}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(ci){this.__ctx.imageSmoothingEnabled=ci}constructor(ci){this.useDrawSorting=!1,this.z=0,this.backgroundColor=Color.ExcaliburBlue,this._state=new StateStack,this.snapToPixel=!1,this.debug=new ExcaliburGraphicsContext2DCanvasDebug(this);const{canvasElement:hi,context:_i,enableTransparency:pi,snapToPixel:gi,antialiasing:mi,backgroundColor:xi}=ci;if(this.__ctx=_i??hi.getContext("2d",{alpha:pi??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=xi??this.backgroundColor,this.snapToPixel=gi??this.snapToPixel,this.smoothing=mi??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(ci){}drawImage(ci,hi,_i,pi,gi,mi,xi,yi,Ci){if(pi===0||gi===0)return;if(yi===0||Ci===0)return;if(ci.width===0||ci.height===0)return;this.__ctx.globalAlpha=this.opacity;const Ei=[ci,hi,_i,pi,gi,mi,xi,yi,Ci].filter(Ai=>Ai!==void 0).map(Ai=>typeof Ai=="number"&&this.snapToPixel?~~Ai:Ai);this.__ctx.drawImage.apply(this.__ctx,Ei),GraphicsDiagnostics.DrawCallCount++,GraphicsDiagnostics.DrawnImagesCount=1}drawLine(ci,hi,_i,pi=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=_i.toString(),this.__ctx.moveTo(this.snapToPixel?~~(ci.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.x,this.snapToPixel?~~(ci.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.y),this.__ctx.lineTo(this.snapToPixel?~~(hi.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi.x,this.snapToPixel?~~(hi.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi.y),this.__ctx.lineWidth=pi,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(ci,hi,_i,pi){this.__ctx.save(),this.__ctx.fillStyle=pi.toString(),this.__ctx.fillRect(this.snapToPixel?~~(ci.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.x,this.snapToPixel?~~(ci.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.y,this.snapToPixel?~~(hi+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi,this.snapToPixel?~~(_i+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):_i),this.__ctx.restore()}drawCircle(ci,hi,_i,pi,gi){this.__ctx.save(),this.__ctx.beginPath(),pi&&(this.__ctx.strokeStyle=pi.toString()),gi&&(this.__ctx.lineWidth=gi),this.__ctx.fillStyle=_i.toString(),this.__ctx.arc(this.snapToPixel?~~(ci.x+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.x,this.snapToPixel?~~(ci.y+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci.y,hi,0,Math.PI*2),this.__ctx.fill(),pi&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(ci,hi){this.__ctx.translate(this.snapToPixel?~~(ci+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):ci,this.snapToPixel?~~(hi+ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon):hi)}rotate(ci){this.__ctx.rotate(ci)}scale(ci,hi){this.__ctx.scale(ci,hi)}getTransform(){throw new Error("Not implemented")}multiply(ci){this.__ctx.setTransform(this.__ctx.getTransform().multiply(ci.toDOMMatrix()))}addPostProcessor(ci){}removePostProcessor(ci){}clearPostProcessors(){}updatePostProcessors(ci){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(ci){this._state.current.material=ci}get material(){return this._state.current.material}createMaterial(ci){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),GraphicsDiagnostics.clear()}flush(){}dispose(){this.__ctx=void 0}}var DisplayMode;(function(fi){fi.Fixed="Fixed",fi.FitContainerAndFill="FitContainerAndFill",fi.FitScreenAndFill="FitScreenAndFill",fi.FitContainerAndZoom="FitContainerAndZoom",fi.FitScreenAndZoom="FitScreenAndZoom",fi.FitScreen="FitScreen",fi.FillScreen="FillScreen",fi.FitContainer="FitContainer",fi.FillContainer="FillContainer"})(DisplayMode||(DisplayMode={}));class Resolution{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}const ScreenEvents={ScreenResize:"resize",PixelRatioChange:"pixelratio",FullScreenChange:"fullscreen"};class Screen{constructor(ci){var hi,_i,pi,gi;this.events=new EventEmitter,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullscreen=!1,this._isDisposed=!1,this._logger=Logger.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullscreen=!this._isFullscreen,this._logger.debug("Fullscreen Change",this._isFullscreen),this.events.emit("fullscreen",{fullscreen:this.isFullscreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const mi=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(mi),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new BoundingBox,this._unsafeArea=new BoundingBox,this.viewport=ci.viewport,this.resolution=(hi=ci.resolution)!==null&&hi!==void 0?hi:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(_i=ci.displayMode)!==null&&_i!==void 0?_i:DisplayMode.Fixed,this._canvas=ci.canvas,this.graphicsContext=ci.context,this._antialiasing=(pi=ci.antialiasing)!==null&&pi!==void 0?pi:this._antialiasing,this._canvasImageRendering=(gi=ci.canvasImageRendering)!==null&&gi!==void 0?gi:this._canvasImageRendering,this._browser=ci.browser,this._pixelRatioOverride=ci.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get worldToPagePixelRatio(){if(this._canvas){const ci=this.worldToPageCoordinates(Vector.Zero);return this.worldToPageCoordinates(vec(1,0)).sub(ci).x}else return 1}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(ci){this._pixelRatioOverride=ci}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case DisplayMode.FillContainer:case DisplayMode.FitContainer:case DisplayMode.FitContainerAndFill:case DisplayMode.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(ci){this._resolution=ci}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(ci){this._viewport=ci}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(ci){this._camera=ci}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof ExcaliburGraphicsContextWebGL&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let pi=Math.max(1,this.pixelRatio-.5),gi=!1;for(;pi>1&&!gi;){pi=Math.max(1,pi-.5);const mi=this._resolution.width*pi,xi=this._resolution.height*pi;gi=this.graphicsContext.checkIfResolutionSupported({width:mi,height:xi})}this.pixelRatioOverride=pi,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const ci=this.viewport.widthUnit==="percent"?"%":"px",hi=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+ci,this._canvas.style.height=this.viewport.height+hi,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof ExcaliburGraphicsContext2DCanvas&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio),document.documentElement.style.setProperty("--ex-pixel-ratio",this.worldToPagePixelRatio.toString())}get antialiasing(){return this._antialiasing}set antialiasing(ci){this._antialiasing=ci,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullscreen}get isFullscreen(){return this._isFullscreen}goFullScreen(ci){return this.enterFullscreen(ci)}enterFullscreen(ci){var hi,_i,pi,gi,mi,xi;if(ci){const yi=document.getElementById(ci);if(yi!=null&&yi.requestFullscreen||yi!=null&&yi.webkitRequestFullscreen){if(yi.getAttribute("ex-fullscreen-listener")||(yi.setAttribute("ex-fullscreen-listener","true"),yi.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),yi.requestFullscreen)return(hi=yi.requestFullscreen())!==null&&hi!==void 0?hi:Promise.resolve();if(yi.webkitRequestFullscreen)return(_i=yi.webkitRequestFullscreen())!==null&&_i!==void 0?_i:Promise.resolve()}}return!((pi=this._canvas)===null||pi===void 0)&&pi.requestFullscreen?(mi=(gi=this._canvas)===null||gi===void 0?void 0:gi.requestFullscreen())!==null&&mi!==void 0?mi:Promise.resolve():this._canvas.webkitRequestFullscreen?(xi=this._canvas.webkitRequestFullscreen())!==null&&xi!==void 0?xi:Promise.resolve():(this._logger.warnOnce("Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones"),Promise.resolve())}exitFullScreen(){return this.exitFullscreen()}exitFullscreen(){return document.exitFullscreen()}_viewportToPixels(ci){return{width:ci.widthUnit==="percent"?this.canvas.offsetWidth:ci.width,height:ci.heightUnit==="percent"?this.canvas.offsetHeight:ci.height}}pageToScreenCoordinates(ci){let hi=ci.x,_i=ci.y;this._isFullscreen||(hi-=getPosition(this._canvas).x,_i-=getPosition(this._canvas).y);const pi=this._viewportToPixels(this.viewport);if(this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const gi=window.innerWidth/this.aspectRatio,mi=(window.innerHeight-gi)/2;_i=(_i-mi)/gi*pi.height,hi=hi/window.innerWidth*pi.width}else{const gi=window.innerHeight*this.aspectRatio,mi=(window.innerWidth-gi)/2;hi=(hi-mi)/gi*pi.width,_i=_i/window.innerHeight*pi.height}return hi=hi/pi.width*this.resolution.width,_i=_i/pi.height*this.resolution.height,hi=hi-this.contentArea.left,_i=_i-this.contentArea.top,new Vector(hi,_i)}screenToPageCoordinates(ci){let hi=ci.x,_i=ci.y;const pi=this._viewportToPixels(this.viewport);if(hi=hi/this.resolution.width*pi.width,_i=_i/this.resolution.height*pi.height,this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const gi=window.innerWidth/this.aspectRatio,mi=(window.innerHeight-gi)/2;_i=_i/pi.height*gi+mi,hi=hi/pi.width*window.innerWidth}else{const gi=window.innerHeight*this.aspectRatio,mi=(window.innerWidth-gi)/2;hi=hi/pi.width*gi+mi,_i=_i/pi.height*window.innerHeight}return this._isFullscreen||(hi+=getPosition(this._canvas).x,_i+=getPosition(this._canvas).y),new Vector(hi,_i)}screenToWorldCoordinates(ci){return ci=ci.add(vec(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(ci):ci.sub(vec(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(ci){return this._camera?this._camera.transform.multiply(ci):ci.add(vec(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(ci){const hi=this.pageToScreenCoordinates(ci);return this.screenToWorldCoordinates(hi)}worldToPageCoordinates(ci){const hi=this.worldToScreenCoordinates(ci);return this.screenToPageCoordinates(hi)}getWorldBounds(){return BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Half).scale(vec(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Zero,Vector.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get width(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get height(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return vec(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const ci=this.aspectRatio;let hi=0,_i=0;window.innerWidth/ci<window.innerHeight?(hi=window.innerWidth,_i=window.innerWidth/ci):(hi=window.innerHeight*ci,_i=window.innerHeight),this.viewport={width:hi,height:_i},this._contentArea=BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Zero),this._unsafeArea=BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const ci=window.innerWidth,hi=window.innerHeight;this._computeFitAndFill(ci,hi),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(ci,hi,_i){if(this.viewport=_i??{width:ci,height:hi},ci/hi<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:ci*this._contentResolution.width/ci,height:ci*this._contentResolution.width/ci*hi/ci};const pi=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new BoundingBox({top:pi,left:0,right:this._contentResolution.width,bottom:this.resolution.height-pi}),this._unsafeArea=new BoundingBox({top:-pi,left:0,right:this._contentResolution.width,bottom:this.resolution.height+pi})}else{this.resolution={width:hi*this._contentResolution.height/hi*ci/hi,height:hi*this._contentResolution.height/hi};const pi=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new BoundingBox({top:0,left:pi,right:this.resolution.width-pi,bottom:this._contentResolution.height}),this._unsafeArea=new BoundingBox({top:0,left:-pi,right:this.resolution.width+pi,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const ci=window.innerWidth,hi=window.innerHeight;this._computeFitAndZoom(ci,hi),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const ci=this.canvas.parentElement;ci.style.overflow="hidden";const{offsetWidth:hi,offsetHeight:_i}=this.canvas;this._computeFitAndZoom(hi,_i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(ci,hi){const _i=this.aspectRatio;let pi=0,gi=0;ci/_i<hi?(pi=ci,gi=ci/_i):(pi=hi*_i,gi=hi);const mi=ci/pi,xi=hi/gi,yi=Math.max(mi,xi),Ci=pi*yi,Ei=gi*yi;Ci>ci?this.canvas.style.left=-(Ci-ci)/2+"px":this.canvas.style.left="",Ei>hi?this.canvas.style.top=-(Ei-hi)/2+"px":this.canvas.style.top="",this.viewport={width:Ci,height:Ei};const Ai=BoundingBox.fromDimension(this.viewport.width,this.viewport.height,Vector.Zero);if(this.viewport.width>ci){const ki=(this.viewport.width-ci)/this.viewport.width*this.resolution.width;Ai.top=0,Ai.left=ki/2,Ai.right=this.resolution.width-ki/2,Ai.bottom=this.resolution.height}if(this.viewport.height>hi){const ki=(this.viewport.height-hi)/this.viewport.height*this.resolution.height;Ai.top=ki/2,Ai.left=0,Ai.bottom=this.resolution.height-ki/2,Ai.right=this.resolution.width}this._contentArea=Ai}_computeFitContainer(){const ci=this.aspectRatio;let hi=0,_i=0,pi="pixel",gi="pixel";const mi=this.canvas.parentElement;mi.clientWidth/ci<mi.clientHeight?(this.canvas.style.width="100%",hi=100,pi="percent",_i=this.canvas.offsetWidth/ci):(this.canvas.style.height="100%",_i=100,gi="percent",hi=this.canvas.offsetHeight*ci),this.viewport={width:hi,widthUnit:pi,height:_i,heightUnit:gi},this._contentArea=BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(ci){this.displayMode===DisplayMode.FillContainer&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode===DisplayMode.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:ci.innerWidth,height:ci.innerHeight},this.viewport=this.resolution),this._contentArea=BoundingBox.fromDimension(this.resolution.width,this.resolution.height,Vector.Zero),this.displayMode===DisplayMode.FitScreen&&this._computeFit(),this.displayMode===DisplayMode.FitContainer&&this._computeFitContainer(),this.displayMode===DisplayMode.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===DisplayMode.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===DisplayMode.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===DisplayMode.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class AudioContextFactory{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}function isLegacyWebAudioSource(fi){return!!fi.playbackState}class WebAudio{static unlock(){return new Promise((hi,_i)=>{if(WebAudio._UNLOCKED||!AudioContextFactory.create())return hi(!0);const pi=setTimeout(()=>{Logger.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),hi(!1)},200),gi=AudioContextFactory.create();gi.resume().then(()=>{const mi=gi.createBuffer(1,1,22050),xi=gi.createBufferSource();let yi=!1;xi.buffer=mi,xi.connect(gi.destination),xi.onended=()=>yi=!0,xi.start(0),setTimeout(()=>{isLegacyWebAudioSource(xi)?(xi.playbackState===xi.PLAYING_STATE||xi.playbackState===xi.FINISHED_STATE)&&(WebAudio._UNLOCKED=!0):(gi.currentTime>0||yi)&&(WebAudio._UNLOCKED=!0)},0),clearTimeout(pi),hi(!0)},()=>{_i()})})}static isUnlocked(){return this._UNLOCKED}}WebAudio._UNLOCKED=!1;let Canvas$1=class eu extends Raster{get ctx(){return this._ctx}constructor(ci={}){super(ci),this._options=ci}clone(){return new eu({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(ci){var hi,_i;!((hi=this._options)===null||hi===void 0)&&hi.draw&&((_i=this._options)===null||_i===void 0||_i.draw(ci)),this._options.cache||this.flagDirty()}};class ExResponse{}ExResponse.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class StateMachine{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(ci){this._currentState=ci}static create(ci,hi){const _i=new StateMachine;_i.data=hi;for(const pi in ci.states)_i.states.set(pi,{name:pi,...ci.states[pi]});for(const pi of _i.states.values())for(const gi of pi.transitions)if(gi!=="*"&&!_i.states.has(gi))throw Error(`Invalid state machine, state [${pi.name}] has a transition to another state that doesn't exist [${gi}]`);return _i.currentState=_i.startState=_i.states.get(ci.start),_i}in(ci){return this.currentState.name===ci}go(ci,hi){var _i,pi;if(this.currentState.transitions.includes(ci)||this.currentState.transitions.includes("*")){const gi=this.states.get(ci);return this.currentState.onExit&&((_i=this.currentState)===null||_i===void 0?void 0:_i.onExit({to:gi.name,data:this.data}))===!1||gi!=null&&gi.onEnter&&(gi==null?void 0:gi.onEnter({from:this.currentState.name,eventData:hi,data:this.data}))===!1?!1:(this.currentState=gi,!((pi=this.currentState)===null||pi===void 0)&&pi.onState&&this.currentState.onState(),!0)}return!1}update(ci){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,ci)}save(ci){localStorage.setItem(ci,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(ci){const hi=JSON.parse(localStorage.getItem(ci));this.currentState=this.states.get(hi.currentState),this.data=hi.data}}class WebAudioInstance{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(ci){this._loop=ci,this._instance&&(this._instance.loop=ci,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(ci){ci=clamp(ci,0,1),this._volume=ci,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(ci,this._audioContext.currentTime,.1):this._volumeNode.gain.value=ci}get volume(){return this._volume}get duration(){var ci;return(ci=this._duration)!==null&&ci!==void 0?ci:this.getTotalPlaybackDuration()}set duration(ci){this._duration=ci}constructor(ci){this._src=ci,this._audioContext=AudioContextFactory.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new Future,this._stateMachine=StateMachine.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:hi})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,hi.pausedAt*this._playbackRate):this._instance.start(0,hi.pausedAt*this._playbackRate,this.duration),hi.startedAt=this._audioContext.currentTime-hi.pausedAt,hi.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:hi})=>{hi==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:hi,data:_i})=>{_i.pausedAt=(hi??0)/this._playbackRate,_i.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:hi})=>{hi.pausedAt=0,hi.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:hi})=>{hi.pausedAt=this._audioContext.currentTime-hi.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(ci=()=>{}){return this._playStarted=ci,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(ci){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",ci)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:ci,startedAt:hi}=this._stateMachine.data;return ci?ci*this._playbackRate:hi?(this._audioContext.currentTime-hi)*this._playbackRate:0}set playbackRate(ci){this._instance.playbackRate.value=this._playbackRate=ci}get playbackRate(){return this._instance.playbackRate.value}}class MediaEvent extends GameEvent{set bubbles(ci){}get bubbles(){return!1}get _path(){return null}set _path(ci){}constructor(ci,hi="MediaEvent"){super(),this.target=ci,this._name=hi}stopPropagation(){}action(){}propagate(){}layPath(ci){}}class NativeSoundEvent extends MediaEvent{constructor(ci,hi){super(ci,"NativeSoundEvent"),this.track=hi}}class NativeSoundProcessedEvent extends MediaEvent{constructor(ci,hi){super(ci,"NativeSoundProcessedEvent"),this._processedData=hi,this.data=this._processedData}}function canPlayFile(fi){try{const ci=new Audio,hi=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,_i=fi.match(hi)[1];return!!ci.canPlayType("audio/"+_i)}catch(ci){return Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",ci),!1}}const SoundEvents={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class Sound{set loop(ci){this._loop=ci;for(const hi of this._tracks)hi.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(ci){this._volume=ci;for(const hi of this._tracks)hi.volume=this._volume;this.events.emit("volumechange",new NativeSoundEvent(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(ci){this._duration=ci}get instances(){return this._tracks}get path(){return this._resource.path}set path(ci){this._resource.path=ci}get bustCache(){return this._resource.bustCache}set bustCache(ci){this._resource.bustCache=ci}constructor(...ci){this.events=new EventEmitter,this.logger=Logger.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=AudioContextFactory.create(),this._resource=new Resource("",ExResponse.type.arraybuffer);for(const hi of ci)if(canPlayFile(hi)){this.path=hi;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",ci.join(", ")),this.logger.warn("Attempting to use",ci[0]),this.path=ci[0])}isLoaded(){return!!this.data}async load(){var ci,hi;if(this.data)return this.data;const _i=await this._resource.load(),pi=await this.decodeAudio(_i.slice(0));return this._duration=(hi=(ci=this._duration)!==null&&ci!==void 0?ci:pi==null?void 0:pi.duration)!==null&&hi!==void 0?hi:void 0,this.events.emit("processed",new NativeSoundProcessedEvent(this,pi)),this.data=pi}async decodeAudio(ci){try{return await this._audioContext.decodeAudioData(ci.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(ci){ci&&(this._engine=ci,this._engine.on("hidden",()=>{ci.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{ci.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(ci=>ci.isPlaying())}isPaused(){return this._tracks.some(ci=>ci.isPaused())}isStopped(){return this._tracks.some(ci=>ci.isStopped())}play(ci){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=ci||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const ci of this._tracks)ci.pause();this.events.emit("pause",new NativeSoundEvent(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const ci of this._tracks)ci.stop();this.events.emit("stop",new NativeSoundEvent(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(ci){this._playbackRate=ci,this._tracks.forEach(hi=>{hi.playbackRate=this._playbackRate})}seek(ci,hi=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[hi].seek(ci)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(ci=0){return this._tracks.length?this._tracks[ci].getPlaybackPosition():0}getTrackId(ci){return this._tracks.indexOf(ci)}async _resumePlayback(){if(this.isPaused()){const ci=[];for(const hi of this._tracks)ci.push(hi.play().then(()=>(this._tracks.splice(this.getTrackId(hi),1),!0)));this.events.emit("resume",new NativeSoundEvent(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(ci)}return!0}async _startPlayback(){const ci=this._getTrackInstance(this.data),hi=await ci.play(()=>{this.events.emit("playbackstart",new NativeSoundEvent(this,ci)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new NativeSoundEvent(this,ci));const _i=this.getTrackId(ci);return _i!==-1&&this._tracks.splice(_i,1),hi}_getTrackInstance(ci){var hi;const _i=new WebAudioInstance(ci);return _i.loop=this.loop,_i.volume=this.volume,_i.duration=(hi=this.duration)!==null&&hi!==void 0?hi:0,_i.playbackRate=this._playbackRate,this._tracks.push(_i),_i}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}}const LoaderEvents={BeforeLoad:"beforeload",AfterLoad:"afterload",UserAction:"useraction",LoadResourceStart:"loadresourcestart",LoadResourceEnd:"loadresourceend"};function isLoaderConstructor(fi){var ci,hi;return!!(fi!=null&&fi.prototype)&&!!(!((hi=(ci=fi==null?void 0:fi.prototype)===null||ci===void 0?void 0:ci.constructor)===null||hi===void 0)&&hi.name)}class DefaultLoader{get resources(){return this._resources}constructor(ci){var hi;this.events=new EventEmitter,this.canvas=new Canvas$1({filtering:ImageFiltering.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new Future,ci&&(!((hi=ci.loadables)===null||hi===void 0)&&hi.length)&&this.addResources(ci.loadables)}onInitialize(ci){this.engine=ci,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await delay(500,this.engine.clock)}addResource(ci){this._resources.push(ci)}addResources(ci){let hi=0;const _i=ci.length;for(hi;hi<_i;hi++)this.addResource(ci[hi])}markResourceComplete(){this._numLoaded++}get progress(){const ci=this._resources.length;return ci>0?clamp(this._numLoaded,0,ci)/ci:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(ci,hi){this._totalTimeMs+=hi}onDraw(ci){const hi=this._totalTimeMs/1e3;ci.fillStyle=Color.Black.toRGBA(),ci.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),ci.save(),ci.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const _i=hi*10;ci.strokeStyle="white",ci.lineWidth=10,ci.lineCap="round",ci.arc(0,0,40,_i,_i+Math.PI*3/2),ci.stroke(),ci.fillStyle="white",ci.font="16px sans-serif";const pi=(this.progress*100).toFixed(0)+"%",gi=ci.measureText(pi),mi=Math.abs(gi.actualBoundingBoxLeft)+Math.abs(gi.actualBoundingBoxRight),xi=Math.abs(gi.actualBoundingBoxAscent)+Math.abs(gi.actualBoundingBoxDescent);ci.fillText(pi,-mi/2,xi/2),ci.restore()}areResourcesLoaded(){return this._resources.length===0?Promise.resolve():this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async ci=>{this.events.emit("loadresourcestart",ci),await ci.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",ci)})}));for(const ci of this._resources)ci instanceof Sound&&ci.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await WebAudio.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}}const Loader_logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var Director_Loader=__webpack_require__(851);class Loader extends DefaultLoader{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const ci=document.getElementById("excalibur-play-root");return ci&&(this._playButtonRootElement=ci),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(ci){const hi=Array.isArray(ci)?{loadables:ci}:ci;super(hi),this._logger=Logger.getInstance(),this._originalOptions={loadables:[]},this.events=new EventEmitter,this._playButtonShown=!1,this.logo=Loader_logo,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=Color.White,this.backgroundColor="#176BAA",this._imageLoaded=new Future,this.suppressPlayButton=!1,this._playButtonStyles=Director_Loader.A.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let _i=document.getElementById("excalibur-play");return _i||(_i=document.createElement("button")),_i.id="excalibur-play",_i.textContent=this.playButtonText,_i.style.display="none",_i},this._originalOptions={...Loader._DEFAULT_LOADER_OPTIONS,...hi}}onInitialize(ci){this.engine=ci,this.screen=ci.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var ci,hi;if(this.suppressPlayButton)this.hidePlayButton(),await delay(500,(ci=this.engine)===null||ci===void 0?void 0:ci.clock);else{const _i=()=>{try{this._positionPlayButton()}catch{}};return!((hi=this.engine)===null||hi===void 0)&&hi.browser&&this.engine.browser.window.on("resize",_i),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",gi=>{gi.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(gi=>{const mi=xi=>{var yi;if(xi.stopPropagation(),this.hidePlayButton(),!((yi=this.engine)===null||yi===void 0)&&yi.browser&&this.engine.browser.window.off("resize",_i),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer)}catch(Ci){this._logger.error("could not go fullscreen",Ci)}gi()};this._playButton.addEventListener("click",mi),this._playButton.addEventListener("touchend",mi),this._playButton.addEventListener("pointerup",mi),this.engine&&this.engine.input.gamepads.once("button",()=>mi(new Event("button")))})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var ci;await delay(200,(ci=this.engine)===null||ci===void 0?void 0:ci.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){this.screen.pushResolutionAndViewport(),this.screen.resolution={width:this.canvas.width,height:this.canvas.height},this.screen.applyResolutionAndViewport();const ci=this._image;await this._imageLoaded.promise,await(ci==null?void 0:ci.decode())}async onAfterLoad(){this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:ci,y:hi,width:_i,height:pi}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const gi=this._playButton.clientWidth,mi=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${ci+_i/2-gi/2}px`,this._playButtonRootElement.style.top=`${hi+pi/2-mi/2+100}px`)}}}onDraw(ci){const hi=this.engine.canvasHeight/this.engine.pixelRatio,_i=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),ci.fillStyle=this.backgroundColor,ci.fillRect(0,0,_i,hi);let pi=hi/2;const gi=Math.min(this.logoWidth,_i*.75);let mi=_i/2-gi/2;this.logoPosition&&(mi=this.logoPosition.x,pi=this.logoPosition.y);const xi=Math.floor(gi*(this.logoHeight/this.logoWidth)),yi=this.engine.screen.antialiasing;if(this.engine.screen.antialiasing=!0,this.logoPosition?ci.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,mi,pi,gi,xi):ci.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,mi,pi-xi-20,gi,xi),!this.suppressPlayButton&&this._playButtonShown){this.engine.screen.antialiasing=yi;return}let Ci=mi,Ei=pi;this.loadingBarPosition&&(Ci=this.loadingBarPosition.x,Ei=this.loadingBarPosition.y),ci.lineWidth=2,roundRect(ci,Ci,Ei,gi,20,10,this.loadingBarColor);const Ai=gi*this.progress,ki=5,Pi=Ai-ki*2,Ii=20-ki*2;roundRect(ci,Ci+ki,Ei+ki,Pi>10?Pi:10,Ii,5,null,this.loadingBarColor),this.engine.screen.antialiasing=yi}}Loader._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};const REPORTED_FEATURES={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Detector{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const ci=document.createElement("canvas");return!!(ci.getContext&&ci.getContext("2d"))},arrayBufferSupport:function(){const ci=new XMLHttpRequest;ci.open("GET","/");try{ci.responseType="arraybuffer"}catch{return!1}return ci.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const ci=document.createElement("a").style;return ci.cssText="background-color:rgba(150,255,150,.5)",(""+ci.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const ci=document.createElement("canvas");return!!(ci.getContext&&ci.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let ci=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const hi=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],_i=this.getBrowserFeatures();for(const pi of Object.keys(REPORTED_FEATURES))_i[pi]?(ci+="(%c%c)",hi.push("font-weight: bold; color: green"),hi.push("font-weight: normal; color: inherit")):(ci+="(%c%c)",hi.push("font-weight: bold; color: red"),hi.push("font-weight: normal; color: inherit")),ci+=" "+REPORTED_FEATURES[pi]+`
`;hi.unshift(ci),console.log.apply(console,hi)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let ci=!1;for(const hi in this._criticalTests)this._criticalTests[hi].call(this)||(this.failedTests.push(hi),Logger.getInstance().error("Critical browser feature missing, Excalibur requires:",hi),ci=!0);if(ci)return!1;for(const hi in this._warningTest)this._warningTest[hi]()||Logger.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",hi);return!0}}var CollisionType;(function(fi){fi.PreventCollision="PreventCollision",fi.Passive="Passive",fi.Active="Active",fi.Fixed="Fixed"})(CollisionType||(CollisionType={}));class CollisionGroupManager{static create(ci,hi){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(ci)){const pi=this._GROUPS.get(ci);if(pi.mask===hi)return pi;throw new Error(`Collision group ${ci} already exists with a different mask!`)}const _i=new CollisionGroup(ci,this._CURRENT_BIT,hi!==void 0?hi:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(ci,_i),_i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(ci){return this._GROUPS.get(ci)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}CollisionGroupManager._STARTING_BIT=1;CollisionGroupManager._MAX_GROUPS=32;CollisionGroupManager._CURRENT_GROUP=1;CollisionGroupManager._CURRENT_BIT=CollisionGroupManager._STARTING_BIT;CollisionGroupManager._GROUPS=new Map;class CollisionGroup{constructor(ci,hi,_i){this._name=ci,this._category=hi,this._mask=_i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(ci){const hi=this.category&ci.mask,_i=this.mask&ci.category;return hi!==0&&_i!==0}invert(){const ci=CollisionGroupManager.create("~("+this.name+")",~this.mask|0);return ci._category=~this.category,ci}static combine(ci){const hi=ci.map(gi=>gi.name).join("+"),pi=~ci.reduce((gi,mi)=>mi.category|gi,0);return CollisionGroupManager.create(hi,pi)}static collidesWith(ci){const hi=`collidesWith(${ci.map(pi=>pi.name).join("+")})`,_i=ci.reduce((pi,gi)=>gi.category|pi,0);return CollisionGroupManager.create(hi,_i)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}}CollisionGroup.All=new CollisionGroup("Collide with all groups",-1,-1);class Pair{constructor(ci,hi){this.colliderA=ci,this.colliderB=hi,this.id=null,this.id=Pair.calculatePairHash(ci.id,hi.id)}static canCollide(ci,hi){var _i,pi;if(ci.id===hi.id||ci.owner&&hi.owner&&ci.owner.id===hi.owner.id||ci.localBounds.hasZeroDimensions()||hi.localBounds.hasZeroDimensions())return!1;const gi=(_i=ci==null?void 0:ci.owner)===null||_i===void 0?void 0:_i.get(BodyComponent),mi=(pi=hi==null?void 0:hi.owner)===null||pi===void 0?void 0:pi.get(BodyComponent);return!(!gi||!mi||!gi.group.canCollide(mi.group)||gi.collisionType===CollisionType.Fixed&&mi.collisionType===CollisionType.Fixed||mi.collisionType===CollisionType.PreventCollision||gi.collisionType===CollisionType.PreventCollision||!gi.isActive||!mi.isActive)}get canCollide(){const ci=this.colliderA,hi=this.colliderB;return Pair.canCollide(ci,hi)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(ci){return ci===this.colliderA||ci===this.colliderB}static calculatePairHash(ci,hi){return ci.value<hi.value?`#${ci.value}+${hi.value}`:`#${hi.value}+${ci.value}`}}class Projection{constructor(ci,hi){this.min=ci,this.max=hi}overlaps(ci){return this.max>ci.min&&ci.max>this.min}getOverlap(ci){return this.overlaps(ci)?this.max>ci.max?ci.max-this.min:this.max-ci.min:0}}class TreeNode{constructor(ci){this.parent=ci,this.parent=ci||null,this.data=null,this.bounds=new BoundingBox,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class DynamicTree{constructor(ci,hi=new BoundingBox(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=ci,this.worldBounds=hi,this.root=null,this.nodes={}}_insert(ci){if(this.root===null){this.root=ci,this.root.parent=null;return}const hi=ci.bounds;let _i=this.root;for(;!_i.isLeaf();){const xi=_i.left,yi=_i.right,Ci=_i.bounds.getPerimeter(),Ai=_i.bounds.combine(hi).getPerimeter(),ki=2*Ai,Pi=2*(Ai-Ci);let Ii=0;const Di=hi.combine(xi.bounds);let Fi,Li;xi.isLeaf()?Ii=Di.getPerimeter()+Pi:(Li=xi.bounds.getPerimeter(),Fi=Di.getPerimeter(),Ii=Fi-Li+Pi);let Bi=0;const Ri=hi.combine(yi.bounds);if(yi.isLeaf()?Bi=Ri.getPerimeter()+Pi:(Li=yi.bounds.getPerimeter(),Fi=Ri.getPerimeter(),Bi=Fi-Li+Pi),ki<Ii&&ki<Bi)break;Ii<Bi?_i=xi:_i=yi}const pi=_i.parent,gi=new TreeNode(pi);gi.bounds=hi.combine(_i.bounds),gi.height=_i.height+1,pi!==null?(pi.left===_i?pi.left=gi:pi.right=gi,gi.left=_i,gi.right=ci,_i.parent=gi,ci.parent=gi):(gi.left=_i,gi.right=ci,_i.parent=gi,ci.parent=gi,this.root=gi);let mi=ci.parent;for(;mi;){if(mi=this._balance(mi),!mi.left)throw new Error("Parent of current leaf cannot have a null left child"+mi);if(!mi.right)throw new Error("Parent of current leaf cannot have a null right child"+mi);mi.height=1+Math.max(mi.left.height,mi.right.height),mi.bounds=mi.left.bounds.combine(mi.right.bounds),mi=mi.parent}}_remove(ci){if(ci===this.root){this.root=null;return}const hi=ci.parent,_i=hi.parent;let pi;if(hi.left===ci?pi=hi.right:pi=hi.left,_i){_i.left===hi?_i.left=pi:_i.right=pi,pi.parent=_i;let gi=_i;for(;gi;)gi=this._balance(gi),gi.bounds=gi.left.bounds.combine(gi.right.bounds),gi.height=1+Math.max(gi.left.height,gi.right.height),gi=gi.parent}else this.root=pi,pi.parent=null}trackCollider(ci){const hi=new TreeNode;hi.data=ci,hi.bounds=ci.bounds,hi.bounds.left-=2,hi.bounds.top-=2,hi.bounds.right+=2,hi.bounds.bottom+=2,this.nodes[ci.id.value]=hi,this._insert(hi)}updateCollider(ci){var hi;const _i=this.nodes[ci.id.value];if(!_i)return!1;const pi=ci.bounds;if(!this.worldBounds.contains(pi))return Logger.getInstance().warn("Collider with id "+ci.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(ci),!1;if(_i.bounds.contains(pi))return!1;if(this._remove(_i),pi.left-=this._config.boundsPadding,pi.top-=this._config.boundsPadding,pi.right+=this._config.boundsPadding,pi.bottom+=this._config.boundsPadding,ci.owner){const gi=(hi=ci.owner)===null||hi===void 0?void 0:hi.get(BodyComponent);if(gi){const mi=gi.vel.x*32/1e3*this._config.velocityMultiplier,xi=gi.vel.y*32/1e3*this._config.velocityMultiplier;mi<0?pi.left+=mi:pi.right+=mi,xi<0?pi.top+=xi:pi.bottom+=xi}}return _i.bounds=pi,this._insert(_i),!0}untrackCollider(ci){const hi=this.nodes[ci.id.value];hi&&(this._remove(hi),this.nodes[ci.id.value]=null,delete this.nodes[ci.id.value])}_balance(ci){if(ci===null)throw new Error("Cannot balance at null node");if(ci.isLeaf()||ci.height<2)return ci;const hi=ci.left,_i=ci.right,pi=ci,gi=hi,mi=_i,xi=hi.left,yi=hi.right,Ci=_i.left,Ei=_i.right,Ai=mi.height-gi.height;if(Ai>1)return mi.left=pi,mi.parent=pi.parent,pi.parent=mi,mi.parent?mi.parent.left===pi?mi.parent.left=mi:mi.parent.right=mi:this.root=mi,Ci.height>Ei.height?(mi.right=Ci,pi.right=Ei,Ei.parent=pi,pi.bounds=gi.bounds.combine(Ei.bounds),mi.bounds=pi.bounds.combine(Ci.bounds),pi.height=1+Math.max(gi.height,Ei.height),mi.height=1+Math.max(pi.height,Ci.height)):(mi.right=Ei,pi.right=Ci,Ci.parent=pi,pi.bounds=gi.bounds.combine(Ci.bounds),mi.bounds=pi.bounds.combine(Ei.bounds),pi.height=1+Math.max(gi.height,Ci.height),mi.height=1+Math.max(pi.height,Ei.height)),mi;if(Ai<-1){if(gi.left=pi,gi.parent=pi.parent,pi.parent=gi,gi.parent)if(gi.parent.left===pi)gi.parent.left=gi;else{if(gi.parent.right!==pi)throw"Error rotating Dynamic Tree";gi.parent.right=gi}else this.root=gi;return xi.height>yi.height?(gi.right=xi,pi.left=yi,yi.parent=pi,pi.bounds=mi.bounds.combine(yi.bounds),gi.bounds=pi.bounds.combine(xi.bounds),pi.height=1+Math.max(mi.height,yi.height),gi.height=1+Math.max(pi.height,xi.height)):(gi.right=yi,pi.left=xi,xi.parent=pi,pi.bounds=mi.bounds.combine(xi.bounds),gi.bounds=pi.bounds.combine(yi.bounds),pi.height=1+Math.max(mi.height,xi.height),gi.height=1+Math.max(pi.height,yi.height)),gi}return ci}getHeight(){return this.root===null?0:this.root.height}query(ci,hi){const _i=ci.bounds,pi=gi=>{if(gi&&gi.bounds.overlaps(_i))if(gi.isLeaf()&&gi.data!==ci){if(hi.call(ci,gi.data))return!0}else return pi(gi.left)||pi(gi.right);return!1};pi(this.root)}rayCastQuery(ci,hi=1/0,_i){const pi=gi=>{if(gi&&gi.bounds.rayCast(ci,hi))if(gi.isLeaf()){if(_i.call(ci,gi.data))return!0}else return pi(gi.left)||pi(gi.right);return!1};pi(this.root)}getNodes(){const ci=hi=>hi?[hi].concat(ci(hi.left),ci(hi.right)):[];return ci(this.root)}debug(ci){const hi=_i=>{_i&&(_i.isLeaf()?_i.bounds.draw(ci,Color.Green):_i.bounds.draw(ci,Color.White),_i.left&&hi(_i.left),_i.right&&hi(_i.right))};hi(this.root)}}class Ray{constructor(ci,hi){this.pos=ci,this.dir=hi.normalize()}intersect(ci){const hi=ci.begin.sub(this.pos);if(this.dir.cross(ci.getSlope())===0&&hi.cross(this.dir)!==0)return-1;const _i=this.dir.cross(ci.getSlope());if(_i===0)return-1;const pi=hi.cross(ci.getSlope())/_i;if(pi>=0){const gi=hi.cross(this.dir)/_i/ci.getLength();if(gi>=0&&gi<=1)return pi}return-1}intersectPoint(ci){const hi=this.intersect(ci);return hi<0?null:this.getPoint(hi)}getPoint(ci){return this.pos.add(this.dir.scale(ci))}}class DynamicTreeCollisionProcessor{constructor(ci){this._config=ci,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new DynamicTree(ci.dynamicTree)}getColliders(){return this._colliders}query(ci){const hi=[];return ci instanceof BoundingBox?this._dynamicCollisionTree.query({id:createId("collider",-1),owner:null,bounds:ci},_i=>(hi.push(_i),!1)):this._dynamicCollisionTree.query({id:createId("collider",-1),owner:null,bounds:new BoundingBox(ci.x,ci.y,ci.x,ci.y)},_i=>(hi.push(_i),!1)),hi}rayCast(ci,hi){var _i,pi,gi;const mi=[],xi=(_i=hi==null?void 0:hi.maxDistance)!==null&&_i!==void 0?_i:1/0,yi=hi==null?void 0:hi.collisionGroup,Ci=yi?yi.category:(pi=hi==null?void 0:hi.collisionMask)!==null&&pi!==void 0?pi:CollisionGroup.All.category,Ei=(gi=hi==null?void 0:hi.searchAllColliders)!==null&&gi!==void 0?gi:!1;return this._dynamicCollisionTree.rayCastQuery(ci,xi,Ai=>{const Pi=Ai.owner.get(BodyComponent);if(hi!=null&&hi.ignoreCollisionGroupAll&&Pi.group===CollisionGroup.All)return!1;const Ii=(Ci&Pi.group.category)!==0;if(Pi!=null&&Pi.group&&!Ii)return!1;const Di=Ai.rayCast(ci,xi);if(Di){if(hi!=null&&hi.filter){if(hi.filter(Di)&&(mi.push(Di),!Ei))return!0}else if(mi.push(Di),!Ei)return!0}return!1}),mi}track(ci){if(!ci){Logger.getInstance().warn("Cannot track null collider");return}if(ci instanceof CompositeCollider){const hi=ci.getColliders();for(const _i of hi)_i.owner=ci.owner,this._colliders.push(_i),this._dynamicCollisionTree.trackCollider(_i)}else this._colliders.push(ci),this._dynamicCollisionTree.trackCollider(ci)}untrack(ci){if(!ci){Logger.getInstance().warn("Cannot untrack a null collider");return}if(ci instanceof CompositeCollider){const hi=ci.getColliders();for(const _i of hi){const pi=this._colliders.indexOf(_i);pi!==-1&&this._colliders.splice(pi,1),this._dynamicCollisionTree.untrackCollider(_i)}}else{const hi=this._colliders.indexOf(ci);hi!==-1&&this._colliders.splice(hi,1),this._dynamicCollisionTree.untrackCollider(ci)}}_pairExists(ci,hi){const _i=Pair.calculatePairHash(ci.id,hi.id);return this._pairs.has(_i)}broadphase(ci,hi,_i){const pi=hi/1e3,gi=ci.filter(xi=>{var yi,Ci;const Ei=(yi=xi.owner)===null||yi===void 0?void 0:yi.get(BodyComponent);return((Ci=xi.owner)===null||Ci===void 0?void 0:Ci.isActive)&&Ei.collisionType!==CollisionType.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let mi;for(let xi=0,yi=gi.length;xi<yi;xi++)mi=gi[xi],this._dynamicCollisionTree.query(mi,Ci=>{if(!this._pairExists(mi,Ci)&&Pair.canCollide(mi,Ci)){const Ei=new Pair(mi,Ci);this._pairs.add(Ei.id),this._collisionPairCache.push(Ei)}return!1});if(_i&&(_i.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const xi of gi){const yi=xi.owner.get(BodyComponent);if(yi.collisionType!==CollisionType.Active)continue;const Ci=yi.vel.magnitude*pi+yi.acc.magnitude*.5*pi*pi,Ei=Math.min(xi.bounds.height,xi.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||Ci>Ei/2){_i&&_i.physics.fastBodies++;const Ai=yi.globalPos.sub(yi.oldPos),ki=xi.center,Pi=xi.getFurthestPoint(yi.vel),Ii=Pi.sub(Ai),Di=new Ray(Ii,yi.vel);Di.pos=Di.pos.add(Di.dir.scale(-2*this._config.continuous.surfaceEpsilon));let Fi,Li=new Vector(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(Di,Ci+this._config.continuous.surfaceEpsilon*2,Bi=>{if(!this._pairExists(xi,Bi)&&Pair.canCollide(xi,Bi)){const Ri=Bi.rayCast(Di,Ci+this._config.continuous.surfaceEpsilon*10);if(Ri){const $i=Ri.point.sub(Ii);$i.magnitude<Li.magnitude&&(Li=$i,Fi=Bi)}}return!1}),Fi&&Vector.isValid(Li)){const Bi=new Pair(xi,Fi);this._pairs.has(Bi.id)||(this._pairs.add(Bi.id),this._collisionPairCache.push(Bi));const Ri=ki.sub(Pi);yi.globalPos=Ii.add(Ri).add(Li).add(Di.dir.scale(10*this._config.continuous.surfaceEpsilon)),xi.update(yi.transform.get()),_i&&_i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(ci,hi){let _i=[];for(let pi=0;pi<ci.length;pi++){const gi=ci[pi].collide();if(_i=_i.concat(gi),hi&&gi.length>0)for(const mi of gi)hi.physics.contacts.set(mi.id,mi)}return hi&&(hi.physics.collisions+=_i.length),_i}update(ci){let hi=0;const _i=ci.length;for(let pi=0;pi<_i;pi++)this._dynamicCollisionTree.updateCollider(ci[pi])&&hi++;return hi}debug(ci){this._dynamicCollisionTree.debug(ci)}}class Collider{constructor(){this.id=createId("collider",Collider._ID++),this.composite=null,this.events=new EventEmitter,this.offset=Vector.Zero}touching(ci){return!!this.collide(ci)}}Collider._ID=0;var SolverStrategy;(function(fi){fi.Arcade="arcade",fi.Realistic="realistic"})(SolverStrategy||(SolverStrategy={}));var ContactSolveBias;(function(fi){fi.None="none",fi.VerticalFirst="vertical-first",fi.HorizontalFirst="horizontal-first"})(ContactSolveBias||(ContactSolveBias={}));const VerticalFirst={vertical:1,horizontal:2},HorizontalFirst={horizontal:1,vertical:2},None={horizontal:0,vertical:0};var SpatialPartitionStrategy;(function(fi){fi.DynamicTree="dynamic-tree",fi.SparseHashGrid="sparse-hash-grid"})(SpatialPartitionStrategy||(SpatialPartitionStrategy={}));const getDefaultPhysicsConfig=()=>({enabled:!0,gravity:vec(0,0).clone(),solver:SolverStrategy.Arcade,substep:1,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},spatialPartition:SpatialPartitionStrategy.SparseHashGrid,sparseHashGrid:{size:100},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:ContactSolveBias.None},realistic:{contactSolveBias:ContactSolveBias.None,positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}});class CompositeCollider extends Collider{set compositeStrategy(ci){this._compositeStrategy=ci}get compositeStrategy(){return this._compositeStrategy}constructor(ci){super(),this._collisionProcessor=new DynamicTreeCollisionProcessor({...getDefaultPhysicsConfig()}),this._dynamicAABBTree=new DynamicTree({boundsPadding:5,velocityMultiplier:2}),this._colliders=[];for(const hi of ci)this.addCollider(hi)}clearColliders(){this._colliders=[]}addCollider(ci){let hi;ci instanceof CompositeCollider?(hi=ci.getColliders(),hi.forEach(_i=>_i.offset.addEqual(ci.offset))):hi=[ci];for(const _i of hi)_i.events.pipe(this.events),_i.composite=this,this._colliders.push(_i),this._collisionProcessor.track(_i),this._dynamicAABBTree.trackCollider(_i)}removeCollider(ci){ci.events.pipe(this.events),ci.composite=null,removeItemFromArray(ci,this._colliders),this._collisionProcessor.untrack(ci),this._dynamicAABBTree.untrackCollider(ci)}getColliders(){return this._colliders}get worldPos(){var ci,hi;return((hi=(ci=this._transform)===null||ci===void 0?void 0:ci.pos)!==null&&hi!==void 0?hi:Vector.Zero).add(this.offset)}get center(){var ci,hi;return((hi=(ci=this._transform)===null||ci===void 0?void 0:ci.pos)!==null&&hi!==void 0?hi:Vector.Zero).add(this.offset)}get bounds(){var ci,hi;const _i=this.getColliders();return _i.reduce((gi,mi)=>gi.combine(mi.bounds),(hi=(ci=_i[0])===null||ci===void 0?void 0:ci.bounds)!==null&&hi!==void 0?hi:new BoundingBox().translate(this.worldPos)).translate(this.offset)}get localBounds(){var ci,hi;const _i=this.getColliders();return _i.reduce((gi,mi)=>gi.combine(mi.localBounds),(hi=(ci=_i[0])===null||ci===void 0?void 0:ci.localBounds)!==null&&hi!==void 0?hi:new BoundingBox)}get axes(){const ci=this.getColliders();let hi=[];for(const _i of ci)hi=hi.concat(_i.axes);return hi}getFurthestPoint(ci){const hi=this.getColliders(),_i=[];for(const mi of hi)_i.push(mi.getFurthestPoint(ci));let pi=_i[0],gi=-Number.MAX_VALUE;for(const mi of _i){const xi=mi.dot(ci);xi>gi&&(pi=mi,gi=xi)}return pi}getInertia(ci){const hi=this.getColliders();let _i=0;for(const pi of hi)_i+=pi.getInertia(ci);return _i}collide(ci){let hi=[ci];ci instanceof CompositeCollider&&(hi=ci.getColliders());const _i=[];for(const gi of hi)this._dynamicAABBTree.query(gi,mi=>(_i.push(new Pair(gi,mi)),!1));let pi=[];for(const gi of _i)pi=pi.concat(gi.collide());return pi}getClosestLineBetween(ci){const hi=this.getColliders(),_i=[];if(ci instanceof CompositeCollider){const pi=ci.getColliders();for(const gi of hi)for(const mi of pi){const xi=gi.getClosestLineBetween(mi);xi&&_i.push(xi)}}else for(const pi of hi){const gi=ci.getClosestLineBetween(pi);gi&&_i.push(gi)}if(_i.length){let pi=_i[0].getLength(),gi=_i[0];for(const mi of _i){const xi=mi.getLength();xi<pi&&(pi=xi,gi=mi)}return gi}return null}contains(ci){const hi=this.getColliders();for(const _i of hi)if(_i.contains(ci))return!0;return!1}rayCast(ci,hi){const _i=this.getColliders(),pi=[];for(const gi of _i){const mi=gi.rayCast(ci,hi);mi&&pi.push(mi)}if(pi.length){let gi=pi[0],mi=gi.point.dot(ci.dir);for(const xi of pi){const yi=ci.dir.dot(xi.point);yi<mi&&(gi=xi,mi=yi)}return gi}return null}project(ci){const hi=this.getColliders(),_i=[];for(const pi of hi){const gi=pi.project(ci);gi&&_i.push(gi)}if(_i.length){const pi=new Projection(_i[0].min,_i[0].max);for(const gi of _i)pi.min=Math.min(gi.min,pi.min),pi.max=Math.max(gi.max,pi.max);return pi}return null}update(ci){if(ci){const hi=this.getColliders();for(const _i of hi)_i.owner=this.owner,_i.update(ci)}}debug(ci,hi,_i){const pi=this.getColliders();ci.save(),ci.translate(this.offset.x,this.offset.y);for(const gi of pi)gi.debug(ci,hi,_i);ci.restore()}clone(){const ci=new CompositeCollider(this._colliders.map(hi=>hi.clone()));return ci.offset=this.offset.clone(),ci}}class LineSegment{constructor(ci,hi){this.begin=ci,this.end=hi}clone(ci){const hi=ci||new LineSegment(this.begin.clone(),this.end.clone());return hi.begin=this.begin.clone(hi.begin),hi.end=this.end.clone(hi.end),hi}transform(ci,hi){const _i=hi||new LineSegment(Vector.Zero,Vector.Zero);return _i.begin=ci.multiply(this.begin,_i.begin),_i.end=ci.multiply(this.end,_i.end),_i}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const ci=this.begin,hi=this.end,_i=ci.distance(hi);return this._slope=hi.sub(ci).scale(1/_i)}getEdge(){const ci=this.begin;return this.end.sub(ci)}getLength(){const ci=this.begin,hi=this.end;return ci.distance(hi)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new LineSegment(this.end,this.begin)}below(ci){return(this.end.x-this.begin.x)*(ci.y-this.begin.y)-(this.end.y-this.begin.y)*(ci.x-this.begin.x)>=0}clip(ci,hi,_i=!0){let pi=ci;_i&&(pi=pi.normalize());const gi=pi.dot(this.begin)-hi,mi=pi.dot(this.end)-hi,xi=[];if(gi<=0&&xi.push(this.begin),mi<=0&&xi.push(this.end),gi*mi<0){const yi=gi/(gi-mi);xi.push(this.begin.add(this.end.sub(this.begin).scale(yi)))}return xi.length!==2?null:new LineSegment(xi[0],xi[1])}distanceToPoint(ci,hi=!1){const _i=ci.x,pi=ci.y,gi=this.getLength(),mi=this.end.y-this.begin.y,xi=this.end.x-this.begin.x,yi=(mi*_i-xi*pi+this.end.x*this.begin.y-this.end.y*this.begin.x)/gi;return hi?yi:Math.abs(yi)}findVectorToPoint(ci){const hi=this.begin.sub(ci),_i=this.getSlope();return hi.sub(_i.scale(hi.dot(_i)))}findPoint(ci=null,hi=null){const _i=this.slope,pi=this.intercept;if(ci!==null)return new Vector(ci,_i*ci+pi);if(hi!==null)return new Vector((hi-pi)/_i,hi);throw new Error("You must provide an X or a Y value")}hasPoint(){let ci,hi=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")ci=new Vector(arguments[0],arguments[1]),hi=arguments[2]||0;else if(arguments[0]instanceof Vector)ci=arguments[0],hi=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const _i=ci.x-this.begin.x,pi=ci.y-this.begin.y,gi=this.end.x-this.begin.x,mi=this.end.y-this.begin.y,xi=_i*mi-pi*gi;return Math.abs(xi)>hi?!1:Math.abs(gi)>=Math.abs(mi)?gi>0?this.begin.x<=ci.x&&ci.x<=this.end.x:this.end.x<=ci.x&&ci.x<=this.begin.x:mi>0?this.begin.y<=ci.y&&ci.y<=this.end.y:this.end.y<=ci.y&&ci.y<=this.begin.y}}function ClosestLine(fi,ci){const _i=fi.dir(),pi=ci.dir(),gi=_i.dot(_i),mi=pi.dot(pi);if(gi<1e-9&&mi<1e-9)return new LineSegment(fi.begin,ci.begin);if(gi<1e-9){const Fi=clamp(pi.dot(fi.begin.sub(ci.begin))/mi,0,1),Li=ci.begin.add(pi.scale(Fi));return new LineSegment(fi.begin,Li)}if(mi<1e-9){const Fi=clamp(_i.dot(ci.begin.sub(fi.begin))/gi,0,1),Li=fi.begin.add(_i.scale(Fi));return new LineSegment(Li,ci.begin)}const xi=fi.begin.sub(ci.begin),yi=gi,Ci=mi,Ei=pi.dot(xi),Ai=yi*Ci-Math.pow(_i.dot(pi),2);let ki=0,Pi=0;Math.abs(Ai)>1e-9?ki=clamp((_i.dot(pi)*Ei-Ci*_i.dot(xi))/Ai,0,1):ki=clamp(_i.dot(xi)/yi,0,1),Math.abs(Ci)>1e-9?Pi=clamp((_i.dot(pi)*ki+Ei)/Ci,0,1):Pi=0;const Ii=fi.begin.add(_i.scale(ki)),Di=ci.begin.add(pi.scale(Pi));return new LineSegment(Ii,Di)}const ClosestLineJumpTable={PolygonPolygonClosestLine(fi,ci){const hi=fi.getSides(),_i=ci.getSides();let pi=Number.MAX_VALUE,gi=null;for(let mi=0;mi<hi.length;mi++)for(let xi=0;xi<_i.length;xi++){const yi=ClosestLine(hi[mi],_i[xi]),Ci=yi.getLength();Ci<pi&&(pi=Ci,gi=yi)}return gi},PolygonEdgeClosestLine(fi,ci){const _i=ci.worldPos.sub(fi.worldPos),pi=new Ray(fi.worldPos,_i),gi=fi.rayCast(pi).point.add(pi.dir.scale(.1)),mi=fi.getClosestFace(gi),xi=ci.asLine();return ClosestLine(mi.face,xi)},PolygonCircleClosestLine(fi,ci){const hi=ci.worldPos,_i=hi.sub(fi.worldPos),pi=new Ray(fi.worldPos,_i.normalize()),gi=fi.rayCast(pi).point.add(pi.dir.scale(.1)),mi=fi.getClosestFace(gi),xi=mi.face.begin,yi=mi.face.getEdge();let Ci=(yi.x*(hi.x-xi.x)+yi.y*(hi.y-xi.y))/(yi.x*yi.x+yi.y*yi.y);Ci>1?Ci=1:Ci<0&&(Ci=0);const Ei=Math.sqrt(Math.pow(xi.x+yi.x*Ci-hi.x,2)+Math.pow(xi.y+yi.y*Ci-hi.y,2))-ci.radius,Ai=(xi.x+yi.x*Ci-hi.x)*ci.radius/(ci.radius+Ei),ki=(xi.y+yi.y*Ci-hi.y)*ci.radius/(ci.radius+Ei);return new LineSegment(yi.scale(Ci).add(xi),new Vector(hi.x+Ai,hi.y+ki))},CircleCircleClosestLine(fi,ci){const _i=ci.worldPos.sub(fi.worldPos),gi=fi.worldPos.sub(ci.worldPos),mi=new Ray(fi.worldPos,_i),xi=new Ray(ci.worldPos,gi),yi=fi.rayCast(mi),Ci=ci.rayCast(xi);return new LineSegment(yi.point,Ci.point)},CircleEdgeClosestLine(fi,ci){const hi=fi.worldPos,_i=ci.asLine(),pi=_i.begin,gi=_i.getEdge(),mi=pi,xi=gi;let yi=(xi.x*(hi.x-mi.x)+xi.y*(hi.y-mi.y))/(xi.x*xi.x+xi.y*xi.y);yi>1?yi=1:yi<0&&(yi=0);const Ci=Math.sqrt(Math.pow(mi.x+xi.x*yi-hi.x,2)+Math.pow(mi.y+xi.y*yi-hi.y,2))-fi.radius,Ei=(mi.x+xi.x*yi-hi.x)*fi.radius/(fi.radius+Ci),Ai=(mi.y+xi.y*yi-hi.y)*fi.radius/(fi.radius+Ci);return new LineSegment(xi.scale(yi).add(mi),new Vector(hi.x+Ei,hi.y+Ai))},EdgeEdgeClosestLine(fi,ci){const hi=fi.asLine(),_i=ci.asLine();return ClosestLine(hi,_i)}};class CircleCollider extends Collider{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var ci;if(this._radius)return this._radius;const hi=this._transform,_i=(ci=hi==null?void 0:hi.globalScale)!==null&&ci!==void 0?ci:Vector.One;return this._radius=this._naturalRadius*Math.min(_i.x,_i.y)}set radius(ci){var hi;const _i=this._transform,pi=(hi=_i==null?void 0:_i.globalScale)!==null&&hi!==void 0?hi:Vector.One;this._naturalRadius=ci/Math.min(pi.x,pi.y),this._localBoundsDirty=!0,this._radius=ci}constructor(ci){super(),this.offset=Vector.Zero,this._globalMatrix=AffineMatrix.identity(),this._localBoundsDirty=!0,this.offset=ci.offset||Vector.Zero,this.radius=ci.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new CircleCollider({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(ci){var hi,_i;return((_i=(hi=this._transform)===null||hi===void 0?void 0:hi.pos)!==null&&_i!==void 0?_i:this.offset).distance(ci)<=this.radius}rayCast(ci,hi=1/0){var _i,pi;const gi=this.center,mi=ci.dir,xi=ci.pos,yi=gi.sub(xi),Ci=mi.scale(yi.dot(mi)),Ai=yi.sub(Ci).magnitude;if(Ai>this.radius)return null;{let ki=0;if(approximatelyEqual(Ai,this.radius,1e-4)){if(ki=-mi.dot(xi.sub(gi)),ki>0&&ki<hi){const Pi=ci.getPoint(ki);return{point:Pi,normal:Pi.sub(gi).normalize(),collider:this,body:(_i=this.owner)===null||_i===void 0?void 0:_i.get(BodyComponent),distance:ki}}return null}else{const Pi=Math.sqrt(Math.pow(mi.dot(xi.sub(gi)),2)-Math.pow(xi.sub(gi).distance(),2)+Math.pow(this.radius,2)),Ii=-mi.dot(xi.sub(gi))+Pi,Di=-mi.dot(xi.sub(gi))-Pi,Fi=[];Ii>=0&&Fi.push(Ii),Di>=0&&Fi.push(Di);const Li=Math.min(...Fi);if(Li<=hi){const Bi=ci.getPoint(Li);return{point:Bi,normal:Bi.sub(gi).normalize(),collider:this,body:(pi=this.owner)===null||pi===void 0?void 0:pi.get(BodyComponent),distance:Li}}return null}}}getClosestLineBetween(ci){if(ci instanceof CircleCollider)return ClosestLineJumpTable.CircleCircleClosestLine(this,ci);if(ci instanceof PolygonCollider)return ClosestLineJumpTable.PolygonCircleClosestLine(ci,this).flip();if(ci instanceof EdgeCollider)return ClosestLineJumpTable.CircleEdgeClosestLine(this,ci).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof ci}`)}collide(ci){if(ci instanceof CircleCollider)return CollisionJumpTable.CollideCircleCircle(this,ci);if(ci instanceof PolygonCollider)return CollisionJumpTable.CollideCirclePolygon(this,ci);if(ci instanceof EdgeCollider)return CollisionJumpTable.CollideCircleEdge(this,ci);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof ci}`)}getFurthestPoint(ci){return this.center.add(ci.normalize().scale(this.radius))}getFurthestLocalPoint(ci){return ci.normalize().scale(this.radius)}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=new BoundingBox(-this._naturalRadius,-this._naturalRadius,+this._naturalRadius,+this._naturalRadius),this._localBoundsDirty=!1),this._localBounds}get axes(){return[]}getInertia(ci){return ci*this.radius*this.radius/2}update(ci){var hi;this._transform=ci,((hi=ci.matrix)!==null&&hi!==void 0?hi:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y),this._radius=void 0}project(ci){const hi=[],pi=this.center.dot(ci);return hi.push(pi),hi.push(pi+this.radius),hi.push(pi-this.radius),new Projection(Math.min.apply(Math,hi),Math.max.apply(Math,hi))}debug(ci,hi,_i){var pi,gi,mi,xi;const{lineWidth:yi}={lineWidth:1,..._i},Ci=this._transform,Ei=(pi=Ci==null?void 0:Ci.globalScale)!==null&&pi!==void 0?pi:Vector.One,Ai=(gi=Ci==null?void 0:Ci.globalRotation)!==null&&gi!==void 0?gi:0,ki=(mi=Ci==null?void 0:Ci.globalPos)!==null&&mi!==void 0?mi:Vector.Zero;ci.save(),ci.translate(ki.x,ki.y),ci.rotate(Ai),ci.scale(Ei.x,Ei.y),ci.drawCircle((xi=this.offset)!==null&&xi!==void 0?xi:Vector.Zero,this._naturalRadius,Color.Transparent,hi,yi),ci.restore()}}class CollisionContact{constructor(ci,hi,_i,pi,gi,mi,xi,yi){var Ci,Ei,Ai,ki,Pi,Ii;if(this._canceled=!1,this.bodyA=null,this.bodyB=null,this.colliderA=ci,this.colliderB=hi,this.mtv=_i,this.normal=pi,this.tangent=gi,this.points=mi,this.localPoints=xi,this.info=yi,this.id=Pair.calculatePairHash(ci.id,hi.id),ci.composite||hi.composite){const Di=((Ci=ci.composite)===null||Ci===void 0?void 0:Ci.compositeStrategy)==="separate"?ci.id:(Ai=(Ei=ci.composite)===null||Ei===void 0?void 0:Ei.id)!==null&&Ai!==void 0?Ai:ci.id,Fi=((ki=hi.composite)===null||ki===void 0?void 0:ki.compositeStrategy)==="separate"?hi.id:(Ii=(Pi=hi.composite)===null||Pi===void 0?void 0:Pi.id)!==null&&Ii!==void 0?Ii:hi.id;this.id+="|"+Pair.calculatePairHash(Di,Fi)}this.colliderA.owner&&(this.bodyA=this.colliderA.owner.get(BodyComponent)),this.colliderB.owner&&(this.bodyB=this.colliderB.owner.get(BodyComponent))}matchAwake(){const ci=this.bodyA,hi=this.bodyB;ci&&hi&&ci.isSleeping!==hi.isSleeping&&(ci.isSleeping&&ci.collisionType!==CollisionType.Fixed&&hi.sleepMotion>=ci.wakeThreshold&&(ci.isSleeping=!1),hi.isSleeping&&hi.collisionType!==CollisionType.Fixed&&ci.sleepMotion>=hi.wakeThreshold&&(hi.isSleeping=!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}bias(ci){if(ci!==this.colliderA&&ci!==this.colliderB)throw new Error("Collider must be either colliderA or colliderB from this contact");if(ci===this.colliderA)return this;const hi=this.colliderA,_i=this.colliderB;return this.colliderB=hi,this.colliderA=_i,this.mtv=this.mtv.negate(),this.normal=this.normal.negate(),this.tangent=this.tangent.negate(),this}}class SeparationInfo{constructor(){this.axis=vec(0,0),this.localAxis=vec(0,0),this.side=new LineSegment(vec(0,0),vec(0,0)),this.localSide=new LineSegment(vec(0,0),vec(0,0)),this.point=vec(0,0),this.localPoint=vec(0,0)}}class SeparatingAxis{static findPolygonPolygonSeparation(ci,hi){if(hi.transform.matrix.determinant()===0)return SeparatingAxis.findPolygonPolygonSeparationDegenerate(ci,hi);let _i=-Number.MAX_VALUE,pi=-1,gi;const mi=hi.transform.inverse.multiply(ci.transform.matrix,SeparatingAxis._SCRATCH_MATRIX),xi=mi.getRotation(),yi=ci.normals,Ci=ci.points,Ei=hi.points;for(let Pi=0;Pi<Ci.length;Pi++){const Ii=yi[Pi].rotate(xi,SeparatingAxis._ZERO,SeparatingAxis._SCRATCH_NORMAL),Di=mi.multiply(Ci[Pi],SeparatingAxis._SCRATCH_POINT);let Fi=Number.MAX_VALUE,Li;for(let Bi=0;Bi<Ei.length;Bi++){const Ri=Ii.dot(Ei[Bi].sub(Di,SeparatingAxis._SCRATCH_SUB_POINT));Ri<Fi&&(Fi=Ri,Li=Ei[Bi])}Fi>_i&&(_i=Fi,pi=Pi,gi=Li)}const Ai=(pi+1)%Ci.length,ki=SeparatingAxis.SeparationPool.get();return ki.collider=ci,ki.separation=_i,_i>0||(yi[pi].clone(ki.localAxis),yi[pi].rotate(ci.transform.rotation,SeparatingAxis._ZERO,ki.axis),ci.transform.matrix.multiply(Ci[pi],ki.side.begin),ci.transform.matrix.multiply(Ci[Ai],ki.side.end),hi.transform.matrix.multiply(gi,ki.point),ki.sideId=pi,gi.clone(ki.localPoint),Ci[pi].clone(ki.localSide.begin),Ci[Ai].clone(ki.localSide.end)),ki}static findCirclePolygonSeparation(ci,hi){const _i=hi.axes,gi=hi.center.sub(ci.worldPos),mi=hi.getFurthestPoint(gi.negate());_i.push(mi.sub(ci.worldPos).normalize());let xi=Number.MAX_VALUE,yi=null,Ci=-1;for(let Ei=0;Ei<_i.length;Ei++){const Ai=hi.project(_i[Ei]),ki=ci.project(_i[Ei]),Pi=Ai.getOverlap(ki);if(Pi<=0)return null;Pi<xi&&(xi=Pi,yi=_i[Ei],Ci=Ei)}return Ci<0?null:yi.normalize().scale(xi)}static findPolygonPolygonSeparationDegenerate(ci,hi){let _i=-Number.MAX_VALUE,pi=null,gi=null,mi=-1,xi=null;const yi=ci.getSides(),Ci=ci.getLocalSides();for(let Ei=0;Ei<yi.length;Ei++){const Ai=yi[Ei],ki=Ai.normal(),Pi=hi.getFurthestPoint(ki.negate()),Ii=Ai.distanceToPoint(Pi,!0);Ii>_i&&(_i=Ii,pi=Ai,gi=ki,mi=Ei,xi=Pi)}return{collider:ci,separation:gi?_i:99,axis:gi,side:pi,localSide:Ci[mi],sideId:mi,point:xi,localPoint:gi?hi.getFurthestLocalPoint(gi.negate()):null}}}SeparatingAxis.SeparationPool=new Pool(()=>new SeparationInfo,fi=>fi,500);SeparatingAxis._ZERO=vec(0,0);SeparatingAxis._SCRATCH_POINT=vec(0,0);SeparatingAxis._SCRATCH_SUB_POINT=vec(0,0);SeparatingAxis._SCRATCH_NORMAL=vec(0,0);SeparatingAxis._SCRATCH_MATRIX=AffineMatrix.identity();SeparatingAxis.SeparationPool.disableWarnings=!0;const ScratchZero=Vector.Zero,ScratchNormal=Vector.Zero,ScratchMatrix=AffineMatrix.identity(),CollisionJumpTable={CollideCircleCircle(fi,ci){const hi=fi.worldPos,_i=ci.worldPos,pi=fi.radius+ci.radius,gi=hi.distance(_i);if(gi>pi)return[];const mi=pi-gi,xi=_i.sub(hi).normalize(),yi=xi.perpendicular(),Ci=xi.scale(mi),Ei=fi.getFurthestPoint(xi),Ai=fi.getFurthestLocalPoint(xi),ki={collider:fi,separation:mi,axis:xi,point:Ei};return[new CollisionContact(fi,ci,Ci,xi,yi,[Ei],[Ai],ki)]},CollideCirclePolygon(fi,ci){var hi,_i;let pi=SeparatingAxis.findCirclePolygonSeparation(fi,ci);if(!pi)return[];pi=pi.dot(ci.center.sub(fi.center))<0?pi.negate():pi;const mi=fi.getFurthestPoint(pi),yi=((_i=(hi=fi.owner)===null||hi===void 0?void 0:hi.get(TransformComponent))!==null&&_i!==void 0?_i:new TransformComponent).applyInverse(mi),Ci=pi.normalize(),Ei={collider:fi,separation:-pi.magnitude,axis:Ci,point:mi,localPoint:yi,side:ci.findSide(Ci.negate()),localSide:ci.findLocalSide(Ci.negate())};return[new CollisionContact(fi,ci,pi,Ci,Ci.perpendicular(),[mi],[yi],Ei)]},CollideCircleEdge(fi,ci){const hi=fi.center,_i=ci.asLine(),pi=_i.end.sub(_i.begin),gi=pi.dot(_i.end.sub(hi)),mi=pi.dot(hi.sub(_i.begin)),xi=ci.asLine(),yi=ci.asLocalLine();if(mi<=0){const Li=_i.begin.sub(hi),Bi=Li.dot(Li);if(Bi>fi.radius*fi.radius)return[];const Ri=Li.normalize(),$i=fi.radius-Math.sqrt(Bi),Ni={collider:fi,separation:$i,axis:Ri,point:xi.begin,side:xi,localSide:yi};return[new CollisionContact(fi,ci,Ri.scale($i),Ri,Ri.perpendicular(),[xi.begin],[yi.begin],Ni)]}if(gi<=0){const Li=_i.end.sub(hi),Bi=Li.dot(Li);if(Bi>fi.radius*fi.radius)return[];const Ri=Li.normalize(),$i=fi.radius-Math.sqrt(Bi),Ni={collider:fi,separation:$i,axis:Ri,point:xi.end,side:xi,localSide:yi};return[new CollisionContact(fi,ci,Ri.scale($i),Ri,Ri.perpendicular(),[xi.end],[yi.end],Ni)]}const Ci=pi.dot(pi),Ei=_i.begin.scale(gi).add(_i.end.scale(mi)).scale(1/Ci),Ai=hi.sub(Ei),ki=Ai.dot(Ai);if(ki>fi.radius*fi.radius)return[];let Pi=pi.perpendicular();Pi.dot(hi.sub(_i.begin))<0&&(Pi.x=-Pi.x,Pi.y=-Pi.y),Pi=Pi.normalize();const Ii=fi.radius-Math.sqrt(ki),Di=Pi.scale(Ii),Fi={collider:fi,separation:Ii,axis:Pi,point:Ei,side:xi,localSide:yi};return[new CollisionContact(fi,ci,Di,Pi.negate(),Pi.negate().perpendicular(),[Ei],[Ei.sub(ci.worldPos)],Fi)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(fi,ci){var hi;const _i=fi.center,gi=ci.center.sub(_i).normalize(),mi=new PolygonCollider({points:[ci.begin,ci.end,ci.end.add(gi.scale(100)),ci.begin.add(gi.scale(100))],offset:ci.offset});mi.owner=ci.owner,((hi=ci.owner)===null||hi===void 0?void 0:hi.get(TransformComponent))&&mi.update(ci.owner.get(TransformComponent).get());const yi=this.CollidePolygonPolygon(fi,mi);return yi.length&&(yi[0].colliderB=ci,yi[0].id=Pair.calculatePairHash(fi.id,ci.id)),yi},CollidePolygonPolygon(fi,ci){const hi=SeparatingAxis.findPolygonPolygonSeparation(fi,ci);if(hi.separation>0)return[];const _i=SeparatingAxis.findPolygonPolygonSeparation(ci,fi);if(_i.separation>0)return[];const pi=hi.separation>_i.separation?hi:_i,gi=pi.collider===fi?ci:fi,mi=pi.collider===fi?fi:ci,xi=gi.transform.inverse.multiply(mi.transform.matrix,ScratchMatrix),yi=xi.getRotation(),Ci=mi.normals[pi.sideId].rotate(yi,ScratchZero,ScratchNormal);let Ei=Number.MAX_VALUE,Ai=0;for(let Li=0;Li<gi.normals.length;Li++){const Bi=Ci.dot(gi.normals[Li]);Bi<Ei&&(Ei=Bi,Ai=Li)}if(!pi.localSide||!pi.localAxis||!pi.axis)return[];const ki=pi.localSide.transform(xi),Pi=pi.localAxis.perpendicular().negate().rotate(yi),Di=new LineSegment(gi.points[Ai],gi.points[(Ai+1)%gi.points.length]).clip(Pi.negate(),-Pi.dot(ki.begin),!1);let Fi=null;if(Di&&(Fi=Di.clip(Pi,Pi.dot(ki.end),!1)),Fi){const Li=[],Bi=[],Ri=Fi.getPoints();for(let ji=0;ji<Ri.length;ji++){const Ui=Ri[ji];ki.below(Ui)&&(Li.push(Ui),Bi.push(gi.transform.apply(Ui)))}let $i=pi.axis,Ni=$i.perpendicular();return ci.center.sub(fi.center).dot($i)<0&&($i=$i.negate(),Ni=$i.perpendicular()),[new CollisionContact(fi,ci,$i.scale(-pi.separation),$i,Ni,Bi,Li,pi)]}return[]},FindContactSeparation(fi,ci){var hi,_i,pi,gi;const mi=fi.colliderA,xi=(_i=(hi=fi.bodyA)===null||hi===void 0?void 0:hi.transform)!==null&&_i!==void 0?_i:new TransformComponent,yi=fi.colliderB,Ci=(gi=(pi=fi.bodyB)===null||pi===void 0?void 0:pi.transform)!==null&&gi!==void 0?gi:new TransformComponent;if(mi instanceof CircleCollider&&yi instanceof CircleCollider){const Ei=mi.radius+yi.radius,Ai=xi.pos.distance(Ci.pos);return-(Ei-Ai)}if(mi instanceof PolygonCollider&&yi instanceof PolygonCollider&&fi.info.localSide){let Ei,Ai;return fi.info.collider===mi?(Ei=new LineSegment(xi.apply(fi.info.localSide.begin).add(mi.offset),xi.apply(fi.info.localSide.end).add(mi.offset)),Ai=Ci.apply(ci).add(yi.offset)):(Ei=new LineSegment(Ci.apply(fi.info.localSide.begin).add(yi.offset),Ci.apply(fi.info.localSide.end).add(yi.offset)),Ai=xi.apply(ci).add(mi.offset)),Ei.distanceToPoint(Ai,!0)}if(mi instanceof PolygonCollider&&yi instanceof CircleCollider||yi instanceof PolygonCollider&&mi instanceof CircleCollider){const Ei=xi.apply(ci);if(fi.info.side)return fi.info.side.distanceToPoint(Ei,!0)}if(mi instanceof EdgeCollider&&yi instanceof PolygonCollider||yi instanceof EdgeCollider&&mi instanceof PolygonCollider){let Ei;if(fi.info.collider===mi?Ei=Ci.apply(ci):Ei=xi.apply(ci),fi.info.side)return fi.info.side.distanceToPoint(Ei,!0)}if(mi instanceof CircleCollider&&yi instanceof EdgeCollider||yi instanceof CircleCollider&&mi instanceof EdgeCollider){const Ei=Ci.apply(ci);let Ai;mi instanceof CircleCollider&&(Ai=mi.getFurthestPoint(fi.normal));const ki=Ei.distance(Ai);if(fi.info.side)return ki>0?-ki:0}return 0}};class EdgeCollider extends Collider{constructor(ci){var hi;super(),this._globalMatrix=AffineMatrix.identity(),this.begin=ci.begin||Vector.Zero,this.end=ci.end||Vector.Zero,this.offset=(hi=ci.offset)!==null&&hi!==void 0?hi:Vector.Zero}clone(){return new EdgeCollider({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var ci;const hi=this._transform;return(ci=hi==null?void 0:hi.globalPos.add(this.offset))!==null&&ci!==void 0?ci:this.offset}get center(){const ci=this._getTransformedBegin(),hi=this._getTransformedEnd();return ci.average(hi)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const ci=this._getTransformedBegin(),hi=this._getTransformedEnd(),_i=ci.distance(hi);return hi.sub(ci).scale(1/_i)}getLength(){const ci=this._getTransformedBegin(),hi=this._getTransformedEnd();return ci.distance(hi)}contains(){return!1}rayCast(ci,hi=1/0){var _i;const pi=this._getTransformedBegin().sub(ci.pos);if(ci.dir.cross(this.getSlope())===0&&pi.cross(ci.dir)!==0)return null;const gi=ci.dir.cross(this.getSlope());if(gi===0)return null;const mi=pi.cross(this.getSlope())/gi;if(mi>=0&&mi<=hi){const xi=pi.cross(ci.dir)/gi/this.getLength();if(xi>=0&&xi<=1)return{distance:mi,normal:this.asLine().normal(),collider:this,body:(_i=this.owner)===null||_i===void 0?void 0:_i.get(BodyComponent),point:ci.getPoint(mi)}}return null}getClosestLineBetween(ci){if(ci instanceof CircleCollider)return ClosestLineJumpTable.CircleEdgeClosestLine(ci,this);if(ci instanceof PolygonCollider)return ClosestLineJumpTable.PolygonEdgeClosestLine(ci,this).flip();if(ci instanceof EdgeCollider)return ClosestLineJumpTable.EdgeEdgeClosestLine(this,ci);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof ci}`)}collide(ci){if(ci instanceof CircleCollider)return CollisionJumpTable.CollideCircleEdge(ci,this);if(ci instanceof PolygonCollider)return CollisionJumpTable.CollidePolygonEdge(ci,this);if(ci instanceof EdgeCollider)return CollisionJumpTable.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof ci}`)}getFurthestPoint(ci){const hi=this._getTransformedBegin(),_i=this._getTransformedEnd();return ci.dot(hi)>0?hi:_i}_boundsFromBeginEnd(ci,hi,_i=10){return new BoundingBox(Math.min(ci.x,hi.x)-_i,Math.min(ci.y,hi.y)-_i,Math.max(ci.x,hi.x)+_i,Math.max(ci.y,hi.y)+_i)}get bounds(){const ci=this._getTransformedBegin(),hi=this._getTransformedEnd();return this._boundsFromBeginEnd(ci,hi)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new LineSegment(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new LineSegment(this.begin,this.end)}get axes(){const hi=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),_i=[];return _i.push(hi),_i.push(hi.negate()),_i.push(hi.normal()),_i.push(hi.normal().negate()),_i}getInertia(ci){const hi=this.end.sub(this.begin).distance()/2;return ci*hi*hi}update(ci){var hi;this._transform=ci,((hi=ci.matrix)!==null&&hi!==void 0?hi:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(ci){const hi=[],_i=[this._getTransformedBegin(),this._getTransformedEnd()],pi=_i.length;for(let gi=0;gi<pi;gi++)hi.push(_i[gi].dot(ci));return new Projection(Math.min.apply(Math,hi),Math.max.apply(Math,hi))}debug(ci,hi){const _i=this._getTransformedBegin(),pi=this._getTransformedEnd();ci.drawLine(_i,pi,hi,2),ci.drawCircle(_i,2,hi),ci.drawCircle(pi,2,hi)}}class Debug{static registerGraphicsContext(ci){Debug._ctx=ci}static draw(ci){this._drawCalls.push(ci)}static drawPoint(ci,hi){Debug.draw(_i=>{_i.debug.drawPoint(ci,hi)})}static drawLine(ci,hi,_i){Debug.draw(pi=>{pi.debug.drawLine(ci,hi,_i)})}static drawLines(ci,hi){ci.length>1&&Debug.draw(_i=>{for(let pi=0;pi<ci.length-1;pi++)_i.debug.drawLine(ci[pi],ci[pi+1],hi)})}static drawText(ci,hi){Debug.draw(_i=>{_i.debug.drawText(ci,hi)})}static drawPolygon(ci,hi){ci.length>1&&Debug.draw(_i=>{const pi=ci[0],gi=[...ci,pi];for(let mi=0;mi<gi.length-1;mi++)_i.debug.drawLine(gi[mi],gi[mi+1],hi)})}static drawCircle(ci,hi,_i){const{color:pi,strokeColor:gi,width:mi}={color:Color.Black,strokeColor:void 0,width:void 0,..._i};Debug.draw(xi=>{xi.drawCircle(ci,hi,pi,gi,mi)})}static drawBounds(ci,hi){Debug.draw(_i=>{_i.debug.drawRect(ci.left,ci.top,ci.width,ci.height,hi)})}static drawRay(ci,hi){const{distance:_i,color:pi}={color:Color.Blue,distance:10,...hi};Debug.draw(gi=>{const mi=ci.pos,xi=ci.pos.add(ci.dir.scale(_i));gi.debug.drawLine(mi,xi,{color:pi})})}static flush(ci){ci.save(),ci.z=Debug.z;for(const hi of Debug._drawCalls)hi(ci);ci.restore(),Debug.clear()}static clear(){Debug._drawCalls.length=0}}Debug._drawCalls=[];Debug.z=1/0;class PolygonCollider extends Collider{flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}get normals(){return this._normals}set points(ci){if(ci.length<3)throw new Error("PolygonCollider cannot be created with less that 3 points");this._points=ci,this._checkAndUpdateWinding(this._points),this._calculateNormals(),this.flagDirty()}_calculateNormals(){const ci=[];for(let hi=0;hi<this._points.length;hi++)ci.push(this._points[(hi+1)%this._points.length].sub(this._points[hi]).normal());this._normals=ci}get points(){return this._points}get transform(){return this._transform}constructor(ci){var hi;super(),this._logger=Logger.getInstance(),this._transform=new transform_Transform,this._transformedPoints=[],this._sides=[],this._localSides=[],this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(hi=ci.offset)!==null&&hi!==void 0?hi:Vector.Zero,this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y,this.points=ci.points,this.isConvex()||ci.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_checkAndUpdateWinding(ci){this._isCounterClockwiseWinding(ci)||ci.reverse()}_isCounterClockwiseWinding(ci){let hi=0;for(let _i=0;_i<ci.length;_i++)hi+=(ci[(_i+1)%ci.length].x-ci[_i].x)*(ci[(_i+1)%ci.length].y+ci[_i].y);return hi<0}isConvex(){if(this.points.length<3)return!1;let ci=this.points[this.points.length-2],hi=this.points[this.points.length-1],_i=Math.atan2(hi.y-ci.y,hi.x-ci.x),pi=0,gi=0,mi=0;for(const[xi,yi]of this.points.entries()){if(ci=hi,pi=_i,hi=yi,_i=Math.atan2(hi.y-ci.y,hi.x-ci.x),ci.equals(hi))return!1;let Ci=_i-pi;if(Ci<=-Math.PI?Ci+=Math.PI*2:Ci>Math.PI&&(Ci-=Math.PI*2),xi===0){if(Ci===0)return!1;gi=Ci>0?1:-1}else if(gi*Ci<=0)return!1;mi+=Ci}return Math.abs(Math.round(mi/(Math.PI*2)))===1}tessellate(){const ci=[];for(let hi=1;hi<this.points.length-2;hi++)ci.push([this.points[0],this.points[hi+1],this.points[hi+2]]);return ci.push([this.points[0],this.points[1],this.points[2]]),new CompositeCollider(ci.map(hi=>Shape.Polygon(hi)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const ci=[],hi=[...this.points].reverse();let _i=hi.length;function pi(Ai){return Ai===0?_i-1:Ai-1}function gi(Ai){return Ai===_i-1?0:Ai+1}function mi(Ai){const ki=pi(Ai),Pi=gi(Ai),Ii=hi[ki],Di=hi[Ai],Fi=hi[Pi],Li=Ii.sub(Di),Bi=Fi.sub(Di);return!(Li.cross(Bi)<0)}const xi=hi.map((Ai,ki)=>mi(ki));function yi(Ai,ki,Pi,Ii){const Di=Pi.sub(ki),Fi=Ii.sub(Pi),Li=ki.sub(Ii),Bi=Ai.sub(ki),Ri=Ai.sub(Pi),$i=Ai.sub(Ii),Ni=Di.cross(Bi),ji=Fi.cross(Ri),Ui=Li.cross($i);return!(Ni>0||ji>0||Ui>0)}function Ci(){for(let Ai=0;Ai<_i;Ai++)if(xi[Ai]){const ki=pi(Ai),Pi=gi(Ai),Ii=hi[ki],Di=hi[Ai],Fi=hi[Pi];let Li=!0;for(let Bi=0;Bi<_i;Bi++){if(Bi===Ai||Bi===ki||Bi===Pi)continue;const Ri=hi[Bi];if(yi(Ri,Ii,Di,Fi)){Li=!1;break}}if(Li)return Ai}for(let Ai=0;Ai<_i;Ai++)if(xi[Ai])return Ai;return 0}function Ei(Ai){const ki=pi(Ai),Pi=gi(Ai),Ii=hi[ki],Di=hi[Ai],Fi=hi[Pi];ci.push([Ii,Di,Fi]),hi.splice(Ai,1),xi.splice(Ai,1),_i--}for(;_i>3;){const Ai=Ci();Ei(Ai);for(let ki=0;ki<_i;ki++)xi[ki]=mi(ki)}return ci.push([hi[0],hi[1],hi[2]]),new CompositeCollider(ci.map(Ai=>Shape.Polygon(Ai,Vector.Zero,!0)))}clone(){return new PolygonCollider({offset:this.offset.clone(),points:this.points.map(ci=>ci.clone())})}get worldPos(){return this._transform.pos}get center(){return this.bounds.center}_calculateTransformation(){const ci=this.points,hi=ci.length;this._transformedPoints.length=0;for(let _i=0;_i<hi;_i++)this._transformedPoints[_i]=this._transform.apply(ci[_i].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const ci=[],hi=this.getTransformedPoints(),_i=hi.length;for(let pi=0;pi<_i;pi++)ci.push(new LineSegment(hi[pi],hi[(pi+1)%_i]));this._sides=ci,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const ci=[],hi=this.points,_i=hi.length;for(let pi=0;pi<_i;pi++)ci.push(new LineSegment(hi[pi],hi[(pi+1)%_i]));this._localSides=ci,this._localSidesDirty=!1}return this._localSides}findSide(ci){const hi=this.getSides();let _i=hi[0],pi=-Number.MAX_VALUE;for(let gi=0;gi<hi.length;gi++){const mi=hi[gi],yi=mi.normal().dot(ci);yi>pi&&(_i=mi,pi=yi)}return _i}findLocalSide(ci){const hi=this.getLocalSides();let _i=hi[0],pi=-Number.MAX_VALUE;for(let gi=0;gi<hi.length;gi++){const mi=hi[gi],yi=mi.normal().dot(ci);yi>pi&&(_i=mi,pi=yi)}return _i}get axes(){const ci=[],hi=this.getSides();for(let _i=0;_i<hi.length;_i++)ci.push(hi[_i].normal());return ci}update(ci){ci&&(ci.cloneWithParent(this._transform),this._transformedPointsDirty=!0,this._sidesDirty=!0,(this.offset.x!==0||this.offset.y!==0)&&(this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y),this._transform.isMirrored()&&(this.points=this.points.map(hi=>vec(hi.x*sign(this._transform.scale.x),hi.y*sign(this._transform.scale.y))),this._transform.scale.x=Math.abs(this._transform.scale.x),this._transform.scale.y=Math.abs(this._transform.scale.y)))}contains(ci){const hi=this._transform.applyInverse(ci),_i=new Ray(hi,new Vector(1,0));let pi=0;const gi=this.getLocalSides();for(let mi=0;mi<gi.length;mi++){const xi=gi[mi];_i.intersect(xi)>=0&&pi++}return pi%2!==0}getClosestLineBetween(ci){if(ci instanceof CircleCollider)return ClosestLineJumpTable.PolygonCircleClosestLine(this,ci);if(ci instanceof PolygonCollider)return ClosestLineJumpTable.PolygonPolygonClosestLine(this,ci);if(ci instanceof EdgeCollider)return ClosestLineJumpTable.PolygonEdgeClosestLine(this,ci);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof ci}`)}collide(ci){if(ci instanceof CircleCollider)return CollisionJumpTable.CollideCirclePolygon(ci,this);if(ci instanceof PolygonCollider)return CollisionJumpTable.CollidePolygonPolygon(this,ci);if(ci instanceof EdgeCollider)return CollisionJumpTable.CollidePolygonEdge(this,ci);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof ci}`)}getFurthestPoint(ci){const hi=this.getTransformedPoints();let _i=null,pi=-Number.MAX_VALUE;for(let gi=0;gi<hi.length;gi++){const mi=ci.dot(hi[gi]);mi>pi&&(pi=mi,_i=hi[gi])}return _i}getFurthestLocalPoint(ci){const hi=this.points;let _i=hi[0],pi=-Number.MAX_VALUE;for(let gi=0;gi<hi.length;gi++){const mi=ci.dot(hi[gi]);mi>pi&&(pi=mi,_i=hi[gi])}return _i}getClosestFace(ci){const hi=this.getSides();let _i=Number.POSITIVE_INFINITY,pi=-1,gi=-1;for(let mi=0;mi<hi.length;mi++){const xi=hi[mi].distanceToPoint(ci);xi<_i&&(_i=xi,pi=mi,gi=xi)}return pi!==-1?{distance:hi[pi].normal().scale(gi),face:hi[pi]}:null}get bounds(){return this.localBounds.transform(this._transform.matrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=BoundingBox.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(ci){if(this._cachedMass===ci&&this._cachedInertia)return this._cachedInertia;let hi=0,_i=0;const pi=this.points;for(let gi=0;gi<pi.length;gi++){const mi=(gi+1)%pi.length,xi=pi[mi].cross(pi[gi]);hi+=xi*(pi[gi].dot(pi[gi])+pi[gi].dot(pi[mi])+pi[mi].dot(pi[mi])),_i+=xi}return this._cachedMass=ci,this._cachedInertia=ci/6*(hi/_i)}rayCast(ci,hi=1/0){var _i;const pi=this.getSides(),gi=pi.length;let mi=Number.MAX_VALUE,xi,yi=-1;for(let Ci=0;Ci<gi;Ci++){const Ei=ci.intersect(pi[Ci]);Ei>=0&&Ei<mi&&Ei<=hi&&(mi=Ei,xi=pi[Ci],yi=Ci)}return yi>=0?{collider:this,distance:mi,body:(_i=this.owner)===null||_i===void 0?void 0:_i.get(BodyComponent),point:ci.getPoint(mi),normal:xi.normal()}:null}project(ci){const hi=this.getTransformedPoints(),_i=hi.length;let pi=Number.MAX_VALUE,gi=-Number.MAX_VALUE;for(let mi=0;mi<_i;mi++){const xi=hi[mi].dot(ci);pi=Math.min(pi,xi),gi=Math.max(gi,xi)}return new Projection(pi,gi)}debug(ci,hi,_i){const pi=this.getTransformedPoints();Debug.drawPolygon(pi,{color:hi})}}class Shape{static Box(ci,hi,_i=Vector.Half,pi=Vector.Zero){return new PolygonCollider({points:new BoundingBox(-ci*_i.x,-hi*_i.y,ci-ci*_i.x,hi-hi*_i.y).getPoints(),offset:pi})}static Polygon(ci,hi=Vector.Zero,_i=!1){return new PolygonCollider({points:ci,offset:hi,suppressConvexWarning:_i})}static Circle(ci,hi=Vector.Zero){return new CircleCollider({radius:ci,offset:hi})}static Edge(ci,hi){return new EdgeCollider({begin:ci,end:hi})}static Capsule(ci,hi,_i=Vector.Zero){const pi=Logger.getInstance();return ci===hi&&pi.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),hi>=ci?new CompositeCollider([Shape.Circle(ci/2,vec(0,-hi/2+ci/2).add(_i)),Shape.Box(ci,hi-ci,Vector.Half,_i),Shape.Circle(ci/2,vec(0,hi/2-ci/2).add(_i))]):new CompositeCollider([Shape.Circle(hi/2,vec(-ci/2+hi/2,0).add(_i)),Shape.Box(ci-hi,hi,Vector.Half,_i),Shape.Circle(hi/2,vec(ci/2-hi/2,0).add(_i))])}}class ColliderComponent extends Component{constructor(ci){super(),this.events=new EventEmitter,this.$colliderAdded=new Observable,this.$colliderRemoved=new Observable,this._collidersToRemove=[],this.set(ci)}get(){return this._collider}set(ci){return this.clear(),ci&&(this._collider=ci,this._collider.owner=this.owner,ci.events.pipe(this.events),this.$colliderAdded.notifyAll(ci),this.update()),ci}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const ci of this._collidersToRemove)ci.events.unpipe(this.events),this.$colliderRemoved.notifyAll(ci),ci.owner=null}clone(){return new ColliderComponent(this._collider.clone())}get bounds(){var ci,hi;return(hi=(ci=this._collider)===null||ci===void 0?void 0:ci.bounds)!==null&&hi!==void 0?hi:new BoundingBox}get localBounds(){var ci,hi;return(hi=(ci=this._collider)===null||ci===void 0?void 0:ci.localBounds)!==null&&hi!==void 0?hi:new BoundingBox}update(){var ci;const hi=(ci=this.owner)===null||ci===void 0?void 0:ci.get(TransformComponent);this._collider&&(this._collider.owner=this.owner,hi&&this._collider.update(hi.get()))}collide(ci){let hi=this._collider,_i=ci._collider;if(!hi||!_i)return[];let pi=!1;if(_i instanceof CompositeCollider&&(hi=_i,_i=this._collider,pi=!0),this._collider){const gi=hi.collide(_i);return gi?(pi&&gi.forEach(mi=>{mi.mtv=mi.mtv.negate(),mi.normal=mi.normal.negate(),mi.tangent=mi.normal.perpendicular(),mi.colliderA=this._collider,mi.colliderB=ci._collider}),gi):[]}return[]}onAdd(ci){this._collider&&this.update(),this.events.on("precollision",hi=>{const _i=hi;ci.events.emit("precollision",new PreCollisionEvent(_i.self,_i.other,_i.side,_i.intersection,_i.contact)),ci instanceof Actor&&ci.onPreCollisionResolve(_i.self,_i.other,_i.side,_i.contact)}),this.events.on("postcollision",hi=>{const _i=hi;ci.events.emit("postcollision",new PostCollisionEvent(_i.self,_i.other,_i.side,_i.intersection,_i.contact)),ci instanceof Actor&&ci.onPostCollisionResolve(_i.self,_i.other,_i.side,_i.contact)}),this.events.on("collisionstart",hi=>{const _i=hi;ci.events.emit("collisionstart",new CollisionStartEvent(_i.self,_i.other,_i.side,_i.contact)),ci instanceof Actor&&ci.onCollisionStart(_i.self,_i.other,_i.side,_i.contact)}),this.events.on("collisionend",hi=>{const _i=hi;ci.events.emit("collisionend",new CollisionEndEvent(_i.self,_i.other,_i.side,_i.lastContact)),ci instanceof Actor&&ci.onCollisionEnd(_i.self,_i.other,_i.side,_i.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(ci,hi,_i=Vector.Half,pi=Vector.Zero){const gi=Shape.Box(ci,hi,_i,pi);return this.set(gi)}usePolygonCollider(ci,hi=Vector.Zero){const _i=Shape.Polygon(ci,hi);return this.set(_i)}useCircleCollider(ci,hi=Vector.Zero){const _i=Shape.Circle(ci,hi);return this.set(_i)}useEdgeCollider(ci,hi){const _i=Shape.Edge(ci,hi);return this.set(_i)}useCompositeCollider(ci){return this.set(new CompositeCollider(ci))}}var DegreeOfFreedom;(function(fi){fi.Rotation="rotation",fi.X="x",fi.Y="y"})(DegreeOfFreedom||(DegreeOfFreedom={}));class BodyComponent extends Component{constructor(ci){var hi,_i,pi;super(),this.dependencies=[TransformComponent,MotionComponent],this.id=createId("body",BodyComponent._ID++),this.events=new EventEmitter,this.oldTransform=new transform_Transform,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=CollisionType.PreventCollision,this.group=CollisionGroup.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this._oldGlobalPos=Vector.Zero,this.oldVel=new Vector(0,0),this.oldAcc=Vector.Zero,this._impulseScratch=vec(0,0),this._distanceFromCenterScratch=vec(0,0),ci?(this.collisionType=(hi=ci.type)!==null&&hi!==void 0?hi:this.collisionType,this.group=(_i=ci.group)!==null&&_i!==void 0?_i:this.group,this.useGravity=(pi=ci.useGravity)!==null&&pi!==void 0?pi:this.useGravity,this._bodyConfig={...getDefaultPhysicsConfig().bodies,...ci.config}):this._bodyConfig={...getDefaultPhysicsConfig().bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=BodyComponent._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(ci){this._bodyConfig={...getDefaultPhysicsConfig().bodies,...ci},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(ci){BodyComponent._DEFAULT_CONFIG=ci}get mass(){return this._mass}set mass(ci){this._mass=ci,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===CollisionType.Fixed?0:1/this.mass}get sleeping(){return this.isSleeping}get isSleeping(){return this._sleeping}setSleeping(ci){this.isSleeping=ci}set isSleeping(ci){this._sleeping=ci,ci?(this.vel=Vector.Zero,this.acc=Vector.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&(this.isSleeping=!0);const ci=this.vel.magnitude*this.vel.magnitude+Math.abs(this.angularVelocity*this.angularVelocity),hi=this._bodyConfig.sleepBias;this.sleepMotion=hi*this.sleepMotion+(1-hi)*ci,this.sleepMotion=clamp(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&(this.isSleeping=!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const ci=this.owner.get(ColliderComponent);if(ci){ci.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),ci.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const hi=ci.get();if(hi)return this._cachedInertia=hi.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===CollisionType.Fixed?0:1/this.inertia}get active(){var ci;return!!(!((ci=this.owner)===null||ci===void 0)&&ci.isActive)}get isActive(){var ci;return!!(!((ci=this.owner)===null||ci===void 0)&&ci.isActive)}get center(){return this.globalPos}onAdd(ci){var hi,_i;this.transform=(hi=this.owner)===null||hi===void 0?void 0:hi.get(TransformComponent),this.motion=(_i=this.owner)===null||_i===void 0?void 0:_i.get(MotionComponent)}get pos(){return this.transform.pos}set pos(ci){this.transform.pos=ci}get globalPos(){return this.transform.globalPos}set globalPos(ci){this.transform.globalPos=ci}get oldPos(){return this.oldTransform.pos}get oldGlobalPos(){return this._oldGlobalPos}get vel(){return this.motion.vel}set vel(ci){this.motion.vel=ci}get acc(){return this.motion.acc}set acc(ci){this.motion.acc=ci}get torque(){return this.motion.torque}set torque(ci){this.motion.torque=ci}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(ci){this.transform.globalRotation=ci}get scale(){return this.transform.globalScale}set scale(ci){this.transform.globalScale=ci}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(ci){this.motion.scaleFactor=ci}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(ci){this.motion.angularVelocity=ci}applyImpulse(ci,hi){if(this.collisionType!==CollisionType.Active)return;const _i=hi.scale(this.inverseMass,this._impulseScratch);if(this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.X)>-1&&(_i.x=0),this.limitDegreeOfFreedom.indexOf(DegreeOfFreedom.Y)>-1&&(_i.y=0),this.vel.addEqual(_i),!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)){const pi=ci.sub(this.globalPos,this._distanceFromCenterScratch);this.angularVelocity+=this.inverseInertia*pi.cross(hi)}}applyLinearImpulse(ci){if(this.collisionType!==CollisionType.Active)return;const hi=ci.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)&&(hi.x=0),this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)&&(hi.y=0),this.vel=this.vel.add(hi)}applyAngularImpulse(ci,hi){if(this.collisionType===CollisionType.Active&&!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)){const _i=ci.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*_i.cross(hi)}}captureOldTransform(){this.__oldTransformCaptured=!0;const ci=this.transform.get();ci.clone(this.oldTransform),this.oldTransform.parent=ci.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldGlobalPos.setTo(this.globalPos.x,this.globalPos.y)}clone(){return super.clone()}}BodyComponent._ID=0;BodyComponent._DEFAULT_CONFIG={...getDefaultPhysicsConfig().bodies};class Rectangle extends Raster{constructor(ci){super(ci),this.width=ci.width,this.height=ci.height,this.rasterize()}clone(){return new Rectangle({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(ci){this.color&&ci.fillRect(0,0,this.width,this.height),this.strokeColor&&ci.strokeRect(0,0,this.width,this.height)}}class Circle extends Raster{get radius(){return this._radius}set radius(ci){this._radius=ci,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(ci){var hi,_i,pi;super(ci),this._radius=0;const gi=(hi=ci.lineWidth)!==null&&hi!==void 0?hi:ci.strokeColor?1:0;this.padding=(_i=ci.padding)!==null&&_i!==void 0?_i:2+gi/2,this.radius=ci.radius,this.filtering=(pi=ci.filtering)!==null&&pi!==void 0?pi:ImageFiltering.Blended,this.rasterize()}clone(){return new Circle({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(ci){this.radius>0&&(ci.beginPath(),ci.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&ci.fill(),this.strokeColor&&ci.stroke())}}class PointerComponent extends Component{constructor(ci){var hi,_i;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(hi=ci==null?void 0:ci.useColliderShape)!==null&&hi!==void 0?hi:this.useColliderShape,this.useGraphicsBounds=(_i=ci==null?void 0:ci.useGraphicsBounds)!==null&&_i!==void 0?_i:this.useGraphicsBounds,this.localBounds=ci==null?void 0:ci.localBounds}}class EasingFunctions{static CreateReversibleEasingFunction(ci){return(hi,_i,pi,gi)=>pi<_i?_i-(ci(hi,pi,_i,gi)-pi):ci(hi,_i,pi,gi)}static CreateVectorEasingFunction(ci){return(hi,_i,pi,gi)=>new Vector(ci(hi,_i.x,pi.x,gi),ci(hi,_i.y,pi.y,gi))}}EasingFunctions.Linear=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,hi*fi/_i+ci));EasingFunctions.EaseInQuad=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i,hi*fi*fi+ci));EasingFunctions.EaseOutQuad=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i,-hi*fi*(fi-2)+ci));EasingFunctions.EaseInOutQuad=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i/2,fi<1?hi/2*fi*fi+ci:(fi--,-hi/2*(fi*(fi-2)-1)+ci)));EasingFunctions.EaseInCubic=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i,hi*fi*fi*fi+ci));EasingFunctions.EaseOutCubic=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i,fi--,hi*(fi*fi*fi+1)+ci));EasingFunctions.EaseInOutCubic=EasingFunctions.CreateReversibleEasingFunction((fi,ci,hi,_i)=>(hi=hi-ci,fi/=_i/2,fi<1?hi/2*fi*fi*fi+ci:(fi-=2,hi/2*(fi*fi*fi+2)+ci)));class ActionQueue{constructor(ci){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=ci}add(ci){this._actions.push(ci)}remove(ci){const hi=this._actions.indexOf(ci);this._actions.splice(hi,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}getIncompleteActions(){return this._actions}getCurrentAction(){return this._currentAction}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const ci=this._actions.length;for(let hi=0;hi<ci;hi++)this._actions[hi].reset();this._completedActions=[]}update(ci){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new ActionStartEvent(this._currentAction,this._entity))),this._currentAction.update(ci),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new ActionCompleteEvent(this._currentAction,this._entity));const hi=this._actions.shift();hi&&this._completedActions.push(hi)}}}let _ACTION_ID=0;function nextActionId(){return _ACTION_ID++}class Repeat{constructor(ci,hi,_i){this.id=nextActionId(),this._stopped=!1,this._repeatBuilder=hi,this._repeatContext=new ActionContext(ci),this._actionQueue=this._repeatContext.getQueue(),this._repeat=_i,this._originalRepeat=_i,this._repeatBuilder(this._repeatContext),this._repeat--}update(ci){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(ci)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class RepeatForever{constructor(ci,hi){this.id=nextActionId(),this._stopped=!1,this._repeatBuilder=hi,this._repeatContext=new ActionContext(ci),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(ci){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(ci))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}function lerp(fi,ci,hi){return(1-hi)*fi+ci*hi}function lerpAngle(fi,ci,hi,_i){const pi=(fi-ci+TwoPI)%TwoPI>=Math.PI,gi=Math.abs(ci-fi),mi=TwoPI-gi;let xi=0,yi=0;gi>mi?(xi=mi,yi=gi):(xi=gi,yi=mi);let Ci=0,Ei=1;switch(hi){case RotationType.ShortestPath:Ci=xi,Ei=pi?1:-1;break;case RotationType.LongestPath:Ci=yi,Ei=pi?-1:1;break;case RotationType.Clockwise:Ei=1,Ci=pi?xi:yi;break;case RotationType.CounterClockwise:Ei=-1,Ci=pi?yi:xi;break}return fi+Ei*(Ci*_i)}function lerpVector(fi,ci,hi){return fi.scale(1-hi).add(ci.scale(hi))}function inverseLerp(fi,ci,hi){return(hi-fi)/(ci-fi)}function inverseLerpVector(fi,ci,hi){const _i=hi.sub(fi),pi=ci.sub(fi),gi=_i.x/pi.x,mi=_i.y/pi.y;return Math.min(gi,mi)}function remap(fi,ci,hi,_i,pi){const gi=inverseLerp(fi,ci,pi);return lerp(hi,_i,gi)}function remapVector(fi,ci,hi,_i,pi){const gi=inverseLerpVector(fi,ci,pi);return lerpVector(hi,_i,gi)}function isMoveByOptions(fi){return fi.offset instanceof Vector&&typeof fi.duration=="number"}class MoveByWithOptions{constructor(ci,hi){var _i;if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._easing=EasingFunctions.Linear,this._offset=hi.offset,this._easing=(_i=hi.easing)!==null&&_i!==void 0?_i:this._easing,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);this._durationMs=hi.duration,this._currentMs=this._durationMs}update(ci){this._started||(this._start=this._tx.pos.clone(),this._end=this._start.add(this._offset),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=this._tx.pos,pi=this._easing(hi,this._start.x,this._end.x,1),gi=this._easing(hi,this._start.y,this._end.y,1),mi=(pi-_i.x)/(ci/1e3),xi=(gi-_i.y)/(ci/1e3);this._motion.vel.x=mi,this._motion.vel.y=xi,this.isComplete(this.entity)&&(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0))}isComplete(ci){return this._stopped||this._currentMs<0}stop(){this._motion.vel=vec(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class MoveBy{constructor(ci,hi,_i,pi){if(this.id=nextActionId(),this._started=!1,this._stopped=!1,this._entity=ci,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._speed=pi,this._offset=new Vector(hi,_i),pi<=0)throw Logger.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+pi),new Error("Speed must be greater than 0 pixels per second")}update(ci){this._started||(this._started=!0,this._start=new Vector(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.magnitude,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(ci){const hi=ci.get(TransformComponent);return this._stopped||hi.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=vec(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function isMoveToOptions(fi){return fi.pos instanceof Vector&&typeof fi.duration=="number"}class MoveToWithOptions{constructor(ci,hi){var _i;if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._easing=EasingFunctions.Linear,this._end=hi.pos,this._easing=(_i=hi.easing)!==null&&_i!==void 0?_i:this._easing,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);this._durationMs=hi.duration,this._currentMs=this._durationMs}update(ci){this._started||(this._start=this._tx.pos.clone(),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=this._tx.pos,pi=this._easing(hi,this._start.x,this._end.x,1),gi=this._easing(hi,this._start.y,this._end.y,1),mi=(pi-_i.x)/(ci/1e3),xi=(gi-_i.y)/(ci/1e3);this._motion.vel.x=mi,this._motion.vel.y=xi,this.isComplete(this.entity)&&(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0))}isComplete(ci){return this._stopped||this._currentMs<0}stop(){this._motion.vel=vec(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class MoveTo{constructor(ci,hi,_i,pi){this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._end=new Vector(hi,_i),this._speed=pi}update(ci){this._started||(this._started=!0,this._start=new Vector(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const hi=this._dir.scale(this._speed);this._motion.vel=vec(hi.x,hi.y),this.isComplete(this.entity)&&(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0))}isComplete(ci){const hi=ci.get(TransformComponent);return this._stopped||new Vector(hi.pos.x,hi.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=vec(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function isRotateToOptions(fi){return typeof fi.angle=="number"&&typeof fi.duration=="number"}class RotateToWithOptions{constructor(ci,hi){var _i;if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._endAngle=0,this._startAngle=0,this._endAngle=hi.angle,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);this._durationMs=hi.duration,this._rotationType=(_i=hi.rotationType)!==null&&_i!==void 0?_i:RotationType.ShortestPath,this._currentMs=this._durationMs}update(ci){this._started||(this._startAngle=this._tx.rotation,this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=lerpAngle(this._startAngle,this._endAngle,this._rotationType,hi),pi=this._tx.rotation,gi=(_i-pi)/(ci/1e3);this._motion.angularVelocity=gi,this.isComplete(this.entity)&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(ci){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class RotateTo{constructor(ci,hi,_i,pi){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._end=hi,this._speed=_i,this._rotationType=pi||RotationType.ShortestPath}update(ci){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const hi=Math.abs(this._end-this._start),_i=TwoPI-hi;switch(hi>_i?(this._shortDistance=_i,this._longDistance=hi):(this._shortDistance=hi,this._longDistance=_i),this._shortestPathIsPositive=(this._start-this._end+TwoPI)%TwoPI>=Math.PI,this._rotationType){case RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case RotationType.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case RotationType.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(ci/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const ci=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||ci>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function isRotateByOptions(fi){return typeof fi.angleRadiansOffset=="number"&&typeof fi.duration=="number"}class RotateByWithOptions{constructor(ci,hi){var _i;if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._offset=0,this._startAngle=0,this._endAngle=0,this._offset=hi.angleRadiansOffset,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);this._durationMs=hi.duration,this._rotationType=(_i=hi.rotationType)!==null&&_i!==void 0?_i:RotationType.ShortestPath,this._currentMs=this._durationMs}update(ci){this._started||(this._startAngle=this._tx.rotation,this._endAngle=canonicalizeAngle(this._startAngle+this._offset),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=lerpAngle(this._startAngle,this._endAngle,this._rotationType,hi),pi=this._tx.rotation,gi=(_i-pi)/(ci/1e3);this._motion.angularVelocity=gi,this.isComplete()&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class RotateBy{constructor(ci,hi,_i,pi){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._speed=_i,this._offset=hi,this._rotationType=pi||RotationType.ShortestPath}update(ci){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const hi=Math.abs(this._end-this._start),_i=TwoPI-hi;switch(hi>_i?(this._shortDistance=_i,this._longDistance=hi):(this._shortDistance=hi,this._longDistance=_i),this._shortestPathIsPositive=(this._start-this._end+TwoPI)%TwoPI>=Math.PI,this._rotationType){case RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case RotationType.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case RotationType.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(ci/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const ci=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||ci>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}function isScaleToOptions(fi){return typeof fi.scale=="object"&&typeof fi.duration=="number"}class ScaleToWithOptions{constructor(ci,hi){if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._endScale=vec(1,1),this._startScale=vec(1,1),this._endScale=hi.scale,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);this._durationMs=hi.duration,this._currentMs=this._durationMs}update(ci){this._started||(this._startScale=this._tx.scale,this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=lerpVector(this._startScale,this._endScale,hi),pi=this._tx.scale,gi=_i.sub(pi).scale(1/(ci/1e3));this._motion.scaleFactor=gi,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=Vector.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class ScaleTo{constructor(ci,hi,_i,pi,gi){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._endX=hi,this._endY=_i,this._speedX=pi,this._speedY=gi}update(ci){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const hi=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*hi}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const hi=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*hi}this.isComplete()&&(this._tx.scale=vec(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function isScaleByOptions(fi){return typeof fi.scaleOffset=="object"&&typeof fi.duration=="number"}class ScaleByWithOptions{constructor(ci,hi){if(this.entity=ci,this.id=nextActionId(),this._started=!1,this._stopped=!1,this._endScale=vec(1,1),this._scaleOffset=vec(0,0),this._startScale=vec(1,1),this._scaleOffset=hi.scaleOffset,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);this._durationMs=hi.duration,this._currentMs=this._durationMs}update(ci){this._started||(this._startScale=this._tx.scale,this._endScale=this._startScale.add(this._scaleOffset),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),_i=lerpVector(this._startScale,this._endScale,hi),pi=this._tx.scale,gi=_i.sub(pi).scale(1/(ci/1e3));this._motion.scaleFactor=gi,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=Vector.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class ScaleBy{constructor(ci,hi,_i,pi){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._offset=new Vector(hi,_i),this._speedX=this._speedY=pi}update(ci){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class CallMethod{constructor(ci){this.id=nextActionId(),this._hasBeenCalled=!1,this._method=ci}update(ci){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class EaseTo{constructor(ci,hi,_i,pi,gi){this.easingFcn=gi,this.id=nextActionId(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new Vector(0,0),this._lerpEnd=new Vector(0,0),this._initialized=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._lerpDuration=pi,this._lerpEnd=new Vector(hi,_i)}_initialize(){this._lerpStart=new Vector(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(ci){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=ci;let hi=this._tx.pos.x,_i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?hi=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):hi=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?_i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):_i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=vec((hi-this._tx.pos.x)/(ci/1e3),(_i-this._tx.pos.y)/(ci/1e3))):(this._tx.pos=vec(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=Vector.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=vec(0,0),this._stopped=!0}}class EaseBy{constructor(ci,hi,_i,pi,gi){this.easingFcn=gi,this.id=nextActionId(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new Vector(0,0),this._lerpEnd=new Vector(0,0),this._initialized=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._lerpDuration=pi,this._offset=new Vector(hi,_i)}_initialize(){this._lerpStart=new Vector(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(ci){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=ci;let hi=this._tx.pos.x,_i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?hi=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):hi=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?_i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):_i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=vec((hi-this._tx.pos.x)/(ci/1e3),(_i-this._tx.pos.y)/(ci/1e3))):(this._tx.pos=vec(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=Vector.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=vec(0,0),this._stopped=!0}}class Blink{constructor(ci,hi,_i,pi=1){this.id=nextActionId(),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=ci.get(GraphicsComponent),this._timeVisible=hi,this._timeNotVisible=_i,this._duration=(hi+_i)*pi}update(ci){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=ci,this._totalTime+=ci,this._graphics.isVisible&&this._elapsedTime>=this._timeVisible&&(this._graphics.isVisible=!1,this._elapsedTime=0),!this._graphics.isVisible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.isVisible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.isVisible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class Fade{constructor(ci,hi,_i){this.id=nextActionId(),this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=ci.get(GraphicsComponent),this._endOpacity=hi,this._remainingTime=this._originalTime=_i}update(ci){this._graphics&&(this._started||(this._started=!0,this._remainingTime=this._originalTime,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._remainingTime>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*ci)/this._remainingTime),this._remainingTime-=ci,this.isComplete()&&(this._graphics.opacity=this._endOpacity),Logger.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||this._remainingTime<=0}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._remainingTime=this._originalTime}}class Delay{constructor(ci){this.id=nextActionId(),this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=ci}update(ci){this._started||(this._started=!0),this._elapsedTime+=ci}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class Die{constructor(ci){this.id=nextActionId(),this._stopped=!1,this._entity=ci}update(ci){this._entity.get(ActionsComponent).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Follow{constructor(ci,hi,_i){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._followTx=hi.get(TransformComponent),this._followMotion=hi.get(MotionComponent),this._current=new Vector(this._tx.pos.x,this._tx.pos.y),this._end=new Vector(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=_i!==void 0?_i:this._current.distance(this._end),this._speed=0}update(ci){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const hi=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(hi!==0&&(this._speed=hi),this._current=vec(this._tx.pos.x,this._tx.pos.y),this._end=vec(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const _i=this._dir.scale(this._speed);this._motion.vel=vec(_i.x,_i.y)}else this._motion.vel=vec(0,0);this.isComplete()&&(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0))}stop(){this._motion.vel=vec(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class Meet{constructor(ci,hi,_i){this.id=nextActionId(),this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=ci.get(TransformComponent),this._motion=ci.get(MotionComponent),this._meetTx=hi.get(TransformComponent),this._meetMotion=hi.get(MotionComponent),this._current=new Vector(this._tx.pos.x,this._tx.pos.y),this._end=new Vector(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=_i||0,_i!==void 0&&(this._speedWasSpecified=!0)}update(ci){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const hi=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));hi!==0&&!this._speedWasSpecified&&(this._speed=hi),this._current=vec(this._tx.pos.x,this._tx.pos.y),this._end=vec(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const _i=this._dir.scale(this._speed);this._motion.vel=vec(_i.x,_i.y),this.isComplete()&&(this._tx.pos=vec(this._end.x,this._end.y),this._motion.vel=vec(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=vec(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=1/0}}class Flash{constructor(ci,hi,_i=1e3){var pi;this.id=nextActionId(),this._stopped=!1,this._started=!1,this._total=0,this._currentDuration=0,this._graphics=ci.get(GraphicsComponent),this._duration=_i,this._entity=ci,this._material=(pi=ci.scene)===null||pi===void 0?void 0:pi.engine.graphicsContext.createMaterial({name:"flash-material",color:hi,fragmentSource:`#version 300 es
    
        precision mediump float;
        uniform float u_blend;
        uniform sampler2D u_graphic;
        uniform vec4 u_color;
    
        in vec2 v_uv; 
        out vec4 color;
    
        void main() { 
            vec4 textureColor = texture(u_graphic, v_uv); 
            color = mix(textureColor, u_color, u_blend * textureColor.a);
            color.rgb = color.rgb * color.a;
        }`}),this._total=_i}update(ci){var hi;this._started||(this._started=!0,this._total=this._duration,this._currentDuration=this._duration,this._entity.graphics.material=this._material),this._graphics&&(this._currentDuration-=ci,this._graphics&&((hi=this._material)===null||hi===void 0||hi.update(_i=>{_i.trySetUniformFloat("u_blend",this._currentDuration/this._total)})),this.isComplete()&&(this._entity.graphics.material=null))}isComplete(){return this._stopped||this._currentDuration<=0}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class BezierCurve{constructor(ci){var hi;if(this._distLookup=[],this.quality=4,ci.controlPoints.length!==4)throw new Error("Only cubic bezier curves are supported");this._controlPoints=[...ci.controlPoints],this.quality=(hi=ci.quality)!==null&&hi!==void 0?hi:this.quality,this._calculateLookup()}get arcLength(){return this._arcLength}get controlPoints(){return this._controlPoints}set controlPoints(ci){this._controlPoints=[...ci],this._calculateLookup()}setControlPoint(ci,hi){this._controlPoints[ci]=hi,this._calculateLookup()}_calculateLookup(){let ci=0;this._distLookup.length=0;let hi=this.controlPoints[0];const _i=this.controlPoints.length*this.quality;for(let pi=0;pi<_i;pi++){const gi=pi/(_i-1),mi=this.getPoint(gi),xi=hi.distance(mi);ci+=xi,this._distLookup.push(ci),hi=mi}this._arcLength=ci}_getTimeGivenDistance(ci){const hi=this._distLookup.length,_i=this.arcLength;if(ci>=0&&ci<_i){for(let pi=0;pi<hi-1;pi++)if(this._distLookup[pi]<=ci&&ci<this._distLookup[pi+1])return remap(this._distLookup[pi],this._distLookup[pi+1],pi/(hi-1),(pi+1)/(hi-1),ci)}return ci/_i}getPoint(ci){const hi=[...this.controlPoints];for(let _i=1;_i<hi.length;_i++)for(let pi=0;pi<hi.length-_i;pi++)hi[pi]=lerpVector(hi[pi],hi[pi+1],ci);return hi[0]}getTangent(ci){const hi=ci*ci,_i=this.controlPoints[0],pi=this.controlPoints[1],gi=this.controlPoints[2],mi=this.controlPoints[3];return _i.scale(-3*hi+6*ci-3).add(pi.scale(9*hi-12*ci+3).add(gi.scale(-9*hi+6*ci).add(mi.scale(3*hi)))).normalize()}getUniformTangent(ci){const hi=ci*this.arcLength,_i=this._getTimeGivenDistance(hi);return this.getTangent(_i)}getNormal(ci){return this.getTangent(ci).normal()}getUniformNormal(ci){return this.getUniformTangent(ci).normal()}getUniformPoint(ci){const hi=ci*this.arcLength,_i=this._getTimeGivenDistance(hi);return this.getPoint(_i)}clone(){return new BezierCurve({controlPoints:[...this.controlPoints],quality:this.quality})}}class CurveTo{constructor(ci,hi){var _i;if(this.id=nextActionId(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=ci,this._tx=this._entity.get(TransformComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=new BezierCurve({controlPoints:[vec(0,0),...hi.controlPoints],quality:hi.quality}),this._durationMs=hi.duration,this._mode=(_i=hi.mode)!==null&&_i!==void 0?_i:this._mode,this._currentMs=this._durationMs}update(ci){this._started||(this._curve.setControlPoint(0,this._tx.globalPos.clone()),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(hi):this._tx.pos=this._curve.getUniformPoint(hi),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(ci){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0,this._currentMs=0}}class CurveBy{constructor(ci,hi){var _i;if(this.id=nextActionId(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=ci,this._tx=this._entity.get(TransformComponent),!this._tx)throw new Error(`Entity ${ci.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=this._curve=new BezierCurve({controlPoints:[vec(0,0),...hi.controlPoints],quality:hi.quality}),this._durationMs=hi.duration,this._mode=(_i=hi.mode)!==null&&_i!==void 0?_i:this._mode,this._currentMs=this._durationMs}update(ci){this._started||(this._curve.setControlPoint(0,this._tx.globalPos),this._curve.setControlPoint(1,this._curve.controlPoints[1].add(this._tx.globalPos)),this._curve.setControlPoint(2,this._curve.controlPoints[2].add(this._tx.globalPos)),this._curve.setControlPoint(3,this._curve.controlPoints[3].add(this._tx.globalPos)),this._started=!0),this._currentMs-=ci;const hi=clamp(remap(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(hi):this._tx.pos=this._curve.getUniformPoint(hi),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(ci){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0}}class ActionContext{constructor(ci){this._entity=ci,this._queue=new ActionQueue(ci)}getQueue(){return this._queue}update(ci){this._queue.update(ci)}clearActions(){this._queue.clearActions()}runAction(ci){return ci.reset(),this._queue.add(ci),this}curveBy(ci){return this._queue.add(new CurveBy(this._entity,ci)),this}curveTo(ci){return this._queue.add(new CurveTo(this._entity,ci)),this}easeTo(...ci){var hi,_i;let pi=0,gi=0,mi=0,xi=EasingFunctions.Linear;return ci[0]instanceof Vector?(pi=ci[0].x,gi=ci[0].y,mi=ci[1],xi=(hi=ci[2])!==null&&hi!==void 0?hi:xi):(pi=ci[0],gi=ci[1],mi=ci[2],xi=(_i=ci[3])!==null&&_i!==void 0?_i:xi),this._queue.add(new EaseTo(this._entity,pi,gi,mi,xi)),this}easeBy(...ci){var hi,_i;let pi=0,gi=0,mi=0,xi=EasingFunctions.Linear;return ci[0]instanceof Vector?(pi=ci[0].x,gi=ci[0].y,mi=ci[1],xi=(hi=ci[2])!==null&&hi!==void 0?hi:xi):(pi=ci[0],gi=ci[1],mi=ci[2],xi=(_i=ci[3])!==null&&_i!==void 0?_i:xi),this._queue.add(new EaseBy(this._entity,pi,gi,mi,xi)),this}moveTo(ci,hi,_i){let pi=0,gi=0,mi=0;return ci instanceof Vector?(pi=ci.x,gi=ci.y,mi=+(hi??0),this._queue.add(new MoveTo(this._entity,pi,gi,mi))):typeof ci=="number"&&typeof hi=="number"&&typeof _i=="number"?(pi=ci,gi=hi,mi=_i,this._queue.add(new MoveTo(this._entity,pi,gi,mi))):isMoveToOptions(ci)&&this._queue.add(new MoveToWithOptions(this._entity,ci)),this}moveBy(ci,hi,_i){let pi=0,gi=0,mi=0;return ci instanceof Vector&&typeof hi=="number"?(pi=ci.x,gi=ci.y,mi=hi,this._queue.add(new MoveBy(this._entity,pi,gi,mi))):typeof ci=="number"&&typeof hi=="number"&&typeof _i=="number"?(pi=ci,gi=hi,mi=_i,this._queue.add(new MoveBy(this._entity,pi,gi,mi))):isMoveByOptions(ci)&&this._queue.add(new MoveByWithOptions(this._entity,ci)),this}rotateTo(ci,hi,_i){return typeof ci=="number"&&typeof hi=="number"?this._queue.add(new RotateTo(this._entity,ci,hi,_i)):typeof ci=="object"&&this._queue.add(new RotateToWithOptions(this._entity,ci)),this}rotateBy(ci,hi,_i){return typeof ci=="object"?this._queue.add(new RotateByWithOptions(this._entity,ci)):this._queue.add(new RotateBy(this._entity,ci,hi,_i)),this}scaleTo(ci,hi,_i,pi){let gi=1,mi=1,xi=0,yi=0;return isScaleToOptions(ci)?(this._queue.add(new ScaleToWithOptions(this._entity,ci)),this):(ci instanceof Vector&&hi instanceof Vector&&(gi=ci.x,mi=ci.y,xi=hi.x,yi=hi.y),typeof ci=="number"&&typeof hi=="number"&&(gi=ci,mi=hi,xi=_i,yi=pi),this._queue.add(new ScaleTo(this._entity,gi,mi,xi,yi)),this)}scaleBy(ci,hi,_i){if(isScaleByOptions(ci))return this._queue.add(new ScaleByWithOptions(this._entity,ci)),this;let pi=1,gi=1;return ci instanceof Vector&&(pi=ci.x,gi=ci.y,_i=hi),typeof ci=="number"&&typeof hi=="number"&&(pi=ci,gi=hi),this._queue.add(new ScaleBy(this._entity,pi,gi,_i)),this}blink(ci,hi,_i=1){return this._queue.add(new Blink(this._entity,ci,hi,_i)),this}fade(ci,hi){return this._queue.add(new Fade(this._entity,ci,hi)),this}flash(ci,hi=1e3){return this._queue.add(new Flash(this._entity,ci,hi)),this}delay(ci){return this._queue.add(new Delay(ci)),this}die(){return this._queue.add(new Die(this._entity)),this}callMethod(ci){return this._queue.add(new CallMethod(ci)),this}repeat(ci,hi){return hi?(this._queue.add(new Repeat(this._entity,ci,hi)),this):(this.repeatForever(ci),this)}repeatForever(ci){return this._queue.add(new RepeatForever(this._entity,ci)),this}follow(ci,hi){return hi===void 0?this._queue.add(new Follow(this._entity,ci)):this._queue.add(new Follow(this._entity,ci,hi)),this}meet(ci,hi){return hi===void 0?this._queue.add(new Meet(this._entity,ci)):this._queue.add(new Meet(this._entity,ci,hi)),this}toPromise(){return new Promise(hi=>{this._queue.add(new CallMethod(()=>{hi()}))})}}class ActionsComponent extends Component{constructor(){super(...arguments),this.dependencies=[TransformComponent,MotionComponent],this._ctx=null}onAdd(ci){this._ctx=new ActionContext(ci)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(ci){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(ci)}update(ci){var hi;return(hi=this._ctx)===null||hi===void 0?void 0:hi.update(ci)}clearActions(){var ci;(ci=this._ctx)===null||ci===void 0||ci.clearActions()}curveBy(ci){return this._getCtx().curveBy.apply(this._ctx,[ci])}curveTo(ci){return this._getCtx().curveTo.apply(this._ctx,[ci])}easeTo(...ci){return this._getCtx().easeTo.apply(this._ctx,ci)}easeBy(...ci){return this._getCtx().easeBy.apply(this._ctx,ci)}moveTo(ci,hi,_i){return this._getCtx().moveTo.apply(this._ctx,[ci,hi,_i])}moveBy(ci,hi,_i){return this._getCtx().moveBy.apply(this._ctx,[ci,hi,_i])}rotateTo(ci,hi,_i){return this._getCtx().rotateTo.apply(this._ctx,[ci,hi,_i])}rotateBy(ci,hi,_i){return this._getCtx().rotateBy.apply(this._ctx,[ci,hi,_i])}scaleTo(ci,hi,_i,pi){return this._getCtx().scaleTo.apply(this._ctx,[ci,hi,_i,pi])}scaleBy(ci,hi,_i){return this._getCtx().scaleBy.apply(this._ctx,[ci,hi,_i])}blink(ci,hi,_i){return this._getCtx().blink(ci,hi,_i)}fade(ci,hi){return this._getCtx().fade(ci,hi)}flash(ci,hi=1e3){return this._getCtx().flash(ci,hi)}delay(ci){return this._getCtx().delay(ci)}die(){return this._getCtx().die()}callMethod(ci){return this._getCtx().callMethod(ci)}repeat(ci,hi){return this._getCtx().repeat(ci,hi)}repeatForever(ci){return this._getCtx().repeatForever(ci)}follow(ci,hi){return this._getCtx().follow(ci,hi)}meet(ci,hi){return this._getCtx().meet(ci,hi)}toPromise(){return this._getCtx().toPromise()}}function isActor(fi){return fi instanceof Actor}const ActorEvents={CollisionStart:"collisionstart",CollisionEnd:"collisionend",PreCollision:"precollision",PostCollision:"postcollision",Kill:"kill",PreKill:"prekill",PostKill:"postkill",PreDraw:"predraw",PostDraw:"postdraw",PreTransformDraw:"pretransformdraw",PostTransformDraw:"posttransformdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerEnter:"pointerenter",PointerLeave:"pointerleave",PointerMove:"pointermove",PointerCancel:"pointercancel",Wheel:"pointerwheel",PointerDrag:"pointerdragstart",PointerDragEnd:"pointerdragend",PointerDragEnter:"pointerdragenter",PointerDragLeave:"pointerdragleave",PointerDragMove:"pointerdragmove",EnterViewPort:"enterviewport",ExitViewPort:"exitviewport",ActionStart:"actionstart",ActionComplete:"actioncomplete"};class Actor extends Entity{get pos(){return this.transform.pos}set pos(ci){this.transform.pos=ci.clone()}get oldPos(){return this.body.oldPos}get oldGlobalPos(){return this.body.oldGlobalPos}set oldPos(ci){this.body.oldPos.setTo(ci.x,ci.y)}get vel(){return this.motion.vel}set vel(ci){this.motion.vel=ci.clone()}get oldVel(){return this.body.oldVel}set oldVel(ci){this.body.oldVel.setTo(ci.x,ci.y)}get acc(){return this.motion.acc}set acc(ci){this.motion.acc=ci.clone()}set oldAcc(ci){this.body.oldAcc.setTo(ci.x,ci.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(ci){this.transform.rotation=ci}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(ci){this.motion.angularVelocity=ci}get scale(){return this.get(TransformComponent).scale}set scale(ci){this.get(TransformComponent).scale=ci}get anchor(){return this._anchor}set anchor(ci){this._anchor=watch(ci,hi=>this._handleAnchorChange(hi)),this._handleAnchorChange(ci)}_handleAnchorChange(ci){this.graphics&&(this.graphics.anchor=ci)}get offset(){return this._offset}set offset(ci){this._offset=watch(ci,hi=>this._handleOffsetChange(hi)),this._handleOffsetChange(ci)}_handleOffsetChange(ci){this.graphics&&(this.graphics.offset=ci)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(ci){ci&&(ci&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!ci&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=ci)}get color(){return this.graphics.color}set color(ci){this.graphics.color=ci}constructor(ci){super(),this.events=new EventEmitter,this._anchor=watch(Vector.Half,Ji=>this._handleAnchorChange(Ji)),this._offset=watch(Vector.Zero,Ji=>this._handleOffsetChange(Ji)),this.logger=Logger.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=Ji=>{this._dragging&&(this.pos=Ji.worldPos)},this._pointerDragLeaveHandler=Ji=>{this._dragging&&(this.pos=Ji.worldPos)};const{name:hi,x:_i,y:pi,pos:gi,coordPlane:mi,scale:xi,width:yi,height:Ci,radius:Ei,collider:Ai,vel:ki,acc:Pi,rotation:Ii,angularVelocity:Di,z:Fi,color:Li,visible:Bi,opacity:Ri,anchor:$i,offset:Ni,collisionType:ji,collisionGroup:Ui,silenceWarnings:qi}={...ci};this.name=hi??this.name,this.anchor=$i??Actor.defaults.anchor.clone(),this.offset=Ni??Vector.Zero,this.transform=new TransformComponent,this.addComponent(this.transform),this.pos=gi??vec(_i??0,pi??0),this.rotation=Ii??0,this.scale=xi??vec(1,1),this.z=Fi??0,this.transform.coordPlane=mi??CoordPlane.World,this._silenceWarnings=qi??!1,this.pointer=new PointerComponent,this.addComponent(this.pointer),this.graphics=new GraphicsComponent({anchor:this.anchor,offset:this.offset,opacity:Ri}),this.addComponent(this.graphics),this.motion=new MotionComponent,this.addComponent(this.motion),this.vel=ki??Vector.Zero,this.acc=Pi??Vector.Zero,this.angularVelocity=Di??0,this.actions=new ActionsComponent,this.addComponent(this.actions),this.body=new BodyComponent,this.addComponent(this.body),this.body.collisionType=ji??CollisionType.Passive,Ui&&(this.body.group=Ui),Li&&(this.color=Li),Ai?(this.collider=new ColliderComponent(Ai),this.addComponent(this.collider)):Ei?(this.collider=new ColliderComponent(Shape.Circle(Ei)),this.addComponent(this.collider),Li&&this.graphics.add(new Circle({color:Li,radius:Ei}))):yi>0&&Ci>0?(this.collider=new ColliderComponent(Shape.Box(yi,Ci,this.anchor)),this.addComponent(this.collider),Li&&yi&&Ci&&this.graphics.add(new Rectangle({color:Li,width:yi,height:Ci}))):(this.collider=new ColliderComponent,this.addComponent(this.collider)),this.graphics.isVisible=Bi??!0}clone(){const ci=new Actor({silenceWarnings:this._silenceWarnings,color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});ci.clearComponents(),ci.processComponentRemoval(),ci.addComponent(ci.transform=this.transform.clone(),!0),ci.addComponent(ci.pointer=this.pointer.clone(),!0),ci.addComponent(ci.graphics=this.graphics.clone(),!0),ci.addComponent(ci.motion=this.motion.clone(),!0),ci.addComponent(ci.actions=this.actions.clone(),!0),ci.addComponent(ci.body=this.body.clone(),!0),ci.addComponent(ci.collider=this.collider.clone(),!0);const hi=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],_i=this.getComponents();for(const pi of _i)hi.includes(pi)||ci.addComponent(pi.clone(),!0);return ci}onInitialize(ci){}_initialize(ci){super._initialize(ci);for(const hi of this.children)hi._initialize(ci)}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}_prekill(ci){this.events.emit("prekill",new PreKillEvent(this)),this.onPreKill(ci)}onPreKill(ci){}_postkill(ci){this.events.emit("postkill",new PostKillEvent(this)),this.onPostKill(ci)}onPostKill(ci){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new KillEvent(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.isActive=!0}isKilled(){return!this.isActive}get z(){return this.get(TransformComponent).z}set z(ci){this.get(TransformComponent).z=ci}get center(){const ci=this.getGlobalPos();return new Vector(ci.x+this.width/2-this.anchor.x*this.width,ci.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new Vector(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(TransformComponent).globalRotation}get globalRotation(){return this.get(TransformComponent).globalRotation}getGlobalPos(){return this.get(TransformComponent).globalPos}get globalPos(){return this.get(TransformComponent).globalPos}getGlobalScale(){return this.get(TransformComponent).globalScale}get globalScale(){return this.get(TransformComponent).globalScale}get globalZ(){return this.get(TransformComponent).globalZ}contains(ci,hi,_i=!1){const pi=vec(ci,hi),gi=this.get(ColliderComponent);gi.update();const mi=gi.get();if(!mi)return!1;const xi=mi.contains(pi);return _i?xi||this.children.some(yi=>yi.contains(ci,hi,!0)):xi}within(ci,hi){const _i=this.get(ColliderComponent),pi=ci.get(ColliderComponent),gi=_i.get(),mi=pi.get();return gi&&mi?gi.getClosestLineBetween(mi).getLength()<=hi:!1}update(ci,hi){this._initialize(ci),this._add(ci),this._preupdate(ci,hi),this._postupdate(ci,hi),this._remove(ci)}onPreUpdate(ci,hi){}onPostUpdate(ci,hi){}onPreCollisionResolve(ci,hi,_i,pi){}onPostCollisionResolve(ci,hi,_i,pi){}onCollisionStart(ci,hi,_i,pi){}onCollisionEnd(ci,hi,_i,pi){}_preupdate(ci,hi){this.events.emit("preupdate",new PreUpdateEvent(ci,hi,this)),this.onPreUpdate(ci,hi)}_postupdate(ci,hi){this.events.emit("postupdate",new PostUpdateEvent(ci,hi,this)),this.onPostUpdate(ci,hi)}}Actor.defaults={anchor:Vector.Half};function isScreenElement(fi){return fi instanceof ScreenElement}class ScreenElement extends Actor{constructor(ci){var hi,_i;super({...ci}),this.get(TransformComponent).coordPlane=CoordPlane.Screen,this.anchor=(hi=ci==null?void 0:ci.anchor)!==null&&hi!==void 0?hi:vec(0,0),this.body.collisionType=(_i=ci==null?void 0:ci.collisionType)!==null&&_i!==void 0?_i:CollisionType.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(ci!=null&&ci.collider)&&(ci==null?void 0:ci.width)>0&&(ci==null?void 0:ci.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(ci){this._engine=ci,super._initialize(ci)}contains(ci,hi,_i=!0){if(_i)return super.contains(ci,hi);const pi=this._engine.worldToScreenCoordinates(new Vector(ci,hi));return super.contains(pi.x,pi.y)}}class Timer{get complete(){return this._complete}constructor(ci){var hi;this._logger=Logger.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null;const _i=(hi=ci.action)!==null&&hi!==void 0?hi:ci.fcn,pi=ci.interval,gi=ci.repeats,mi=ci.numberOfRepeats,xi=ci.randomRange,yi=ci.random;if(mi&&mi>=0&&(this.maxNumberOfRepeats=mi,!gi))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Timer._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=pi,xi){if(xi[0]>xi[1])throw new Error("min value must be lower than max value for range");this.random=yi??new Random,this.randomRange=xi,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=gi||this.repeats,_i&&this.on(_i)}on(ci){this._callbacks.push(ci)}off(ci){const hi=this._callbacks.indexOf(ci);this._callbacks.splice(hi,1)}update(ci){this._running&&(this._totalTimeAlive+=ci,this._elapsedTime+=ci,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(hi=>{hi.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(ci,hi){if(ci&&ci>=0&&(this._baseInterval=this.interval=ci),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=hi,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}Timer._MAX_ID=0;class ParallaxComponent extends Component{constructor(ci){super(),this.parallaxFactor=vec(1,1),this.parallaxFactor=ci??this.parallaxFactor}}class DebugGraphicsComponent extends Component{constructor(ci,hi=!0){super(),this.draw=ci,this.useTransform=hi}}function hasNestedEvents(fi){return fi&&fi._dispatchPointerEvents&&fi._processPointerToObject}class PointerTargetObjectProxy{get events(){return this.object.events}init(ci,hi,_i){this.object=ci,this.contains=hi,this.active=_i}}class PointerEventsToObjectDispatcher{constructor(){this._proxyPool=new RentalPool(()=>new PointerTargetObjectProxy,ci=>ci,100),this._objectToProxy=new Map,this._proxies=[],this._lastFrameObjectToPointers=new Map,this._currentFrameObjectToPointers=new Map}addObject(ci,hi,_i){const pi=this._proxyPool.rent(!1);pi.init(ci,hi,_i),this._proxies.push(pi),this._objectToProxy.set(ci,pi)}_getProxy(ci){const hi=this._objectToProxy.get(ci);if(hi)return hi;throw new Error("No PointerTargetProxy for object")}removeObject(ci){const hi=this._objectToProxy.get(ci);if(hi){const _i=this._proxies.indexOf(hi);_i>-1&&this._proxies.splice(_i,1),this._proxyPool.return(hi)}}_objectCurrentlyUnderPointer(ci,hi){return!!(this._currentFrameObjectToPointers.has(ci)&&this._currentFrameObjectToPointers.get(ci).includes(hi))}_objectWasUnderPointer(ci,hi){return!!(this._lastFrameObjectToPointers.has(ci)&&this._lastFrameObjectToPointers.get(ci).includes(hi))}_entered(ci,hi){return this._objectCurrentlyUnderPointer(ci,hi)&&!this._lastFrameObjectToPointers.has(ci)}_left(ci,hi){return!this._currentFrameObjectToPointers.has(ci)&&this._objectWasUnderPointer(ci,hi)}addPointerToObject(ci,hi){const _i=this._objectToProxy.get(ci);_i&&this._addPointerToProxy(_i,hi)}_addPointerToProxy(ci,hi){if(!this._currentFrameObjectToPointers.has(ci)){this._currentFrameObjectToPointers.set(ci,[hi]);return}const _i=this._currentFrameObjectToPointers.get(ci);this._currentFrameObjectToPointers.set(ci,_i.concat(hi))}dispatchEvents(ci,hi){const _i=new Set(this._lastFrameObjectToPointers.keys()),pi=new Set(this._currentFrameObjectToPointers.keys());let gi,mi,xi;for(let yi=0;yi<hi.length;yi++){const Ci=hi[yi],Ei=this._getProxy(Ci);if(hasNestedEvents(Ci)&&Ci._dispatchPointerEvents(ci),_i.has(Ei)||pi.has(Ei)){xi=this._processDownAndEmit(ci,Ei),mi=this._processUpAndEmit(ci,Ei),gi=this._processMoveAndEmit(ci,Ei);const Ai=[...gi.values(),...xi.values(),...mi.values()];this._processEnterLeaveAndEmit(ci,Ei,Ai),this._processCancelAndEmit(ci,Ei),this._processWheelAndEmit(ci,Ei)}}}processPointerToObject(ci,hi){for(let _i=0;_i<hi.length;_i++){const pi=hi[_i],gi=this._getProxy(pi);hasNestedEvents(pi)&&pi._processPointerToObject(ci);for(const[mi,xi]of ci.currentFramePointerCoords.entries())gi.contains(xi)&&this._addPointerToProxy(gi,mi)}}clear(){this._lastFrameObjectToPointers.clear(),this._lastFrameObjectToPointers=new Map(this._currentFrameObjectToPointers),this._currentFrameObjectToPointers.clear()}_processDownAndEmit(ci,hi){const _i=new Map;for(const pi of ci.currentFrameDown)pi.active&&this._objectCurrentlyUnderPointer(hi,pi.pointerId)&&(hi.events.emit("pointerdown",pi),ci.isDragStart(pi.pointerId)&&hi.events.emit("pointerdragstart",pi)),_i.set(pi.pointerId,pi);return _i}_processUpAndEmit(ci,hi){const _i=new Map;for(const pi of ci.currentFrameUp)pi.active&&this._objectCurrentlyUnderPointer(hi,pi.pointerId)&&(hi.events.emit("pointerup",pi),ci.isDragEnd(pi.pointerId)&&hi.events.emit("pointerdragend",pi)),_i.set(pi.pointerId,pi);return _i}_processMoveAndEmit(ci,hi){const _i=new Map;for(const pi of ci.currentFrameMove)pi.active&&hi.active()&&this._objectCurrentlyUnderPointer(hi,pi.pointerId)&&(hi.events.emit("pointermove",pi),ci.isDragging(pi.pointerId)&&hi.events.emit("pointerdragmove",pi)),_i.set(pi.pointerId,pi);return _i}_processEnterLeaveAndEmit(ci,hi,_i){for(const pi of _i){if(pi.active&&hi.active()&&this._entered(hi,pi.pointerId)){hi.events.emit("pointerenter",pi),ci.isDragging(pi.pointerId)&&hi.events.emit("pointerdragenter",pi);break}if(pi.active&&hi.active()&&(this._left(hi,pi.pointerId)||this._objectCurrentlyUnderPointer(hi,pi.pointerId)&&pi.type==="up")){hi.events.emit("pointerleave",pi),ci.isDragging(pi.pointerId)&&hi.events.emit("pointerdragleave",pi);break}}}_processCancelAndEmit(ci,hi){for(const _i of ci.currentFrameCancel)_i.active&&hi.active()&&this._objectCurrentlyUnderPointer(hi,_i.pointerId)&&hi.events.emit("pointercancel",_i)}_processWheelAndEmit(ci,hi){for(const _i of ci.currentFrameWheel)_i.active&&hi.active()&&this._objectCurrentlyUnderPointer(hi,0)&&hi.events.emit("pointerwheel",_i)}}const TileMapEvents={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerMove:"pointermove",PointerCancel:"pointercancel"};class TileMap extends Entity{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let ci=0;ci<this.tiles.length;ci++)this.tiles[ci]&&this.tiles[ci].flagDirty()}get x(){var ci;return(ci=this.transform.pos.x)!==null&&ci!==void 0?ci:0}set x(ci){var hi;!((hi=this.transform)===null||hi===void 0)&&hi.pos&&(this.get(TransformComponent).pos=vec(ci,this.y))}get y(){var ci,hi;return(hi=(ci=this.transform)===null||ci===void 0?void 0:ci.pos.y)!==null&&hi!==void 0?hi:0}set y(ci){var hi;!((hi=this.transform)===null||hi===void 0)&&hi.pos&&(this.transform.pos=vec(this.x,ci))}get z(){var ci;return(ci=this.transform.z)!==null&&ci!==void 0?ci:0}set z(ci){this.transform&&(this.transform.z=ci)}get rotation(){var ci,hi;return(hi=(ci=this.transform)===null||ci===void 0?void 0:ci.rotation)!==null&&hi!==void 0?hi:0}set rotation(ci){this.transform&&(this.transform.rotation=ci)}get scale(){var ci,hi;return(hi=(ci=this.transform)===null||ci===void 0?void 0:ci.scale)!==null&&hi!==void 0?hi:Vector.One}set scale(ci){var hi;!((hi=this.transform)===null||hi===void 0)&&hi.scale&&(this.transform.scale=ci)}get pos(){return this.transform.pos}set pos(ci){this.transform.pos=ci}get vel(){return this._motion.vel}set vel(ci){this._motion.vel=ci}get width(){return this.tileWidth*this.columns*this.scale.x}get height(){return this.tileHeight*this.rows*this.scale.y}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}constructor(ci){var hi,_i,pi;super([],ci.name),this.events=new EventEmitter,this._token=0,this.logger=Logger.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._oldRotation=0,this._originalOffsets=new WeakMap,this.meshingLookBehind=(hi=ci.meshingLookBehind)!==null&&hi!==void 0?hi:this.meshingLookBehind,this.addComponent(new TransformComponent),this.addComponent(new MotionComponent),this.addComponent(new BodyComponent({type:CollisionType.Fixed})),this.addComponent(new GraphicsComponent({onPostDraw:(mi,xi)=>this.draw(mi,xi)})),this.addComponent(new DebugGraphicsComponent((mi,xi)=>this.debug(mi,xi),!1)),this.addComponent(new ColliderComponent),this.addComponent(new PointerComponent),this.pointer=this.get(PointerComponent),this._graphics=this.get(GraphicsComponent),this.transform=this.get(TransformComponent),this._motion=this.get(MotionComponent),this.collider=this.get(ColliderComponent),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(_i=ci.pos)!==null&&_i!==void 0?_i:Vector.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(pi=ci.renderFromTopOfGraphic)!==null&&pi!==void 0?pi:this.renderFromTopOfGraphic,this.tileWidth=ci.tileWidth,this.tileHeight=ci.tileHeight,this.rows=ci.rows,this.columns=ci.columns,this._pointerEventDispatcher=new PointerEventsToObjectDispatcher,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let gi=[];for(let mi=0;mi<this.columns;mi++){for(let xi=0;xi<this.rows;xi++){const yi=new Tile({x:mi,y:xi,map:this});yi.map=this,this.tiles[mi+xi*this.columns]=yi,this._pointerEventDispatcher.addObject(yi,Ci=>yi.bounds.contains(Ci.worldPos),()=>!0),gi.push(yi),this._rows[xi]||(this._rows[xi]=[]),this._rows[xi].push(yi)}this._cols[mi]=gi,gi=[]}this._graphics.localBounds=new BoundingBox({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(ci){super._initialize(ci),this._engine=ci}_getOrSetColliderOriginalOffset(ci){var hi;if(this._originalOffsets.has(ci))return(hi=this._originalOffsets.get(ci))!==null&&hi!==void 0?hi:Vector.Zero;{const _i=ci.offset;return this._originalOffsets.set(ci,_i),_i}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const ci=[];this._composite=this.collider.useCompositeCollider([]);let hi=null;const _i=(gi,mi)=>gi&&mi?gi.top===mi.top&&gi.bottom===mi.bottom&&gi.right===mi.left:!1,pi=(gi,mi,xi=this.meshingLookBehind)=>{if(!gi)return!1;for(let yi=mi.length-1;yi>=0;yi--){if(xi--<0)return!1;const Ci=mi[yi];if(_i(Ci,gi))return mi[yi]=Ci.combine(gi),!0}return!1};for(let gi=0;gi<this.columns;gi++){for(let mi=0;mi<this.rows;mi++){const xi=this.tiles[gi+mi*this.columns];if(xi.solid)if(xi.getColliders().length>0){for(const yi of xi.getColliders()){const Ci=this._getOrSetColliderOriginalOffset(yi);yi.offset=vec(xi.x*this.tileWidth*this.scale.x,xi.y*this.tileHeight*this.scale.y).add(Ci),yi.owner=this,this._composite.addCollider(yi)}hi&&!pi(hi,ci)&&ci.push(hi),hi=null}else hi?hi=hi.combine(xi.defaultGeometry):hi=xi.defaultGeometry;else hi&&!pi(hi,ci)&&ci.push(hi),hi=null}hi&&!pi(hi,ci)&&ci.push(hi),hi=null}for(const gi of ci){const mi=Shape.Box(gi.width,gi.height,Vector.Zero,vec(gi.left-this.pos.x,gi.top-this.pos.y));mi.owner=this,this._composite.addCollider(mi)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(ci){var hi;return(hi=this.tiles[ci])!==null&&hi!==void 0?hi:null}getTile(ci,hi){return ci<0||hi<0||ci>=this.columns||hi>=this.rows?null:this.tiles[ci+hi*this.columns]}getTileByPoint(ci){const{x:hi,y:_i}=this._getTileCoordinates(ci),pi=this.getTile(hi,_i);return hi>=0&&_i>=0&&hi<this.columns&&_i<this.rows&&pi?pi:null}_getTileCoordinates(ci){ci=this.transform.applyInverse(ci);const hi=Math.floor(ci.x/this.tileWidth),_i=Math.floor(ci.y/this.tileHeight);return{x:hi,y:_i}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){let ci=this._engine.screen.getWorldBounds();const hi=this.get(ParallaxComponent);if(hi&&this.isInitialized){let Pi=this.pos;const Ii=Vector.One.sub(hi.parallaxFactor),Di=this._engine.currentScene.camera.pos.scale(Ii);Pi=Pi.sub(Di),ci=ci.translate(Pi)}const _i=this.transform.coordPlane===CoordPlane.Screen?this._engine.screen.getScreenBounds():ci,pi=this._getTileCoordinates(_i.topLeft),gi=this._getTileCoordinates(_i.topRight),mi=this._getTileCoordinates(_i.bottomRight),xi=this._getTileCoordinates(_i.bottomLeft),yi=Math.min(clamp(pi.x,0,this.columns-1),clamp(gi.x,0,this.columns-1)),Ci=Math.min(clamp(pi.y,0,this.rows-1),clamp(gi.y,0,this.rows-1)),Ei=Math.max(clamp(mi.x,0,this.columns-1),clamp(xi.x,0,this.columns-1)),Ai=Math.max(clamp(mi.y,0,this.rows-1),clamp(xi.y,0,this.rows-1)),ki=[];for(let Pi=yi;Pi<=Ei;Pi++)for(let Ii=Ci;Ii<=Ai;Ii++)ki.push(this.getTile(Pi,Ii));return ki}_processPointerToObject(ci){this._pointerEventDispatcher.processPointerToObject(ci,this.tiles)}_dispatchPointerEvents(ci){this._pointerEventDispatcher.dispatchEvents(ci,this.tiles)}update(ci,hi){this._initialize(ci),this.onPreUpdate(ci,hi),this.emit("preupdate",new PreUpdateEvent(ci,hi,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._pointerEventDispatcher.clear(),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(ci,hi),this.emit("postupdate",new PostUpdateEvent(ci,hi,this))}draw(ci,hi){if(!this.isInitialized)return;this.emit("predraw",new PreDrawEvent(ci,hi,this));let _i,pi,gi;const mi=this.getOnScreenTiles();for(let xi=0;xi<mi.length;xi++){const yi=mi[xi],Ci=yi.getGraphicsOffsets();for(_i=yi.getGraphics(),pi=0,gi=_i.length;pi<gi;pi++){const Ei=_i[pi],Ai=Ci[pi];if(Ei){hasGraphicsTick(Ei)&&(Ei==null||Ei.tick(hi,this._token));const ki=this.renderFromTopOfGraphic?0:Ei.height-this.tileHeight;Ei.draw(ci,yi.x*this.tileWidth+Ai.x,yi.y*this.tileHeight-ki+Ai.y)}}}this.emit("postdraw",new PostDrawEvent(ci,hi,this))}debug(ci,hi){const{showAll:_i,showGrid:pi,gridColor:gi,gridWidth:mi,showSolidBounds:xi,solidBoundsColor:yi,showColliderGeometry:Ci}=hi.tilemap,{geometryColor:Ei,geometryLineWidth:Ai,geometryPointSize:ki}=hi.collider,Pi=this.tileWidth*this.columns*this.scale.x,Ii=this.tileHeight*this.rows*this.scale.y,Di=this.pos;if(pi||_i){for(let Fi=0;Fi<this.rows+1;Fi++){const Li=vec(0,Fi*this.tileHeight*this.scale.y);ci.drawLine(Di.add(Li),Di.add(vec(Pi,Li.y)),gi,mi)}for(let Fi=0;Fi<this.columns+1;Fi++){const Li=vec(Fi*this.tileWidth*this.scale.x,0);ci.drawLine(Di.add(Li),Di.add(vec(Li.x,Ii)),gi,mi)}}if(_i||xi||Ci){const Fi=this._composite.getColliders();ci.save(),ci.translate(this.pos.x,this.pos.y),ci.scale(this.scale.x,this.scale.y);for(const Li of Fi){const Bi=Li.localBounds,Ri=Li.worldPos.sub(this.pos);xi&&ci.drawRectangle(Ri,Bi.width,Bi.height,yi)}if(ci.restore(),Ci)for(const Li of Fi)Li.debug(ci,Ei,{lineWidth:Ai,pointSize:ki})}if(_i||xi){if(ci.save(),ci.z=999,xi)for(let Fi=0;Fi<this.tiles.length;Fi++)this.tiles[Fi].bounds.draw(ci);ci.restore()}}}class Tile{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(ci){var hi;(hi=this.map)===null||hi===void 0||hi.flagCollidersDirty(),this._solid=ci}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(ci,hi){this._graphics.push(ci),hi!=null&&hi.offset?this._offsets.push(hi.offset):this._offsets.push(Vector.Zero)}removeGraphic(ci){const hi=this._graphics.indexOf(ci);hi>-1&&(this._graphics.splice(hi,1),this._offsets.splice(hi,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(ci){this._colliders.push(ci),this.map.flagCollidersDirty()}removeCollider(ci){const hi=this._colliders.indexOf(ci);hi>-1&&this._colliders.splice(hi,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(ci){var hi,_i;this._posDirty=!1,this.events=new EventEmitter,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map,this.x=ci.x,this.y=ci.y,this.map=ci.map,this._width=ci.map.tileWidth*this.map.scale.x,this._height=ci.map.tileHeight*this.map.scale.y,this.solid=(hi=ci.solid)!==null&&hi!==void 0?hi:this.solid,this._graphics=(_i=ci.graphics)!==null&&_i!==void 0?_i:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){const ci=this.map.pos.add(vec(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new BoundingBox(ci.x,ci.y,ci.x+this.map.tileWidth,ci.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(vec(this.x*this._width,this.y*this._height)),this._bounds=new BoundingBox(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new Vector(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){hi?this.events.off(ci,hi):this.events.off(ci)}}class StrategyContainer{constructor(ci){this.camera=ci}lockToActor(ci){this.camera.addStrategy(new LockCameraToActorStrategy(ci))}lockToActorAxis(ci,hi){this.camera.addStrategy(new LockCameraToActorAxisStrategy(ci,hi))}elasticToActor(ci,hi,_i){this.camera.addStrategy(new ElasticToActorStrategy(ci,hi,_i))}radiusAroundActor(ci,hi){this.camera.addStrategy(new RadiusAroundActorStrategy(ci,hi))}limitCameraBounds(ci){this.camera.addStrategy(new LimitCameraBoundsStrategy(ci))}}var Axis;(function(fi){fi[fi.X=0]="X",fi[fi.Y=1]="Y"})(Axis||(Axis={}));class LockCameraToActorStrategy{constructor(ci){this.target=ci,this.action=(hi,_i,pi,gi)=>hi.center}}class LockCameraToActorAxisStrategy{constructor(ci,hi){this.target=ci,this.axis=hi,this.action=(_i,pi,gi,mi)=>{const xi=_i.center,yi=pi.getFocus();return this.axis===Axis.X?new Vector(xi.x,yi.y):new Vector(yi.x,xi.y)}}}class ElasticToActorStrategy{constructor(ci,hi,_i){this.target=ci,this.cameraElasticity=hi,this.cameraFriction=_i,this.action=(pi,gi,mi,xi)=>{const yi=pi.center;let Ci=gi.getFocus(),Ei=gi.vel.clone();const Ai=yi.sub(Ci).scale(this.cameraElasticity);Ei=Ei.add(Ai);const ki=Ei.scale(-1).scale(this.cameraFriction);return Ei=Ei.add(ki),Ci=Ci.add(Ei),Ci}}}class RadiusAroundActorStrategy{constructor(ci,hi){this.target=ci,this.radius=hi,this.action=(_i,pi,gi,mi)=>{const xi=_i.center,yi=pi.getFocus(),Ci=xi.sub(yi),Ei=Ci.magnitude;if(Ei>=this.radius){const Ai=Ei-this.radius;return yi.add(Ci.normalize().scale(Ai))}return yi}}}class LimitCameraBoundsStrategy{constructor(ci){this.target=ci,this.boundSizeChecked=!1,this.action=(hi,_i,pi,gi)=>{const mi=_i.getFocus();this.boundSizeChecked||((hi.bottom-hi.top<pi.drawHeight||hi.right-hi.left<pi.drawWidth)&&Logger.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let xi=mi.x,yi=mi.y;return mi.x<hi.left+pi.halfDrawWidth?xi=hi.left+pi.halfDrawWidth:mi.x>hi.right-pi.halfDrawWidth&&(xi=hi.right-pi.halfDrawWidth),mi.y<hi.top+pi.halfDrawHeight?yi=hi.top+pi.halfDrawHeight:mi.y>hi.bottom-pi.halfDrawHeight&&(yi=hi.bottom-pi.halfDrawHeight),vec(xi,yi)}}}const CameraEvents={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class Camera{constructor(){this.events=new EventEmitter,this.transform=AffineMatrix.identity(),this.inverse=AffineMatrix.identity(),this._cameraStrategies=[],this.strategy=new StrategyContainer(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=new WatchVector(Vector.Zero,()=>{this._posChanged=!0}),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=Vector.Zero,this.acc=Vector.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=EasingFunctions.EaseInOutCubic,this._easing=EasingFunctions.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=vec(0,0)}get zoom(){return this._z}set zoom(ci){this._z=ci,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(ci){this._angularVelocity=ci}get pos(){return this._pos}set pos(ci){this._posChanged=!0,this._pos=new WatchVector(ci,()=>{this._posChanged=!0})}hasChanged(){return this._posChanged}get x(){return this.pos.x}set x(ci){!this._follow&&!this._cameraMoving&&(this.pos=vec(ci,this.pos.y))}get y(){return this.pos.y}set y(ci){!this._follow&&!this._cameraMoving&&(this.pos=vec(this.pos.x,ci))}get dx(){return this.vel.x}set dx(ci){this.vel=vec(ci,this.vel.y)}get dy(){return this.vel.y}set dy(ci){this.vel=vec(this.vel.x,ci)}get ax(){return this.acc.x}set ax(ci){this.acc=vec(ci,this.acc.y)}get ay(){return this.acc.y}set ay(ci){this.acc=vec(this.acc.x,ci)}getFocus(){return this.pos}move(ci,hi,_i=EasingFunctions.EaseInOutCubic){if(typeof _i!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(ci):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(ci),this._lerpPromise=new Promise(pi=>{this._lerpResolve=pi}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=hi,this._lerpEnd=ci,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=_i,this._lerpPromise)}shake(ci,hi,_i){this._isShaking=!0,this._shakeMagnitudeX=ci,this._shakeMagnitudeY=hi,this._shakeDuration=_i}zoomOverTime(ci,hi=0,_i=EasingFunctions.EaseInOutCubic){if(this._zoomPromise=new Promise(pi=>{this._zoomResolve=pi}),hi)this._isZooming=!0,this._zoomEasing=_i,this._currentZoomTime=0,this._zoomDuration=hi,this._zoomStart=this.zoom,this._zoomEnd=ci;else return this._isZooming=!1,this.zoom=ci,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new BoundingBox(0,0,0,0)}addStrategy(ci){this._cameraStrategies.push(ci)}removeStrategy(ci){removeItemFromArray(ci,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(ci,hi){this.events.emit("preupdate",new PreUpdateEvent(ci,hi,this)),this.onPreUpdate(ci,hi)}onPreUpdate(ci,hi){}_postupdate(ci,hi){this.events.emit("postupdate",new PostUpdateEvent(ci,hi,this)),this.onPostUpdate(ci,hi)}onPostUpdate(ci,hi){}get isInitialized(){return this._isInitialized}_initialize(ci){if(!this.isInitialized){this._engine=ci,this._screen=ci.screen;const hi=this._screen.contentArea;let _i=vec(hi.width/2,hi.height/2);if(!this._engine.loadingComplete){const pi=this._screen.peekResolution();pi&&(_i=vec(pi.width/2,pi.height/2))}this._halfWidth=_i.x,this._halfHeight=_i.y,this._posChanged||(this.pos=_i),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(ci,ci.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(ci),this.events.emit("initialize",new InitializeEvent(ci,this)),this._isInitialized=!0}}onInitialize(ci){}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}runStrategies(ci,hi){for(const _i of this._cameraStrategies)this.pos=_i.action.call(_i,_i.target,this,ci,hi)}updateViewport(){this._viewport=new BoundingBox(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(ci,hi){if(this._initialize(ci),this._preupdate(ci,hi),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(hi/1e3)),this.zoom+=this.dz*hi/1e3,this.vel=this.vel.add(this.acc.scale(hi/1e3)),this.dz+=this.az*hi/1e3,this.rotation+=this.angularVelocity*hi/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const _i=this._zoomEasing,pi=_i(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=pi,this._currentZoomTime+=hi}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const pi=EasingFunctions.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=pi,this._currentLerpTime+=hi}else{this.pos=this._lerpEnd;const _i=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(_i)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=hi,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(ci,hi),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(ci,hi),this._posChanged=!1}draw(ci){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateTimestep){const hi=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep,_i=this.pos.scale(hi).add(this._oldPos.scale(1-hi));_i.clone(this.drawPos),this.updateTransform(_i)}if(ci.snapToPixel){const hi=this.drawPos.clone(this._snapPos);hi.x=~~(hi.x+pixelSnapEpsilon*sign(hi.x)),hi.y=~~(hi.y+pixelSnapEpsilon*sign(hi.y)),hi.clone(this.drawPos),this.updateTransform(hi)}ci.multiply(this.transform)}updateTransform(ci){const hi=this._screen.resolution.width/this.zoom,_i=this._screen.resolution.height/this.zoom,pi=vec(-ci.x+hi/2+this._xShake,-ci.y+_i/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(hi/2,_i/2),this.transform.rotate(this.rotation),this.transform.translate(-hi/2,-_i/2),this.transform.translate(pi.x,pi.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const TriggerEvents={ExitTrigger:"exit",EnterTrigger:"enter"};class Trigger extends Actor{constructor(ci){var hi,_i,pi,gi;super({...ci}),this.events=new EventEmitter,this.filter=(hi=ci.filter)!==null&&hi!==void 0?hi:()=>!0,this.repeat=(_i=ci.repeat)!==null&&_i!==void 0?_i:-1,this.action=(pi=ci.action)!==null&&pi!==void 0?pi:()=>{},this.target=ci.target,this.graphics.isVisible=(gi=ci.visible)!==null&&gi!==void 0?gi:!1,this.body.collisionType=CollisionType.Passive,this.events.on("collisionstart",({other:mi})=>{this._matchesTarget(mi.owner)&&(this.events.emit("enter",new EnterTriggerEvent(this,mi.owner)),this._dispatchAction(mi.owner),this.repeat===0&&this.kill())}),this.events.on("collisionend",({other:mi})=>{this._matchesTarget(mi.owner)&&this.events.emit("exit",new ExitTriggerEvent(this,mi.owner))})}_matchesTarget(ci){return this.filter(ci)&&(this.target===void 0||this.target===ci)}_dispatchAction(ci){this.repeat!==0&&(this.action.call(this,ci),this.repeat--)}}const SystemPriority={Highest:-1/0,Higher:-5,Average:0,Lower:5,Lowest:1/0};var SystemType;(function(fi){fi.Update="update",fi.Draw="draw"})(SystemType||(SystemType={}));class System{}System.priority=SystemPriority.Average;class EntityManager{constructor(ci){this._world=ci,this.entities=[],this._entityIndex={},this._childAddedHandlerMap=new Map,this._childRemovedHandlerMap=new Map,this._createChildAddedHandler=()=>hi=>{this.addEntity(hi)},this._createChildRemovedHandler=()=>hi=>{this.removeEntity(hi,!1)},this._entitiesToRemove=[]}updateEntities(ci,hi){for(let _i=0;_i<this.entities.length;_i++){const pi=this.entities[_i];pi.update(ci.engine,hi),pi.isActive||this.removeEntity(pi)}}findEntitiesForRemoval(){for(let ci=0;ci<this.entities.length;ci++){const hi=this.entities[ci];hi.isActive||this.removeEntity(hi)}}addEntity(ci){if(ci.isActive=!0,ci.scene=this._world.scene,ci&&!this._entityIndex[ci.id]){this._entityIndex[ci.id]=ci,this.entities.push(ci),this._world.queryManager.addEntity(ci),ci.children.forEach(pi=>{pi.scene=ci.scene,this.addEntity(pi)});const hi=this._createChildAddedHandler();this._childAddedHandlerMap.set(ci,hi);const _i=this._createChildRemovedHandler();this._childRemovedHandlerMap.set(ci,_i),ci.childrenAdded$.subscribe(hi),ci.childrenRemoved$.subscribe(_i)}}removeEntity(ci,hi=!0){var _i,pi;let gi=0;ci instanceof Entity?gi=ci.id:gi=ci;const mi=this._entityIndex[gi];if(mi&&mi.isActive&&(mi.isActive=!1),mi&&hi){this._entitiesToRemove.push(mi);return}if(delete this._entityIndex[gi],mi){mi.scene=null,removeItemFromArray(mi,this.entities),this._world.queryManager.removeEntity(mi),mi.children.forEach(Ci=>{Ci.scene=null,this.removeEntity(Ci,hi)});const xi=this._childAddedHandlerMap.get(mi);xi&&mi.childrenAdded$.unsubscribe(xi);const yi=this._childRemovedHandlerMap.get(mi);yi&&mi.childrenRemoved$.unsubscribe(yi),!((pi=(_i=this._world)===null||_i===void 0?void 0:_i.scene)===null||pi===void 0)&&pi.engine&&this._world.scene.engine.stats.currFrame.actors.killed++}}processEntityRemovals(){for(let ci=0;ci<this._entitiesToRemove.length;ci++){const hi=this._entitiesToRemove[ci];hi.isActive||this.removeEntity(hi,!1)}this._entitiesToRemove.length=0}processComponentRemovals(){for(let ci=0;ci<this.entities.length;ci++)this.entities[ci].processComponentRemoval()}getById(ci){return this._entityIndex[ci]}getByName(ci){return this.entities.filter(hi=>hi.name===ci)}clear(){for(let ci=this.entities.length-1;ci>=0;ci--)this.removeEntity(this.entities[ci])}}class Query{constructor(ci){if(this.requiredComponents=ci,this.components=new Set,this.entities=[],this.entityAdded$=new Observable,this.entityRemoved$=new Observable,ci.length===0)throw new Error("Cannot create query without components");for(const hi of ci)this.components.add(hi);this.id=Query.createId(ci)}static createId(ci){return ci.slice().map(hi=>hi.name).sort().join("-")}checkAndAdd(ci){return!this.entities.includes(ci)&&ci.hasAll(Array.from(this.components))?(this.entities.push(ci),this.entityAdded$.notifyAll(ci),!0):!1}removeEntity(ci){const hi=this.entities.indexOf(ci);hi>-1&&(this.entities.splice(hi,1),this.entityRemoved$.notifyAll(ci))}getEntities(ci){return ci&&this.entities.sort(ci),this.entities}}class TagQuery{constructor(ci){if(this.requiredTags=ci,this.tags=new Set,this.entities=[],this.entityAdded$=new Observable,this.entityRemoved$=new Observable,ci.length===0)throw new Error("Cannot create tag query without tags");for(const hi of ci)this.tags.add(hi);this.id=TagQuery.createId(ci)}static createId(ci){return ci.slice().sort().join("-")}checkAndAdd(ci){return!this.entities.includes(ci)&&ci.hasAllTags(Array.from(this.tags))?(this.entities.push(ci),this.entityAdded$.notifyAll(ci),!0):!1}removeEntity(ci){const hi=this.entities.indexOf(ci);hi>-1&&(this.entities.splice(hi,1),this.entityRemoved$.notifyAll(ci))}getEntities(ci){return ci&&this.entities.sort(ci),this.entities}}class QueryManager{constructor(ci){this._world=ci,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=hi=>_i=>{this.addComponent(hi,_i)},this._createRemoveComponentHandler=hi=>_i=>{this.removeComponent(hi,_i)},this._createAddTagHandler=hi=>_i=>{this.addTag(hi,_i)},this._createRemoveTagHandler=hi=>_i=>{this.removeTag(hi,_i)}}createQuery(ci){const hi=Query.createId(ci);if(this._queries.has(hi))return this._queries.get(hi);const _i=new Query(ci);this._queries.set(_i.id,_i);for(const pi of ci){const gi=this._componentToQueriesIndex.get(pi);gi?gi.push(_i):this._componentToQueriesIndex.set(pi,[_i])}for(const pi of this._world.entities)this.addEntity(pi);return _i}createTagQuery(ci){const hi=TagQuery.createId(ci);if(this._tagQueries.has(hi))return this._tagQueries.get(hi);const _i=new TagQuery(ci);this._tagQueries.set(_i.id,_i);for(const pi of ci){const gi=this._tagToQueriesIndex.get(pi);gi?gi.push(_i):this._tagToQueriesIndex.set(pi,[_i])}for(const pi of this._world.entities)this.addEntity(pi);return _i}addEntity(ci){const hi=this._addComponentHandlers.get(ci),_i=this._removeComponentHandlers.get(ci),pi=hi??this._createAddComponentHandler(ci),gi=_i??this._createRemoveComponentHandler(ci);this._addComponentHandlers.set(ci,pi),this._removeComponentHandlers.set(ci,gi);const mi=this._addTagHandlers.get(ci),xi=this._removeTagHandlers.get(ci),yi=mi??this._createAddTagHandler(ci),Ci=xi??this._createRemoveTagHandler(ci);this._addTagHandlers.set(ci,yi),this._removeTagHandlers.set(ci,Ci);for(const Ei of this._queries.values())Ei.checkAndAdd(ci);for(const Ei of this._tagQueries.values())Ei.checkAndAdd(ci);ci.componentAdded$.subscribe(pi),ci.componentRemoved$.subscribe(gi),ci.tagAdded$.subscribe(yi),ci.tagRemoved$.subscribe(Ci)}removeEntity(ci){const hi=this._addComponentHandlers.get(ci),_i=this._removeComponentHandlers.get(ci);for(const mi of this._queries.values())mi.removeEntity(ci);hi&&ci.componentAdded$.unsubscribe(hi),_i&&ci.componentRemoved$.unsubscribe(_i);const pi=this._addTagHandlers.get(ci),gi=this._removeTagHandlers.get(ci);for(const mi of this._tagQueries.values())mi.removeEntity(ci);pi&&ci.tagAdded$.unsubscribe(pi),gi&&ci.tagRemoved$.unsubscribe(gi)}addComponent(ci,hi){var _i;const pi=(_i=this._componentToQueriesIndex.get(hi.constructor))!==null&&_i!==void 0?_i:[];for(const gi of pi)gi.checkAndAdd(ci)}removeComponent(ci,hi){var _i;const pi=(_i=this._componentToQueriesIndex.get(hi.constructor))!==null&&_i!==void 0?_i:[];for(const gi of pi)gi.removeEntity(ci)}addTag(ci,hi){var _i;const pi=(_i=this._tagToQueriesIndex.get(hi))!==null&&_i!==void 0?_i:[];for(const gi of pi)gi.checkAndAdd(ci)}removeTag(ci,hi){var _i;const pi=(_i=this._tagToQueriesIndex.get(hi))!==null&&_i!==void 0?_i:[];for(const gi of pi)gi.removeEntity(ci)}}function isSystemConstructor(fi){var ci,hi;return!!(fi!=null&&fi.prototype)&&!!(!((hi=(ci=fi==null?void 0:fi.prototype)===null||ci===void 0?void 0:ci.constructor)===null||hi===void 0)&&hi.name)}class SystemManager{constructor(ci){this._world=ci,this.systems=[],this.initialized=!1}get(ci){return this.systems.find(hi=>hi instanceof ci)}addSystem(ci){let hi;ci instanceof System?hi=ci:hi=new ci(this._world),this.systems.push(hi),this.systems.sort((_i,pi)=>_i.constructor.priority-pi.constructor.priority),this.initialized&&hi.initialize&&hi.initialize(this._world,this._world.scene)}removeSystem(ci){removeItemFromArray(ci,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const ci of this.systems)ci.initialize&&ci.initialize(this._world,this._world.scene)}}updateSystems(ci,hi,_i){const pi=this.systems.filter(gi=>gi.systemType===ci);for(const gi of pi)gi.preupdate&&gi.preupdate(hi,_i);for(const gi of pi)gi.update(_i);for(const gi of pi)gi.postupdate&&gi.postupdate(hi,_i)}clear(){for(let ci=this.systems.length-1;ci>=0;ci--)this.removeSystem(this.systems[ci])}}class World{constructor(ci){this.scene=ci,this._logger=Logger.getInstance(),this.queryManager=new QueryManager(this),this.entityManager=new EntityManager(this),this.systemManager=new SystemManager(this)}query(ci){return this.queryManager.createQuery(ci)}queryTags(ci){return this.queryManager.createTagQuery(ci)}update(ci,hi){ci===SystemType.Update&&this.entityManager.updateEntities(this.scene,hi),this.systemManager.updateSystems(ci,this.scene,hi),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(ci){if(ci instanceof Entity){this.entityManager.addEntity(ci);return}if(ci instanceof System||isSystemConstructor(ci)){this.systemManager.addSystem(ci);return}this._logger.warn(`Could not add entity/system ${ci.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get(ci){return this.systemManager.get(ci)}remove(ci,hi=!0){if(ci instanceof Entity){this.entityManager.removeEntity(ci,hi);return}if(ci instanceof System){this.systemManager.removeSystem(ci);return}this._logger.warn(`Could not remove entity/system ${ci.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class MotionSystem extends System{constructor(ci,hi){super(),this.world=ci,this.physics=hi,this.systemType=SystemType.Update,this._physicsConfigDirty=!1,hi.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([TransformComponent,MotionComponent])}update(ci){let hi,_i;const pi=this.query.entities,gi=this.physics.config.substep;for(let mi=0;mi<pi.length;mi++){hi=pi[mi].get(TransformComponent),_i=pi[mi].get(MotionComponent);const xi=pi[mi].get(BodyComponent);if(this._physicsConfigDirty&&xi&&xi.updatePhysicsConfig(this.physics.config.bodies),xi!=null&&xi.isSleeping)continue;const yi=_i.acc.clone();(xi==null?void 0:xi.collisionType)===CollisionType.Active&&(xi!=null&&xi.useGravity)&&yi.addEqual(this.physics.config.gravity),pi[mi].parent||this.captureOldTransformWithChildren(pi[mi]),EulerIntegrator.integrate(hi,_i,yi,ci/gi)}this._physicsConfigDirty=!1}captureOldTransformWithChildren(ci){var hi;(hi=ci.get(BodyComponent))===null||hi===void 0||hi.captureOldTransform();for(let _i=0;_i<ci.children.length;_i++)this.captureOldTransformWithChildren(ci.children[_i])}}MotionSystem.priority=SystemPriority.Higher;class ArcadeSolver{constructor(ci){this.config=ci,this.directionMap=new Map,this.distanceMap=new Map}solve(ci){this.preSolve(ci),ci=ci.filter(_i=>!_i.isCanceled());let hi;switch(this.config.contactSolveBias){case ContactSolveBias.HorizontalFirst:{hi=HorizontalFirst;break}case ContactSolveBias.VerticalFirst:{hi=VerticalFirst;break}default:hi=None}ci.sort((_i,pi)=>{const gi=this.directionMap.get(_i.id),mi=this.directionMap.get(pi.id),xi=this.distanceMap.get(_i.id),yi=this.distanceMap.get(pi.id);return hi[gi]-hi[mi]||xi-yi});for(const _i of ci)this.solvePosition(_i),this.solveVelocity(_i);return this.postSolve(ci),ci}preSolve(ci){for(let _i=0;_i<ci.length;_i++){const pi=ci[_i];if(Math.abs(pi.mtv.x)<1e-4&&Math.abs(pi.mtv.y)<1e-4){pi.cancel();continue}const gi=Side.fromDirection(pi.mtv),mi=pi.mtv.negate(),xi=Math.abs(pi.info.separation);this.distanceMap.set(pi.id,xi),this.directionMap.set(pi.id,gi===Side.Left||gi===Side.Right?"horizontal":"vertical"),pi.colliderA.events.emit("precollision",new PreCollisionEvent(pi.colliderA,pi.colliderB,gi,mi,pi)),pi.colliderB.events.emit("precollision",new PreCollisionEvent(pi.colliderB,pi.colliderA,Side.getOpposite(gi),mi.negate(),pi))}}postSolve(ci){var hi,_i;for(let pi=0;pi<ci.length;pi++){const gi=ci[pi];if(gi.isCanceled())continue;const mi=gi.colliderA,xi=gi.colliderB,yi=(hi=mi.owner)===null||hi===void 0?void 0:hi.get(BodyComponent),Ci=(_i=xi.owner)===null||_i===void 0?void 0:_i.get(BodyComponent);if(yi&&Ci&&(yi.collisionType===CollisionType.Passive||Ci.collisionType===CollisionType.Passive))continue;const Ei=Side.fromDirection(gi.mtv),Ai=gi.mtv.negate();gi.colliderA.events.emit("postcollision",new PostCollisionEvent(gi.colliderA,gi.colliderB,Ei,Ai,gi)),gi.colliderB.events.emit("postcollision",new PostCollisionEvent(gi.colliderB,gi.colliderA,Side.getOpposite(Ei),Ai.negate(),gi))}}solvePosition(ci){var hi,_i;if(!ci.colliderA.bounds.overlaps(ci.colliderB.bounds,1e-4)){ci.cancel();return}if(Math.abs(ci.mtv.x)<1e-4&&Math.abs(ci.mtv.y)<1e-4){ci.cancel();return}let gi=ci.mtv;const mi=ci.colliderA,xi=ci.colliderB,yi=(hi=mi.owner)===null||hi===void 0?void 0:hi.get(BodyComponent),Ci=(_i=xi.owner)===null||_i===void 0?void 0:_i.get(BodyComponent);if(yi&&Ci){if(yi.collisionType===CollisionType.Passive||Ci.collisionType===CollisionType.Passive)return;yi.collisionType===CollisionType.Active&&Ci.collisionType===CollisionType.Active&&(gi=gi.scale(.5)),yi.collisionType===CollisionType.Active&&(yi.globalPos.x-=gi.x,yi.globalPos.y-=gi.y,mi.update(yi.transform.get())),Ci.collisionType===CollisionType.Active&&(Ci.globalPos.x+=gi.x,Ci.globalPos.y+=gi.y,xi.update(Ci.transform.get()))}}solveVelocity(ci){var hi,_i;if(ci.isCanceled())return;const pi=ci.colliderA,gi=ci.colliderB,mi=(hi=pi.owner)===null||hi===void 0?void 0:hi.get(BodyComponent),xi=(_i=gi.owner)===null||_i===void 0?void 0:_i.get(BodyComponent);if(mi&&xi){if(mi.collisionType===CollisionType.Passive||xi.collisionType===CollisionType.Passive)return;const yi=ci.normal,Ci=yi.negate();if(mi.collisionType===CollisionType.Active&&mi.vel.normalize().dot(Ci)<0){const Ei=yi.scale(yi.dot(mi.vel.negate()));mi.vel=mi.vel.add(Ei)}if(xi.collisionType===CollisionType.Active&&xi.vel.normalize().dot(yi)<0){const Ei=Ci.scale(Ci.dot(xi.vel.negate()));xi.vel=xi.vel.add(Ei)}}}}class ContactConstraintPoint{constructor(ci,hi,_i){this.point=ci,this.local=hi,this.contact=_i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new Vector(0,0),this.bToContact=new Vector(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){const ci=this.contact.bodyA,hi=this.contact.colliderA,_i=this.contact.bodyB,pi=this.contact.colliderB;if(ci&&_i){const gi=this.contact.normal,mi=this.contact.tangent;this.aToContact=this.point.sub(hi.center),this.bToContact=this.point.sub(pi.center);const xi=this.aToContact.cross(gi),yi=this.bToContact.cross(gi);this.normalMass=ci.inverseMass+_i.inverseMass+ci.inverseInertia*xi*xi+_i.inverseInertia*yi*yi;const Ci=this.aToContact.cross(mi),Ei=this.bToContact.cross(mi);this.tangentMass=ci.inverseMass+_i.inverseMass+ci.inverseInertia*Ci*Ci+_i.inverseInertia*Ei*Ei}return this}getRelativeVelocity(){const ci=this.contact.bodyA,hi=this.contact.bodyB;if(ci&&hi){const _i=ci.vel.add(Vector.cross(ci.angularVelocity,this.aToContact));return hi.vel.add(Vector.cross(hi.angularVelocity,this.bToContact)).sub(_i)}return Vector.Zero}}class RealisticSolver{constructor(ci){this.config=ci,this.directionMap=new Map,this.distanceMap=new Map,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(ci){var hi;return(hi=this.idToContactConstraint.get(ci))!==null&&hi!==void 0?hi:[]}solve(ci){this.preSolve(ci),ci=ci.filter(_i=>!_i.isCanceled());let hi;switch(this.config.contactSolveBias){case ContactSolveBias.HorizontalFirst:{hi=HorizontalFirst;break}case ContactSolveBias.VerticalFirst:{hi=VerticalFirst;break}default:hi=None}return ci.sort((_i,pi)=>{const gi=this.directionMap.get(_i.id),mi=this.directionMap.get(pi.id),xi=this.distanceMap.get(_i.id),yi=this.distanceMap.get(pi.id);return hi[gi]-hi[mi]||xi-yi}),this.solveVelocity(ci),this.solvePosition(ci),this.postSolve(ci),ci}preSolve(ci){var hi,_i,pi,gi;for(let yi=0;yi<ci.length;yi++){const Ci=ci[yi];if(Math.abs(Ci.mtv.x)<1e-4&&Math.abs(Ci.mtv.y)<1e-4){Ci.cancel();continue}const Ei=Side.fromDirection(Ci.mtv),Ai=Math.abs(((hi=Ci==null?void 0:Ci.info)===null||hi===void 0?void 0:hi.separation)||0);this.distanceMap.set(Ci.id,Ai),this.directionMap.set(Ci.id,Ei===Side.Left||Ei===Side.Right?"horizontal":"vertical"),Ci.colliderA.events.emit("precollision",new PreCollisionEvent(Ci.colliderA,Ci.colliderB,Ei,Ci.mtv,Ci)),Ci.colliderA.events.emit("beforecollisionresolve",new CollisionPreSolveEvent(Ci.colliderA,Ci.colliderB,Ei,Ci.mtv,Ci)),Ci.colliderB.events.emit("precollision",new PreCollisionEvent(Ci.colliderB,Ci.colliderA,Side.getOpposite(Ei),Ci.mtv.negate(),Ci)),Ci.colliderB.events.emit("beforecollisionresolve",new CollisionPreSolveEvent(Ci.colliderB,Ci.colliderA,Side.getOpposite(Ei),Ci.mtv.negate(),Ci)),Ci.matchAwake()}const xi=Array.from(this.idToContactConstraint.keys());for(let yi=0;yi<ci.length;yi++){const Ci=ci[yi],Ei=xi.indexOf(Ci.id);Ei>-1&&xi.splice(Ei,1);const Ai=(_i=this.idToContactConstraint.get(Ci.id))!==null&&_i!==void 0?_i:[];let ki=0;const Pi=Ci.bodyA,Ii=Ci.colliderA,Di=Ci.bodyB,Fi=Ci.colliderB;if(Pi&&Di)for(let Li=0;Li<Ci.points.length;Li++){const Bi=Ci.points[Li],Ri=Ci.normal,$i=Ci.tangent,Ni=Bi.sub(Ii.center),ji=Bi.sub(Fi.center),Ui=Ni.cross(Ri),qi=ji.cross(Ri),Ji=Pi.inverseMass+Di.inverseMass+Pi.inverseInertia*Ui*Ui+Di.inverseInertia*qi*qi,rs=Ni.cross($i),ss=ji.cross($i),zi=Pi.inverseMass+Di.inverseMass+Pi.inverseInertia*rs*rs+Di.inverseInertia*ss*ss;Ai[ki]&&((gi=(pi=Ai[ki])===null||pi===void 0?void 0:pi.point)===null||gi===void 0?void 0:gi.squareDistance(Bi))<4?(Ai[ki].point=Bi,Ai[ki].local=Ci.localPoints[ki]):Ai[ki]=new ContactConstraintPoint(Bi,Ci.localPoints[ki],Ci),Ai[ki].aToContact=Ni,Ai[ki].bToContact=ji,Ai[ki].normalMass=1/Ji,Ai[ki].tangentMass=1/zi;const Gi=Pi.bounciness>Di.bounciness?Pi.bounciness:Di.bounciness,Vi=Ci.normal.dot(Ai[ki].getRelativeVelocity());Ai[ki].originalVelocityAndRestitution=0,Vi<-.1&&(Ai[ki].originalVelocityAndRestitution=-Gi*Vi),ki++}this.idToContactConstraint.set(Ci.id,Ai)}for(const yi of xi)this.idToContactConstraint.delete(yi);if(this.config.warmStart)this.warmStart(ci);else for(let yi=0;yi<ci.length;yi++){const Ci=ci[yi],Ei=this.getContactConstraints(Ci.id);for(const Ai of Ei)Ai.normalImpulse=0,Ai.tangentImpulse=0}}postSolve(ci){for(let hi=0;hi<ci.length;hi++){const _i=ci[hi],pi=_i.bodyA,gi=_i.bodyB;if(pi&&gi){if(pi.collisionType===CollisionType.Passive||gi.collisionType===CollisionType.Passive)continue;pi.updateMotion(),gi.updateMotion()}const mi=Side.fromDirection(_i.mtv);_i.colliderA.events.emit("postcollision",new PostCollisionEvent(_i.colliderA,_i.colliderB,mi,_i.mtv,_i)),_i.colliderA.events.emit("aftercollisionresolve",new CollisionPostSolveEvent(_i.colliderA,_i.colliderB,mi,_i.mtv,_i)),_i.colliderB.events.emit("postcollision",new PostCollisionEvent(_i.colliderB,_i.colliderA,Side.getOpposite(mi),_i.mtv.negate(),_i)),_i.colliderB.events.emit("aftercollisionresolve",new CollisionPostSolveEvent(_i.colliderB,_i.colliderA,Side.getOpposite(mi),_i.mtv.negate(),_i))}this.lastFrameContacts.clear();for(let hi=0;hi<ci.length;hi++){const _i=ci[hi];this.lastFrameContacts.set(_i.id,_i)}}warmStart(ci){var hi;for(let _i=0;_i<ci.length;_i++){const pi=ci[_i],gi=pi.bodyA,mi=pi.bodyB;if(gi&&mi){const xi=(hi=this.idToContactConstraint.get(pi.id))!==null&&hi!==void 0?hi:[];for(const yi of xi)if(this.config.warmStart){const Ci=pi.normal.scale(yi.normalImpulse),Ei=pi.tangent.scale(yi.tangentImpulse),Ai=Ci.add(Ei);gi.applyImpulse(yi.point,Ai.negate()),mi.applyImpulse(yi.point,Ai)}else yi.normalImpulse=0,yi.tangentImpulse=0}}}solvePosition(ci){var hi;for(let _i=0;_i<this.config.positionIterations;_i++)for(let pi=0;pi<ci.length;pi++){const gi=ci[pi],mi=gi.bodyA,xi=gi.bodyB;if(mi&&xi){if(mi.collisionType===CollisionType.Passive||xi.collisionType===CollisionType.Passive)continue;const yi=(hi=this.idToContactConstraint.get(gi.id))!==null&&hi!==void 0?hi:[];for(const Ci of yi){const Ei=gi.normal,Ai=CollisionJumpTable.FindContactSeparation(gi,Ci.local),ki=this.config.steeringFactor,Pi=-5,Ii=this.config.slop,Di=clamp(ki*(Ai+Ii),Pi,0),Fi=Ei.scale(-Di*Ci.normalMass);if(mi.collisionType===CollisionType.Active){const Li=Fi.negate().scale(mi.inverseMass);mi.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)&&(Li.x=0),mi.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)&&(Li.y=0),mi.globalPos=mi.globalPos.add(Li),mi.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)||(mi.rotation-=Ci.aToContact.cross(Fi)*mi.inverseInertia)}if(xi.collisionType===CollisionType.Active){const Li=Fi.scale(xi.inverseMass);xi.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)&&(Li.x=0),xi.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)&&(Li.y=0),xi.globalPos=xi.globalPos.add(Li),xi.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)||(xi.rotation+=Ci.bToContact.cross(Fi)*xi.inverseInertia)}}}}}solveVelocity(ci){var hi;for(let _i=0;_i<this.config.velocityIterations;_i++)for(let pi=0;pi<ci.length;pi++){const gi=ci[pi],mi=gi.bodyA,xi=gi.bodyB;if(mi&&xi){if(mi.collisionType===CollisionType.Passive||xi.collisionType===CollisionType.Passive)continue;const yi=Math.min(mi.friction,xi.friction),Ci=(hi=this.idToContactConstraint.get(gi.id))!==null&&hi!==void 0?hi:[];for(const Ei of Ci){let Pi=-Ei.getRelativeVelocity().dot(gi.tangent)*Ei.tangentMass;const Ii=yi*Ei.normalImpulse,Di=clamp(Ei.tangentImpulse+Pi,-Ii,Ii);Pi=Di-Ei.tangentImpulse,Ei.tangentImpulse=Di;const Fi=gi.tangent.scale(Pi);mi.applyImpulse(Ei.point,Fi.negate()),xi.applyImpulse(Ei.point,Fi)}for(const Ei of Ci){const ki=Ei.getRelativeVelocity().dot(gi.normal);let Pi=-Ei.normalMass*(ki-Ei.originalVelocityAndRestitution);const Ii=Math.max(Ei.normalImpulse+Pi,0);Pi=Ii-Ei.normalImpulse,Ei.normalImpulse=Ii;const Di=gi.normal.scale(Pi);mi.applyImpulse(Ei.point,Di.negate()),xi.applyImpulse(Ei.point,Di)}}}}}class CollisionSystem extends System{get _processor(){return this._physics.collisionProcessor}constructor(ci,hi){super(),this._physics=hi,this.systemType=SystemType.Update,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new ArcadeSolver(hi.config.arcade),this._realisticSolver=new RealisticSolver(hi.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=_i=>this._processor.track(_i),this._untrackCollider=_i=>this._processor.untrack(_i),this.query=ci.query([TransformComponent,MotionComponent,ColliderComponent]),this.query.entityAdded$.subscribe(_i=>{const pi=_i.get(ColliderComponent);pi.$colliderAdded.subscribe(this._trackCollider),pi.$colliderRemoved.subscribe(this._untrackCollider);const gi=pi.get();gi&&this._processor.track(gi)}),this.query.entityRemoved$.subscribe(_i=>{const pi=_i.get(ColliderComponent),gi=pi.get();pi&&gi&&this._processor.untrack(gi)}),this._motionSystem=ci.get(MotionSystem)}initialize(ci,hi){this._engine=hi.engine}update(ci){var hi,_i,pi,gi;if(!this._physics.config.enabled)return;let mi=[];for(let Ai=0;Ai<this.query.entities.length;Ai++){const Pi=this.query.entities[Ai].get(ColliderComponent),Ii=Pi==null?void 0:Pi.get();if(Pi&&(!((hi=Pi.owner)===null||hi===void 0)&&hi.isActive)&&Ii)if(Pi.update(),Ii instanceof CompositeCollider){const Di=Ii.getColliders();Ii.compositeStrategy||(Ii.compositeStrategy=this._physics.config.colliders.compositeStrategy),mi=mi.concat(Di)}else mi.push(Ii)}this._processor.update(mi,ci);let xi=this._processor.broadphase(mi,ci);this._currentFrameContacts.clear();let yi=[];const Ci=this.getSolver(),Ei=this._physics.config.substep;for(let Ai=0;Ai<Ei;Ai++)if(Ai>0&&this._motionSystem.update(ci),yi.length&&(xi=yi.map(ki=>new Pair(ki.colliderA,ki.colliderB))),xi.length){yi=this._processor.narrowphase(xi,(gi=(pi=(_i=this._engine)===null||_i===void 0?void 0:_i.debug)===null||pi===void 0?void 0:pi.stats)===null||gi===void 0?void 0:gi.currFrame),yi=Ci.solve(yi);for(const ki of yi){if(ki.isCanceled())continue;const Pi=ki.id.indexOf("|");if(Pi>0){const Ii=ki.id.substring(Pi+1);this._currentFrameContacts.set(Ii,ki)}else this._currentFrameContacts.set(ki.id,ki)}}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const Ai of this.query.entities){const ki=Ai.get(ColliderComponent);ki&&ki.processColliderRemoval()}}postupdate(){SeparatingAxis.SeparationPool.done()}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new ArcadeSolver(this._physics.config.arcade),this._realisticSolver=new RealisticSolver(this._physics.config.realistic)),this._physics.config.solver===SolverStrategy.Realistic?this._realisticSolver:this._arcadeSolver}debug(ci){this._processor.debug(ci,0)}runContactStartEnd(){for(const[ci,hi]of this._currentFrameContacts)if(!this._lastFrameContacts.has(ci)){const _i=hi.colliderA,pi=hi.colliderB,gi=Side.fromDirection(hi.mtv),mi=Side.getOpposite(gi);_i.events.emit("collisionstart",new CollisionStartEvent(_i,pi,gi,hi)),_i.events.emit("contactstart",new ContactStartEvent(_i,pi,gi,hi)),pi.events.emit("collisionstart",new CollisionStartEvent(pi,_i,mi,hi)),pi.events.emit("contactstart",new ContactStartEvent(pi,_i,mi,hi))}for(const[ci,hi]of this._lastFrameContacts)if(!this._currentFrameContacts.has(ci)){const _i=hi.colliderA,pi=hi.colliderB,gi=Side.fromDirection(hi.mtv),mi=Side.getOpposite(gi);_i.events.emit("collisionend",new CollisionEndEvent(_i,pi,gi,hi)),_i.events.emit("contactend",new ContactEndEvent(_i,pi,gi,hi)),pi.events.emit("collisionend",new CollisionEndEvent(pi,_i,mi,hi)),pi.events.emit("contactend",new ContactEndEvent(pi,_i,mi,hi))}}}CollisionSystem.priority=SystemPriority.Higher;function blendTransform(fi,ci,hi,_i){if(fi.parent!==ci.parent){const Ei=fi.clone(),Ai=fi.globalPos.clone(),ki=fi.globalScale.clone(),Pi=fi.globalRotation;Ei.parent=ci.parent,Ei.globalPos=Ai,Ei.globalScale=ki,Ei.globalRotation=Pi,fi=Ei}let pi=ci.pos,gi=ci.scale,mi=ci.rotation;pi=ci.pos.scale(hi).add(fi.pos.scale(1-hi)),gi=ci.scale.scale(hi).add(fi.scale.scale(1-hi));const xi=(1-hi)*Math.cos(fi.rotation)+hi*Math.cos(ci.rotation),yi=(1-hi)*Math.sin(fi.rotation)+hi*Math.sin(ci.rotation);mi=Math.atan2(yi,xi);const Ci=_i??new transform_Transform;return Ci.setTransform(pi,mi,gi),Ci}class GraphicsSystem extends System{get sortedTransforms(){return this._sortedTransforms}constructor(ci){super(),this.world=ci,this.systemType=SystemType.Draw,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new transform_Transform,this.query=this.world.query([TransformComponent,GraphicsComponent]),this.query.entityAdded$.subscribe(hi=>{const _i=hi.get(TransformComponent);this._sortedTransforms.push(_i),_i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(hi=>{const _i=hi.get(TransformComponent);_i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const pi=this._sortedTransforms.indexOf(_i);pi>-1&&this._sortedTransforms.splice(pi,1)})}initialize(ci,hi){this._camera=hi.camera,this._engine=hi.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((ci,hi)=>ci.globalZ-hi.globalZ),this._zHasChanged=!1)}update(ci){this._token++;let hi;FontCache.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let _i=0;_i<this._sortedTransforms.length;_i++){const pi=this._sortedTransforms[_i],gi=pi.owner;if(gi.hasTag("ex.offscreen")||(hi=gi.get(GraphicsComponent),!hi.isVisible))continue;hi.onPreTransformDraw&&hi.onPreTransformDraw(this._graphicsContext,ci),gi.events.emit("pretransformdraw",new PreTransformDrawEvent(this._graphicsContext,ci,gi)),pi.coordPlane===CoordPlane.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),pi.coordPlane===CoordPlane.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),hi.update(ci,this._token);const mi=gi.get(ParallaxComponent);if(mi){const xi=Vector.One.sub(mi.parallaxFactor),yi=this._camera.drawPos.scale(xi);this._graphicsContext.translate(yi.x,yi.y)}this._applyTransform(gi),hi.material&&(this._graphicsContext.material=hi.material),hi.onPreDraw&&hi.onPreDraw(this._graphicsContext,ci),gi.events.emit("predraw",new PreDrawEvent(this._graphicsContext,ci,gi)),this._applyOpacity(gi),this._drawGraphicsComponent(hi,pi),hi.onPostDraw&&hi.onPostDraw(this._graphicsContext,ci),gi.events.emit("postdraw",new PostDrawEvent(this._graphicsContext,ci,gi)),this._graphicsContext.restore(),pi.coordPlane===CoordPlane.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),hi.onPostTransformDraw&&hi.onPostTransformDraw(this._graphicsContext,ci),gi.events.emit("posttransformdraw",new PostTransformDrawEvent(this._graphicsContext,ci,gi))}this._graphicsContext.restore()}_drawGraphicsComponent(ci,hi){var _i,pi;if(ci.isVisible){const gi=ci.flipHorizontal,mi=ci.flipVertical,xi=ci.current,yi=(_i=ci.currentOptions)!==null&&_i!==void 0?_i:{};if(xi){let Ci=ci.anchor,Ei=ci.offset,Ai=1,ki=1;yi!=null&&yi.anchor&&(Ci=yi.anchor),yi!=null&&yi.offset&&(Ei=yi.offset);const Pi=hi.globalScale;Ai*=xi.scale.x*Pi.x,ki*=xi.scale.y*Pi.y;const Ii=-xi.width*Ci.x+Ei.x*Ai,Di=-xi.height*Ci.y+Ei.y*ki,Fi=xi.flipHorizontal,Li=xi.flipVertical;if((gi||mi)&&(xi.flipHorizontal=gi?!Fi:Fi,xi.flipVertical=mi?!Li:Li),xi==null||xi.draw(this._graphicsContext,Ii,Di),(gi||mi)&&(xi.flipHorizontal=Fi,xi.flipVertical=Li),!((pi=this._engine)===null||pi===void 0)&&pi.isDebug&&this._engine.debug.graphics.showBounds){const Bi=vec(Ii,Di);if(xi instanceof GraphicsGroup)for(const Ri of xi.members){let $i,Ni=Vector.Zero;Ri instanceof Graphic?$i=Ri:($i=Ri.graphic,Ni=Ri.offset),xi.useAnchor?$i==null||$i.localBounds.translate(Bi.add(Ni)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):$i==null||$i.localBounds.translate(Ni).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else xi==null||xi.localBounds.translate(Bi).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(ci){const hi=ci.getAncestors();for(let _i=0;_i<hi.length;_i++){const pi=hi[_i],gi=pi==null?void 0:pi.get(TransformComponent),mi=pi==null?void 0:pi.get(BodyComponent);if(gi){let xi=gi.get();if(mi&&this._engine.fixedUpdateTimestep&&mi.__oldTransformCaptured&&mi.enableFixedUpdateInterpolate){const yi=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep;xi=blendTransform(mi.oldTransform,gi.get(),yi,this._targetInterpolationTransform)}this._graphicsContext.z=gi.globalZ,this._graphicsContext.translate(xi.pos.x,xi.pos.y),this._graphicsContext.scale(xi.scale.x,xi.scale.y),this._graphicsContext.rotate(xi.rotation)}}}_applyOpacity(ci){var hi;const _i=ci.getAncestors();for(let pi=0;pi<_i.length;pi++){const gi=_i[pi],mi=gi==null?void 0:gi.get(GraphicsComponent);this._graphicsContext.opacity*=(hi=mi==null?void 0:mi.opacity)!==null&&hi!==void 0?hi:1}}}GraphicsSystem.priority=SystemPriority.Average;class DebugSystem extends System{constructor(ci){super(),this.world=ci,this.systemType=SystemType.Draw,this.query=this.world.query([TransformComponent])}initialize(ci,hi){this._graphicsContext=hi.engine.graphicsContext,this._camera=hi.camera,this._engine=hi.engine,this._collisionSystem=ci.systemManager.get(CollisionSystem)}update(){var ci;if(!this._engine.isDebug)return;const hi=this._engine.debug.filter;let _i,pi;const gi=this._engine.debug.entity;let mi;const xi=this._engine.debug.transform;let yi;const Ci=this._engine.debug.motion;let Ei;const Ai=this._engine.debug.collider,ki=this._engine.debug.physics;let Pi;const Ii=this._engine.debug.graphics;let Di,Fi;const Li=this._engine.debug.body,Bi=this._engine.debug.camera;for(let Ri=0;Ri<this.query.entities.length;Ri++){const $i=this.query.entities[Ri];if($i.hasTag("offscreen")||$i instanceof Particle||hi.useFilter&&(!(hi.ids.length===0||hi.ids.includes($i.id))||!(hi.nameQuery===""||$i.name.includes(hi.nameQuery))))continue;let Ni=Vector.Zero;const ji=vec(0,16);if(_i=$i.id,pi=$i.name,mi=$i.get(TransformComponent),this._pushCameraTransform(mi),this._graphicsContext.save(),mi.coordPlane===CoordPlane.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=xi.debugZIndex,this._applyTransform($i),mi&&((xi.showAll||xi.showPosition)&&this._graphicsContext.debug.drawPoint(Vector.Zero,{size:4,color:xi.positionColor}),(xi.showAll||xi.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${mi.pos.toString(2)}`,Ni),Ni=Ni.add(ji)),(xi.showAll||xi.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${mi.z.toFixed(1)})`,Ni),Ni=Ni.add(ji)),(gi.showAll||gi.showId)&&(this._graphicsContext.debug.drawText(`id(${_i}) ${$i.parent?"child of id("+((ci=$i.parent)===null||ci===void 0?void 0:ci.id)+")":""}`,Ni),Ni=Ni.add(ji)),(gi.showAll||gi.showName)&&(this._graphicsContext.debug.drawText(`name(${pi})`,Ni),Ni=Ni.add(ji)),(xi.showAll||xi.showRotation)&&(this._graphicsContext.drawLine(Vector.Zero,Vector.fromAngle(mi.rotation).scale(50).add(Vector.Zero),xi.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${toDegrees(mi.rotation).toFixed(2)})`,Ni),Ni=Ni.add(ji)),(xi.showAll||xi.showScale)&&this._graphicsContext.drawLine(Vector.Zero,mi.scale.add(Vector.Zero),xi.scaleColor,2)),Pi=$i.get(GraphicsComponent),Pi&&(Ii.showAll||Ii.showBounds)&&Pi.localBounds.draw(this._graphicsContext,Ii.boundsColor),Di=$i.get(DebugGraphicsComponent),Di&&(Di.useTransform||this._graphicsContext.restore(),Di.draw(this._graphicsContext,this._engine.debug),Di.useTransform||(this._graphicsContext.save(),this._applyTransform($i))),Fi=$i.get(BodyComponent),Fi&&((Li.showAll||Li.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${Fi.group.name})`,Ni),Ni=Ni.add(ji)),(Li.showAll||Li.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${Fi.collisionType})`,Ni),Ni=Ni.add(ji)),(Li.showAll||Li.showMass)&&(this._graphicsContext.debug.drawText(`mass(${Fi.mass})`,Ni),Ni=Ni.add(ji)),(Li.showAll||Li.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${Fi.sleepMotion})`,Ni),Ni=Ni.add(ji)),(Li.showAll||Li.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${Fi.canSleep?Fi.isSleeping:"cant sleep"})`,Ni),Ni=Ni.add(ji))),this._graphicsContext.restore(),this._graphicsContext.save(),mi.coordPlane===CoordPlane.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=xi.debugZIndex,yi=$i.get(MotionComponent),yi&&((Ci.showAll||Ci.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${yi.vel.toString(2)}`,Ni.add(mi.globalPos)),this._graphicsContext.drawLine(mi.globalPos,mi.globalPos.add(yi.vel),Ci.velocityColor,2),Ni=Ni.add(ji)),(Ci.showAll||Ci.showAcceleration)&&this._graphicsContext.drawLine(mi.globalPos,mi.globalPos.add(yi.acc),Ci.accelerationColor,2)),Ei=$i.get(ColliderComponent),Ei){const Ui=Ei.get();if((Ai.showAll||Ai.showGeometry)&&Ui&&Ui.debug(this._graphicsContext,Ai.geometryColor,{lineWidth:Ai.geometryLineWidth,pointSize:Ai.geometryPointSize}),Ai.showAll||Ai.showBounds){if(Ui instanceof CompositeCollider){const qi=Ui.getColliders();for(const Ji of qi){const rs=Ji.bounds,ss=vec(rs.left,rs.top);this._graphicsContext.debug.drawRect(ss.x,ss.y,rs.width,rs.height,{color:Ai.boundsColor}),(Ai.showAll||Ai.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${Ji.owner.id})`,ss)}Ei.bounds.draw(this._graphicsContext,Ai.boundsColor)}else if(Ui){const qi=Ei.bounds,Ji=vec(qi.left,qi.top);this._graphicsContext.debug.drawRect(Ji.x,Ji.y,qi.width,qi.height,{color:Ai.boundsColor}),(Ai.showAll||Ai.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${Ei.owner.id})`,Ji)}}}this._graphicsContext.restore(),this._popCameraTransform(mi)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(ki.showAll||ki.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),ki.showAll||ki.showCollisionContacts||ki.showCollisionNormals)for(const[Ri,$i]of this._engine.debug.stats.currFrame.physics.contacts){if(ki.showAll||ki.showCollisionContacts)for(const Ni of $i.points)this._graphicsContext.debug.drawPoint(Ni,{size:ki.contactSize,color:ki.collisionContactColor});if(ki.showAll||ki.showCollisionNormals)for(const Ni of $i.points)this._graphicsContext.debug.drawLine(Ni,$i.normal.scale(30).add(Ni),{color:ki.collisionNormalColor})}this._graphicsContext.restore(),Bi&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(Bi.showAll||Bi.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,Bi.focusColor),(Bi.showAll||Bi.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(ci,hi){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),Debug.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(ci){const hi=ci.getAncestors();for(const _i of hi){const pi=_i==null?void 0:_i.get(TransformComponent);pi&&(this._graphicsContext.translate(pi.pos.x,pi.pos.y),this._graphicsContext.scale(pi.scale.x,pi.scale.y),this._graphicsContext.rotate(pi.rotation))}}_pushCameraTransform(ci){ci.coordPlane===CoordPlane.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(ci){ci.coordPlane===CoordPlane.World&&this._graphicsContext.restore()}}DebugSystem.priority=SystemPriority.Lowest;class HashGridProxy{constructor(ci,hi){this.object=ci,this.id=-1,this.cells=[],this.hasZeroBounds=!1,this.gridSize=hi,this.bounds=ci.bounds,this.hasZeroBounds=this.bounds.hasZeroDimensions(),this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize)}hasChanged(){const ci=this.object.bounds,hi=Math.floor(ci.left/this.gridSize),_i=Math.floor(ci.right/this.gridSize),pi=Math.floor(ci.bottom/this.gridSize),gi=Math.floor(ci.top/this.gridSize);return this.leftX!==hi||this.rightX!==_i||this.bottomY!==pi||this.topY!==gi}clear(){for(const ci of this.cells){const hi=ci.proxies.indexOf(this);hi>-1&&ci.proxies.splice(hi,1)}}updateBounds(){this.bounds=this.object.bounds}update(){this.bounds=this.object.bounds,this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize),this.hasZeroBounds=this.object.bounds.hasZeroDimensions()}}class HashGridCell{constructor(){this.proxies=[]}configure(ci,hi){this.x=ci,this.y=hi,this.key=HashGridCell.calculateHashKey(ci,hi)}static calculateHashKey(ci,hi){return`${ci}+${hi}`}}class SparseHashGrid{constructor(ci){this.bounds=new BoundingBox,this._hashGridCellPool=new RentalPool(()=>new HashGridCell,hi=>(hi.configure(0,0),hi.proxies.length=0,hi),1e3),this.gridSize=ci.size,this.sparseHashGrid=new Map,this.objectToProxy=new Map,ci.proxyFactory?this._buildProxy=hi=>ci.proxyFactory(hi,this.gridSize):this._buildProxy=hi=>new HashGridProxy(hi,this.gridSize)}query(ci){const hi=new Set;if(ci instanceof BoundingBox){const _i=ci,pi=Math.floor(_i.left/this.gridSize),gi=Math.floor(_i.right/this.gridSize),mi=Math.floor(_i.bottom/this.gridSize),xi=Math.floor(_i.top/this.gridSize);for(let yi=pi;yi<=gi;yi++)for(let Ci=xi;Ci<=mi;Ci++){const Ei=HashGridCell.calculateHashKey(yi,Ci),Ai=this.sparseHashGrid.get(Ei);if(Ai)for(let ki=0;ki<Ai.proxies.length;ki++)Ai.proxies[ki].updateBounds(),Ai.proxies[ki].bounds.intersect(_i)&&hi.add(Ai.proxies[ki].object)}}else{const _i=ci,pi=HashGridCell.calculateHashKey(Math.floor(_i.x/this.gridSize),Math.floor(_i.y/this.gridSize)),gi=this.sparseHashGrid.get(pi);if(gi)for(let mi=0;mi<gi.proxies.length;mi++)gi.proxies[mi].updateBounds(),gi.proxies[mi].bounds.contains(_i)&&hi.add(gi.proxies[mi].object)}return Array.from(hi)}get(ci,hi){const _i=HashGridCell.calculateHashKey(ci,hi);return this.sparseHashGrid.get(_i)}_insert(ci,hi,_i){const pi=HashGridCell.calculateHashKey(ci,hi);let gi=this.sparseHashGrid.get(pi);gi||(gi=this._hashGridCellPool.rent(),gi.configure(ci,hi),this.sparseHashGrid.set(gi.key,gi)),gi.proxies.push(_i),_i.cells.push(gi),this.bounds.combine(_i.bounds,this.bounds)}_remove(ci,hi,_i){const pi=HashGridCell.calculateHashKey(ci,hi),gi=this.sparseHashGrid.get(pi);if(gi){const mi=gi.proxies.indexOf(_i);mi>-1&&gi.proxies.splice(mi,1);const xi=_i.cells.indexOf(gi);xi>-1&&_i.cells.splice(xi,1),gi.proxies.length===0&&(this._hashGridCellPool.return(gi),this.sparseHashGrid.delete(pi))}}track(ci){const hi=this._buildProxy(ci);this.objectToProxy.set(ci,hi);for(let _i=hi.leftX;_i<=hi.rightX;_i++)for(let pi=hi.topY;pi<=hi.bottomY;pi++)this._insert(_i,pi,hi)}untrack(ci){const hi=this.objectToProxy.get(ci);hi&&(hi.clear(),this.objectToProxy.delete(ci))}update(ci){let hi=0;for(const _i of ci){const pi=this.objectToProxy.get(_i);if(pi&&pi.hasChanged()){for(let gi=pi.leftX;gi<=pi.rightX;gi++)for(let mi=pi.topY;mi<=pi.bottomY;mi++)this._remove(gi,mi,pi);pi.update();for(let gi=pi.leftX;gi<=pi.rightX;gi++)for(let mi=pi.topY;mi<=pi.bottomY;mi++)this._insert(gi,mi,pi);hi++}}return hi}debug(ci,hi){const _i=Color.Transparent,pi=Color.White;for(const gi of this.sparseHashGrid.values())ci.drawRectangle(vec(gi.x*this.gridSize,gi.y*this.gridSize),this.gridSize,this.gridSize,_i,pi,2)}}class PointerSystem extends System{constructor(ci){super(),this.world=ci,this.systemType=SystemType.Update,this._graphicsHashGrid=new SparseHashGrid({size:100}),this._graphics=[],this._entityToPointer=new Map,this._pointerEventDispatcher=new PointerEventsToObjectDispatcher,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([TransformComponent,PointerComponent]),this.query.entityAdded$.subscribe(hi=>{const _i=hi.get(TransformComponent),pi=hi.get(PointerComponent);this._pointerEventDispatcher.addObject(hi,mi=>pi&&pi.localBounds?pi.localBounds.transform(_i.get().matrix).contains(_i.coordPlane===CoordPlane.World?mi.worldPos:mi.screenPos):!1,()=>hi.isActive),this._entityToPointer.set(hi,pi);const gi=hi.get(GraphicsComponent);gi&&(this._graphics.push(gi),this._graphicsHashGrid.track(gi)),this._sortedTransforms.push(_i),this._sortedEntities.push(_i.owner),_i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(hi=>{this._pointerEventDispatcher.removeObject(hi);const _i=hi.get(TransformComponent);this._entityToPointer.delete(hi);const pi=hi.get(GraphicsComponent);if(pi){const mi=this._graphics.indexOf(pi);mi>-1&&this._graphics.splice(mi,1),this._graphicsHashGrid.untrack(pi)}_i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const gi=this._sortedTransforms.indexOf(_i);gi>-1&&(this._sortedTransforms.splice(gi,1),this._sortedEntities.splice(gi,1))})}initialize(ci,hi){this._engine=hi.engine,this._scene=hi}preupdate(){this._scene.camera.hasChanged()&&this._scene.camera.updateTransform(this._scene.camera.pos),this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((ci,hi)=>hi.z-ci.z),this._sortedEntities=this._sortedTransforms.map(ci=>ci.owner),this._zHasChanged=!1)}update(){this._graphicsHashGrid.update(this._graphics);for(const[ci,hi]of this._engineReceiver.currentFramePointerCoords.entries()){const _i=this._scene.physics.query(hi.worldPos);for(let gi=0;gi<_i.length;gi++){const mi=_i[gi],xi=this._entityToPointer.get(mi.owner);xi&&(xi.useColliderShape||this.overrideUseColliderShape)&&this._pointerEventDispatcher.addPointerToObject(mi.owner,ci)}const pi=this._graphicsHashGrid.query(hi.worldPos);for(let gi=0;gi<pi.length;gi++){const mi=pi[gi],xi=this._entityToPointer.get(mi.owner);xi&&(xi.useGraphicsBounds||this.overrideUseGraphicsBounds)&&this._pointerEventDispatcher.addPointerToObject(mi.owner,ci)}}this._pointerEventDispatcher.processPointerToObject(this._engineReceiver,this._sortedEntities),this._pointerEventDispatcher.dispatchEvents(this._engineReceiver,this._sortedEntities),this._receivers.forEach(ci=>ci.update()),this._pointerEventDispatcher.clear(),this._receivers.forEach(ci=>ci.clear())}}PointerSystem.priority=SystemPriority.Higher;class ActionsSystem extends System{constructor(ci){super(),this.world=ci,this.systemType=SystemType.Update,this._actions=[],this.query=this.world.query([ActionsComponent]),this.query.entityAdded$.subscribe(hi=>this._actions.push(hi.get(ActionsComponent))),this.query.entityRemoved$.subscribe(hi=>{const _i=hi.get(ActionsComponent),pi=this._actions.indexOf(_i);pi>-1&&this._actions.splice(pi,1)})}update(ci){for(let hi=0;hi<this._actions.length;hi++)this._actions[hi].update(ci)}}ActionsSystem.priority=SystemPriority.Higher;class IsometricEntityComponent extends Component{constructor(ci){super(),this.elevation=0,this.columns=ci.columns,this.rows=ci.rows,this.tileWidth=ci.tileWidth,this.tileHeight=ci.tileHeight}}class IsometricEntitySystem extends System{constructor(ci){super(),this.world=ci,this.systemType=SystemType.Update,this.query=this.world.query([TransformComponent,IsometricEntityComponent])}update(){let ci,hi;for(let _i=0;_i<this.query.entities.length;_i++){const pi=this.query.entities[_i];ci=pi.get(TransformComponent),hi=pi.get(IsometricEntityComponent);const mi=Math.max(hi.columns*hi.tileWidth,hi.rows*hi.tileHeight)*hi.elevation+ci.pos.y;ci.z=mi}}}IsometricEntitySystem.priority=SystemPriority.Lower;class OffscreenSystem extends System{constructor(ci){super(),this.world=ci,this.systemType=SystemType.Draw,this.query=this.world.query([TransformComponent,GraphicsComponent])}initialize(ci,hi){this._camera=hi.camera,this._screen=hi.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let ci,hi,_i;for(let pi=0;pi<this.query.entities.length;pi++){const gi=this.query.entities[pi];hi=gi.get(GraphicsComponent),ci=gi.get(TransformComponent),_i=gi.get(ParallaxComponent);let mi;if(_i){const yi=Vector.One.sub(_i.parallaxFactor);mi=this._camera.pos.scale(yi)}const xi=this._isOffscreen(ci,hi,mi);xi&&!gi.hasTag("ex.offscreen")&&(gi.events.emit("exitviewport",new ExitViewPortEvent(gi)),gi.addTag("ex.offscreen")),!xi&&gi.hasTag("ex.offscreen")&&(gi.events.emit("enterviewport",new EnterViewPortEvent(gi)),gi.removeTag("ex.offscreen"))}}_isOffscreen(ci,hi,_i){if(hi.forceOnScreen)return!1;if(ci.coordPlane===CoordPlane.World){let pi=hi.localBounds;_i&&(pi=pi.translate(_i));const gi=pi.transform(ci.get().matrix);return!this._worldBounds.overlaps(gi)}else return!1}}OffscreenSystem.priority=SystemPriority.Higher;class HashColliderProxy extends HashGridProxy{constructor(ci,hi){var _i,pi;super(ci,hi),this.collider=ci,this.id=-1,this.hasZeroBounds=!1,this.cells=[],this.gridSize=hi;const gi=ci.bounds;this.hasZeroBounds=gi.hasZeroDimensions(),this.leftX=Math.floor(gi.left/this.gridSize),this.rightX=Math.floor(gi.right/this.gridSize),this.bottomY=Math.floor(gi.bottom/this.gridSize),this.topY=Math.floor(gi.top/this.gridSize),this.owner=ci.owner,this.body=(_i=this.owner)===null||_i===void 0?void 0:_i.get(BodyComponent),this.collisionType=(pi=this.body.collisionType)!==null&&pi!==void 0?pi:CollisionType.PreventCollision}update(){var ci,hi;super.update(),this.body=(ci=this.owner)===null||ci===void 0?void 0:ci.get(BodyComponent),this.collisionType=(hi=this.body.collisionType)!==null&&hi!==void 0?hi:CollisionType.PreventCollision,this.hasZeroBounds=this.collider.localBounds.hasZeroDimensions()}}class SparseHashGridCollisionProcessor{constructor(ci){this._pairs=new Set,this._nonPairs=new Set,this._pairPool=new Pool(()=>new Pair({id:createId("collider",0)},{id:createId("collider",0)}),hi=>(hi.colliderA=null,hi.colliderB=null,hi),200),this.gridSize=ci.size,this.hashGrid=new SparseHashGrid({size:this.gridSize,proxyFactory:(hi,_i)=>new HashColliderProxy(hi,_i)}),this._pairPool.disableWarnings=!0}getColliders(){return Array.from(this.hashGrid.objectToProxy.keys())}query(ci){return this.hashGrid.query(ci)}rayCast(ci,hi){var _i,pi,gi;const mi=[],xi=(_i=hi==null?void 0:hi.maxDistance)!==null&&_i!==void 0?_i:1/0,yi=hi==null?void 0:hi.collisionGroup,Ci=yi?yi.category:(pi=hi==null?void 0:hi.collisionMask)!==null&&pi!==void 0?pi:CollisionGroup.All.category,Ei=(gi=hi==null?void 0:hi.searchAllColliders)!==null&&gi!==void 0?gi:!1,Ai=ci.dir.normalize(),ki=Ai.y/Ai.x,Pi=Ai.x/Ai.y,Ii=Math.sqrt(1+ki*ki)*this.gridSize,Di=Math.sqrt(1+Pi*Pi)*this.gridSize,Fi=ci.pos.x/this.gridSize,Li=ci.pos.y/this.gridSize,Bi=vec(1,1);let Ri=~~Fi,$i=~~Li,Ni=0,ji=0;Ai.x<0?(Bi.x=-1,Ni=(Fi-Ri)*Ii):(Bi.x=1,Ni=(Ri+1-Fi)*Ii),Ai.y<0?(Bi.y=-1,ji=(Li-$i)*Di):(Bi.y=1,ji=($i+1-Li)*Di);const Ui=new Set;let qi=!1,Ji=9999;for(;!qi&&Ji>0&&(Ji--,!!this.hashGrid.bounds.contains(vec(Ri*this.gridSize,$i*this.gridSize)));){const rs=HashGridCell.calculateHashKey(Ri,$i),ss=this.hashGrid.sparseHashGrid.get(rs);if(ss){const zi=[];for(let Gi=0;Gi<ss.proxies.length;Gi++){const Vi=ss.proxies[Gi];if(!Ui.has(Vi.collider.id.value)){if(Ui.add(Vi.collider.id.value),hi!=null&&hi.ignoreCollisionGroupAll&&Vi.body.group===CollisionGroup.All)continue;const Qi=(Ci&Vi.body.group.category)!==0;if(Vi.body.group&&!Qi)continue;const is=Vi.collider.rayCast(ci,xi);is&&zi.push(is)}}zi.sort((Gi,Vi)=>Gi.distance-Vi.distance);for(let Gi=0;Gi<zi.length;Gi++){const Vi=zi[Gi];if(hi!=null&&hi.filter){if(hi.filter(Vi)&&(mi.push(Vi),!Ei)){qi=!0;break}}else if(mi.push(Vi),!Ei){qi=!0;break}}}Ni<ji?(Ri+=Bi.x,Ni+=Ii):($i+=Bi.y,ji+=Di)}return mi.sort((rs,ss)=>rs.distance-ss.distance),!Ei&&mi.length?[mi[0]]:mi}track(ci){let hi=[ci];if(ci instanceof CompositeCollider){const _i=ci.getColliders();for(const pi of _i)pi.owner=ci.owner;hi=_i}for(const _i of hi)this.hashGrid.track(_i)}untrack(ci){let hi=[ci];ci instanceof CompositeCollider&&(hi=ci.getColliders());for(const _i of hi)this.hashGrid.untrack(_i)}_canCollide(ci,hi){return!(ci.collider.id===hi.collider.id||ci.owner&&hi.owner&&ci.owner.id===hi.owner.id||ci.hasZeroBounds||hi.hasZeroBounds||!ci.body.group.canCollide(hi.body.group)||ci.collisionType===CollisionType.Fixed&&hi.collisionType===CollisionType.Fixed||ci.collisionType===CollisionType.PreventCollision||hi.collisionType===CollisionType.PreventCollision||!ci.owner.isActive||!hi.owner.isActive)}broadphase(ci,hi){const _i=[];this._pairs.clear(),this._nonPairs.clear();let pi=0;for(const gi of this.hashGrid.objectToProxy.values())if(gi.id=pi++,!(!gi.owner.isActive||gi.collisionType===CollisionType.PreventCollision))for(let mi=0;mi<gi.cells.length;mi++){const xi=gi.cells[mi];for(let yi=0;yi<xi.proxies.length;yi++){const Ci=xi.proxies[yi];if(Ci.id===gi.id)continue;const Ei=Pair.calculatePairHash(gi.collider.id,Ci.collider.id);if(!this._nonPairs.has(Ei))if(!this._pairs.has(Ei)&&this._canCollide(gi,Ci)&&gi.object.bounds.overlaps(Ci.object.bounds)){const Ai=this._pairPool.get();Ai.colliderA=gi.collider,Ai.colliderB=Ci.collider,Ai.id=Ei,this._pairs.add(Ei),_i.push(Ai)}else this._nonPairs.add(Ei)}}return _i}narrowphase(ci,hi){const _i=[];for(let pi=0;pi<ci.length;pi++){const gi=ci[pi].collide();for(let mi=0;mi<gi.length;mi++){const xi=gi[mi];_i.push(xi),hi&&hi.physics.contacts.set(xi.id,xi)}}return this._pairPool.done(),hi&&(hi.physics.collisions+=_i.length),_i}update(ci,hi){return this.hashGrid.update(ci)}debug(ci,hi){this.hashGrid.debug(ci,hi)}}class PhysicsWorld{get config(){return watchDeep(this._config,ci=>{this.$configUpdate.notifyAll(ci)})}set config(ci){this._config=ci,this.$configUpdate.notifyAll(ci)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const ci=this._collisionProcessor.getColliders();this._config.spatialPartition===SpatialPartitionStrategy.SparseHashGrid?this._collisionProcessor=new SparseHashGridCollisionProcessor(this._config.sparseHashGrid):this._collisionProcessor=new DynamicTreeCollisionProcessor(this._config);for(const hi of ci)this._collisionProcessor.track(hi)}return this._collisionProcessor}constructor(ci){this.$configUpdate=new Observable,this._configDirty=!1,this.config=ci,this.$configUpdate.subscribe(hi=>{this._configDirty=!0,BodyComponent.updateDefaultPhysicsConfig(hi.bodies)}),this._config.spatialPartition===SpatialPartitionStrategy.SparseHashGrid?this._collisionProcessor=new SparseHashGridCollisionProcessor(this._config.sparseHashGrid):this._collisionProcessor=new DynamicTreeCollisionProcessor(this._config)}rayCast(ci,hi){return this.collisionProcessor.rayCast(ci,hi)}query(ci){return this._collisionProcessor.query(ci)}}class Gamepads{constructor(){this.events=new EventEmitter,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(ci){this._enabled=ci}setMinimumGamepadConfiguration(ci){this._enableAndUpdate(),this._minimumConfiguration=ci}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(ci){if(!this._minimumConfiguration)return!0;if(!ci)return!1;const hi=ci.axes.filter(pi=>typeof pi!==void 0).length,_i=ci.buttons.filter(pi=>typeof pi!==void 0).length;return hi>=this._minimumConfiguration.axis&&_i>=this._minimumConfiguration.buttons&&ci.connected}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this._enableAndUpdate(),this.events.on(ci,hi)}once(ci,hi){return this._enableAndUpdate(),this.events.once(ci,hi)}off(ci,hi){this._enableAndUpdate(),this.events.off(ci,hi)}update(){var ci,hi;if(!this.enabled||!this.supported||!this._enabled)return;this.init();const _i=this._navigator.getGamepads();for(let pi=0;pi<_i.length;pi++){if(_i[pi]){const mi=this.at(pi);!this.at(pi).connected&&this._isGamepadValid(_i[pi])&&(mi.events.pipe(this.events),this.events.emit("connect",new GamepadConnectEvent(pi,this.at(pi)))),this.at(pi).connected=!0}else{const mi=this.at(pi);mi.connected&&(this.events.emit("disconnect",new GamepadDisconnectEvent(pi,mi)),mi.events.unpipe(this.events)),mi.connected=!1;continue}if(this.at(pi).update(),_i[pi].timestamp&&_i[pi].timestamp===this._gamePadTimeStamps[pi])continue;this._gamePadTimeStamps[pi]=_i[pi].timestamp,this.at(pi).navigatorGamepad=_i[pi];const gi=_i[pi];if(gi){for(let mi=0;mi<gi.buttons.length;mi++){const xi=gi.buttons[mi],yi=xi==null?void 0:xi.value;yi!==((ci=this._oldPads[pi])===null||ci===void 0?void 0:ci.getButton(mi))&&(xi!=null&&xi.pressed?(this.at(pi).updateButton(mi,yi),this.at(pi).events.emit("button",new GamepadButtonEvent(mi in Buttons?mi:Buttons.Unknown,mi,yi,this.at(pi)))):this.at(pi).updateButton(mi,0))}for(let mi=0;mi<gi.axes.length;mi++){const xi=gi.axes[mi];xi!==((hi=this._oldPads[pi])===null||hi===void 0?void 0:hi.getAxes(mi))&&(this.at(pi).updateAxes(mi,xi),this.at(pi).events.emit("axis",new GamepadAxisEvent(mi,xi,this.at(pi))))}}this._oldPads[pi]=this._clonePad(_i[pi])}}at(ci){if(this._enableAndUpdate(),ci>=this._pads.length)for(let hi=this._pads.length-1,_i=ci;hi<_i;hi++)this._pads.push(new Gamepad),this._oldPads.push(new Gamepad);return this._pads[ci]}getValidGamepads(){this._enableAndUpdate();const ci=[];for(let hi=0;hi<this._pads.length;hi++)this._isGamepadValid(this.at(hi).navigatorGamepad)&&this.at(hi).connected&&ci.push(this.at(hi));return ci}count(){return this._pads.filter(ci=>ci.connected).length}_clonePads(ci){const hi=[];for(let _i=0,pi=ci.length;_i<pi;_i++)hi.push(this._clonePad(ci[_i]));return hi}_clonePad(ci){let hi,_i;const pi=new Gamepad;if(!ci)return pi;for(hi=0,_i=ci.buttons.length;hi<_i;hi++)ci.buttons[hi]&&pi.updateButton(hi,ci.buttons[hi].value);for(hi=0,_i=ci.axes.length;hi<_i;hi++)pi.updateAxes(hi,ci.axes[hi]);return pi}}Gamepads.MinAxisMoveThreshold=.05;class Gamepad{constructor(){this.events=new EventEmitter,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let ci=0;ci<this._buttons.length;ci++)this._buttons[ci]=0;for(let ci=0;ci<this._axes.length;ci++)this._axes[ci]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(ci,hi=1){return this._buttons[ci]>=hi}isButtonHeld(ci,hi=1){return this._buttons[ci]>=hi}wasButtonPressed(ci,hi=1){return this._buttonsDown[ci]>=hi}wasButtonReleased(ci){return!!this._buttonsUp[ci]}getButton(ci){return this._buttons[ci]}getAxes(ci){const hi=this._axes[ci];return Math.abs(hi)<Gamepads.MinAxisMoveThreshold?0:hi}updateButton(ci,hi){hi===0&&this._buttons[ci]?this._buttonsUp[ci]=1:this._buttonsDown[ci]=hi,this._buttons[ci]=hi}updateAxes(ci,hi){this._axes[ci]=hi}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}}var Buttons;(function(fi){fi[fi.Unknown=-1]="Unknown",fi[fi.Face1=0]="Face1",fi[fi.Face2=1]="Face2",fi[fi.Face3=2]="Face3",fi[fi.Face4=3]="Face4",fi[fi.LeftBumper=4]="LeftBumper",fi[fi.RightBumper=5]="RightBumper",fi[fi.LeftTrigger=6]="LeftTrigger",fi[fi.RightTrigger=7]="RightTrigger",fi[fi.Select=8]="Select",fi[fi.Start=9]="Start",fi[fi.LeftStick=10]="LeftStick",fi[fi.RightStick=11]="RightStick",fi[fi.DpadUp=12]="DpadUp",fi[fi.DpadDown=13]="DpadDown",fi[fi.DpadLeft=14]="DpadLeft",fi[fi.DpadRight=15]="DpadRight",fi[fi.CenterButton=16]="CenterButton",fi[fi.MiscButton1=17]="MiscButton1"})(Buttons||(Buttons={}));var Axes;(function(fi){fi[fi.LeftStickX=0]="LeftStickX",fi[fi.LeftStickY=1]="LeftStickY",fi[fi.RightStickX=2]="RightStickX",fi[fi.RightStickY=3]="RightStickY"})(Axes||(Axes={}));class InputMapper{constructor(ci){this.inputs=ci,this._handlers=new Map}execute(){for(const[ci,hi]of this._handlers.entries()){const _i=ci(this.inputs);_i&&hi(_i)}}on(ci,hi){this._handlers.set(ci,hi)}}function isCrossOriginIframe(){try{const fi=()=>{};window.top.addEventListener("blur",fi),window.top.removeEventListener("blur",fi)}catch{return!0}return!1}var Keys;(function(fi){fi.Backquote="Backquote",fi.Backslash="Backslash",fi.BracketLeft="BracketLeft",fi.BracketRight="BracketRight",fi.Comma="Comma",fi.Key0="Digit0",fi.Key1="Digit1",fi.Key2="Digit2",fi.Key3="Digit3",fi.Key4="Digit4",fi.Key5="Digit5",fi.Key6="Digit6",fi.Key7="Digit7",fi.Key8="Digit8",fi.Key9="Digit9",fi.Digit0="Digit0",fi.Digit1="Digit1",fi.Digit2="Digit2",fi.Digit3="Digit3",fi.Digit4="Digit4",fi.Digit5="Digit5",fi.Digit6="Digit6",fi.Digit7="Digit7",fi.Digit8="Digit8",fi.Digit9="Digit9",fi.Equal="Equal",fi.IntlBackslash="IntlBackslash",fi.IntlRo="IntlRo",fi.IntlYen="IntlYen",fi.A="KeyA",fi.B="KeyB",fi.C="KeyC",fi.D="KeyD",fi.E="KeyE",fi.F="KeyF",fi.G="KeyG",fi.H="KeyH",fi.I="KeyI",fi.J="KeyJ",fi.K="KeyK",fi.L="KeyL",fi.M="KeyM",fi.N="KeyN",fi.O="KeyO",fi.P="KeyP",fi.Q="KeyQ",fi.R="KeyR",fi.S="KeyS",fi.T="KeyT",fi.U="KeyU",fi.V="KeyV",fi.W="KeyW",fi.X="KeyX",fi.Y="KeyY",fi.Z="KeyZ",fi.KeyA="KeyA",fi.KeyB="KeyB",fi.KeyC="KeyC",fi.KeyD="KeyD",fi.KeyE="KeyE",fi.KeyF="KeyF",fi.KeyG="KeyG",fi.KeyH="KeyH",fi.KeyI="KeyI",fi.KeyJ="KeyJ",fi.KeyK="KeyK",fi.KeyL="KeyL",fi.KeyM="KeyM",fi.KeyN="KeyN",fi.KeyO="KeyO",fi.KeyP="KeyP",fi.KeyQ="KeyQ",fi.KeyR="KeyR",fi.KeyS="KeyS",fi.KeyT="KeyT",fi.KeyU="KeyU",fi.KeyV="KeyV",fi.KeyW="KeyW",fi.KeyX="KeyX",fi.KeyY="KeyY",fi.KeyZ="KeyZ",fi.Minus="Minus",fi.Period="Period",fi.Quote="Quote",fi.Semicolon="Semicolon",fi.Slash="Slash",fi.AltLeft="AltLeft",fi.AltRight="AltRight",fi.Alt="Alt",fi.AltGraph="AltGraph",fi.Backspace="Backspace",fi.CapsLock="CapsLock",fi.ContextMenu="ContextMenu",fi.ControlLeft="ControlLeft",fi.ControlRight="ControlRight",fi.Enter="Enter",fi.MetaLeft="MetaLeft",fi.MetaRight="MetaRight",fi.ShiftLeft="ShiftLeft",fi.ShiftRight="ShiftRight",fi.Space="Space",fi.Tab="Tab",fi.Convert="Convert",fi.KanaMode="KanaMode",fi.NonConvert="NonConvert",fi.Delete="Delete",fi.End="End",fi.Help="Help",fi.Home="Home",fi.Insert="Insert",fi.PageDown="PageDown",fi.PageUp="PageUp",fi.Up="ArrowUp",fi.Down="ArrowDown",fi.Left="ArrowLeft",fi.Right="ArrowRight",fi.ArrowUp="ArrowUp",fi.ArrowDown="ArrowDown",fi.ArrowLeft="ArrowLeft",fi.ArrowRight="ArrowRight",fi.NumLock="NumLock",fi.Numpad0="Numpad0",fi.Numpad1="Numpad1",fi.Numpad2="Numpad2",fi.Numpad3="Numpad3",fi.Numpad4="Numpad4",fi.Numpad5="Numpad5",fi.Numpad6="Numpad6",fi.Numpad7="Numpad7",fi.Numpad8="Numpad8",fi.Numpad9="Numpad9",fi.Num0="Numpad0",fi.Num1="Numpad1",fi.Num2="Numpad2",fi.Num3="Numpad3",fi.Num4="Numpad4",fi.Num5="Numpad5",fi.Num6="Numpad6",fi.Num7="Numpad7",fi.Num8="Numpad8",fi.Num9="Numpad9",fi.NumAdd="NumpadAdd",fi.NumpadAdd="NumpadAdd",fi.NumDecimal="NumpadDecimal",fi.NumpadDecimal="NumpadDecimal",fi.NumDivide="NumpadDivide",fi.NumpadDivide="NumpadDivide",fi.NumEnter="NumpadEnter",fi.NumpadEnter="NumpadEnter",fi.NumMultiply="NumpadMultiply",fi.NumpadMultiply="NumpadMultiply",fi.NumSubtract="NumpadSubtract",fi.NumpadSubtract="NumpadSubtract",fi.Esc="Escape",fi.Escape="Escape",fi.F1="F1",fi.F2="F2",fi.F3="F3",fi.F4="F4",fi.F5="F5",fi.F6="F6",fi.F7="F7",fi.F8="F8",fi.F9="F9",fi.F10="F10",fi.F11="F11",fi.F12="F12",fi.F13="F13",fi.F14="F14",fi.F15="F15",fi.F16="F16",fi.F17="F17",fi.F18="F18",fi.F19="F19",fi.F20="F20",fi.PrintScreen="PrintScreen",fi.ScrollLock="ScrollLock",fi.Pause="Pause",fi.Unidentified="Unidentified"})(Keys||(Keys={}));class KeyEvent extends GameEvent{constructor(ci,hi,_i){super(),this.key=ci,this.value=hi,this.originalEvent=_i}}let Keyboard$1=class{constructor(){this.events=new EventEmitter,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=ci=>{for(const hi of this._keys){const _i=new KeyEvent(hi,ci.key,ci);this.events.emit("up",_i),this.events.emit("release",_i)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=ci=>{if(!this._enabled)return;!ci.metaKey&&(this._keys.includes(Keys.MetaLeft)||this._keys.includes(Keys.MetaRight))&&this._releaseAllKeys(ci);const hi=ci.code;if(this._keys.indexOf(hi)===-1){this._keys.push(hi),this._keysDown.push(hi);const _i=new KeyEvent(hi,ci.key,ci);this.events.emit("down",_i),this.events.emit("press",_i)}},this._handleKeyUp=ci=>{if(!this._enabled)return;const hi=ci.code,_i=this._keys.indexOf(hi);this._keys.splice(_i,1),this._keysUp.push(hi);const pi=new KeyEvent(hi,ci.key,ci);this.events.emit("up",pi),this.events.emit("release",pi),ci.key==="Meta"&&this._releaseAllKeys(ci)}}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}init(ci){let{global:hi}=ci;const{grabWindowFocus:_i}=ci;hi||(isCrossOriginIframe()?(hi=window,_i&&window.focus(),Logger.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):hi=window.top),hi.addEventListener("blur",()=>{this._keys.length=0}),hi.addEventListener("keyup",this._handleKeyUp),hi.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(ci){this._enabled=ci}clear(){this._keysDown.length=0,this._keysUp.length=0,this._keys.length=0}update(){this._keysDown.length=0,this._keysUp.length=0;for(let ci=0;ci<this._keys.length;ci++)this.events.emit("hold",new KeyEvent(this._keys[ci]))}getKeys(){return this._keys}wasPressed(ci){return this._enabled?this._keysDown.indexOf(ci)>-1:!1}isHeld(ci){return this._enabled?this._keys.indexOf(ci)>-1:!1}wasReleased(ci){return this._enabled?this._keysUp.indexOf(ci)>-1:!1}triggerEvent(ci,hi,_i){ci==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:hi,key:_i??null})),ci==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:hi,key:_i??null}))}};class GlobalCoordinates{static fromPagePosition(ci,hi,_i){let pi,gi,mi,xi;arguments.length===3?(pi=ci,gi=hi,mi=new Vector(pi,gi),xi=_i):(mi=ci,pi=mi.x,gi=mi.y,xi=hi);const yi=xi.screen.pageToScreenCoordinates(mi),Ci=xi.screen.screenToWorldCoordinates(yi);return new GlobalCoordinates(Ci,mi,yi)}constructor(ci,hi,_i){this.worldPos=ci,this.pagePos=hi,this.screenPos=_i}}class PointerEvent{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(ci,hi,_i,pi,gi,mi){this.type=ci,this.pointerId=hi,this.button=_i,this.pointerType=pi,this.coordinates=gi,this.nativeEvent=mi,this.active=!0}}class WheelEvent{cancel(){this.active=!1}constructor(ci,hi,_i,pi,gi,mi,xi,yi,Ci,Ei,Ai,ki){this.x=ci,this.y=hi,this.pageX=_i,this.pageY=pi,this.screenX=gi,this.screenY=mi,this.index=xi,this.deltaX=yi,this.deltaY=Ci,this.deltaZ=Ei,this.deltaMode=Ai,this.ev=ki,this.active=!0}}class PointerAbstraction{constructor(){this.events=new EventEmitter,this.lastPagePos=Vector.Zero,this.lastScreenPos=Vector.Zero,this.lastWorldPos=Vector.Zero,this._onPointerMove=ci=>{this.lastPagePos=new Vector(ci.pagePos.x,ci.pagePos.y),this.lastScreenPos=new Vector(ci.screenPos.x,ci.screenPos.y),this.lastWorldPos=new Vector(ci.worldPos.x,ci.worldPos.y)},this._onPointerDown=ci=>{this.lastPagePos=new Vector(ci.pagePos.x,ci.pagePos.y),this.lastScreenPos=new Vector(ci.screenPos.x,ci.screenPos.y),this.lastWorldPos=new Vector(ci.worldPos.x,ci.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}_updateWorldPosition(ci){const hi=GlobalCoordinates.fromPagePosition(this.lastPagePos,ci);this.lastScreenPos=hi.screenPos,this.lastWorldPos=hi.worldPos}}var WheelDeltaMode;(function(fi){fi.Pixel="Pixel",fi.Line="Line",fi.Page="Page"})(WheelDeltaMode||(WheelDeltaMode={}));var NativePointerButton;(function(fi){fi[fi.NoButton=-1]="NoButton",fi[fi.Left=0]="Left",fi[fi.Middle=1]="Middle",fi[fi.Right=2]="Right",fi[fi.Unknown=3]="Unknown"})(NativePointerButton||(NativePointerButton={}));var PointerButton;(function(fi){fi.Left="Left",fi.Middle="Middle",fi.Right="Right",fi.Unknown="Unknown",fi.NoButton="NoButton"})(PointerButton||(PointerButton={}));var PointerType;(function(fi){fi.Touch="Touch",fi.Mouse="Mouse",fi.Pen="Pen",fi.Unknown="Unknown"})(PointerType||(PointerType={}));function isTouchEvent(fi){return globalThis.TouchEvent&&fi instanceof globalThis.TouchEvent}function isPointerEvent(fi){return globalThis.PointerEvent&&fi instanceof globalThis.PointerEvent}class PointerEventReceiver{constructor(ci,hi){this.target=ci,this.engine=hi,this.events=new EventEmitter,this.primary=new PointerAbstraction,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(ci){this._enabled=ci}recreate(ci,hi){const _i=new PointerEventReceiver(ci,hi);return _i.primary=this.primary,_i._pointers=this._pointers,_i}at(ci){if(ci>=this._pointers.length)for(let hi=this._pointers.length-1,_i=ci;hi<_i;hi++)this._pointers.push(new PointerAbstraction);return this._pointers[ci]}count(){return this._pointers.length}isDown(ci){var hi;return this._enabled&&(hi=this.currentFramePointerDown.get(ci))!==null&&hi!==void 0?hi:!1}wasDown(ci){var hi;return this._enabled&&(hi=this.lastFramePointerDown.get(ci))!==null&&hi!==void 0?hi:!1}isDragging(ci){return this._enabled?this.isDown(ci):!1}isDragStart(ci){return this._enabled?this.isDown(ci)&&!this.wasDown(ci):!1}isDragEnd(ci){return this._enabled?!this.isDown(ci)&&this.wasDown(ci):!1}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const ci of this.currentFrameDown){if(!ci.active)continue;this.emit("down",ci),this.at(ci.pointerId).emit("down",ci),this.primary.emit("pointerdown",ci)}for(const ci of this.currentFrameUp){if(!ci.active)continue;this.emit("up",ci),this.at(ci.pointerId).emit("up",ci)}for(const ci of this.currentFrameMove){if(!ci.active)continue;this.emit("move",ci),this.at(ci.pointerId).emit("move",ci)}for(const ci of this.currentFrameCancel){if(!ci.active)continue;this.emit("cancel",ci),this.at(ci.pointerId).emit("cancel",ci)}for(const ci of this.currentFrameWheel)ci.active&&(this.emit("pointerwheel",ci),this.emit("wheel",ci),this.primary.emit("pointerwheel",ci),this.primary.emit("wheel",ci));if(this.engine.currentScene.camera.hasChanged())for(const ci of this._pointers)ci._updateWorldPosition(this.engine)}clear(){for(const ci of this.currentFrameUp){this.currentFramePointerCoords.delete(ci.pointerId);const hi=this._activeNativePointerIdsToNormalized.entries();for(const[_i,pi]of hi)pi===ci.pointerId&&this._activeNativePointerIdsToNormalized.delete(_i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(ci){var hi;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const _i={passive:!(this.engine.pageScrollPreventionMode===ScrollPreventionMode.All||this.engine.pageScrollPreventionMode===ScrollPreventionMode.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,_i):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,_i):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,_i),((hi=ci==null?void 0:ci.grabWindowFocus)!==null&&hi!==void 0?hi:!0)&&isCrossOriginIframe()){const gi=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",gi):(this.target.addEventListener("touchstart",gi),this.target.addEventListener("mousedown",gi))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(ci){this._activeNativePointerIdsToNormalized.set(ci,-1);const _i=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((pi,gi)=>pi-gi).findIndex(pi=>pi===ci);return this._activeNativePointerIdsToNormalized.set(ci,_i),_i}_handle(ci){if(!this._enabled)return;ci.preventDefault();const hi=new Map;let _i,pi;if(isTouchEvent(ci)){_i=PointerButton.Unknown,pi=PointerType.Touch;for(let gi=0;gi<ci.changedTouches.length;gi++){const mi=ci.changedTouches[gi],xi=GlobalCoordinates.fromPagePosition(mi.pageX,mi.pageY,this.engine),yi=gi+1,Ci=this._normalizePointerId(yi);this.currentFramePointerCoords.set(Ci,xi),hi.set(Ci,xi)}}else{_i=this._nativeButtonToPointerButton(ci.button),pi=PointerType.Mouse;const gi=GlobalCoordinates.fromPagePosition(ci.pageX,ci.pageY,this.engine);let mi=1;isPointerEvent(ci)&&(mi=ci.pointerId,pi=this._stringToPointerType(ci.pointerType));const xi=this._normalizePointerId(mi);this.currentFramePointerCoords.set(xi,gi),hi.set(xi,gi)}for(const[gi,mi]of hi.entries())switch(ci.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new PointerEvent("down",gi,_i,pi,mi,ci)),this.currentFramePointerDown.set(gi,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new PointerEvent("up",gi,_i,pi,mi,ci)),this.currentFramePointerDown.set(gi,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new PointerEvent("move",gi,_i,pi,mi,ci));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new PointerEvent("cancel",gi,_i,pi,mi,ci));break}}_handleWheel(ci){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===ScrollPreventionMode.All||this.engine.pageScrollPreventionMode===ScrollPreventionMode.Canvas&&ci.target===this.engine.canvas)&&ci.preventDefault();const hi=this.engine.screen.pageToScreenCoordinates(vec(ci.pageX,ci.pageY)),_i=this.engine.screen.screenToWorldCoordinates(hi),pi=-1/40,gi=ci.deltaX||ci.wheelDeltaX*pi||0,mi=ci.deltaY||ci.wheelDeltaY*pi||ci.wheelDelta*pi||ci.detail||0,xi=ci.deltaZ||0;let yi=WheelDeltaMode.Pixel;ci.deltaMode&&(ci.deltaMode===1?yi=WheelDeltaMode.Line:ci.deltaMode===2&&(yi=WheelDeltaMode.Page));const Ci=new WheelEvent(_i.x,_i.y,ci.pageX,ci.pageY,hi.x,hi.y,0,gi,mi,xi,yi,ci);this.currentFrameWheel.push(Ci)}triggerEvent(ci,hi){const _i=this.engine.screen.worldToPageCoordinates(hi);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+ci,{pointerId:0,clientX:_i.x,clientY:_i.y})):this._handle(new window.MouseEvent("mouse"+ci,{clientX:_i.x,clientY:_i.y}));const pi=this.engine.currentScene.world.get(PointerSystem);pi.preupdate(this.engine.currentScene,1),pi.update(1)}_nativeButtonToPointerButton(ci){switch(ci){case NativePointerButton.NoButton:return PointerButton.NoButton;case NativePointerButton.Left:return PointerButton.Left;case NativePointerButton.Middle:return PointerButton.Middle;case NativePointerButton.Right:return PointerButton.Right;case NativePointerButton.Unknown:return PointerButton.Unknown;default:return fail(ci)}}_stringToPointerType(ci){switch(ci){case"touch":return PointerType.Touch;case"mouse":return PointerType.Mouse;case"pen":return PointerType.Pen;default:return PointerType.Unknown}}}class InputHost{constructor(ci){this._enabled=!0;const{pointerTarget:hi,grabWindowFocus:_i,engine:pi}=ci;this.keyboard=new Keyboard$1,this.pointers=new PointerEventReceiver(hi,pi),this.gamepads=new Gamepads,this.keyboard.init({grabWindowFocus:_i}),this.pointers.init({grabWindowFocus:_i}),this.gamepads.init(),this.inputMapper=new InputMapper({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(ci){this._enabled=ci,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}clear(){this.keyboard.clear(),this.pointers.clear()}}class PreLoadEvent{}const SceneEvents={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PreLoad:"preload"};function isSceneConstructor(fi){var ci,hi;return!!(fi!=null&&fi.prototype)&&!!(!((hi=(ci=fi==null?void 0:fi.prototype)===null||ci===void 0?void 0:ci.constructor)===null||hi===void 0)&&hi.name)}class Scene{get actors(){return this.world.entityManager.entities.filter(ci=>ci instanceof Actor)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(ci=>ci instanceof Trigger)}get tileMaps(){return this.world.entityManager.entities.filter(ci=>ci instanceof TileMap)}get timers(){return this._timers}constructor(){this._logger=Logger.getInstance(),this.events=new EventEmitter,this.camera=new Camera,this.world=new World(this),this.physics=new PhysicsWorld(getDefaultPhysicsConfig()),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(ActionsSystem),this.world.add(new MotionSystem(this.world,this.physics)),this.world.add(new CollisionSystem(this.world,this.physics)),this.world.add(PointerSystem),this.world.add(IsometricEntitySystem),this.world.add(OffscreenSystem),this.world.add(GraphicsSystem),this.world.add(DebugSystem)}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}onPreLoad(ci){}onTransition(ci){}onInitialize(ci){}onActivate(ci){}onDeactivate(ci){}onPreUpdate(ci,hi){}onPostUpdate(ci,hi){}onPreDraw(ci,hi){}onPostDraw(ci,hi){}_initializeChildren(){for(const ci of this.entities)ci._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(ci){var hi;if(!this.isInitialized){try{this.engine=ci,this.physics.config=this.engine.physics,this.input=new InputHost({pointerTarget:ci.pointerScope===PointerScope.Canvas?ci.canvas:document,grabWindowFocus:ci.grabWindowFocus,engine:ci}),this.camera._initialize(ci),this.world.systemManager.initialize(),await this.onInitialize(ci),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,ci),this.events.emit("initialize",new InitializeEvent(ci,this))}catch(_i){throw this._logger.error(`Error during scene initialization for scene ${(hi=ci.director)===null||hi===void 0?void 0:hi.getSceneName(this)}!`),_i}this._isInitialized=!0}}async _activate(ci){var hi,_i;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(ci)}catch(pi){throw this._logger.error(`Error during scene activation for scene ${(_i=(hi=this.engine)===null||hi===void 0?void 0:hi.director)===null||_i===void 0?void 0:_i.getSceneName(this)}!`),pi}}async _deactivate(ci){this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(ci)}_preupdate(ci,hi){this.emit("preupdate",new PreUpdateEvent(ci,hi,this)),this.onPreUpdate(ci,hi)}_postupdate(ci,hi){this.emit("postupdate",new PostUpdateEvent(ci,hi,this)),this.onPostUpdate(ci,hi)}_predraw(ci,hi){this.emit("predraw",new PreDrawEvent(ci,hi,this)),this.onPreDraw(ci,hi)}_postdraw(ci,hi){this.emit("postdraw",new PostDrawEvent(ci,hi,this)),this.onPostDraw(ci,hi)}update(ci,hi){var _i;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(_i=ci.director)===null||_i===void 0?void 0:_i.getSceneName(this)}!`);return}this._preupdate(ci,hi);let pi,gi;for(pi=0,gi=this._cancelQueue.length;pi<gi;pi++)this.removeTimer(this._cancelQueue[pi]);this._cancelQueue.length=0;for(const mi of this._timers)mi.update(hi);this.world.update(SystemType.Update,hi),this.camera&&this.camera.update(ci,hi),this._collectActorStats(ci),this._postupdate(ci,hi),this.input.update()}draw(ci,hi){var _i;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(ci,hi),this.world.update(SystemType.Draw,hi),!((_i=this.engine)===null||_i===void 0)&&_i.isDebug&&this.debugDraw(ci),this._postdraw(ci,hi)}debugDraw(ci){this.emit("predebugdraw",new PreDebugDrawEvent(ci,this)),this.emit("postdebugdraw",new PostDebugDrawEvent(ci,this))}contains(ci){return this.actors.indexOf(ci)>-1}add(ci){if(this.emit("entityadded",{target:ci}),ci instanceof Timer){contains(this._timers,ci)||this.addTimer(ci);return}this.world.add(ci),ci.scene=this}transfer(ci){let hi;ci instanceof Entity&&ci.scene&&ci.scene!==this&&(hi=ci.scene,ci.scene.world.remove(ci,!1)),ci instanceof Timer&&ci.scene&&(hi=ci.scene,ci.scene.removeTimer(ci)),hi==null||hi.emit("entityremoved",{target:ci}),this.add(ci)}remove(ci){this.emit("entityremoved",{target:ci}),ci instanceof Entity&&(ci.isActive&&ci.kill(),this.world.remove(ci)),ci instanceof Timer&&this.removeTimer(ci)}clear(ci=!0){for(let hi=this.entities.length-1;hi>=0;hi--)this.world.remove(this.entities[hi],ci);for(let hi=this.timers.length-1;hi>=0;hi--)this.removeTimer(this.timers[hi])}addTimer(ci){return this._timers.push(ci),ci.scene=this,ci}removeTimer(ci){const hi=this._timers.indexOf(ci);return hi!==-1&&this._timers.splice(hi,1),ci}cancelTimer(ci){return this._cancelQueue.push(ci),ci}isTimerActive(ci){return this._timers.indexOf(ci)>-1&&!ci.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(ci){const hi=this.actors;for(let _i=0;_i<hi.length;_i++){const pi=hi[_i];pi instanceof ScreenElement&&ci.stats.currFrame.actors.ui++,ci.stats.currFrame.actors.alive++;for(let gi=0;gi<pi.children.length;gi++){const mi=pi.children[gi];isScreenElement(mi)?ci.stats.currFrame.actors.ui++:ci.stats.currFrame.actors.alive++}}}}var ColorBlindnessMode;(function(fi){fi.Protanope="Protanope",fi.Deuteranope="Deuteranope",fi.Tritanope="Tritanope"})(ColorBlindnessMode||(ColorBlindnessMode={}));const color_blind_fragment=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class ScreenShader{constructor(ci,hi){this._shader=new Shader({gl:ci,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_uv;
      out vec2 v_texcoord;
      out vec2 v_uv;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_uv;
        v_uv = a_uv;
      }`,fragmentSource:hi}),this._shader.compile(),this._buffer=new VertexBuffer({gl:ci,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new VertexLayout({gl:ci,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class ColorBlindnessPostProcessor{constructor(ci,hi=!1){this._colorBlindnessMode=ci,this._simulate=!1,this._simulate=hi}initialize(ci){this._shader=new ScreenShader(ci,color_blind_fragment),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(ci){if(this._colorBlindnessMode=ci,this._shader){const hi=this._shader.getShader();hi.use(),this._colorBlindnessMode===ColorBlindnessMode.Protanope?hi.setUniformInt("u_type",0):this._colorBlindnessMode===ColorBlindnessMode.Deuteranope?hi.setUniformInt("u_type",1):this._colorBlindnessMode===ColorBlindnessMode.Tritanope&&hi.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(ci){if(this._simulate=ci,this._shader){const hi=this._shader.getShader();hi.use(),hi.setUniformBoolean("u_simulate",ci)}}get simulate(){return this._simulate}}class ColorBlindFlags{constructor(ci){this._engine=ci,this._colorBlindPostProcessor=new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope)}correct(ci){this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=ci,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(ci){this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=ci,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class DebugConfig{constructor(ci){this.stats={currFrame:new FrameStats,prevFrame:new FrameStats},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:Color.Yellow,showZIndex:!1,showScale:!1,scaleColor:Color.Green,showRotation:!1,rotationColor:Color.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:Color.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:Color.Blue,showOwner:!1,showGeometry:!0,geometryColor:Color.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:Color.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:Color.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:Color.Yellow,showAcceleration:!1,accelerationColor:Color.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:Color.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:Color.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:Color.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:Color.Yellow,positionSize:1,showGrid:!1,gridColor:Color.Red,gridWidth:1,showColliderGeometry:!0},this._engine=ci,this.colorBlindMode=new ColorBlindFlags(this._engine)}useTestClock(){const ci=this._engine.clock,hi=ci.isRunning();ci.stop();const _i=ci.toTestClock();return hi&&_i.start(),this._engine.clock=_i,_i}useStandardClock(){const ci=this._engine.clock,hi=ci.isRunning();ci.stop();const _i=ci.toStandardClock();return hi&&_i.start(),this._engine.clock=_i,_i}}class FrameStats{constructor(){this._id=0,this._elapsedMs=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new PhysicsStats,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(ci){ci?(this.id=ci.id,this.elapsedMs=ci.elapsedMs,this.fps=ci.fps,this.actors.alive=ci.actors.alive,this.actors.killed=ci.actors.killed,this.actors.ui=ci.actors.ui,this.duration.update=ci.duration.update,this.duration.draw=ci.duration.draw,this._physicsStats.reset(ci.physics),this.graphics.drawCalls=ci.graphics.drawCalls,this.graphics.drawnImages=ci.graphics.drawnImages):(this.id=this.elapsedMs=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const ci=new FrameStats;return ci.reset(this),ci}get id(){return this._id}set id(ci){this._id=ci}get elapsedMs(){return this._elapsedMs}set elapsedMs(ci){this._elapsedMs=ci}get fps(){return this._fps}set fps(ci){this._fps=ci}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class PhysicsStats{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(ci){ci?(this.pairs=ci.pairs,this.collisions=ci.collisions,this.contacts=ci.contacts,this.fastBodies=ci.fastBodies,this.fastBodyCollisions=ci.fastBodyCollisions,this.broadphase=ci.broadphase,this.narrowphase=ci.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const ci=new PhysicsStats;return ci.reset(this),ci}get pairs(){return this._pairs}set pairs(ci){this._pairs=ci}get collisions(){return this._collisions}set collisions(ci){this._collisions=ci}get contacts(){return this._contacts}set contacts(ci){this._contacts=ci}get fastBodies(){return this._fastBodies}set fastBodies(ci){this._fastBodies=ci}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(ci){this._fastBodyCollisions=ci}get broadphase(){return this._broadphase}set broadphase(ci){this._broadphase=ci}get narrowphase(){return this._narrowphase}set narrowphase(ci){this._narrowphase=ci}}class BrowserComponent{on(ci,hi){this._nativeHandlers[ci]&&this.off(ci,this._nativeHandlers[ci]),this._nativeHandlers[ci]=this._decorate(hi),this.nativeComponent.addEventListener(ci,this._nativeHandlers[ci])}off(ci,hi){hi||(hi=this._nativeHandlers[ci]),this.nativeComponent.removeEventListener(ci,hi),this._nativeHandlers[ci]=null}_decorate(ci){return hi=>{this._paused||ci(hi)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const ci in this._nativeHandlers)this.off(ci)}constructor(ci){this.nativeComponent=ci,this._paused=!1,this._nativeHandlers={}}}class BrowserEvents{constructor(ci,hi){this._windowGlobal=ci,this._documentGlobal=hi,this._windowComponent=new BrowserComponent(this._windowGlobal),this._documentComponent=new BrowserComponent(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}const DefaultAntialiasOptions={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ImageFiltering.Blended,canvasImageRendering:"auto"},DefaultPixelArtOptions={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ImageFiltering.Blended,canvasImageRendering:"auto"};class FpsSampler{constructor(ci){var hi;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=ci.initialFps,this._samplePeriod=(hi=ci.samplePeriod)!==null&&hi!==void 0?hi:this._samplePeriod,this._currentFrameTime=1e3/ci.initialFps,this._nowFn=ci.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const ci=this._nowFn();this._currentFrameTime=ci-this._beginFrameTime,ci>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(ci-this._previousSampleTime),this._previousSampleTime=ci,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Clock{constructor(ci){var hi,_i,pi;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=ci,this.tick=ci.tick,this._lastTime=(hi=this.now())!==null&&hi!==void 0?hi:0,this._maxFps=(_i=ci.maxFps)!==null&&_i!==void 0?_i:this._maxFps,this._onFatalException=(pi=ci.onFatalException)!==null&&pi!==void 0?pi:this._onFatalException,this.fpsSampler=new FpsSampler({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new TestClock({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new StandardClock({...this._options})}setFatalExceptionHandler(ci){this._onFatalException=ci}schedule(ci,hi=0,_i="preframe"){const pi=this._totalElapsed+hi;this._scheduledCbs.push([ci,pi,_i])}__runScheduledCbs(ci="preframe"){for(let hi=this._scheduledCbs.length-1;hi>-1;hi--)ci===this._scheduledCbs[hi][2]&&this._scheduledCbs[hi][1]<=this._totalElapsed&&(this._scheduledCbs[hi][0](this._elapsed),this._scheduledCbs.splice(hi,1))}update(ci){try{this.fpsSampler.start();const hi=this.now();let _i=hi-this._lastTime||1;const pi=1e3/this._maxFps;if(_i>=pi){let gi=0;pi!==0&&(gi=_i%pi,_i=_i-gi),_i>200&&(_i=1),this._elapsed=ci||_i,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(ci||_i),this.__runScheduledCbs("postframe"),pi!==0?this._lastTime=hi-gi:this._lastTime=hi,this.fpsSampler.end()}}catch(hi){this._onFatalException(hi),this.stop()}}}class StandardClock extends Clock{constructor(ci){super(ci),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const ci=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(ci),this.update()}catch(hi){throw window.cancelAnimationFrame(this._requestId),hi}};ci()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class TestClock extends Clock{constructor(ci){super({...ci}),this._logger=Logger.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=ci.defaultUpdateMs}now(){var ci;return(ci=this._currentTime)!==null&&ci!==void 0?ci:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(ci){const hi=ci??this._updateMs;this._running?(this.update(hi),this._currentTime+=hi):this._logger.warn("The clock is not running, no step will be performed")}run(ci,hi){for(let _i=0;_i<ci;_i++)this.step(hi??this._updateMs)}}var Util_Toaster=__webpack_require__(296);class Toaster{constructor(){this._toasterCss=Util_Toaster.A.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(ci){const hi=document.createElement("span");return hi.innerText=ci,hi}toast(ci,hi,_i){this._initialize();const pi=document.createElement("div");pi.className="ex-toast-message";const gi=ci.split("[LINK]").map(Ei=>this._createFragment(Ei));if(hi){const Ei=document.createElement("a");Ei.href=hi,_i?Ei.innerText=_i:Ei.innerText=hi,gi.splice(1,0,Ei)}const mi=document.createElement("div");gi.forEach(Ei=>{mi.appendChild(Ei)}),pi.appendChild(mi);const xi=document.createElement("button");xi.innerText="x",xi.addEventListener("click",()=>{this._container.removeChild(pi)}),pi.appendChild(xi);const yi=Ei=>{if(Ei.key==="Escape")try{this._container.removeChild(pi)}catch{}document.removeEventListener("keydown",yi)};document.addEventListener("keydown",yi);const Ci=this._container.firstChild;this._container.insertBefore(pi,Ci)}}const DirectorEvents={NavigationStart:"navigationstart",Navigation:"navigation",NavigationEnd:"navigationend"};class Director{get isTransitioning(){return this._isTransitioning}constructor(ci,hi){this._engine=ci,this.events=new EventEmitter,this._logger=Logger.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Scene,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const _i in hi){const pi=hi[_i];this.add(_i,pi),_i==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const ci=this._deferredGoto;this._deferredGoto=void 0;const hi=this._deferredTransition;this._deferredTransition=void 0;const _i=this.getSceneInstance(ci);_i&&hi&&hi._addToTargetScene(this._engine,_i),await this.swapScene(ci),_i&&hi&&await this.playTransition(hi,_i)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(ci,hi){const _i=hi==null?void 0:hi.loader;_i instanceof DefaultLoader?this.mainLoader=_i:isLoaderConstructor(_i)?this.mainLoader=new _i:this.mainLoader=new Loader;let pi;if(hi!=null&&hi.inTransition){const{inTransition:gi}=hi;pi=gi}if(this.startScene=ci,pi){const gi=this.getSceneInstance(this.startScene);gi&&(pi._addToTargetScene(this._engine,gi),this.swapScene(this.startScene).then(()=>this.playTransition(pi,gi)))}else this.swapScene(this.startScene);this.currentSceneName=this.startScene}_getLoader(ci){return this._sceneToLoader.get(ci)}_getInTransition(ci){var hi;const _i=this.scenes[ci];if(!(_i instanceof Scene||isSceneConstructor(_i)))return(hi=_i==null?void 0:_i.transitions)===null||hi===void 0?void 0:hi.in}_getOutTransition(ci){var hi;const _i=this.scenes[ci];if(!(_i instanceof Scene||isSceneConstructor(_i)))return(hi=_i==null?void 0:_i.transitions)===null||hi===void 0?void 0:hi.out}getDeferredScene(){const ci=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&ci?ci:null}getSceneDefinition(ci){const hi=this.scenes[ci];if(hi instanceof Scene||isSceneConstructor(hi))return hi;if(hi)return hi.scene}getSceneName(ci){for(const[hi,_i]of Object.entries(this.scenes))if(_i instanceof Scene){if(ci===_i)return hi}else if(!isSceneConstructor(_i)&&ci===_i.scene)return hi;for(const[hi,_i]of Object.entries(this.scenes))if(isSceneConstructor(_i)){if(ci.constructor===_i)return hi}else if(!(_i instanceof Scene)&&ci.constructor===_i.scene)return hi;return null}assertAdded(ci){return this}assertRemoved(ci){return this}add(ci,hi){if(!(hi instanceof Scene)&&!isSceneConstructor(hi)){const{loader:_i,transitions:pi}=hi,{in:gi,out:mi}=pi??{};this._sceneToTransition.set(ci,{in:gi,out:mi}),isLoaderConstructor(_i)?this._sceneToLoader.set(ci,new _i):_i&&this._sceneToLoader.set(ci,_i)}return this.scenes[ci]&&this._logger.warn("Scene",ci,"already exists overwriting"),this.scenes[ci]=hi,this.assertAdded(ci)}remove(ci){if(ci instanceof Scene||isSceneConstructor(ci)){const hi=ci;for(const _i in this.scenes)if(this.scenes.hasOwnProperty(_i)){const pi=this.scenes[_i];let gi;if(pi instanceof Scene||isSceneConstructor(pi)?gi=pi:gi=pi.scene,gi===hi){if(_i===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${_i}`);this._sceneToInstance.delete(_i),this._sceneToTransition.delete(_i),this._sceneToLoader.delete(_i),delete this.scenes[_i]}}}if(typeof ci=="string"){if(ci===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${ci}`);this._sceneToInstance.delete(ci),this._sceneToTransition.delete(ci),this._sceneToLoader.delete(ci),delete this.scenes[ci]}}async goToScene(ci,hi){var _i,pi,gi,mi,xi,yi;const Ci=this.getSceneInstance(ci);if(!Ci){this._logger.warn(`Scene ${ci} does not exist! Check the name, are you sure you added it?`);return}const Ei=this.currentScene,Ai=this.currentSceneName,ki=(pi=(_i=this._engine.input)===null||_i===void 0?void 0:_i.enabled)!==null&&pi!==void 0?pi:!0;this._isTransitioning=!0;const Pi=(gi=this.getSceneInstance(Ai))===null||gi===void 0?void 0:gi.onTransition("out"),Ii=Ci==null?void 0:Ci.onTransition("in");hi={sourceOut:(mi=this._getOutTransition(this.currentSceneName))!==null&&mi!==void 0?mi:Pi,destinationIn:(xi=this._getInTransition(ci))!==null&&xi!==void 0?xi:Ii,...hi};const{sourceOut:Di,destinationIn:Fi,sceneActivationData:Li}=hi,Bi=Di??this._getOutTransition(this.currentSceneName),Ri=Fi??this._getInTransition(ci),$i=(Bi==null?void 0:Bi.hideLoader)||(Ri==null?void 0:Ri.hideLoader);$i&&this.maybeLoadScene(ci,$i),this._emitEvent("navigationstart",Ai,ci),Bi&&await this.playTransition(Bi,Ei),await this.maybeLoadScene(ci,$i),Ri&&await Ri.onPreviousSceneDeactivate(this.currentScene),Ri&&Ri._addToTargetScene(this._engine,Ci),await this.swapScene(ci,Li),this._emitEvent("navigation",Ai,ci),Ri&&await this.playTransition(Ri,Ci),this._emitEvent("navigationend",Ai,ci),(yi=this._engine.input)===null||yi===void 0||yi.toggleEnabled(ki),this._isTransitioning=!1}getSceneInstance(ci){const hi=this.getSceneDefinition(ci);if(!hi)return;if(this._sceneToInstance.has(ci))return this._sceneToInstance.get(ci);if(hi instanceof Scene)return this._sceneToInstance.set(ci,hi),hi;const _i=new hi;return this._sceneToInstance.set(ci,_i),_i}async maybeLoadScene(ci,hi=!1){var _i;const pi=(_i=this._getLoader(ci))!==null&&_i!==void 0?_i:new DefaultLoader,gi=this.getSceneDefinition(ci),mi=this.getSceneInstance(ci);gi&&mi&&!this._loadedScenes.has(mi)&&(mi.onPreLoad(pi),mi.events.emit("preload",{loader:pi}),hi?this._engine.load(pi,hi):await this._engine.load(pi),this._loadedScenes.add(mi))}async playTransition(ci,hi){var _i,pi,gi,mi,xi,yi,Ci;if(!this.isInitialized){this._deferredTransition=ci;return}if(ci){this.currentTransition=ci;const Ei=(pi=(_i=hi.input)===null||_i===void 0?void 0:_i.enabled)!==null&&pi!==void 0?pi:!0;(gi=hi.input)===null||gi===void 0||gi.toggleEnabled(!ci.blockInput),(mi=this._engine.input)===null||mi===void 0||mi.toggleEnabled(!ci.blockInput),this.currentTransition._addToTargetScene(this._engine,hi),await this.currentTransition._play(),(xi=hi.input)===null||xi===void 0||xi.toggleEnabled(Ei)}(yi=this.currentTransition)===null||yi===void 0||yi.kill(),(Ci=this.currentTransition)===null||Ci===void 0||Ci.reset(),this.currentTransition=void 0}async swapScene(ci,hi){const _i=this._engine;if(!this.isInitialized){this._deferredGoto=ci;return}const pi=this.getSceneInstance(ci);if(pi){const gi=this.currentScene,mi=pi;if(this._logger.debug("Going to scene:",ci),this.currentScene.isInitialized){const Ci={engine:_i,previousScene:gi,nextScene:mi};await this.currentScene._deactivate(Ci),this.currentScene.events.emit("deactivate",new DeactivateEvent(Ci,this.currentScene)),this.currentScene.input.clear()}const xi=this._sceneToLoader.get(ci);await(xi==null?void 0:xi.areResourcesLoaded()),this.currentScene=mi,this.currentSceneName=ci,_i.screen.setCurrentCamera(mi.camera),await this.currentScene._initialize(_i);const yi={engine:_i,previousScene:gi,nextScene:mi,data:hi};await this.currentScene._activate(yi),this.currentScene.events.emit("activate",new ActivateEvent(yi,this.currentScene))}else this._logger.error("Scene",ci,"does not exist!")}_emitEvent(ci,hi,_i){const pi=this.getSceneDefinition(hi),gi=this.getSceneDefinition(_i);this.events.emit(ci,{sourceScene:pi,sourceName:hi,destinationScene:gi,destinationName:_i})}}function createContext(){const fi={scope:(ci,hi)=>{const _i=fi.value;fi.value=ci;try{return hi()}catch(pi){throw pi}finally{fi.value=_i}},value:void 0};return fi}function useContext(fi){return fi.value}const DefaultGarbageCollectionOptions={textureCollectInterval:6e4};class GarbageCollector{constructor(ci){this.options=ci,this._running=!1,this._collectionMap=new Map,this._collectors=new Map,this.collectStaleResources=hi=>{if(this._running){for(const[_i,[pi,gi]]of this._collectors.entries()){const mi=this.options.getTimestamp();for(const[xi,[yi,Ci]]of this._collectionMap.entries()){if(_i!==yi||Ci+gi>=mi)continue;pi(xi)&&this._collectionMap.delete(xi)}}this._collectHandle=requestIdleCallback(this.collectStaleResources)}}}registerCollector(ci,hi,_i){this._collectors.set(ci,[_i,hi])}addCollectableResource(ci,hi){this._collectionMap.set(hi,[ci,this.options.getTimestamp()])}touch(ci){const hi=this._collectionMap.get(ci);hi&&this._collectionMap.set(ci,[hi[0],this.options.getTimestamp()])}forceCollectAll(){for(const[ci,[hi]]of this._collectors.entries())for(const[_i]of this._collectionMap.entries())hi(_i)&&this._collectionMap.delete(_i)}start(){this._running=!0,this.collectStaleResources()}stop(){this._running=!1,cancelIdleCallback(this._collectHandle)}}polyfill();const EngineEvents={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var ScrollPreventionMode;(function(fi){fi[fi.None=0]="None",fi[fi.Canvas=1]="Canvas",fi[fi.All=2]="All"})(ScrollPreventionMode||(ScrollPreventionMode={}));class Engine{static useEngine(){const ci=useContext(Engine.Context);if(!ci)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return ci}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(ci){this.graphicsContext.snapToPixel=ci}emit(ci,hi){this.events.emit(ci,hi)}on(ci,hi){return this.events.on(ci,hi)}once(ci,hi){return this.events.once(ci,hi)}off(ci,hi){this.events.off(ci,hi)}constructor(ci){var hi,_i,pi,gi,mi,xi,yi,Ci,Ei;this.scope=$i=>Engine.Context.scope(this,$i),this.version=EX_VERSION,this.events=new EventEmitter,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=$i=>{Logger.getInstance().fatal($i,$i.stack)},this._toaster=new Toaster,this._timescale=1,this._isInitialized=!1,this._originalOptions={},this._handleWebGLContextLost=$i=>{var Ni;$i.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",$i);const ji=document.createElement("div");ji.id="ex-webgl-graphics-context-lost",ji.style.position="absolute",ji.style.zIndex="99",ji.style.left="50%",ji.style.top="50%",ji.style.display="flex",ji.style.flexDirection="column",ji.style.transform="translate(-50%, -50%)",ji.style.backgroundColor="white",ji.style.padding="10px",ji.style.borderStyle="solid 1px";const Ui=document.createElement("div");if(Ui.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,ji.appendChild(Ui),!((Ni=this.canvas)===null||Ni===void 0)&&Ni.parentElement){this.canvas.parentElement.appendChild(ji);const qi=Ui.querySelector("#ex-webgl-graphics-reload");qi==null||qi.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new Future,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],ci={...Engine._DEFAULT_ENGINE_OPTIONS,...ci},this._originalOptions=ci,Flags.freeze(),this.browser=new BrowserEvents(window,document);const Ai=new Detector;if(!ci.suppressMinimumBrowserFeatureDetection&&!(this._compatible=Ai.test())){const $i=document.createElement("div");if($i.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild($i),Ai.failedTests.forEach(function(Ni){const ji=document.createElement("div");ji.innerText="Browser feature missing "+Ni,document.body.appendChild(ji)}),ci.canvasElementId){const Ni=document.getElementById(ci.canvasElementId);Ni&&Ni.parentElement.removeChild(Ni)}return}else this._compatible=!0;if(console.log&&!ci.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${EX_VERSION})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),ci.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=Logger.getInstance(),this._logger.defaultLevel===LogLevel.Debug&&Ai.logBrowserFeatures(),this._logger.debug("Building engine..."),ci.garbageCollection===!0?this.garbageCollectorConfig={...DefaultGarbageCollectionOptions}:ci.garbageCollection===!1?(this._logger.warn("WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted"),this.garbageCollectorConfig=null):this.garbageCollectorConfig={...DefaultGarbageCollectionOptions,...ci.garbageCollection},this._garbageCollector=new GarbageCollector({getTimestamp:Date.now}),this.canvasElementId=ci.canvasElementId,ci.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+ci.canvasElementId),document.getElementById(ci.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(ci.canvasElementId)}else ci.canvasElement?(this._logger.debug("Using Canvas element specified:",ci.canvasElement),this.canvas=ci.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));this.canvas&&!ci.enableCanvasContextMenu&&this.canvas.addEventListener("contextmenu",$i=>{$i.preventDefault()});let ki=(hi=ci.displayMode)!==null&&hi!==void 0?hi:DisplayMode.Fixed;ci.width&&ci.height||ci.viewport?(ci.displayMode===void 0&&(ki=DisplayMode.Fixed),this._logger.debug("Engine viewport is size "+ci.width+" x "+ci.height)):ci.displayMode||(this._logger.debug("Engine viewport is fit"),ki=DisplayMode.FitScreen),this.grabWindowFocus=ci.grabWindowFocus,this.pointerScope=ci.pointerScope,this._originalDisplayMode=ki;let Pi,Ii,Di,Fi,Li,Bi;typeof ci.antialiasing=="object"?{pixelArtSampler:Pi,nativeContextAntialiasing:Di,multiSampleAntialiasing:Bi,filtering:Li,canvasImageRendering:Fi}={...ci.pixelArt?DefaultPixelArtOptions:DefaultAntialiasOptions,...ci.antialiasing}:(Pi=!!ci.pixelArt,Di=!1,Bi=ci.antialiasing,Fi=ci.antialiasing?"auto":"pixelated",Li=ci.antialiasing?ImageFiltering.Blended:ImageFiltering.Pixel),Di&&Bi&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),ci.pixelArt&&(Ii=.25),(!ci.antialiasing||Li===ImageFiltering.Pixel)&&(Ii=0),Ii=(pi=(_i=ci.uvPadding)!==null&&_i!==void 0?_i:Ii)!==null&&pi!==void 0?pi:.01;let Ri=Flags.isEnabled("use-canvas-context");if(!Ri)try{this.graphicsContext=new ExcaliburGraphicsContextWebGL({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:Pi,antialiasing:Di,multiSampleAntialiasing:Bi,uvPadding:Ii,powerPreference:ci.powerPreference,backgroundColor:ci.backgroundColor,snapToPixel:ci.snapToPixel,useDrawSorting:ci.useDrawSorting,garbageCollector:this.garbageCollectorConfig?{garbageCollector:this._garbageCollector,collectionInterval:this.garbageCollectorConfig.textureCollectInterval}:null,handleContextLost:(gi=ci.handleContextLost)!==null&&gi!==void 0?gi:this._handleWebGLContextLost,handleContextRestored:ci.handleContextRestored})}catch($i){this._logger.warn(`Excalibur could not load webgl for some reason (${$i.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),Ri=!0}Ri&&(this.graphicsContext=new ExcaliburGraphicsContext2DCanvas({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:Di,backgroundColor:ci.backgroundColor,snapToPixel:ci.snapToPixel,useDrawSorting:ci.useDrawSorting})),this.screen=new Screen({canvas:this.canvas,context:this.graphicsContext,antialiasing:Di,canvasImageRendering:Fi,browser:this.browser,viewport:(mi=ci.viewport)!==null&&mi!==void 0?mi:ci.width&&ci.height?{width:ci.width,height:ci.height}:Resolution.SVGA,resolution:ci.resolution,displayMode:ki,pixelRatio:ci.suppressHiDPIScaling?1:(xi=ci.pixelRatio)!==null&&xi!==void 0?xi:null}),TextureLoader.filtering=Li,ci.backgroundColor&&(this.backgroundColor=ci.backgroundColor.clone()),this.maxFps=(yi=ci.maxFps)!==null&&yi!==void 0?yi:this.maxFps,this.fixedUpdateTimestep=(Ci=ci.fixedUpdateTimestep)!==null&&Ci!==void 0?Ci:this.fixedUpdateTimestep,this.fixedUpdateFps=(Ei=ci.fixedUpdateFps)!==null&&Ei!==void 0?Ei:this.fixedUpdateFps,this.fixedUpdateTimestep=this.fixedUpdateTimestep||1e3/this.fixedUpdateFps,this.clock=new StandardClock({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:$i=>this.onFatalException($i)}),this.enableCanvasTransparency=ci.enableCanvasTransparency,typeof ci.physics=="boolean"?this.physics={...getDefaultPhysicsConfig(),enabled:ci.physics}:(this.physics={...getDefaultPhysicsConfig()},mergeDeep(this.physics,ci.physics)),this.debug=new DebugConfig(this),this.director=new Director(this,ci.scenes),this._initialize(ci),window.___EXCALIBUR_DEVTOOL=this,Engine.InstanceCount++}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:ci}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:hi,showPlayerMessage:_i}=this._originalOptions.configurePerformanceCanvas2DFallback;if(hi===void 0&&(hi=Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),_i===void 0&&(_i=Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!Flags.isEnabled("use-canvas-context")&&ci&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===hi.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let pi=0;for(let mi=0;mi<this._fpsSamples.length;mi++)pi+=this._fpsSamples[mi];const gi=pi/this._fpsSamples.length;this._fpsSamples.length===hi.numberOfFrames&&gi<=hi.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),_i&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var ci,hi,_i;const pi=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(pi,this.canvas),this.canvas=pi;const gi={...this._originalOptions,antialiasing:this.screen.antialiasing},mi=this._originalDisplayMode;this.graphicsContext=new ExcaliburGraphicsContext2DCanvas({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:gi.antialiasing,backgroundColor:gi.backgroundColor,snapToPixel:gi.snapToPixel,useDrawSorting:gi.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Screen({canvas:this.canvas,context:this.graphicsContext,antialiasing:(ci=gi.antialiasing)!==null&&ci!==void 0?ci:!0,browser:this.browser,viewport:(hi=gi.viewport)!==null&&hi!==void 0?hi:gi.width&&gi.height?{width:gi.width,height:gi.height}:Resolution.SVGA,resolution:gi.resolution,displayMode:mi,pixelRatio:gi.suppressHiDPIScaling?1:(_i=gi.pixelRatio)!==null&&_i!==void 0?_i:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const xi=gi.pointerScope===PointerScope.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(xi,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this._garbageCollector.forceCollectAll(),this.input.toggleEnabled(!1),this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,Engine.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(ci){if(ci<0){Logger.getInstance().warnOnce("engine.timescale to a value less than 0 are ignored");return}this._timescale=ci}addTimer(ci){return this.currentScene.addTimer(ci)}removeTimer(ci){return this.currentScene.removeTimer(ci)}addScene(ci,hi){return this.director.add(ci,hi),this}removeScene(ci){this.director.remove(ci)}add(ci){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const hi=this.director.getDeferredScene();hi instanceof Scene?hi.add(ci):this.currentScene.add(ci)}remove(ci){ci instanceof Entity&&this.currentScene.remove(ci),(ci instanceof Scene||isSceneConstructor(ci))&&this.removeScene(ci),typeof ci=="string"&&this.removeScene(ci)}async goToScene(ci,hi){await this.scope(async()=>{await this.director.goToScene(ci,hi)})}screenToWorldCoordinates(ci){return this.screen.screenToWorldCoordinates(ci)}worldToScreenCoordinates(ci){return this.screen.worldToScreenCoordinates(ci)}_initialize(ci){var hi,_i;this.pageScrollPreventionMode=ci.scrollPreventionMode;const pi=ci&&ci.pointerScope===PointerScope.Document?document:this.canvas,gi=(_i=(hi=this._originalOptions)===null||hi===void 0?void 0:hi.grabWindowFocus)!==null&&_i!==void 0?_i:!0;this.input=new InputHost({pointerTarget:pi,grabWindowFocus:gi,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new HiddenEvent(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new VisibleEvent(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!ci.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(ci){this._inputEnabled=ci,this.input.toggleEnabled(this._inputEnabled)}onInitialize(ci){}get isInitialized(){return this._isInitialized}async _overrideInitialize(ci){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(ci),this.events.emit("initialize",new InitializeEvent(ci,this)),this._isInitialized=!0)}_update(ci){var hi;if(this._isLoading){(hi=this._loader)===null||hi===void 0||hi.onUpdate(this,ci),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(ci),this.currentScene.update(this,ci),this.graphicsContext.updatePostProcessors(ci),this.clock.__runScheduledCbs("postupdate"),this._postupdate(ci),this.input.update()}_preupdate(ci){this.emit("preupdate",new PreUpdateEvent(this,ci,this)),this.onPreUpdate(this,ci)}onPreUpdate(ci,hi){}_postupdate(ci){this.emit("postupdate",new PostUpdateEvent(this,ci,this)),this.onPostUpdate(this,ci)}onPostUpdate(ci,hi){}_draw(ci){var hi,_i;if(this.graphicsContext.backgroundColor=(hi=this.currentScene.backgroundColor)!==null&&hi!==void 0?hi:this.backgroundColor,this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,ci),this._isLoading){this._hideLoader||((_i=this._loader)===null||_i===void 0||_i.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.currentScene.draw(this.graphicsContext,ci),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,ci),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(ci,hi){this.emit("predraw",new PreDrawEvent(ci,hi,this)),this.onPreDraw(ci,hi)}onPreDraw(ci,hi){}_postdraw(ci,hi){this.emit("postdraw",new PostDrawEvent(ci,hi,this)),this.onPostDraw(ci,hi)}onPostDraw(ci,hi){}showDebug(ci){this._isDebug=ci}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(ci,hi){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let _i;return ci instanceof DefaultLoader?_i=ci:typeof ci=="string"&&(this.director.configureStart(ci,hi),_i=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this.garbageCollectorConfig&&this._garbageCollector.start(),this._logger.debug("Game clock started"),await this.load(_i??new Loader),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new GameStartEvent(this)),this._isReadyFuture.promise})}_mainloop(ci){this.scope(()=>{this.emit("preframe",new PreFrameEvent(this,this.stats.prevFrame));const hi=ci*this.timescale;this.currentFrameElapsedMs=hi;const _i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=_i,this.stats.currFrame.elapsedMs=hi,this.stats.currFrame.fps=this.clock.fpsSampler.fps,GraphicsDiagnostics.clear();const pi=this.clock.now(),gi=this.fixedUpdateTimestep;if(this.fixedUpdateTimestep)for(this._lagMs+=hi;this._lagMs>=gi;)this._update(gi),this._lagMs-=gi;else this._update(hi);const mi=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(hi);const xi=this.clock.now();this.stats.currFrame.duration.update=mi-pi,this.stats.currFrame.duration.draw=xi-mi,this.stats.currFrame.graphics.drawnImages=GraphicsDiagnostics.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=GraphicsDiagnostics.DrawCallCount,this.emit("postframe",new PostFrameEvent(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new GameStopEvent(this)),this.browser.pause(),this.clock.stop(),this._garbageCollector.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(ci=!1){return new Promise(_i=>{this._screenShotRequests.push({preserveHiDPIResolution:ci,resolve:_i})})}_checkForScreenShots(){for(const ci of this._screenShotRequests){const hi=ci.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,_i=ci.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,pi=document.createElement("canvas");pi.width=hi,pi.height=_i;const gi=pi.getContext("2d");gi.imageSmoothingEnabled=this.screen.antialiasing,gi.drawImage(this.canvas,0,0,hi,_i);const mi=new Image,xi=pi.toDataURL("image/png");mi.onload=()=>{ci.resolve(mi)},mi.src=xi}this._screenShotRequests.length=0}async load(ci,hi=!1){await this.scope(async()=>{try{if(ci.isLoaded())return;this._loader=ci,this._isLoading=!0,this._hideLoader=hi,ci instanceof Loader&&(ci.suppressPlayButton=ci.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await ci.load()}catch(_i){this._logger.error("Error loading resources, things may not behave properly",_i),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}}Engine.Context=createContext();Engine.InstanceCount=0;Engine._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,enableCanvasContextMenu:!1,snapToPixel:!1,antialiasing:!0,pixelArt:!1,garbageCollection:!0,powerPreference:"high-performance",pointerScope:PointerScope.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:ScrollPreventionMode.Canvas,backgroundColor:Color.fromHex("#2185d0")};class Label extends Actor{set maxWidth(ci){this._text.maxWidth=ci}get maxWidth(){return this._text.maxWidth}get font(){return this._font}set font(ci){this._font=ci,this._text.font=ci}get text(){return this._text.text}set text(ci){this._text.text=ci}get color(){return this._text.color}set color(ci){this._text&&(this._text.color=ci)}get opacity(){return this.graphics.opacity}set opacity(ci){this.graphics.opacity=ci}get spriteFont(){return this._spriteFont}set spriteFont(ci){ci&&(this._spriteFont=ci,this._text.font=this._spriteFont)}constructor(ci){super(ci),this._font=new Font,this._text=new Text({text:"",font:this._font});const{text:hi,pos:_i,x:pi,y:gi,spriteFont:mi,font:xi,color:yi,maxWidth:Ci}={text:"",...ci};this.pos=_i??(pi&&gi?vec(pi,gi):this.pos),this.text=hi??this.text,this.font=xi??this.font,this.maxWidth=Ci??this.maxWidth,this.spriteFont=mi??this.spriteFont,this._text.color=yi??this.color;const Ei=this.get(GraphicsComponent);Ei.anchor=Vector.Zero,Ei.use(this._text)}_initialize(ci){super._initialize(ci)}getTextWidth(){return this._text.width}}var EmitterType;(function(fi){fi.Circle="circle",fi.Rectangle="rectangle"})(EmitterType||(EmitterType={}));class ParticleEmitter extends Actor{constructor(ci){var hi,_i;super({width:(hi=ci.width)!==null&&hi!==void 0?hi:0,height:(_i=ci.height)!==null&&_i!==void 0?_i:0}),this._particlesToEmit=0,this._particlePool=new RentalPool(()=>new Particle({}),Ii=>Ii,500),this.numParticles=0,this.isEmitting=!0,this.deadParticles=[],this.emitRate=1,this.emitterType=EmitterType.Rectangle,this.radius=0,this.particle={life:2e3,transform:ParticleTransform.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this._activeParticles=[];const{particle:pi,x:gi,y:mi,z:xi,pos:yi,isEmitting:Ci,emitRate:Ei,emitterType:Ai,radius:ki,random:Pi}={...ci};this.particle={...this.particle,...pi},this.pos=yi??vec(gi??0,mi??0),this.z=xi??0,this.isEmitting=Ci??this.isEmitting,this.emitRate=Ei??this.emitRate,this.emitterType=Ai??this.emitterType,this.radius=ki??this.radius,this.body.collisionType=CollisionType.PreventCollision,this.random=Pi??new Random}removeParticle(ci){this.deadParticles.push(ci)}emitParticles(ci){var hi;if(!(ci<=0)){ci=ci|0;for(let _i=0;_i<ci;_i++){const pi=this._createParticle();!((hi=this===null||this===void 0?void 0:this.scene)===null||hi===void 0)&&hi.world&&(this.particle.transform===ParticleTransform.Global?this.scene.world.add(pi):this.addChild(pi)),this._activeParticles.push(pi)}}}clearParticles(){for(let ci=0;ci<this._activeParticles.length;ci++)this.removeParticle(this._activeParticles[ci])}_createParticle(){let ci=0,hi=0;const _i=randomInRange(this.particle.minAngle||0,this.particle.maxAngle||Math.PI*2,this.random),pi=randomInRange(this.particle.minSpeed||0,this.particle.maxSpeed||0,this.random),gi=this.particle.startSize||randomInRange(this.particle.minSize||5,this.particle.maxSize||5,this.random),mi=pi*Math.cos(_i),xi=pi*Math.sin(_i);if(this.emitterType===EmitterType.Rectangle)ci=randomInRange(0,this.width,this.random),hi=randomInRange(0,this.height,this.random);else if(this.emitterType===EmitterType.Circle){const Ci=randomInRange(0,this.radius,this.random);ci=Ci*Math.cos(_i),hi=Ci*Math.sin(_i)}const yi=this._particlePool.rent();return yi.configure({life:this.particle.life,opacity:this.particle.opacity,beginColor:this.particle.beginColor,endColor:this.particle.endColor,pos:vec(ci,hi),vel:vec(mi,xi),acc:this.particle.acc,angularVelocity:this.particle.angularVelocity,startSize:this.particle.startSize,endSize:this.particle.endSize,size:gi,graphic:this.particle.graphic,fade:this.particle.fade}),yi.registerEmitter(this),this.particle.randomRotation&&(yi.transform.rotation=randomInRange(0,Math.PI*2,this.random)),this.particle.focus&&(yi.focus=this.particle.focus.add(vec(this.pos.x,this.pos.y)),yi.focusAccel=this.particle.focusAccel),yi}update(ci,hi){var _i;super.update(ci,hi),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(hi/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let pi=0;pi<this.deadParticles.length;pi++){!((_i=this===null||this===void 0?void 0:this.scene)===null||_i===void 0)&&_i.world&&(this.scene.world.remove(this.deadParticles[pi],!1),this._particlePool.return(this.deadParticles[pi]));const gi=this._activeParticles.indexOf(this.deadParticles[pi]);gi>-1&&this._activeParticles.splice(gi,1)}this.deadParticles.length=0}}function assert(fi,ci){}class GpuParticleRenderer{constructor(ci,hi,_i){var pi;this.emitRate=1,this._initialized=!1,this._vaos=[],this._buffers=[],this._drawIndex=0,this._numInputFloats=7,this._particleIndex=0,this._uploadIndex=0,this._wrappedLife=0,this._wrappedParticles=0,this._particleLife=0,this._clearRequested=!1,this._emitted=[],this.emitter=ci,this.particle=_i,this._particleData=new Float32Array(this.emitter.maxParticles*this._numInputFloats),this._random=hi,this._particleLife=(pi=this.particle.life)!==null&&pi!==void 0?pi:2e3}get isInitialized(){return this._initialized}get maxParticles(){return this.emitter.maxParticles}initialize(ci,hi){if(this._initialized)return;const _i=this.emitter.maxParticles,pi=this._numInputFloats,gi=this._particleData,mi=4,xi=ci.createBuffer(),yi=ci.createVertexArray();ci.bindVertexArray(yi),ci.bindBuffer(ci.ARRAY_BUFFER,xi),ci.bufferData(ci.ARRAY_BUFFER,_i*pi*mi,ci.DYNAMIC_DRAW),ci.bufferSubData(ci.ARRAY_BUFFER,0,gi);let Ci=0;ci.vertexAttribPointer(0,2,ci.FLOAT,!1,pi*mi,0),Ci+=mi*2,ci.vertexAttribPointer(1,2,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*2,ci.vertexAttribPointer(2,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.vertexAttribPointer(3,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.vertexAttribPointer(4,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.enableVertexAttribArray(0),ci.enableVertexAttribArray(1),ci.enableVertexAttribArray(2),ci.enableVertexAttribArray(3),ci.enableVertexAttribArray(4),this._vaos.push(yi),this._buffers.push(xi),ci.bindVertexArray(null),ci.bindBuffer(ci.ARRAY_BUFFER,null);const Ei=ci.createBuffer(),Ai=ci.createVertexArray();ci.bindVertexArray(Ai),ci.bindBuffer(ci.ARRAY_BUFFER,Ei),ci.bufferData(ci.ARRAY_BUFFER,_i*pi*mi,ci.DYNAMIC_DRAW),Ci=0,ci.vertexAttribPointer(0,2,ci.FLOAT,!1,pi*mi,0),Ci+=mi*2,ci.vertexAttribPointer(1,2,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*2,ci.vertexAttribPointer(2,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.vertexAttribPointer(3,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.vertexAttribPointer(4,1,ci.FLOAT,!1,pi*mi,Ci),Ci+=mi*1,ci.enableVertexAttribArray(0),ci.enableVertexAttribArray(1),ci.enableVertexAttribArray(2),ci.enableVertexAttribArray(3),ci.enableVertexAttribArray(4),this._vaos.push(Ai),this._buffers.push(Ei),ci.bindVertexArray(null),ci.bindBuffer(ci.ARRAY_BUFFER,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._initialized=!0}clearParticles(){this._particleData.fill(0),this._clearRequested=!0}emitParticles(ci){const hi=this._particleIndex,_i=this.maxParticles*this._numInputFloats,pi=ci*this._numInputFloats+hi;for(let gi=hi;gi<pi;gi+=this._numInputFloats){const mi=this._random.floating(this.particle.minAngle||0,this.particle.maxAngle||TwoPI),xi=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),yi=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),Ci=xi*Math.cos(mi),Ei=yi*Math.sin(mi);let Ai=0,ki=0;if(this.emitter.emitterType===EmitterType.Rectangle)Ai=this._random.floating(-.5,.5)*this.emitter.width,ki=this._random.floating(-.5,.5)*this.emitter.height;else{const Di=this._random.floating(0,this.emitter.radius);Ai=Di*Math.cos(mi),ki=Di*Math.sin(mi)}const Pi=this.emitter.transform.apply(vec(Ai,ki)),Ii=[this.particle.transform===ParticleTransform.Local?Ai:Pi.x,this.particle.transform===ParticleTransform.Local?ki:Pi.y,Ci,Ei,this.particle.randomRotation?randomInRange(0,TwoPI,this._random):this.particle.rotation||0,this.particle.angularVelocity||0,this._particleLife];this._particleData.set(Ii,gi%this._particleData.length)}pi>=_i?(this._wrappedParticles+=(pi-_i)/this._numInputFloats,this._wrappedLife=this._particleLife):this._wrappedLife>0&&(this._wrappedParticles+=ci),this._particleIndex=pi%_i,this._emitted.push([this._particleLife,hi])}_uploadEmitted(ci){this._particleIndex!==this._uploadIndex&&(ci.bindBuffer(ci.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),this._particleIndex>=this._uploadIndex?ci.bufferSubData(ci.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleIndex-this._uploadIndex):(ci.bufferSubData(ci.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleData.length-this._uploadIndex),this._wrappedParticles&&ci.bufferSubData(ci.ARRAY_BUFFER,0,this._particleData,0,this._wrappedParticles*this._numInputFloats),this._wrappedLife=this._particleLife),ci.bindBuffer(ci.ARRAY_BUFFER,null)),this._uploadIndex=this._particleIndex%(this.maxParticles*this._numInputFloats)}update(ci){var hi;if(this._particleLife=(hi=this.particle.life)!==null&&hi!==void 0?hi:this._particleLife,this._wrappedLife>0?this._wrappedLife-=ci:(this._wrappedLife=0,this._wrappedParticles=0),!!this._emitted.length){for(let _i=this._emitted.length-1;_i>=0;_i--){const pi=this._emitted[_i];pi[0]-=ci,pi[0]<=0&&this._emitted.splice(_i,1)}this._emitted.sort((_i,pi)=>_i[0]-pi[0])}}draw(ci){if(this._initialized){if(this._clearRequested?(ci.bindBuffer(ci.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),ci.bufferSubData(ci.ARRAY_BUFFER,0,this._particleData),ci.bindBuffer(ci.ARRAY_BUFFER,null),this._clearRequested=!1):this._uploadEmitted(ci),ci.bindVertexArray(this._currentVao),ci.bindBufferBase(ci.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer),this._wrappedLife&&this._emitted[0]&&this._emitted[0][1]>0){const hi=this._emitted[0][1]/this._numInputFloats;ci.bindBufferRange(ci.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,this._emitted[0][1]*4,(this.maxParticles-hi)*this._numInputFloats*4),ci.beginTransformFeedback(ci.POINTS),ci.drawArrays(ci.POINTS,hi,this.maxParticles-hi),ci.endTransformFeedback(),ci.bindBufferRange(ci.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._emitted[0][1]*4),ci.beginTransformFeedback(ci.POINTS),ci.drawArrays(ci.POINTS,0,hi),ci.endTransformFeedback()}else ci.bindBufferRange(ci.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._particleData.length*4),ci.beginTransformFeedback(ci.POINTS),ci.drawArrays(ci.POINTS,0,this.maxParticles),ci.endTransformFeedback();ci.bindVertexArray(null),ci.bindBufferBase(ci.TRANSFORM_FEEDBACK_BUFFER,0,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._drawIndex=(this._drawIndex+1)%2}}}GpuParticleRenderer.GPU_MAX_PARTICLES=1e5;class GpuParticleEmitter extends Actor{get pos(){return this.transform.pos}set pos(ci){this.transform.pos=ci}get z(){return this.transform.z}set z(ci){this.transform.z=ci}constructor(ci){super({name:"GpuParticleEmitter",width:ci.width,height:ci.height}),this.particle={life:2e3,transform:ParticleTransform.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this.graphics=new GraphicsComponent,this.isEmitting=!1,this.emitRate=1,this.emitterType=EmitterType.Rectangle,this.radius=0,this.maxParticles=2e3,this._particlesToEmit=0,this.addComponent(this.graphics,!0),this.graphics.onPostDraw=this.draw.bind(this);const{particle:hi,maxParticles:_i,x:pi,y:gi,z:mi,pos:xi,isEmitting:yi,emitRate:Ci,emitterType:Ei,radius:Ai,random:ki}={...ci};this.maxParticles=clamp(_i??this.maxParticles,0,GpuParticleRenderer.GPU_MAX_PARTICLES),this.pos=xi??vec(pi??0,gi??0),this.z=mi??0,this.isEmitting=yi??this.isEmitting,this.emitRate=Ci??this.emitRate,this.emitterType=Ei??this.emitterType,this.radius=Ai??this.radius,this.particle={...this.particle,...hi},this.random=ki??new Random,this.renderer=new GpuParticleRenderer(this,this.random,this.particle)}_initialize(ci){super._initialize(ci);const hi=ci.graphicsContext;this.renderer.initialize(hi.__gl,hi)}update(ci,hi){super.update(ci,hi),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(hi/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.renderer.update(hi)}emitParticles(ci){ci<=0||this.renderer.emitParticles(ci|0)}clearParticles(){this.renderer.clearParticles()}draw(ci,hi){ci.draw("ex.particle",this.renderer,hi)}}class IsometricTile extends Entity{getGraphics(){return this._graphics}addGraphic(ci,hi){this._graphics.push(ci),this._gfx.isVisible=this.map.isVisible,this._gfx.opacity=this.map.opacity,hi!=null&&hi.offset&&(this._gfx.offset=hi.offset),this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let ci=this._tileBounds.clone();for(const hi of this._graphics){const _i=vec(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:hi.height-this.map.tileHeight));ci=ci.combine(hi.localBounds.translate(_i))}return ci}removeGraphic(ci){const hi=this._graphics.indexOf(ci);hi>-1&&this._graphics.splice(hi,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.isVisible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(ci){this._colliders.push(ci),this.map.flagCollidersDirty()}removeCollider(ci){const hi=this._colliders.indexOf(ci);hi>-1&&this._colliders.splice(hi,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(vec(this.x,this.y))}get center(){return this.pos.add(vec(0,this.map.tileHeight/2))}constructor(ci,hi,_i,pi){super([new TransformComponent,new GraphicsComponent({offset:_i??Vector.Zero,onPostDraw:(ki,Pi)=>this.draw(ki,Pi)}),new IsometricEntityComponent(pi)]),this.solid=!1,this.events=new EventEmitter,this._tileBounds=new BoundingBox,this._graphics=[],this._colliders=[],this.data=new Map,this.x=ci,this.y=hi,this.map=pi,this._transform=this.get(TransformComponent),this._isometricEntityComponent=this.get(IsometricEntityComponent);const gi=this.map.tileWidth/2,mi=this.map.tileHeight/2,xi=(this.x-this.y)*gi,yi=(this.x+this.y)*mi;this._transform.pos=vec(xi,yi),this._isometricEntityComponent.elevation=pi.elevation,this._gfx=this.get(GraphicsComponent),this._gfx.isVisible=!1;const Ci=this.map.tileWidth,Ei=this.map.tileHeight,Ai=vec(0,this.map.renderFromTopOfGraphic?Ei:0);this._gfx.localBounds=this._tileBounds=new BoundingBox({left:-Ci/2,top:-Ei,right:Ci/2,bottom:Ei}).translate(Ai)}draw(ci,hi){const _i=this.map.tileWidth/2;ci.save(),ci.translate(-_i,0);for(const pi of this._graphics)pi.draw(ci,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:pi.height-this.map.tileHeight));ci.restore()}}class IsometricMap extends Entity{get visible(){return this.isVisible}set visible(ci){this.isVisible=ci}constructor(ci){super([new TransformComponent,new BodyComponent({type:CollisionType.Fixed}),new ColliderComponent,new PointerComponent,new DebugGraphicsComponent((Ei,Ai)=>this.debug(Ei,Ai),!1)],ci.name),this.elevation=0,this.isVisible=!0,this.opacity=1,this.renderFromTopOfGraphic=!1,this.graphicsOffset=vec(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:hi,tileWidth:_i,tileHeight:pi,columns:gi,rows:mi,renderFromTopOfGraphic:xi,graphicsOffset:yi,elevation:Ci}=ci;this.transform=this.get(TransformComponent),hi&&(this.transform.pos=hi),this.collider=this.get(ColliderComponent),this.collider&&this.collider.set(this._composite=new CompositeCollider([])),this.pointer=this.get(PointerComponent),this.renderFromTopOfGraphic=xi??this.renderFromTopOfGraphic,this.graphicsOffset=yi??this.graphicsOffset,this.elevation=Ci??this.elevation,this.tileWidth=_i,this.tileHeight=pi,this.columns=gi,this.rows=mi,this._pointerEventDispatcher=new PointerEventsToObjectDispatcher,this.tiles=new Array(gi*mi);for(let Ei=0;Ei<mi;Ei++)for(let Ai=0;Ai<gi;Ai++){const ki=new IsometricTile(Ai,Ei,this.graphicsOffset,this);this.tiles[Ai+Ei*gi]=ki,this.addChild(ki),this._pointerEventDispatcher.addObject(ki,Pi=>this.getTileByPoint(Pi.worldPos)===ki,()=>!0)}this.pointer.localBounds=BoundingBox.fromDimension(_i*gi*this.transform.scale.x,pi*mi*this.transform.scale.y,vec(.5,0))}_processPointerToObject(ci){this._pointerEventDispatcher.processPointerToObject(ci,this.tiles)}_dispatchPointerEvents(ci){this._pointerEventDispatcher.dispatchEvents(ci,this.tiles)}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1),this._pointerEventDispatcher.clear()}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(ci){var hi;if(this._originalOffsets.has(ci))return(hi=this._originalOffsets.get(ci))!==null&&hi!==void 0?hi:Vector.Zero;{const _i=ci.offset;return this._originalOffsets.set(ci,_i),_i}}updateColliders(){this._composite.clearColliders();const ci=this.get(TransformComponent).pos;for(const hi of this.tiles)if(hi.solid)for(const _i of hi.getColliders()){const pi=this._getOrSetColliderOriginalOffset(_i);_i.offset=this.tileToWorld(vec(hi.x,hi.y)).sub(ci).add(pi).sub(vec(this.tileWidth/2,this.tileHeight)),_i.owner=this,this._composite.addCollider(_i)}this.collider.update()}worldToTile(ci){ci=ci.sub(this.transform.globalPos);const hi=this.tileWidth/2,_i=this.tileHeight/2;return vec(~~((ci.x/hi+ci.y/_i)/2),~~((ci.y/_i-ci.x/hi)/2))}tileToWorld(ci){const hi=this.tileWidth/2,_i=this.tileHeight/2,pi=(ci.x-ci.y)*hi,gi=(ci.x+ci.y)*_i;return vec(pi,gi).add(this.transform.pos)}getTile(ci,hi){return ci<0||hi<0||ci>=this.columns||hi>=this.rows?null:this.tiles[ci+hi*this.columns]}getTileByPoint(ci){const hi=this.worldToTile(ci);return this.getTile(hi.x,hi.y)}_getMaxZIndex(){let ci=Number.NEGATIVE_INFINITY;for(const hi of this.tiles){const _i=hi.get(TransformComponent).z;_i>ci&&(ci=_i)}return ci}debug(ci,hi){const{showAll:_i,showPosition:pi,positionColor:gi,positionSize:mi,showGrid:xi,gridColor:yi,gridWidth:Ci,showColliderGeometry:Ei}=hi.isometric,{geometryColor:Ai,geometryLineWidth:ki,geometryPointSize:Pi}=hi.collider;if(ci.save(),ci.z=this._getMaxZIndex()+.5,_i||xi){for(let Ii=0;Ii<this.rows+1;Ii++){const Di=this.tileToWorld(vec(0,Ii)),Fi=this.tileToWorld(vec(this.columns,Ii));ci.drawLine(Di,Fi,yi,Ci)}for(let Ii=0;Ii<this.columns+1;Ii++){const Di=this.tileToWorld(vec(Ii,0)),Fi=this.tileToWorld(vec(Ii,this.rows));ci.drawLine(Di,Fi,yi,Ci)}}if(_i||pi)for(const Ii of this.tiles)ci.drawCircle(this.tileToWorld(vec(Ii.x,Ii.y)),mi,gi);if(_i||Ei){for(const Ii of this.tiles)if(Ii.solid)for(const Di of Ii.getColliders())Di.debug(ci,Ai,{lineWidth:ki,pointSize:Pi})}ci.restore()}}class ActionSequence{constructor(ci,hi){this.id=nextActionId(),this._stopped=!1,this._sequenceBuilder=hi,this._sequenceContext=new ActionContext(ci),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(ci){this._actionQueue.update(ci)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(ci){return new ActionSequence(ci,this._sequenceBuilder)}}class ParallelActions{constructor(ci){this.id=nextActionId(),this._actions=ci}update(ci){for(let hi=0;hi<this._actions.length;hi++)this._actions[hi].update(ci)}isComplete(ci){return this._actions.every(hi=>hi.isComplete(ci))}reset(){this._actions.forEach(ci=>ci.reset())}stop(){this._actions.forEach(ci=>ci.stop())}}class QuadTree{constructor(ci,hi){this.bounds=ci,this.options=hi,this._defaultOptions={maxDepth:10,capacity:10,level:0},this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null,this.options={...this._defaultOptions,...hi},this.halfWidth=ci.width/2,this.halfHeight=ci.height/2}_split(){this._isDivided=!0;const ci={maxDepth:this.options.maxDepth,capacity:this.options.capacity,level:this.options.level+1};this.topLeft=new QuadTree(new BoundingBox({left:this.bounds.left,top:this.bounds.top,right:this.bounds.left+this.halfWidth,bottom:this.bounds.top+this.halfHeight}),ci),this.topRight=new QuadTree(new BoundingBox({left:this.bounds.left+this.halfWidth,top:this.bounds.top,right:this.bounds.right,bottom:this.bounds.top+this.halfHeight}),ci),this.bottomLeft=new QuadTree(new BoundingBox({left:this.bounds.left,top:this.bounds.top+this.halfHeight,right:this.bounds.left+this.halfWidth,bottom:this.bounds.bottom}),ci),this.bottomRight=new QuadTree(new BoundingBox({left:this.bounds.left+this.halfWidth,top:this.bounds.top+this.halfHeight,right:this.bounds.right,bottom:this.bounds.bottom}),ci)}_insertIntoSubNodes(ci){var hi,_i,pi,gi;!((hi=this.topLeft)===null||hi===void 0)&&hi.bounds.overlaps(ci.bounds)&&this.topLeft.insert(ci),!((_i=this.topRight)===null||_i===void 0)&&_i.bounds.overlaps(ci.bounds)&&this.topRight.insert(ci),!((pi=this.bottomLeft)===null||pi===void 0)&&pi.bounds.overlaps(ci.bounds)&&this.bottomLeft.insert(ci),!((gi=this.bottomRight)===null||gi===void 0)&&gi.bounds.overlaps(ci.bounds)&&this.bottomRight.insert(ci)}insert(ci){if(this._isDivided){this._insertIntoSubNodes(ci);return}if(this.items.push(ci),this.items.length>this.options.capacity&&this.options.level<this.options.maxDepth){this._isDivided||this._split();for(const hi of this.items)this._insertIntoSubNodes(hi);this.items.length=0}}remove(ci){var hi,_i,pi,gi;if(this.bounds.overlaps(ci.bounds)){if(!this._isDivided){const mi=this.items.indexOf(ci);mi>-1&&this.items.splice(mi,1);return}!((hi=this.topLeft)===null||hi===void 0)&&hi.bounds.overlaps(ci.bounds)&&this.topLeft.remove(ci),!((_i=this.topRight)===null||_i===void 0)&&_i.bounds.overlaps(ci.bounds)&&this.topRight.remove(ci),!((pi=this.bottomLeft)===null||pi===void 0)&&pi.bounds.overlaps(ci.bounds)&&this.bottomLeft.remove(ci),!((gi=this.bottomRight)===null||gi===void 0)&&gi.bounds.overlaps(ci.bounds)&&this.bottomRight.remove(ci)}}query(ci){let hi=this.items;return this._isDivided&&(this.topLeft.bounds.overlaps(ci)&&(hi=hi.concat(this.topLeft.query(ci))),this.topRight.bounds.overlaps(ci)&&(hi=hi.concat(this.topRight.query(ci))),this.bottomLeft.bounds.overlaps(ci)&&(hi=hi.concat(this.bottomLeft.query(ci))),this.bottomRight.bounds.overlaps(ci)&&(hi=hi.concat(this.bottomRight.query(ci)))),hi=hi.filter((_i,pi)=>hi.indexOf(_i)>=pi),hi}clear(){this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}getAllItems(){let ci=this.items;return this._isDivided&&(ci=ci.concat(this.topLeft.getAllItems()),ci=ci.concat(this.topRight.getAllItems()),ci=ci.concat(this.bottomLeft.getAllItems()),ci=ci.concat(this.bottomRight.getAllItems())),ci=ci.filter((hi,_i)=>ci.indexOf(hi)>=_i),ci}getTreeDepth(){return this._isDivided?1+Math.max(this.topLeft.getTreeDepth(),this.topRight.getTreeDepth(),this.bottomLeft.getTreeDepth(),this.bottomRight.getTreeDepth()):0}debug(ci){this.bounds.draw(ci,Color.Yellow),this._isDivided&&(this.topLeft.bounds.draw(ci,Color.Yellow),this.topRight.bounds.draw(ci,Color.Yellow),this.bottomLeft.bounds.draw(ci,Color.Yellow),this.bottomRight.bounds.draw(ci,Color.Yellow))}}function has_initialize(fi){return!!fi._initialize}function has_add(fi){return!!fi.onAdd}function has_remove(fi){return!!fi.onRemove}function hasOnInitialize(fi){return!!fi.onInitialize}function has_preupdate(fi){return!!fi._preupdate}function hasOnPreUpdate(fi){return!!fi.onPreUpdate}function has_postupdate(fi){return!!fi.onPostUpdate}function hasOnPostUpdate(fi){return!!fi.onPostUpdate}function hasOnAdd(fi){return!!fi.onAdd}function hasOnRemove(fi){return!!fi.onRemove}function hasPreDraw(fi){return!!fi.onPreDraw}function hasPostDraw(fi){return!!fi.onPostDraw}class Gif{constructor(ci,hi=!1){this.path=ci,this.width=0,this.height=0,this._images=[],this.data=[],this._sprites=[],this._resource=new Resource(ci,"arraybuffer",hi)}get bustCache(){return this._resource.bustCache}set bustCache(ci){this._resource.bustCache=ci}async load(){const ci=await this._resource.load();this._stream=new Stream$1(ci),this._gif=new GifParser(this._stream);const hi=this._gif.images.map(_i=>new ImageSource(_i.src,!1));return await Promise.all(hi.map(_i=>_i.load())),this.data=this._images=hi,this._sprites=this._images.map(_i=>_i.toSprite()),this.data}isLoaded(){return!!this.data}toSprite(ci=0){var hi;return(hi=this._sprites[ci])!==null&&hi!==void 0?hi:null}toSpriteSheet(){const ci=this._sprites;return ci.length?new SpriteSheet({sprites:ci}):null}toAnimation(ci){var hi;const _i=(hi=this._gif)===null||hi===void 0?void 0:hi.images;if(_i!=null&&_i.length){const pi=_i.map((gi,mi)=>{var xi;return{graphic:this._sprites[mi],duration:((xi=this._gif)===null||xi===void 0?void 0:xi.frames[mi].delayMs)||void 0}});return this._animation=new Animation({frames:pi,frameDuration:ci}),this._animation}return null}get readCheckBytes(){var ci,hi;return(hi=(ci=this._gif)===null||ci===void 0?void 0:ci.checkBytes)!==null&&hi!==void 0?hi:[]}}const bitsToNum=fi=>fi.reduce(function(ci,hi){return ci*2+hi},0),byteToBitArr=fi=>{const ci=[];for(let hi=7;hi>=0;hi--)ci.push(!!(fi&1<<hi));return ci};let Stream$1=class{constructor(ci){if(this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=hi=>{const _i=[];for(let pi=0;pi<hi;pi++)_i.push(this.readByte());return _i},this.read=hi=>{let _i="";for(let pi=0;pi<hi;pi++)_i+=String.fromCharCode(this.readByte());return _i},this.readUnsigned=()=>{const hi=this.readBytes(2);return(hi[1]<<8)+hi[0]},this.data=new Uint8Array(ci),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}};const lzwDecode=function(fi,ci){let hi=0;const _i=function(ki){let Pi=0;for(let Ii=0;Ii<ki;Ii++)ci.charCodeAt(hi>>3)&1<<(hi&7)&&(Pi|=1<<Ii),hi++;return Pi},pi=[],gi=1<<fi,mi=gi+1;let xi=fi+1,yi=[];const Ci=function(){yi=[],xi=fi+1;for(let ki=0;ki<gi;ki++)yi[ki]=[ki];yi[gi]=[],yi[mi]=null};let Ei=0,Ai=0;for(;;){if(Ai=Ei,Ei=_i(xi),Ei===gi){Ci();continue}if(Ei===mi)break;if(Ei<yi.length)Ai!==gi&&yi.push(yi[Ai].concat(yi[Ei][0]));else{if(Ei!==yi.length)throw new Error("Invalid LZW code.");yi.push(yi[Ai].concat(yi[Ai][0]))}pi.push.apply(pi,yi[Ei]),yi.length===1<<xi&&xi<12&&xi++}return pi};class GifParser{constructor(ci){this._handler={},this.frames=[],this.images=[],this.globalColorTableBytes=[],this.checkBytes=[],this.parseColorTableBytes=hi=>{const _i=[];for(let pi=0;pi<hi;pi++){const gi=this._st.readBytes(3);_i.push(gi)}return _i},this.readSubBlocks=()=>{let hi,_i;_i="";do hi=this._st.readByte(),_i+=this._st.read(hi);while(hi!==0);return _i},this.parseHeader=()=>{const hi={sig:"",ver:"",width:0,height:0,colorResolution:0,globalColorTableSize:0,gctFlag:!1,sortedFlag:!1,globalColorTable:[],backgroundColorIndex:0,pixelAspectRatio:0};if(hi.sig=this._st.read(3),hi.ver=this._st.read(3),hi.sig!=="GIF")throw new Error("Not a GIF file.");hi.width=this._st.readUnsigned(),hi.height=this._st.readUnsigned(),this._currentFrameCanvas.width=hi.width,this._currentFrameCanvas.height=hi.height;const _i=byteToBitArr(this._st.readByte());hi.gctFlag=_i.shift(),hi.colorResolution=bitsToNum(_i.splice(0,3)),hi.sortedFlag=_i.shift(),hi.globalColorTableSize=bitsToNum(_i.splice(0,3)),hi.backgroundColorIndex=this._st.readByte(),hi.pixelAspectRatio=this._st.readByte(),hi.gctFlag&&(this.globalColorTableBytes=this.parseColorTableBytes(1<<hi.globalColorTableSize+1)),this._handler.hdr&&this._handler.hdr(hi)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=hi=>{const _i=yi=>{this.checkBytes.push(this._st.readByte());const Ci=byteToBitArr(this._st.readByte());return yi.reserved=Ci.splice(0,3),yi.disposalMethod=bitsToNum(Ci.splice(0,3)),yi.userInputFlag=Ci.shift(),yi.transparentColorFlag=Ci.shift(),yi.delayTime=this._st.readUnsigned(),yi.transparentColorIndex=this._st.readByte(),yi.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(yi)&&this.checkBytes.push(this._handler.gce),yi},pi=yi=>{yi.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(yi)&&this.checkBytes.push(this._handler.com)},gi=yi=>{this.checkBytes.push(this._st.readByte()),yi.ptHeader=this._st.readBytes(12),yi.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(yi)&&this.checkBytes.push(this._handler.pte)},mi=yi=>{const Ci=Ai=>{this.checkBytes.push(this._st.readByte()),Ai.unknown=this._st.readByte(),Ai.iterations=this._st.readUnsigned(),Ai.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(Ai)&&this.checkBytes.push(this._handler.app)},Ei=Ai=>{Ai.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[Ai.identifier]&&this._handler.app[Ai.identifier](Ai)&&this.checkBytes.push(this._handler.app[Ai.identifier])};switch(this.checkBytes.push(this._st.readByte()),yi.identifier=this._st.read(8),yi.authCode=this._st.read(3),yi.identifier){case"NETSCAPE":Ci(yi);break;default:Ei(yi);break}},xi=yi=>{yi.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(yi)&&this.checkBytes.push(this._handler.unknown)};switch(hi.label=this._st.readByte(),hi.label){case 249:hi.extType="gce",this._gce=_i(hi);break;case 254:hi.extType="com",pi(hi);break;case 1:hi.extType="pte",gi(hi);break;case 255:hi.extType="app",mi(hi);break;default:hi.extType="unknown",xi(hi);break}},this.parseImg=hi=>{var _i;const pi=(xi,yi)=>{const Ci=new Array(xi.length),Ei=xi.length/yi,Ai=(Di,Fi)=>{const Li=xi.slice(Fi*yi,(Fi+1)*yi);Ci.splice.apply(Ci,[Di*yi,yi].concat(Li))},ki=[0,4,2,1],Pi=[8,8,4,2];let Ii=0;for(let Di=0;Di<4;Di++)for(let Fi=ki[Di];Fi<Ei;Fi+=Pi[Di])Ai(Fi,Ii),Ii++;return Ci};hi.leftPos=this._st.readUnsigned(),hi.topPos=this._st.readUnsigned(),hi.width=this._st.readUnsigned(),hi.height=this._st.readUnsigned();const gi=byteToBitArr(this._st.readByte());hi.lctFlag=gi.shift(),hi.interlaced=gi.shift(),hi.sorted=gi.shift(),hi.reserved=gi.splice(0,2),hi.lctSize=bitsToNum(gi.splice(0,3)),hi.lctFlag&&(hi.lctBytes=this.parseColorTableBytes(1<<hi.lctSize+1)),hi.lzwMinCodeSize=this._st.readByte();const mi=this.readSubBlocks();hi.pixels=lzwDecode(hi.lzwMinCodeSize,mi),hi.interlaced&&(hi.pixels=pi(hi.pixels,hi.width)),!((_i=this._gce)===null||_i===void 0)&&_i.delayTime&&(hi.delayMs=this._gce.delayTime*10),this.frames.push(hi),this.arrayToImage(hi,hi.lctFlag?hi.lctBytes:this.globalColorTableBytes),this._handler.img&&this._handler.img(hi)&&this.checkBytes.push(this._handler)},this.parseBlocks=()=>{const hi={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(hi.sentinel)){case"!":hi.type="ext",this.parseExt(hi);break;case",":hi.type="img",this.parseImg(hi);break;case";":hi.type="eof",this._handler.eof&&this._handler.eof(hi)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+hi.sentinel.toString(16))}hi.type!=="eof"&&this.parseBlocks()},this.arrayToImage=(hi,_i)=>{var pi,gi,mi,xi;const yi=document.createElement("canvas");yi.width=hi.width,yi.height=hi.height;const Ci=yi.getContext("2d"),Ei=Ci.getImageData(0,0,yi.width,yi.height);let Ai=-1;!((pi=this._gce)===null||pi===void 0)&&pi.transparentColorFlag&&(Ai=this._gce.transparentColorIndex);for(let Pi=0;Pi<hi.pixels.length;Pi++){const Ii=hi.pixels[Pi],Di=_i[Ii];Ii===Ai?Ei.data.set([0,0,0,0],Pi*4):Ei.data.set([...Di,255],Pi*4)}if(Ci.putImageData(Ei,0,0),((gi=this._gce)===null||gi===void 0?void 0:gi.disposalMethod)===1&&this.images.length)this._currentFrameContext.drawImage(this.images[this.images.length-1],0,0);else if(((mi=this._gce)===null||mi===void 0?void 0:mi.disposalMethod)===2&&(!((xi=this._hdr)===null||xi===void 0)&&xi.gctFlag)){const Pi=_i[this._hdr.backgroundColorIndex];this._currentFrameContext.fillStyle=`rgb(${Pi[0]}, ${Pi[1]}, ${Pi[2]})`,this._currentFrameContext.fillRect(0,0,this._hdr.width,this._hdr.height)}else this._currentFrameContext.clearRect(0,0,this._currentFrameCanvas.width,this._currentFrameCanvas.height);this._currentFrameContext.drawImage(yi,hi.leftPos,hi.topPos,hi.width,hi.height);const ki=new Image;ki.src=this._currentFrameCanvas.toDataURL(),this.images.push(ki)},this._st=ci,this._handler={},this._currentFrameCanvas=document.createElement("canvas"),this._currentFrameContext=this._currentFrameCanvas.getContext("2d"),this.parseHeader(),this.parseBlocks()}}class FontSource{constructor(ci,hi,{bustCache:_i,...pi}={}){this.path=ci,this.family=hi,this._isLoaded=!1,this._resource=new Resource(ci,"blob",_i),this._options=pi}async load(){if(this.isLoaded())return this.data;try{const ci=await this._resource.load(),hi=URL.createObjectURL(ci);this.data||(this.data=new FontFace(this.family,`url(${hi})`),document.fonts.add(this.data)),await this.data.load(),this._isLoaded=!0}catch(ci){throw`Error loading FontSource from path '${this.path}' with error [${ci.message}]`}return this.data}isLoaded(){return this._isLoaded}toFont(ci){return new Font({family:this.family,...this._options,...ci})}}const InsideCoroutineContext=createContext(),generatorFunctionDeclaration=/^\s*(?:function)?\*/;function isCoroutineGenerator(fi){return typeof fi!="function"?!1:generatorFunctionDeclaration.test(Function.prototype.toString.call(fi))?!0:Object.getPrototypeOf?Object.getPrototypeOf(fi)===Object.getPrototypeOf(new Function("return function * () {}")()):!1}function coroutine(...fi){var ci;const hi=Logger.getInstance();let _i,pi,gi,mi;isCoroutineGenerator(fi[0])&&(pi=globalThis,_i=fi[0],gi=fi[1]),isCoroutineGenerator(fi[1])&&(pi=fi[0],_i=fi[1],gi=fi[2]),fi[1]instanceof Engine&&(pi=fi[0],mi=fi[1],_i=fi[2],gi=fi[3]),fi[0]instanceof Engine&&(pi=globalThis,mi=fi[0],_i=fi[1],gi=fi[2]);const xi=useContext(InsideCoroutineContext),yi=gi==null?void 0:gi.timing,Ci=xi?!1:(ci=gi==null?void 0:gi.autostart)!==null&&ci!==void 0?ci:!0;let Ei;try{Ei=mi??Engine.useEngine()}catch{throw Error(`Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.
Pass an engine parameter to ex.coroutine(engine, function * {...})`)}let Ai=!1,ki=!1,Pi=!1;const Ii=_i.bind(pi),Di=Ii();let Fi;const Li=new Promise((Ri,$i)=>{Fi=Ni=>{try{if(Pi){ki=!0,Ri();return}const{done:ji,value:Ui}=InsideCoroutineContext.scope(!0,()=>Di.next(Ni));if(ji||Pi){ki=!0,Ri();return}Ui instanceof Promise?Ui.then(()=>{Ei.clock.schedule(Fi,0,yi)}):Ui===void 0||Ui===void 0?Ei.clock.schedule(Fi,0,yi):Ei.clock.schedule(Fi,Ui||0,yi)}catch(ji){$i(ji);return}},Ci&&(Ai=!0,Fi(Ei.clock.elapsed()))}),Bi={isRunning:()=>Ai&&!Pi&&!ki,isComplete:()=>ki,cancel:()=>{Pi=!0},start:()=>(Ai?hi.warn(`.start() was called on a coroutine that was already started, this is probably a bug:
`,Function.prototype.toString.call(Ii)):(Ai=!0,Fi(Ei.clock.elapsed())),Bi),generator:Di,done:Li,then:Li.then.bind(Li),[Symbol.iterator]:()=>Di};return Bi}class Transition extends Entity{get progress(){return this._currentProgress}get complete(){return this.direction==="out"?this.progress>=1:this.progress<=0}constructor(ci){var hi,_i,pi,gi;super(),this._logger=Logger.getInstance(),this.transform=new TransformComponent,this.graphics=new GraphicsComponent,this._completeFuture=new Future,this.started=!1,this._currentDistance=0,this._currentProgress=0,this.done=this._completeFuture.promise,this.name=`Transition#${this.id}`,this.duration=ci.duration,this.easing=(hi=ci.easing)!==null&&hi!==void 0?hi:EasingFunctions.Linear,this.direction=(_i=ci.direction)!==null&&_i!==void 0?_i:"out",this.hideLoader=(pi=ci.hideLoader)!==null&&pi!==void 0?pi:!1,this.blockInput=(gi=ci.blockInput)!==null&&gi!==void 0?gi:!1,this.transform.coordPlane=CoordPlane.Screen,this.transform.pos=Vector.Zero,this.transform.z=1/0,this.graphics.anchor=Vector.Zero,this.addComponent(this.transform),this.addComponent(this.graphics),this.direction==="out"?this._currentProgress=0:this._currentProgress=1}updateTransition(ci,hi){this.complete||(this._currentDistance+=clamp(hi/this.duration,0,1),this._currentDistance>=1&&(this._currentDistance=1),this.direction==="out"?this._currentProgress=clamp(this.easing(this._currentDistance,0,1,1),0,1):this._currentProgress=clamp(this.easing(this._currentDistance,1,0,1),0,1))}async onPreviousSceneDeactivate(ci){}onStart(ci){}onUpdate(ci){}onEnd(ci){}onReset(){}reset(){this.started=!1,this._completeFuture=new Future,this.done=this._completeFuture.promise,this._currentDistance=0,this.direction==="out"?this._currentProgress=0:this._currentProgress=1,this.onReset()}_addToTargetScene(ci,hi){const _i=hi;if(this.started&&this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`),_i.world.entityManager.getById(this.id))return this._co;this._engine=ci,_i.add(this);const pi=this;return this._co=coroutine(ci,function*(){for(;!pi.complete;){const gi=yield;pi.updateTransition(pi._engine,gi),pi._execute()}},{autostart:!1}),this._co}async _play(){this.started&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`)),(!this._engine||!this._co)&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`)),this._co&&await this._co.start()}_execute(){this.isInitialized&&(this.started||(this.started=!0,this.onStart(this.progress)),this.onUpdate(this.progress),this.complete&&!this._completeFuture.isCompleted&&(this.onEnd(this.progress),this._completeFuture.resolve()))}}class FadeInOut extends Transition{constructor(ci){var hi,_i;super({...ci,duration:(hi=ci.duration)!==null&&hi!==void 0?hi:2e3}),this.name=`FadeInOut#${this.id}`,this.color=(_i=ci.color)!==null&&_i!==void 0?_i:Color.Black}onInitialize(ci){this.transform.pos=ci.screen.unsafeArea.topLeft,this.screenCover=new Rectangle({width:ci.screen.resolution.width,height:ci.screen.resolution.height,color:this.color}),this.graphics.add(this.screenCover),this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onStart(ci){this.graphics.opacity=ci}onEnd(ci){this.graphics.opacity=ci}onUpdate(ci){this.graphics.opacity=ci}}class CrossFade extends Transition{constructor(ci){super({direction:"in",...ci}),this.name=`CrossFade#${this.id}`}async onPreviousSceneDeactivate(ci){this.image=await ci.engine.screenshot(!0),await this.image.decode()}onInitialize(ci){this.engine=ci,this.transform.pos=ci.screen.unsafeArea.topLeft,this.screenCover=ImageSource.fromHtmlImageElement(this.image).toSprite(),this.graphics.add(this.screenCover),this.transform.scale=vec(1/ci.screen.pixelRatio,1/ci.screen.pixelRatio),this.graphics.opacity=this.progress}onStart(ci){this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onEnd(ci){this.graphics.opacity=ci}onUpdate(ci){this.graphics.opacity=ci}}class Slide extends Transition{constructor(ci){var hi;super({direction:"in",...ci}),this._easing=EasingFunctions.Linear,this.name=`Slide#${this.id}`,this.slideDirection=ci.slideDirection,this.transform.coordPlane=CoordPlane.World,this.graphics.forceOnScreen=!0,this._easing=(hi=ci.easingFunction)!==null&&hi!==void 0?hi:this._easing,this._vectorEasing=EasingFunctions.CreateVectorEasingFunction(this._easing)}async onPreviousSceneDeactivate(ci){this._image=await ci.engine.screenshot(!0),await this._image.decode(),this._screenCover=ImageSource.fromHtmlImageElement(this._image).toSprite()}onInitialize(ci){switch(this._engine=ci,this.slideDirection){case"up":{this._directionOffset=vec(0,-ci.screen.resolution.height);break}case"down":{this._directionOffset=vec(0,ci.screen.resolution.height);break}case"left":{this._directionOffset=vec(-ci.screen.resolution.width,0);break}case"right":{this._directionOffset=vec(ci.screen.resolution.width,0);break}}this._camera=this._engine.currentScene.camera,this._destinationCameraPosition=this._camera.pos.clone(),this._camera.pos=this._camera.pos.add(this._directionOffset),this.transform.pos=this.transform.pos.add(this._directionOffset),this._startCameraPosition=this._camera.pos.clone(),this.graphics.use(this._screenCover),this.transform.scale=vec(1/ci.screen.pixelRatio,1/ci.screen.pixelRatio)}onUpdate(ci){this._camera.pos=this._vectorEasing(ci,this._destinationCameraPosition,this._startCameraPosition,1)}}class Line extends Graphic{constructor(ci){super(),this.color=Color.Black,this.thickness=1;const{start:hi,end:_i,color:pi,thickness:gi}=ci;this.start=hi,this.end=_i,this.color=pi??this.color,this.thickness=gi??this.thickness,this._localBounds=this._calculateBounds();const{width:mi,height:xi}=this._localBounds;this.width=mi,this.height=xi}get localBounds(){return this._localBounds}_calculateBounds(){const ci=this.end.sub(this.start).normal(),hi=this.thickness/2,_i=[this.start.add(ci.scale(hi)),this.end.add(ci.scale(hi)),this.end.add(ci.scale(-hi)),this.start.add(ci.scale(-hi))];return BoundingBox.fromPoints(_i)}_drawImage(ci,hi,_i){ci.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new Line({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class Polygon extends Raster{get points(){return this._points}set points(ci){this._points=ci;const hi=this.minPoint;this.width=this._points.reduce((_i,pi)=>Math.max(pi.x,_i),0)-hi.x,this.height=this._points.reduce((_i,pi)=>Math.max(pi.y,_i),0)-hi.y,this.flagDirty()}get minPoint(){const ci=this._points.reduce((_i,pi)=>Math.min(pi.x,_i),1/0),hi=this._points.reduce((_i,pi)=>Math.min(pi.y,_i),1/0);return vec(ci,hi)}constructor(ci){super(ci),this._points=[],this.points=ci.points,this.filtering=ImageFiltering.Blended,this.rasterize()}clone(){return new Polygon({points:this.points.map(ci=>ci.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(ci){if(this.points&&this.points.length){ci.beginPath();const hi=this.minPoint.negate(),_i=this.points[0].add(hi);ci.moveTo(_i.x,_i.y),this.points.forEach(pi=>{ci.lineTo(pi.x+hi.x,pi.y+hi.y)}),ci.lineTo(_i.x,_i.y),ci.closePath(),this.color&&ci.fill(),this.strokeColor&&ci.stroke()}}}var NineSliceStretch;(function(fi){fi.Stretch="stretch",fi.Tile="tile",fi.TileFit="tile-fit"})(NineSliceStretch||(NineSliceStretch={}));class NineSlice extends Graphic{constructor(ci){super(ci),this._logger=Logger.getInstance(),this._config=ci,this._imgSource=ci.source,this._canvasA=document.createElement("canvas"),this._canvasB=document.createElement("canvas"),this._canvasC=document.createElement("canvas"),this._canvasD=document.createElement("canvas"),this._canvasE=document.createElement("canvas"),this._canvasF=document.createElement("canvas"),this._canvasG=document.createElement("canvas"),this._canvasH=document.createElement("canvas"),this._canvasI=document.createElement("canvas"),this._initialize(),this._imgSource.ready.then(()=>{this._initialize()})}setTargetWidth(ci,hi=!1){this._config.width=ci,hi&&this._initialize()}setTargetHeight(ci,hi=!1){this._config.height=ci,hi&&this._initialize()}setMargins(ci,hi,_i,pi,gi=!1){this._config.sourceConfig.leftMargin=ci,this._config.sourceConfig.topMargin=hi,this._config.sourceConfig.rightMargin=_i,this._config.sourceConfig.bottomMargin=pi,gi&&this._initialize()}setStretch(ci,hi,_i=!1){ci==="horizontal"?this._config.destinationConfig.horizontalStretch=hi:ci==="vertical"?this._config.destinationConfig.verticalStretch=hi:(this._config.destinationConfig.horizontalStretch=hi,this._config.destinationConfig.verticalStretch=hi),_i&&this._initialize()}getConfig(){return this._config}_drawTile(ci,hi,_i,pi,gi,mi,xi){const yi=mi||0,Ci=xi||0;let Ei,Ai,ki,Pi;const Ii=this._getNumberOfTiles(hi.width,_i.x,pi),Di=this._getNumberOfTiles(hi.height,_i.y,gi);for(let Fi=0;Fi<Ii;Fi++)for(let Li=0;Li<Di;Li++){let{tempSize:Bi,tempPosition:Ri}=this._calculateParams(Fi,Ii,hi.width,_i.x,this._config.destinationConfig.horizontalStretch);Ei=Bi,Ai=Ri,{tempSize:Bi,tempPosition:Ri}=this._calculateParams(Li,Di,hi.height,_i.y,this._config.destinationConfig.verticalStretch),ki=Bi,Pi=Ri,ci.drawImage(hi,0,0,hi.width,hi.height,yi+Ai,Ci+Pi,Ei,ki)}}_drawImage(ci,hi,_i){this._imgSource.isLoaded()?(this._drawTile(ci,this._canvasA,new Vector(this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch),this._drawTile(ci,this._canvasB,new Vector(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,0),this._drawTile(ci,this._canvasC,new Vector(this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,0),this._drawTile(ci,this._canvasD,new Vector(this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.sourceConfig.topMargin),this._config.destinationConfig.drawCenter&&this._drawTile(ci,this._canvasE,new Vector(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._drawTile(ci,this._canvasF,new Vector(this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._drawTile(ci,this._canvasG,new Vector(this._config.sourceConfig.leftMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(ci,this._canvasH,new Vector(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(ci,this._canvasI,new Vector(this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin)):this._logger.warnOnce(`NineSlice ImageSource ${this._imgSource.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}_initialize(){this._sourceSprite=this._imgSource.image,this._canvasA.width=this._config.sourceConfig.leftMargin,this._canvasA.height=this._config.sourceConfig.topMargin;const ci=this._canvasA.getContext("2d");ci==null||ci.drawImage(this._sourceSprite,0,0,this._canvasA.width,this._canvasA.height,0,0,this._canvasA.width,this._canvasA.height),this._canvasB.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasB.height=this._config.sourceConfig.topMargin;const hi=this._canvasB.getContext("2d");hi==null||hi.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,0,this._canvasB.width,this._canvasB.height,0,0,this._canvasB.width,this._canvasB.height),this._canvasC.width=this._config.sourceConfig.rightMargin,this._canvasC.height=this._config.sourceConfig.topMargin;const _i=this._canvasC.getContext("2d");_i==null||_i.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,0,this._canvasC.width,this._canvasC.height,0,0,this._canvasC.width,this._canvasC.height),this._canvasD.width=this._config.sourceConfig.leftMargin,this._canvasD.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const pi=this._canvasD.getContext("2d");pi==null||pi.drawImage(this._sourceSprite,0,this._config.sourceConfig.topMargin,this._canvasD.width,this._canvasD.height,0,0,this._canvasD.width,this._canvasD.height),this._canvasE.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasE.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const gi=this._canvasE.getContext("2d");gi==null||gi.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin,this._canvasE.width,this._canvasE.height,0,0,this._canvasE.width,this._canvasE.height),this._canvasF.width=this._config.sourceConfig.rightMargin,this._canvasF.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const mi=this._canvasF.getContext("2d");mi==null||mi.drawImage(this._sourceSprite,this._config.sourceConfig.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin,this._canvasF.width,this._canvasF.height,0,0,this._canvasF.width,this._canvasF.height),this._canvasG.width=this._config.sourceConfig.leftMargin,this._canvasG.height=this._config.sourceConfig.bottomMargin;const xi=this._canvasG.getContext("2d");xi==null||xi.drawImage(this._sourceSprite,0,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasG.width,this._canvasG.height,0,0,this._canvasG.width,this._canvasG.height),this._canvasH.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasH.height=this._config.sourceConfig.bottomMargin;const yi=this._canvasH.getContext("2d");yi==null||yi.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasH.width,this._canvasH.height,0,0,this._canvasH.width,this._canvasH.height),this._canvasI.width=this._config.sourceConfig.rightMargin,this._canvasI.height=this._config.sourceConfig.bottomMargin;const Ci=this._canvasI.getContext("2d");Ci==null||Ci.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasI.width,this._canvasI.height,0,0,this._canvasI.width,this._canvasI.height)}clone(){return new NineSlice(this._config)}_getNumberOfTiles(ci,hi,_i){switch(_i){case NineSliceStretch.Stretch:return 1;case NineSliceStretch.Tile:return Math.ceil(hi/ci);case NineSliceStretch.TileFit:return Math.ceil(hi/ci)}}_calculateParams(ci,hi,_i,pi,gi){switch(gi){case NineSliceStretch.Stretch:return{tempPosition:0,tempSize:pi};case NineSliceStretch.Tile:return ci===hi-1?{tempPosition:ci*_i,tempSize:_i-(hi*_i-pi)}:{tempPosition:ci*_i,tempSize:_i};case NineSliceStretch.TileFit:const mi=pi/hi;return{tempPosition:ci*mi,tempSize:mi}}}}class TiledAnimation extends Animation{constructor(ci){super({...ci,frames:ci.animation.frames.slice(),strategy:ci.animation.strategy,frameDuration:ci.animation.frameDuration,speed:ci.animation.speed,reverse:ci.animation.isReversed}),this._ready=new Future,this.ready=this._ready.promise,this._tiledWidth=0,this._tiledHeight=0,this._sourceView={},this._sourceView={...ci.sourceView},this._tiledWidth=ci.width,this._tiledHeight=ci.height;const hi=[];for(let _i=0;_i<this.frames.length;_i++){const pi=this.frames[_i].graphic;if(pi&&pi instanceof Sprite){const gi=new TiledSprite({image:pi.image,width:ci.width,height:ci.height,sourceView:{...pi.sourceView},wrapping:ci.wrapping,filtering:ci.filtering});this.frames[_i].graphic=gi,gi.ready.then(()=>{gi.sourceView={...gi.sourceView,...this._sourceView}}),hi.push(gi.ready)}}Promise.all(hi).then(()=>this._ready.resolve())}static fromAnimation(ci,hi){return new TiledAnimation({width:ci.width,height:ci.height,...hi,animation:ci})}_updateSourceView(){for(let ci=0;ci<this.frames.length;ci++){const hi=this.frames[ci].graphic;hi&&hi instanceof Sprite&&(hi.sourceView={...hi.sourceView,...this._sourceView})}}get sourceView(){return watch(this._sourceView,()=>this._updateSourceView())}set sourceView(ci){this._sourceView=watch(ci,()=>this._updateSourceView()),this._updateSourceView()}_updateWidthHeight(){for(let ci=0;ci<this.frames.length;ci++){const hi=this.frames[ci].graphic;hi&&hi instanceof Sprite&&(hi.sourceView.height=this._tiledHeight||hi.height,hi.destSize.height=this._tiledHeight||hi.height,hi.sourceView.width=this._tiledWidth||hi.width,hi.destSize.width=this._tiledWidth||hi.width)}}get width(){return this._tiledWidth}get height(){return this._tiledHeight}set width(ci){this._tiledWidth=ci,this._updateWidthHeight()}set height(ci){this._tiledHeight=ci,this._updateWidthHeight()}}const maxMessages=5,obsoleteMessage={},resetObsoleteCounter=()=>{for(const fi in obsoleteMessage)obsoleteMessage[fi]=0},logMessage=(fi,ci)=>{const hi=Flags.isEnabled("suppress-obsolete-message");obsoleteMessage[fi]<maxMessages&&!hi&&(Logger.getInstance().warn(fi),console.trace&&ci.showStackTrace&&console.trace()),obsoleteMessage[fi]++};function obsolete(fi){return fi={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...fi},function(ci,hi,_i){if(_i&&!(typeof _i.value=="function"||typeof _i.get=="function"||typeof _i.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const gi=`${`${ci.name||""}${ci.name&&hi?".":""}${hi||""}`} is marked obsolete: ${fi.message}`+(fi.alternateMethod?` Use ${fi.alternateMethod} instead`:"");obsoleteMessage[gi]||(obsoleteMessage[gi]=0);const mi=_i?{..._i}:ci;if(!_i){class xi extends mi{constructor(...Ci){logMessage(gi,fi),super(...Ci)}}return xi}return _i&&_i.value?(mi.value=function(){return logMessage(gi,fi),_i.value.apply(this,arguments)},mi):(_i&&_i.get&&(mi.get=function(){return logMessage(gi,fi),_i.get.apply(this,arguments)}),_i&&_i.set&&(mi.set=function(){return logMessage(gi,fi),_i.set.apply(this,arguments)}),mi)}}class AsyncWaitQueue{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const ci=new Future;return this._queue.push(ci),ci.promise}dequeue(ci){this._queue.shift().resolve(ci)}}class Semaphore{constructor(ci){this._count=ci,this._waitQueue=new AsyncWaitQueue}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(ci=1){if(ci!==0){for(;ci!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),ci--;this._count+=ci}}}const EX_VERSION="0.30.3";polyfill();var __webpack_exports__ActionCompleteEvent=__webpack_exports__.eKr,__webpack_exports__ActionContext=__webpack_exports__.yVm,__webpack_exports__ActionQueue=__webpack_exports__.a7j,__webpack_exports__ActionSequence=__webpack_exports__.U_w,__webpack_exports__ActionStartEvent=__webpack_exports__.JF2,__webpack_exports__ActionsComponent=__webpack_exports__.htg,__webpack_exports__ActionsSystem=__webpack_exports__.HXL,__webpack_exports__ActivateEvent=__webpack_exports__.mcg,__webpack_exports__Actor=__webpack_exports__.Agj,__webpack_exports__ActorEvents=__webpack_exports__.J3_,__webpack_exports__AddEvent=__webpack_exports__.Wgv,__webpack_exports__AddedComponent=__webpack_exports__.u6S,__webpack_exports__AffineMatrix=__webpack_exports__.x7M,__webpack_exports__Animation=__webpack_exports__.X55,__webpack_exports__AnimationDirection=__webpack_exports__.m3M,__webpack_exports__AnimationEvents=__webpack_exports__.aE5,__webpack_exports__AnimationStrategy=__webpack_exports__.YJU,__webpack_exports__ArcadeSolver=__webpack_exports__.eZi,__webpack_exports__AudioContextFactory=__webpack_exports__.GNv,__webpack_exports__Axes=__webpack_exports__.Y56,__webpack_exports__Axis=__webpack_exports__._0v,__webpack_exports__BaseAlign=__webpack_exports__.vhs,__webpack_exports__BezierCurve=__webpack_exports__.vrQ,__webpack_exports__Blink=__webpack_exports__.Z8b,__webpack_exports__BodyComponent=__webpack_exports__.Yfw,__webpack_exports__BoundingBox=__webpack_exports__.IcQ,__webpack_exports__BrowserComponent=__webpack_exports__.kgJ,__webpack_exports__BrowserEvents=__webpack_exports__.GTT,__webpack_exports__Buttons=__webpack_exports__.ypY,__webpack_exports__Camera=__webpack_exports__.i7d,__webpack_exports__CameraEvents=__webpack_exports__.fQ3,__webpack_exports__Canvas=__webpack_exports__.HlI,__webpack_exports__Circle=__webpack_exports__.jlt,__webpack_exports__CircleCollider=__webpack_exports__.VQc,__webpack_exports__Clock=__webpack_exports__.zD7,__webpack_exports__ClosestLineJumpTable=__webpack_exports__.AUF,__webpack_exports__Collider=__webpack_exports__.JoF,__webpack_exports__ColliderComponent=__webpack_exports__.MlA,__webpack_exports__CollisionContact=__webpack_exports__.PZh,__webpack_exports__CollisionEndEvent=__webpack_exports__.qA,__webpack_exports__CollisionGroup=__webpack_exports__.CrD,__webpack_exports__CollisionGroupManager=__webpack_exports__.dQK,__webpack_exports__CollisionJumpTable=__webpack_exports__.D3r,__webpack_exports__CollisionPostSolveEvent=__webpack_exports__.Qpo,__webpack_exports__CollisionPreSolveEvent=__webpack_exports__.D9n,__webpack_exports__CollisionStartEvent=__webpack_exports__.b6v,__webpack_exports__CollisionSystem=__webpack_exports__.mvh,__webpack_exports__CollisionType=__webpack_exports__.Bpo,__webpack_exports__Color=__webpack_exports__.Q1f,__webpack_exports__ColorBlindFlags=__webpack_exports__.IKv,__webpack_exports__ColorBlindnessMode=__webpack_exports__.fcV,__webpack_exports__ColorBlindnessPostProcessor=__webpack_exports__.Glf,__webpack_exports__Component=__webpack_exports__.uAl,__webpack_exports__CompositeCollider=__webpack_exports__.ElT,__webpack_exports__ConsoleAppender=__webpack_exports__.Z8r,__webpack_exports__ContactConstraintPoint=__webpack_exports__.QSL,__webpack_exports__ContactEndEvent=__webpack_exports__.sPV,__webpack_exports__ContactSolveBias=__webpack_exports__.nAn,__webpack_exports__ContactStartEvent=__webpack_exports__.zCU,__webpack_exports__CoordPlane=__webpack_exports__.QrV,__webpack_exports__CrossFade=__webpack_exports__.fF9,__webpack_exports__CurveBy=__webpack_exports__.Jqv,__webpack_exports__CurveTo=__webpack_exports__.d_u,__webpack_exports__DeactivateEvent=__webpack_exports__.xI8,__webpack_exports__Debug=__webpack_exports__.yar,__webpack_exports__DebugConfig=__webpack_exports__.SP7,__webpack_exports__DebugGraphicsComponent=__webpack_exports__.oRy,__webpack_exports__DebugSystem=__webpack_exports__.f5X,__webpack_exports__DebugText=__webpack_exports__.V1c,__webpack_exports__DefaultAntialiasOptions=__webpack_exports__.Mlx,__webpack_exports__DefaultGarbageCollectionOptions=__webpack_exports__.ZiM,__webpack_exports__DefaultLoader=__webpack_exports__.ZCo,__webpack_exports__DefaultPixelArtOptions=__webpack_exports__.J5p,__webpack_exports__DegreeOfFreedom=__webpack_exports__.mL_,__webpack_exports__Delay=__webpack_exports__.Guw,__webpack_exports__Detector=__webpack_exports__.N5j,__webpack_exports__Die=__webpack_exports__.pgY,__webpack_exports__Direction=__webpack_exports__.OP3,__webpack_exports__Director=__webpack_exports__.rl5,__webpack_exports__DirectorEvents=__webpack_exports__.eod,__webpack_exports__DisplayMode=__webpack_exports__.q5Z,__webpack_exports__DynamicTree=__webpack_exports__.YUC,__webpack_exports__DynamicTreeCollisionProcessor=__webpack_exports__.saR,__webpack_exports__EX_VERSION=__webpack_exports__.hvr,__webpack_exports__EaseBy=__webpack_exports__.Qol,__webpack_exports__EaseTo=__webpack_exports__.Wf4,__webpack_exports__EasingFunctions=__webpack_exports__.JCs,__webpack_exports__EdgeCollider=__webpack_exports__.gJV,__webpack_exports__ElasticToActorStrategy=__webpack_exports__.fWD,__webpack_exports__EmitterType=__webpack_exports__.Va_,__webpack_exports__Engine=__webpack_exports__.N$8,__webpack_exports__EngineEvents=__webpack_exports__._jQ,__webpack_exports__EnterTriggerEvent=__webpack_exports__.rxj,__webpack_exports__EnterViewPortEvent=__webpack_exports__.rhv,__webpack_exports__Entity=__webpack_exports__.wCu,__webpack_exports__EntityEvents=__webpack_exports__.HAp,__webpack_exports__EntityManager=__webpack_exports__.Zy1,__webpack_exports__EventEmitter=__webpack_exports__.bkB,__webpack_exports__EventTypes=__webpack_exports__.wfL,__webpack_exports__Events=__webpack_exports__.sVA,__webpack_exports__ExResponse=__webpack_exports__.$Gs,__webpack_exports__ExcaliburGraphicsContext2DCanvas=__webpack_exports__.CJ0,__webpack_exports__ExcaliburGraphicsContextWebGL=__webpack_exports__.NWh,__webpack_exports__ExitTriggerEvent=__webpack_exports__.tWi,__webpack_exports__ExitViewPortEvent=__webpack_exports__.xAj,__webpack_exports__Fade=__webpack_exports__.zWh,__webpack_exports__FadeInOut=__webpack_exports__.i_4,__webpack_exports__Flags=__webpack_exports__.iIx,__webpack_exports__Flash=__webpack_exports__.Hxo,__webpack_exports__Follow=__webpack_exports__.c9e,__webpack_exports__Font=__webpack_exports__.KQV,__webpack_exports__FontCache=__webpack_exports__.weH,__webpack_exports__FontSource=__webpack_exports__.jXp,__webpack_exports__FontStyle=__webpack_exports__.zzY,__webpack_exports__FontUnit=__webpack_exports__.yRQ,__webpack_exports__FpsSampler=__webpack_exports__.MtE,__webpack_exports__FrameStats=__webpack_exports__.rPj,__webpack_exports__Future=__webpack_exports__.KLc,__webpack_exports__GameEvent=__webpack_exports__.Fir,__webpack_exports__GameStartEvent=__webpack_exports__.V5f,__webpack_exports__GameStopEvent=__webpack_exports__.Xj7,__webpack_exports__Gamepad=__webpack_exports__.Wud,__webpack_exports__GamepadAxisEvent=__webpack_exports__.FVg,__webpack_exports__GamepadButtonEvent=__webpack_exports__.g5Y,__webpack_exports__GamepadConnectEvent=__webpack_exports__.YQB,__webpack_exports__GamepadDisconnectEvent=__webpack_exports__.KPb,__webpack_exports__Gamepads=__webpack_exports__.nHK,__webpack_exports__GarbageCollector=__webpack_exports__.Jrb,__webpack_exports__Gif=__webpack_exports__.TX_,__webpack_exports__GifParser=__webpack_exports__.Olt,__webpack_exports__GlobalCoordinates=__webpack_exports__.r3n,__webpack_exports__GpuParticleEmitter=__webpack_exports__.Fvk,__webpack_exports__GpuParticleRenderer=__webpack_exports__.gpR,__webpack_exports__Graphic=__webpack_exports__.vYh,__webpack_exports__GraphicsComponent=__webpack_exports__.hnk,__webpack_exports__GraphicsGroup=__webpack_exports__.D2R,__webpack_exports__GraphicsSystem=__webpack_exports__.n1o,__webpack_exports__HashColliderProxy=__webpack_exports__.h9O,__webpack_exports__HashGridCell=__webpack_exports__.X5j,__webpack_exports__HashGridProxy=__webpack_exports__.p3P,__webpack_exports__HiddenEvent=__webpack_exports__.RLG,__webpack_exports__HorizontalFirst=__webpack_exports__.fBU,__webpack_exports__ImageFiltering=__webpack_exports__.Adb,__webpack_exports__ImageSource=__webpack_exports__.bEs,__webpack_exports__ImageSourceAttributeConstants=__webpack_exports__.wCy,__webpack_exports__ImageWrapping=__webpack_exports__.CbD,__webpack_exports__InitializeEvent=__webpack_exports__.x_C,__webpack_exports__InputHost=__webpack_exports__.pGf,__webpack_exports__InputMapper=__webpack_exports__.ibQ,__webpack_exports__IsometricEntityComponent=__webpack_exports__.shR,__webpack_exports__IsometricEntitySystem=__webpack_exports__.Yjk,__webpack_exports__IsometricMap=__webpack_exports__._u1,__webpack_exports__IsometricTile=__webpack_exports__.OBI,__webpack_exports__KeyEvent=__webpack_exports__.klh,__webpack_exports__Keyboard=__webpack_exports__.s3S,__webpack_exports__Keys=__webpack_exports__.D$R,__webpack_exports__KillEvent=__webpack_exports__.xth,__webpack_exports__Label=__webpack_exports__.JU7,__webpack_exports__LimitCameraBoundsStrategy=__webpack_exports__.h9x,__webpack_exports__Line=__webpack_exports__.N1A,__webpack_exports__LineSegment=__webpack_exports__.e_k,__webpack_exports__Loader=__webpack_exports__.aHM,__webpack_exports__LoaderEvents=__webpack_exports__.tlv,__webpack_exports__LockCameraToActorAxisStrategy=__webpack_exports__.Vi9,__webpack_exports__LockCameraToActorStrategy=__webpack_exports__.ieR,__webpack_exports__LogLevel=__webpack_exports__.$bb,__webpack_exports__Logger=__webpack_exports__.VyI,__webpack_exports__Material=__webpack_exports__.imn,__webpack_exports__Matrix=__webpack_exports__.uqu,__webpack_exports__MatrixLocations=__webpack_exports__.QnL,__webpack_exports__MediaEvent=__webpack_exports__.vnc,__webpack_exports__Meet=__webpack_exports__.wk_,__webpack_exports__MotionComponent=__webpack_exports__.GH0,__webpack_exports__MotionSystem=__webpack_exports__._1r,__webpack_exports__MoveBy=__webpack_exports__.l0X,__webpack_exports__MoveByWithOptions=__webpack_exports__.bT,__webpack_exports__MoveTo=__webpack_exports__.HHX,__webpack_exports__MoveToWithOptions=__webpack_exports__.jtW,__webpack_exports__NativePointerButton=__webpack_exports__.tjk,__webpack_exports__NativeSoundEvent=__webpack_exports__.rWe,__webpack_exports__NativeSoundProcessedEvent=__webpack_exports__.j9l,__webpack_exports__NineSlice=__webpack_exports__.l0$,__webpack_exports__NineSliceStretch=__webpack_exports__.sGJ,__webpack_exports__None=__webpack_exports__.NVp,__webpack_exports__Observable=__webpack_exports__.cPK,__webpack_exports__OffscreenSystem=__webpack_exports__.XoL,__webpack_exports__Pair=__webpack_exports__.RmF,__webpack_exports__ParallaxComponent=__webpack_exports__.DXI,__webpack_exports__ParallelActions=__webpack_exports__.tCD,__webpack_exports__Particle=__webpack_exports__.J3D,__webpack_exports__ParticleEmitter=__webpack_exports__.vCJ,__webpack_exports__ParticleRenderer=__webpack_exports__.e6k,__webpack_exports__ParticleTransform=__webpack_exports__.f9l,__webpack_exports__PhysicsStats=__webpack_exports__.v9m,__webpack_exports__PhysicsWorld=__webpack_exports__.yRJ,__webpack_exports__PointerAbstraction=__webpack_exports__.EU6,__webpack_exports__PointerButton=__webpack_exports__.m3O,__webpack_exports__PointerComponent=__webpack_exports__.Ryz,__webpack_exports__PointerEvent=__webpack_exports__.OxP,__webpack_exports__PointerEventReceiver=__webpack_exports__.LEs,__webpack_exports__PointerScope=__webpack_exports__.Ec,__webpack_exports__PointerSystem=__webpack_exports__.Pi5,__webpack_exports__PointerType=__webpack_exports__.gmH,__webpack_exports__Polygon=__webpack_exports__.tS,__webpack_exports__PolygonCollider=__webpack_exports__.XxX,__webpack_exports__Pool=__webpack_exports__.bCz,__webpack_exports__PostCollisionEvent=__webpack_exports__.nYS,__webpack_exports__PostDebugDrawEvent=__webpack_exports__.yiT,__webpack_exports__PostDrawEvent=__webpack_exports__.NHl,__webpack_exports__PostFrameEvent=__webpack_exports__.mO8,__webpack_exports__PostKillEvent=__webpack_exports__.PXI,__webpack_exports__PostTransformDrawEvent=__webpack_exports__.bn5,__webpack_exports__PostUpdateEvent=__webpack_exports__.Ywr,__webpack_exports__PreCollisionEvent=__webpack_exports__.cMd,__webpack_exports__PreDebugDrawEvent=__webpack_exports__.Bs6,__webpack_exports__PreDrawEvent=__webpack_exports__.G0k,__webpack_exports__PreFrameEvent=__webpack_exports__.pyn,__webpack_exports__PreKillEvent=__webpack_exports__.QeM,__webpack_exports__PreLoadEvent=__webpack_exports__.aPX,__webpack_exports__PreTransformDrawEvent=__webpack_exports__.ITP,__webpack_exports__PreUpdateEvent=__webpack_exports__.BY0,__webpack_exports__Projection=__webpack_exports__.MFw,__webpack_exports__QuadIndexBuffer=__webpack_exports__.sBn,__webpack_exports__QuadTree=__webpack_exports__.S3L,__webpack_exports__Query=__webpack_exports__.XKQ,__webpack_exports__QueryManager=__webpack_exports__.ESI,__webpack_exports__RadiusAroundActorStrategy=__webpack_exports__.uxz,__webpack_exports__Random=__webpack_exports__.o8N,__webpack_exports__Raster=__webpack_exports__.u_r,__webpack_exports__Ray=__webpack_exports__.RlV,__webpack_exports__RealisticSolver=__webpack_exports__.gVA,__webpack_exports__Rectangle=__webpack_exports__.M_G,__webpack_exports__RemoveEvent=__webpack_exports__.BpG,__webpack_exports__RemovedComponent=__webpack_exports__.GRB,__webpack_exports__Repeat=__webpack_exports__.kM6,__webpack_exports__RepeatForever=__webpack_exports__.dO8,__webpack_exports__Resolution=__webpack_exports__.jgM,__webpack_exports__Resource=__webpack_exports__.FWq,__webpack_exports__ResourceEvents=__webpack_exports__.s3j,__webpack_exports__RotateBy=__webpack_exports__.hlw,__webpack_exports__RotateByWithOptions=__webpack_exports__.L0q,__webpack_exports__RotateTo=__webpack_exports__.B7e,__webpack_exports__RotateToWithOptions=__webpack_exports__.PGN,__webpack_exports__RotationType=__webpack_exports__.H_X,__webpack_exports__ScaleBy=__webpack_exports__.S_d,__webpack_exports__ScaleByWithOptions=__webpack_exports__._Tq,__webpack_exports__ScaleTo=__webpack_exports__.U7E,__webpack_exports__ScaleToWithOptions=__webpack_exports__.IOH,__webpack_exports__Scene=__webpack_exports__.Z58,__webpack_exports__SceneEvents=__webpack_exports__.yh2,__webpack_exports__Screen=__webpack_exports__.ff$,__webpack_exports__ScreenAppender=__webpack_exports__.cWi,__webpack_exports__ScreenElement=__webpack_exports__.NBt,__webpack_exports__ScreenEvents=__webpack_exports__.oNz,__webpack_exports__ScreenShader=__webpack_exports__.QlU,__webpack_exports__ScrollPreventionMode=__webpack_exports__.Xey,__webpack_exports__Semaphore=__webpack_exports__.jft,__webpack_exports__SeparatingAxis=__webpack_exports__._r8,__webpack_exports__SeparationInfo=__webpack_exports__.bTC,__webpack_exports__Shader=__webpack_exports__.Mtr,__webpack_exports__Shape=__webpack_exports__.ypk,__webpack_exports__Side=__webpack_exports__.mnM,__webpack_exports__Slide=__webpack_exports__.q7S,__webpack_exports__SolverStrategy=__webpack_exports__.bAZ,__webpack_exports__Sound=__webpack_exports__.ABN,__webpack_exports__SoundEvents=__webpack_exports__.VK6,__webpack_exports__SparseHashGrid=__webpack_exports__.Hj2,__webpack_exports__SparseHashGridCollisionProcessor=__webpack_exports__.Df8,__webpack_exports__SpatialPartitionStrategy=__webpack_exports__.oOx,__webpack_exports__Sprite=__webpack_exports__.kxk,__webpack_exports__SpriteFont=__webpack_exports__.DT1,__webpack_exports__SpriteSheet=__webpack_exports__.FLG,__webpack_exports__StandardClock=__webpack_exports__.qN_,__webpack_exports__StateMachine=__webpack_exports__.Z37,__webpack_exports__StrategyContainer=__webpack_exports__.FtL,__webpack_exports__Stream=__webpack_exports__.Z6X,__webpack_exports__System=__webpack_exports__.iQT,__webpack_exports__SystemManager=__webpack_exports__.ziO,__webpack_exports__SystemPriority=__webpack_exports__.OEF,__webpack_exports__SystemType=__webpack_exports__.uuE,__webpack_exports__TagQuery=__webpack_exports__.tiv,__webpack_exports__TestClock=__webpack_exports__.T$Y,__webpack_exports__Text=__webpack_exports__.EYj,__webpack_exports__TextAlign=__webpack_exports__.nOB,__webpack_exports__TextureLoader=__webpack_exports__.Tap,__webpack_exports__Tile=__webpack_exports__.FAs,__webpack_exports__TileMap=__webpack_exports__.B_P,__webpack_exports__TileMapEvents=__webpack_exports__.aA5,__webpack_exports__TiledAnimation=__webpack_exports__.J3s,__webpack_exports__TiledSprite=__webpack_exports__.Y0Q,__webpack_exports__Timer=__webpack_exports__.M4G,__webpack_exports__Toaster=__webpack_exports__.l$l,__webpack_exports__Transform=__webpack_exports__.dLy,__webpack_exports__TransformComponent=__webpack_exports__.WZP,__webpack_exports__Transition=__webpack_exports__.eB6,__webpack_exports__TreeNode=__webpack_exports__.nFK,__webpack_exports__Trigger=__webpack_exports__.l9z,__webpack_exports__TriggerEvents=__webpack_exports__.YOF,__webpack_exports__TwoPI=__webpack_exports__.yhB,__webpack_exports__Util=__webpack_exports__.J0N,__webpack_exports__Vector=__webpack_exports__.Miz,__webpack_exports__VectorView=__webpack_exports__.Bj4,__webpack_exports__VertexBuffer=__webpack_exports__.Rcs,__webpack_exports__VertexLayout=__webpack_exports__.vJ4,__webpack_exports__VerticalFirst=__webpack_exports__.TqC,__webpack_exports__VisibleEvent=__webpack_exports__.nM0,__webpack_exports__WebAudio=__webpack_exports__.X1u,__webpack_exports__WebAudioInstance=__webpack_exports__.SpZ,__webpack_exports__WheelDeltaMode=__webpack_exports__.DX8,__webpack_exports__WheelEvent=__webpack_exports__.Yx$,__webpack_exports__World=__webpack_exports__.HK4,__webpack_exports__approximatelyEqual=__webpack_exports__.yt5,__webpack_exports__assert=__webpack_exports__.vAR,__webpack_exports__canonicalizeAngle=__webpack_exports__.SE$,__webpack_exports__clamp=__webpack_exports__.qE8,__webpack_exports__coroutine=__webpack_exports__.Pz7,__webpack_exports__createId=__webpack_exports__.sX_,__webpack_exports__frac=__webpack_exports__.JuI,__webpack_exports__getDefaultPhysicsConfig=__webpack_exports__.pxT,__webpack_exports__hasGraphicsTick=__webpack_exports__.Nl$,__webpack_exports__hasOnAdd=__webpack_exports__.zDr,__webpack_exports__hasOnInitialize=__webpack_exports__.OwT,__webpack_exports__hasOnPostUpdate=__webpack_exports__.P$G,__webpack_exports__hasOnPreUpdate=__webpack_exports__.mHV,__webpack_exports__hasOnRemove=__webpack_exports__.kEA,__webpack_exports__hasPostDraw=__webpack_exports__.Fx_,__webpack_exports__hasPreDraw=__webpack_exports__.WFC,__webpack_exports__has_add=__webpack_exports__.vKu,__webpack_exports__has_initialize=__webpack_exports__.aDq,__webpack_exports__has_postupdate=__webpack_exports__.jIg,__webpack_exports__has_preupdate=__webpack_exports__.UH3,__webpack_exports__has_remove=__webpack_exports__.AJO,__webpack_exports__inverseLerp=__webpack_exports__.U4,__webpack_exports__inverseLerpVector=__webpack_exports__.xAc,__webpack_exports__isActor=__webpack_exports__._3Y,__webpack_exports__isAddedComponent=__webpack_exports__.K6X,__webpack_exports__isComponentCtor=__webpack_exports__.C1Y,__webpack_exports__isLoaderConstructor=__webpack_exports__.Aw1,__webpack_exports__isMoveByOptions=__webpack_exports__.tm8,__webpack_exports__isMoveToOptions=__webpack_exports__.LBV,__webpack_exports__isRemovedComponent=__webpack_exports__.A8$,__webpack_exports__isRotateByOptions=__webpack_exports__.F5e,__webpack_exports__isRotateToOptions=__webpack_exports__.ran,__webpack_exports__isScaleByOptions=__webpack_exports__.c8L,__webpack_exports__isScaleToOptions=__webpack_exports__.o6M,__webpack_exports__isSceneConstructor=__webpack_exports__.hsx,__webpack_exports__isScreenElement=__webpack_exports__.l9E,__webpack_exports__isSystemConstructor=__webpack_exports__.aSf,__webpack_exports__lerp=__webpack_exports__.CcK,__webpack_exports__lerpAngle=__webpack_exports__.nU8,__webpack_exports__lerpVector=__webpack_exports__.td6,__webpack_exports__maxMessages=__webpack_exports__.Zex,__webpack_exports__nextActionId=__webpack_exports__.bkJ,__webpack_exports__obsolete=__webpack_exports__.mXP,__webpack_exports__parseImageFiltering=__webpack_exports__.vt$,__webpack_exports__parseImageWrapping=__webpack_exports__.hCA,__webpack_exports__pixelSnapEpsilon=__webpack_exports__.pjR,__webpack_exports__randomInRange=__webpack_exports__.U43,__webpack_exports__randomIntInRange=__webpack_exports__.pSZ,__webpack_exports__range=__webpack_exports__.y17,__webpack_exports__remap=__webpack_exports__.Ew7,__webpack_exports__remapVector=__webpack_exports__.hG1,__webpack_exports__resetObsoleteCounter=__webpack_exports__.jVr,__webpack_exports__sign=__webpack_exports__._SZ,__webpack_exports__toDegrees=__webpack_exports__.xWn,__webpack_exports__toRadians=__webpack_exports__.ehJ,__webpack_exports__vec=__webpack_exports__.t6s,__webpack_exports__webgl=__webpack_exports__.Eyn;const ex=Object.freeze(Object.defineProperty({__proto__:null,ActionCompleteEvent:__webpack_exports__ActionCompleteEvent,ActionContext:__webpack_exports__ActionContext,ActionQueue:__webpack_exports__ActionQueue,ActionSequence:__webpack_exports__ActionSequence,ActionStartEvent:__webpack_exports__ActionStartEvent,ActionsComponent:__webpack_exports__ActionsComponent,ActionsSystem:__webpack_exports__ActionsSystem,ActivateEvent:__webpack_exports__ActivateEvent,Actor:__webpack_exports__Actor,ActorEvents:__webpack_exports__ActorEvents,AddEvent:__webpack_exports__AddEvent,AddedComponent:__webpack_exports__AddedComponent,AffineMatrix:__webpack_exports__AffineMatrix,Animation:__webpack_exports__Animation,AnimationDirection:__webpack_exports__AnimationDirection,AnimationEvents:__webpack_exports__AnimationEvents,AnimationStrategy:__webpack_exports__AnimationStrategy,ArcadeSolver:__webpack_exports__ArcadeSolver,AudioContextFactory:__webpack_exports__AudioContextFactory,Axes:__webpack_exports__Axes,Axis:__webpack_exports__Axis,BaseAlign:__webpack_exports__BaseAlign,BezierCurve:__webpack_exports__BezierCurve,Blink:__webpack_exports__Blink,BodyComponent:__webpack_exports__BodyComponent,BoundingBox:__webpack_exports__BoundingBox,BrowserComponent:__webpack_exports__BrowserComponent,BrowserEvents:__webpack_exports__BrowserEvents,Buttons:__webpack_exports__Buttons,Camera:__webpack_exports__Camera,CameraEvents:__webpack_exports__CameraEvents,Canvas:__webpack_exports__Canvas,Circle:__webpack_exports__Circle,CircleCollider:__webpack_exports__CircleCollider,Clock:__webpack_exports__Clock,ClosestLineJumpTable:__webpack_exports__ClosestLineJumpTable,Collider:__webpack_exports__Collider,ColliderComponent:__webpack_exports__ColliderComponent,CollisionContact:__webpack_exports__CollisionContact,CollisionEndEvent:__webpack_exports__CollisionEndEvent,CollisionGroup:__webpack_exports__CollisionGroup,CollisionGroupManager:__webpack_exports__CollisionGroupManager,CollisionJumpTable:__webpack_exports__CollisionJumpTable,CollisionPostSolveEvent:__webpack_exports__CollisionPostSolveEvent,CollisionPreSolveEvent:__webpack_exports__CollisionPreSolveEvent,CollisionStartEvent:__webpack_exports__CollisionStartEvent,CollisionSystem:__webpack_exports__CollisionSystem,CollisionType:__webpack_exports__CollisionType,Color:__webpack_exports__Color,ColorBlindFlags:__webpack_exports__ColorBlindFlags,ColorBlindnessMode:__webpack_exports__ColorBlindnessMode,ColorBlindnessPostProcessor:__webpack_exports__ColorBlindnessPostProcessor,Component:__webpack_exports__Component,CompositeCollider:__webpack_exports__CompositeCollider,ConsoleAppender:__webpack_exports__ConsoleAppender,ContactConstraintPoint:__webpack_exports__ContactConstraintPoint,ContactEndEvent:__webpack_exports__ContactEndEvent,ContactSolveBias:__webpack_exports__ContactSolveBias,ContactStartEvent:__webpack_exports__ContactStartEvent,CoordPlane:__webpack_exports__CoordPlane,CrossFade:__webpack_exports__CrossFade,CurveBy:__webpack_exports__CurveBy,CurveTo:__webpack_exports__CurveTo,DeactivateEvent:__webpack_exports__DeactivateEvent,Debug:__webpack_exports__Debug,DebugConfig:__webpack_exports__DebugConfig,DebugGraphicsComponent:__webpack_exports__DebugGraphicsComponent,DebugSystem:__webpack_exports__DebugSystem,DebugText:__webpack_exports__DebugText,DefaultAntialiasOptions:__webpack_exports__DefaultAntialiasOptions,DefaultGarbageCollectionOptions:__webpack_exports__DefaultGarbageCollectionOptions,DefaultLoader:__webpack_exports__DefaultLoader,DefaultPixelArtOptions:__webpack_exports__DefaultPixelArtOptions,DegreeOfFreedom:__webpack_exports__DegreeOfFreedom,Delay:__webpack_exports__Delay,Detector:__webpack_exports__Detector,Die:__webpack_exports__Die,Direction:__webpack_exports__Direction,Director:__webpack_exports__Director,DirectorEvents:__webpack_exports__DirectorEvents,DisplayMode:__webpack_exports__DisplayMode,DynamicTree:__webpack_exports__DynamicTree,DynamicTreeCollisionProcessor:__webpack_exports__DynamicTreeCollisionProcessor,EX_VERSION:__webpack_exports__EX_VERSION,EaseBy:__webpack_exports__EaseBy,EaseTo:__webpack_exports__EaseTo,EasingFunctions:__webpack_exports__EasingFunctions,EdgeCollider:__webpack_exports__EdgeCollider,ElasticToActorStrategy:__webpack_exports__ElasticToActorStrategy,EmitterType:__webpack_exports__EmitterType,Engine:__webpack_exports__Engine,EngineEvents:__webpack_exports__EngineEvents,EnterTriggerEvent:__webpack_exports__EnterTriggerEvent,EnterViewPortEvent:__webpack_exports__EnterViewPortEvent,Entity:__webpack_exports__Entity,EntityEvents:__webpack_exports__EntityEvents,EntityManager:__webpack_exports__EntityManager,EventEmitter:__webpack_exports__EventEmitter,EventTypes:__webpack_exports__EventTypes,Events:__webpack_exports__Events,ExResponse:__webpack_exports__ExResponse,ExcaliburGraphicsContext2DCanvas:__webpack_exports__ExcaliburGraphicsContext2DCanvas,ExcaliburGraphicsContextWebGL:__webpack_exports__ExcaliburGraphicsContextWebGL,ExitTriggerEvent:__webpack_exports__ExitTriggerEvent,ExitViewPortEvent:__webpack_exports__ExitViewPortEvent,Fade:__webpack_exports__Fade,FadeInOut:__webpack_exports__FadeInOut,Flags:__webpack_exports__Flags,Flash:__webpack_exports__Flash,Follow:__webpack_exports__Follow,Font:__webpack_exports__Font,FontCache:__webpack_exports__FontCache,FontSource:__webpack_exports__FontSource,FontStyle:__webpack_exports__FontStyle,FontUnit:__webpack_exports__FontUnit,FpsSampler:__webpack_exports__FpsSampler,FrameStats:__webpack_exports__FrameStats,Future:__webpack_exports__Future,GameEvent:__webpack_exports__GameEvent,GameStartEvent:__webpack_exports__GameStartEvent,GameStopEvent:__webpack_exports__GameStopEvent,Gamepad:__webpack_exports__Gamepad,GamepadAxisEvent:__webpack_exports__GamepadAxisEvent,GamepadButtonEvent:__webpack_exports__GamepadButtonEvent,GamepadConnectEvent:__webpack_exports__GamepadConnectEvent,GamepadDisconnectEvent:__webpack_exports__GamepadDisconnectEvent,Gamepads:__webpack_exports__Gamepads,GarbageCollector:__webpack_exports__GarbageCollector,Gif:__webpack_exports__Gif,GifParser:__webpack_exports__GifParser,GlobalCoordinates:__webpack_exports__GlobalCoordinates,GpuParticleEmitter:__webpack_exports__GpuParticleEmitter,GpuParticleRenderer:__webpack_exports__GpuParticleRenderer,Graphic:__webpack_exports__Graphic,GraphicsComponent:__webpack_exports__GraphicsComponent,GraphicsGroup:__webpack_exports__GraphicsGroup,GraphicsSystem:__webpack_exports__GraphicsSystem,HashColliderProxy:__webpack_exports__HashColliderProxy,HashGridCell:__webpack_exports__HashGridCell,HashGridProxy:__webpack_exports__HashGridProxy,HiddenEvent:__webpack_exports__HiddenEvent,HorizontalFirst:__webpack_exports__HorizontalFirst,ImageFiltering:__webpack_exports__ImageFiltering,ImageSource:__webpack_exports__ImageSource,ImageSourceAttributeConstants:__webpack_exports__ImageSourceAttributeConstants,ImageWrapping:__webpack_exports__ImageWrapping,InitializeEvent:__webpack_exports__InitializeEvent,InputHost:__webpack_exports__InputHost,InputMapper:__webpack_exports__InputMapper,IsometricEntityComponent:__webpack_exports__IsometricEntityComponent,IsometricEntitySystem:__webpack_exports__IsometricEntitySystem,IsometricMap:__webpack_exports__IsometricMap,IsometricTile:__webpack_exports__IsometricTile,KeyEvent:__webpack_exports__KeyEvent,Keyboard:__webpack_exports__Keyboard,Keys:__webpack_exports__Keys,KillEvent:__webpack_exports__KillEvent,Label:__webpack_exports__Label,LimitCameraBoundsStrategy:__webpack_exports__LimitCameraBoundsStrategy,Line:__webpack_exports__Line,LineSegment:__webpack_exports__LineSegment,Loader:__webpack_exports__Loader,LoaderEvents:__webpack_exports__LoaderEvents,LockCameraToActorAxisStrategy:__webpack_exports__LockCameraToActorAxisStrategy,LockCameraToActorStrategy:__webpack_exports__LockCameraToActorStrategy,LogLevel:__webpack_exports__LogLevel,Logger:__webpack_exports__Logger,Material:__webpack_exports__Material,Matrix:__webpack_exports__Matrix,MatrixLocations:__webpack_exports__MatrixLocations,MediaEvent:__webpack_exports__MediaEvent,Meet:__webpack_exports__Meet,MotionComponent:__webpack_exports__MotionComponent,MotionSystem:__webpack_exports__MotionSystem,MoveBy:__webpack_exports__MoveBy,MoveByWithOptions:__webpack_exports__MoveByWithOptions,MoveTo:__webpack_exports__MoveTo,MoveToWithOptions:__webpack_exports__MoveToWithOptions,NativePointerButton:__webpack_exports__NativePointerButton,NativeSoundEvent:__webpack_exports__NativeSoundEvent,NativeSoundProcessedEvent:__webpack_exports__NativeSoundProcessedEvent,NineSlice:__webpack_exports__NineSlice,NineSliceStretch:__webpack_exports__NineSliceStretch,None:__webpack_exports__None,Observable:__webpack_exports__Observable,OffscreenSystem:__webpack_exports__OffscreenSystem,Pair:__webpack_exports__Pair,ParallaxComponent:__webpack_exports__ParallaxComponent,ParallelActions:__webpack_exports__ParallelActions,Particle:__webpack_exports__Particle,ParticleEmitter:__webpack_exports__ParticleEmitter,ParticleRenderer:__webpack_exports__ParticleRenderer,ParticleTransform:__webpack_exports__ParticleTransform,PhysicsStats:__webpack_exports__PhysicsStats,PhysicsWorld:__webpack_exports__PhysicsWorld,PointerAbstraction:__webpack_exports__PointerAbstraction,PointerButton:__webpack_exports__PointerButton,PointerComponent:__webpack_exports__PointerComponent,PointerEvent:__webpack_exports__PointerEvent,PointerEventReceiver:__webpack_exports__PointerEventReceiver,PointerScope:__webpack_exports__PointerScope,PointerSystem:__webpack_exports__PointerSystem,PointerType:__webpack_exports__PointerType,Polygon:__webpack_exports__Polygon,PolygonCollider:__webpack_exports__PolygonCollider,Pool:__webpack_exports__Pool,PostCollisionEvent:__webpack_exports__PostCollisionEvent,PostDebugDrawEvent:__webpack_exports__PostDebugDrawEvent,PostDrawEvent:__webpack_exports__PostDrawEvent,PostFrameEvent:__webpack_exports__PostFrameEvent,PostKillEvent:__webpack_exports__PostKillEvent,PostTransformDrawEvent:__webpack_exports__PostTransformDrawEvent,PostUpdateEvent:__webpack_exports__PostUpdateEvent,PreCollisionEvent:__webpack_exports__PreCollisionEvent,PreDebugDrawEvent:__webpack_exports__PreDebugDrawEvent,PreDrawEvent:__webpack_exports__PreDrawEvent,PreFrameEvent:__webpack_exports__PreFrameEvent,PreKillEvent:__webpack_exports__PreKillEvent,PreLoadEvent:__webpack_exports__PreLoadEvent,PreTransformDrawEvent:__webpack_exports__PreTransformDrawEvent,PreUpdateEvent:__webpack_exports__PreUpdateEvent,Projection:__webpack_exports__Projection,QuadIndexBuffer:__webpack_exports__QuadIndexBuffer,QuadTree:__webpack_exports__QuadTree,Query:__webpack_exports__Query,QueryManager:__webpack_exports__QueryManager,RadiusAroundActorStrategy:__webpack_exports__RadiusAroundActorStrategy,Random:__webpack_exports__Random,Raster:__webpack_exports__Raster,Ray:__webpack_exports__Ray,RealisticSolver:__webpack_exports__RealisticSolver,Rectangle:__webpack_exports__Rectangle,RemoveEvent:__webpack_exports__RemoveEvent,RemovedComponent:__webpack_exports__RemovedComponent,Repeat:__webpack_exports__Repeat,RepeatForever:__webpack_exports__RepeatForever,Resolution:__webpack_exports__Resolution,Resource:__webpack_exports__Resource,ResourceEvents:__webpack_exports__ResourceEvents,RotateBy:__webpack_exports__RotateBy,RotateByWithOptions:__webpack_exports__RotateByWithOptions,RotateTo:__webpack_exports__RotateTo,RotateToWithOptions:__webpack_exports__RotateToWithOptions,RotationType:__webpack_exports__RotationType,ScaleBy:__webpack_exports__ScaleBy,ScaleByWithOptions:__webpack_exports__ScaleByWithOptions,ScaleTo:__webpack_exports__ScaleTo,ScaleToWithOptions:__webpack_exports__ScaleToWithOptions,Scene:__webpack_exports__Scene,SceneEvents:__webpack_exports__SceneEvents,Screen:__webpack_exports__Screen,ScreenAppender:__webpack_exports__ScreenAppender,ScreenElement:__webpack_exports__ScreenElement,ScreenEvents:__webpack_exports__ScreenEvents,ScreenShader:__webpack_exports__ScreenShader,ScrollPreventionMode:__webpack_exports__ScrollPreventionMode,Semaphore:__webpack_exports__Semaphore,SeparatingAxis:__webpack_exports__SeparatingAxis,SeparationInfo:__webpack_exports__SeparationInfo,Shader:__webpack_exports__Shader,Shape:__webpack_exports__Shape,Side:__webpack_exports__Side,Slide:__webpack_exports__Slide,SolverStrategy:__webpack_exports__SolverStrategy,Sound:__webpack_exports__Sound,SoundEvents:__webpack_exports__SoundEvents,SparseHashGrid:__webpack_exports__SparseHashGrid,SparseHashGridCollisionProcessor:__webpack_exports__SparseHashGridCollisionProcessor,SpatialPartitionStrategy:__webpack_exports__SpatialPartitionStrategy,Sprite:__webpack_exports__Sprite,SpriteFont:__webpack_exports__SpriteFont,SpriteSheet:__webpack_exports__SpriteSheet,StandardClock:__webpack_exports__StandardClock,StateMachine:__webpack_exports__StateMachine,StrategyContainer:__webpack_exports__StrategyContainer,Stream:__webpack_exports__Stream,System:__webpack_exports__System,SystemManager:__webpack_exports__SystemManager,SystemPriority:__webpack_exports__SystemPriority,SystemType:__webpack_exports__SystemType,TagQuery:__webpack_exports__TagQuery,TestClock:__webpack_exports__TestClock,Text:__webpack_exports__Text,TextAlign:__webpack_exports__TextAlign,TextureLoader:__webpack_exports__TextureLoader,Tile:__webpack_exports__Tile,TileMap:__webpack_exports__TileMap,TileMapEvents:__webpack_exports__TileMapEvents,TiledAnimation:__webpack_exports__TiledAnimation,TiledSprite:__webpack_exports__TiledSprite,Timer:__webpack_exports__Timer,Toaster:__webpack_exports__Toaster,Transform:__webpack_exports__Transform,TransformComponent:__webpack_exports__TransformComponent,Transition:__webpack_exports__Transition,TreeNode:__webpack_exports__TreeNode,Trigger:__webpack_exports__Trigger,TriggerEvents:__webpack_exports__TriggerEvents,TwoPI:__webpack_exports__TwoPI,Util:__webpack_exports__Util,Vector:__webpack_exports__Vector,VectorView:__webpack_exports__VectorView,VertexBuffer:__webpack_exports__VertexBuffer,VertexLayout:__webpack_exports__VertexLayout,VerticalFirst:__webpack_exports__VerticalFirst,VisibleEvent:__webpack_exports__VisibleEvent,WebAudio:__webpack_exports__WebAudio,WebAudioInstance:__webpack_exports__WebAudioInstance,WheelDeltaMode:__webpack_exports__WheelDeltaMode,WheelEvent:__webpack_exports__WheelEvent,World:__webpack_exports__World,approximatelyEqual:__webpack_exports__approximatelyEqual,assert:__webpack_exports__assert,canonicalizeAngle:__webpack_exports__canonicalizeAngle,clamp:__webpack_exports__clamp,coroutine:__webpack_exports__coroutine,createId:__webpack_exports__createId,frac:__webpack_exports__frac,getDefaultPhysicsConfig:__webpack_exports__getDefaultPhysicsConfig,hasGraphicsTick:__webpack_exports__hasGraphicsTick,hasOnAdd:__webpack_exports__hasOnAdd,hasOnInitialize:__webpack_exports__hasOnInitialize,hasOnPostUpdate:__webpack_exports__hasOnPostUpdate,hasOnPreUpdate:__webpack_exports__hasOnPreUpdate,hasOnRemove:__webpack_exports__hasOnRemove,hasPostDraw:__webpack_exports__hasPostDraw,hasPreDraw:__webpack_exports__hasPreDraw,has_add:__webpack_exports__has_add,has_initialize:__webpack_exports__has_initialize,has_postupdate:__webpack_exports__has_postupdate,has_preupdate:__webpack_exports__has_preupdate,has_remove:__webpack_exports__has_remove,inverseLerp:__webpack_exports__inverseLerp,inverseLerpVector:__webpack_exports__inverseLerpVector,isActor:__webpack_exports__isActor,isAddedComponent:__webpack_exports__isAddedComponent,isComponentCtor:__webpack_exports__isComponentCtor,isLoaderConstructor:__webpack_exports__isLoaderConstructor,isMoveByOptions:__webpack_exports__isMoveByOptions,isMoveToOptions:__webpack_exports__isMoveToOptions,isRemovedComponent:__webpack_exports__isRemovedComponent,isRotateByOptions:__webpack_exports__isRotateByOptions,isRotateToOptions:__webpack_exports__isRotateToOptions,isScaleByOptions:__webpack_exports__isScaleByOptions,isScaleToOptions:__webpack_exports__isScaleToOptions,isSceneConstructor:__webpack_exports__isSceneConstructor,isScreenElement:__webpack_exports__isScreenElement,isSystemConstructor:__webpack_exports__isSystemConstructor,lerp:__webpack_exports__lerp,lerpAngle:__webpack_exports__lerpAngle,lerpVector:__webpack_exports__lerpVector,maxMessages:__webpack_exports__maxMessages,nextActionId:__webpack_exports__nextActionId,obsolete:__webpack_exports__obsolete,parseImageFiltering:__webpack_exports__parseImageFiltering,parseImageWrapping:__webpack_exports__parseImageWrapping,pixelSnapEpsilon:__webpack_exports__pixelSnapEpsilon,randomInRange:__webpack_exports__randomInRange,randomIntInRange:__webpack_exports__randomIntInRange,range:__webpack_exports__range,remap:__webpack_exports__remap,remapVector:__webpack_exports__remapVector,resetObsoleteCounter:__webpack_exports__resetObsoleteCounter,sign:__webpack_exports__sign,toDegrees:__webpack_exports__toDegrees,toRadians:__webpack_exports__toRadians,vec:__webpack_exports__vec,webgl:__webpack_exports__webgl},Symbol.toStringTag,{value:"Module"})),scriptRel="modulepreload",assetsURL=function(fi){return"/roke/"+fi},seen={},__vitePreload=function(ci,hi,_i){let pi=Promise.resolve();if(hi&&hi.length>0){document.getElementsByTagName("link");const mi=document.querySelector("meta[property=csp-nonce]"),xi=(mi==null?void 0:mi.nonce)||(mi==null?void 0:mi.getAttribute("nonce"));pi=Promise.allSettled(hi.map(yi=>{if(yi=assetsURL(yi),yi in seen)return;seen[yi]=!0;const Ci=yi.endsWith(".css"),Ei=Ci?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${yi}"]${Ei}`))return;const Ai=document.createElement("link");if(Ai.rel=Ci?"stylesheet":scriptRel,Ci||(Ai.as="script"),Ai.crossOrigin="",Ai.href=yi,xi&&Ai.setAttribute("nonce",xi),document.head.appendChild(Ai),Ci)return new Promise((ki,Pi)=>{Ai.addEventListener("load",ki),Ai.addEventListener("error",()=>Pi(new Error(`Unable to preload CSS for ${yi}`)))})}))}function gi(mi){const xi=new Event("vite:preloadError",{cancelable:!0});if(xi.payload=mi,window.dispatchEvent(xi),!xi.defaultPrevented)throw mi}return pi.then(mi=>{for(const xi of mi||[])xi.status==="rejected"&&gi(xi.reason);return ci().catch(gi)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const createCapacitorPlatforms=fi=>{const ci=new Map;ci.set("web",{name:"web"});const hi=fi.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:ci},_i=(gi,mi)=>{hi.platforms.set(gi,mi)},pi=gi=>{hi.platforms.has(gi)&&(hi.currentPlatform=hi.platforms.get(gi))};return hi.addPlatform=_i,hi.setPlatform=pi,hi},initPlatforms=fi=>fi.CapacitorPlatforms=createCapacitorPlatforms(fi),CapacitorPlatforms=initPlatforms(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});CapacitorPlatforms.addPlatform;CapacitorPlatforms.setPlatform;var ExceptionCode;(function(fi){fi.Unimplemented="UNIMPLEMENTED",fi.Unavailable="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={}));class CapacitorException extends Error{constructor(ci,hi,_i){super(ci),this.message=ci,this.code=hi,this.data=_i}}const getPlatformId=fi=>{var ci,hi;return fi!=null&&fi.androidBridge?"android":!((hi=(ci=fi==null?void 0:fi.webkit)===null||ci===void 0?void 0:ci.messageHandlers)===null||hi===void 0)&&hi.bridge?"ios":"web"},createCapacitor=fi=>{var ci,hi,_i,pi,gi;const mi=fi.CapacitorCustomPlatform||null,xi=fi.Capacitor||{},yi=xi.Plugins=xi.Plugins||{},Ci=fi.CapacitorPlatforms,Ei=()=>mi!==null?mi.name:getPlatformId(fi),Ai=((ci=Ci==null?void 0:Ci.currentPlatform)===null||ci===void 0?void 0:ci.getPlatform)||Ei,ki=()=>Ai()!=="web",Pi=((hi=Ci==null?void 0:Ci.currentPlatform)===null||hi===void 0?void 0:hi.isNativePlatform)||ki,Ii=Ui=>{const qi=$i.get(Ui);return!!(qi!=null&&qi.platforms.has(Ai())||Li(Ui))},Di=((_i=Ci==null?void 0:Ci.currentPlatform)===null||_i===void 0?void 0:_i.isPluginAvailable)||Ii,Fi=Ui=>{var qi;return(qi=xi.PluginHeaders)===null||qi===void 0?void 0:qi.find(Ji=>Ji.name===Ui)},Li=((pi=Ci==null?void 0:Ci.currentPlatform)===null||pi===void 0?void 0:pi.getPluginHeader)||Fi,Bi=Ui=>fi.console.error(Ui),Ri=(Ui,qi,Ji)=>Promise.reject(`${Ji} does not have an implementation of "${qi}".`),$i=new Map,Ni=(Ui,qi={})=>{const Ji=$i.get(Ui);if(Ji)return console.warn(`Capacitor plugin "${Ui}" already registered. Cannot register plugins twice.`),Ji.proxy;const rs=Ai(),ss=Li(Ui);let zi;const Gi=async()=>(!zi&&rs in qi?zi=typeof qi[rs]=="function"?zi=await qi[rs]():zi=qi[rs]:mi!==null&&!zi&&"web"in qi&&(zi=typeof qi.web=="function"?zi=await qi.web():zi=qi.web),zi),Vi=(ls,us)=>{var fs,xs;if(ss){const bs=ss==null?void 0:ss.methods.find(Cs=>us===Cs.name);if(bs)return bs.rtype==="promise"?Cs=>xi.nativePromise(Ui,us.toString(),Cs):(Cs,Ds)=>xi.nativeCallback(Ui,us.toString(),Cs,Ds);if(ls)return(fs=ls[us])===null||fs===void 0?void 0:fs.bind(ls)}else{if(ls)return(xs=ls[us])===null||xs===void 0?void 0:xs.bind(ls);throw new CapacitorException(`"${Ui}" plugin is not implemented on ${rs}`,ExceptionCode.Unimplemented)}},Qi=ls=>{let us;const fs=(...xs)=>{const bs=Gi().then(Cs=>{const Ds=Vi(Cs,ls);if(Ds){const Hs=Ds(...xs);return us=Hs==null?void 0:Hs.remove,Hs}else throw new CapacitorException(`"${Ui}.${ls}()" is not implemented on ${rs}`,ExceptionCode.Unimplemented)});return ls==="addListener"&&(bs.remove=async()=>us()),bs};return fs.toString=()=>`${ls.toString()}() { [capacitor code] }`,Object.defineProperty(fs,"name",{value:ls,writable:!1,configurable:!1}),fs},is=Qi("addListener"),Zi=Qi("removeListener"),ts=(ls,us)=>{const fs=is({eventName:ls},us),xs=async()=>{const Cs=await fs;Zi({eventName:ls,callbackId:Cs},us)},bs=new Promise(Cs=>fs.then(()=>Cs({remove:xs})));return bs.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await xs()},bs},cs=new Proxy({},{get(ls,us){switch(us){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ss?ts:is;case"removeListener":return Zi;default:return Qi(us)}}});return yi[Ui]=cs,$i.set(Ui,{name:Ui,proxy:cs,platforms:new Set([...Object.keys(qi),...ss?[rs]:[]])}),cs},ji=((gi=Ci==null?void 0:Ci.currentPlatform)===null||gi===void 0?void 0:gi.registerPlugin)||Ni;return xi.convertFileSrc||(xi.convertFileSrc=Ui=>Ui),xi.getPlatform=Ai,xi.handleError=Bi,xi.isNativePlatform=Pi,xi.isPluginAvailable=Di,xi.pluginMethodNoop=Ri,xi.registerPlugin=ji,xi.Exception=CapacitorException,xi.DEBUG=!!xi.DEBUG,xi.isLoggingEnabled=!!xi.isLoggingEnabled,xi.platform=xi.getPlatform(),xi.isNative=xi.isNativePlatform(),xi},initCapacitorGlobal=fi=>fi.Capacitor=createCapacitor(fi),Capacitor=initCapacitorGlobal(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),registerPlugin=Capacitor.registerPlugin;Capacitor.Plugins;class WebPlugin{constructor(ci){this.listeners={},this.retainedEventArguments={},this.windowListeners={},ci&&(console.warn(`Capacitor WebPlugin "${ci.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=ci)}addListener(ci,hi){let _i=!1;this.listeners[ci]||(this.listeners[ci]=[],_i=!0),this.listeners[ci].push(hi);const gi=this.windowListeners[ci];gi&&!gi.registered&&this.addWindowListener(gi),_i&&this.sendRetainedArgumentsForEvent(ci);const mi=async()=>this.removeListener(ci,hi);return Promise.resolve({remove:mi})}async removeAllListeners(){this.listeners={};for(const ci in this.windowListeners)this.removeWindowListener(this.windowListeners[ci]);this.windowListeners={}}notifyListeners(ci,hi,_i){const pi=this.listeners[ci];if(!pi){if(_i){let gi=this.retainedEventArguments[ci];gi||(gi=[]),gi.push(hi),this.retainedEventArguments[ci]=gi}return}pi.forEach(gi=>gi(hi))}hasListeners(ci){return!!this.listeners[ci].length}registerWindowListener(ci,hi){this.windowListeners[hi]={registered:!1,windowEventName:ci,pluginEventName:hi,handler:_i=>{this.notifyListeners(hi,_i)}}}unimplemented(ci="not implemented"){return new Capacitor.Exception(ci,ExceptionCode.Unimplemented)}unavailable(ci="not available"){return new Capacitor.Exception(ci,ExceptionCode.Unavailable)}async removeListener(ci,hi){const _i=this.listeners[ci];if(!_i)return;const pi=_i.indexOf(hi);this.listeners[ci].splice(pi,1),this.listeners[ci].length||this.removeWindowListener(this.windowListeners[ci])}addWindowListener(ci){window.addEventListener(ci.windowEventName,ci.handler),ci.registered=!0}removeWindowListener(ci){ci&&(window.removeEventListener(ci.windowEventName,ci.handler),ci.registered=!1)}sendRetainedArgumentsForEvent(ci){const hi=this.retainedEventArguments[ci];hi&&(delete this.retainedEventArguments[ci],hi.forEach(_i=>{this.notifyListeners(ci,_i)}))}}const encode=fi=>encodeURIComponent(fi).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),decode=fi=>fi.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CapacitorCookiesPluginWeb extends WebPlugin{async getCookies(){const ci=document.cookie,hi={};return ci.split(";").forEach(_i=>{if(_i.length<=0)return;let[pi,gi]=_i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");pi=decode(pi).trim(),gi=decode(gi).trim(),hi[pi]=gi}),hi}async setCookie(ci){try{const hi=encode(ci.key),_i=encode(ci.value),pi=`; expires=${(ci.expires||"").replace("expires=","")}`,gi=(ci.path||"/").replace("path=",""),mi=ci.url!=null&&ci.url.length>0?`domain=${ci.url}`:"";document.cookie=`${hi}=${_i||""}${pi}; path=${gi}; ${mi};`}catch(hi){return Promise.reject(hi)}}async deleteCookie(ci){try{document.cookie=`${ci.key}=; Max-Age=0`}catch(hi){return Promise.reject(hi)}}async clearCookies(){try{const ci=document.cookie.split(";")||[];for(const hi of ci)document.cookie=hi.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(ci){return Promise.reject(ci)}}async clearAllCookies(){try{await this.clearCookies()}catch(ci){return Promise.reject(ci)}}}registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});const readBlobAsBase64=async fi=>new Promise((ci,hi)=>{const _i=new FileReader;_i.onload=()=>{const pi=_i.result;ci(pi.indexOf(",")>=0?pi.split(",")[1]:pi)},_i.onerror=pi=>hi(pi),_i.readAsDataURL(fi)}),normalizeHttpHeaders=(fi={})=>{const ci=Object.keys(fi);return Object.keys(fi).map(pi=>pi.toLocaleLowerCase()).reduce((pi,gi,mi)=>(pi[gi]=fi[ci[mi]],pi),{})},buildUrlParams=(fi,ci=!0)=>fi?Object.entries(fi).reduce((_i,pi)=>{const[gi,mi]=pi;let xi,yi;return Array.isArray(mi)?(yi="",mi.forEach(Ci=>{xi=ci?encodeURIComponent(Ci):Ci,yi+=`${gi}=${xi}&`}),yi.slice(0,-1)):(xi=ci?encodeURIComponent(mi):mi,yi=`${gi}=${xi}`),`${_i}&${yi}`},"").substr(1):null,buildRequestInit=(fi,ci={})=>{const hi=Object.assign({method:fi.method||"GET",headers:fi.headers},ci),pi=normalizeHttpHeaders(fi.headers)["content-type"]||"";if(typeof fi.data=="string")hi.body=fi.data;else if(pi.includes("application/x-www-form-urlencoded")){const gi=new URLSearchParams;for(const[mi,xi]of Object.entries(fi.data||{}))gi.set(mi,xi);hi.body=gi.toString()}else if(pi.includes("multipart/form-data")||fi.data instanceof FormData){const gi=new FormData;if(fi.data instanceof FormData)fi.data.forEach((xi,yi)=>{gi.append(yi,xi)});else for(const xi of Object.keys(fi.data))gi.append(xi,fi.data[xi]);hi.body=gi;const mi=new Headers(hi.headers);mi.delete("content-type"),hi.headers=mi}else(pi.includes("application/json")||typeof fi.data=="object")&&(hi.body=JSON.stringify(fi.data));return hi};class CapacitorHttpPluginWeb extends WebPlugin{async request(ci){const hi=buildRequestInit(ci,ci.webFetchExtra),_i=buildUrlParams(ci.params,ci.shouldEncodeUrlParams),pi=_i?`${ci.url}?${_i}`:ci.url,gi=await fetch(pi,hi),mi=gi.headers.get("content-type")||"";let{responseType:xi="text"}=gi.ok?ci:{};mi.includes("application/json")&&(xi="json");let yi,Ci;switch(xi){case"arraybuffer":case"blob":Ci=await gi.blob(),yi=await readBlobAsBase64(Ci);break;case"json":yi=await gi.json();break;case"document":case"text":default:yi=await gi.text()}const Ei={};return gi.headers.forEach((Ai,ki)=>{Ei[ki]=Ai}),{data:yi,headers:Ei,status:gi.status,url:gi.url}}async get(ci){return this.request(Object.assign(Object.assign({},ci),{method:"GET"}))}async post(ci){return this.request(Object.assign(Object.assign({},ci),{method:"POST"}))}async put(ci){return this.request(Object.assign(Object.assign({},ci),{method:"PUT"}))}async patch(ci){return this.request(Object.assign(Object.assign({},ci),{method:"PATCH"}))}async delete(ci){return this.request(Object.assign(Object.assign({},ci),{method:"DELETE"}))}}registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb});const Motion=registerPlugin("Motion",{android:()=>__vitePreload(()=>import("./web-BeTNd9qt.js"),[]).then(fi=>new fi.MotionWeb),ios:()=>__vitePreload(()=>import("./web-BeTNd9qt.js"),[]).then(fi=>new fi.MotionWeb),web:()=>__vitePreload(()=>import("./web-BeTNd9qt.js"),[]).then(fi=>new fi.MotionWeb)});var t$1={d:(fi,ci)=>{for(var hi in ci)t$1.o(ci,hi)&&!t$1.o(fi,hi)&&Object.defineProperty(fi,hi,{enumerable:!0,get:ci[hi]})},o:(fi,ci)=>Object.prototype.hasOwnProperty.call(fi,ci)},i$1={};t$1.d(i$1,{dd:()=>ai,UZ:()=>l$1,NN:()=>ni,e1:()=>Gt,a8:()=>Rt,u6:()=>Ut,oK:()=>$t,U_:()=>Ft,sn:()=>Kt,GY:()=>ui,$t:()=>oi,RI:()=>di,_k:()=>ri,eZ:()=>r$1,pf:()=>li,N5:()=>a$1,qD:()=>n,hu:()=>o$1,Uk:()=>d$1});const s$1=(fi=>{var ci={};return t$1.d(ci,fi),ci})({Actor:()=>__webpack_exports__Actor,BoundingBox:()=>__webpack_exports__BoundingBox,Color:()=>__webpack_exports__Color,GraphicsComponent:()=>__webpack_exports__GraphicsComponent,ImageSource:()=>__webpack_exports__ImageSource,SpriteSheet:()=>__webpack_exports__SpriteSheet,TileMap:()=>__webpack_exports__TileMap,TransformComponent:()=>__webpack_exports__TransformComponent,Vector:()=>__webpack_exports__Vector,vec:()=>__webpack_exports__vec});let r$1=class{constructor(ci,hi,_i,pi){var gi,mi,xi,yi;if(this.order=pi,this.worldPos=(0,s$1.vec)(ci.ldtkLevel.worldX,ci.ldtkLevel.worldY),this.offset=(0,s$1.vec)(hi.__pxTotalOffsetX,hi.__pxTotalOffsetY),this.ldtkLayer=hi,this.tilemap=new s$1.TileMap({name:hi.__identifier,pos:this.worldPos.add(this.offset),tileWidth:hi.__gridSize,tileHeight:hi.__gridSize,rows:hi.__cHei,columns:hi.__cWid}),this.tilemap.z=pi,this.tilemap.get(s$1.GraphicsComponent).isVisible=hi.visible,hi.__tilesetDefUid){this.tileset=_i.tilesets.get(hi.__tilesetDefUid);for(let Ci of hi.gridTiles){const Ei=Math.floor(Ci.px[0]/hi.__gridSize),Ai=Math.floor(Ci.px[1]/hi.__gridSize),ki=this.tilemap.getTile(Ei,Ai);if(this.tileset){const Pi=Math.floor((Ci.src[0]-((gi=this.tileset.ldtkTileset.padding)!==null&&gi!==void 0?gi:0))/(this.tileset.ldtkTileset.tileGridSize+((mi=this.tileset.ldtkTileset.spacing)!==null&&mi!==void 0?mi:0))),Ii=Math.floor((Ci.src[1]-((xi=this.tileset.ldtkTileset.padding)!==null&&xi!==void 0?xi:0))/(this.tileset.ldtkTileset.tileGridSize+((yi=this.tileset.ldtkTileset.spacing)!==null&&yi!==void 0?yi:0))),Di=!!(1&Ci.f),Fi=!!(2&Ci.f);let Li=this.tileset.spritesheet.getSprite(Pi,Ii);(Di||Fi)&&(Li=Li.clone(),Li.flipHorizontal=Di,Li.flipVertical=Fi),Li?ki.addGraphic(Li):console.error("Could not find sprite in LDtk spritesheet at",Pi,Ii)}}}else console.error("Could not tileset in LDtk",hi.__tilesetDefUid,hi.__tilesetRelPath)}};function a$1(fi){const ci=fi.match(/[^/\\&\?]+\.\w{2,4}(?=([\#\?&].*$|$))/gi);if(ci)return ci[0];throw new Error(`Could not locate filename from path: ${fi}`)}function n(fi,ci){for(const{path:hi,output:_i}of ci)if(typeof hi=="string"){if(fi.includes(hi))return _i}else{const pi=fi.match(hi);if(pi)return _i.replace("[match]",pi[0])}return fi}function o$1(fi,ci){if(!ci)return!1;for(const{path:hi,output:_i}of ci)if(typeof hi=="string"){if(fi.includes(hi))return!0}else if(fi.match(hi))return!0;return!1}function d$1(fi,ci,hi){if(o$1(ci,hi)&&hi)return n(ci,hi);if(ci.indexOf("/")===0)return ci;const _i=fi.split("/"),pi=ci.split("/");return _i[_i.length-1].includes(".")&&_i.pop(),_i.concat(pi).join("/")}const l$1=async(fi,ci)=>{const hi=await fetch(fi);switch(ci.toLowerCase()){case"xml":default:return await hi.text();case"json":return await hi.json()}};var u$1,c$1;(function(fi){fi.assertEqual=ci=>ci,fi.assertIs=function(ci){},fi.assertNever=function(ci){throw new Error},fi.arrayToEnum=ci=>{const hi={};for(const _i of ci)hi[_i]=_i;return hi},fi.getValidEnumValues=ci=>{const hi=fi.objectKeys(ci).filter(pi=>typeof ci[ci[pi]]!="number"),_i={};for(const pi of hi)_i[pi]=ci[pi];return fi.objectValues(_i)},fi.objectValues=ci=>fi.objectKeys(ci).map(function(hi){return ci[hi]}),fi.objectKeys=typeof Object.keys=="function"?ci=>Object.keys(ci):ci=>{const hi=[];for(const _i in ci)Object.prototype.hasOwnProperty.call(ci,_i)&&hi.push(_i);return hi},fi.find=(ci,hi)=>{for(const _i of ci)if(hi(_i))return _i},fi.isInteger=typeof Number.isInteger=="function"?ci=>Number.isInteger(ci):ci=>typeof ci=="number"&&isFinite(ci)&&Math.floor(ci)===ci,fi.joinValues=function(ci,hi=" | "){return ci.map(_i=>typeof _i=="string"?`'${_i}'`:_i).join(hi)},fi.jsonStringifyReplacer=(ci,hi)=>typeof hi=="bigint"?hi.toString():hi})(u$1||(u$1={})),function(fi){fi.mergeShapes=(ci,hi)=>({...ci,...hi})}(c$1||(c$1={}));const h$1=u$1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),p$1=fi=>{switch(typeof fi){case"undefined":return h$1.undefined;case"string":return h$1.string;case"number":return isNaN(fi)?h$1.nan:h$1.number;case"boolean":return h$1.boolean;case"function":return h$1.function;case"bigint":return h$1.bigint;case"symbol":return h$1.symbol;case"object":return Array.isArray(fi)?h$1.array:fi===null?h$1.null:fi.then&&typeof fi.then=="function"&&fi.catch&&typeof fi.catch=="function"?h$1.promise:typeof Map<"u"&&fi instanceof Map?h$1.map:typeof Set<"u"&&fi instanceof Set?h$1.set:typeof Date<"u"&&fi instanceof Date?h$1.date:h$1.object;default:return h$1.unknown}},f$1=u$1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let m$1=class iu extends Error{get errors(){return this.issues}constructor(ci){super(),this.issues=[],this.addIssue=_i=>{this.issues=[...this.issues,_i]},this.addIssues=(_i=[])=>{this.issues=[...this.issues,..._i]};const hi=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,hi):this.__proto__=hi,this.name="ZodError",this.issues=ci}format(ci){const hi=ci||function(gi){return gi.message},_i={_errors:[]},pi=gi=>{for(const mi of gi.issues)if(mi.code==="invalid_union")mi.unionErrors.map(pi);else if(mi.code==="invalid_return_type")pi(mi.returnTypeError);else if(mi.code==="invalid_arguments")pi(mi.argumentsError);else if(mi.path.length===0)_i._errors.push(hi(mi));else{let xi=_i,yi=0;for(;yi<mi.path.length;){const Ci=mi.path[yi];yi===mi.path.length-1?(xi[Ci]=xi[Ci]||{_errors:[]},xi[Ci]._errors.push(hi(mi))):xi[Ci]=xi[Ci]||{_errors:[]},xi=xi[Ci],yi++}}};return pi(this),_i}static assert(ci){if(!(ci instanceof iu))throw new Error(`Not a ZodError: ${ci}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,u$1.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(ci=hi=>hi.message){const hi={},_i=[];for(const pi of this.issues)pi.path.length>0?(hi[pi.path[0]]=hi[pi.path[0]]||[],hi[pi.path[0]].push(ci(pi))):_i.push(ci(pi));return{formErrors:_i,fieldErrors:hi}}get formErrors(){return this.flatten()}};m$1.create=fi=>new m$1(fi);const y$1=(fi,ci)=>{let hi;switch(fi.code){case f$1.invalid_type:hi=fi.received===h$1.undefined?"Required":`Expected ${fi.expected}, received ${fi.received}`;break;case f$1.invalid_literal:hi=`Invalid literal value, expected ${JSON.stringify(fi.expected,u$1.jsonStringifyReplacer)}`;break;case f$1.unrecognized_keys:hi=`Unrecognized key(s) in object: ${u$1.joinValues(fi.keys,", ")}`;break;case f$1.invalid_union:hi="Invalid input";break;case f$1.invalid_union_discriminator:hi=`Invalid discriminator value. Expected ${u$1.joinValues(fi.options)}`;break;case f$1.invalid_enum_value:hi=`Invalid enum value. Expected ${u$1.joinValues(fi.options)}, received '${fi.received}'`;break;case f$1.invalid_arguments:hi="Invalid function arguments";break;case f$1.invalid_return_type:hi="Invalid function return type";break;case f$1.invalid_date:hi="Invalid date";break;case f$1.invalid_string:typeof fi.validation=="object"?"includes"in fi.validation?(hi=`Invalid input: must include "${fi.validation.includes}"`,typeof fi.validation.position=="number"&&(hi=`${hi} at one or more positions greater than or equal to ${fi.validation.position}`)):"startsWith"in fi.validation?hi=`Invalid input: must start with "${fi.validation.startsWith}"`:"endsWith"in fi.validation?hi=`Invalid input: must end with "${fi.validation.endsWith}"`:u$1.assertNever(fi.validation):hi=fi.validation!=="regex"?`Invalid ${fi.validation}`:"Invalid";break;case f$1.too_small:hi=fi.type==="array"?`Array must contain ${fi.exact?"exactly":fi.inclusive?"at least":"more than"} ${fi.minimum} element(s)`:fi.type==="string"?`String must contain ${fi.exact?"exactly":fi.inclusive?"at least":"over"} ${fi.minimum} character(s)`:fi.type==="number"?`Number must be ${fi.exact?"exactly equal to ":fi.inclusive?"greater than or equal to ":"greater than "}${fi.minimum}`:fi.type==="date"?`Date must be ${fi.exact?"exactly equal to ":fi.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(fi.minimum))}`:"Invalid input";break;case f$1.too_big:hi=fi.type==="array"?`Array must contain ${fi.exact?"exactly":fi.inclusive?"at most":"less than"} ${fi.maximum} element(s)`:fi.type==="string"?`String must contain ${fi.exact?"exactly":fi.inclusive?"at most":"under"} ${fi.maximum} character(s)`:fi.type==="number"?`Number must be ${fi.exact?"exactly":fi.inclusive?"less than or equal to":"less than"} ${fi.maximum}`:fi.type==="bigint"?`BigInt must be ${fi.exact?"exactly":fi.inclusive?"less than or equal to":"less than"} ${fi.maximum}`:fi.type==="date"?`Date must be ${fi.exact?"exactly":fi.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(fi.maximum))}`:"Invalid input";break;case f$1.custom:hi="Invalid input";break;case f$1.invalid_intersection_types:hi="Intersection results could not be merged";break;case f$1.not_multiple_of:hi=`Number must be a multiple of ${fi.multipleOf}`;break;case f$1.not_finite:hi="Number must be finite";break;default:hi=ci.defaultError,u$1.assertNever(fi)}return{message:hi}};let g$2=y$1;function _$1(){return g$2}const v$1=fi=>{const{data:ci,path:hi,errorMaps:_i,issueData:pi}=fi,gi=[...hi,...pi.path||[]],mi={...pi,path:gi};if(pi.message!==void 0)return{...pi,path:gi,message:pi.message};let xi="";const yi=_i.filter(Ci=>!!Ci).slice().reverse();for(const Ci of yi)xi=Ci(mi,{data:ci,defaultError:xi}).message;return{...pi,path:gi,message:xi}};function b(fi,ci){const hi=_$1(),_i=v$1({issueData:ci,data:fi.data,path:fi.path,errorMaps:[fi.common.contextualErrorMap,fi.schemaErrorMap,hi,hi===y$1?void 0:y$1].filter(pi=>!!pi)});fi.common.issues.push(_i)}let k$2=class su{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(ci,hi){const _i=[];for(const pi of hi){if(pi.status==="aborted")return x$2;pi.status==="dirty"&&ci.dirty(),_i.push(pi.value)}return{status:ci.value,value:_i}}static async mergeObjectAsync(ci,hi){const _i=[];for(const pi of hi){const gi=await pi.key,mi=await pi.value;_i.push({key:gi,value:mi})}return su.mergeObjectSync(ci,_i)}static mergeObjectSync(ci,hi){const _i={};for(const pi of hi){const{key:gi,value:mi}=pi;if(gi.status==="aborted"||mi.status==="aborted")return x$2;gi.status==="dirty"&&ci.dirty(),mi.status==="dirty"&&ci.dirty(),gi.value==="__proto__"||mi.value===void 0&&!pi.alwaysSet||(_i[gi.value]=mi.value)}return{status:ci.value,value:_i}}};const x$2=Object.freeze({status:"aborted"}),w$2=fi=>({status:"dirty",value:fi}),T$2=fi=>({status:"valid",value:fi}),Z$1=fi=>fi.status==="aborted",L$1=fi=>fi.status==="dirty",C$2=fi=>fi.status==="valid",S=fi=>typeof Promise<"u"&&fi instanceof Promise;function E$1(fi,ci,hi,_i){if(typeof ci=="function"?fi!==ci||!_i:!ci.has(fi))throw new TypeError("Cannot read private member from an object whose class did not declare it");return ci.get(fi)}function O$1(fi,ci,hi,_i,pi){if(typeof ci=="function"?fi!==ci||!pi:!ci.has(fi))throw new TypeError("Cannot write private member to an object whose class did not declare it");return ci.set(fi,hi),hi}var j$2,I$1,A$2;typeof SuppressedError=="function"&&SuppressedError,function(fi){fi.errToObj=ci=>typeof ci=="string"?{message:ci}:ci||{},fi.toString=ci=>typeof ci=="string"?ci:ci==null?void 0:ci.message}(j$2||(j$2={}));let N$1=class{constructor(ci,hi,_i,pi){this._cachedPath=[],this.parent=ci,this.data=hi,this._path=_i,this._key=pi}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const P$2=(fi,ci)=>{if(C$2(ci))return{success:!0,data:ci.value};if(!fi.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const hi=new m$1(fi.common.issues);return this._error=hi,this._error}}};function M$1(fi){if(!fi)return{};const{errorMap:ci,invalid_type_error:hi,required_error:_i,description:pi}=fi;if(ci&&(hi||_i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return ci?{errorMap:ci,description:pi}:{errorMap:(gi,mi)=>{var xi,yi;const{message:Ci}=fi;return gi.code==="invalid_enum_value"?{message:Ci??mi.defaultError}:mi.data===void 0?{message:(xi=Ci??_i)!==null&&xi!==void 0?xi:mi.defaultError}:gi.code!=="invalid_type"?{message:mi.defaultError}:{message:(yi=Ci??hi)!==null&&yi!==void 0?yi:mi.defaultError}},description:pi}}let R$1=class{get description(){return this._def.description}_getType(ci){return p$1(ci.data)}_getOrReturnCtx(ci,hi){return hi||{common:ci.parent.common,data:ci.data,parsedType:p$1(ci.data),schemaErrorMap:this._def.errorMap,path:ci.path,parent:ci.parent}}_processInputParams(ci){return{status:new k$2,ctx:{common:ci.parent.common,data:ci.data,parsedType:p$1(ci.data),schemaErrorMap:this._def.errorMap,path:ci.path,parent:ci.parent}}}_parseSync(ci){const hi=this._parse(ci);if(S(hi))throw new Error("Synchronous parse encountered promise.");return hi}_parseAsync(ci){const hi=this._parse(ci);return Promise.resolve(hi)}parse(ci,hi){const _i=this.safeParse(ci,hi);if(_i.success)return _i.data;throw _i.error}safeParse(ci,hi){var _i;const pi={common:{issues:[],async:(_i=hi==null?void 0:hi.async)!==null&&_i!==void 0&&_i,contextualErrorMap:hi==null?void 0:hi.errorMap},path:(hi==null?void 0:hi.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:ci,parsedType:p$1(ci)},gi=this._parseSync({data:ci,path:pi.path,parent:pi});return P$2(pi,gi)}"~validate"(ci){var hi,_i;const pi={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:ci,parsedType:p$1(ci)};if(!this["~standard"].async)try{const gi=this._parseSync({data:ci,path:[],parent:pi});return C$2(gi)?{value:gi.value}:{issues:pi.common.issues}}catch(gi){!((_i=(hi=gi==null?void 0:gi.message)===null||hi===void 0?void 0:hi.toLowerCase())===null||_i===void 0)&&_i.includes("encountered")&&(this["~standard"].async=!0),pi.common={issues:[],async:!0}}return this._parseAsync({data:ci,path:[],parent:pi}).then(gi=>C$2(gi)?{value:gi.value}:{issues:pi.common.issues})}async parseAsync(ci,hi){const _i=await this.safeParseAsync(ci,hi);if(_i.success)return _i.data;throw _i.error}async safeParseAsync(ci,hi){const _i={common:{issues:[],contextualErrorMap:hi==null?void 0:hi.errorMap,async:!0},path:(hi==null?void 0:hi.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:ci,parsedType:p$1(ci)},pi=this._parse({data:ci,path:_i.path,parent:_i}),gi=await(S(pi)?pi:Promise.resolve(pi));return P$2(_i,gi)}refine(ci,hi){const _i=pi=>typeof hi=="string"||hi===void 0?{message:hi}:typeof hi=="function"?hi(pi):hi;return this._refinement((pi,gi)=>{const mi=ci(pi),xi=()=>gi.addIssue({code:f$1.custom,..._i(pi)});return typeof Promise<"u"&&mi instanceof Promise?mi.then(yi=>!!yi||(xi(),!1)):!!mi||(xi(),!1)})}refinement(ci,hi){return this._refinement((_i,pi)=>!!ci(_i)||(pi.addIssue(typeof hi=="function"?hi(_i,pi):hi),!1))}_refinement(ci){return new Re({schema:this,typeName:Ye.ZodEffects,effect:{type:"refinement",refinement:ci}})}superRefine(ci){return this._refinement(ci)}constructor(ci){this.spa=this.safeParseAsync,this._def=ci,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:hi=>this["~validate"](hi)}}optional(){return $e.create(this,this._def)}nullable(){return Fe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _e.create(this)}promise(){return Me.create(this,this._def)}or(ci){return ke.create([this,ci],this._def)}and(ci){return Ze.create(this,ci,this._def)}transform(ci){return new Re({...M$1(this._def),schema:this,typeName:Ye.ZodEffects,effect:{type:"transform",transform:ci}})}default(ci){const hi=typeof ci=="function"?ci:()=>ci;return new ze({...M$1(this._def),innerType:this,defaultValue:hi,typeName:Ye.ZodDefault})}brand(){return new Ue({typeName:Ye.ZodBranded,type:this,...M$1(this._def)})}catch(ci){const hi=typeof ci=="function"?ci:()=>ci;return new De({...M$1(this._def),innerType:this,catchValue:hi,typeName:Ye.ZodCatch})}describe(ci){return new this.constructor({...this._def,description:ci})}pipe(ci){return Ge.create(this,ci)}readonly(){return We.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const $$1=/^c[^\s-]{8,}$/i,F$2=/^[0-9a-z]+$/,z$2=/^[0-9A-HJKMNP-TV-Z]{26}$/i,D$2=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,B$2=/^[a-z0-9_-]{21}$/i,V$1=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,U$1=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,G$1=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let W$1;const K$1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,H$1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Y$1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,X$1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,q$2=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,J$1=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Q$1="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ee=new RegExp(`^${Q$1}$`);function te(fi){let ci="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return fi.precision?ci=`${ci}\\.\\d{${fi.precision}}`:fi.precision==null&&(ci=`${ci}(\\.\\d+)?`),ci}function ie(fi){let ci=`${Q$1}T${te(fi)}`;const hi=[];return hi.push(fi.local?"Z?":"Z"),fi.offset&&hi.push("([+-]\\d{2}:?\\d{2})"),ci=`${ci}(${hi.join("|")})`,new RegExp(`^${ci}$`)}function se(fi,ci){if(!V$1.test(fi))return!1;try{const[hi]=fi.split("."),_i=hi.replace(/-/g,"+").replace(/_/g,"/").padEnd(hi.length+(4-hi.length%4)%4,"="),pi=JSON.parse(atob(_i));return typeof pi=="object"&&pi!==null&&!(!pi.typ||!pi.alg)&&(!ci||pi.alg===ci)}catch{return!1}}function re(fi,ci){return!(ci!=="v4"&&ci||!H$1.test(fi))||!(ci!=="v6"&&ci||!X$1.test(fi))}class ae extends R$1{_parse(ci){if(this._def.coerce&&(ci.data=String(ci.data)),this._getType(ci)!==h$1.string){const mi=this._getOrReturnCtx(ci);return b(mi,{code:f$1.invalid_type,expected:h$1.string,received:mi.parsedType}),x$2}const hi=new k$2;let _i;for(const mi of this._def.checks)if(mi.kind==="min")ci.data.length<mi.value&&(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.too_small,minimum:mi.value,type:"string",inclusive:!0,exact:!1,message:mi.message}),hi.dirty());else if(mi.kind==="max")ci.data.length>mi.value&&(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.too_big,maximum:mi.value,type:"string",inclusive:!0,exact:!1,message:mi.message}),hi.dirty());else if(mi.kind==="length"){const xi=ci.data.length>mi.value,yi=ci.data.length<mi.value;(xi||yi)&&(_i=this._getOrReturnCtx(ci,_i),xi?b(_i,{code:f$1.too_big,maximum:mi.value,type:"string",inclusive:!0,exact:!0,message:mi.message}):yi&&b(_i,{code:f$1.too_small,minimum:mi.value,type:"string",inclusive:!0,exact:!0,message:mi.message}),hi.dirty())}else if(mi.kind==="email")G$1.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"email",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="emoji")W$1||(W$1=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),W$1.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"emoji",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="uuid")D$2.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"uuid",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="nanoid")B$2.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"nanoid",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="cuid")$$1.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"cuid",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="cuid2")F$2.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"cuid2",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="ulid")z$2.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"ulid",code:f$1.invalid_string,message:mi.message}),hi.dirty());else if(mi.kind==="url")try{new URL(ci.data)}catch{_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"url",code:f$1.invalid_string,message:mi.message}),hi.dirty()}else mi.kind==="regex"?(mi.regex.lastIndex=0,mi.regex.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"regex",code:f$1.invalid_string,message:mi.message}),hi.dirty())):mi.kind==="trim"?ci.data=ci.data.trim():mi.kind==="includes"?ci.data.includes(mi.value,mi.position)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:{includes:mi.value,position:mi.position},message:mi.message}),hi.dirty()):mi.kind==="toLowerCase"?ci.data=ci.data.toLowerCase():mi.kind==="toUpperCase"?ci.data=ci.data.toUpperCase():mi.kind==="startsWith"?ci.data.startsWith(mi.value)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:{startsWith:mi.value},message:mi.message}),hi.dirty()):mi.kind==="endsWith"?ci.data.endsWith(mi.value)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:{endsWith:mi.value},message:mi.message}),hi.dirty()):mi.kind==="datetime"?ie(mi).test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:"datetime",message:mi.message}),hi.dirty()):mi.kind==="date"?ee.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:"date",message:mi.message}),hi.dirty()):mi.kind==="time"?new RegExp(`^${te(mi)}$`).test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.invalid_string,validation:"time",message:mi.message}),hi.dirty()):mi.kind==="duration"?U$1.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"duration",code:f$1.invalid_string,message:mi.message}),hi.dirty()):mi.kind==="ip"?(pi=ci.data,((gi=mi.version)!=="v4"&&gi||!K$1.test(pi))&&(gi!=="v6"&&gi||!Y$1.test(pi))&&(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"ip",code:f$1.invalid_string,message:mi.message}),hi.dirty())):mi.kind==="jwt"?se(ci.data,mi.alg)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"jwt",code:f$1.invalid_string,message:mi.message}),hi.dirty()):mi.kind==="cidr"?re(ci.data,mi.version)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"cidr",code:f$1.invalid_string,message:mi.message}),hi.dirty()):mi.kind==="base64"?q$2.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"base64",code:f$1.invalid_string,message:mi.message}),hi.dirty()):mi.kind==="base64url"?J$1.test(ci.data)||(_i=this._getOrReturnCtx(ci,_i),b(_i,{validation:"base64url",code:f$1.invalid_string,message:mi.message}),hi.dirty()):u$1.assertNever(mi);var pi,gi;return{status:hi.value,value:ci.data}}_regex(ci,hi,_i){return this.refinement(pi=>ci.test(pi),{validation:hi,code:f$1.invalid_string,...j$2.errToObj(_i)})}_addCheck(ci){return new ae({...this._def,checks:[...this._def.checks,ci]})}email(ci){return this._addCheck({kind:"email",...j$2.errToObj(ci)})}url(ci){return this._addCheck({kind:"url",...j$2.errToObj(ci)})}emoji(ci){return this._addCheck({kind:"emoji",...j$2.errToObj(ci)})}uuid(ci){return this._addCheck({kind:"uuid",...j$2.errToObj(ci)})}nanoid(ci){return this._addCheck({kind:"nanoid",...j$2.errToObj(ci)})}cuid(ci){return this._addCheck({kind:"cuid",...j$2.errToObj(ci)})}cuid2(ci){return this._addCheck({kind:"cuid2",...j$2.errToObj(ci)})}ulid(ci){return this._addCheck({kind:"ulid",...j$2.errToObj(ci)})}base64(ci){return this._addCheck({kind:"base64",...j$2.errToObj(ci)})}base64url(ci){return this._addCheck({kind:"base64url",...j$2.errToObj(ci)})}jwt(ci){return this._addCheck({kind:"jwt",...j$2.errToObj(ci)})}ip(ci){return this._addCheck({kind:"ip",...j$2.errToObj(ci)})}cidr(ci){return this._addCheck({kind:"cidr",...j$2.errToObj(ci)})}datetime(ci){var hi,_i;return typeof ci=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:ci}):this._addCheck({kind:"datetime",precision:(ci==null?void 0:ci.precision)===void 0?null:ci==null?void 0:ci.precision,offset:(hi=ci==null?void 0:ci.offset)!==null&&hi!==void 0&&hi,local:(_i=ci==null?void 0:ci.local)!==null&&_i!==void 0&&_i,...j$2.errToObj(ci==null?void 0:ci.message)})}date(ci){return this._addCheck({kind:"date",message:ci})}time(ci){return typeof ci=="string"?this._addCheck({kind:"time",precision:null,message:ci}):this._addCheck({kind:"time",precision:(ci==null?void 0:ci.precision)===void 0?null:ci==null?void 0:ci.precision,...j$2.errToObj(ci==null?void 0:ci.message)})}duration(ci){return this._addCheck({kind:"duration",...j$2.errToObj(ci)})}regex(ci,hi){return this._addCheck({kind:"regex",regex:ci,...j$2.errToObj(hi)})}includes(ci,hi){return this._addCheck({kind:"includes",value:ci,position:hi==null?void 0:hi.position,...j$2.errToObj(hi==null?void 0:hi.message)})}startsWith(ci,hi){return this._addCheck({kind:"startsWith",value:ci,...j$2.errToObj(hi)})}endsWith(ci,hi){return this._addCheck({kind:"endsWith",value:ci,...j$2.errToObj(hi)})}min(ci,hi){return this._addCheck({kind:"min",value:ci,...j$2.errToObj(hi)})}max(ci,hi){return this._addCheck({kind:"max",value:ci,...j$2.errToObj(hi)})}length(ci,hi){return this._addCheck({kind:"length",value:ci,...j$2.errToObj(hi)})}nonempty(ci){return this.min(1,j$2.errToObj(ci))}trim(){return new ae({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ae({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ae({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(ci=>ci.kind==="datetime")}get isDate(){return!!this._def.checks.find(ci=>ci.kind==="date")}get isTime(){return!!this._def.checks.find(ci=>ci.kind==="time")}get isDuration(){return!!this._def.checks.find(ci=>ci.kind==="duration")}get isEmail(){return!!this._def.checks.find(ci=>ci.kind==="email")}get isURL(){return!!this._def.checks.find(ci=>ci.kind==="url")}get isEmoji(){return!!this._def.checks.find(ci=>ci.kind==="emoji")}get isUUID(){return!!this._def.checks.find(ci=>ci.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(ci=>ci.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(ci=>ci.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(ci=>ci.kind==="cuid2")}get isULID(){return!!this._def.checks.find(ci=>ci.kind==="ulid")}get isIP(){return!!this._def.checks.find(ci=>ci.kind==="ip")}get isCIDR(){return!!this._def.checks.find(ci=>ci.kind==="cidr")}get isBase64(){return!!this._def.checks.find(ci=>ci.kind==="base64")}get isBase64url(){return!!this._def.checks.find(ci=>ci.kind==="base64url")}get minLength(){let ci=null;for(const hi of this._def.checks)hi.kind==="min"&&(ci===null||hi.value>ci)&&(ci=hi.value);return ci}get maxLength(){let ci=null;for(const hi of this._def.checks)hi.kind==="max"&&(ci===null||hi.value<ci)&&(ci=hi.value);return ci}}function ne(fi,ci){const hi=(fi.toString().split(".")[1]||"").length,_i=(ci.toString().split(".")[1]||"").length,pi=hi>_i?hi:_i;return parseInt(fi.toFixed(pi).replace(".",""))%parseInt(ci.toFixed(pi).replace(".",""))/Math.pow(10,pi)}ae.create=fi=>{var ci;return new ae({checks:[],typeName:Ye.ZodString,coerce:(ci=fi==null?void 0:fi.coerce)!==null&&ci!==void 0&&ci,...M$1(fi)})};class oe extends R$1{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(ci){if(this._def.coerce&&(ci.data=Number(ci.data)),this._getType(ci)!==h$1.number){const pi=this._getOrReturnCtx(ci);return b(pi,{code:f$1.invalid_type,expected:h$1.number,received:pi.parsedType}),x$2}let hi;const _i=new k$2;for(const pi of this._def.checks)pi.kind==="int"?u$1.isInteger(ci.data)||(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.invalid_type,expected:"integer",received:"float",message:pi.message}),_i.dirty()):pi.kind==="min"?(pi.inclusive?ci.data<pi.value:ci.data<=pi.value)&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.too_small,minimum:pi.value,type:"number",inclusive:pi.inclusive,exact:!1,message:pi.message}),_i.dirty()):pi.kind==="max"?(pi.inclusive?ci.data>pi.value:ci.data>=pi.value)&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.too_big,maximum:pi.value,type:"number",inclusive:pi.inclusive,exact:!1,message:pi.message}),_i.dirty()):pi.kind==="multipleOf"?ne(ci.data,pi.value)!==0&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.not_multiple_of,multipleOf:pi.value,message:pi.message}),_i.dirty()):pi.kind==="finite"?Number.isFinite(ci.data)||(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.not_finite,message:pi.message}),_i.dirty()):u$1.assertNever(pi);return{status:_i.value,value:ci.data}}gte(ci,hi){return this.setLimit("min",ci,!0,j$2.toString(hi))}gt(ci,hi){return this.setLimit("min",ci,!1,j$2.toString(hi))}lte(ci,hi){return this.setLimit("max",ci,!0,j$2.toString(hi))}lt(ci,hi){return this.setLimit("max",ci,!1,j$2.toString(hi))}setLimit(ci,hi,_i,pi){return new oe({...this._def,checks:[...this._def.checks,{kind:ci,value:hi,inclusive:_i,message:j$2.toString(pi)}]})}_addCheck(ci){return new oe({...this._def,checks:[...this._def.checks,ci]})}int(ci){return this._addCheck({kind:"int",message:j$2.toString(ci)})}positive(ci){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j$2.toString(ci)})}negative(ci){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j$2.toString(ci)})}nonpositive(ci){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j$2.toString(ci)})}nonnegative(ci){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j$2.toString(ci)})}multipleOf(ci,hi){return this._addCheck({kind:"multipleOf",value:ci,message:j$2.toString(hi)})}finite(ci){return this._addCheck({kind:"finite",message:j$2.toString(ci)})}safe(ci){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j$2.toString(ci)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j$2.toString(ci)})}get minValue(){let ci=null;for(const hi of this._def.checks)hi.kind==="min"&&(ci===null||hi.value>ci)&&(ci=hi.value);return ci}get maxValue(){let ci=null;for(const hi of this._def.checks)hi.kind==="max"&&(ci===null||hi.value<ci)&&(ci=hi.value);return ci}get isInt(){return!!this._def.checks.find(ci=>ci.kind==="int"||ci.kind==="multipleOf"&&u$1.isInteger(ci.value))}get isFinite(){let ci=null,hi=null;for(const _i of this._def.checks){if(_i.kind==="finite"||_i.kind==="int"||_i.kind==="multipleOf")return!0;_i.kind==="min"?(hi===null||_i.value>hi)&&(hi=_i.value):_i.kind==="max"&&(ci===null||_i.value<ci)&&(ci=_i.value)}return Number.isFinite(hi)&&Number.isFinite(ci)}}oe.create=fi=>new oe({checks:[],typeName:Ye.ZodNumber,coerce:(fi==null?void 0:fi.coerce)||!1,...M$1(fi)});class de extends R$1{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(ci){if(this._def.coerce)try{ci.data=BigInt(ci.data)}catch{return this._getInvalidInput(ci)}if(this._getType(ci)!==h$1.bigint)return this._getInvalidInput(ci);let hi;const _i=new k$2;for(const pi of this._def.checks)pi.kind==="min"?(pi.inclusive?ci.data<pi.value:ci.data<=pi.value)&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.too_small,type:"bigint",minimum:pi.value,inclusive:pi.inclusive,message:pi.message}),_i.dirty()):pi.kind==="max"?(pi.inclusive?ci.data>pi.value:ci.data>=pi.value)&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.too_big,type:"bigint",maximum:pi.value,inclusive:pi.inclusive,message:pi.message}),_i.dirty()):pi.kind==="multipleOf"?ci.data%pi.value!==BigInt(0)&&(hi=this._getOrReturnCtx(ci,hi),b(hi,{code:f$1.not_multiple_of,multipleOf:pi.value,message:pi.message}),_i.dirty()):u$1.assertNever(pi);return{status:_i.value,value:ci.data}}_getInvalidInput(ci){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.bigint,received:hi.parsedType}),x$2}gte(ci,hi){return this.setLimit("min",ci,!0,j$2.toString(hi))}gt(ci,hi){return this.setLimit("min",ci,!1,j$2.toString(hi))}lte(ci,hi){return this.setLimit("max",ci,!0,j$2.toString(hi))}lt(ci,hi){return this.setLimit("max",ci,!1,j$2.toString(hi))}setLimit(ci,hi,_i,pi){return new de({...this._def,checks:[...this._def.checks,{kind:ci,value:hi,inclusive:_i,message:j$2.toString(pi)}]})}_addCheck(ci){return new de({...this._def,checks:[...this._def.checks,ci]})}positive(ci){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j$2.toString(ci)})}negative(ci){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j$2.toString(ci)})}nonpositive(ci){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j$2.toString(ci)})}nonnegative(ci){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j$2.toString(ci)})}multipleOf(ci,hi){return this._addCheck({kind:"multipleOf",value:ci,message:j$2.toString(hi)})}get minValue(){let ci=null;for(const hi of this._def.checks)hi.kind==="min"&&(ci===null||hi.value>ci)&&(ci=hi.value);return ci}get maxValue(){let ci=null;for(const hi of this._def.checks)hi.kind==="max"&&(ci===null||hi.value<ci)&&(ci=hi.value);return ci}}de.create=fi=>{var ci;return new de({checks:[],typeName:Ye.ZodBigInt,coerce:(ci=fi==null?void 0:fi.coerce)!==null&&ci!==void 0&&ci,...M$1(fi)})};class le extends R$1{_parse(ci){if(this._def.coerce&&(ci.data=!!ci.data),this._getType(ci)!==h$1.boolean){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.boolean,received:hi.parsedType}),x$2}return T$2(ci.data)}}le.create=fi=>new le({typeName:Ye.ZodBoolean,coerce:(fi==null?void 0:fi.coerce)||!1,...M$1(fi)});class ue extends R$1{_parse(ci){if(this._def.coerce&&(ci.data=new Date(ci.data)),this._getType(ci)!==h$1.date){const pi=this._getOrReturnCtx(ci);return b(pi,{code:f$1.invalid_type,expected:h$1.date,received:pi.parsedType}),x$2}if(isNaN(ci.data.getTime()))return b(this._getOrReturnCtx(ci),{code:f$1.invalid_date}),x$2;const hi=new k$2;let _i;for(const pi of this._def.checks)pi.kind==="min"?ci.data.getTime()<pi.value&&(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.too_small,message:pi.message,inclusive:!0,exact:!1,minimum:pi.value,type:"date"}),hi.dirty()):pi.kind==="max"?ci.data.getTime()>pi.value&&(_i=this._getOrReturnCtx(ci,_i),b(_i,{code:f$1.too_big,message:pi.message,inclusive:!0,exact:!1,maximum:pi.value,type:"date"}),hi.dirty()):u$1.assertNever(pi);return{status:hi.value,value:new Date(ci.data.getTime())}}_addCheck(ci){return new ue({...this._def,checks:[...this._def.checks,ci]})}min(ci,hi){return this._addCheck({kind:"min",value:ci.getTime(),message:j$2.toString(hi)})}max(ci,hi){return this._addCheck({kind:"max",value:ci.getTime(),message:j$2.toString(hi)})}get minDate(){let ci=null;for(const hi of this._def.checks)hi.kind==="min"&&(ci===null||hi.value>ci)&&(ci=hi.value);return ci!=null?new Date(ci):null}get maxDate(){let ci=null;for(const hi of this._def.checks)hi.kind==="max"&&(ci===null||hi.value<ci)&&(ci=hi.value);return ci!=null?new Date(ci):null}}ue.create=fi=>new ue({checks:[],coerce:(fi==null?void 0:fi.coerce)||!1,typeName:Ye.ZodDate,...M$1(fi)});class ce extends R$1{_parse(ci){if(this._getType(ci)!==h$1.symbol){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.symbol,received:hi.parsedType}),x$2}return T$2(ci.data)}}ce.create=fi=>new ce({typeName:Ye.ZodSymbol,...M$1(fi)});class he extends R$1{_parse(ci){if(this._getType(ci)!==h$1.undefined){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.undefined,received:hi.parsedType}),x$2}return T$2(ci.data)}}he.create=fi=>new he({typeName:Ye.ZodUndefined,...M$1(fi)});class pe extends R$1{_parse(ci){if(this._getType(ci)!==h$1.null){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.null,received:hi.parsedType}),x$2}return T$2(ci.data)}}pe.create=fi=>new pe({typeName:Ye.ZodNull,...M$1(fi)});class fe extends R$1{constructor(){super(...arguments),this._any=!0}_parse(ci){return T$2(ci.data)}}fe.create=fi=>new fe({typeName:Ye.ZodAny,...M$1(fi)});class me extends R$1{constructor(){super(...arguments),this._unknown=!0}_parse(ci){return T$2(ci.data)}}me.create=fi=>new me({typeName:Ye.ZodUnknown,...M$1(fi)});class ye extends R$1{_parse(ci){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.never,received:hi.parsedType}),x$2}}ye.create=fi=>new ye({typeName:Ye.ZodNever,...M$1(fi)});class ge extends R$1{_parse(ci){if(this._getType(ci)!==h$1.undefined){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.void,received:hi.parsedType}),x$2}return T$2(ci.data)}}ge.create=fi=>new ge({typeName:Ye.ZodVoid,...M$1(fi)});class _e extends R$1{_parse(ci){const{ctx:hi,status:_i}=this._processInputParams(ci),pi=this._def;if(hi.parsedType!==h$1.array)return b(hi,{code:f$1.invalid_type,expected:h$1.array,received:hi.parsedType}),x$2;if(pi.exactLength!==null){const mi=hi.data.length>pi.exactLength.value,xi=hi.data.length<pi.exactLength.value;(mi||xi)&&(b(hi,{code:mi?f$1.too_big:f$1.too_small,minimum:xi?pi.exactLength.value:void 0,maximum:mi?pi.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:pi.exactLength.message}),_i.dirty())}if(pi.minLength!==null&&hi.data.length<pi.minLength.value&&(b(hi,{code:f$1.too_small,minimum:pi.minLength.value,type:"array",inclusive:!0,exact:!1,message:pi.minLength.message}),_i.dirty()),pi.maxLength!==null&&hi.data.length>pi.maxLength.value&&(b(hi,{code:f$1.too_big,maximum:pi.maxLength.value,type:"array",inclusive:!0,exact:!1,message:pi.maxLength.message}),_i.dirty()),hi.common.async)return Promise.all([...hi.data].map((mi,xi)=>pi.type._parseAsync(new N$1(hi,mi,hi.path,xi)))).then(mi=>k$2.mergeArray(_i,mi));const gi=[...hi.data].map((mi,xi)=>pi.type._parseSync(new N$1(hi,mi,hi.path,xi)));return k$2.mergeArray(_i,gi)}get element(){return this._def.type}min(ci,hi){return new _e({...this._def,minLength:{value:ci,message:j$2.toString(hi)}})}max(ci,hi){return new _e({...this._def,maxLength:{value:ci,message:j$2.toString(hi)}})}length(ci,hi){return new _e({...this._def,exactLength:{value:ci,message:j$2.toString(hi)}})}nonempty(ci){return this.min(1,ci)}}function ve(fi){if(fi instanceof be){const ci={};for(const hi in fi.shape){const _i=fi.shape[hi];ci[hi]=$e.create(ve(_i))}return new be({...fi._def,shape:()=>ci})}return fi instanceof _e?new _e({...fi._def,type:ve(fi.element)}):fi instanceof $e?$e.create(ve(fi.unwrap())):fi instanceof Fe?Fe.create(ve(fi.unwrap())):fi instanceof Le?Le.create(fi.items.map(ci=>ve(ci))):fi}_e.create=(fi,ci)=>new _e({type:fi,minLength:null,maxLength:null,exactLength:null,typeName:Ye.ZodArray,...M$1(ci)});class be extends R$1{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const ci=this._def.shape(),hi=u$1.objectKeys(ci);return this._cached={shape:ci,keys:hi}}_parse(ci){if(this._getType(ci)!==h$1.object){const yi=this._getOrReturnCtx(ci);return b(yi,{code:f$1.invalid_type,expected:h$1.object,received:yi.parsedType}),x$2}const{status:hi,ctx:_i}=this._processInputParams(ci),{shape:pi,keys:gi}=this._getCached(),mi=[];if(!(this._def.catchall instanceof ye&&this._def.unknownKeys==="strip"))for(const yi in _i.data)gi.includes(yi)||mi.push(yi);const xi=[];for(const yi of gi){const Ci=pi[yi],Ei=_i.data[yi];xi.push({key:{status:"valid",value:yi},value:Ci._parse(new N$1(_i,Ei,_i.path,yi)),alwaysSet:yi in _i.data})}if(this._def.catchall instanceof ye){const yi=this._def.unknownKeys;if(yi==="passthrough")for(const Ci of mi)xi.push({key:{status:"valid",value:Ci},value:{status:"valid",value:_i.data[Ci]}});else if(yi==="strict")mi.length>0&&(b(_i,{code:f$1.unrecognized_keys,keys:mi}),hi.dirty());else if(yi!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const yi=this._def.catchall;for(const Ci of mi){const Ei=_i.data[Ci];xi.push({key:{status:"valid",value:Ci},value:yi._parse(new N$1(_i,Ei,_i.path,Ci)),alwaysSet:Ci in _i.data})}}return _i.common.async?Promise.resolve().then(async()=>{const yi=[];for(const Ci of xi){const Ei=await Ci.key,Ai=await Ci.value;yi.push({key:Ei,value:Ai,alwaysSet:Ci.alwaysSet})}return yi}).then(yi=>k$2.mergeObjectSync(hi,yi)):k$2.mergeObjectSync(hi,xi)}get shape(){return this._def.shape()}strict(ci){return j$2.errToObj,new be({...this._def,unknownKeys:"strict",...ci!==void 0?{errorMap:(hi,_i)=>{var pi,gi,mi,xi;const yi=(mi=(gi=(pi=this._def).errorMap)===null||gi===void 0?void 0:gi.call(pi,hi,_i).message)!==null&&mi!==void 0?mi:_i.defaultError;return hi.code==="unrecognized_keys"?{message:(xi=j$2.errToObj(ci).message)!==null&&xi!==void 0?xi:yi}:{message:yi}}}:{}})}strip(){return new be({...this._def,unknownKeys:"strip"})}passthrough(){return new be({...this._def,unknownKeys:"passthrough"})}extend(ci){return new be({...this._def,shape:()=>({...this._def.shape(),...ci})})}merge(ci){return new be({unknownKeys:ci._def.unknownKeys,catchall:ci._def.catchall,shape:()=>({...this._def.shape(),...ci._def.shape()}),typeName:Ye.ZodObject})}setKey(ci,hi){return this.augment({[ci]:hi})}catchall(ci){return new be({...this._def,catchall:ci})}pick(ci){const hi={};return u$1.objectKeys(ci).forEach(_i=>{ci[_i]&&this.shape[_i]&&(hi[_i]=this.shape[_i])}),new be({...this._def,shape:()=>hi})}omit(ci){const hi={};return u$1.objectKeys(this.shape).forEach(_i=>{ci[_i]||(hi[_i]=this.shape[_i])}),new be({...this._def,shape:()=>hi})}deepPartial(){return ve(this)}partial(ci){const hi={};return u$1.objectKeys(this.shape).forEach(_i=>{const pi=this.shape[_i];ci&&!ci[_i]?hi[_i]=pi:hi[_i]=pi.optional()}),new be({...this._def,shape:()=>hi})}required(ci){const hi={};return u$1.objectKeys(this.shape).forEach(_i=>{if(ci&&!ci[_i])hi[_i]=this.shape[_i];else{let pi=this.shape[_i];for(;pi instanceof $e;)pi=pi._def.innerType;hi[_i]=pi}}),new be({...this._def,shape:()=>hi})}keyof(){return Ae(u$1.objectKeys(this.shape))}}be.create=(fi,ci)=>new be({shape:()=>fi,unknownKeys:"strip",catchall:ye.create(),typeName:Ye.ZodObject,...M$1(ci)}),be.strictCreate=(fi,ci)=>new be({shape:()=>fi,unknownKeys:"strict",catchall:ye.create(),typeName:Ye.ZodObject,...M$1(ci)}),be.lazycreate=(fi,ci)=>new be({shape:fi,unknownKeys:"strip",catchall:ye.create(),typeName:Ye.ZodObject,...M$1(ci)});class ke extends R$1{_parse(ci){const{ctx:hi}=this._processInputParams(ci),_i=this._def.options;if(hi.common.async)return Promise.all(_i.map(async pi=>{const gi={...hi,common:{...hi.common,issues:[]},parent:null};return{result:await pi._parseAsync({data:hi.data,path:hi.path,parent:gi}),ctx:gi}})).then(function(pi){for(const mi of pi)if(mi.result.status==="valid")return mi.result;for(const mi of pi)if(mi.result.status==="dirty")return hi.common.issues.push(...mi.ctx.common.issues),mi.result;const gi=pi.map(mi=>new m$1(mi.ctx.common.issues));return b(hi,{code:f$1.invalid_union,unionErrors:gi}),x$2});{let pi;const gi=[];for(const xi of _i){const yi={...hi,common:{...hi.common,issues:[]},parent:null},Ci=xi._parseSync({data:hi.data,path:hi.path,parent:yi});if(Ci.status==="valid")return Ci;Ci.status!=="dirty"||pi||(pi={result:Ci,ctx:yi}),yi.common.issues.length&&gi.push(yi.common.issues)}if(pi)return hi.common.issues.push(...pi.ctx.common.issues),pi.result;const mi=gi.map(xi=>new m$1(xi));return b(hi,{code:f$1.invalid_union,unionErrors:mi}),x$2}}get options(){return this._def.options}}ke.create=(fi,ci)=>new ke({options:fi,typeName:Ye.ZodUnion,...M$1(ci)});const xe=fi=>fi instanceof je?xe(fi.schema):fi instanceof Re?xe(fi.innerType()):fi instanceof Ie?[fi.value]:fi instanceof Ne?fi.options:fi instanceof Pe?u$1.objectValues(fi.enum):fi instanceof ze?xe(fi._def.innerType):fi instanceof he?[void 0]:fi instanceof pe?[null]:fi instanceof $e?[void 0,...xe(fi.unwrap())]:fi instanceof Fe?[null,...xe(fi.unwrap())]:fi instanceof Ue||fi instanceof We?xe(fi.unwrap()):fi instanceof De?xe(fi._def.innerType):[];class we extends R$1{_parse(ci){const{ctx:hi}=this._processInputParams(ci);if(hi.parsedType!==h$1.object)return b(hi,{code:f$1.invalid_type,expected:h$1.object,received:hi.parsedType}),x$2;const _i=this.discriminator,pi=hi.data[_i],gi=this.optionsMap.get(pi);return gi?hi.common.async?gi._parseAsync({data:hi.data,path:hi.path,parent:hi}):gi._parseSync({data:hi.data,path:hi.path,parent:hi}):(b(hi,{code:f$1.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[_i]}),x$2)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(ci,hi,_i){const pi=new Map;for(const gi of hi){const mi=xe(gi.shape[ci]);if(!mi.length)throw new Error(`A discriminator value for key \`${ci}\` could not be extracted from all schema options`);for(const xi of mi){if(pi.has(xi))throw new Error(`Discriminator property ${String(ci)} has duplicate value ${String(xi)}`);pi.set(xi,gi)}}return new we({typeName:Ye.ZodDiscriminatedUnion,discriminator:ci,options:hi,optionsMap:pi,...M$1(_i)})}}function Te(fi,ci){const hi=p$1(fi),_i=p$1(ci);if(fi===ci)return{valid:!0,data:fi};if(hi===h$1.object&&_i===h$1.object){const pi=u$1.objectKeys(ci),gi=u$1.objectKeys(fi).filter(xi=>pi.indexOf(xi)!==-1),mi={...fi,...ci};for(const xi of gi){const yi=Te(fi[xi],ci[xi]);if(!yi.valid)return{valid:!1};mi[xi]=yi.data}return{valid:!0,data:mi}}if(hi===h$1.array&&_i===h$1.array){if(fi.length!==ci.length)return{valid:!1};const pi=[];for(let gi=0;gi<fi.length;gi++){const mi=Te(fi[gi],ci[gi]);if(!mi.valid)return{valid:!1};pi.push(mi.data)}return{valid:!0,data:pi}}return hi===h$1.date&&_i===h$1.date&&+fi==+ci?{valid:!0,data:fi}:{valid:!1}}class Ze extends R$1{_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci),pi=(gi,mi)=>{if(Z$1(gi)||Z$1(mi))return x$2;const xi=Te(gi.value,mi.value);return xi.valid?((L$1(gi)||L$1(mi))&&hi.dirty(),{status:hi.value,value:xi.data}):(b(_i,{code:f$1.invalid_intersection_types}),x$2)};return _i.common.async?Promise.all([this._def.left._parseAsync({data:_i.data,path:_i.path,parent:_i}),this._def.right._parseAsync({data:_i.data,path:_i.path,parent:_i})]).then(([gi,mi])=>pi(gi,mi)):pi(this._def.left._parseSync({data:_i.data,path:_i.path,parent:_i}),this._def.right._parseSync({data:_i.data,path:_i.path,parent:_i}))}}Ze.create=(fi,ci,hi)=>new Ze({left:fi,right:ci,typeName:Ye.ZodIntersection,...M$1(hi)});class Le extends R$1{_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci);if(_i.parsedType!==h$1.array)return b(_i,{code:f$1.invalid_type,expected:h$1.array,received:_i.parsedType}),x$2;if(_i.data.length<this._def.items.length)return b(_i,{code:f$1.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),x$2;!this._def.rest&&_i.data.length>this._def.items.length&&(b(_i,{code:f$1.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),hi.dirty());const pi=[..._i.data].map((gi,mi)=>{const xi=this._def.items[mi]||this._def.rest;return xi?xi._parse(new N$1(_i,gi,_i.path,mi)):null}).filter(gi=>!!gi);return _i.common.async?Promise.all(pi).then(gi=>k$2.mergeArray(hi,gi)):k$2.mergeArray(hi,pi)}get items(){return this._def.items}rest(ci){return new Le({...this._def,rest:ci})}}Le.create=(fi,ci)=>{if(!Array.isArray(fi))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Le({items:fi,typeName:Ye.ZodTuple,rest:null,...M$1(ci)})};class Ce extends R$1{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci);if(_i.parsedType!==h$1.object)return b(_i,{code:f$1.invalid_type,expected:h$1.object,received:_i.parsedType}),x$2;const pi=[],gi=this._def.keyType,mi=this._def.valueType;for(const xi in _i.data)pi.push({key:gi._parse(new N$1(_i,xi,_i.path,xi)),value:mi._parse(new N$1(_i,_i.data[xi],_i.path,xi)),alwaysSet:xi in _i.data});return _i.common.async?k$2.mergeObjectAsync(hi,pi):k$2.mergeObjectSync(hi,pi)}get element(){return this._def.valueType}static create(ci,hi,_i){return new Ce(hi instanceof R$1?{keyType:ci,valueType:hi,typeName:Ye.ZodRecord,...M$1(_i)}:{keyType:ae.create(),valueType:ci,typeName:Ye.ZodRecord,...M$1(hi)})}}class Se extends R$1{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci);if(_i.parsedType!==h$1.map)return b(_i,{code:f$1.invalid_type,expected:h$1.map,received:_i.parsedType}),x$2;const pi=this._def.keyType,gi=this._def.valueType,mi=[..._i.data.entries()].map(([xi,yi],Ci)=>({key:pi._parse(new N$1(_i,xi,_i.path,[Ci,"key"])),value:gi._parse(new N$1(_i,yi,_i.path,[Ci,"value"]))}));if(_i.common.async){const xi=new Map;return Promise.resolve().then(async()=>{for(const yi of mi){const Ci=await yi.key,Ei=await yi.value;if(Ci.status==="aborted"||Ei.status==="aborted")return x$2;Ci.status!=="dirty"&&Ei.status!=="dirty"||hi.dirty(),xi.set(Ci.value,Ei.value)}return{status:hi.value,value:xi}})}{const xi=new Map;for(const yi of mi){const Ci=yi.key,Ei=yi.value;if(Ci.status==="aborted"||Ei.status==="aborted")return x$2;Ci.status!=="dirty"&&Ei.status!=="dirty"||hi.dirty(),xi.set(Ci.value,Ei.value)}return{status:hi.value,value:xi}}}}Se.create=(fi,ci,hi)=>new Se({valueType:ci,keyType:fi,typeName:Ye.ZodMap,...M$1(hi)});class Ee extends R$1{_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci);if(_i.parsedType!==h$1.set)return b(_i,{code:f$1.invalid_type,expected:h$1.set,received:_i.parsedType}),x$2;const pi=this._def;pi.minSize!==null&&_i.data.size<pi.minSize.value&&(b(_i,{code:f$1.too_small,minimum:pi.minSize.value,type:"set",inclusive:!0,exact:!1,message:pi.minSize.message}),hi.dirty()),pi.maxSize!==null&&_i.data.size>pi.maxSize.value&&(b(_i,{code:f$1.too_big,maximum:pi.maxSize.value,type:"set",inclusive:!0,exact:!1,message:pi.maxSize.message}),hi.dirty());const gi=this._def.valueType;function mi(yi){const Ci=new Set;for(const Ei of yi){if(Ei.status==="aborted")return x$2;Ei.status==="dirty"&&hi.dirty(),Ci.add(Ei.value)}return{status:hi.value,value:Ci}}const xi=[..._i.data.values()].map((yi,Ci)=>gi._parse(new N$1(_i,yi,_i.path,Ci)));return _i.common.async?Promise.all(xi).then(yi=>mi(yi)):mi(xi)}min(ci,hi){return new Ee({...this._def,minSize:{value:ci,message:j$2.toString(hi)}})}max(ci,hi){return new Ee({...this._def,maxSize:{value:ci,message:j$2.toString(hi)}})}size(ci,hi){return this.min(ci,hi).max(ci,hi)}nonempty(ci){return this.min(1,ci)}}Ee.create=(fi,ci)=>new Ee({valueType:fi,minSize:null,maxSize:null,typeName:Ye.ZodSet,...M$1(ci)});class Oe extends R$1{constructor(){super(...arguments),this.validate=this.implement}_parse(ci){const{ctx:hi}=this._processInputParams(ci);if(hi.parsedType!==h$1.function)return b(hi,{code:f$1.invalid_type,expected:h$1.function,received:hi.parsedType}),x$2;function _i(xi,yi){return v$1({data:xi,path:hi.path,errorMaps:[hi.common.contextualErrorMap,hi.schemaErrorMap,_$1(),y$1].filter(Ci=>!!Ci),issueData:{code:f$1.invalid_arguments,argumentsError:yi}})}function pi(xi,yi){return v$1({data:xi,path:hi.path,errorMaps:[hi.common.contextualErrorMap,hi.schemaErrorMap,_$1(),y$1].filter(Ci=>!!Ci),issueData:{code:f$1.invalid_return_type,returnTypeError:yi}})}const gi={errorMap:hi.common.contextualErrorMap},mi=hi.data;if(this._def.returns instanceof Me){const xi=this;return T$2(async function(...yi){const Ci=new m$1([]),Ei=await xi._def.args.parseAsync(yi,gi).catch(ki=>{throw Ci.addIssue(_i(yi,ki)),Ci}),Ai=await Reflect.apply(mi,this,Ei);return await xi._def.returns._def.type.parseAsync(Ai,gi).catch(ki=>{throw Ci.addIssue(pi(Ai,ki)),Ci})})}{const xi=this;return T$2(function(...yi){const Ci=xi._def.args.safeParse(yi,gi);if(!Ci.success)throw new m$1([_i(yi,Ci.error)]);const Ei=Reflect.apply(mi,this,Ci.data),Ai=xi._def.returns.safeParse(Ei,gi);if(!Ai.success)throw new m$1([pi(Ei,Ai.error)]);return Ai.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...ci){return new Oe({...this._def,args:Le.create(ci).rest(me.create())})}returns(ci){return new Oe({...this._def,returns:ci})}implement(ci){return this.parse(ci)}strictImplement(ci){return this.parse(ci)}static create(ci,hi,_i){return new Oe({args:ci||Le.create([]).rest(me.create()),returns:hi||me.create(),typeName:Ye.ZodFunction,...M$1(_i)})}}class je extends R$1{get schema(){return this._def.getter()}_parse(ci){const{ctx:hi}=this._processInputParams(ci);return this._def.getter()._parse({data:hi.data,path:hi.path,parent:hi})}}je.create=(fi,ci)=>new je({getter:fi,typeName:Ye.ZodLazy,...M$1(ci)});class Ie extends R$1{_parse(ci){if(ci.data!==this._def.value){const hi=this._getOrReturnCtx(ci);return b(hi,{received:hi.data,code:f$1.invalid_literal,expected:this._def.value}),x$2}return{status:"valid",value:ci.data}}get value(){return this._def.value}}function Ae(fi,ci){return new Ne({values:fi,typeName:Ye.ZodEnum,...M$1(ci)})}Ie.create=(fi,ci)=>new Ie({value:fi,typeName:Ye.ZodLiteral,...M$1(ci)});class Ne extends R$1{constructor(){super(...arguments),I$1.set(this,void 0)}_parse(ci){if(typeof ci.data!="string"){const hi=this._getOrReturnCtx(ci),_i=this._def.values;return b(hi,{expected:u$1.joinValues(_i),received:hi.parsedType,code:f$1.invalid_type}),x$2}if(E$1(this,I$1)||O$1(this,I$1,new Set(this._def.values)),!E$1(this,I$1).has(ci.data)){const hi=this._getOrReturnCtx(ci),_i=this._def.values;return b(hi,{received:hi.data,code:f$1.invalid_enum_value,options:_i}),x$2}return T$2(ci.data)}get options(){return this._def.values}get enum(){const ci={};for(const hi of this._def.values)ci[hi]=hi;return ci}get Values(){const ci={};for(const hi of this._def.values)ci[hi]=hi;return ci}get Enum(){const ci={};for(const hi of this._def.values)ci[hi]=hi;return ci}extract(ci,hi=this._def){return Ne.create(ci,{...this._def,...hi})}exclude(ci,hi=this._def){return Ne.create(this.options.filter(_i=>!ci.includes(_i)),{...this._def,...hi})}}I$1=new WeakMap,Ne.create=Ae;class Pe extends R$1{constructor(){super(...arguments),A$2.set(this,void 0)}_parse(ci){const hi=u$1.getValidEnumValues(this._def.values),_i=this._getOrReturnCtx(ci);if(_i.parsedType!==h$1.string&&_i.parsedType!==h$1.number){const pi=u$1.objectValues(hi);return b(_i,{expected:u$1.joinValues(pi),received:_i.parsedType,code:f$1.invalid_type}),x$2}if(E$1(this,A$2)||O$1(this,A$2,new Set(u$1.getValidEnumValues(this._def.values))),!E$1(this,A$2).has(ci.data)){const pi=u$1.objectValues(hi);return b(_i,{received:_i.data,code:f$1.invalid_enum_value,options:pi}),x$2}return T$2(ci.data)}get enum(){return this._def.values}}A$2=new WeakMap,Pe.create=(fi,ci)=>new Pe({values:fi,typeName:Ye.ZodNativeEnum,...M$1(ci)});class Me extends R$1{unwrap(){return this._def.type}_parse(ci){const{ctx:hi}=this._processInputParams(ci);if(hi.parsedType!==h$1.promise&&hi.common.async===!1)return b(hi,{code:f$1.invalid_type,expected:h$1.promise,received:hi.parsedType}),x$2;const _i=hi.parsedType===h$1.promise?hi.data:Promise.resolve(hi.data);return T$2(_i.then(pi=>this._def.type.parseAsync(pi,{path:hi.path,errorMap:hi.common.contextualErrorMap})))}}Me.create=(fi,ci)=>new Me({type:fi,typeName:Ye.ZodPromise,...M$1(ci)});class Re extends R$1{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ye.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci),pi=this._def.effect||null,gi={addIssue:mi=>{b(_i,mi),mi.fatal?hi.abort():hi.dirty()},get path(){return _i.path}};if(gi.addIssue=gi.addIssue.bind(gi),pi.type==="preprocess"){const mi=pi.transform(_i.data,gi);if(_i.common.async)return Promise.resolve(mi).then(async xi=>{if(hi.value==="aborted")return x$2;const yi=await this._def.schema._parseAsync({data:xi,path:_i.path,parent:_i});return yi.status==="aborted"?x$2:yi.status==="dirty"||hi.value==="dirty"?w$2(yi.value):yi});{if(hi.value==="aborted")return x$2;const xi=this._def.schema._parseSync({data:mi,path:_i.path,parent:_i});return xi.status==="aborted"?x$2:xi.status==="dirty"||hi.value==="dirty"?w$2(xi.value):xi}}if(pi.type==="refinement"){const mi=xi=>{const yi=pi.refinement(xi,gi);if(_i.common.async)return Promise.resolve(yi);if(yi instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return xi};if(_i.common.async===!1){const xi=this._def.schema._parseSync({data:_i.data,path:_i.path,parent:_i});return xi.status==="aborted"?x$2:(xi.status==="dirty"&&hi.dirty(),mi(xi.value),{status:hi.value,value:xi.value})}return this._def.schema._parseAsync({data:_i.data,path:_i.path,parent:_i}).then(xi=>xi.status==="aborted"?x$2:(xi.status==="dirty"&&hi.dirty(),mi(xi.value).then(()=>({status:hi.value,value:xi.value}))))}if(pi.type==="transform"){if(_i.common.async===!1){const mi=this._def.schema._parseSync({data:_i.data,path:_i.path,parent:_i});if(!C$2(mi))return mi;const xi=pi.transform(mi.value,gi);if(xi instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:hi.value,value:xi}}return this._def.schema._parseAsync({data:_i.data,path:_i.path,parent:_i}).then(mi=>C$2(mi)?Promise.resolve(pi.transform(mi.value,gi)).then(xi=>({status:hi.value,value:xi})):mi)}u$1.assertNever(pi)}}Re.create=(fi,ci,hi)=>new Re({schema:fi,typeName:Ye.ZodEffects,effect:ci,...M$1(hi)}),Re.createWithPreprocess=(fi,ci,hi)=>new Re({schema:ci,effect:{type:"preprocess",transform:fi},typeName:Ye.ZodEffects,...M$1(hi)});class $e extends R$1{_parse(ci){return this._getType(ci)===h$1.undefined?T$2(void 0):this._def.innerType._parse(ci)}unwrap(){return this._def.innerType}}$e.create=(fi,ci)=>new $e({innerType:fi,typeName:Ye.ZodOptional,...M$1(ci)});class Fe extends R$1{_parse(ci){return this._getType(ci)===h$1.null?T$2(null):this._def.innerType._parse(ci)}unwrap(){return this._def.innerType}}Fe.create=(fi,ci)=>new Fe({innerType:fi,typeName:Ye.ZodNullable,...M$1(ci)});class ze extends R$1{_parse(ci){const{ctx:hi}=this._processInputParams(ci);let _i=hi.data;return hi.parsedType===h$1.undefined&&(_i=this._def.defaultValue()),this._def.innerType._parse({data:_i,path:hi.path,parent:hi})}removeDefault(){return this._def.innerType}}ze.create=(fi,ci)=>new ze({innerType:fi,typeName:Ye.ZodDefault,defaultValue:typeof ci.default=="function"?ci.default:()=>ci.default,...M$1(ci)});class De extends R$1{_parse(ci){const{ctx:hi}=this._processInputParams(ci),_i={...hi,common:{...hi.common,issues:[]}},pi=this._def.innerType._parse({data:_i.data,path:_i.path,parent:{..._i}});return S(pi)?pi.then(gi=>({status:"valid",value:gi.status==="valid"?gi.value:this._def.catchValue({get error(){return new m$1(_i.common.issues)},input:_i.data})})):{status:"valid",value:pi.status==="valid"?pi.value:this._def.catchValue({get error(){return new m$1(_i.common.issues)},input:_i.data})}}removeCatch(){return this._def.innerType}}De.create=(fi,ci)=>new De({innerType:fi,typeName:Ye.ZodCatch,catchValue:typeof ci.catch=="function"?ci.catch:()=>ci.catch,...M$1(ci)});class Be extends R$1{_parse(ci){if(this._getType(ci)!==h$1.nan){const hi=this._getOrReturnCtx(ci);return b(hi,{code:f$1.invalid_type,expected:h$1.nan,received:hi.parsedType}),x$2}return{status:"valid",value:ci.data}}}Be.create=fi=>new Be({typeName:Ye.ZodNaN,...M$1(fi)});const Ve=Symbol("zod_brand");class Ue extends R$1{_parse(ci){const{ctx:hi}=this._processInputParams(ci),_i=hi.data;return this._def.type._parse({data:_i,path:hi.path,parent:hi})}unwrap(){return this._def.type}}class Ge extends R$1{_parse(ci){const{status:hi,ctx:_i}=this._processInputParams(ci);if(_i.common.async)return(async()=>{const pi=await this._def.in._parseAsync({data:_i.data,path:_i.path,parent:_i});return pi.status==="aborted"?x$2:pi.status==="dirty"?(hi.dirty(),w$2(pi.value)):this._def.out._parseAsync({data:pi.value,path:_i.path,parent:_i})})();{const pi=this._def.in._parseSync({data:_i.data,path:_i.path,parent:_i});return pi.status==="aborted"?x$2:pi.status==="dirty"?(hi.dirty(),{status:"dirty",value:pi.value}):this._def.out._parseSync({data:pi.value,path:_i.path,parent:_i})}}static create(ci,hi){return new Ge({in:ci,out:hi,typeName:Ye.ZodPipeline})}}class We extends R$1{_parse(ci){const hi=this._def.innerType._parse(ci),_i=pi=>(C$2(pi)&&(pi.value=Object.freeze(pi.value)),pi);return S(hi)?hi.then(pi=>_i(pi)):_i(hi)}unwrap(){return this._def.innerType}}function Ke(fi,ci={},hi){return fi?fe.create().superRefine((_i,pi)=>{var gi,mi;if(!fi(_i)){const xi=typeof ci=="function"?ci(_i):typeof ci=="string"?{message:ci}:ci,yi=(mi=(gi=xi.fatal)!==null&&gi!==void 0?gi:hi)===null||mi===void 0||mi,Ci=typeof xi=="string"?{message:xi}:xi;pi.addIssue({code:"custom",...Ci,fatal:yi})}}):fe.create()}We.create=(fi,ci)=>new We({innerType:fi,typeName:Ye.ZodReadonly,...M$1(ci)});const He={object:be.lazycreate};var Ye;(function(fi){fi.ZodString="ZodString",fi.ZodNumber="ZodNumber",fi.ZodNaN="ZodNaN",fi.ZodBigInt="ZodBigInt",fi.ZodBoolean="ZodBoolean",fi.ZodDate="ZodDate",fi.ZodSymbol="ZodSymbol",fi.ZodUndefined="ZodUndefined",fi.ZodNull="ZodNull",fi.ZodAny="ZodAny",fi.ZodUnknown="ZodUnknown",fi.ZodNever="ZodNever",fi.ZodVoid="ZodVoid",fi.ZodArray="ZodArray",fi.ZodObject="ZodObject",fi.ZodUnion="ZodUnion",fi.ZodDiscriminatedUnion="ZodDiscriminatedUnion",fi.ZodIntersection="ZodIntersection",fi.ZodTuple="ZodTuple",fi.ZodRecord="ZodRecord",fi.ZodMap="ZodMap",fi.ZodSet="ZodSet",fi.ZodFunction="ZodFunction",fi.ZodLazy="ZodLazy",fi.ZodLiteral="ZodLiteral",fi.ZodEnum="ZodEnum",fi.ZodEffects="ZodEffects",fi.ZodNativeEnum="ZodNativeEnum",fi.ZodOptional="ZodOptional",fi.ZodNullable="ZodNullable",fi.ZodDefault="ZodDefault",fi.ZodCatch="ZodCatch",fi.ZodPromise="ZodPromise",fi.ZodBranded="ZodBranded",fi.ZodPipeline="ZodPipeline",fi.ZodReadonly="ZodReadonly"})(Ye||(Ye={}));const Xe=ae.create,qe=oe.create,Je=Be.create,Qe=de.create,et=le.create,tt=ue.create,it=ce.create,st=he.create,rt=pe.create,at=fe.create,nt=me.create,ot=ye.create,dt=ge.create,lt=_e.create,ut=be.create,ct=be.strictCreate,ht=ke.create,pt=we.create,ft=Ze.create,mt=Le.create,yt=Ce.create,gt=Se.create,_t=Ee.create,vt=Oe.create,bt=je.create,kt=Ie.create,xt=Ne.create,wt=Pe.create,Tt=Me.create,Zt=Re.create,Lt=$e.create,Ct=Fe.create,St=Re.createWithPreprocess,Et=Ge.create,Ot={string:fi=>ae.create({...fi,coerce:!0}),number:fi=>oe.create({...fi,coerce:!0}),boolean:fi=>le.create({...fi,coerce:!0}),bigint:fi=>de.create({...fi,coerce:!0}),date:fi=>ue.create({...fi,coerce:!0})},jt=x$2;var It=Object.freeze({__proto__:null,defaultErrorMap:y$1,setErrorMap:function(fi){g$2=fi},getErrorMap:_$1,makeIssue:v$1,EMPTY_PATH:[],addIssueToContext:b,ParseStatus:k$2,INVALID:x$2,DIRTY:w$2,OK:T$2,isAborted:Z$1,isDirty:L$1,isValid:C$2,isAsync:S,get util(){return u$1},get objectUtil(){return c$1},ZodParsedType:h$1,getParsedType:p$1,ZodType:R$1,datetimeRegex:ie,ZodString:ae,ZodNumber:oe,ZodBigInt:de,ZodBoolean:le,ZodDate:ue,ZodSymbol:ce,ZodUndefined:he,ZodNull:pe,ZodAny:fe,ZodUnknown:me,ZodNever:ye,ZodVoid:ge,ZodArray:_e,ZodObject:be,ZodUnion:ke,ZodDiscriminatedUnion:we,ZodIntersection:Ze,ZodTuple:Le,ZodRecord:Ce,ZodMap:Se,ZodSet:Ee,ZodFunction:Oe,ZodLazy:je,ZodLiteral:Ie,ZodEnum:Ne,ZodNativeEnum:Pe,ZodPromise:Me,ZodEffects:Re,ZodTransformer:Re,ZodOptional:$e,ZodNullable:Fe,ZodDefault:ze,ZodCatch:De,ZodNaN:Be,BRAND:Ve,ZodBranded:Ue,ZodPipeline:Ge,ZodReadonly:We,custom:Ke,Schema:R$1,ZodSchema:R$1,late:He,get ZodFirstPartyTypeKind(){return Ye},coerce:Ot,any:at,array:lt,bigint:Qe,boolean:et,date:tt,discriminatedUnion:pt,effect:Zt,enum:xt,function:vt,instanceof:(fi,ci={message:`Input not instance of ${fi.name}`})=>Ke(hi=>hi instanceof fi,ci),intersection:ft,lazy:bt,literal:kt,map:gt,nan:Je,nativeEnum:wt,never:ot,null:rt,nullable:Ct,number:qe,object:ut,oboolean:()=>et().optional(),onumber:()=>qe().optional(),optional:Lt,ostring:()=>Xe().optional(),pipeline:Et,preprocess:St,promise:Tt,record:yt,set:_t,strictObject:ct,string:Xe,symbol:it,transformer:Zt,tuple:mt,undefined:st,union:ht,unknown:nt,void:dt,NEVER:jt,ZodIssueCode:f$1,quotelessJson:fi=>JSON.stringify(fi,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:m$1});const At=It.object({h:It.number(),tilesetUid:It.number(),w:It.number(),x:It.number(),y:It.number()}),Nt=It.tuple([It.number(),It.number()]),Pt=It.object({__identifier:It.string(),__tile:At.nullable(),__type:It.string(),__value:It.any(),defUid:It.number()}),Mt=It.object({a:It.number(),f:It.number(),px:Nt,src:Nt,t:It.number()}),Rt=It.object({__grid:Nt,__identifier:It.string(),__pivot:Nt,__smartColor:It.string(),__tags:It.array(It.string()),__tile:At.nullable(),__worldX:It.number().nullable(),__worldY:It.number().nullable(),defUid:It.number(),fieldInstances:It.array(Pt),height:It.number(),iid:It.string(),px:Nt,width:It.number()}),$t=It.object({__cHei:It.number(),__cWid:It.number(),__gridSize:It.number(),__identifier:It.string(),__opacity:It.number(),__pxTotalOffsetX:It.number(),__pxTotalOffsetY:It.number(),__tilesetDefUid:It.number().nullable(),__tilesetRelPath:It.string().nullable(),__type:It.union([It.literal("IntGrid"),It.literal("Entities"),It.literal("Tiles"),It.literal("AutoLayer")]),autoLayerTiles:It.array(Mt),entityInstances:It.array(Rt),gridTiles:It.array(Mt),iid:It.string(),intGridCsv:It.array(It.number()),layerDefUid:It.number(),levelId:It.number(),overrideTilesetUid:It.number().nullable(),pxOffsetX:It.number(),pxOffsetY:It.number(),visible:It.boolean()}),Ft=It.object({__bgColor:It.string().nullable(),bgColor:It.string().nullable(),__bgPos:It.object({cropRect:It.array(It.tuple([It.number(),It.number(),It.number(),It.number()])),scale:It.tuple([It.number(),It.number()]),topLeftPx:Nt}).nullable(),__neighbours:It.array(It.object({dir:It.union([It.literal("n"),It.literal("s"),It.literal("w"),It.literal("e"),It.literal("ne"),It.literal("nw"),It.literal("se"),It.literal("sw"),It.literal("o"),It.literal("<"),It.literal(">")]),levelIid:It.string()})),bgRelPath:It.string().nullable(),externalRelPath:It.string().nullable(),fieldInstances:It.array(Pt),identifier:It.string(),iid:It.string(),layerInstances:It.array($t).nullable(),pxHei:It.number(),pxWid:It.number(),uid:It.number(),worldDepth:It.number(),worldX:It.number(),worldY:It.number()}),zt=It.object({identifier:It.string(),iid:It.string(),levels:It.array(Ft),worldGridHeight:It.number(),worldGridWidth:It.number(),worldLayout:It.union([It.literal("Free"),It.literal("GridVania"),It.literal("LinearHorizontal"),It.literal("LinearVertical")])}),Dt=It.object({color:It.number(),id:It.string(),tileRect:At.nullable()}),Bt=It.object({externalRelPath:It.string().nullable(),iconTilesetUid:It.number().nullable(),identifier:It.string(),tags:It.array(It.string()),uid:It.number(),values:It.array(Dt)}),Vt=It.object({__cHei:It.number(),__cWid:It.number(),customData:It.array(It.object({data:It.string(),tileId:It.number()})),embedAtlas:It.string().nullable(),enumTags:It.optional(It.array(It.object({enumValueId:It.string(),tileIds:It.array(It.number())}))),identifier:It.string(),padding:It.number(),pxHei:It.number(),pxWid:It.number(),relPath:It.string().nullable(),spacing:It.number(),tags:It.array(It.string()),tagsSourceEnumUid:It.number().nullable(),tileGridSize:It.number(),uid:It.number()}),Ut=It.object({__type:It.union([It.literal("IntGrid"),It.literal("Entities"),It.literal("Tiles"),It.literal("AutoLayer")]),autoSourceLayerDefUid:It.number().nullable(),displayOpacity:It.number(),gridSize:It.number(),identifier:It.string(),intGridValues:It.array(It.object({color:It.string(),groupUid:It.number(),identifier:It.string().nullable(),tile:At.nullable(),value:It.number()})),intGridValuesGroups:It.array(It.object({color:It.string().nullable(),identifier:It.string().nullable(),uid:It.number()})),parallaxFactorX:It.number(),parallaxFactorY:It.number(),parallaxScaling:It.boolean(),pxOffsetX:It.number(),pxOffsetY:It.number(),tilesetDefUid:It.number().nullable(),uid:It.number()}),Gt=It.object({color:It.string(),height:It.number(),identifier:It.string(),nineSliceBorders:It.array(It.number()),pivotX:It.number(),pivotY:It.number(),tileRect:At.nullable(),tileRenderMode:It.union([It.literal("Cover"),It.literal("FitInside"),It.literal("Repeat"),It.literal("Stretch"),It.literal("FullSizeCropped"),It.literal("FullSizeUncropped"),It.literal("NineSlice")]),tilesetId:It.number().nullable(),uiTileRect:At.nullable(),uid:It.number(),width:It.number()}),Wt=It.object({tilesets:It.array(Vt),enums:It.array(Bt),layers:It.array(Ut),entities:It.array(Gt)}),Kt=It.object({iid:It.string(),bgColor:It.string().nullable(),defs:Wt,externalLevels:It.boolean(),jsonVersion:It.string(),levels:It.array(Ft),toc:It.array(It.object({identifier:It.string(),instancesData:It.array(It.object({fields:It.any(),heiPx:It.number(),iids:It.string(),widPix:It.number(),worldX:It.number(),worldY:It.number()}))})),worldGridHeight:It.number().nullable(),worldGridWidth:It.number().nullable(),worldLayout:It.union([It.literal("Free"),It.literal("GridVania"),It.literal("LinearHorizontal"),It.literal("LinearVertical")]).nullable(),worlds:It.array(zt)}),Ht=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Yt=fi=>{if(typeof fi!="string")throw new TypeError("Invalid argument expected string");const ci=fi.match(Ht);if(!ci)throw new Error(`Invalid argument not valid semver ('${fi}' received)`);return ci.shift(),ci},Xt=fi=>fi==="*"||fi==="x"||fi==="X",qt=fi=>{const ci=parseInt(fi,10);return isNaN(ci)?fi:ci},Jt=(fi,ci)=>{if(Xt(fi)||Xt(ci))return 0;const[hi,_i]=((pi,gi)=>typeof pi!=typeof gi?[String(pi),String(gi)]:[pi,gi])(qt(fi),qt(ci));return hi>_i?1:hi<_i?-1:0},Qt=(fi,ci)=>{for(let hi=0;hi<Math.max(fi.length,ci.length);hi++){const _i=Jt(fi[hi]||"0",ci[hi]||"0");if(_i!==0)return _i}return 0},ei=(fi,ci,hi)=>{si(hi);const _i=((pi,gi)=>{const mi=Yt(pi),xi=Yt(gi),yi=mi.pop(),Ci=xi.pop(),Ei=Qt(mi,xi);return Ei!==0?Ei:yi&&Ci?Qt(yi.split("."),Ci.split(".")):yi||Ci?yi?-1:1:0})(fi,ci);return ti[hi].includes(_i)},ti={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},ii=Object.keys(ti),si=fi=>{if(ii.indexOf(fi)===-1)throw new Error(`Invalid operator, expected one of ${ii.join("|")}`)};class ri{constructor(ci){this.type=ci,this._loaded=!1,this.cache=new Map}getOrAdd(...ci){let hi=this.cache.get(ci.join("+"));return hi||(hi=new this.type(...ci),this.cache.set(ci.join("+"),hi),hi)}values(){if(this._loaded)return Array.from(this.cache.values());throw new Error("Read through cache not yet loaded! No values to return!")}async load(){const ci=Array.from(this.cache.entries()),hi=await Promise.allSettled(ci.map(pi=>pi[1].load()));let _i=0;for(let pi=0;pi<hi.length;pi++){const gi=hi[pi];gi.status==="rejected"&&(console.error(`Error loading resource at ${ci[pi][0]}, is your pathMap correct? or your LDtk map corrupted?`,gi.reason),_i++)}if(_i)throw new Error(`Error loading ${_i} resources`);this._loaded=!0}}class ai{constructor(ci,hi,_i,pi){var gi,mi;if(this.ldtkLayer=hi,this.resource=_i,this.order=pi,this.entities=[],this.ldtkToEntity=new Map,this.entityToLdtk=new Map,this.worldPos=(0,s$1.vec)(ci.ldtkLevel.worldX,ci.ldtkLevel.worldY),this.offset=(0,s$1.vec)(hi.__pxTotalOffsetX,hi.__pxTotalOffsetY),hi.entityInstances)for(let xi of hi.entityInstances){const yi=_i.projectMetadata.defs.entities.find(Ci=>Ci.identifier===xi.__identifier);if(_i.factories.has(xi.__identifier)){const Ci=_i.factories.get(xi.__identifier);if(Ci){const Ei=Ci({type:xi.__identifier,worldPos:(0,s$1.vec)(xi.px[0],xi.px[1]).add(this.worldPos.add(this.offset)),entity:xi,definition:yi,layer:this});Ei&&(this.entities.push(Ei),this.ldtkToEntity.set(xi,Ei),this.entityToLdtk.set(Ei,xi))}}else{const Ci=new s$1.Actor({name:xi.__identifier,pos:(0,s$1.vec)(xi.px[0],xi.px[1]).add(this.worldPos.add(this.offset)),width:xi.width,height:xi.height,anchor:(0,s$1.vec)((gi=yi==null?void 0:yi.pivotX)!==null&&gi!==void 0?gi:0,(mi=yi==null?void 0:yi.pivotY)!==null&&mi!==void 0?mi:0),z:pi});if(xi.__tile){const Ei=_i.tilesets.get(xi.__tile.tilesetUid);if(Ei){const Ai=Math.floor(xi.__tile.x/xi.__tile.w),ki=Math.floor(xi.__tile.y/xi.__tile.h),Pi=Ei.spritesheet.getSprite(Ai,ki);Pi&&Ci.graphics.use(Pi)}}this.entities.push(Ci),this.ldtkToEntity.set(xi,Ci),this.entityToLdtk.set(Ci,xi)}}}runFactories(){for(let ci of this.ldtkLayer.entityInstances){const hi=this.resource.factories.get(ci.__identifier);if(!hi)continue;const _i=this.resource.projectMetadata.defs.entities.find(gi=>gi.identifier===ci.__identifier),pi=hi({type:ci.__identifier,worldPos:(0,s$1.vec)(ci.px[0],ci.px[1]).add(this.worldPos.add(this.offset)),entity:ci,definition:_i,layer:this});if(pi){const gi=this.ldtkToEntity.get(ci);if(gi){const mi=this.entities.indexOf(gi);mi>-1&&(this.entities.splice(mi,1),this.ldtkToEntity.delete(ci),this.entityToLdtk.delete(gi))}this.entities.push(pi),this.ldtkToEntity.set(ci,pi),this.entityToLdtk.set(pi,ci)}}}getEntitiesByIdentifier(ci){const hi=this.getLdtkEntitiesByIdentifier(ci);let _i=[];for(const pi of hi){const gi=this.ldtkToEntity.get(pi);gi&&_i.push(gi)}return _i}getEntitiesByField(ci,hi){const _i=this.getLdtkEntitiesByField(ci,hi);let pi=[];for(const gi of _i){const mi=this.ldtkToEntity.get(gi);mi&&pi.push(mi)}return pi}getLdtkEntitiesByIdentifier(ci){return this.ldtkLayer.entityInstances.filter(hi=>hi.__identifier.toLocaleLowerCase()===ci.toLowerCase())}getLdtkEntitiesByField(ci,hi){return this.ldtkLayer.entityInstances.filter(_i=>{if(hi!==void 0){let pi=hi;typeof hi=="string"&&(pi=hi.toLocaleLowerCase());const gi=_i.fieldInstances.find(mi=>mi.__identifier.toLocaleLowerCase()===ci.toLocaleLowerCase());return!!gi&&gi.__value===pi}return!!_i.fieldInstances.find(pi=>pi.__identifier.toLocaleLowerCase()===ci.toLocaleLowerCase())})}}class ni{constructor(ci,hi,_i,pi){var gi,mi,xi,yi;if(this.order=pi,this.worldPos=(0,s$1.vec)(ci.ldtkLevel.worldX,ci.ldtkLevel.worldY),this.offset=(0,s$1.vec)(hi.__pxTotalOffsetX,hi.__pxTotalOffsetY),this.ldtkLayer=hi,hi.intGridCsv.length||hi.autoLayerTiles.length){const Ci=hi.__cHei,Ei=hi.__cWid;this.tilemap=new s$1.TileMap({name:hi.__identifier,pos:this.worldPos.add(this.offset),tileWidth:hi.__gridSize,tileHeight:hi.__gridSize,rows:Ci,columns:Ei}),this.tilemap.z=pi,this.tilemap.get(s$1.GraphicsComponent).isVisible=hi.visible;const Ai=_i.projectMetadata.defs.layers.find(ki=>hi.__identifier===ki.identifier);if(Ai){const ki=Ai.intGridValues.find(Pi=>{var Ii;return((Ii=Pi==null?void 0:Pi.identifier)===null||Ii===void 0?void 0:Ii.toLocaleLowerCase())==="solid"});for(let Pi=0;Pi<hi.intGridCsv.length;Pi++){const Ii=Pi%Ei,Di=Math.floor(Pi/Ei),Fi=this.tilemap.getTile(Ii,Di);ki&&hi.intGridCsv[Pi]===ki.value&&(Fi.solid=!0),ki||hi.intGridCsv[Pi]!==1||(Fi.solid=!0)}if(hi.__tilesetDefUid){this.tileset=_i.tilesets.get(hi.__tilesetDefUid);for(let Pi=0;Pi<hi.autoLayerTiles.length;Pi++){const Ii=hi.autoLayerTiles[Pi],Di=Math.floor(Ii.px[0]/hi.__gridSize),Fi=Math.floor(Ii.px[1]/hi.__gridSize),Li=this.tilemap.getTile(Di,Fi);if(Li&&this.tileset){const Bi=Math.floor((Ii.src[0]-((gi=this.tileset.ldtkTileset.padding)!==null&&gi!==void 0?gi:0))/(this.tileset.ldtkTileset.tileGridSize+((mi=this.tileset.ldtkTileset.spacing)!==null&&mi!==void 0?mi:0))),Ri=Math.floor((Ii.src[1]-((xi=this.tileset.ldtkTileset.padding)!==null&&xi!==void 0?xi:0))/(this.tileset.ldtkTileset.tileGridSize+((yi=this.tileset.ldtkTileset.spacing)!==null&&yi!==void 0?yi:0))),$i=!!(1&Ii.f),Ni=!!(2&Ii.f);let ji=this.tileset.spritesheet.getSprite(Bi,Ri);($i||Ni)&&(ji=ji.clone(),ji.flipHorizontal=$i,ji.flipVertical=Ni),ji?Li.addGraphic(ji):console.error("Could not find sprite in LDtk spritesheet at",Bi,Ri)}}}}}}}class oi{constructor(ci,hi){var _i,pi,gi,mi;if(this.ldtkLevel=ci,this.resource=hi,this.layers=[],ci.__bgColor&&(this.backgroundColor=s$1.Color.fromHex(ci.__bgColor)),ci.layerInstances){let xi=hi.startZIndex,yi=ci.layerInstances.slice().reverse();for(let Ci of yi)((_i=Ci.entityInstances)===null||_i===void 0?void 0:_i.length)!==0&&this.layers.push(new ai(this,Ci,hi,xi)),((pi=Ci.gridTiles)===null||pi===void 0?void 0:pi.length)!==0&&this.layers.push(new r$1(this,Ci,hi,xi)),((gi=Ci.intGridCsv)===null||gi===void 0?void 0:gi.length)===0&&((mi=Ci.autoLayerTiles)===null||mi===void 0?void 0:mi.length)===0||this.layers.push(new ni(this,Ci,hi,xi)),xi++}}}class di{constructor(ci,hi,_i){this.path=ci,this.resource=hi,this.fileLoader=l$1,this.strict=!0,this.headless=!1;const{headless:pi,strict:gi,fileLoader:mi,imageLoader:xi,pathMap:yi}={..._i};this.fileLoader=mi??this.fileLoader,this.strict=gi??this.strict,this.headless=pi??this.headless,this.imageLoader=xi??new ri(s$1.ImageSource),this.pathMap=yi??this.pathMap}async load(){const ci=await this.fileLoader(this.path,"json");let hi;if(this.strict)try{hi=Ft.parse(ci)}catch(_i){throw console.error(`Could not parse LDtk level data at ${this.path} are you sure a level is there and not corrupt?`),_i}else hi=ci;return this.data=new oi(hi,this.resource)}isLoaded(){return!!this.data}}class li{constructor(ci){var hi,_i,pi,gi;const{image:mi,ldtkTileset:xi}=ci;this.image=mi,this.ldtkTileset=xi,this.spritesheet=s$1.SpriteSheet.fromImageSource({image:mi,grid:{rows:xi.pxHei/xi.tileGridSize,columns:xi.pxWid/xi.tileGridSize,spriteHeight:xi.tileGridSize,spriteWidth:xi.tileGridSize},spacing:{margin:{x:(hi=xi.spacing)!==null&&hi!==void 0?hi:0,y:(_i=xi.spacing)!==null&&_i!==void 0?_i:0},originOffset:{x:(pi=xi.padding)!==null&&pi!==void 0?pi:0,y:(gi=xi.padding)!==null&&gi!==void 0?gi:0}}})}}class ui{constructor(ci,hi){this.path=ci,this.tilesets=new Map,this.levels=new Map,this.levelsByName=new Map,this.factories=new Map,this.fileLoader=l$1,this._imageLoader=new ri(s$1.ImageSource),this._levelLoader=new ri(di),this.startZIndex=0,this.textQuality=4,this.useExcaliburWiring=!0,this.useMapBackgroundColor=!1,this.useTilemapCameraStrategy=!1,this.headless=!1,this.strict=!0;const{useExcaliburWiring:_i,useTilemapCameraStrategy:pi,entityIdentifierFactories:gi,pathMap:mi,useMapBackgroundColor:xi,fileLoader:yi,strict:Ci,headless:Ei,startZIndex:Ai}={...hi};this.strict=Ci??this.strict,this.headless=Ei??this.headless,this.useExcaliburWiring=_i??this.useExcaliburWiring,this.useTilemapCameraStrategy=pi??this.useTilemapCameraStrategy,this.useMapBackgroundColor=xi??this.useMapBackgroundColor,this.startZIndex=Ai??this.startZIndex,this.fileLoader=yi??this.fileLoader,this.pathMap=mi;for(const ki in gi)this.registerEntityIdentifierFactory(ki,gi[ki])}async load(){var ci;const hi=await this.fileLoader(this.path,"json");if(this.strict)try{this.projectMetadata=Kt.parse(hi)}catch(_i){throw console.error(`Could not parse LDtk map from location ${this.path}.
Excalibur only supports the latest version of LDtk formats as of the plugin's release.`),console.error("Is your map file corrupted or being interpreted as the wrong type?"),_i}else this.projectMetadata=hi;ei(ui.supportedLdtkVersion,(ci=this.projectMetadata.jsonVersion)!==null&&ci!==void 0?ci:"0.0.0",">")&&console.warn(`The excalibur ldtk plugin officially supports ${ui.supportedLdtkVersion}+, the current map has LDtk version ${this.projectMetadata.jsonVersion}`);for(let _i of this.projectMetadata.defs.tilesets)if(_i.relPath){const pi=d$1(this.path,_i.relPath,this.pathMap),gi=this._imageLoader.getOrAdd(pi),mi=new li({image:gi,ldtkTileset:_i});this.tilesets.set(_i.uid,mi)}else _i.identifier!=="Internal_Icons"&&console.warn(`No tileset image provided for ${_i.identifier}`);for(let _i of this.projectMetadata.levels)if(_i.externalRelPath){const pi=d$1(this.path,_i.externalRelPath,this.pathMap);this._levelLoader.getOrAdd(pi,this,{headless:this.headless,strict:this.strict,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}else{const pi=new oi(_i,this);this.levels.set(_i.uid,pi),this.levelsByName.set(_i.identifier.toLowerCase(),pi)}return await Promise.all([this._imageLoader.load(),this._levelLoader.load()]),this._levelLoader.values().forEach(_i=>{this.levels.set(_i.data.ldtkLevel.uid,_i.data),this.levelsByName.set(_i.data.ldtkLevel.identifier.toLowerCase(),_i.data)}),this.data=this.projectMetadata}isLoaded(){return!!this.data}registerEntityIdentifierFactory(ci,hi){this.factories.set(ci,hi)}registerEntityIdentifierFactories(ci){for(const hi in ci)this.registerEntityIdentifierFactory(hi,ci[hi])}getLevel(ci){return this.levelsByName.get(ci.toLowerCase())}getEntityLayers(ci){let hi=[];if(ci){const _i=this.getLevel(ci);if(_i)for(let pi of _i.layers)pi instanceof ai&&hi.push(pi)}else for(const _i of this.levels.values())for(let pi of _i.layers)pi instanceof ai&&hi.push(pi);return hi}getTileLayers(ci){let hi=[];if(ci){const _i=this.getLevel(ci);if(_i)for(let pi of _i.layers)pi instanceof r$1&&hi.push(pi)}else for(const _i of this.levels.values())for(let pi of _i.layers)pi instanceof r$1&&hi.push(pi);return hi}getIntGridLayers(ci){let hi=[];if(ci){const _i=this.getLevel(ci);if(_i)for(let pi of _i.layers)pi instanceof ni&&hi.push(pi)}else for(const _i of this.levels.values())for(let pi of _i.layers)pi instanceof ni&&hi.push(pi);return hi}getLdtkEntitiesByIdentifier(ci,hi){let _i=[];const pi=hi??Array.from(this.levels.values()).map(gi=>gi.ldtkLevel.identifier);for(const gi of pi){const mi=this.getEntityLayers(gi);for(let xi of mi)_i=_i.concat(xi.getLdtkEntitiesByIdentifier(ci))}return _i}getLdtkEntitiesByField(ci,hi,_i){let pi=[];const gi=_i??Array.from(this.levels.values()).map(mi=>mi.ldtkLevel.identifier);for(const mi of gi){const xi=this.getEntityLayers(mi);for(let yi of xi)pi=pi.concat(yi.getLdtkEntitiesByField(ci,hi))}return pi}getEntitiesByIdentifier(ci,hi){let _i=[];const pi=hi??Array.from(this.levels.values()).map(gi=>gi.ldtkLevel.identifier);for(const gi of pi){const mi=this.getEntityLayers(gi);for(let xi of mi)_i=_i.concat(xi.getEntitiesByIdentifier(ci))}return _i}getEntitiesByField(ci,hi,_i){let pi=[];const gi=_i??Array.from(this.levels.values()).map(mi=>mi.ldtkLevel.identifier);for(const mi of gi){const xi=this.getEntityLayers(mi);for(let yi of xi)pi=pi.concat(yi.getEntitiesByField(ci,hi))}return pi}getLevelBounds(ci){ci=ci??Array.from(this.levelsByName.keys());let hi=null;for(const _i of this.levels.values()){if(!ci.includes(_i.ldtkLevel.identifier))continue;const pi=this.getTileLayers(_i.ldtkLevel.identifier)[0];if(pi){const gi=s$1.BoundingBox.fromDimension(pi.tilemap.tileWidth*pi.tilemap.columns,pi.tilemap.tileHeight*pi.tilemap.rows,s$1.Vector.Zero,pi.tilemap.pos);hi=hi?hi.combine(gi):gi}}return hi??new s$1.BoundingBox}addToScene(ci,hi){var _i,pi;const{pos:gi,useLevelOffsets:mi}={pos:(0,s$1.vec)(0,0),useLevelOffsets:!0,...hi};for(let[xi,yi]of this.levels.entries())if(!(!((_i=hi==null?void 0:hi.levelFilter)===null||_i===void 0)&&_i.length)||hi.levelFilter.includes(yi.ldtkLevel.identifier))for(let Ci of yi.layers)if(Ci instanceof r$1||Ci instanceof ni)Ci.tilemap.pos=Ci.tilemap.pos.add(gi),mi||(Ci.tilemap.pos=Ci.tilemap.pos.sub(Ci.worldPos)),ci.add(Ci.tilemap);else{Ci.runFactories();for(let Ei of Ci.entities){const Ai=Ei.get(s$1.TransformComponent);Ai&&(Ai.pos=Ai.pos.add(gi),mi||(Ai.pos=Ai.pos.sub(Ci.worldPos))),ci.add(Ei)}}if(this.useExcaliburWiring){const xi=this.getLdtkEntitiesByField("camera",!0)[0];if(xi){ci.camera.pos=(0,s$1.vec)(xi.px[0],xi.px[0]);const yi=xi.fieldInstances.find(Ci=>Ci.__identifier.toLocaleLowerCase()==="zoom");yi&&(ci.camera.zoom=+yi.__value)}}if(this.useTilemapCameraStrategy){let xi=this.getLevelBounds(hi==null?void 0:hi.levelFilter);ci.camera.strategy.limitCameraBounds(xi)}if(this.useMapBackgroundColor){for(let[xi,yi]of this.levels.entries())if(!(!((pi=hi==null?void 0:hi.levelFilter)===null||pi===void 0)&&pi.length)||hi.levelFilter.includes(yi.ldtkLevel.identifier)){ci.backgroundColor=yi.backgroundColor;break}}}}ui.supportedLdtkVersion="1.5.3";i$1.dd;i$1.UZ;i$1.NN;i$1.e1;i$1.a8;i$1.u6;i$1.oK;i$1.U_;i$1.sn;var bi=i$1.GY;i$1.$t;i$1.RI;i$1._k;i$1.eZ;i$1.pf;i$1.N5;i$1.qD;i$1.hu;i$1.Uk;const FRAC=23283064365386963e-26;class RNG{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(ci){return ci=ci<1?1/ci:ci,this._seed=ci,this._s0=(ci>>>0)*FRAC,ci=ci*69069+1>>>0,this._s1=ci*FRAC,ci=ci*69069+1>>>0,this._s2=ci*FRAC,this._c=1,this}getUniform(){let ci=2091639*this._s0+this._c*FRAC;return this._s0=this._s1,this._s1=this._s2,this._c=ci|0,this._s2=ci-this._c,this._s2}getUniformInt(ci,hi){let _i=Math.max(ci,hi),pi=Math.min(ci,hi);return Math.floor(this.getUniform()*(_i-pi+1))+pi}getNormal(ci=0,hi=1){let _i,pi,gi;do _i=2*this.getUniform()-1,pi=2*this.getUniform()-1,gi=_i*_i+pi*pi;while(gi>1||gi==0);let mi=_i*Math.sqrt(-2*Math.log(gi)/gi);return ci+mi*hi}getPercentage(){return 1+Math.floor(this.getUniform()*100)}getItem(ci){return ci.length?ci[Math.floor(this.getUniform()*ci.length)]:null}shuffle(ci){let hi=[],_i=ci.slice();for(;_i.length;){let pi=_i.indexOf(this.getItem(_i));hi.push(_i.splice(pi,1)[0])}return hi}getWeightedValue(ci){let hi=0;for(let mi in ci)hi+=ci[mi];let _i=this.getUniform()*hi,pi,gi=0;for(pi in ci)if(gi+=ci[pi],_i<gi)return pi;return pi}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(ci){return this._s0=ci[0],this._s1=ci[1],this._s2=ci[2],this._c=ci[3],this}clone(){return new RNG().setState(this.getState())}}const RNG$1=new RNG().setSeed(Date.now());class Backend{getContainer(){return null}setOptions(ci){this._options=ci}}class Canvas extends Backend{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(ci){requestAnimationFrame(ci)}getContainer(){return this._ctx.canvas}setOptions(ci){super.setOptions(ci);const _i=`${ci.fontStyle?`${ci.fontStyle} `:""} ${ci.fontSize}px ${ci.fontFamily}`;this._ctx.font=_i,this._updateSize(),this._ctx.font=_i,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){const ci=this._ctx.globalCompositeOperation;this._ctx.globalCompositeOperation="copy",this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.globalCompositeOperation=ci}eventToPosition(ci,hi){let _i=this._ctx.canvas,pi=_i.getBoundingClientRect();return ci-=pi.left,hi-=pi.top,ci*=_i.width/pi.width,hi*=_i.height/pi.height,ci<0||hi<0||ci>=_i.width||hi>=_i.height?[-1,-1]:this._normalizedEventToPosition(ci,hi)}}class Rect extends Canvas{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(ci){super.setOptions(ci),this._canvasCache={}}draw(ci,hi){Rect.cache?this._drawWithCache(ci):this._drawNoCache(ci,hi)}_drawWithCache(ci){let[hi,_i,pi,gi,mi]=ci,xi=""+pi+gi+mi,yi;if(xi in this._canvasCache)yi=this._canvasCache[xi];else{let Ci=this._options.border;yi=document.createElement("canvas");let Ei=yi.getContext("2d");if(yi.width=this._spacingX,yi.height=this._spacingY,Ei.fillStyle=mi,Ei.fillRect(Ci,Ci,yi.width-Ci,yi.height-Ci),pi){Ei.fillStyle=gi,Ei.font=this._ctx.font,Ei.textAlign="center",Ei.textBaseline="middle";let Ai=[].concat(pi);for(let ki=0;ki<Ai.length;ki++)Ei.fillText(Ai[ki],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[xi]=yi}this._ctx.drawImage(yi,hi*this._spacingX,_i*this._spacingY)}_drawNoCache(ci,hi){let[_i,pi,gi,mi,xi]=ci;if(hi){let Ci=this._options.border;this._ctx.fillStyle=xi,this._ctx.fillRect(_i*this._spacingX+Ci,pi*this._spacingY+Ci,this._spacingX-Ci,this._spacingY-Ci)}if(!gi)return;this._ctx.fillStyle=mi;let yi=[].concat(gi);for(let Ci=0;Ci<yi.length;Ci++)this._ctx.fillText(yi[Ci],(_i+.5)*this._spacingX,Math.ceil((pi+.5)*this._spacingY))}computeSize(ci,hi){let _i=Math.floor(ci/this._spacingX),pi=Math.floor(hi/this._spacingY);return[_i,pi]}computeFontSize(ci,hi){let _i=Math.floor(ci/this._options.width),pi=Math.floor(hi/this._options.height),gi=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let mi=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=gi;let yi=mi/100*pi/_i;return yi>1&&(pi=Math.floor(pi/yi)),Math.floor(pi/this._options.spacing)}_normalizedEventToPosition(ci,hi){return[Math.floor(ci/this._spacingX),Math.floor(hi/this._spacingY)]}_updateSize(){const ci=this._options,hi=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(ci.spacing*hi),this._spacingY=Math.ceil(ci.spacing*ci.fontSize),ci.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=ci.width*this._spacingX,this._ctx.canvas.height=ci.height*this._spacingY}}Rect.cache=!1;let DEFAULT_WIDTH=80,DEFAULT_HEIGHT=25;const DIRS={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]};let Map$2=class{constructor(ci=DEFAULT_WIDTH,hi=DEFAULT_HEIGHT){this._width=ci,this._height=hi}_fillMap(ci){let hi=[];for(let _i=0;_i<this._width;_i++){hi.push([]);for(let pi=0;pi<this._height;pi++)hi[_i].push(ci)}return hi}};class Arena extends Map$2{create(ci){let hi=this._width-1,_i=this._height-1;for(let pi=0;pi<=hi;pi++)for(let gi=0;gi<=_i;gi++){let mi=pi&&gi&&pi<hi&&gi<_i;ci(pi,gi,mi?0:1)}return this}}class Dungeon extends Map$2{constructor(ci,hi){super(ci,hi),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class Feature{}class Room extends Feature{constructor(ci,hi,_i,pi,gi,mi){super(),this._x1=ci,this._y1=hi,this._x2=_i,this._y2=pi,this._doors={},gi!==void 0&&mi!==void 0&&this.addDoor(gi,mi)}static createRandomAt(ci,hi,_i,pi,gi){let mi=gi.roomWidth[0],xi=gi.roomWidth[1],yi=RNG$1.getUniformInt(mi,xi);mi=gi.roomHeight[0],xi=gi.roomHeight[1];let Ci=RNG$1.getUniformInt(mi,xi);if(_i==1){let Ei=hi-Math.floor(RNG$1.getUniform()*Ci);return new this(ci+1,Ei,ci+yi,Ei+Ci-1,ci,hi)}if(_i==-1){let Ei=hi-Math.floor(RNG$1.getUniform()*Ci);return new this(ci-yi,Ei,ci-1,Ei+Ci-1,ci,hi)}if(pi==1){let Ei=ci-Math.floor(RNG$1.getUniform()*yi);return new this(Ei,hi+1,Ei+yi-1,hi+Ci,ci,hi)}if(pi==-1){let Ei=ci-Math.floor(RNG$1.getUniform()*yi);return new this(Ei,hi-Ci,Ei+yi-1,hi-1,ci,hi)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(ci,hi,_i){let pi=_i.roomWidth[0],gi=_i.roomWidth[1],mi=RNG$1.getUniformInt(pi,gi);pi=_i.roomHeight[0],gi=_i.roomHeight[1];let xi=RNG$1.getUniformInt(pi,gi),yi=ci-Math.floor(RNG$1.getUniform()*mi),Ci=hi-Math.floor(RNG$1.getUniform()*xi),Ei=yi+mi-1,Ai=Ci+xi-1;return new this(yi,Ci,Ei,Ai)}static createRandom(ci,hi,_i){let pi=_i.roomWidth[0],gi=_i.roomWidth[1],mi=RNG$1.getUniformInt(pi,gi);pi=_i.roomHeight[0],gi=_i.roomHeight[1];let xi=RNG$1.getUniformInt(pi,gi),yi=ci-mi-1,Ci=hi-xi-1,Ei=1+Math.floor(RNG$1.getUniform()*yi),Ai=1+Math.floor(RNG$1.getUniform()*Ci),ki=Ei+mi-1,Pi=Ai+xi-1;return new this(Ei,Ai,ki,Pi)}addDoor(ci,hi){return this._doors[ci+","+hi]=1,this}getDoors(ci){for(let hi in this._doors){let _i=hi.split(",");ci(parseInt(_i[0]),parseInt(_i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(ci){let hi=this._x1-1,_i=this._x2+1,pi=this._y1-1,gi=this._y2+1;for(let mi=hi;mi<=_i;mi++)for(let xi=pi;xi<=gi;xi++)mi!=hi&&mi!=_i&&xi!=pi&&xi!=gi||ci(mi,xi)||this.addDoor(mi,xi);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(ci,hi){let _i=this._x1-1,pi=this._x2+1,gi=this._y1-1,mi=this._y2+1;for(let xi=_i;xi<=pi;xi++)for(let yi=gi;yi<=mi;yi++)if(xi==_i||xi==pi||yi==gi||yi==mi){if(!ci(xi,yi))return!1}else if(!hi(xi,yi))return!1;return!0}create(ci){let hi=this._x1-1,_i=this._x2+1,pi=this._y1-1,gi=this._y2+1,mi=0;for(let xi=hi;xi<=_i;xi++)for(let yi=pi;yi<=gi;yi++)xi+","+yi in this._doors?mi=2:xi==hi||xi==_i||yi==pi||yi==gi?mi=1:mi=0,ci(xi,yi,mi)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class Corridor extends Feature{constructor(ci,hi,_i,pi){super(),this._startX=ci,this._startY=hi,this._endX=_i,this._endY=pi,this._endsWithAWall=!0}static createRandomAt(ci,hi,_i,pi,gi){let mi=gi.corridorLength[0],xi=gi.corridorLength[1],yi=RNG$1.getUniformInt(mi,xi);return new this(ci,hi,ci+_i*yi,hi+pi*yi)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(ci,hi){let _i=this._startX,pi=this._startY,gi=this._endX-_i,mi=this._endY-pi,xi=1+Math.max(Math.abs(gi),Math.abs(mi));gi&&(gi=gi/Math.abs(gi)),mi&&(mi=mi/Math.abs(mi));let yi=mi,Ci=-gi,Ei=!0;for(let Pi=0;Pi<xi;Pi++){let Ii=_i+Pi*gi,Di=pi+Pi*mi;if(hi(Ii,Di)||(Ei=!1),ci(Ii+yi,Di+Ci)||(Ei=!1),ci(Ii-yi,Di-Ci)||(Ei=!1),!Ei){xi=Pi,this._endX=Ii-gi,this._endY=Di-mi;break}}if(xi==0||xi==1&&ci(this._endX+gi,this._endY+mi))return!1;let Ai=!ci(this._endX+gi+yi,this._endY+mi+Ci),ki=!ci(this._endX+gi-yi,this._endY+mi-Ci);return this._endsWithAWall=ci(this._endX+gi,this._endY+mi),!((Ai||ki)&&this._endsWithAWall)}create(ci){let hi=this._startX,_i=this._startY,pi=this._endX-hi,gi=this._endY-_i,mi=1+Math.max(Math.abs(pi),Math.abs(gi));pi&&(pi=pi/Math.abs(pi)),gi&&(gi=gi/Math.abs(gi));for(let xi=0;xi<mi;xi++){let yi=hi+xi*pi,Ci=_i+xi*gi;ci(yi,Ci,0)}return!0}createPriorityWalls(ci){if(!this._endsWithAWall)return;let hi=this._startX,_i=this._startY,pi=this._endX-hi,gi=this._endY-_i;pi&&(pi=pi/Math.abs(pi)),gi&&(gi=gi/Math.abs(gi));let mi=gi,xi=-pi;ci(this._endX+pi,this._endY+gi),ci(this._endX+mi,this._endY+xi),ci(this._endX-mi,this._endY-xi)}}class Uniform extends Dungeon{constructor(ci,hi,_i){super(ci,hi),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,_i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(ci){let hi=Date.now();for(;;){if(Date.now()-hi>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(ci)for(let _i=0;_i<this._width;_i++)for(let pi=0;pi<this._height;pi++)ci(_i,pi,this._map[_i][pi]);return this}_generateRooms(){let ci=this._width-2,hi=this._height-2,_i;do if(_i=this._generateRoom(),this._dug/(ci*hi)>this._options.roomDugPercentage)break;while(_i)}_generateRoom(){let ci=0;for(;ci<this._roomAttempts;){ci++;let hi=Room.createRandom(this._width,this._height,this._options);if(hi.isValid(this._isWallCallback,this._canBeDugCallback))return hi.create(this._digCallback),this._rooms.push(hi),hi}return null}_generateCorridors(){let ci=0;for(;ci<this._corridorAttempts;){ci++,this._corridors=[],this._map=this._fillMap(1);for(let hi=0;hi<this._rooms.length;hi++){let _i=this._rooms[hi];_i.clearDoors(),_i.create(this._digCallback)}for(this._unconnected=RNG$1.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let hi=RNG$1.getItem(this._connected);if(!hi)break;let _i=this._closestRoom(this._unconnected,hi);if(!_i)break;let pi=this._closestRoom(this._connected,_i);if(!pi||!this._connectRooms(_i,pi))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(ci,hi){let _i=1/0,pi=hi.getCenter(),gi=null;for(let mi=0;mi<ci.length;mi++){let xi=ci[mi],yi=xi.getCenter(),Ci=yi[0]-pi[0],Ei=yi[1]-pi[1],Ai=Ci*Ci+Ei*Ei;Ai<_i&&(_i=Ai,gi=xi)}return gi}_connectRooms(ci,hi){let _i=ci.getCenter(),pi=hi.getCenter(),gi=pi[0]-_i[0],mi=pi[1]-_i[1],xi,yi,Ci,Ei,Ai,ki,Pi;if(Math.abs(gi)<Math.abs(mi)?(Ci=mi>0?2:0,Ei=(Ci+2)%4,Ai=hi.getLeft(),ki=hi.getRight(),Pi=0):(Ci=gi>0?1:3,Ei=(Ci+2)%4,Ai=hi.getTop(),ki=hi.getBottom(),Pi=1),xi=this._placeInWall(ci,Ci),!xi)return!1;if(xi[Pi]>=Ai&&xi[Pi]<=ki){yi=xi.slice();let Ii=0;switch(Ei){case 0:Ii=hi.getTop()-1;break;case 1:Ii=hi.getRight()+1;break;case 2:Ii=hi.getBottom()+1;break;case 3:Ii=hi.getLeft()-1;break}yi[(Pi+1)%2]=Ii,this._digLine([xi,yi])}else if(xi[Pi]<Ai-1||xi[Pi]>ki+1){let Ii=xi[Pi]-pi[Pi],Di=0;switch(Ei){case 0:case 1:Di=Ii<0?3:1;break;case 2:case 3:Di=Ii<0?1:3;break}if(Ei=(Ei+Di)%4,yi=this._placeInWall(hi,Ei),!yi)return!1;let Fi=[0,0];Fi[Pi]=xi[Pi];let Li=(Pi+1)%2;Fi[Li]=yi[Li],this._digLine([xi,Fi,yi])}else{let Ii=(Pi+1)%2;if(yi=this._placeInWall(hi,Ei),!yi)return!1;let Di=Math.round((yi[Ii]+xi[Ii])/2),Fi=[0,0],Li=[0,0];Fi[Pi]=xi[Pi],Fi[Ii]=Di,Li[Pi]=yi[Pi],Li[Ii]=Di,this._digLine([xi,Fi,Li,yi])}return ci.addDoor(xi[0],xi[1]),hi.addDoor(yi[0],yi[1]),Pi=this._unconnected.indexOf(ci),Pi!=-1&&(this._unconnected.splice(Pi,1),this._connected.push(ci)),Pi=this._unconnected.indexOf(hi),Pi!=-1&&(this._unconnected.splice(Pi,1),this._connected.push(hi)),!0}_placeInWall(ci,hi){let _i=[0,0],pi=[0,0],gi=0;switch(hi){case 0:pi=[1,0],_i=[ci.getLeft(),ci.getTop()-1],gi=ci.getRight()-ci.getLeft()+1;break;case 1:pi=[0,1],_i=[ci.getRight()+1,ci.getTop()],gi=ci.getBottom()-ci.getTop()+1;break;case 2:pi=[1,0],_i=[ci.getLeft(),ci.getBottom()+1],gi=ci.getRight()-ci.getLeft()+1;break;case 3:pi=[0,1],_i=[ci.getLeft()-1,ci.getTop()],gi=ci.getBottom()-ci.getTop()+1;break}let mi=[],xi=-2;for(let yi=0;yi<gi;yi++){let Ci=_i[0]+yi*pi[0],Ei=_i[1]+yi*pi[1];mi.push(null),this._map[Ci][Ei]==1?xi!=yi-1&&(mi[yi]=[Ci,Ei]):(xi=yi,yi&&(mi[yi-1]=null))}for(let yi=mi.length-1;yi>=0;yi--)mi[yi]||mi.splice(yi,1);return mi.length?RNG$1.getItem(mi):null}_digLine(ci){for(let hi=1;hi<ci.length;hi++){let _i=ci[hi-1],pi=ci[hi],gi=new Corridor(_i[0],_i[1],pi[0],pi[1]);gi.create(this._digCallback),this._corridors.push(gi)}}_digCallback(ci,hi,_i){this._map[ci][hi]=_i,_i==0&&this._dug++}_isWallCallback(ci,hi){return ci<0||hi<0||ci>=this._width||hi>=this._height?!1:this._map[ci][hi]==1}_canBeDugCallback(ci,hi){return ci<1||hi<1||ci+1>=this._width||hi+1>=this._height?!1:this._map[ci][hi]==1}}class Cellular extends Map$2{constructor(ci,hi,_i={}){super(ci,hi),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(_i),this._dirs=DIRS[this._options.topology],this._map=this._fillMap(0)}randomize(ci){for(let hi=0;hi<this._width;hi++)for(let _i=0;_i<this._height;_i++)this._map[hi][_i]=RNG$1.getUniform()<ci?1:0;return this}setOptions(ci){Object.assign(this._options,ci)}set(ci,hi,_i){this._map[ci][hi]=_i}create(ci){let hi=this._fillMap(0),_i=this._options.born,pi=this._options.survive;for(let gi=0;gi<this._height;gi++){let mi=1,xi=0;this._options.topology==6&&(mi=2,xi=gi%2);for(let yi=xi;yi<this._width;yi+=mi){let Ci=this._map[yi][gi],Ei=this._getNeighbors(yi,gi);(Ci&&pi.indexOf(Ei)!=-1||!Ci&&_i.indexOf(Ei)!=-1)&&(hi[yi][gi]=1)}}this._map=hi,ci&&this._serviceCallback(ci)}_serviceCallback(ci){for(let hi=0;hi<this._height;hi++){let _i=1,pi=0;this._options.topology==6&&(_i=2,pi=hi%2);for(let gi=pi;gi<this._width;gi+=_i)ci(gi,hi,this._map[gi][hi])}}_getNeighbors(ci,hi){let _i=0;for(let pi=0;pi<this._dirs.length;pi++){let gi=this._dirs[pi],mi=ci+gi[0],xi=hi+gi[1];mi<0||mi>=this._width||xi<0||xi>=this._height||(_i+=this._map[mi][xi]==1?1:0)}return _i}connect(ci,hi,_i){hi||(hi=0);let pi=[],gi={},mi=1,xi=[0,0];this._options.topology==6&&(mi=2,xi=[0,1]);for(let Ai=0;Ai<this._height;Ai++)for(let ki=xi[Ai%2];ki<this._width;ki+=mi)if(this._freeSpace(ki,Ai,hi)){let Pi=[ki,Ai];gi[this._pointKey(Pi)]=Pi,pi.push([ki,Ai])}let yi=pi[RNG$1.getUniformInt(0,pi.length-1)],Ci=this._pointKey(yi),Ei={};for(Ei[Ci]=yi,delete gi[Ci],this._findConnected(Ei,gi,[yi],!1,hi);Object.keys(gi).length>0;){let Ai=this._getFromTo(Ei,gi),ki=Ai[0],Pi=Ai[1],Ii={};Ii[this._pointKey(ki)]=ki,this._findConnected(Ii,gi,[ki],!0,hi),(this._options.topology==6?this._tunnelToConnected6:this._tunnelToConnected).call(this,Pi,ki,Ei,gi,hi,_i);for(let Fi in Ii){let Li=Ii[Fi];this._map[Li[0]][Li[1]]=hi,Ei[Fi]=Li,delete gi[Fi]}}ci&&this._serviceCallback(ci)}_getFromTo(ci,hi){let _i=[0,0],pi=[0,0],gi,mi=Object.keys(ci),xi=Object.keys(hi);for(let yi=0;yi<5;yi++){if(mi.length<xi.length){let Ci=mi;pi=ci[Ci[RNG$1.getUniformInt(0,Ci.length-1)]],_i=this._getClosest(pi,hi)}else{let Ci=xi;_i=hi[Ci[RNG$1.getUniformInt(0,Ci.length-1)]],pi=this._getClosest(_i,ci)}if(gi=(_i[0]-pi[0])*(_i[0]-pi[0])+(_i[1]-pi[1])*(_i[1]-pi[1]),gi<64)break}return[_i,pi]}_getClosest(ci,hi){let _i=null,pi=null;for(let gi in hi){let mi=hi[gi],xi=(mi[0]-ci[0])*(mi[0]-ci[0])+(mi[1]-ci[1])*(mi[1]-ci[1]);(pi==null||xi<pi)&&(pi=xi,_i=mi)}return _i}_findConnected(ci,hi,_i,pi,gi){for(;_i.length>0;){let mi=_i.splice(0,1)[0],xi;this._options.topology==6?xi=[[mi[0]+2,mi[1]],[mi[0]+1,mi[1]-1],[mi[0]-1,mi[1]-1],[mi[0]-2,mi[1]],[mi[0]-1,mi[1]+1],[mi[0]+1,mi[1]+1]]:xi=[[mi[0]+1,mi[1]],[mi[0]-1,mi[1]],[mi[0],mi[1]+1],[mi[0],mi[1]-1]];for(let yi=0;yi<xi.length;yi++){let Ci=this._pointKey(xi[yi]);ci[Ci]==null&&this._freeSpace(xi[yi][0],xi[yi][1],gi)&&(ci[Ci]=xi[yi],pi||delete hi[Ci],_i.push(xi[yi]))}}}_tunnelToConnected(ci,hi,_i,pi,gi,mi){let xi,yi;hi[0]<ci[0]?(xi=hi,yi=ci):(xi=ci,yi=hi);for(let Ei=xi[0];Ei<=yi[0];Ei++){this._map[Ei][xi[1]]=gi;let Ai=[Ei,xi[1]],ki=this._pointKey(Ai);_i[ki]=Ai,delete pi[ki]}mi&&xi[0]<yi[0]&&mi(xi,[yi[0],xi[1]]);let Ci=yi[0];hi[1]<ci[1]?(xi=hi,yi=ci):(xi=ci,yi=hi);for(let Ei=xi[1];Ei<yi[1];Ei++){this._map[Ci][Ei]=gi;let Ai=[Ci,Ei],ki=this._pointKey(Ai);_i[ki]=Ai,delete pi[ki]}mi&&xi[1]<yi[1]&&mi([yi[0],xi[1]],[yi[0],yi[1]])}_tunnelToConnected6(ci,hi,_i,pi,gi,mi){let xi,yi;hi[0]<ci[0]?(xi=hi,yi=ci):(xi=ci,yi=hi);let Ci=xi[0],Ei=xi[1];for(;!(Ci==yi[0]&&Ei==yi[1]);){let Ai=2;Ei<yi[1]?(Ei++,Ai=1):Ei>yi[1]&&(Ei--,Ai=1),Ci<yi[0]?Ci+=Ai:Ci>yi[0]||yi[1]%2?Ci-=Ai:Ci+=Ai,this._map[Ci][Ei]=gi;let ki=[Ci,Ei],Pi=this._pointKey(ki);_i[Pi]=ki,delete pi[Pi]}mi&&mi(hi,ci)}_freeSpace(ci,hi,_i){return ci>=0&&ci<this._width&&hi>=0&&hi<this._height&&this._map[ci][hi]==_i}_pointKey(ci){return ci[0]+"."+ci[1]}}const FEATURES={room:Room,corridor:Corridor};class Digger extends Dungeon{constructor(ci,hi,_i={}){super(ci,hi),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},_i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(ci){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let hi=(this._width-2)*(this._height-2);this._firstRoom();let _i=Date.now(),pi;do{if(pi=0,Date.now()-_i>this._options.timeLimit)break;let mi=this._findWall();if(!mi)break;let xi=mi.split(","),yi=parseInt(xi[0]),Ci=parseInt(xi[1]),Ei=this._getDiggingDirection(yi,Ci);if(!Ei)continue;let Ai=0;do if(Ai++,this._tryFeature(yi,Ci,Ei[0],Ei[1])){this._removeSurroundingWalls(yi,Ci),this._removeSurroundingWalls(yi-Ei[0],Ci-Ei[1]);break}while(Ai<this._featureAttempts);for(let ki in this._walls)this._walls[ki]>1&&pi++}while(this._dug/hi<this._options.dugPercentage||pi);if(this._addDoors(),ci)for(let gi=0;gi<this._width;gi++)for(let mi=0;mi<this._height;mi++)ci(gi,mi,this._map[gi][mi]);return this._walls={},this._map=[],this}_digCallback(ci,hi,_i){_i==0||_i==2?(this._map[ci][hi]=0,this._dug++):this._walls[ci+","+hi]=1}_isWallCallback(ci,hi){return ci<0||hi<0||ci>=this._width||hi>=this._height?!1:this._map[ci][hi]==1}_canBeDugCallback(ci,hi){return ci<1||hi<1||ci+1>=this._width||hi+1>=this._height?!1:this._map[ci][hi]==1}_priorityWallCallback(ci,hi){this._walls[ci+","+hi]=2}_firstRoom(){let ci=Math.floor(this._width/2),hi=Math.floor(this._height/2),_i=Room.createRandomCenter(ci,hi,this._options);this._rooms.push(_i),_i.create(this._digCallback)}_findWall(){let ci=[],hi=[];for(let gi in this._walls)this._walls[gi]==2?hi.push(gi):ci.push(gi);let _i=hi.length?hi:ci;if(!_i.length)return null;let pi=RNG$1.getItem(_i.sort());return delete this._walls[pi],pi}_tryFeature(ci,hi,_i,pi){let gi=RNG$1.getWeightedValue(this._features),xi=FEATURES[gi].createRandomAt(ci,hi,_i,pi,this._options);return xi.isValid(this._isWallCallback,this._canBeDugCallback)?(xi.create(this._digCallback),xi instanceof Room&&this._rooms.push(xi),xi instanceof Corridor&&(xi.createPriorityWalls(this._priorityWallCallback),this._corridors.push(xi)),!0):!1}_removeSurroundingWalls(ci,hi){let _i=DIRS[4];for(let pi=0;pi<_i.length;pi++){let gi=_i[pi],mi=ci+gi[0],xi=hi+gi[1];delete this._walls[mi+","+xi],mi=ci+2*gi[0],xi=hi+2*gi[1],delete this._walls[mi+","+xi]}}_getDiggingDirection(ci,hi){if(ci<=0||hi<=0||ci>=this._width-1||hi>=this._height-1)return null;let _i=null,pi=DIRS[4];for(let gi=0;gi<pi.length;gi++){let mi=pi[gi],xi=ci+mi[0],yi=hi+mi[1];if(!this._map[xi][yi]){if(_i)return null;_i=mi}}return _i?[-_i[0],-_i[1]]:null}_addDoors(){let ci=this._map;function hi(_i,pi){return ci[_i][pi]==1}for(let _i=0;_i<this._rooms.length;_i++){let pi=this._rooms[_i];pi.clearDoors(),pi.addDoors(hi)}}}function addToList(fi,ci,hi){hi[ci[fi+1]]=hi[fi],ci[hi[fi]]=ci[fi+1],hi[fi]=fi+1,ci[fi+1]=fi}function removeFromList(fi,ci,hi){hi[ci[fi]]=hi[fi],ci[hi[fi]]=ci[fi],hi[fi]=fi,ci[fi]=fi}class EllerMaze extends Map$2{create(ci){let hi=this._fillMap(1),_i=Math.ceil((this._width-2)/2),pi=9/24,gi=[],mi=[];for(let yi=0;yi<_i;yi++)gi.push(yi),mi.push(yi);gi.push(_i-1);let xi;for(xi=1;xi+3<this._height;xi+=2)for(let yi=0;yi<_i;yi++){let Ci=2*yi+1,Ei=xi;hi[Ci][Ei]=0,yi!=gi[yi+1]&&RNG$1.getUniform()>pi&&(addToList(yi,gi,mi),hi[Ci+1][Ei]=0),yi!=gi[yi]&&RNG$1.getUniform()>pi?removeFromList(yi,gi,mi):hi[Ci][Ei+1]=0}for(let yi=0;yi<_i;yi++){let Ci=2*yi+1,Ei=xi;hi[Ci][Ei]=0,yi!=gi[yi+1]&&(yi==gi[yi]||RNG$1.getUniform()>pi)&&(addToList(yi,gi,mi),hi[Ci+1][Ei]=0),removeFromList(yi,gi,mi)}for(let yi=0;yi<this._width;yi++)for(let Ci=0;Ci<this._height;Ci++)ci(yi,Ci,hi[yi][Ci]);return this}}class DividedMaze extends Map$2{constructor(){super(...arguments),this._stack=[],this._map=[]}create(ci){let hi=this._width,_i=this._height;this._map=[];for(let pi=0;pi<hi;pi++){this._map.push([]);for(let gi=0;gi<_i;gi++){let mi=pi==0||gi==0||pi+1==hi||gi+1==_i;this._map[pi].push(mi?1:0)}}this._stack=[[1,1,hi-2,_i-2]],this._process();for(let pi=0;pi<hi;pi++)for(let gi=0;gi<_i;gi++)ci(pi,gi,this._map[pi][gi]);return this._map=[],this}_process(){for(;this._stack.length;){let ci=this._stack.shift();this._partitionRoom(ci)}}_partitionRoom(ci){let hi=[],_i=[];for(let Ci=ci[0]+1;Ci<ci[2];Ci++){let Ei=this._map[Ci][ci[1]-1],Ai=this._map[Ci][ci[3]+1];Ei&&Ai&&!(Ci%2)&&hi.push(Ci)}for(let Ci=ci[1]+1;Ci<ci[3];Ci++){let Ei=this._map[ci[0]-1][Ci],Ai=this._map[ci[2]+1][Ci];Ei&&Ai&&!(Ci%2)&&_i.push(Ci)}if(!hi.length||!_i.length)return;let pi=RNG$1.getItem(hi),gi=RNG$1.getItem(_i);this._map[pi][gi]=1;let mi=[],xi=[];mi.push(xi);for(let Ci=ci[0];Ci<pi;Ci++)this._map[Ci][gi]=1,Ci%2&&xi.push([Ci,gi]);xi=[],mi.push(xi);for(let Ci=pi+1;Ci<=ci[2];Ci++)this._map[Ci][gi]=1,Ci%2&&xi.push([Ci,gi]);xi=[],mi.push(xi);for(let Ci=ci[1];Ci<gi;Ci++)this._map[pi][Ci]=1,Ci%2&&xi.push([pi,Ci]);xi=[],mi.push(xi);for(let Ci=gi+1;Ci<=ci[3];Ci++)this._map[pi][Ci]=1,Ci%2&&xi.push([pi,Ci]);let yi=RNG$1.getItem(mi);for(let Ci=0;Ci<mi.length;Ci++){let Ei=mi[Ci];if(Ei==yi)continue;let Ai=RNG$1.getItem(Ei);this._map[Ai[0]][Ai[1]]=0}this._stack.push([ci[0],ci[1],pi-1,gi-1]),this._stack.push([pi+1,ci[1],ci[2],gi-1]),this._stack.push([ci[0],gi+1,pi-1,ci[3]]),this._stack.push([pi+1,gi+1,ci[2],ci[3]])}}class IceyMaze extends Map$2{constructor(ci,hi,_i=0){super(ci,hi),this._regularity=_i,this._map=[]}create(ci){let hi=this._width,_i=this._height,pi=this._fillMap(1);hi-=hi%2?1:2,_i-=_i%2?1:2;let gi=0,mi=0,xi=0,yi=0,Ci=0,Ei=!1,Ai=[[0,0],[0,0],[0,0],[0,0]];do if(gi=1+2*Math.floor(RNG$1.getUniform()*(hi-1)/2),mi=1+2*Math.floor(RNG$1.getUniform()*(_i-1)/2),Ci||(pi[gi][mi]=0),!pi[gi][mi]){this._randomize(Ai);do{Math.floor(RNG$1.getUniform()*(this._regularity+1))==0&&this._randomize(Ai),Ei=!0;for(let ki=0;ki<4;ki++)if(xi=gi+Ai[ki][0]*2,yi=mi+Ai[ki][1]*2,this._isFree(pi,xi,yi,hi,_i)){pi[xi][yi]=0,pi[gi+Ai[ki][0]][mi+Ai[ki][1]]=0,gi=xi,mi=yi,Ei=!1,Ci++;break}}while(!Ei)}while(Ci+1<hi*_i/4);for(let ki=0;ki<this._width;ki++)for(let Pi=0;Pi<this._height;Pi++)ci(ki,Pi,pi[ki][Pi]);return this._map=[],this}_randomize(ci){for(let hi=0;hi<4;hi++)ci[hi][0]=0,ci[hi][1]=0;switch(Math.floor(RNG$1.getUniform()*4)){case 0:ci[0][0]=-1,ci[1][0]=1,ci[2][1]=-1,ci[3][1]=1;break;case 1:ci[3][0]=-1,ci[2][0]=1,ci[1][1]=-1,ci[0][1]=1;break;case 2:ci[2][0]=-1,ci[3][0]=1,ci[0][1]=-1,ci[1][1]=1;break;case 3:ci[1][0]=-1,ci[0][0]=1,ci[3][1]=-1,ci[2][1]=1;break}}_isFree(ci,hi,_i,pi,gi){return hi<1||_i<1||hi>=pi||_i>=gi?!1:ci[hi][_i]}}class Rogue extends Map$2{constructor(ci,hi,_i){super(ci,hi),this.map=[],this.rooms=[],this.connectedCells=[],_i=Object.assign({cellWidth:3,cellHeight:3},_i),_i.hasOwnProperty("roomWidth")||(_i.roomWidth=this._calculateRoomSize(this._width,_i.cellWidth)),_i.hasOwnProperty("roomHeight")||(_i.roomHeight=this._calculateRoomSize(this._height,_i.cellHeight)),this._options=_i}create(ci){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),ci)for(let hi=0;hi<this._width;hi++)for(let _i=0;_i<this._height;_i++)ci(hi,_i,this.map[hi][_i]);return this}_calculateRoomSize(ci,hi){let _i=Math.floor(ci/hi*.8),pi=Math.floor(ci/hi*.25);return pi<2&&(pi=2),_i<2&&(_i=2),[pi,_i]}_initRooms(){for(let ci=0;ci<this._options.cellWidth;ci++){this.rooms.push([]);for(let hi=0;hi<this._options.cellHeight;hi++)this.rooms[ci].push({x:0,y:0,width:0,height:0,connections:[],cellx:ci,celly:hi})}}_connectRooms(){let ci=RNG$1.getUniformInt(0,this._options.cellWidth-1),hi=RNG$1.getUniformInt(0,this._options.cellHeight-1),_i,pi,gi,mi=!1,xi,yi,Ci;do{Ci=[0,2,4,6],Ci=RNG$1.shuffle(Ci);do if(mi=!1,_i=Ci.pop(),pi=ci+DIRS[8][_i][0],gi=hi+DIRS[8][_i][1],!(pi<0||pi>=this._options.cellWidth)&&!(gi<0||gi>=this._options.cellHeight)){if(xi=this.rooms[ci][hi],xi.connections.length>0&&xi.connections[0][0]==pi&&xi.connections[0][1]==gi)break;yi=this.rooms[pi][gi],yi.connections.length==0&&(yi.connections.push([ci,hi]),this.connectedCells.push([pi,gi]),ci=pi,hi=gi,mi=!0)}while(Ci.length>0&&mi==!1)}while(Ci.length>0)}_connectUnconnectedRooms(){let ci=this._options.cellWidth,hi=this._options.cellHeight;this.connectedCells=RNG$1.shuffle(this.connectedCells);let _i,pi,gi;for(let mi=0;mi<this._options.cellWidth;mi++)for(let xi=0;xi<this._options.cellHeight;xi++)if(_i=this.rooms[mi][xi],_i.connections.length==0){let yi=[0,2,4,6];yi=RNG$1.shuffle(yi),gi=!1;do{let Ci=yi.pop(),Ei=mi+DIRS[8][Ci][0],Ai=xi+DIRS[8][Ci][1];if(!(Ei<0||Ei>=ci||Ai<0||Ai>=hi)){if(pi=this.rooms[Ei][Ai],gi=!0,pi.connections.length==0)break;for(let ki=0;ki<pi.connections.length;ki++)if(pi.connections[ki][0]==mi&&pi.connections[ki][1]==xi){gi=!1;break}if(gi)break}}while(yi.length);gi?_i.connections.push([pi.cellx,pi.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let ci=this._width,hi=this._height,_i=this._options.cellWidth,pi=this._options.cellHeight,gi=Math.floor(this._width/_i),mi=Math.floor(this._height/pi),xi,yi,Ci=this._options.roomWidth,Ei=this._options.roomHeight,Ai,ki,Pi;for(let Ii=0;Ii<_i;Ii++)for(let Di=0;Di<pi;Di++){if(Ai=gi*Ii,ki=mi*Di,Ai==0&&(Ai=1),ki==0&&(ki=1),xi=RNG$1.getUniformInt(Ci[0],Ci[1]),yi=RNG$1.getUniformInt(Ei[0],Ei[1]),Di>0)for(Pi=this.rooms[Ii][Di-1];ki-(Pi.y+Pi.height)<3;)ki++;if(Ii>0)for(Pi=this.rooms[Ii-1][Di];Ai-(Pi.x+Pi.width)<3;)Ai++;let Fi=Math.round(RNG$1.getUniformInt(0,gi-xi)/2),Li=Math.round(RNG$1.getUniformInt(0,mi-yi)/2);for(;Ai+Fi+xi>=ci;)Fi?Fi--:xi--;for(;ki+Li+yi>=hi;)Li?Li--:yi--;Ai=Ai+Fi,ki=ki+Li,this.rooms[Ii][Di].x=Ai,this.rooms[Ii][Di].y=ki,this.rooms[Ii][Di].width=xi,this.rooms[Ii][Di].height=yi;for(let Bi=Ai;Bi<Ai+xi;Bi++)for(let Ri=ki;Ri<ki+yi;Ri++)this.map[Bi][Ri]=0}}_getWallPosition(ci,hi){let _i,pi,gi;return hi==1||hi==3?(_i=RNG$1.getUniformInt(ci.x+1,ci.x+ci.width-2),hi==1?(pi=ci.y-2,gi=pi+1):(pi=ci.y+ci.height+1,gi=pi-1),this.map[_i][gi]=0):(pi=RNG$1.getUniformInt(ci.y+1,ci.y+ci.height-2),hi==2?(_i=ci.x+ci.width+1,gi=_i-1):(_i=ci.x-2,gi=_i+1),this.map[gi][pi]=0),[_i,pi]}_drawCorridor(ci,hi){let _i=hi[0]-ci[0],pi=hi[1]-ci[1],gi=ci[0],mi=ci[1],xi,yi,Ci,Ei,Ai=[],ki=Math.abs(_i),Pi=Math.abs(pi),Ii=RNG$1.getUniform(),Di=Ii,Fi=1-Ii;for(yi=_i>0?2:6,Ci=pi>0?4:0,ki<Pi?(xi=Math.ceil(Pi*Di),Ai.push([Ci,xi]),Ai.push([yi,ki]),xi=Math.floor(Pi*Fi),Ai.push([Ci,xi])):(xi=Math.ceil(ki*Di),Ai.push([yi,xi]),Ai.push([Ci,Pi]),xi=Math.floor(ki*Fi),Ai.push([yi,xi])),this.map[gi][mi]=0;Ai.length>0;)for(Ei=Ai.pop();Ei[1]>0;)gi+=DIRS[8][Ei[0]][0],mi+=DIRS[8][Ei[0]][1],this.map[gi][mi]=0,Ei[1]=Ei[1]-1}_createCorridors(){let ci=this._options.cellWidth,hi=this._options.cellHeight,_i,pi,gi,mi,xi;for(let yi=0;yi<ci;yi++)for(let Ci=0;Ci<hi;Ci++){_i=this.rooms[yi][Ci];for(let Ei=0;Ei<_i.connections.length;Ei++)pi=_i.connections[Ei],gi=this.rooms[pi[0]][pi[1]],gi.cellx>_i.cellx?(mi=2,xi=4):gi.cellx<_i.cellx?(mi=4,xi=2):gi.celly>_i.celly?(mi=3,xi=1):(mi=1,xi=3),this._drawCorridor(this._getWallPosition(_i,mi),this._getWallPosition(gi,xi))}}}const Map$1={Arena,Uniform,Cellular,Digger,EllerMaze,DividedMaze,IceyMaze,Rogue},vsl0_map="/roke/assets/vsm0-CgGz3BuH.ldtk";function generateAutoLayerTiles(fi,ci,hi,_i,pi,gi){const mi=[];function xi(yi,Ci){return yi<0||yi>=hi||Ci<0||Ci>=_i?1:fi[Ci*hi+yi]}for(let yi=0;yi<_i;yi++)for(let Ci=0;Ci<hi;Ci++)for(const Ei of ci)if(Ei.active)for(const Ai of Ei.rules){if(!Ai.active)continue;let ki=!0;for(let Pi=0;Pi<Ai.size;Pi++){for(let Ii=0;Ii<Ai.size;Ii++){const Di=Ai.pattern[Pi*Ai.size+Ii],Fi=xi(Ci+(Ii-Math.floor(Ai.size/2)),yi+Pi-Math.floor(Ai.size/2));if(Di==-1&&Fi==1||Di==1&&Fi==0){ki=!1;break}}if(!ki)break}if(ki){const Pi=Ai.tileRectsIds[0],Ii=Ci*pi,Di=yi*pi;mi.push({px:[Ii,Di],src:[gi.sprites[Pi].sourceView.x,gi.sprites[Pi].sourceView.y],f:0,t:Pi,d:[Ci,yi],a:1});break}}return mi}async function calcAutoLayer(fi,ci,hi,_i,pi){const xi=(await(await fetch(vsl0_map)).json()).defs.layers[0].autoRuleGroups;return generateAutoLayerTiles(fi,xi,ci,hi,_i,pi)}class AutoMap extends bi{constructor(ci,hi){super(ci,hi)}async retile(ci=0){const hi=this.getIntGridLayers()[0].tilemap,_i=this.getIntGridLayers()[0].tileset;window.tileset=_i;const pi=hi.columns,gi=hi.rows;RNG$1.setSeed(ci);const mi=new Map$1.Uniform(pi,gi),xi=[];function yi(Ai,ki,Pi){hi.tiles[Ai+ki*pi].solid=Pi,xi[Ai+ki*pi]=Pi?1:0}mi.create(yi);const Ci=this.getIntGridLayers()[0].ldtkLayer;this.openSides(mi,yi);const Ei=await calcAutoLayer(xi,hi.columns,hi.rows,hi.tileWidth,_i.spritesheet);if(hi.tiles.forEach(Ai=>{Ai.clearGraphics()}),Ci.__tilesetDefUid){const Ai=this.tilesets.get(Ci.__tilesetDefUid);for(let ki=0;ki<Ei.length;ki++){const Pi=Ei[ki],Ii=Math.floor(Pi.px[0]/Ci.__gridSize),Di=Math.floor(Pi.px[1]/Ci.__gridSize),Fi=hi.getTile(Ii,Di);if(Fi&&Ai){const Li=Math.floor((Pi.src[0]-(Ai.ldtkTileset.padding??0))/(Ai.ldtkTileset.tileGridSize+(Ai.ldtkTileset.spacing??0))),Bi=Math.floor((Pi.src[1]-(Ai.ldtkTileset.padding??0))/(Ai.ldtkTileset.tileGridSize+(Ai.ldtkTileset.spacing??0))),Ri=!!(Pi.f&1),$i=!!(Pi.f&2);let Ni=Ai.spritesheet.getSprite(Li,Bi);(Ri||$i)&&(Ni=Ni.clone(),Ni.flipHorizontal=Ri,Ni.flipVertical=$i),Ni?Fi.addGraphic(Ni):console.error("Could not find sprite in LDtk spritesheet at",Li,Bi)}}}return mi}openSides(ci,hi){const _i=ci.getRooms();_i.sort((mi,xi)=>mi.getLeft()<xi.getLeft()?-1:1);const pi=_i[0],gi=_i[_i.length-1];for(let mi=pi.getLeft();mi>=0;mi--)hi(mi,pi.getBottom(),0);for(let mi=gi.getRight();mi<ci._width;mi++)hi(mi,gi.getBottom(),0)}}const idleMan0="/roke/assets/obj_Idle000-i9pCXwgB.png",idleMan1="/roke/assets/obj_Idle001-BRPWzyy5.png",idleMan2="/roke/assets/obj_Idle002-Ctd3xmyQ.png",idleMan3="/roke/assets/obj_Idle003-Bgcq_I2t.png",walkMan0="/roke/assets/obj_Walk000-CsY9yx1v.png",walkMan1="/roke/assets/obj_Walk001-DxlVFu8s.png",walkMan2="/roke/assets/obj_Walk002-DZrJYcyT.png",walkMan3="/roke/assets/obj_Walk003-C0ulW498.png",walkMan4="/roke/assets/obj_Walk004-BY9D8wIO.png",walkMan5="/roke/assets/obj_Walk005-CbI1zowy.png",walkMan6="/roke/assets/obj_Walk006-GQW229K6.png",walkMan7="/roke/assets/obj_Walk007-ALBjbHaj.png",runMan0="/roke/assets/obj_Run000-DgiSq-9B.png",runMan1="/roke/assets/obj_Run001-9jJOcIuM.png",runMan2="/roke/assets/obj_Run002-PIw5APUp.png",runMan3="/roke/assets/obj_Run003-DzI5jIj0.png",runMan4="/roke/assets/obj_Run004-D4NS3tiI.png",runMan5="/roke/assets/obj_Run005-eRZAf4eN.png",runMan6="/roke/assets/obj_Run006-BFLwEGbS.png",runMan7="/roke/assets/obj_Run007-D5C_OUBF.png",flyMan0="/roke/assets/obj_Flying000-C0v0O6eR.png",flyMan1="/roke/assets/obj_Flying001-DaKuWiBU.png",coin="/roke/assets/coins-CySCqBf3.png",portals="/roke/assets/portalsSpriteSheet-DCDMImtw.png",caverna="/roke/assets/Cavernas_by_Adam_Saltsman-CDCGIlrX.png",scifitm="/roke/assets/scifi_platformTiles_32x32-Bkxv9-UB.png",vsl0_level="/roke/assets/Level_0-CjkPGMIJ.ldtkl",cityBackFull="/roke/assets/10-CAUTu1f7.png",enter="/roke/assets/elemental-magic-spell-impact-outgoing-228342-6EDxYMfj.mp3",dsml1=new AutoMap(vsl0_map,{pathMap:[{path:"vsm0/Level_0.ldtk",output:vsl0_level},{path:"Cavernas_by_Adam_Saltsman.png",output:caverna},{path:"scifi_platformTiles_32x32.png",output:scifitm}]}),sounds={enter:new __webpack_exports__Sound(enter)},resources=[idleMan0,idleMan1,idleMan2,idleMan3,walkMan0,walkMan1,walkMan2,walkMan3,walkMan4,walkMan5,walkMan6,walkMan7,runMan0,runMan1,runMan2,runMan3,runMan4,runMan5,runMan6,runMan7,flyMan0,flyMan1,caverna,cityBackFull,scifitm,coin,portals].map(fi=>new __webpack_exports__ImageSource(fi));function resourceByPath(fi){return resources.find(ci=>ci.path===fi)}const click=100,idleMan=new __webpack_exports__Animation({frames:[idleMan0,idleMan1,idleMan2,idleMan3,idleMan2,idleMan1].map(fi=>({graphic:resourceByPath(fi).toSprite(),duration:click}))}),walkMan=new __webpack_exports__Animation({frames:[walkMan0,walkMan1,walkMan2,walkMan3,walkMan4,walkMan5,walkMan6,walkMan7].map(fi=>({graphic:resourceByPath(fi).toSprite(),duration:click}))}),runMan=new __webpack_exports__Animation({frames:[runMan0,runMan1,runMan2,runMan3,runMan4,runMan5,runMan6,runMan7].map(fi=>({graphic:resourceByPath(fi).toSprite(),duration:click}))}),flyMan=new __webpack_exports__Animation({frames:[flyMan0,flyMan1].map(fi=>({graphic:resourceByPath(fi).toSprite(),duration:click}))}),coinSheet=__webpack_exports__SpriteSheet.fromImageSource({image:resourceByPath(coin),grid:{rows:1,columns:8,spriteWidth:16,spriteHeight:16}}),portalSheet=__webpack_exports__SpriteSheet.fromImageSource({image:resourceByPath(portals),grid:{rows:4,columns:4,spriteWidth:32,spriteHeight:48}});__webpack_exports__Animation.fromSpriteSheet(coinSheet,__webpack_exports__range(0,7),200);const portalAnims=[__webpack_exports__Animation.fromSpriteSheet(portalSheet,__webpack_exports__range(0,3),100),__webpack_exports__Animation.fromSpriteSheet(portalSheet,__webpack_exports__range(4,7),100),__webpack_exports__Animation.fromSpriteSheet(portalSheet,__webpack_exports__range(8,11),100),__webpack_exports__Animation.fromSpriteSheet(portalSheet,__webpack_exports__range(12,15),100)];resourceByPath(cityBackFull).toSprite();const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function addPermission(){typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"&&(alert("El soporte de sensor de movimiento es experimental. Debes otorgar permiso para activar."),DeviceMotionEvent.requestPermission().then(fi=>{console.log("Permission status:",fi)}).catch(console.error))}const levels=[{level:"Level 0",name:"The Lobby",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:null,entrances:["The Frontrooms","Level 283"],entities:["Bacteria"],exits:["Level 1","Level 27","Level -12","Level -0","The Basement"]},{level:"Level 0.1",name:"Zenith Station",class:"0",class_details:"Safe, Secure, Devoid of Entities",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0","Level 1"]},{level:"Level 0.2",name:"Remodeled Mess",class:"3",class_details:"Unsafe, Secure, Low Entity Count",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0"]},{level:"Level 0.3",name:"The Icy Rooms",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:[null],entities:[null],entrances:["Level 0"],exits:["Level 0"]},{level:"Level 1",name:"Habitable Zone",class:1,class_details:"Safe, Secure, Minimal Entity Count",bases:["M.E.G.","B.N.T.G.","Tom's Diner"],entities:["Smilers","Skin-Stealers","Hounds","Dullers","Facelings"],entrances:["Level 0","Level 11.1","Level 92","Level 94"],exits:["Level 2","Level 19","Level Fun"]},{level:"Level 1.1",name:"Corrupted Corridor",class:"Variable",class_varible:["0","2","4","Deadzone","N/A"],class_details:"Varied Safety, Unsecured, Varied Entity Count",class_details_variable:["Safe, Secure, Devoid of Enetities","Unsafe, Secure, Low Entity Count","Unsafe, Unsecure, Medium Entity Count","Environmental Hazards, Strictly Uninhabitable, Potential for Anomalous Entities","Existence Unconfirmed, Likely Inaccessible, Unfit for Life"],bases:["M.E.G.","The Tunnel Gang","Outpost 1","Outpost 2","Outpost 3","Jakob's Hut","Outpost 4"],entities:["Smilers","Hounds","Skin-Stealers"],entrances:["level 1"],exits:["Level 1"]},{level:"Level 1.3",name:"Malignance",class:"0",class_details:"Safe, Secure, Devoid of Entities",bases:["The Ward"],entities:[null],entrances:[null],exits:[null]},{level:"Level 2",name:null,class:"Sigma",class_details:"Unreliable Files, Non-Euclidean Space, Unidentified Entities",bases:[null],entities:["The eternal nature of numbers"],entrances:["Level 81"],exits:["Level 1"]},{level:"Level 2",name:"Pipe Dreams",class:"3",class_details:"Unsafe, Unsecure, Low Entity Count",bases:["Followers of Jerry","M.E.G.","B.N.T.G."],entities:["Windows","Smilers","Deathmoths","Clumps","Jerry","Hounds","Facelings","Skin-Stealers","Wretches","Nguithr'xurhs","Deathrats","Cannibal Cuisines","Wranglers","Photoshop","Growlers","Swindlebirds"],entrances:["The Frontrooms","Level 1","Level 55","Level 287","Level 2.2","Level 8","Level 11","Level 43","Level 84","Level 127","Level 141","Level 158","Level 173","Level 309","Level 480","Level 522","Level 997"],exits:["Level 3","Level 4","Level 31","Level 127","Level 137","Level 70","Level 283","Level 101","Level 126","Level 141","Level 175","Level 997","Level 811","Level 998","The Hub","Level 606","Level 38","Level 64","Level 127","Level 158","Level 902","Level 189"]},{level:"Level 2.2",name:"Constant Buzz",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:[""],entities:["Phantom Bees","Smilers","Howlers","Lighters","Deathrats"],entrances:["Level 3"],exits:["Level 2","Level 3","Level 98"]},{level:" ",name:"Office Space EL3A",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:["B.N.T.G."],entities:["Smilers","Hounds","Skin-Stealers","Photoshop"],entrances:["Level 2"],exits:["Level 2"]},{level:"Level 3",name:"Electrical Station",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:["M.E.G.","B.N.T.G.","Followers of Jerry","The Masked Maidens","U.E.C."],entities:["Hounds","Facelings","Wretches","Deathmoths","Skin-Stealers","Dullers","Smilers","Clumps","Bursters","Crawler Fungus"],entrances:["Level 2","Level 4","Level 5","Level 10","Level 11","Level 13","The Metro"],exits:["Level 4","Level 5","Level 31","Level 69"]},{level:"Level 4",name:"Abandoned Office",class:"1",class_details:"Safe, Secure, Minimal Entity Count",bases:["M.E.G.","Amor Incrementum","T.B.D"],entities:["Hounds","Dullers"],entrances:["Level 3","The Hub","Level 2","Level 283"],exits:["Level 5","Level 6","Level 3","Level 71"]},{level:"Level 5",name:"Terror Hotel",class:"2",class_details:"Unsafe, Secure, Low Entity Count",bases:["M.E.G.","Homely Hotel","The Originals","The Lost Hall Society"],entities:["Deathmoths","Hounds","Woodlins","Skin-Stealers","Watchers","Nguithr'xurhs","Growlers","Deathrats","Wranglers","Samantha","Ants"],entrances:["Level 4","Level 3","Level 19","Level 126","Level 54","Level 10","Level 82","Level 92","Level 4.2"],exits:["Level 6","Level 3","Level 4","Level 9","Level 63","Level 98","Level 427","Level 40","Level 78","Level 84","Level 171"]},{level:"Level 6",name:"Lights Out",class:"Pending",class_details:"Safety Undetermined, Unsecured, Presence of Enetities Undetermined",bases:["The World's Quietest Room","Mimicry"],entities:[null],entrances:["Level 5","Level 4"],exits:["Level 7","Level 129","Level 6.1"]},{level:"Level 7",name:"Talassophobia",class:"4",class_details:"Unsafe, Unsecure, Medium Entity Count",bases:["Fort Surrender"],entities:["Tiny","The Thing On Level 7"],entrances:["Level 6","Level 8"],exits:["Level 8","Level 83","Level 9","Level 880"]},{level:"Level 8",name:"Cave System",class:"5",class_details:"Unsafe, Unsecure, Entity Infestation",bases:["M.E.G.","The Town of Kavragost"],entities:["Smilers","Skin-Stealers","Wretches","Camo Crawlers","Transporters","Deathmoths","Facelings","Hens","Hounds","Deathrats","Paralies","Clumps","Reviooks","Wranglers","Crawlers","Wranglers","Windows","Stalkers"],entrances:["Level 7","Level 103","Level 64","Level 135","Level 52","Level 283"],exits:["Level 9","Level 75","Level 2","Level 7","Level 91","Level 93","Level 205","Level 104","Level 69"]},{level:"",name:"",class:"",class_details:"",bases:[""],entities:[""],entrances:[""],exits:[""]}],VERSION="0.9.1";let auto=!1,kind,fetch$1,FormData$1,File$1,ReadableStream$1,getMultipartRequestOptions,getDefaultAgent,fileFromPath,isFsReadStream;function setShims(fi,ci={auto:!1}){if(auto)throw new Error(`you must \`import 'groq-sdk/shims/${fi.kind}'\` before importing anything else from groq-sdk`);if(kind)throw new Error(`can't \`import 'groq-sdk/shims/${fi.kind}'\` after \`import 'groq-sdk/shims/${kind}'\``);auto=ci.auto,kind=fi.kind,fetch$1=fi.fetch,FormData$1=fi.FormData,File$1=fi.File,ReadableStream$1=fi.ReadableStream,getMultipartRequestOptions=fi.getMultipartRequestOptions,getDefaultAgent=fi.getDefaultAgent,fileFromPath=fi.fileFromPath,isFsReadStream=fi.isFsReadStream}class MultipartBody{constructor(ci){this.body=ci}get[Symbol.toStringTag](){return"MultipartBody"}}function getRuntime({manuallyImported:fi}={}){const ci=fi?"You may need to use polyfills":"Add one of these imports before your first `import  from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n";let hi,_i,pi,gi;try{hi=fetch,_i=Request,pi=Response,gi=Headers}catch(mi){throw new Error(`this environment is missing the following Web Fetch API type: ${mi.message}. ${ci}`)}return{kind:"web",fetch:hi,Request:_i,Response:pi,Headers:gi,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${ci}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${ci}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${ci}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${ci}`)}},getMultipartRequestOptions:async(mi,xi)=>({...xi,body:new MultipartBody(mi)}),getDefaultAgent:mi=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:mi=>!1}}kind||setShims(getRuntime(),{auto:!0});class GroqError extends Error{}class APIError extends GroqError{constructor(ci,hi,_i,pi){super(`${APIError.makeMessage(ci,hi,_i)}`),this.status=ci,this.headers=pi,this.error=hi}static makeMessage(ci,hi,_i){const pi=hi!=null&&hi.message?typeof hi.message=="string"?hi.message:JSON.stringify(hi.message):hi?JSON.stringify(hi):_i;return ci&&pi?`${ci} ${pi}`:ci?`${ci} status code (no body)`:pi||"(no status code or body)"}static generate(ci,hi,_i,pi){if(!ci||!pi)return new APIConnectionError({message:_i,cause:castToError(hi)});const gi=hi;return ci===400?new BadRequestError(ci,gi,_i,pi):ci===401?new AuthenticationError(ci,gi,_i,pi):ci===403?new PermissionDeniedError(ci,gi,_i,pi):ci===404?new NotFoundError(ci,gi,_i,pi):ci===409?new ConflictError(ci,gi,_i,pi):ci===422?new UnprocessableEntityError(ci,gi,_i,pi):ci===429?new RateLimitError(ci,gi,_i,pi):ci>=500?new InternalServerError(ci,gi,_i,pi):new APIError(ci,gi,_i,pi)}}class APIUserAbortError extends APIError{constructor({message:ci}={}){super(void 0,void 0,ci||"Request was aborted.",void 0)}}class APIConnectionError extends APIError{constructor({message:ci,cause:hi}){super(void 0,void 0,ci||"Connection error.",void 0),hi&&(this.cause=hi)}}class APIConnectionTimeoutError extends APIConnectionError{constructor({message:ci}={}){super({message:ci??"Request timed out."})}}class BadRequestError extends APIError{}class AuthenticationError extends APIError{}class PermissionDeniedError extends APIError{}class NotFoundError extends APIError{}class ConflictError extends APIError{}class UnprocessableEntityError extends APIError{}class RateLimitError extends APIError{}class InternalServerError extends APIError{}class Stream{constructor(ci,hi){this.iterator=ci,this.controller=hi}static fromSSEResponse(ci,hi){let _i=!1;const pi=new SSEDecoder;async function*gi(){if(!ci.body)throw hi.abort(),new GroqError("Attempted to iterate over a response with no body");const xi=new LineDecoder,yi=readableStreamAsyncIterable(ci.body);for await(const Ci of yi)for(const Ei of xi.decode(Ci)){const Ai=pi.decode(Ei);Ai&&(yield Ai)}for(const Ci of xi.flush()){const Ei=pi.decode(Ci);Ei&&(yield Ei)}}async function*mi(){if(_i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");_i=!0;let xi=!1;try{for await(const yi of gi())if(!xi){if(yi.data.startsWith("[DONE]")){xi=!0;continue}if(yi.event===null||yi.event==="error"){let Ci;try{Ci=JSON.parse(yi.data)}catch(Ei){throw console.error("Could not parse message into JSON:",yi.data),console.error("From chunk:",yi.raw),Ei}if(Ci&&Ci.error)throw new APIError(Ci.error.status_code,Ci.error,Ci.error.message,void 0);yield Ci}}xi=!0}catch(yi){if(yi instanceof Error&&yi.name==="AbortError")return;throw yi}finally{xi||hi.abort()}}return new Stream(mi,hi)}static fromReadableStream(ci,hi){let _i=!1;async function*pi(){const mi=new LineDecoder,xi=readableStreamAsyncIterable(ci);for await(const yi of xi)for(const Ci of mi.decode(yi))yield Ci;for(const yi of mi.flush())yield yi}async function*gi(){if(_i)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");_i=!0;let mi=!1;try{for await(const xi of pi())mi||xi&&(yield JSON.parse(xi));mi=!0}catch(xi){if(xi instanceof Error&&xi.name==="AbortError")return;throw xi}finally{mi||hi.abort()}}return new Stream(gi,hi)}[Symbol.asyncIterator](){return this.iterator()}tee(){const ci=[],hi=[],_i=this.iterator(),pi=gi=>({next:()=>{if(gi.length===0){const mi=_i.next();ci.push(mi),hi.push(mi)}return gi.shift()}});return[new Stream(()=>pi(ci),this.controller),new Stream(()=>pi(hi),this.controller)]}toReadableStream(){const ci=this;let hi;const _i=new TextEncoder;return new ReadableStream$1({async start(){hi=ci[Symbol.asyncIterator]()},async pull(pi){try{const{value:gi,done:mi}=await hi.next();if(mi)return pi.close();const xi=_i.encode(JSON.stringify(gi)+`
`);pi.enqueue(xi)}catch(gi){pi.error(gi)}},async cancel(){var pi;await((pi=hi.return)==null?void 0:pi.call(hi))}})}}class SSEDecoder{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(ci){if(ci.endsWith("\r")&&(ci=ci.substring(0,ci.length-1)),!ci){if(!this.event&&!this.data.length)return null;const gi={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],gi}if(this.chunks.push(ci),ci.startsWith(":"))return null;let[hi,_i,pi]=partition(ci,":");return pi.startsWith(" ")&&(pi=pi.substring(1)),hi==="event"?this.event=pi:hi==="data"&&this.data.push(pi),null}}class LineDecoder{constructor(){this.buffer=[],this.trailingCR=!1}decode(ci){let hi=this.decodeText(ci);if(this.trailingCR&&(hi="\r"+hi,this.trailingCR=!1),hi.endsWith("\r")&&(this.trailingCR=!0,hi=hi.slice(0,-1)),!hi)return[];const _i=LineDecoder.NEWLINE_CHARS.has(hi[hi.length-1]||"");let pi=hi.split(LineDecoder.NEWLINE_REGEXP);return pi.length===1&&!_i?(this.buffer.push(pi[0]),[]):(this.buffer.length>0&&(pi=[this.buffer.join("")+pi[0],...pi.slice(1)],this.buffer=[]),_i||(this.buffer=[pi.pop()||""]),pi)}decodeText(ci){if(ci==null)return"";if(typeof ci=="string")return ci;if(typeof Buffer<"u"){if(ci instanceof Buffer)return ci.toString();if(ci instanceof Uint8Array)return Buffer.from(ci).toString();throw new GroqError(`Unexpected: received non-Uint8Array (${ci.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(ci instanceof Uint8Array||ci instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(ci);throw new GroqError(`Unexpected: received non-Uint8Array/ArrayBuffer (${ci.constructor.name}) in a web platform. Please report this error.`)}throw new GroqError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const ci=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,ci}}LineDecoder.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]);LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function partition(fi,ci){const hi=fi.indexOf(ci);return hi!==-1?[fi.substring(0,hi),ci,fi.substring(hi+ci.length)]:[fi,"",""]}function readableStreamAsyncIterable(fi){if(fi[Symbol.asyncIterator])return fi;const ci=fi.getReader();return{async next(){try{const hi=await ci.read();return hi!=null&&hi.done&&ci.releaseLock(),hi}catch(hi){throw ci.releaseLock(),hi}},async return(){const hi=ci.cancel();return ci.releaseLock(),await hi,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const isResponseLike=fi=>fi!=null&&typeof fi=="object"&&typeof fi.url=="string"&&typeof fi.blob=="function",isFileLike=fi=>fi!=null&&typeof fi=="object"&&typeof fi.name=="string"&&typeof fi.lastModified=="number"&&isBlobLike(fi),isBlobLike=fi=>fi!=null&&typeof fi=="object"&&typeof fi.size=="number"&&typeof fi.type=="string"&&typeof fi.text=="function"&&typeof fi.slice=="function"&&typeof fi.arrayBuffer=="function",isUploadable=fi=>isFileLike(fi)||isResponseLike(fi)||isFsReadStream(fi);async function toFile(fi,ci,hi){var pi;if(fi=await fi,isFileLike(fi))return fi;if(isResponseLike(fi)){const gi=await fi.blob();ci||(ci=new URL(fi.url).pathname.split(/[\\/]/).pop()??"unknown_file");const mi=isBlobLike(gi)?[await gi.arrayBuffer()]:[gi];return new File$1(mi,ci,hi)}const _i=await getBytes(fi);if(ci||(ci=getName(fi)??"unknown_file"),!(hi!=null&&hi.type)){const gi=(pi=_i[0])==null?void 0:pi.type;typeof gi=="string"&&(hi={...hi,type:gi})}return new File$1(_i,ci,hi)}async function getBytes(fi){var hi;let ci=[];if(typeof fi=="string"||ArrayBuffer.isView(fi)||fi instanceof ArrayBuffer)ci.push(fi);else if(isBlobLike(fi))ci.push(await fi.arrayBuffer());else if(isAsyncIterableIterator(fi))for await(const _i of fi)ci.push(_i);else throw new Error(`Unexpected data type: ${typeof fi}; constructor: ${(hi=fi==null?void 0:fi.constructor)==null?void 0:hi.name}; props: ${propsForError(fi)}`);return ci}function propsForError(fi){return`[${Object.getOwnPropertyNames(fi).map(hi=>`"${hi}"`).join(", ")}]`}function getName(fi){var ci;return getStringFromMaybeBuffer(fi.name)||getStringFromMaybeBuffer(fi.filename)||((ci=getStringFromMaybeBuffer(fi.path))==null?void 0:ci.split(/[\\/]/).pop())}const getStringFromMaybeBuffer=fi=>{if(typeof fi=="string")return fi;if(typeof Buffer<"u"&&fi instanceof Buffer)return String(fi)},isAsyncIterableIterator=fi=>fi!=null&&typeof fi=="object"&&typeof fi[Symbol.asyncIterator]=="function",isMultipartBody=fi=>fi&&typeof fi=="object"&&fi.body&&fi[Symbol.toStringTag]==="MultipartBody",multipartFormRequestOptions=async fi=>{const ci=await createForm(fi.body);return getMultipartRequestOptions(ci,fi)},createForm=async fi=>{const ci=new FormData$1;return await Promise.all(Object.entries(fi||{}).map(([hi,_i])=>addFormValue(ci,hi,_i))),ci},addFormValue=async(fi,ci,hi)=>{if(hi!==void 0){if(hi==null)throw new TypeError(`Received null for "${ci}"; to pass null in FormData, you must use the string 'null'`);if(typeof hi=="string"||typeof hi=="number"||typeof hi=="boolean")fi.append(ci,String(hi));else if(isUploadable(hi)){const _i=await toFile(hi);fi.append(ci,_i)}else if(Array.isArray(hi))await Promise.all(hi.map(_i=>addFormValue(fi,ci+"[]",_i)));else if(typeof hi=="object")await Promise.all(Object.entries(hi).map(([_i,pi])=>addFormValue(fi,`${ci}[${_i}]`,pi)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${hi} instead`)}};var define_process_env_default={};async function defaultParseResponse(fi){const{response:ci}=fi;if(fi.options.stream)return debug("response",ci.status,ci.url,ci.headers,ci.body),fi.options.__streamClass?fi.options.__streamClass.fromSSEResponse(ci,fi.controller):Stream.fromSSEResponse(ci,fi.controller);if(ci.status===204)return null;if(fi.options.__binaryResponse)return ci;const hi=ci.headers.get("content-type");if((hi==null?void 0:hi.includes("application/json"))||(hi==null?void 0:hi.includes("application/vnd.api+json"))){const gi=await ci.json();return debug("response",ci.status,ci.url,ci.headers,gi),gi}const pi=await ci.text();return debug("response",ci.status,ci.url,ci.headers,pi),pi}class APIPromise extends Promise{constructor(ci,hi=defaultParseResponse){super(_i=>{_i(null)}),this.responsePromise=ci,this.parseResponse=hi}_thenUnwrap(ci){return new APIPromise(this.responsePromise,async hi=>ci(await this.parseResponse(hi),hi))}asResponse(){return this.responsePromise.then(ci=>ci.response)}async withResponse(){const[ci,hi]=await Promise.all([this.parse(),this.asResponse()]);return{data:ci,response:hi}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(ci,hi){return this.parse().then(ci,hi)}catch(ci){return this.parse().catch(ci)}finally(ci){return this.parse().finally(ci)}}class APIClient{constructor({baseURL:ci,maxRetries:hi=2,timeout:_i=6e4,httpAgent:pi,fetch:gi}){this.baseURL=ci,this.maxRetries=validatePositiveInteger("maxRetries",hi),this.timeout=validatePositiveInteger("timeout",_i),this.httpAgent=pi,this.fetch=gi??fetch$1}authHeaders(ci){return{}}defaultHeaders(ci){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(ci)}}validateHeaders(ci,hi){}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}get(ci,hi){return this.methodRequest("get",ci,hi)}post(ci,hi){return this.methodRequest("post",ci,hi)}patch(ci,hi){return this.methodRequest("patch",ci,hi)}put(ci,hi){return this.methodRequest("put",ci,hi)}delete(ci,hi){return this.methodRequest("delete",ci,hi)}methodRequest(ci,hi,_i){return this.request(Promise.resolve(_i).then(async pi=>{const gi=pi&&isBlobLike(pi==null?void 0:pi.body)?new DataView(await pi.body.arrayBuffer()):(pi==null?void 0:pi.body)instanceof DataView?pi.body:(pi==null?void 0:pi.body)instanceof ArrayBuffer?new DataView(pi.body):pi&&ArrayBuffer.isView(pi==null?void 0:pi.body)?new DataView(pi.body.buffer):pi==null?void 0:pi.body;return{method:ci,path:hi,...pi,body:gi}}))}getAPIList(ci,hi,_i){return this.requestAPIList(hi,{method:"get",path:ci,..._i})}calculateContentLength(ci){if(typeof ci=="string"){if(typeof Buffer<"u")return Buffer.byteLength(ci,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(ci).length.toString()}else if(ArrayBuffer.isView(ci))return ci.byteLength.toString();return null}buildRequest(ci,{retryCount:hi=0}={}){var Di;const{method:_i,path:pi,query:gi,headers:mi={}}=ci,xi=ArrayBuffer.isView(ci.body)||ci.__binaryRequest&&typeof ci.body=="string"?ci.body:isMultipartBody(ci.body)?ci.body.body:ci.body?JSON.stringify(ci.body,null,2):null,yi=this.calculateContentLength(xi),Ci=this.buildURL(pi,gi);"timeout"in ci&&validatePositiveInteger("timeout",ci.timeout);const Ei=ci.timeout??this.timeout,Ai=ci.httpAgent??this.httpAgent??getDefaultAgent(Ci),ki=Ei+1e3;typeof((Di=Ai==null?void 0:Ai.options)==null?void 0:Di.timeout)=="number"&&ki>(Ai.options.timeout??0)&&(Ai.options.timeout=ki),this.idempotencyHeader&&_i!=="get"&&(ci.idempotencyKey||(ci.idempotencyKey=this.defaultIdempotencyKey()),mi[this.idempotencyHeader]=ci.idempotencyKey);const Pi=this.buildHeaders({options:ci,headers:mi,contentLength:yi,retryCount:hi});return{req:{method:_i,...xi&&{body:xi},headers:Pi,...Ai&&{agent:Ai},signal:ci.signal??null},url:Ci,timeout:Ei}}buildHeaders({options:ci,headers:hi,contentLength:_i,retryCount:pi}){const gi={};_i&&(gi["content-length"]=_i);const mi=this.defaultHeaders(ci);return applyHeadersMut(gi,mi),applyHeadersMut(gi,hi),isMultipartBody(ci.body)&&kind!=="node"&&delete gi["content-type"],getHeader(mi,"x-stainless-retry-count")===void 0&&getHeader(hi,"x-stainless-retry-count")===void 0&&(gi["x-stainless-retry-count"]=String(pi)),this.validateHeaders(gi,hi),gi}async prepareOptions(ci){}async prepareRequest(ci,{url:hi,options:_i}){}parseHeaders(ci){return ci?Symbol.iterator in ci?Object.fromEntries(Array.from(ci).map(hi=>[...hi])):{...ci}:{}}makeStatusError(ci,hi,_i,pi){return APIError.generate(ci,hi,_i,pi)}request(ci,hi=null){return new APIPromise(this.makeRequest(ci,hi))}async makeRequest(ci,hi){var Ai,ki;const _i=await ci,pi=_i.maxRetries??this.maxRetries;hi==null&&(hi=pi),await this.prepareOptions(_i);const{req:gi,url:mi,timeout:xi}=this.buildRequest(_i,{retryCount:pi-hi});if(await this.prepareRequest(gi,{url:mi,options:_i}),debug("request",mi,_i,gi.headers),(Ai=_i.signal)!=null&&Ai.aborted)throw new APIUserAbortError;const yi=new AbortController,Ci=await this.fetchWithTimeout(mi,gi,xi,yi).catch(castToError);if(Ci instanceof Error){if((ki=_i.signal)!=null&&ki.aborted)throw new APIUserAbortError;if(hi)return this.retryRequest(_i,hi);throw Ci.name==="AbortError"?new APIConnectionTimeoutError:new APIConnectionError({cause:Ci})}const Ei=createResponseHeaders(Ci.headers);if(!Ci.ok){if(hi&&this.shouldRetry(Ci)){const Bi=`retrying, ${hi} attempts remaining`;return debug(`response (error; ${Bi})`,Ci.status,mi,Ei),this.retryRequest(_i,hi,Ei)}const Pi=await Ci.text().catch(Bi=>castToError(Bi).message),Ii=safeJSON(Pi),Di=Ii?void 0:Pi;throw debug(`response (error; ${hi?"(error; no more retries left)":"(error; not retryable)"})`,Ci.status,mi,Ei,Di),this.makeStatusError(Ci.status,Ii,Di,Ei)}return{response:Ci,options:_i,controller:yi}}requestAPIList(ci,hi){const _i=this.makeRequest(hi,null);return new PagePromise(this,_i,ci)}buildURL(ci,hi){const _i=isAbsoluteURL(ci)?new URL(ci):new URL(this.baseURL+(this.baseURL.endsWith("/")&&ci.startsWith("/")?ci.slice(1):ci)),pi=this.defaultQuery();return isEmptyObj(pi)||(hi={...pi,...hi}),typeof hi=="object"&&hi&&!Array.isArray(hi)&&(_i.search=this.stringifyQuery(hi)),_i.toString()}stringifyQuery(ci){return Object.entries(ci).filter(([hi,_i])=>typeof _i<"u").map(([hi,_i])=>{if(typeof _i=="string"||typeof _i=="number"||typeof _i=="boolean")return`${encodeURIComponent(hi)}=${encodeURIComponent(_i)}`;if(_i===null)return`${encodeURIComponent(hi)}=`;throw new GroqError(`Cannot stringify type ${typeof _i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(ci,hi,_i,pi){const{signal:gi,...mi}=hi||{};gi&&gi.addEventListener("abort",()=>pi.abort());const xi=setTimeout(()=>pi.abort(),_i);return this.fetch.call(void 0,ci,{signal:pi.signal,...mi}).finally(()=>{clearTimeout(xi)})}shouldRetry(ci){const hi=ci.headers.get("x-should-retry");return hi==="true"?!0:hi==="false"?!1:ci.status===408||ci.status===409||ci.status===429||ci.status>=500}async retryRequest(ci,hi,_i){let pi;const gi=_i==null?void 0:_i["retry-after-ms"];if(gi){const xi=parseFloat(gi);Number.isNaN(xi)||(pi=xi)}const mi=_i==null?void 0:_i["retry-after"];if(mi&&!pi){const xi=parseFloat(mi);Number.isNaN(xi)?pi=Date.parse(mi)-Date.now():pi=xi*1e3}if(!(pi&&0<=pi&&pi<60*1e3)){const xi=ci.maxRetries??this.maxRetries;pi=this.calculateDefaultRetryTimeoutMillis(hi,xi)}return await sleep(pi),this.makeRequest(ci,hi-1)}calculateDefaultRetryTimeoutMillis(ci,hi){const gi=hi-ci,mi=Math.min(.5*Math.pow(2,gi),8),xi=1-Math.random()*.25;return mi*xi*1e3}getUserAgent(){return`${this.constructor.name}/JS ${VERSION}`}}class PagePromise extends APIPromise{constructor(ci,hi,_i){super(hi,async pi=>new _i(ci,pi.response,await defaultParseResponse(pi),pi.options))}async*[Symbol.asyncIterator](){const ci=await this;for await(const hi of ci)yield hi}}const createResponseHeaders=fi=>new Proxy(Object.fromEntries(fi.entries()),{get(ci,hi){const _i=hi.toString();return ci[_i.toLowerCase()]||ci[_i]}}),getPlatformProperties=()=>{var ci;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((ci=Deno.version)==null?void 0:ci.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":normalizePlatform(process.platform),"X-Stainless-Arch":normalizeArch(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const fi=getBrowserInfo();return fi?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${fi.browser}`,"X-Stainless-Runtime-Version":fi.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if(typeof navigator>"u"||!navigator)return null;const fi=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:ci,pattern:hi}of fi){const _i=hi.exec(navigator.userAgent);if(_i){const pi=_i[1]||0,gi=_i[2]||0,mi=_i[3]||0;return{browser:ci,version:`${pi}.${gi}.${mi}`}}}return null}const normalizeArch=fi=>fi==="x32"?"x32":fi==="x86_64"||fi==="x64"?"x64":fi==="arm"?"arm":fi==="aarch64"||fi==="arm64"?"arm64":fi?`other:${fi}`:"unknown",normalizePlatform=fi=>(fi=fi.toLowerCase(),fi.includes("ios")?"iOS":fi==="android"?"Android":fi==="darwin"?"MacOS":fi==="win32"?"Windows":fi==="freebsd"?"FreeBSD":fi==="openbsd"?"OpenBSD":fi==="linux"?"Linux":fi?`Other:${fi}`:"Unknown");let _platformHeaders;const getPlatformHeaders=()=>_platformHeaders??(_platformHeaders=getPlatformProperties()),safeJSON=fi=>{try{return JSON.parse(fi)}catch{return}},startsWithSchemeRegexp=/^[a-z][a-z0-9+.-]*:/i,isAbsoluteURL=fi=>startsWithSchemeRegexp.test(fi),sleep=fi=>new Promise(ci=>setTimeout(ci,fi)),validatePositiveInteger=(fi,ci)=>{if(typeof ci!="number"||!Number.isInteger(ci))throw new GroqError(`${fi} must be an integer`);if(ci<0)throw new GroqError(`${fi} must be a positive integer`);return ci},castToError=fi=>{if(fi instanceof Error)return fi;if(typeof fi=="object"&&fi!==null)try{return new Error(JSON.stringify(fi))}catch{}return new Error(fi)},readEnv=fi=>{var ci,hi,_i,pi;if(typeof process<"u")return((ci=define_process_env_default==null?void 0:define_process_env_default[fi])==null?void 0:ci.trim())??void 0;if(typeof Deno<"u")return(pi=(_i=(hi=Deno.env)==null?void 0:hi.get)==null?void 0:_i.call(hi,fi))==null?void 0:pi.trim()};function isEmptyObj(fi){if(!fi)return!0;for(const ci in fi)return!1;return!0}function hasOwn(fi,ci){return Object.prototype.hasOwnProperty.call(fi,ci)}function applyHeadersMut(fi,ci){for(const hi in ci){if(!hasOwn(ci,hi))continue;const _i=hi.toLowerCase();if(!_i)continue;const pi=ci[hi];pi===null?delete fi[_i]:pi!==void 0&&(fi[_i]=pi)}}function debug(fi,...ci){typeof process<"u"&&(define_process_env_default==null?void 0:define_process_env_default.DEBUG)==="true"&&console.log(`Groq:DEBUG:${fi}`,...ci)}const uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,fi=>{const ci=Math.random()*16|0;return(fi==="x"?ci:ci&3|8).toString(16)}),isRunningInBrowser=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",isHeadersProtocol=fi=>typeof(fi==null?void 0:fi.get)=="function",getHeader=(fi,ci)=>{var _i;const hi=ci.toLowerCase();if(isHeadersProtocol(fi)){const pi=((_i=ci[0])==null?void 0:_i.toUpperCase())+ci.substring(1).replace(/([^\w])(\w)/g,(gi,mi,xi)=>mi+xi.toUpperCase());for(const gi of[ci,hi,ci.toUpperCase(),pi]){const mi=fi.get(gi);if(mi)return mi}}for(const[pi,gi]of Object.entries(fi))if(pi.toLowerCase()===hi)return Array.isArray(gi)?(gi.length<=1||console.warn(`Received ${gi.length} entries for the ${ci} header, using the first entry.`),gi[0]):gi};class APIResource{constructor(ci){this._client=ci}}class Transcriptions extends APIResource{create(ci,hi){return this._client.post("/openai/v1/audio/transcriptions",multipartFormRequestOptions({body:ci,...hi}))}}class Translations extends APIResource{create(ci,hi){return this._client.post("/openai/v1/audio/translations",multipartFormRequestOptions({body:ci,...hi}))}}let Audio$1=class extends APIResource{constructor(){super(...arguments),this.transcriptions=new Transcriptions(this._client),this.translations=new Translations(this._client)}};Audio$1.Transcriptions=Transcriptions;Audio$1.Translations=Translations;let Completions$1=class extends APIResource{create(ci,hi){return this._client.post("/openai/v1/chat/completions",{body:ci,...hi,stream:ci.stream??!1})}};class Chat extends APIResource{constructor(){super(...arguments),this.completions=new Completions$1(this._client)}}Chat.Completions=Completions$1;class Completions extends APIResource{}class Embeddings extends APIResource{create(ci,hi){return this._client.post("/openai/v1/embeddings",{body:ci,...hi})}}class Models extends APIResource{retrieve(ci,hi){return this._client.get(`/openai/v1/models/${ci}`,hi)}list(ci){return this._client.get("/openai/v1/models",ci)}delete(ci,hi){return this._client.delete(`/openai/v1/models/${ci}`,hi)}}var _a;class Groq extends APIClient{constructor({baseURL:ci=readEnv("GROQ_BASE_URL"),apiKey:hi=readEnv("GROQ_API_KEY"),..._i}={}){if(hi===void 0)throw new GroqError("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");const pi={apiKey:hi,..._i,baseURL:ci||"https://api.groq.com"};if(!pi.dangerouslyAllowBrowser&&isRunningInBrowser())throw new GroqError(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:pi.baseURL,timeout:pi.timeout??6e4,httpAgent:pi.httpAgent,maxRetries:pi.maxRetries,fetch:pi.fetch}),this.completions=new Completions(this),this.chat=new Chat(this),this.embeddings=new Embeddings(this),this.audio=new Audio$1(this),this.models=new Models(this),this._options=pi,this.apiKey=hi}defaultQuery(){return this._options.defaultQuery}defaultHeaders(ci){return{...super.defaultHeaders(ci),...this._options.defaultHeaders}}authHeaders(ci){return{Authorization:`Bearer ${this.apiKey}`}}}_a=Groq;Groq.Groq=_a;Groq.DEFAULT_TIMEOUT=6e4;Groq.GroqError=GroqError;Groq.APIError=APIError;Groq.APIConnectionError=APIConnectionError;Groq.APIConnectionTimeoutError=APIConnectionTimeoutError;Groq.APIUserAbortError=APIUserAbortError;Groq.NotFoundError=NotFoundError;Groq.ConflictError=ConflictError;Groq.RateLimitError=RateLimitError;Groq.BadRequestError=BadRequestError;Groq.AuthenticationError=AuthenticationError;Groq.InternalServerError=InternalServerError;Groq.PermissionDeniedError=PermissionDeniedError;Groq.UnprocessableEntityError=UnprocessableEntityError;Groq.toFile=toFile;Groq.fileFromPath=fileFromPath;Groq.Completions=Completions;Groq.Chat=Chat;Groq.Embeddings=Embeddings;Groq.Audio=Audio$1;Groq.Models=Models;var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(fi){return fi&&fi.__esModule&&Object.prototype.hasOwnProperty.call(fi,"default")?fi.default:fi}var lodash={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */lodash.exports;(function(fi,ci){(function(){var hi,_i="4.17.21",pi=200,gi="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",mi="Expected a function",xi="Invalid `variable` option passed into `_.template`",yi="__lodash_hash_undefined__",Ci=500,Ei="__lodash_placeholder__",Ai=1,ki=2,Pi=4,Ii=1,Di=2,Fi=1,Li=2,Bi=4,Ri=8,$i=16,Ni=32,ji=64,Ui=128,qi=256,Ji=512,rs=30,ss="...",zi=800,Gi=16,Vi=1,Qi=2,is=3,Zi=1/0,ts=9007199254740991,cs=17976931348623157e292,ls=NaN,us=4294967295,fs=us-1,xs=us>>>1,bs=[["ary",Ui],["bind",Fi],["bindKey",Li],["curry",Ri],["curryRight",$i],["flip",Ji],["partial",Ni],["partialRight",ji],["rearg",qi]],Cs="[object Arguments]",Ds="[object Array]",Hs="[object AsyncFunction]",qs="[object Boolean]",Tn="[object Date]",dr="[object DOMException]",Qs="[object Error]",hn="[object Function]",Kn="[object GeneratorFunction]",ks="[object Map]",zs="[object Number]",ea="[object Null]",ir="[object Object]",El="[object Promise]",nu="[object Proxy]",jr="[object RegExp]",qn="[object Set]",qr="[object String]",uo="[object Symbol]",ru="[object Undefined]",Xr="[object WeakMap]",ou="[object WeakSet]",Zr="[object ArrayBuffer]",Rr="[object DataView]",ia="[object Float32Array]",sa="[object Float64Array]",na="[object Int8Array]",ra="[object Int16Array]",oa="[object Int32Array]",aa="[object Uint8Array]",la="[object Uint8ClampedArray]",ca="[object Uint16Array]",ha="[object Uint32Array]",au=/\b__p \+= '';/g,lu=/\b(__p \+=) '' \+/g,cu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Al=/&(?:amp|lt|gt|quot|#39);/g,kl=/[&<>"']/g,hu=RegExp(Al.source),uu=RegExp(kl.source),du=/<%-([\s\S]+?)%>/g,_u=/<%([\s\S]+?)%>/g,Tl=/<%=([\s\S]+?)%>/g,pu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,fu=/^\w*$/,gu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ua=/[\\^$.*+?()[\]{}|]/g,mu=RegExp(ua.source),da=/^\s+/,vu=/\s/,xu=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wu=/\{\n\/\* \[wrapped with (.+)\] \*/,bu=/,? & /,yu=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Cu=/[()=,{}\[\]\/\s]/,Su=/\\(\\)?/g,Eu=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pl=/\w*$/,Au=/^[-+]0x[0-9a-f]+$/i,ku=/^0b[01]+$/i,Tu=/^\[object .+?Constructor\]$/,Pu=/^0o[0-7]+$/i,Iu=/^(?:0|[1-9]\d*)$/,Ru=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_o=/($^)/,Du=/['\n\r\u2028\u2029\\]/g,po="\\ud800-\\udfff",Mu="\\u0300-\\u036f",Lu="\\ufe20-\\ufe2f",Fu="\\u20d0-\\u20ff",Il=Mu+Lu+Fu,Rl="\\u2700-\\u27bf",Dl="a-z\\xdf-\\xf6\\xf8-\\xff",Bu="\\xac\\xb1\\xd7\\xf7",$u="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ou="\\u2000-\\u206f",Uu=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ml="A-Z\\xc0-\\xd6\\xd8-\\xde",Ll="\\ufe0e\\ufe0f",Fl=Bu+$u+Ou+Uu,pa="[']",Gu="["+po+"]",Bl="["+Fl+"]",fo="["+Il+"]",$l="\\d+",Wu="["+Rl+"]",Ol="["+Dl+"]",Ul="[^"+po+Fl+$l+Rl+Dl+Ml+"]",fa="\\ud83c[\\udffb-\\udfff]",Nu="(?:"+fo+"|"+fa+")",Gl="[^"+po+"]",ga="(?:\\ud83c[\\udde6-\\uddff]){2}",ma="[\\ud800-\\udbff][\\udc00-\\udfff]",Dr="["+Ml+"]",Wl="\\u200d",Nl="(?:"+Ol+"|"+Ul+")",zu="(?:"+Dr+"|"+Ul+")",zl="(?:"+pa+"(?:d|ll|m|re|s|t|ve))?",Hl="(?:"+pa+"(?:D|LL|M|RE|S|T|VE))?",Vl=Nu+"?",jl="["+Ll+"]?",Hu="(?:"+Wl+"(?:"+[Gl,ga,ma].join("|")+")"+jl+Vl+")*",Vu="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ju="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ql=jl+Vl+Hu,qu="(?:"+[Wu,ga,ma].join("|")+")"+ql,Xu="(?:"+[Gl+fo+"?",fo,ga,ma,Gu].join("|")+")",Zu=RegExp(pa,"g"),Yu=RegExp(fo,"g"),va=RegExp(fa+"(?="+fa+")|"+Xu+ql,"g"),Qu=RegExp([Dr+"?"+Ol+"+"+zl+"(?="+[Bl,Dr,"$"].join("|")+")",zu+"+"+Hl+"(?="+[Bl,Dr+Nl,"$"].join("|")+")",Dr+"?"+Nl+"+"+zl,Dr+"+"+Hl,ju,Vu,$l,qu].join("|"),"g"),Ku=RegExp("["+Wl+po+Il+Ll+"]"),Ju=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,td=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ed=-1,$s={};$s[ia]=$s[sa]=$s[na]=$s[ra]=$s[oa]=$s[aa]=$s[la]=$s[ca]=$s[ha]=!0,$s[Cs]=$s[Ds]=$s[Zr]=$s[qs]=$s[Rr]=$s[Tn]=$s[Qs]=$s[hn]=$s[ks]=$s[zs]=$s[ir]=$s[jr]=$s[qn]=$s[qr]=$s[Xr]=!1;var Bs={};Bs[Cs]=Bs[Ds]=Bs[Zr]=Bs[Rr]=Bs[qs]=Bs[Tn]=Bs[ia]=Bs[sa]=Bs[na]=Bs[ra]=Bs[oa]=Bs[ks]=Bs[zs]=Bs[ir]=Bs[jr]=Bs[qn]=Bs[qr]=Bs[uo]=Bs[aa]=Bs[la]=Bs[ca]=Bs[ha]=!0,Bs[Qs]=Bs[hn]=Bs[Xr]=!1;var id={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},sd={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},nd={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},rd={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},od=parseFloat,ad=parseInt,Xl=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,ld=typeof self=="object"&&self&&self.Object===Object&&self,Zs=Xl||ld||Function("return this")(),xa=ci&&!ci.nodeType&&ci,yr=xa&&!0&&fi&&!fi.nodeType&&fi,Zl=yr&&yr.exports===xa,wa=Zl&&Xl.process,Un=function(){try{var Yi=yr&&yr.require&&yr.require("util").types;return Yi||wa&&wa.binding&&wa.binding("util")}catch{}}(),Yl=Un&&Un.isArrayBuffer,Ql=Un&&Un.isDate,Kl=Un&&Un.isMap,Jl=Un&&Un.isRegExp,tc=Un&&Un.isSet,ec=Un&&Un.isTypedArray;function Mn(Yi,ns,es){switch(es.length){case 0:return Yi.call(ns);case 1:return Yi.call(ns,es[0]);case 2:return Yi.call(ns,es[0],es[1]);case 3:return Yi.call(ns,es[0],es[1],es[2])}return Yi.apply(ns,es)}function cd(Yi,ns,es,_s){for(var ws=-1,Rs=Yi==null?0:Yi.length;++ws<Rs;){var Vs=Yi[ws];ns(_s,Vs,es(Vs),Yi)}return _s}function Gn(Yi,ns){for(var es=-1,_s=Yi==null?0:Yi.length;++es<_s&&ns(Yi[es],es,Yi)!==!1;);return Yi}function hd(Yi,ns){for(var es=Yi==null?0:Yi.length;es--&&ns(Yi[es],es,Yi)!==!1;);return Yi}function ic(Yi,ns){for(var es=-1,_s=Yi==null?0:Yi.length;++es<_s;)if(!ns(Yi[es],es,Yi))return!1;return!0}function _r(Yi,ns){for(var es=-1,_s=Yi==null?0:Yi.length,ws=0,Rs=[];++es<_s;){var Vs=Yi[es];ns(Vs,es,Yi)&&(Rs[ws++]=Vs)}return Rs}function go(Yi,ns){var es=Yi==null?0:Yi.length;return!!es&&Mr(Yi,ns,0)>-1}function ba(Yi,ns,es){for(var _s=-1,ws=Yi==null?0:Yi.length;++_s<ws;)if(es(ns,Yi[_s]))return!0;return!1}function Os(Yi,ns){for(var es=-1,_s=Yi==null?0:Yi.length,ws=Array(_s);++es<_s;)ws[es]=ns(Yi[es],es,Yi);return ws}function pr(Yi,ns){for(var es=-1,_s=ns.length,ws=Yi.length;++es<_s;)Yi[ws+es]=ns[es];return Yi}function ya(Yi,ns,es,_s){var ws=-1,Rs=Yi==null?0:Yi.length;for(_s&&Rs&&(es=Yi[++ws]);++ws<Rs;)es=ns(es,Yi[ws],ws,Yi);return es}function ud(Yi,ns,es,_s){var ws=Yi==null?0:Yi.length;for(_s&&ws&&(es=Yi[--ws]);ws--;)es=ns(es,Yi[ws],ws,Yi);return es}function Ca(Yi,ns){for(var es=-1,_s=Yi==null?0:Yi.length;++es<_s;)if(ns(Yi[es],es,Yi))return!0;return!1}var dd=Sa("length");function _d(Yi){return Yi.split("")}function pd(Yi){return Yi.match(yu)||[]}function sc(Yi,ns,es){var _s;return es(Yi,function(ws,Rs,Vs){if(ns(ws,Rs,Vs))return _s=Rs,!1}),_s}function mo(Yi,ns,es,_s){for(var ws=Yi.length,Rs=es+(_s?1:-1);_s?Rs--:++Rs<ws;)if(ns(Yi[Rs],Rs,Yi))return Rs;return-1}function Mr(Yi,ns,es){return ns===ns?Ad(Yi,ns,es):mo(Yi,nc,es)}function fd(Yi,ns,es,_s){for(var ws=es-1,Rs=Yi.length;++ws<Rs;)if(_s(Yi[ws],ns))return ws;return-1}function nc(Yi){return Yi!==Yi}function rc(Yi,ns){var es=Yi==null?0:Yi.length;return es?Aa(Yi,ns)/es:ls}function Sa(Yi){return function(ns){return ns==null?hi:ns[Yi]}}function Ea(Yi){return function(ns){return Yi==null?hi:Yi[ns]}}function oc(Yi,ns,es,_s,ws){return ws(Yi,function(Rs,Vs,Fs){es=_s?(_s=!1,Rs):ns(es,Rs,Vs,Fs)}),es}function gd(Yi,ns){var es=Yi.length;for(Yi.sort(ns);es--;)Yi[es]=Yi[es].value;return Yi}function Aa(Yi,ns){for(var es,_s=-1,ws=Yi.length;++_s<ws;){var Rs=ns(Yi[_s]);Rs!==hi&&(es=es===hi?Rs:es+Rs)}return es}function ka(Yi,ns){for(var es=-1,_s=Array(Yi);++es<Yi;)_s[es]=ns(es);return _s}function md(Yi,ns){return Os(ns,function(es){return[es,Yi[es]]})}function ac(Yi){return Yi&&Yi.slice(0,uc(Yi)+1).replace(da,"")}function Ln(Yi){return function(ns){return Yi(ns)}}function Ta(Yi,ns){return Os(ns,function(es){return Yi[es]})}function Yr(Yi,ns){return Yi.has(ns)}function lc(Yi,ns){for(var es=-1,_s=Yi.length;++es<_s&&Mr(ns,Yi[es],0)>-1;);return es}function cc(Yi,ns){for(var es=Yi.length;es--&&Mr(ns,Yi[es],0)>-1;);return es}function vd(Yi,ns){for(var es=Yi.length,_s=0;es--;)Yi[es]===ns&&++_s;return _s}var xd=Ea(id),wd=Ea(sd);function bd(Yi){return"\\"+rd[Yi]}function yd(Yi,ns){return Yi==null?hi:Yi[ns]}function Lr(Yi){return Ku.test(Yi)}function Cd(Yi){return Ju.test(Yi)}function Sd(Yi){for(var ns,es=[];!(ns=Yi.next()).done;)es.push(ns.value);return es}function Pa(Yi){var ns=-1,es=Array(Yi.size);return Yi.forEach(function(_s,ws){es[++ns]=[ws,_s]}),es}function hc(Yi,ns){return function(es){return Yi(ns(es))}}function fr(Yi,ns){for(var es=-1,_s=Yi.length,ws=0,Rs=[];++es<_s;){var Vs=Yi[es];(Vs===ns||Vs===Ei)&&(Yi[es]=Ei,Rs[ws++]=es)}return Rs}function vo(Yi){var ns=-1,es=Array(Yi.size);return Yi.forEach(function(_s){es[++ns]=_s}),es}function Ed(Yi){var ns=-1,es=Array(Yi.size);return Yi.forEach(function(_s){es[++ns]=[_s,_s]}),es}function Ad(Yi,ns,es){for(var _s=es-1,ws=Yi.length;++_s<ws;)if(Yi[_s]===ns)return _s;return-1}function kd(Yi,ns,es){for(var _s=es+1;_s--;)if(Yi[_s]===ns)return _s;return _s}function Fr(Yi){return Lr(Yi)?Pd(Yi):dd(Yi)}function Xn(Yi){return Lr(Yi)?Id(Yi):_d(Yi)}function uc(Yi){for(var ns=Yi.length;ns--&&vu.test(Yi.charAt(ns)););return ns}var Td=Ea(nd);function Pd(Yi){for(var ns=va.lastIndex=0;va.test(Yi);)++ns;return ns}function Id(Yi){return Yi.match(va)||[]}function Rd(Yi){return Yi.match(Qu)||[]}var Dd=function Yi(ns){ns=ns==null?Zs:Br.defaults(Zs.Object(),ns,Br.pick(Zs,td));var es=ns.Array,_s=ns.Date,ws=ns.Error,Rs=ns.Function,Vs=ns.Math,Fs=ns.Object,Ia=ns.RegExp,Md=ns.String,Wn=ns.TypeError,xo=es.prototype,Ld=Rs.prototype,$r=Fs.prototype,wo=ns["__core-js_shared__"],bo=Ld.toString,Ls=$r.hasOwnProperty,Fd=0,dc=function(){var vi=/[^.]+$/.exec(wo&&wo.keys&&wo.keys.IE_PROTO||"");return vi?"Symbol(src)_1."+vi:""}(),yo=$r.toString,Bd=bo.call(Fs),$d=Zs._,Od=Ia("^"+bo.call(Ls).replace(ua,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Co=Zl?ns.Buffer:hi,gr=ns.Symbol,So=ns.Uint8Array,_c=Co?Co.allocUnsafe:hi,Eo=hc(Fs.getPrototypeOf,Fs),pc=Fs.create,fc=$r.propertyIsEnumerable,Ao=xo.splice,gc=gr?gr.isConcatSpreadable:hi,Qr=gr?gr.iterator:hi,Cr=gr?gr.toStringTag:hi,ko=function(){try{var vi=Tr(Fs,"defineProperty");return vi({},"",{}),vi}catch{}}(),Ud=ns.clearTimeout!==Zs.clearTimeout&&ns.clearTimeout,Gd=_s&&_s.now!==Zs.Date.now&&_s.now,Wd=ns.setTimeout!==Zs.setTimeout&&ns.setTimeout,To=Vs.ceil,Po=Vs.floor,Ra=Fs.getOwnPropertySymbols,Nd=Co?Co.isBuffer:hi,mc=ns.isFinite,zd=xo.join,Hd=hc(Fs.keys,Fs),js=Vs.max,Ks=Vs.min,Vd=_s.now,jd=ns.parseInt,vc=Vs.random,qd=xo.reverse,Da=Tr(ns,"DataView"),Kr=Tr(ns,"Map"),Ma=Tr(ns,"Promise"),Or=Tr(ns,"Set"),Jr=Tr(ns,"WeakMap"),to=Tr(Fs,"create"),Io=Jr&&new Jr,Ur={},Xd=Pr(Da),Zd=Pr(Kr),Yd=Pr(Ma),Qd=Pr(Or),Kd=Pr(Jr),Ro=gr?gr.prototype:hi,eo=Ro?Ro.valueOf:hi,xc=Ro?Ro.toString:hi;function Oi(vi){if(Gs(vi)&&!ys(vi)&&!(vi instanceof Ps)){if(vi instanceof Nn)return vi;if(Ls.call(vi,"__wrapped__"))return wh(vi)}return new Nn(vi)}var Gr=function(){function vi(){}return function(wi){if(!Us(wi))return{};if(pc)return pc(wi);vi.prototype=wi;var Si=new vi;return vi.prototype=hi,Si}}();function Do(){}function Nn(vi,wi){this.__wrapped__=vi,this.__actions__=[],this.__chain__=!!wi,this.__index__=0,this.__values__=hi}Oi.templateSettings={escape:du,evaluate:_u,interpolate:Tl,variable:"",imports:{_:Oi}},Oi.prototype=Do.prototype,Oi.prototype.constructor=Oi,Nn.prototype=Gr(Do.prototype),Nn.prototype.constructor=Nn;function Ps(vi){this.__wrapped__=vi,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=us,this.__views__=[]}function Jd(){var vi=new Ps(this.__wrapped__);return vi.__actions__=Pn(this.__actions__),vi.__dir__=this.__dir__,vi.__filtered__=this.__filtered__,vi.__iteratees__=Pn(this.__iteratees__),vi.__takeCount__=this.__takeCount__,vi.__views__=Pn(this.__views__),vi}function t_(){if(this.__filtered__){var vi=new Ps(this);vi.__dir__=-1,vi.__filtered__=!0}else vi=this.clone(),vi.__dir__*=-1;return vi}function e_(){var vi=this.__wrapped__.value(),wi=this.__dir__,Si=ys(vi),Ti=wi<0,Mi=Si?vi.length:0,Wi=_p(0,Mi,this.__views__),Hi=Wi.start,Xi=Wi.end,Ki=Xi-Hi,os=Ti?Xi:Hi-1,as=this.__iteratees__,hs=as.length,ds=0,ps=Ks(Ki,this.__takeCount__);if(!Si||!Ti&&Mi==Ki&&ps==Ki)return zc(vi,this.__actions__);var ms=[];t:for(;Ki--&&ds<ps;){os+=wi;for(var Es=-1,vs=vi[os];++Es<hs;){var Ts=as[Es],Is=Ts.iteratee,$n=Ts.type,kn=Is(vs);if($n==Qi)vs=kn;else if(!kn){if($n==Vi)continue t;break t}}ms[ds++]=vs}return ms}Ps.prototype=Gr(Do.prototype),Ps.prototype.constructor=Ps;function Sr(vi){var wi=-1,Si=vi==null?0:vi.length;for(this.clear();++wi<Si;){var Ti=vi[wi];this.set(Ti[0],Ti[1])}}function i_(){this.__data__=to?to(null):{},this.size=0}function s_(vi){var wi=this.has(vi)&&delete this.__data__[vi];return this.size-=wi?1:0,wi}function n_(vi){var wi=this.__data__;if(to){var Si=wi[vi];return Si===yi?hi:Si}return Ls.call(wi,vi)?wi[vi]:hi}function r_(vi){var wi=this.__data__;return to?wi[vi]!==hi:Ls.call(wi,vi)}function o_(vi,wi){var Si=this.__data__;return this.size+=this.has(vi)?0:1,Si[vi]=to&&wi===hi?yi:wi,this}Sr.prototype.clear=i_,Sr.prototype.delete=s_,Sr.prototype.get=n_,Sr.prototype.has=r_,Sr.prototype.set=o_;function sr(vi){var wi=-1,Si=vi==null?0:vi.length;for(this.clear();++wi<Si;){var Ti=vi[wi];this.set(Ti[0],Ti[1])}}function a_(){this.__data__=[],this.size=0}function l_(vi){var wi=this.__data__,Si=Mo(wi,vi);if(Si<0)return!1;var Ti=wi.length-1;return Si==Ti?wi.pop():Ao.call(wi,Si,1),--this.size,!0}function c_(vi){var wi=this.__data__,Si=Mo(wi,vi);return Si<0?hi:wi[Si][1]}function h_(vi){return Mo(this.__data__,vi)>-1}function u_(vi,wi){var Si=this.__data__,Ti=Mo(Si,vi);return Ti<0?(++this.size,Si.push([vi,wi])):Si[Ti][1]=wi,this}sr.prototype.clear=a_,sr.prototype.delete=l_,sr.prototype.get=c_,sr.prototype.has=h_,sr.prototype.set=u_;function nr(vi){var wi=-1,Si=vi==null?0:vi.length;for(this.clear();++wi<Si;){var Ti=vi[wi];this.set(Ti[0],Ti[1])}}function d_(){this.size=0,this.__data__={hash:new Sr,map:new(Kr||sr),string:new Sr}}function __(vi){var wi=Vo(this,vi).delete(vi);return this.size-=wi?1:0,wi}function p_(vi){return Vo(this,vi).get(vi)}function f_(vi){return Vo(this,vi).has(vi)}function g_(vi,wi){var Si=Vo(this,vi),Ti=Si.size;return Si.set(vi,wi),this.size+=Si.size==Ti?0:1,this}nr.prototype.clear=d_,nr.prototype.delete=__,nr.prototype.get=p_,nr.prototype.has=f_,nr.prototype.set=g_;function Er(vi){var wi=-1,Si=vi==null?0:vi.length;for(this.__data__=new nr;++wi<Si;)this.add(vi[wi])}function m_(vi){return this.__data__.set(vi,yi),this}function v_(vi){return this.__data__.has(vi)}Er.prototype.add=Er.prototype.push=m_,Er.prototype.has=v_;function Zn(vi){var wi=this.__data__=new sr(vi);this.size=wi.size}function x_(){this.__data__=new sr,this.size=0}function w_(vi){var wi=this.__data__,Si=wi.delete(vi);return this.size=wi.size,Si}function b_(vi){return this.__data__.get(vi)}function y_(vi){return this.__data__.has(vi)}function C_(vi,wi){var Si=this.__data__;if(Si instanceof sr){var Ti=Si.__data__;if(!Kr||Ti.length<pi-1)return Ti.push([vi,wi]),this.size=++Si.size,this;Si=this.__data__=new nr(Ti)}return Si.set(vi,wi),this.size=Si.size,this}Zn.prototype.clear=x_,Zn.prototype.delete=w_,Zn.prototype.get=b_,Zn.prototype.has=y_,Zn.prototype.set=C_;function wc(vi,wi){var Si=ys(vi),Ti=!Si&&Ir(vi),Mi=!Si&&!Ti&&br(vi),Wi=!Si&&!Ti&&!Mi&&Hr(vi),Hi=Si||Ti||Mi||Wi,Xi=Hi?ka(vi.length,Md):[],Ki=Xi.length;for(var os in vi)(wi||Ls.call(vi,os))&&!(Hi&&(os=="length"||Mi&&(os=="offset"||os=="parent")||Wi&&(os=="buffer"||os=="byteLength"||os=="byteOffset")||lr(os,Ki)))&&Xi.push(os);return Xi}function bc(vi){var wi=vi.length;return wi?vi[Ha(0,wi-1)]:hi}function S_(vi,wi){return jo(Pn(vi),Ar(wi,0,vi.length))}function E_(vi){return jo(Pn(vi))}function La(vi,wi,Si){(Si!==hi&&!Yn(vi[wi],Si)||Si===hi&&!(wi in vi))&&rr(vi,wi,Si)}function io(vi,wi,Si){var Ti=vi[wi];(!(Ls.call(vi,wi)&&Yn(Ti,Si))||Si===hi&&!(wi in vi))&&rr(vi,wi,Si)}function Mo(vi,wi){for(var Si=vi.length;Si--;)if(Yn(vi[Si][0],wi))return Si;return-1}function A_(vi,wi,Si,Ti){return mr(vi,function(Mi,Wi,Hi){wi(Ti,Mi,Si(Mi),Hi)}),Ti}function yc(vi,wi){return vi&&tr(wi,Xs(wi),vi)}function k_(vi,wi){return vi&&tr(wi,Rn(wi),vi)}function rr(vi,wi,Si){wi=="__proto__"&&ko?ko(vi,wi,{configurable:!0,enumerable:!0,value:Si,writable:!0}):vi[wi]=Si}function Fa(vi,wi){for(var Si=-1,Ti=wi.length,Mi=es(Ti),Wi=vi==null;++Si<Ti;)Mi[Si]=Wi?hi:fl(vi,wi[Si]);return Mi}function Ar(vi,wi,Si){return vi===vi&&(Si!==hi&&(vi=vi<=Si?vi:Si),wi!==hi&&(vi=vi>=wi?vi:wi)),vi}function zn(vi,wi,Si,Ti,Mi,Wi){var Hi,Xi=wi&Ai,Ki=wi&ki,os=wi&Pi;if(Si&&(Hi=Mi?Si(vi,Ti,Mi,Wi):Si(vi)),Hi!==hi)return Hi;if(!Us(vi))return vi;var as=ys(vi);if(as){if(Hi=fp(vi),!Xi)return Pn(vi,Hi)}else{var hs=Js(vi),ds=hs==hn||hs==Kn;if(br(vi))return jc(vi,Xi);if(hs==ir||hs==Cs||ds&&!Mi){if(Hi=Ki||ds?{}:uh(vi),!Xi)return Ki?np(vi,k_(Hi,vi)):sp(vi,yc(Hi,vi))}else{if(!Bs[hs])return Mi?vi:{};Hi=gp(vi,hs,Xi)}}Wi||(Wi=new Zn);var ps=Wi.get(vi);if(ps)return ps;Wi.set(vi,Hi),Gh(vi)?vi.forEach(function(vs){Hi.add(zn(vs,wi,Si,vs,vi,Wi))}):Oh(vi)&&vi.forEach(function(vs,Ts){Hi.set(Ts,zn(vs,wi,Si,Ts,vi,Wi))});var ms=os?Ki?el:tl:Ki?Rn:Xs,Es=as?hi:ms(vi);return Gn(Es||vi,function(vs,Ts){Es&&(Ts=vs,vs=vi[Ts]),io(Hi,Ts,zn(vs,wi,Si,Ts,vi,Wi))}),Hi}function T_(vi){var wi=Xs(vi);return function(Si){return Cc(Si,vi,wi)}}function Cc(vi,wi,Si){var Ti=Si.length;if(vi==null)return!Ti;for(vi=Fs(vi);Ti--;){var Mi=Si[Ti],Wi=wi[Mi],Hi=vi[Mi];if(Hi===hi&&!(Mi in vi)||!Wi(Hi))return!1}return!0}function Sc(vi,wi,Si){if(typeof vi!="function")throw new Wn(mi);return co(function(){vi.apply(hi,Si)},wi)}function so(vi,wi,Si,Ti){var Mi=-1,Wi=go,Hi=!0,Xi=vi.length,Ki=[],os=wi.length;if(!Xi)return Ki;Si&&(wi=Os(wi,Ln(Si))),Ti?(Wi=ba,Hi=!1):wi.length>=pi&&(Wi=Yr,Hi=!1,wi=new Er(wi));t:for(;++Mi<Xi;){var as=vi[Mi],hs=Si==null?as:Si(as);if(as=Ti||as!==0?as:0,Hi&&hs===hs){for(var ds=os;ds--;)if(wi[ds]===hs)continue t;Ki.push(as)}else Wi(wi,hs,Ti)||Ki.push(as)}return Ki}var mr=Qc(Jn),Ec=Qc($a,!0);function P_(vi,wi){var Si=!0;return mr(vi,function(Ti,Mi,Wi){return Si=!!wi(Ti,Mi,Wi),Si}),Si}function Lo(vi,wi,Si){for(var Ti=-1,Mi=vi.length;++Ti<Mi;){var Wi=vi[Ti],Hi=wi(Wi);if(Hi!=null&&(Xi===hi?Hi===Hi&&!Bn(Hi):Si(Hi,Xi)))var Xi=Hi,Ki=Wi}return Ki}function I_(vi,wi,Si,Ti){var Mi=vi.length;for(Si=Ss(Si),Si<0&&(Si=-Si>Mi?0:Mi+Si),Ti=Ti===hi||Ti>Mi?Mi:Ss(Ti),Ti<0&&(Ti+=Mi),Ti=Si>Ti?0:Nh(Ti);Si<Ti;)vi[Si++]=wi;return vi}function Ac(vi,wi){var Si=[];return mr(vi,function(Ti,Mi,Wi){wi(Ti,Mi,Wi)&&Si.push(Ti)}),Si}function Ys(vi,wi,Si,Ti,Mi){var Wi=-1,Hi=vi.length;for(Si||(Si=vp),Mi||(Mi=[]);++Wi<Hi;){var Xi=vi[Wi];wi>0&&Si(Xi)?wi>1?Ys(Xi,wi-1,Si,Ti,Mi):pr(Mi,Xi):Ti||(Mi[Mi.length]=Xi)}return Mi}var Ba=Kc(),kc=Kc(!0);function Jn(vi,wi){return vi&&Ba(vi,wi,Xs)}function $a(vi,wi){return vi&&kc(vi,wi,Xs)}function Fo(vi,wi){return _r(wi,function(Si){return cr(vi[Si])})}function kr(vi,wi){wi=xr(wi,vi);for(var Si=0,Ti=wi.length;vi!=null&&Si<Ti;)vi=vi[er(wi[Si++])];return Si&&Si==Ti?vi:hi}function Tc(vi,wi,Si){var Ti=wi(vi);return ys(vi)?Ti:pr(Ti,Si(vi))}function wn(vi){return vi==null?vi===hi?ru:ea:Cr&&Cr in Fs(vi)?dp(vi):Ep(vi)}function Oa(vi,wi){return vi>wi}function R_(vi,wi){return vi!=null&&Ls.call(vi,wi)}function D_(vi,wi){return vi!=null&&wi in Fs(vi)}function M_(vi,wi,Si){return vi>=Ks(wi,Si)&&vi<js(wi,Si)}function Ua(vi,wi,Si){for(var Ti=Si?ba:go,Mi=vi[0].length,Wi=vi.length,Hi=Wi,Xi=es(Wi),Ki=1/0,os=[];Hi--;){var as=vi[Hi];Hi&&wi&&(as=Os(as,Ln(wi))),Ki=Ks(as.length,Ki),Xi[Hi]=!Si&&(wi||Mi>=120&&as.length>=120)?new Er(Hi&&as):hi}as=vi[0];var hs=-1,ds=Xi[0];t:for(;++hs<Mi&&os.length<Ki;){var ps=as[hs],ms=wi?wi(ps):ps;if(ps=Si||ps!==0?ps:0,!(ds?Yr(ds,ms):Ti(os,ms,Si))){for(Hi=Wi;--Hi;){var Es=Xi[Hi];if(!(Es?Yr(Es,ms):Ti(vi[Hi],ms,Si)))continue t}ds&&ds.push(ms),os.push(ps)}}return os}function L_(vi,wi,Si,Ti){return Jn(vi,function(Mi,Wi,Hi){wi(Ti,Si(Mi),Wi,Hi)}),Ti}function no(vi,wi,Si){wi=xr(wi,vi),vi=fh(vi,wi);var Ti=vi==null?vi:vi[er(Vn(wi))];return Ti==null?hi:Mn(Ti,vi,Si)}function Pc(vi){return Gs(vi)&&wn(vi)==Cs}function F_(vi){return Gs(vi)&&wn(vi)==Zr}function B_(vi){return Gs(vi)&&wn(vi)==Tn}function ro(vi,wi,Si,Ti,Mi){return vi===wi?!0:vi==null||wi==null||!Gs(vi)&&!Gs(wi)?vi!==vi&&wi!==wi:$_(vi,wi,Si,Ti,ro,Mi)}function $_(vi,wi,Si,Ti,Mi,Wi){var Hi=ys(vi),Xi=ys(wi),Ki=Hi?Ds:Js(vi),os=Xi?Ds:Js(wi);Ki=Ki==Cs?ir:Ki,os=os==Cs?ir:os;var as=Ki==ir,hs=os==ir,ds=Ki==os;if(ds&&br(vi)){if(!br(wi))return!1;Hi=!0,as=!1}if(ds&&!as)return Wi||(Wi=new Zn),Hi||Hr(vi)?lh(vi,wi,Si,Ti,Mi,Wi):hp(vi,wi,Ki,Si,Ti,Mi,Wi);if(!(Si&Ii)){var ps=as&&Ls.call(vi,"__wrapped__"),ms=hs&&Ls.call(wi,"__wrapped__");if(ps||ms){var Es=ps?vi.value():vi,vs=ms?wi.value():wi;return Wi||(Wi=new Zn),Mi(Es,vs,Si,Ti,Wi)}}return ds?(Wi||(Wi=new Zn),up(vi,wi,Si,Ti,Mi,Wi)):!1}function O_(vi){return Gs(vi)&&Js(vi)==ks}function Ga(vi,wi,Si,Ti){var Mi=Si.length,Wi=Mi,Hi=!Ti;if(vi==null)return!Wi;for(vi=Fs(vi);Mi--;){var Xi=Si[Mi];if(Hi&&Xi[2]?Xi[1]!==vi[Xi[0]]:!(Xi[0]in vi))return!1}for(;++Mi<Wi;){Xi=Si[Mi];var Ki=Xi[0],os=vi[Ki],as=Xi[1];if(Hi&&Xi[2]){if(os===hi&&!(Ki in vi))return!1}else{var hs=new Zn;if(Ti)var ds=Ti(os,as,Ki,vi,wi,hs);if(!(ds===hi?ro(as,os,Ii|Di,Ti,hs):ds))return!1}}return!0}function Ic(vi){if(!Us(vi)||wp(vi))return!1;var wi=cr(vi)?Od:Tu;return wi.test(Pr(vi))}function U_(vi){return Gs(vi)&&wn(vi)==jr}function G_(vi){return Gs(vi)&&Js(vi)==qn}function W_(vi){return Gs(vi)&&Ko(vi.length)&&!!$s[wn(vi)]}function Rc(vi){return typeof vi=="function"?vi:vi==null?Dn:typeof vi=="object"?ys(vi)?Lc(vi[0],vi[1]):Mc(vi):Jh(vi)}function Wa(vi){if(!lo(vi))return Hd(vi);var wi=[];for(var Si in Fs(vi))Ls.call(vi,Si)&&Si!="constructor"&&wi.push(Si);return wi}function N_(vi){if(!Us(vi))return Sp(vi);var wi=lo(vi),Si=[];for(var Ti in vi)Ti=="constructor"&&(wi||!Ls.call(vi,Ti))||Si.push(Ti);return Si}function Na(vi,wi){return vi<wi}function Dc(vi,wi){var Si=-1,Ti=In(vi)?es(vi.length):[];return mr(vi,function(Mi,Wi,Hi){Ti[++Si]=wi(Mi,Wi,Hi)}),Ti}function Mc(vi){var wi=sl(vi);return wi.length==1&&wi[0][2]?_h(wi[0][0],wi[0][1]):function(Si){return Si===vi||Ga(Si,vi,wi)}}function Lc(vi,wi){return rl(vi)&&dh(wi)?_h(er(vi),wi):function(Si){var Ti=fl(Si,vi);return Ti===hi&&Ti===wi?gl(Si,vi):ro(wi,Ti,Ii|Di)}}function Bo(vi,wi,Si,Ti,Mi){vi!==wi&&Ba(wi,function(Wi,Hi){if(Mi||(Mi=new Zn),Us(Wi))z_(vi,wi,Hi,Si,Bo,Ti,Mi);else{var Xi=Ti?Ti(al(vi,Hi),Wi,Hi+"",vi,wi,Mi):hi;Xi===hi&&(Xi=Wi),La(vi,Hi,Xi)}},Rn)}function z_(vi,wi,Si,Ti,Mi,Wi,Hi){var Xi=al(vi,Si),Ki=al(wi,Si),os=Hi.get(Ki);if(os){La(vi,Si,os);return}var as=Wi?Wi(Xi,Ki,Si+"",vi,wi,Hi):hi,hs=as===hi;if(hs){var ds=ys(Ki),ps=!ds&&br(Ki),ms=!ds&&!ps&&Hr(Ki);as=Ki,ds||ps||ms?ys(Xi)?as=Xi:Ws(Xi)?as=Pn(Xi):ps?(hs=!1,as=jc(Ki,!0)):ms?(hs=!1,as=qc(Ki,!0)):as=[]:ho(Ki)||Ir(Ki)?(as=Xi,Ir(Xi)?as=zh(Xi):(!Us(Xi)||cr(Xi))&&(as=uh(Ki))):hs=!1}hs&&(Hi.set(Ki,as),Mi(as,Ki,Ti,Wi,Hi),Hi.delete(Ki)),La(vi,Si,as)}function Fc(vi,wi){var Si=vi.length;if(Si)return wi+=wi<0?Si:0,lr(wi,Si)?vi[wi]:hi}function Bc(vi,wi,Si){wi.length?wi=Os(wi,function(Wi){return ys(Wi)?function(Hi){return kr(Hi,Wi.length===1?Wi[0]:Wi)}:Wi}):wi=[Dn];var Ti=-1;wi=Os(wi,Ln(gs()));var Mi=Dc(vi,function(Wi,Hi,Xi){var Ki=Os(wi,function(os){return os(Wi)});return{criteria:Ki,index:++Ti,value:Wi}});return gd(Mi,function(Wi,Hi){return ip(Wi,Hi,Si)})}function H_(vi,wi){return $c(vi,wi,function(Si,Ti){return gl(vi,Ti)})}function $c(vi,wi,Si){for(var Ti=-1,Mi=wi.length,Wi={};++Ti<Mi;){var Hi=wi[Ti],Xi=kr(vi,Hi);Si(Xi,Hi)&&oo(Wi,xr(Hi,vi),Xi)}return Wi}function V_(vi){return function(wi){return kr(wi,vi)}}function za(vi,wi,Si,Ti){var Mi=Ti?fd:Mr,Wi=-1,Hi=wi.length,Xi=vi;for(vi===wi&&(wi=Pn(wi)),Si&&(Xi=Os(vi,Ln(Si)));++Wi<Hi;)for(var Ki=0,os=wi[Wi],as=Si?Si(os):os;(Ki=Mi(Xi,as,Ki,Ti))>-1;)Xi!==vi&&Ao.call(Xi,Ki,1),Ao.call(vi,Ki,1);return vi}function Oc(vi,wi){for(var Si=vi?wi.length:0,Ti=Si-1;Si--;){var Mi=wi[Si];if(Si==Ti||Mi!==Wi){var Wi=Mi;lr(Mi)?Ao.call(vi,Mi,1):qa(vi,Mi)}}return vi}function Ha(vi,wi){return vi+Po(vc()*(wi-vi+1))}function j_(vi,wi,Si,Ti){for(var Mi=-1,Wi=js(To((wi-vi)/(Si||1)),0),Hi=es(Wi);Wi--;)Hi[Ti?Wi:++Mi]=vi,vi+=Si;return Hi}function Va(vi,wi){var Si="";if(!vi||wi<1||wi>ts)return Si;do wi%2&&(Si+=vi),wi=Po(wi/2),wi&&(vi+=vi);while(wi);return Si}function As(vi,wi){return ll(ph(vi,wi,Dn),vi+"")}function q_(vi){return bc(Vr(vi))}function X_(vi,wi){var Si=Vr(vi);return jo(Si,Ar(wi,0,Si.length))}function oo(vi,wi,Si,Ti){if(!Us(vi))return vi;wi=xr(wi,vi);for(var Mi=-1,Wi=wi.length,Hi=Wi-1,Xi=vi;Xi!=null&&++Mi<Wi;){var Ki=er(wi[Mi]),os=Si;if(Ki==="__proto__"||Ki==="constructor"||Ki==="prototype")return vi;if(Mi!=Hi){var as=Xi[Ki];os=Ti?Ti(as,Ki,Xi):hi,os===hi&&(os=Us(as)?as:lr(wi[Mi+1])?[]:{})}io(Xi,Ki,os),Xi=Xi[Ki]}return vi}var Uc=Io?function(vi,wi){return Io.set(vi,wi),vi}:Dn,Z_=ko?function(vi,wi){return ko(vi,"toString",{configurable:!0,enumerable:!1,value:vl(wi),writable:!0})}:Dn;function Y_(vi){return jo(Vr(vi))}function Hn(vi,wi,Si){var Ti=-1,Mi=vi.length;wi<0&&(wi=-wi>Mi?0:Mi+wi),Si=Si>Mi?Mi:Si,Si<0&&(Si+=Mi),Mi=wi>Si?0:Si-wi>>>0,wi>>>=0;for(var Wi=es(Mi);++Ti<Mi;)Wi[Ti]=vi[Ti+wi];return Wi}function Q_(vi,wi){var Si;return mr(vi,function(Ti,Mi,Wi){return Si=wi(Ti,Mi,Wi),!Si}),!!Si}function $o(vi,wi,Si){var Ti=0,Mi=vi==null?Ti:vi.length;if(typeof wi=="number"&&wi===wi&&Mi<=xs){for(;Ti<Mi;){var Wi=Ti+Mi>>>1,Hi=vi[Wi];Hi!==null&&!Bn(Hi)&&(Si?Hi<=wi:Hi<wi)?Ti=Wi+1:Mi=Wi}return Mi}return ja(vi,wi,Dn,Si)}function ja(vi,wi,Si,Ti){var Mi=0,Wi=vi==null?0:vi.length;if(Wi===0)return 0;wi=Si(wi);for(var Hi=wi!==wi,Xi=wi===null,Ki=Bn(wi),os=wi===hi;Mi<Wi;){var as=Po((Mi+Wi)/2),hs=Si(vi[as]),ds=hs!==hi,ps=hs===null,ms=hs===hs,Es=Bn(hs);if(Hi)var vs=Ti||ms;else os?vs=ms&&(Ti||ds):Xi?vs=ms&&ds&&(Ti||!ps):Ki?vs=ms&&ds&&!ps&&(Ti||!Es):ps||Es?vs=!1:vs=Ti?hs<=wi:hs<wi;vs?Mi=as+1:Wi=as}return Ks(Wi,fs)}function Gc(vi,wi){for(var Si=-1,Ti=vi.length,Mi=0,Wi=[];++Si<Ti;){var Hi=vi[Si],Xi=wi?wi(Hi):Hi;if(!Si||!Yn(Xi,Ki)){var Ki=Xi;Wi[Mi++]=Hi===0?0:Hi}}return Wi}function Wc(vi){return typeof vi=="number"?vi:Bn(vi)?ls:+vi}function Fn(vi){if(typeof vi=="string")return vi;if(ys(vi))return Os(vi,Fn)+"";if(Bn(vi))return xc?xc.call(vi):"";var wi=vi+"";return wi=="0"&&1/vi==-Zi?"-0":wi}function vr(vi,wi,Si){var Ti=-1,Mi=go,Wi=vi.length,Hi=!0,Xi=[],Ki=Xi;if(Si)Hi=!1,Mi=ba;else if(Wi>=pi){var os=wi?null:lp(vi);if(os)return vo(os);Hi=!1,Mi=Yr,Ki=new Er}else Ki=wi?[]:Xi;t:for(;++Ti<Wi;){var as=vi[Ti],hs=wi?wi(as):as;if(as=Si||as!==0?as:0,Hi&&hs===hs){for(var ds=Ki.length;ds--;)if(Ki[ds]===hs)continue t;wi&&Ki.push(hs),Xi.push(as)}else Mi(Ki,hs,Si)||(Ki!==Xi&&Ki.push(hs),Xi.push(as))}return Xi}function qa(vi,wi){return wi=xr(wi,vi),vi=fh(vi,wi),vi==null||delete vi[er(Vn(wi))]}function Nc(vi,wi,Si,Ti){return oo(vi,wi,Si(kr(vi,wi)),Ti)}function Oo(vi,wi,Si,Ti){for(var Mi=vi.length,Wi=Ti?Mi:-1;(Ti?Wi--:++Wi<Mi)&&wi(vi[Wi],Wi,vi););return Si?Hn(vi,Ti?0:Wi,Ti?Wi+1:Mi):Hn(vi,Ti?Wi+1:0,Ti?Mi:Wi)}function zc(vi,wi){var Si=vi;return Si instanceof Ps&&(Si=Si.value()),ya(wi,function(Ti,Mi){return Mi.func.apply(Mi.thisArg,pr([Ti],Mi.args))},Si)}function Xa(vi,wi,Si){var Ti=vi.length;if(Ti<2)return Ti?vr(vi[0]):[];for(var Mi=-1,Wi=es(Ti);++Mi<Ti;)for(var Hi=vi[Mi],Xi=-1;++Xi<Ti;)Xi!=Mi&&(Wi[Mi]=so(Wi[Mi]||Hi,vi[Xi],wi,Si));return vr(Ys(Wi,1),wi,Si)}function Hc(vi,wi,Si){for(var Ti=-1,Mi=vi.length,Wi=wi.length,Hi={};++Ti<Mi;){var Xi=Ti<Wi?wi[Ti]:hi;Si(Hi,vi[Ti],Xi)}return Hi}function Za(vi){return Ws(vi)?vi:[]}function Ya(vi){return typeof vi=="function"?vi:Dn}function xr(vi,wi){return ys(vi)?vi:rl(vi,wi)?[vi]:xh(Ms(vi))}var K_=As;function wr(vi,wi,Si){var Ti=vi.length;return Si=Si===hi?Ti:Si,!wi&&Si>=Ti?vi:Hn(vi,wi,Si)}var Vc=Ud||function(vi){return Zs.clearTimeout(vi)};function jc(vi,wi){if(wi)return vi.slice();var Si=vi.length,Ti=_c?_c(Si):new vi.constructor(Si);return vi.copy(Ti),Ti}function Qa(vi){var wi=new vi.constructor(vi.byteLength);return new So(wi).set(new So(vi)),wi}function J_(vi,wi){var Si=wi?Qa(vi.buffer):vi.buffer;return new vi.constructor(Si,vi.byteOffset,vi.byteLength)}function tp(vi){var wi=new vi.constructor(vi.source,Pl.exec(vi));return wi.lastIndex=vi.lastIndex,wi}function ep(vi){return eo?Fs(eo.call(vi)):{}}function qc(vi,wi){var Si=wi?Qa(vi.buffer):vi.buffer;return new vi.constructor(Si,vi.byteOffset,vi.length)}function Xc(vi,wi){if(vi!==wi){var Si=vi!==hi,Ti=vi===null,Mi=vi===vi,Wi=Bn(vi),Hi=wi!==hi,Xi=wi===null,Ki=wi===wi,os=Bn(wi);if(!Xi&&!os&&!Wi&&vi>wi||Wi&&Hi&&Ki&&!Xi&&!os||Ti&&Hi&&Ki||!Si&&Ki||!Mi)return 1;if(!Ti&&!Wi&&!os&&vi<wi||os&&Si&&Mi&&!Ti&&!Wi||Xi&&Si&&Mi||!Hi&&Mi||!Ki)return-1}return 0}function ip(vi,wi,Si){for(var Ti=-1,Mi=vi.criteria,Wi=wi.criteria,Hi=Mi.length,Xi=Si.length;++Ti<Hi;){var Ki=Xc(Mi[Ti],Wi[Ti]);if(Ki){if(Ti>=Xi)return Ki;var os=Si[Ti];return Ki*(os=="desc"?-1:1)}}return vi.index-wi.index}function Zc(vi,wi,Si,Ti){for(var Mi=-1,Wi=vi.length,Hi=Si.length,Xi=-1,Ki=wi.length,os=js(Wi-Hi,0),as=es(Ki+os),hs=!Ti;++Xi<Ki;)as[Xi]=wi[Xi];for(;++Mi<Hi;)(hs||Mi<Wi)&&(as[Si[Mi]]=vi[Mi]);for(;os--;)as[Xi++]=vi[Mi++];return as}function Yc(vi,wi,Si,Ti){for(var Mi=-1,Wi=vi.length,Hi=-1,Xi=Si.length,Ki=-1,os=wi.length,as=js(Wi-Xi,0),hs=es(as+os),ds=!Ti;++Mi<as;)hs[Mi]=vi[Mi];for(var ps=Mi;++Ki<os;)hs[ps+Ki]=wi[Ki];for(;++Hi<Xi;)(ds||Mi<Wi)&&(hs[ps+Si[Hi]]=vi[Mi++]);return hs}function Pn(vi,wi){var Si=-1,Ti=vi.length;for(wi||(wi=es(Ti));++Si<Ti;)wi[Si]=vi[Si];return wi}function tr(vi,wi,Si,Ti){var Mi=!Si;Si||(Si={});for(var Wi=-1,Hi=wi.length;++Wi<Hi;){var Xi=wi[Wi],Ki=Ti?Ti(Si[Xi],vi[Xi],Xi,Si,vi):hi;Ki===hi&&(Ki=vi[Xi]),Mi?rr(Si,Xi,Ki):io(Si,Xi,Ki)}return Si}function sp(vi,wi){return tr(vi,nl(vi),wi)}function np(vi,wi){return tr(vi,ch(vi),wi)}function Uo(vi,wi){return function(Si,Ti){var Mi=ys(Si)?cd:A_,Wi=wi?wi():{};return Mi(Si,vi,gs(Ti,2),Wi)}}function Wr(vi){return As(function(wi,Si){var Ti=-1,Mi=Si.length,Wi=Mi>1?Si[Mi-1]:hi,Hi=Mi>2?Si[2]:hi;for(Wi=vi.length>3&&typeof Wi=="function"?(Mi--,Wi):hi,Hi&&An(Si[0],Si[1],Hi)&&(Wi=Mi<3?hi:Wi,Mi=1),wi=Fs(wi);++Ti<Mi;){var Xi=Si[Ti];Xi&&vi(wi,Xi,Ti,Wi)}return wi})}function Qc(vi,wi){return function(Si,Ti){if(Si==null)return Si;if(!In(Si))return vi(Si,Ti);for(var Mi=Si.length,Wi=wi?Mi:-1,Hi=Fs(Si);(wi?Wi--:++Wi<Mi)&&Ti(Hi[Wi],Wi,Hi)!==!1;);return Si}}function Kc(vi){return function(wi,Si,Ti){for(var Mi=-1,Wi=Fs(wi),Hi=Ti(wi),Xi=Hi.length;Xi--;){var Ki=Hi[vi?Xi:++Mi];if(Si(Wi[Ki],Ki,Wi)===!1)break}return wi}}function rp(vi,wi,Si){var Ti=wi&Fi,Mi=ao(vi);function Wi(){var Hi=this&&this!==Zs&&this instanceof Wi?Mi:vi;return Hi.apply(Ti?Si:this,arguments)}return Wi}function Jc(vi){return function(wi){wi=Ms(wi);var Si=Lr(wi)?Xn(wi):hi,Ti=Si?Si[0]:wi.charAt(0),Mi=Si?wr(Si,1).join(""):wi.slice(1);return Ti[vi]()+Mi}}function Nr(vi){return function(wi){return ya(Qh(Yh(wi).replace(Zu,"")),vi,"")}}function ao(vi){return function(){var wi=arguments;switch(wi.length){case 0:return new vi;case 1:return new vi(wi[0]);case 2:return new vi(wi[0],wi[1]);case 3:return new vi(wi[0],wi[1],wi[2]);case 4:return new vi(wi[0],wi[1],wi[2],wi[3]);case 5:return new vi(wi[0],wi[1],wi[2],wi[3],wi[4]);case 6:return new vi(wi[0],wi[1],wi[2],wi[3],wi[4],wi[5]);case 7:return new vi(wi[0],wi[1],wi[2],wi[3],wi[4],wi[5],wi[6])}var Si=Gr(vi.prototype),Ti=vi.apply(Si,wi);return Us(Ti)?Ti:Si}}function op(vi,wi,Si){var Ti=ao(vi);function Mi(){for(var Wi=arguments.length,Hi=es(Wi),Xi=Wi,Ki=zr(Mi);Xi--;)Hi[Xi]=arguments[Xi];var os=Wi<3&&Hi[0]!==Ki&&Hi[Wi-1]!==Ki?[]:fr(Hi,Ki);if(Wi-=os.length,Wi<Si)return nh(vi,wi,Go,Mi.placeholder,hi,Hi,os,hi,hi,Si-Wi);var as=this&&this!==Zs&&this instanceof Mi?Ti:vi;return Mn(as,this,Hi)}return Mi}function th(vi){return function(wi,Si,Ti){var Mi=Fs(wi);if(!In(wi)){var Wi=gs(Si,3);wi=Xs(wi),Si=function(Xi){return Wi(Mi[Xi],Xi,Mi)}}var Hi=vi(wi,Si,Ti);return Hi>-1?Mi[Wi?wi[Hi]:Hi]:hi}}function eh(vi){return ar(function(wi){var Si=wi.length,Ti=Si,Mi=Nn.prototype.thru;for(vi&&wi.reverse();Ti--;){var Wi=wi[Ti];if(typeof Wi!="function")throw new Wn(mi);if(Mi&&!Hi&&Ho(Wi)=="wrapper")var Hi=new Nn([],!0)}for(Ti=Hi?Ti:Si;++Ti<Si;){Wi=wi[Ti];var Xi=Ho(Wi),Ki=Xi=="wrapper"?il(Wi):hi;Ki&&ol(Ki[0])&&Ki[1]==(Ui|Ri|Ni|qi)&&!Ki[4].length&&Ki[9]==1?Hi=Hi[Ho(Ki[0])].apply(Hi,Ki[3]):Hi=Wi.length==1&&ol(Wi)?Hi[Xi]():Hi.thru(Wi)}return function(){var os=arguments,as=os[0];if(Hi&&os.length==1&&ys(as))return Hi.plant(as).value();for(var hs=0,ds=Si?wi[hs].apply(this,os):as;++hs<Si;)ds=wi[hs].call(this,ds);return ds}})}function Go(vi,wi,Si,Ti,Mi,Wi,Hi,Xi,Ki,os){var as=wi&Ui,hs=wi&Fi,ds=wi&Li,ps=wi&(Ri|$i),ms=wi&Ji,Es=ds?hi:ao(vi);function vs(){for(var Ts=arguments.length,Is=es(Ts),$n=Ts;$n--;)Is[$n]=arguments[$n];if(ps)var kn=zr(vs),On=vd(Is,kn);if(Ti&&(Is=Zc(Is,Ti,Mi,ps)),Wi&&(Is=Yc(Is,Wi,Hi,ps)),Ts-=On,ps&&Ts<os){var Ns=fr(Is,kn);return nh(vi,wi,Go,vs.placeholder,Si,Is,Ns,Xi,Ki,os-Ts)}var Qn=hs?Si:this,ur=ds?Qn[vi]:vi;return Ts=Is.length,Xi?Is=Ap(Is,Xi):ms&&Ts>1&&Is.reverse(),as&&Ki<Ts&&(Is.length=Ki),this&&this!==Zs&&this instanceof vs&&(ur=Es||ao(ur)),ur.apply(Qn,Is)}return vs}function ih(vi,wi){return function(Si,Ti){return L_(Si,vi,wi(Ti),{})}}function Wo(vi,wi){return function(Si,Ti){var Mi;if(Si===hi&&Ti===hi)return wi;if(Si!==hi&&(Mi=Si),Ti!==hi){if(Mi===hi)return Ti;typeof Si=="string"||typeof Ti=="string"?(Si=Fn(Si),Ti=Fn(Ti)):(Si=Wc(Si),Ti=Wc(Ti)),Mi=vi(Si,Ti)}return Mi}}function Ka(vi){return ar(function(wi){return wi=Os(wi,Ln(gs())),As(function(Si){var Ti=this;return vi(wi,function(Mi){return Mn(Mi,Ti,Si)})})})}function No(vi,wi){wi=wi===hi?" ":Fn(wi);var Si=wi.length;if(Si<2)return Si?Va(wi,vi):wi;var Ti=Va(wi,To(vi/Fr(wi)));return Lr(wi)?wr(Xn(Ti),0,vi).join(""):Ti.slice(0,vi)}function ap(vi,wi,Si,Ti){var Mi=wi&Fi,Wi=ao(vi);function Hi(){for(var Xi=-1,Ki=arguments.length,os=-1,as=Ti.length,hs=es(as+Ki),ds=this&&this!==Zs&&this instanceof Hi?Wi:vi;++os<as;)hs[os]=Ti[os];for(;Ki--;)hs[os++]=arguments[++Xi];return Mn(ds,Mi?Si:this,hs)}return Hi}function sh(vi){return function(wi,Si,Ti){return Ti&&typeof Ti!="number"&&An(wi,Si,Ti)&&(Si=Ti=hi),wi=hr(wi),Si===hi?(Si=wi,wi=0):Si=hr(Si),Ti=Ti===hi?wi<Si?1:-1:hr(Ti),j_(wi,Si,Ti,vi)}}function zo(vi){return function(wi,Si){return typeof wi=="string"&&typeof Si=="string"||(wi=jn(wi),Si=jn(Si)),vi(wi,Si)}}function nh(vi,wi,Si,Ti,Mi,Wi,Hi,Xi,Ki,os){var as=wi&Ri,hs=as?Hi:hi,ds=as?hi:Hi,ps=as?Wi:hi,ms=as?hi:Wi;wi|=as?Ni:ji,wi&=~(as?ji:Ni),wi&Bi||(wi&=~(Fi|Li));var Es=[vi,wi,Mi,ps,hs,ms,ds,Xi,Ki,os],vs=Si.apply(hi,Es);return ol(vi)&&gh(vs,Es),vs.placeholder=Ti,mh(vs,vi,wi)}function Ja(vi){var wi=Vs[vi];return function(Si,Ti){if(Si=jn(Si),Ti=Ti==null?0:Ks(Ss(Ti),292),Ti&&mc(Si)){var Mi=(Ms(Si)+"e").split("e"),Wi=wi(Mi[0]+"e"+(+Mi[1]+Ti));return Mi=(Ms(Wi)+"e").split("e"),+(Mi[0]+"e"+(+Mi[1]-Ti))}return wi(Si)}}var lp=Or&&1/vo(new Or([,-0]))[1]==Zi?function(vi){return new Or(vi)}:bl;function rh(vi){return function(wi){var Si=Js(wi);return Si==ks?Pa(wi):Si==qn?Ed(wi):md(wi,vi(wi))}}function or(vi,wi,Si,Ti,Mi,Wi,Hi,Xi){var Ki=wi&Li;if(!Ki&&typeof vi!="function")throw new Wn(mi);var os=Ti?Ti.length:0;if(os||(wi&=~(Ni|ji),Ti=Mi=hi),Hi=Hi===hi?Hi:js(Ss(Hi),0),Xi=Xi===hi?Xi:Ss(Xi),os-=Mi?Mi.length:0,wi&ji){var as=Ti,hs=Mi;Ti=Mi=hi}var ds=Ki?hi:il(vi),ps=[vi,wi,Si,Ti,Mi,as,hs,Wi,Hi,Xi];if(ds&&Cp(ps,ds),vi=ps[0],wi=ps[1],Si=ps[2],Ti=ps[3],Mi=ps[4],Xi=ps[9]=ps[9]===hi?Ki?0:vi.length:js(ps[9]-os,0),!Xi&&wi&(Ri|$i)&&(wi&=~(Ri|$i)),!wi||wi==Fi)var ms=rp(vi,wi,Si);else wi==Ri||wi==$i?ms=op(vi,wi,Xi):(wi==Ni||wi==(Fi|Ni))&&!Mi.length?ms=ap(vi,wi,Si,Ti):ms=Go.apply(hi,ps);var Es=ds?Uc:gh;return mh(Es(ms,ps),vi,wi)}function oh(vi,wi,Si,Ti){return vi===hi||Yn(vi,$r[Si])&&!Ls.call(Ti,Si)?wi:vi}function ah(vi,wi,Si,Ti,Mi,Wi){return Us(vi)&&Us(wi)&&(Wi.set(wi,vi),Bo(vi,wi,hi,ah,Wi),Wi.delete(wi)),vi}function cp(vi){return ho(vi)?hi:vi}function lh(vi,wi,Si,Ti,Mi,Wi){var Hi=Si&Ii,Xi=vi.length,Ki=wi.length;if(Xi!=Ki&&!(Hi&&Ki>Xi))return!1;var os=Wi.get(vi),as=Wi.get(wi);if(os&&as)return os==wi&&as==vi;var hs=-1,ds=!0,ps=Si&Di?new Er:hi;for(Wi.set(vi,wi),Wi.set(wi,vi);++hs<Xi;){var ms=vi[hs],Es=wi[hs];if(Ti)var vs=Hi?Ti(Es,ms,hs,wi,vi,Wi):Ti(ms,Es,hs,vi,wi,Wi);if(vs!==hi){if(vs)continue;ds=!1;break}if(ps){if(!Ca(wi,function(Ts,Is){if(!Yr(ps,Is)&&(ms===Ts||Mi(ms,Ts,Si,Ti,Wi)))return ps.push(Is)})){ds=!1;break}}else if(!(ms===Es||Mi(ms,Es,Si,Ti,Wi))){ds=!1;break}}return Wi.delete(vi),Wi.delete(wi),ds}function hp(vi,wi,Si,Ti,Mi,Wi,Hi){switch(Si){case Rr:if(vi.byteLength!=wi.byteLength||vi.byteOffset!=wi.byteOffset)return!1;vi=vi.buffer,wi=wi.buffer;case Zr:return!(vi.byteLength!=wi.byteLength||!Wi(new So(vi),new So(wi)));case qs:case Tn:case zs:return Yn(+vi,+wi);case Qs:return vi.name==wi.name&&vi.message==wi.message;case jr:case qr:return vi==wi+"";case ks:var Xi=Pa;case qn:var Ki=Ti&Ii;if(Xi||(Xi=vo),vi.size!=wi.size&&!Ki)return!1;var os=Hi.get(vi);if(os)return os==wi;Ti|=Di,Hi.set(vi,wi);var as=lh(Xi(vi),Xi(wi),Ti,Mi,Wi,Hi);return Hi.delete(vi),as;case uo:if(eo)return eo.call(vi)==eo.call(wi)}return!1}function up(vi,wi,Si,Ti,Mi,Wi){var Hi=Si&Ii,Xi=tl(vi),Ki=Xi.length,os=tl(wi),as=os.length;if(Ki!=as&&!Hi)return!1;for(var hs=Ki;hs--;){var ds=Xi[hs];if(!(Hi?ds in wi:Ls.call(wi,ds)))return!1}var ps=Wi.get(vi),ms=Wi.get(wi);if(ps&&ms)return ps==wi&&ms==vi;var Es=!0;Wi.set(vi,wi),Wi.set(wi,vi);for(var vs=Hi;++hs<Ki;){ds=Xi[hs];var Ts=vi[ds],Is=wi[ds];if(Ti)var $n=Hi?Ti(Is,Ts,ds,wi,vi,Wi):Ti(Ts,Is,ds,vi,wi,Wi);if(!($n===hi?Ts===Is||Mi(Ts,Is,Si,Ti,Wi):$n)){Es=!1;break}vs||(vs=ds=="constructor")}if(Es&&!vs){var kn=vi.constructor,On=wi.constructor;kn!=On&&"constructor"in vi&&"constructor"in wi&&!(typeof kn=="function"&&kn instanceof kn&&typeof On=="function"&&On instanceof On)&&(Es=!1)}return Wi.delete(vi),Wi.delete(wi),Es}function ar(vi){return ll(ph(vi,hi,Ch),vi+"")}function tl(vi){return Tc(vi,Xs,nl)}function el(vi){return Tc(vi,Rn,ch)}var il=Io?function(vi){return Io.get(vi)}:bl;function Ho(vi){for(var wi=vi.name+"",Si=Ur[wi],Ti=Ls.call(Ur,wi)?Si.length:0;Ti--;){var Mi=Si[Ti],Wi=Mi.func;if(Wi==null||Wi==vi)return Mi.name}return wi}function zr(vi){var wi=Ls.call(Oi,"placeholder")?Oi:vi;return wi.placeholder}function gs(){var vi=Oi.iteratee||xl;return vi=vi===xl?Rc:vi,arguments.length?vi(arguments[0],arguments[1]):vi}function Vo(vi,wi){var Si=vi.__data__;return xp(wi)?Si[typeof wi=="string"?"string":"hash"]:Si.map}function sl(vi){for(var wi=Xs(vi),Si=wi.length;Si--;){var Ti=wi[Si],Mi=vi[Ti];wi[Si]=[Ti,Mi,dh(Mi)]}return wi}function Tr(vi,wi){var Si=yd(vi,wi);return Ic(Si)?Si:hi}function dp(vi){var wi=Ls.call(vi,Cr),Si=vi[Cr];try{vi[Cr]=hi;var Ti=!0}catch{}var Mi=yo.call(vi);return Ti&&(wi?vi[Cr]=Si:delete vi[Cr]),Mi}var nl=Ra?function(vi){return vi==null?[]:(vi=Fs(vi),_r(Ra(vi),function(wi){return fc.call(vi,wi)}))}:yl,ch=Ra?function(vi){for(var wi=[];vi;)pr(wi,nl(vi)),vi=Eo(vi);return wi}:yl,Js=wn;(Da&&Js(new Da(new ArrayBuffer(1)))!=Rr||Kr&&Js(new Kr)!=ks||Ma&&Js(Ma.resolve())!=El||Or&&Js(new Or)!=qn||Jr&&Js(new Jr)!=Xr)&&(Js=function(vi){var wi=wn(vi),Si=wi==ir?vi.constructor:hi,Ti=Si?Pr(Si):"";if(Ti)switch(Ti){case Xd:return Rr;case Zd:return ks;case Yd:return El;case Qd:return qn;case Kd:return Xr}return wi});function _p(vi,wi,Si){for(var Ti=-1,Mi=Si.length;++Ti<Mi;){var Wi=Si[Ti],Hi=Wi.size;switch(Wi.type){case"drop":vi+=Hi;break;case"dropRight":wi-=Hi;break;case"take":wi=Ks(wi,vi+Hi);break;case"takeRight":vi=js(vi,wi-Hi);break}}return{start:vi,end:wi}}function pp(vi){var wi=vi.match(wu);return wi?wi[1].split(bu):[]}function hh(vi,wi,Si){wi=xr(wi,vi);for(var Ti=-1,Mi=wi.length,Wi=!1;++Ti<Mi;){var Hi=er(wi[Ti]);if(!(Wi=vi!=null&&Si(vi,Hi)))break;vi=vi[Hi]}return Wi||++Ti!=Mi?Wi:(Mi=vi==null?0:vi.length,!!Mi&&Ko(Mi)&&lr(Hi,Mi)&&(ys(vi)||Ir(vi)))}function fp(vi){var wi=vi.length,Si=new vi.constructor(wi);return wi&&typeof vi[0]=="string"&&Ls.call(vi,"index")&&(Si.index=vi.index,Si.input=vi.input),Si}function uh(vi){return typeof vi.constructor=="function"&&!lo(vi)?Gr(Eo(vi)):{}}function gp(vi,wi,Si){var Ti=vi.constructor;switch(wi){case Zr:return Qa(vi);case qs:case Tn:return new Ti(+vi);case Rr:return J_(vi,Si);case ia:case sa:case na:case ra:case oa:case aa:case la:case ca:case ha:return qc(vi,Si);case ks:return new Ti;case zs:case qr:return new Ti(vi);case jr:return tp(vi);case qn:return new Ti;case uo:return ep(vi)}}function mp(vi,wi){var Si=wi.length;if(!Si)return vi;var Ti=Si-1;return wi[Ti]=(Si>1?"& ":"")+wi[Ti],wi=wi.join(Si>2?", ":" "),vi.replace(xu,`{
/* [wrapped with `+wi+`] */
`)}function vp(vi){return ys(vi)||Ir(vi)||!!(gc&&vi&&vi[gc])}function lr(vi,wi){var Si=typeof vi;return wi=wi??ts,!!wi&&(Si=="number"||Si!="symbol"&&Iu.test(vi))&&vi>-1&&vi%1==0&&vi<wi}function An(vi,wi,Si){if(!Us(Si))return!1;var Ti=typeof wi;return(Ti=="number"?In(Si)&&lr(wi,Si.length):Ti=="string"&&wi in Si)?Yn(Si[wi],vi):!1}function rl(vi,wi){if(ys(vi))return!1;var Si=typeof vi;return Si=="number"||Si=="symbol"||Si=="boolean"||vi==null||Bn(vi)?!0:fu.test(vi)||!pu.test(vi)||wi!=null&&vi in Fs(wi)}function xp(vi){var wi=typeof vi;return wi=="string"||wi=="number"||wi=="symbol"||wi=="boolean"?vi!=="__proto__":vi===null}function ol(vi){var wi=Ho(vi),Si=Oi[wi];if(typeof Si!="function"||!(wi in Ps.prototype))return!1;if(vi===Si)return!0;var Ti=il(Si);return!!Ti&&vi===Ti[0]}function wp(vi){return!!dc&&dc in vi}var bp=wo?cr:Cl;function lo(vi){var wi=vi&&vi.constructor,Si=typeof wi=="function"&&wi.prototype||$r;return vi===Si}function dh(vi){return vi===vi&&!Us(vi)}function _h(vi,wi){return function(Si){return Si==null?!1:Si[vi]===wi&&(wi!==hi||vi in Fs(Si))}}function yp(vi){var wi=Yo(vi,function(Ti){return Si.size===Ci&&Si.clear(),Ti}),Si=wi.cache;return wi}function Cp(vi,wi){var Si=vi[1],Ti=wi[1],Mi=Si|Ti,Wi=Mi<(Fi|Li|Ui),Hi=Ti==Ui&&Si==Ri||Ti==Ui&&Si==qi&&vi[7].length<=wi[8]||Ti==(Ui|qi)&&wi[7].length<=wi[8]&&Si==Ri;if(!(Wi||Hi))return vi;Ti&Fi&&(vi[2]=wi[2],Mi|=Si&Fi?0:Bi);var Xi=wi[3];if(Xi){var Ki=vi[3];vi[3]=Ki?Zc(Ki,Xi,wi[4]):Xi,vi[4]=Ki?fr(vi[3],Ei):wi[4]}return Xi=wi[5],Xi&&(Ki=vi[5],vi[5]=Ki?Yc(Ki,Xi,wi[6]):Xi,vi[6]=Ki?fr(vi[5],Ei):wi[6]),Xi=wi[7],Xi&&(vi[7]=Xi),Ti&Ui&&(vi[8]=vi[8]==null?wi[8]:Ks(vi[8],wi[8])),vi[9]==null&&(vi[9]=wi[9]),vi[0]=wi[0],vi[1]=Mi,vi}function Sp(vi){var wi=[];if(vi!=null)for(var Si in Fs(vi))wi.push(Si);return wi}function Ep(vi){return yo.call(vi)}function ph(vi,wi,Si){return wi=js(wi===hi?vi.length-1:wi,0),function(){for(var Ti=arguments,Mi=-1,Wi=js(Ti.length-wi,0),Hi=es(Wi);++Mi<Wi;)Hi[Mi]=Ti[wi+Mi];Mi=-1;for(var Xi=es(wi+1);++Mi<wi;)Xi[Mi]=Ti[Mi];return Xi[wi]=Si(Hi),Mn(vi,this,Xi)}}function fh(vi,wi){return wi.length<2?vi:kr(vi,Hn(wi,0,-1))}function Ap(vi,wi){for(var Si=vi.length,Ti=Ks(wi.length,Si),Mi=Pn(vi);Ti--;){var Wi=wi[Ti];vi[Ti]=lr(Wi,Si)?Mi[Wi]:hi}return vi}function al(vi,wi){if(!(wi==="constructor"&&typeof vi[wi]=="function")&&wi!="__proto__")return vi[wi]}var gh=vh(Uc),co=Wd||function(vi,wi){return Zs.setTimeout(vi,wi)},ll=vh(Z_);function mh(vi,wi,Si){var Ti=wi+"";return ll(vi,mp(Ti,kp(pp(Ti),Si)))}function vh(vi){var wi=0,Si=0;return function(){var Ti=Vd(),Mi=Gi-(Ti-Si);if(Si=Ti,Mi>0){if(++wi>=zi)return arguments[0]}else wi=0;return vi.apply(hi,arguments)}}function jo(vi,wi){var Si=-1,Ti=vi.length,Mi=Ti-1;for(wi=wi===hi?Ti:wi;++Si<wi;){var Wi=Ha(Si,Mi),Hi=vi[Wi];vi[Wi]=vi[Si],vi[Si]=Hi}return vi.length=wi,vi}var xh=yp(function(vi){var wi=[];return vi.charCodeAt(0)===46&&wi.push(""),vi.replace(gu,function(Si,Ti,Mi,Wi){wi.push(Mi?Wi.replace(Su,"$1"):Ti||Si)}),wi});function er(vi){if(typeof vi=="string"||Bn(vi))return vi;var wi=vi+"";return wi=="0"&&1/vi==-Zi?"-0":wi}function Pr(vi){if(vi!=null){try{return bo.call(vi)}catch{}try{return vi+""}catch{}}return""}function kp(vi,wi){return Gn(bs,function(Si){var Ti="_."+Si[0];wi&Si[1]&&!go(vi,Ti)&&vi.push(Ti)}),vi.sort()}function wh(vi){if(vi instanceof Ps)return vi.clone();var wi=new Nn(vi.__wrapped__,vi.__chain__);return wi.__actions__=Pn(vi.__actions__),wi.__index__=vi.__index__,wi.__values__=vi.__values__,wi}function Tp(vi,wi,Si){(Si?An(vi,wi,Si):wi===hi)?wi=1:wi=js(Ss(wi),0);var Ti=vi==null?0:vi.length;if(!Ti||wi<1)return[];for(var Mi=0,Wi=0,Hi=es(To(Ti/wi));Mi<Ti;)Hi[Wi++]=Hn(vi,Mi,Mi+=wi);return Hi}function Pp(vi){for(var wi=-1,Si=vi==null?0:vi.length,Ti=0,Mi=[];++wi<Si;){var Wi=vi[wi];Wi&&(Mi[Ti++]=Wi)}return Mi}function Ip(){var vi=arguments.length;if(!vi)return[];for(var wi=es(vi-1),Si=arguments[0],Ti=vi;Ti--;)wi[Ti-1]=arguments[Ti];return pr(ys(Si)?Pn(Si):[Si],Ys(wi,1))}var Rp=As(function(vi,wi){return Ws(vi)?so(vi,Ys(wi,1,Ws,!0)):[]}),Dp=As(function(vi,wi){var Si=Vn(wi);return Ws(Si)&&(Si=hi),Ws(vi)?so(vi,Ys(wi,1,Ws,!0),gs(Si,2)):[]}),Mp=As(function(vi,wi){var Si=Vn(wi);return Ws(Si)&&(Si=hi),Ws(vi)?so(vi,Ys(wi,1,Ws,!0),hi,Si):[]});function Lp(vi,wi,Si){var Ti=vi==null?0:vi.length;return Ti?(wi=Si||wi===hi?1:Ss(wi),Hn(vi,wi<0?0:wi,Ti)):[]}function Fp(vi,wi,Si){var Ti=vi==null?0:vi.length;return Ti?(wi=Si||wi===hi?1:Ss(wi),wi=Ti-wi,Hn(vi,0,wi<0?0:wi)):[]}function Bp(vi,wi){return vi&&vi.length?Oo(vi,gs(wi,3),!0,!0):[]}function $p(vi,wi){return vi&&vi.length?Oo(vi,gs(wi,3),!0):[]}function Op(vi,wi,Si,Ti){var Mi=vi==null?0:vi.length;return Mi?(Si&&typeof Si!="number"&&An(vi,wi,Si)&&(Si=0,Ti=Mi),I_(vi,wi,Si,Ti)):[]}function bh(vi,wi,Si){var Ti=vi==null?0:vi.length;if(!Ti)return-1;var Mi=Si==null?0:Ss(Si);return Mi<0&&(Mi=js(Ti+Mi,0)),mo(vi,gs(wi,3),Mi)}function yh(vi,wi,Si){var Ti=vi==null?0:vi.length;if(!Ti)return-1;var Mi=Ti-1;return Si!==hi&&(Mi=Ss(Si),Mi=Si<0?js(Ti+Mi,0):Ks(Mi,Ti-1)),mo(vi,gs(wi,3),Mi,!0)}function Ch(vi){var wi=vi==null?0:vi.length;return wi?Ys(vi,1):[]}function Up(vi){var wi=vi==null?0:vi.length;return wi?Ys(vi,Zi):[]}function Gp(vi,wi){var Si=vi==null?0:vi.length;return Si?(wi=wi===hi?1:Ss(wi),Ys(vi,wi)):[]}function Wp(vi){for(var wi=-1,Si=vi==null?0:vi.length,Ti={};++wi<Si;){var Mi=vi[wi];Ti[Mi[0]]=Mi[1]}return Ti}function Sh(vi){return vi&&vi.length?vi[0]:hi}function Np(vi,wi,Si){var Ti=vi==null?0:vi.length;if(!Ti)return-1;var Mi=Si==null?0:Ss(Si);return Mi<0&&(Mi=js(Ti+Mi,0)),Mr(vi,wi,Mi)}function zp(vi){var wi=vi==null?0:vi.length;return wi?Hn(vi,0,-1):[]}var Hp=As(function(vi){var wi=Os(vi,Za);return wi.length&&wi[0]===vi[0]?Ua(wi):[]}),Vp=As(function(vi){var wi=Vn(vi),Si=Os(vi,Za);return wi===Vn(Si)?wi=hi:Si.pop(),Si.length&&Si[0]===vi[0]?Ua(Si,gs(wi,2)):[]}),jp=As(function(vi){var wi=Vn(vi),Si=Os(vi,Za);return wi=typeof wi=="function"?wi:hi,wi&&Si.pop(),Si.length&&Si[0]===vi[0]?Ua(Si,hi,wi):[]});function qp(vi,wi){return vi==null?"":zd.call(vi,wi)}function Vn(vi){var wi=vi==null?0:vi.length;return wi?vi[wi-1]:hi}function Xp(vi,wi,Si){var Ti=vi==null?0:vi.length;if(!Ti)return-1;var Mi=Ti;return Si!==hi&&(Mi=Ss(Si),Mi=Mi<0?js(Ti+Mi,0):Ks(Mi,Ti-1)),wi===wi?kd(vi,wi,Mi):mo(vi,nc,Mi,!0)}function Zp(vi,wi){return vi&&vi.length?Fc(vi,Ss(wi)):hi}var Yp=As(Eh);function Eh(vi,wi){return vi&&vi.length&&wi&&wi.length?za(vi,wi):vi}function Qp(vi,wi,Si){return vi&&vi.length&&wi&&wi.length?za(vi,wi,gs(Si,2)):vi}function Kp(vi,wi,Si){return vi&&vi.length&&wi&&wi.length?za(vi,wi,hi,Si):vi}var Jp=ar(function(vi,wi){var Si=vi==null?0:vi.length,Ti=Fa(vi,wi);return Oc(vi,Os(wi,function(Mi){return lr(Mi,Si)?+Mi:Mi}).sort(Xc)),Ti});function tf(vi,wi){var Si=[];if(!(vi&&vi.length))return Si;var Ti=-1,Mi=[],Wi=vi.length;for(wi=gs(wi,3);++Ti<Wi;){var Hi=vi[Ti];wi(Hi,Ti,vi)&&(Si.push(Hi),Mi.push(Ti))}return Oc(vi,Mi),Si}function cl(vi){return vi==null?vi:qd.call(vi)}function ef(vi,wi,Si){var Ti=vi==null?0:vi.length;return Ti?(Si&&typeof Si!="number"&&An(vi,wi,Si)?(wi=0,Si=Ti):(wi=wi==null?0:Ss(wi),Si=Si===hi?Ti:Ss(Si)),Hn(vi,wi,Si)):[]}function sf(vi,wi){return $o(vi,wi)}function nf(vi,wi,Si){return ja(vi,wi,gs(Si,2))}function rf(vi,wi){var Si=vi==null?0:vi.length;if(Si){var Ti=$o(vi,wi);if(Ti<Si&&Yn(vi[Ti],wi))return Ti}return-1}function of(vi,wi){return $o(vi,wi,!0)}function af(vi,wi,Si){return ja(vi,wi,gs(Si,2),!0)}function lf(vi,wi){var Si=vi==null?0:vi.length;if(Si){var Ti=$o(vi,wi,!0)-1;if(Yn(vi[Ti],wi))return Ti}return-1}function cf(vi){return vi&&vi.length?Gc(vi):[]}function hf(vi,wi){return vi&&vi.length?Gc(vi,gs(wi,2)):[]}function uf(vi){var wi=vi==null?0:vi.length;return wi?Hn(vi,1,wi):[]}function df(vi,wi,Si){return vi&&vi.length?(wi=Si||wi===hi?1:Ss(wi),Hn(vi,0,wi<0?0:wi)):[]}function _f(vi,wi,Si){var Ti=vi==null?0:vi.length;return Ti?(wi=Si||wi===hi?1:Ss(wi),wi=Ti-wi,Hn(vi,wi<0?0:wi,Ti)):[]}function pf(vi,wi){return vi&&vi.length?Oo(vi,gs(wi,3),!1,!0):[]}function ff(vi,wi){return vi&&vi.length?Oo(vi,gs(wi,3)):[]}var gf=As(function(vi){return vr(Ys(vi,1,Ws,!0))}),mf=As(function(vi){var wi=Vn(vi);return Ws(wi)&&(wi=hi),vr(Ys(vi,1,Ws,!0),gs(wi,2))}),vf=As(function(vi){var wi=Vn(vi);return wi=typeof wi=="function"?wi:hi,vr(Ys(vi,1,Ws,!0),hi,wi)});function xf(vi){return vi&&vi.length?vr(vi):[]}function wf(vi,wi){return vi&&vi.length?vr(vi,gs(wi,2)):[]}function bf(vi,wi){return wi=typeof wi=="function"?wi:hi,vi&&vi.length?vr(vi,hi,wi):[]}function hl(vi){if(!(vi&&vi.length))return[];var wi=0;return vi=_r(vi,function(Si){if(Ws(Si))return wi=js(Si.length,wi),!0}),ka(wi,function(Si){return Os(vi,Sa(Si))})}function Ah(vi,wi){if(!(vi&&vi.length))return[];var Si=hl(vi);return wi==null?Si:Os(Si,function(Ti){return Mn(wi,hi,Ti)})}var yf=As(function(vi,wi){return Ws(vi)?so(vi,wi):[]}),Cf=As(function(vi){return Xa(_r(vi,Ws))}),Sf=As(function(vi){var wi=Vn(vi);return Ws(wi)&&(wi=hi),Xa(_r(vi,Ws),gs(wi,2))}),Ef=As(function(vi){var wi=Vn(vi);return wi=typeof wi=="function"?wi:hi,Xa(_r(vi,Ws),hi,wi)}),Af=As(hl);function kf(vi,wi){return Hc(vi||[],wi||[],io)}function Tf(vi,wi){return Hc(vi||[],wi||[],oo)}var Pf=As(function(vi){var wi=vi.length,Si=wi>1?vi[wi-1]:hi;return Si=typeof Si=="function"?(vi.pop(),Si):hi,Ah(vi,Si)});function kh(vi){var wi=Oi(vi);return wi.__chain__=!0,wi}function If(vi,wi){return wi(vi),vi}function qo(vi,wi){return wi(vi)}var Rf=ar(function(vi){var wi=vi.length,Si=wi?vi[0]:0,Ti=this.__wrapped__,Mi=function(Wi){return Fa(Wi,vi)};return wi>1||this.__actions__.length||!(Ti instanceof Ps)||!lr(Si)?this.thru(Mi):(Ti=Ti.slice(Si,+Si+(wi?1:0)),Ti.__actions__.push({func:qo,args:[Mi],thisArg:hi}),new Nn(Ti,this.__chain__).thru(function(Wi){return wi&&!Wi.length&&Wi.push(hi),Wi}))});function Df(){return kh(this)}function Mf(){return new Nn(this.value(),this.__chain__)}function Lf(){this.__values__===hi&&(this.__values__=Wh(this.value()));var vi=this.__index__>=this.__values__.length,wi=vi?hi:this.__values__[this.__index__++];return{done:vi,value:wi}}function Ff(){return this}function Bf(vi){for(var wi,Si=this;Si instanceof Do;){var Ti=wh(Si);Ti.__index__=0,Ti.__values__=hi,wi?Mi.__wrapped__=Ti:wi=Ti;var Mi=Ti;Si=Si.__wrapped__}return Mi.__wrapped__=vi,wi}function $f(){var vi=this.__wrapped__;if(vi instanceof Ps){var wi=vi;return this.__actions__.length&&(wi=new Ps(this)),wi=wi.reverse(),wi.__actions__.push({func:qo,args:[cl],thisArg:hi}),new Nn(wi,this.__chain__)}return this.thru(cl)}function Of(){return zc(this.__wrapped__,this.__actions__)}var Uf=Uo(function(vi,wi,Si){Ls.call(vi,Si)?++vi[Si]:rr(vi,Si,1)});function Gf(vi,wi,Si){var Ti=ys(vi)?ic:P_;return Si&&An(vi,wi,Si)&&(wi=hi),Ti(vi,gs(wi,3))}function Wf(vi,wi){var Si=ys(vi)?_r:Ac;return Si(vi,gs(wi,3))}var Nf=th(bh),zf=th(yh);function Hf(vi,wi){return Ys(Xo(vi,wi),1)}function Vf(vi,wi){return Ys(Xo(vi,wi),Zi)}function jf(vi,wi,Si){return Si=Si===hi?1:Ss(Si),Ys(Xo(vi,wi),Si)}function Th(vi,wi){var Si=ys(vi)?Gn:mr;return Si(vi,gs(wi,3))}function Ph(vi,wi){var Si=ys(vi)?hd:Ec;return Si(vi,gs(wi,3))}var qf=Uo(function(vi,wi,Si){Ls.call(vi,Si)?vi[Si].push(wi):rr(vi,Si,[wi])});function Xf(vi,wi,Si,Ti){vi=In(vi)?vi:Vr(vi),Si=Si&&!Ti?Ss(Si):0;var Mi=vi.length;return Si<0&&(Si=js(Mi+Si,0)),Jo(vi)?Si<=Mi&&vi.indexOf(wi,Si)>-1:!!Mi&&Mr(vi,wi,Si)>-1}var Zf=As(function(vi,wi,Si){var Ti=-1,Mi=typeof wi=="function",Wi=In(vi)?es(vi.length):[];return mr(vi,function(Hi){Wi[++Ti]=Mi?Mn(wi,Hi,Si):no(Hi,wi,Si)}),Wi}),Yf=Uo(function(vi,wi,Si){rr(vi,Si,wi)});function Xo(vi,wi){var Si=ys(vi)?Os:Dc;return Si(vi,gs(wi,3))}function Qf(vi,wi,Si,Ti){return vi==null?[]:(ys(wi)||(wi=wi==null?[]:[wi]),Si=Ti?hi:Si,ys(Si)||(Si=Si==null?[]:[Si]),Bc(vi,wi,Si))}var Kf=Uo(function(vi,wi,Si){vi[Si?0:1].push(wi)},function(){return[[],[]]});function Jf(vi,wi,Si){var Ti=ys(vi)?ya:oc,Mi=arguments.length<3;return Ti(vi,gs(wi,4),Si,Mi,mr)}function tg(vi,wi,Si){var Ti=ys(vi)?ud:oc,Mi=arguments.length<3;return Ti(vi,gs(wi,4),Si,Mi,Ec)}function eg(vi,wi){var Si=ys(vi)?_r:Ac;return Si(vi,Qo(gs(wi,3)))}function ig(vi){var wi=ys(vi)?bc:q_;return wi(vi)}function sg(vi,wi,Si){(Si?An(vi,wi,Si):wi===hi)?wi=1:wi=Ss(wi);var Ti=ys(vi)?S_:X_;return Ti(vi,wi)}function ng(vi){var wi=ys(vi)?E_:Y_;return wi(vi)}function rg(vi){if(vi==null)return 0;if(In(vi))return Jo(vi)?Fr(vi):vi.length;var wi=Js(vi);return wi==ks||wi==qn?vi.size:Wa(vi).length}function og(vi,wi,Si){var Ti=ys(vi)?Ca:Q_;return Si&&An(vi,wi,Si)&&(wi=hi),Ti(vi,gs(wi,3))}var ag=As(function(vi,wi){if(vi==null)return[];var Si=wi.length;return Si>1&&An(vi,wi[0],wi[1])?wi=[]:Si>2&&An(wi[0],wi[1],wi[2])&&(wi=[wi[0]]),Bc(vi,Ys(wi,1),[])}),Zo=Gd||function(){return Zs.Date.now()};function lg(vi,wi){if(typeof wi!="function")throw new Wn(mi);return vi=Ss(vi),function(){if(--vi<1)return wi.apply(this,arguments)}}function Ih(vi,wi,Si){return wi=Si?hi:wi,wi=vi&&wi==null?vi.length:wi,or(vi,Ui,hi,hi,hi,hi,wi)}function Rh(vi,wi){var Si;if(typeof wi!="function")throw new Wn(mi);return vi=Ss(vi),function(){return--vi>0&&(Si=wi.apply(this,arguments)),vi<=1&&(wi=hi),Si}}var ul=As(function(vi,wi,Si){var Ti=Fi;if(Si.length){var Mi=fr(Si,zr(ul));Ti|=Ni}return or(vi,Ti,wi,Si,Mi)}),Dh=As(function(vi,wi,Si){var Ti=Fi|Li;if(Si.length){var Mi=fr(Si,zr(Dh));Ti|=Ni}return or(wi,Ti,vi,Si,Mi)});function Mh(vi,wi,Si){wi=Si?hi:wi;var Ti=or(vi,Ri,hi,hi,hi,hi,hi,wi);return Ti.placeholder=Mh.placeholder,Ti}function Lh(vi,wi,Si){wi=Si?hi:wi;var Ti=or(vi,$i,hi,hi,hi,hi,hi,wi);return Ti.placeholder=Lh.placeholder,Ti}function Fh(vi,wi,Si){var Ti,Mi,Wi,Hi,Xi,Ki,os=0,as=!1,hs=!1,ds=!0;if(typeof vi!="function")throw new Wn(mi);wi=jn(wi)||0,Us(Si)&&(as=!!Si.leading,hs="maxWait"in Si,Wi=hs?js(jn(Si.maxWait)||0,wi):Wi,ds="trailing"in Si?!!Si.trailing:ds);function ps(Ns){var Qn=Ti,ur=Mi;return Ti=Mi=hi,os=Ns,Hi=vi.apply(ur,Qn),Hi}function ms(Ns){return os=Ns,Xi=co(Ts,wi),as?ps(Ns):Hi}function Es(Ns){var Qn=Ns-Ki,ur=Ns-os,tu=wi-Qn;return hs?Ks(tu,Wi-ur):tu}function vs(Ns){var Qn=Ns-Ki,ur=Ns-os;return Ki===hi||Qn>=wi||Qn<0||hs&&ur>=Wi}function Ts(){var Ns=Zo();if(vs(Ns))return Is(Ns);Xi=co(Ts,Es(Ns))}function Is(Ns){return Xi=hi,ds&&Ti?ps(Ns):(Ti=Mi=hi,Hi)}function $n(){Xi!==hi&&Vc(Xi),os=0,Ti=Ki=Mi=Xi=hi}function kn(){return Xi===hi?Hi:Is(Zo())}function On(){var Ns=Zo(),Qn=vs(Ns);if(Ti=arguments,Mi=this,Ki=Ns,Qn){if(Xi===hi)return ms(Ki);if(hs)return Vc(Xi),Xi=co(Ts,wi),ps(Ki)}return Xi===hi&&(Xi=co(Ts,wi)),Hi}return On.cancel=$n,On.flush=kn,On}var cg=As(function(vi,wi){return Sc(vi,1,wi)}),hg=As(function(vi,wi,Si){return Sc(vi,jn(wi)||0,Si)});function ug(vi){return or(vi,Ji)}function Yo(vi,wi){if(typeof vi!="function"||wi!=null&&typeof wi!="function")throw new Wn(mi);var Si=function(){var Ti=arguments,Mi=wi?wi.apply(this,Ti):Ti[0],Wi=Si.cache;if(Wi.has(Mi))return Wi.get(Mi);var Hi=vi.apply(this,Ti);return Si.cache=Wi.set(Mi,Hi)||Wi,Hi};return Si.cache=new(Yo.Cache||nr),Si}Yo.Cache=nr;function Qo(vi){if(typeof vi!="function")throw new Wn(mi);return function(){var wi=arguments;switch(wi.length){case 0:return!vi.call(this);case 1:return!vi.call(this,wi[0]);case 2:return!vi.call(this,wi[0],wi[1]);case 3:return!vi.call(this,wi[0],wi[1],wi[2])}return!vi.apply(this,wi)}}function dg(vi){return Rh(2,vi)}var _g=K_(function(vi,wi){wi=wi.length==1&&ys(wi[0])?Os(wi[0],Ln(gs())):Os(Ys(wi,1),Ln(gs()));var Si=wi.length;return As(function(Ti){for(var Mi=-1,Wi=Ks(Ti.length,Si);++Mi<Wi;)Ti[Mi]=wi[Mi].call(this,Ti[Mi]);return Mn(vi,this,Ti)})}),dl=As(function(vi,wi){var Si=fr(wi,zr(dl));return or(vi,Ni,hi,wi,Si)}),Bh=As(function(vi,wi){var Si=fr(wi,zr(Bh));return or(vi,ji,hi,wi,Si)}),pg=ar(function(vi,wi){return or(vi,qi,hi,hi,hi,wi)});function fg(vi,wi){if(typeof vi!="function")throw new Wn(mi);return wi=wi===hi?wi:Ss(wi),As(vi,wi)}function gg(vi,wi){if(typeof vi!="function")throw new Wn(mi);return wi=wi==null?0:js(Ss(wi),0),As(function(Si){var Ti=Si[wi],Mi=wr(Si,0,wi);return Ti&&pr(Mi,Ti),Mn(vi,this,Mi)})}function mg(vi,wi,Si){var Ti=!0,Mi=!0;if(typeof vi!="function")throw new Wn(mi);return Us(Si)&&(Ti="leading"in Si?!!Si.leading:Ti,Mi="trailing"in Si?!!Si.trailing:Mi),Fh(vi,wi,{leading:Ti,maxWait:wi,trailing:Mi})}function vg(vi){return Ih(vi,1)}function xg(vi,wi){return dl(Ya(wi),vi)}function wg(){if(!arguments.length)return[];var vi=arguments[0];return ys(vi)?vi:[vi]}function bg(vi){return zn(vi,Pi)}function yg(vi,wi){return wi=typeof wi=="function"?wi:hi,zn(vi,Pi,wi)}function Cg(vi){return zn(vi,Ai|Pi)}function Sg(vi,wi){return wi=typeof wi=="function"?wi:hi,zn(vi,Ai|Pi,wi)}function Eg(vi,wi){return wi==null||Cc(vi,wi,Xs(wi))}function Yn(vi,wi){return vi===wi||vi!==vi&&wi!==wi}var Ag=zo(Oa),kg=zo(function(vi,wi){return vi>=wi}),Ir=Pc(function(){return arguments}())?Pc:function(vi){return Gs(vi)&&Ls.call(vi,"callee")&&!fc.call(vi,"callee")},ys=es.isArray,Tg=Yl?Ln(Yl):F_;function In(vi){return vi!=null&&Ko(vi.length)&&!cr(vi)}function Ws(vi){return Gs(vi)&&In(vi)}function Pg(vi){return vi===!0||vi===!1||Gs(vi)&&wn(vi)==qs}var br=Nd||Cl,Ig=Ql?Ln(Ql):B_;function Rg(vi){return Gs(vi)&&vi.nodeType===1&&!ho(vi)}function Dg(vi){if(vi==null)return!0;if(In(vi)&&(ys(vi)||typeof vi=="string"||typeof vi.splice=="function"||br(vi)||Hr(vi)||Ir(vi)))return!vi.length;var wi=Js(vi);if(wi==ks||wi==qn)return!vi.size;if(lo(vi))return!Wa(vi).length;for(var Si in vi)if(Ls.call(vi,Si))return!1;return!0}function Mg(vi,wi){return ro(vi,wi)}function Lg(vi,wi,Si){Si=typeof Si=="function"?Si:hi;var Ti=Si?Si(vi,wi):hi;return Ti===hi?ro(vi,wi,hi,Si):!!Ti}function _l(vi){if(!Gs(vi))return!1;var wi=wn(vi);return wi==Qs||wi==dr||typeof vi.message=="string"&&typeof vi.name=="string"&&!ho(vi)}function Fg(vi){return typeof vi=="number"&&mc(vi)}function cr(vi){if(!Us(vi))return!1;var wi=wn(vi);return wi==hn||wi==Kn||wi==Hs||wi==nu}function $h(vi){return typeof vi=="number"&&vi==Ss(vi)}function Ko(vi){return typeof vi=="number"&&vi>-1&&vi%1==0&&vi<=ts}function Us(vi){var wi=typeof vi;return vi!=null&&(wi=="object"||wi=="function")}function Gs(vi){return vi!=null&&typeof vi=="object"}var Oh=Kl?Ln(Kl):O_;function Bg(vi,wi){return vi===wi||Ga(vi,wi,sl(wi))}function $g(vi,wi,Si){return Si=typeof Si=="function"?Si:hi,Ga(vi,wi,sl(wi),Si)}function Og(vi){return Uh(vi)&&vi!=+vi}function Ug(vi){if(bp(vi))throw new ws(gi);return Ic(vi)}function Gg(vi){return vi===null}function Wg(vi){return vi==null}function Uh(vi){return typeof vi=="number"||Gs(vi)&&wn(vi)==zs}function ho(vi){if(!Gs(vi)||wn(vi)!=ir)return!1;var wi=Eo(vi);if(wi===null)return!0;var Si=Ls.call(wi,"constructor")&&wi.constructor;return typeof Si=="function"&&Si instanceof Si&&bo.call(Si)==Bd}var pl=Jl?Ln(Jl):U_;function Ng(vi){return $h(vi)&&vi>=-ts&&vi<=ts}var Gh=tc?Ln(tc):G_;function Jo(vi){return typeof vi=="string"||!ys(vi)&&Gs(vi)&&wn(vi)==qr}function Bn(vi){return typeof vi=="symbol"||Gs(vi)&&wn(vi)==uo}var Hr=ec?Ln(ec):W_;function zg(vi){return vi===hi}function Hg(vi){return Gs(vi)&&Js(vi)==Xr}function Vg(vi){return Gs(vi)&&wn(vi)==ou}var jg=zo(Na),qg=zo(function(vi,wi){return vi<=wi});function Wh(vi){if(!vi)return[];if(In(vi))return Jo(vi)?Xn(vi):Pn(vi);if(Qr&&vi[Qr])return Sd(vi[Qr]());var wi=Js(vi),Si=wi==ks?Pa:wi==qn?vo:Vr;return Si(vi)}function hr(vi){if(!vi)return vi===0?vi:0;if(vi=jn(vi),vi===Zi||vi===-Zi){var wi=vi<0?-1:1;return wi*cs}return vi===vi?vi:0}function Ss(vi){var wi=hr(vi),Si=wi%1;return wi===wi?Si?wi-Si:wi:0}function Nh(vi){return vi?Ar(Ss(vi),0,us):0}function jn(vi){if(typeof vi=="number")return vi;if(Bn(vi))return ls;if(Us(vi)){var wi=typeof vi.valueOf=="function"?vi.valueOf():vi;vi=Us(wi)?wi+"":wi}if(typeof vi!="string")return vi===0?vi:+vi;vi=ac(vi);var Si=ku.test(vi);return Si||Pu.test(vi)?ad(vi.slice(2),Si?2:8):Au.test(vi)?ls:+vi}function zh(vi){return tr(vi,Rn(vi))}function Xg(vi){return vi?Ar(Ss(vi),-ts,ts):vi===0?vi:0}function Ms(vi){return vi==null?"":Fn(vi)}var Zg=Wr(function(vi,wi){if(lo(wi)||In(wi)){tr(wi,Xs(wi),vi);return}for(var Si in wi)Ls.call(wi,Si)&&io(vi,Si,wi[Si])}),Hh=Wr(function(vi,wi){tr(wi,Rn(wi),vi)}),ta=Wr(function(vi,wi,Si,Ti){tr(wi,Rn(wi),vi,Ti)}),Yg=Wr(function(vi,wi,Si,Ti){tr(wi,Xs(wi),vi,Ti)}),Qg=ar(Fa);function Kg(vi,wi){var Si=Gr(vi);return wi==null?Si:yc(Si,wi)}var Jg=As(function(vi,wi){vi=Fs(vi);var Si=-1,Ti=wi.length,Mi=Ti>2?wi[2]:hi;for(Mi&&An(wi[0],wi[1],Mi)&&(Ti=1);++Si<Ti;)for(var Wi=wi[Si],Hi=Rn(Wi),Xi=-1,Ki=Hi.length;++Xi<Ki;){var os=Hi[Xi],as=vi[os];(as===hi||Yn(as,$r[os])&&!Ls.call(vi,os))&&(vi[os]=Wi[os])}return vi}),tm=As(function(vi){return vi.push(hi,ah),Mn(Vh,hi,vi)});function em(vi,wi){return sc(vi,gs(wi,3),Jn)}function im(vi,wi){return sc(vi,gs(wi,3),$a)}function sm(vi,wi){return vi==null?vi:Ba(vi,gs(wi,3),Rn)}function nm(vi,wi){return vi==null?vi:kc(vi,gs(wi,3),Rn)}function rm(vi,wi){return vi&&Jn(vi,gs(wi,3))}function om(vi,wi){return vi&&$a(vi,gs(wi,3))}function am(vi){return vi==null?[]:Fo(vi,Xs(vi))}function lm(vi){return vi==null?[]:Fo(vi,Rn(vi))}function fl(vi,wi,Si){var Ti=vi==null?hi:kr(vi,wi);return Ti===hi?Si:Ti}function cm(vi,wi){return vi!=null&&hh(vi,wi,R_)}function gl(vi,wi){return vi!=null&&hh(vi,wi,D_)}var hm=ih(function(vi,wi,Si){wi!=null&&typeof wi.toString!="function"&&(wi=yo.call(wi)),vi[wi]=Si},vl(Dn)),um=ih(function(vi,wi,Si){wi!=null&&typeof wi.toString!="function"&&(wi=yo.call(wi)),Ls.call(vi,wi)?vi[wi].push(Si):vi[wi]=[Si]},gs),dm=As(no);function Xs(vi){return In(vi)?wc(vi):Wa(vi)}function Rn(vi){return In(vi)?wc(vi,!0):N_(vi)}function _m(vi,wi){var Si={};return wi=gs(wi,3),Jn(vi,function(Ti,Mi,Wi){rr(Si,wi(Ti,Mi,Wi),Ti)}),Si}function pm(vi,wi){var Si={};return wi=gs(wi,3),Jn(vi,function(Ti,Mi,Wi){rr(Si,Mi,wi(Ti,Mi,Wi))}),Si}var fm=Wr(function(vi,wi,Si){Bo(vi,wi,Si)}),Vh=Wr(function(vi,wi,Si,Ti){Bo(vi,wi,Si,Ti)}),gm=ar(function(vi,wi){var Si={};if(vi==null)return Si;var Ti=!1;wi=Os(wi,function(Wi){return Wi=xr(Wi,vi),Ti||(Ti=Wi.length>1),Wi}),tr(vi,el(vi),Si),Ti&&(Si=zn(Si,Ai|ki|Pi,cp));for(var Mi=wi.length;Mi--;)qa(Si,wi[Mi]);return Si});function mm(vi,wi){return jh(vi,Qo(gs(wi)))}var vm=ar(function(vi,wi){return vi==null?{}:H_(vi,wi)});function jh(vi,wi){if(vi==null)return{};var Si=Os(el(vi),function(Ti){return[Ti]});return wi=gs(wi),$c(vi,Si,function(Ti,Mi){return wi(Ti,Mi[0])})}function xm(vi,wi,Si){wi=xr(wi,vi);var Ti=-1,Mi=wi.length;for(Mi||(Mi=1,vi=hi);++Ti<Mi;){var Wi=vi==null?hi:vi[er(wi[Ti])];Wi===hi&&(Ti=Mi,Wi=Si),vi=cr(Wi)?Wi.call(vi):Wi}return vi}function wm(vi,wi,Si){return vi==null?vi:oo(vi,wi,Si)}function bm(vi,wi,Si,Ti){return Ti=typeof Ti=="function"?Ti:hi,vi==null?vi:oo(vi,wi,Si,Ti)}var qh=rh(Xs),Xh=rh(Rn);function ym(vi,wi,Si){var Ti=ys(vi),Mi=Ti||br(vi)||Hr(vi);if(wi=gs(wi,4),Si==null){var Wi=vi&&vi.constructor;Mi?Si=Ti?new Wi:[]:Us(vi)?Si=cr(Wi)?Gr(Eo(vi)):{}:Si={}}return(Mi?Gn:Jn)(vi,function(Hi,Xi,Ki){return wi(Si,Hi,Xi,Ki)}),Si}function Cm(vi,wi){return vi==null?!0:qa(vi,wi)}function Sm(vi,wi,Si){return vi==null?vi:Nc(vi,wi,Ya(Si))}function Em(vi,wi,Si,Ti){return Ti=typeof Ti=="function"?Ti:hi,vi==null?vi:Nc(vi,wi,Ya(Si),Ti)}function Vr(vi){return vi==null?[]:Ta(vi,Xs(vi))}function Am(vi){return vi==null?[]:Ta(vi,Rn(vi))}function km(vi,wi,Si){return Si===hi&&(Si=wi,wi=hi),Si!==hi&&(Si=jn(Si),Si=Si===Si?Si:0),wi!==hi&&(wi=jn(wi),wi=wi===wi?wi:0),Ar(jn(vi),wi,Si)}function Tm(vi,wi,Si){return wi=hr(wi),Si===hi?(Si=wi,wi=0):Si=hr(Si),vi=jn(vi),M_(vi,wi,Si)}function Pm(vi,wi,Si){if(Si&&typeof Si!="boolean"&&An(vi,wi,Si)&&(wi=Si=hi),Si===hi&&(typeof wi=="boolean"?(Si=wi,wi=hi):typeof vi=="boolean"&&(Si=vi,vi=hi)),vi===hi&&wi===hi?(vi=0,wi=1):(vi=hr(vi),wi===hi?(wi=vi,vi=0):wi=hr(wi)),vi>wi){var Ti=vi;vi=wi,wi=Ti}if(Si||vi%1||wi%1){var Mi=vc();return Ks(vi+Mi*(wi-vi+od("1e-"+((Mi+"").length-1))),wi)}return Ha(vi,wi)}var Im=Nr(function(vi,wi,Si){return wi=wi.toLowerCase(),vi+(Si?Zh(wi):wi)});function Zh(vi){return ml(Ms(vi).toLowerCase())}function Yh(vi){return vi=Ms(vi),vi&&vi.replace(Ru,xd).replace(Yu,"")}function Rm(vi,wi,Si){vi=Ms(vi),wi=Fn(wi);var Ti=vi.length;Si=Si===hi?Ti:Ar(Ss(Si),0,Ti);var Mi=Si;return Si-=wi.length,Si>=0&&vi.slice(Si,Mi)==wi}function Dm(vi){return vi=Ms(vi),vi&&uu.test(vi)?vi.replace(kl,wd):vi}function Mm(vi){return vi=Ms(vi),vi&&mu.test(vi)?vi.replace(ua,"\\$&"):vi}var Lm=Nr(function(vi,wi,Si){return vi+(Si?"-":"")+wi.toLowerCase()}),Fm=Nr(function(vi,wi,Si){return vi+(Si?" ":"")+wi.toLowerCase()}),Bm=Jc("toLowerCase");function $m(vi,wi,Si){vi=Ms(vi),wi=Ss(wi);var Ti=wi?Fr(vi):0;if(!wi||Ti>=wi)return vi;var Mi=(wi-Ti)/2;return No(Po(Mi),Si)+vi+No(To(Mi),Si)}function Om(vi,wi,Si){vi=Ms(vi),wi=Ss(wi);var Ti=wi?Fr(vi):0;return wi&&Ti<wi?vi+No(wi-Ti,Si):vi}function Um(vi,wi,Si){vi=Ms(vi),wi=Ss(wi);var Ti=wi?Fr(vi):0;return wi&&Ti<wi?No(wi-Ti,Si)+vi:vi}function Gm(vi,wi,Si){return Si||wi==null?wi=0:wi&&(wi=+wi),jd(Ms(vi).replace(da,""),wi||0)}function Wm(vi,wi,Si){return(Si?An(vi,wi,Si):wi===hi)?wi=1:wi=Ss(wi),Va(Ms(vi),wi)}function Nm(){var vi=arguments,wi=Ms(vi[0]);return vi.length<3?wi:wi.replace(vi[1],vi[2])}var zm=Nr(function(vi,wi,Si){return vi+(Si?"_":"")+wi.toLowerCase()});function Hm(vi,wi,Si){return Si&&typeof Si!="number"&&An(vi,wi,Si)&&(wi=Si=hi),Si=Si===hi?us:Si>>>0,Si?(vi=Ms(vi),vi&&(typeof wi=="string"||wi!=null&&!pl(wi))&&(wi=Fn(wi),!wi&&Lr(vi))?wr(Xn(vi),0,Si):vi.split(wi,Si)):[]}var Vm=Nr(function(vi,wi,Si){return vi+(Si?" ":"")+ml(wi)});function jm(vi,wi,Si){return vi=Ms(vi),Si=Si==null?0:Ar(Ss(Si),0,vi.length),wi=Fn(wi),vi.slice(Si,Si+wi.length)==wi}function qm(vi,wi,Si){var Ti=Oi.templateSettings;Si&&An(vi,wi,Si)&&(wi=hi),vi=Ms(vi),wi=ta({},wi,Ti,oh);var Mi=ta({},wi.imports,Ti.imports,oh),Wi=Xs(Mi),Hi=Ta(Mi,Wi),Xi,Ki,os=0,as=wi.interpolate||_o,hs="__p += '",ds=Ia((wi.escape||_o).source+"|"+as.source+"|"+(as===Tl?Eu:_o).source+"|"+(wi.evaluate||_o).source+"|$","g"),ps="//# sourceURL="+(Ls.call(wi,"sourceURL")?(wi.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ed+"]")+`
`;vi.replace(ds,function(vs,Ts,Is,$n,kn,On){return Is||(Is=$n),hs+=vi.slice(os,On).replace(Du,bd),Ts&&(Xi=!0,hs+=`' +
__e(`+Ts+`) +
'`),kn&&(Ki=!0,hs+=`';
`+kn+`;
__p += '`),Is&&(hs+=`' +
((__t = (`+Is+`)) == null ? '' : __t) +
'`),os=On+vs.length,vs}),hs+=`';
`;var ms=Ls.call(wi,"variable")&&wi.variable;if(!ms)hs=`with (obj) {
`+hs+`
}
`;else if(Cu.test(ms))throw new ws(xi);hs=(Ki?hs.replace(au,""):hs).replace(lu,"$1").replace(cu,"$1;"),hs="function("+(ms||"obj")+`) {
`+(ms?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Xi?", __e = _.escape":"")+(Ki?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+hs+`return __p
}`;var Es=Kh(function(){return Rs(Wi,ps+"return "+hs).apply(hi,Hi)});if(Es.source=hs,_l(Es))throw Es;return Es}function Xm(vi){return Ms(vi).toLowerCase()}function Zm(vi){return Ms(vi).toUpperCase()}function Ym(vi,wi,Si){if(vi=Ms(vi),vi&&(Si||wi===hi))return ac(vi);if(!vi||!(wi=Fn(wi)))return vi;var Ti=Xn(vi),Mi=Xn(wi),Wi=lc(Ti,Mi),Hi=cc(Ti,Mi)+1;return wr(Ti,Wi,Hi).join("")}function Qm(vi,wi,Si){if(vi=Ms(vi),vi&&(Si||wi===hi))return vi.slice(0,uc(vi)+1);if(!vi||!(wi=Fn(wi)))return vi;var Ti=Xn(vi),Mi=cc(Ti,Xn(wi))+1;return wr(Ti,0,Mi).join("")}function Km(vi,wi,Si){if(vi=Ms(vi),vi&&(Si||wi===hi))return vi.replace(da,"");if(!vi||!(wi=Fn(wi)))return vi;var Ti=Xn(vi),Mi=lc(Ti,Xn(wi));return wr(Ti,Mi).join("")}function Jm(vi,wi){var Si=rs,Ti=ss;if(Us(wi)){var Mi="separator"in wi?wi.separator:Mi;Si="length"in wi?Ss(wi.length):Si,Ti="omission"in wi?Fn(wi.omission):Ti}vi=Ms(vi);var Wi=vi.length;if(Lr(vi)){var Hi=Xn(vi);Wi=Hi.length}if(Si>=Wi)return vi;var Xi=Si-Fr(Ti);if(Xi<1)return Ti;var Ki=Hi?wr(Hi,0,Xi).join(""):vi.slice(0,Xi);if(Mi===hi)return Ki+Ti;if(Hi&&(Xi+=Ki.length-Xi),pl(Mi)){if(vi.slice(Xi).search(Mi)){var os,as=Ki;for(Mi.global||(Mi=Ia(Mi.source,Ms(Pl.exec(Mi))+"g")),Mi.lastIndex=0;os=Mi.exec(as);)var hs=os.index;Ki=Ki.slice(0,hs===hi?Xi:hs)}}else if(vi.indexOf(Fn(Mi),Xi)!=Xi){var ds=Ki.lastIndexOf(Mi);ds>-1&&(Ki=Ki.slice(0,ds))}return Ki+Ti}function tv(vi){return vi=Ms(vi),vi&&hu.test(vi)?vi.replace(Al,Td):vi}var ev=Nr(function(vi,wi,Si){return vi+(Si?" ":"")+wi.toUpperCase()}),ml=Jc("toUpperCase");function Qh(vi,wi,Si){return vi=Ms(vi),wi=Si?hi:wi,wi===hi?Cd(vi)?Rd(vi):pd(vi):vi.match(wi)||[]}var Kh=As(function(vi,wi){try{return Mn(vi,hi,wi)}catch(Si){return _l(Si)?Si:new ws(Si)}}),iv=ar(function(vi,wi){return Gn(wi,function(Si){Si=er(Si),rr(vi,Si,ul(vi[Si],vi))}),vi});function sv(vi){var wi=vi==null?0:vi.length,Si=gs();return vi=wi?Os(vi,function(Ti){if(typeof Ti[1]!="function")throw new Wn(mi);return[Si(Ti[0]),Ti[1]]}):[],As(function(Ti){for(var Mi=-1;++Mi<wi;){var Wi=vi[Mi];if(Mn(Wi[0],this,Ti))return Mn(Wi[1],this,Ti)}})}function nv(vi){return T_(zn(vi,Ai))}function vl(vi){return function(){return vi}}function rv(vi,wi){return vi==null||vi!==vi?wi:vi}var ov=eh(),av=eh(!0);function Dn(vi){return vi}function xl(vi){return Rc(typeof vi=="function"?vi:zn(vi,Ai))}function lv(vi){return Mc(zn(vi,Ai))}function cv(vi,wi){return Lc(vi,zn(wi,Ai))}var hv=As(function(vi,wi){return function(Si){return no(Si,vi,wi)}}),uv=As(function(vi,wi){return function(Si){return no(vi,Si,wi)}});function wl(vi,wi,Si){var Ti=Xs(wi),Mi=Fo(wi,Ti);Si==null&&!(Us(wi)&&(Mi.length||!Ti.length))&&(Si=wi,wi=vi,vi=this,Mi=Fo(wi,Xs(wi)));var Wi=!(Us(Si)&&"chain"in Si)||!!Si.chain,Hi=cr(vi);return Gn(Mi,function(Xi){var Ki=wi[Xi];vi[Xi]=Ki,Hi&&(vi.prototype[Xi]=function(){var os=this.__chain__;if(Wi||os){var as=vi(this.__wrapped__),hs=as.__actions__=Pn(this.__actions__);return hs.push({func:Ki,args:arguments,thisArg:vi}),as.__chain__=os,as}return Ki.apply(vi,pr([this.value()],arguments))})}),vi}function dv(){return Zs._===this&&(Zs._=$d),this}function bl(){}function _v(vi){return vi=Ss(vi),As(function(wi){return Fc(wi,vi)})}var pv=Ka(Os),fv=Ka(ic),gv=Ka(Ca);function Jh(vi){return rl(vi)?Sa(er(vi)):V_(vi)}function mv(vi){return function(wi){return vi==null?hi:kr(vi,wi)}}var vv=sh(),xv=sh(!0);function yl(){return[]}function Cl(){return!1}function wv(){return{}}function bv(){return""}function yv(){return!0}function Cv(vi,wi){if(vi=Ss(vi),vi<1||vi>ts)return[];var Si=us,Ti=Ks(vi,us);wi=gs(wi),vi-=us;for(var Mi=ka(Ti,wi);++Si<vi;)wi(Si);return Mi}function Sv(vi){return ys(vi)?Os(vi,er):Bn(vi)?[vi]:Pn(xh(Ms(vi)))}function Ev(vi){var wi=++Fd;return Ms(vi)+wi}var Av=Wo(function(vi,wi){return vi+wi},0),kv=Ja("ceil"),Tv=Wo(function(vi,wi){return vi/wi},1),Pv=Ja("floor");function Iv(vi){return vi&&vi.length?Lo(vi,Dn,Oa):hi}function Rv(vi,wi){return vi&&vi.length?Lo(vi,gs(wi,2),Oa):hi}function Dv(vi){return rc(vi,Dn)}function Mv(vi,wi){return rc(vi,gs(wi,2))}function Lv(vi){return vi&&vi.length?Lo(vi,Dn,Na):hi}function Fv(vi,wi){return vi&&vi.length?Lo(vi,gs(wi,2),Na):hi}var Bv=Wo(function(vi,wi){return vi*wi},1),$v=Ja("round"),Ov=Wo(function(vi,wi){return vi-wi},0);function Uv(vi){return vi&&vi.length?Aa(vi,Dn):0}function Gv(vi,wi){return vi&&vi.length?Aa(vi,gs(wi,2)):0}return Oi.after=lg,Oi.ary=Ih,Oi.assign=Zg,Oi.assignIn=Hh,Oi.assignInWith=ta,Oi.assignWith=Yg,Oi.at=Qg,Oi.before=Rh,Oi.bind=ul,Oi.bindAll=iv,Oi.bindKey=Dh,Oi.castArray=wg,Oi.chain=kh,Oi.chunk=Tp,Oi.compact=Pp,Oi.concat=Ip,Oi.cond=sv,Oi.conforms=nv,Oi.constant=vl,Oi.countBy=Uf,Oi.create=Kg,Oi.curry=Mh,Oi.curryRight=Lh,Oi.debounce=Fh,Oi.defaults=Jg,Oi.defaultsDeep=tm,Oi.defer=cg,Oi.delay=hg,Oi.difference=Rp,Oi.differenceBy=Dp,Oi.differenceWith=Mp,Oi.drop=Lp,Oi.dropRight=Fp,Oi.dropRightWhile=Bp,Oi.dropWhile=$p,Oi.fill=Op,Oi.filter=Wf,Oi.flatMap=Hf,Oi.flatMapDeep=Vf,Oi.flatMapDepth=jf,Oi.flatten=Ch,Oi.flattenDeep=Up,Oi.flattenDepth=Gp,Oi.flip=ug,Oi.flow=ov,Oi.flowRight=av,Oi.fromPairs=Wp,Oi.functions=am,Oi.functionsIn=lm,Oi.groupBy=qf,Oi.initial=zp,Oi.intersection=Hp,Oi.intersectionBy=Vp,Oi.intersectionWith=jp,Oi.invert=hm,Oi.invertBy=um,Oi.invokeMap=Zf,Oi.iteratee=xl,Oi.keyBy=Yf,Oi.keys=Xs,Oi.keysIn=Rn,Oi.map=Xo,Oi.mapKeys=_m,Oi.mapValues=pm,Oi.matches=lv,Oi.matchesProperty=cv,Oi.memoize=Yo,Oi.merge=fm,Oi.mergeWith=Vh,Oi.method=hv,Oi.methodOf=uv,Oi.mixin=wl,Oi.negate=Qo,Oi.nthArg=_v,Oi.omit=gm,Oi.omitBy=mm,Oi.once=dg,Oi.orderBy=Qf,Oi.over=pv,Oi.overArgs=_g,Oi.overEvery=fv,Oi.overSome=gv,Oi.partial=dl,Oi.partialRight=Bh,Oi.partition=Kf,Oi.pick=vm,Oi.pickBy=jh,Oi.property=Jh,Oi.propertyOf=mv,Oi.pull=Yp,Oi.pullAll=Eh,Oi.pullAllBy=Qp,Oi.pullAllWith=Kp,Oi.pullAt=Jp,Oi.range=vv,Oi.rangeRight=xv,Oi.rearg=pg,Oi.reject=eg,Oi.remove=tf,Oi.rest=fg,Oi.reverse=cl,Oi.sampleSize=sg,Oi.set=wm,Oi.setWith=bm,Oi.shuffle=ng,Oi.slice=ef,Oi.sortBy=ag,Oi.sortedUniq=cf,Oi.sortedUniqBy=hf,Oi.split=Hm,Oi.spread=gg,Oi.tail=uf,Oi.take=df,Oi.takeRight=_f,Oi.takeRightWhile=pf,Oi.takeWhile=ff,Oi.tap=If,Oi.throttle=mg,Oi.thru=qo,Oi.toArray=Wh,Oi.toPairs=qh,Oi.toPairsIn=Xh,Oi.toPath=Sv,Oi.toPlainObject=zh,Oi.transform=ym,Oi.unary=vg,Oi.union=gf,Oi.unionBy=mf,Oi.unionWith=vf,Oi.uniq=xf,Oi.uniqBy=wf,Oi.uniqWith=bf,Oi.unset=Cm,Oi.unzip=hl,Oi.unzipWith=Ah,Oi.update=Sm,Oi.updateWith=Em,Oi.values=Vr,Oi.valuesIn=Am,Oi.without=yf,Oi.words=Qh,Oi.wrap=xg,Oi.xor=Cf,Oi.xorBy=Sf,Oi.xorWith=Ef,Oi.zip=Af,Oi.zipObject=kf,Oi.zipObjectDeep=Tf,Oi.zipWith=Pf,Oi.entries=qh,Oi.entriesIn=Xh,Oi.extend=Hh,Oi.extendWith=ta,wl(Oi,Oi),Oi.add=Av,Oi.attempt=Kh,Oi.camelCase=Im,Oi.capitalize=Zh,Oi.ceil=kv,Oi.clamp=km,Oi.clone=bg,Oi.cloneDeep=Cg,Oi.cloneDeepWith=Sg,Oi.cloneWith=yg,Oi.conformsTo=Eg,Oi.deburr=Yh,Oi.defaultTo=rv,Oi.divide=Tv,Oi.endsWith=Rm,Oi.eq=Yn,Oi.escape=Dm,Oi.escapeRegExp=Mm,Oi.every=Gf,Oi.find=Nf,Oi.findIndex=bh,Oi.findKey=em,Oi.findLast=zf,Oi.findLastIndex=yh,Oi.findLastKey=im,Oi.floor=Pv,Oi.forEach=Th,Oi.forEachRight=Ph,Oi.forIn=sm,Oi.forInRight=nm,Oi.forOwn=rm,Oi.forOwnRight=om,Oi.get=fl,Oi.gt=Ag,Oi.gte=kg,Oi.has=cm,Oi.hasIn=gl,Oi.head=Sh,Oi.identity=Dn,Oi.includes=Xf,Oi.indexOf=Np,Oi.inRange=Tm,Oi.invoke=dm,Oi.isArguments=Ir,Oi.isArray=ys,Oi.isArrayBuffer=Tg,Oi.isArrayLike=In,Oi.isArrayLikeObject=Ws,Oi.isBoolean=Pg,Oi.isBuffer=br,Oi.isDate=Ig,Oi.isElement=Rg,Oi.isEmpty=Dg,Oi.isEqual=Mg,Oi.isEqualWith=Lg,Oi.isError=_l,Oi.isFinite=Fg,Oi.isFunction=cr,Oi.isInteger=$h,Oi.isLength=Ko,Oi.isMap=Oh,Oi.isMatch=Bg,Oi.isMatchWith=$g,Oi.isNaN=Og,Oi.isNative=Ug,Oi.isNil=Wg,Oi.isNull=Gg,Oi.isNumber=Uh,Oi.isObject=Us,Oi.isObjectLike=Gs,Oi.isPlainObject=ho,Oi.isRegExp=pl,Oi.isSafeInteger=Ng,Oi.isSet=Gh,Oi.isString=Jo,Oi.isSymbol=Bn,Oi.isTypedArray=Hr,Oi.isUndefined=zg,Oi.isWeakMap=Hg,Oi.isWeakSet=Vg,Oi.join=qp,Oi.kebabCase=Lm,Oi.last=Vn,Oi.lastIndexOf=Xp,Oi.lowerCase=Fm,Oi.lowerFirst=Bm,Oi.lt=jg,Oi.lte=qg,Oi.max=Iv,Oi.maxBy=Rv,Oi.mean=Dv,Oi.meanBy=Mv,Oi.min=Lv,Oi.minBy=Fv,Oi.stubArray=yl,Oi.stubFalse=Cl,Oi.stubObject=wv,Oi.stubString=bv,Oi.stubTrue=yv,Oi.multiply=Bv,Oi.nth=Zp,Oi.noConflict=dv,Oi.noop=bl,Oi.now=Zo,Oi.pad=$m,Oi.padEnd=Om,Oi.padStart=Um,Oi.parseInt=Gm,Oi.random=Pm,Oi.reduce=Jf,Oi.reduceRight=tg,Oi.repeat=Wm,Oi.replace=Nm,Oi.result=xm,Oi.round=$v,Oi.runInContext=Yi,Oi.sample=ig,Oi.size=rg,Oi.snakeCase=zm,Oi.some=og,Oi.sortedIndex=sf,Oi.sortedIndexBy=nf,Oi.sortedIndexOf=rf,Oi.sortedLastIndex=of,Oi.sortedLastIndexBy=af,Oi.sortedLastIndexOf=lf,Oi.startCase=Vm,Oi.startsWith=jm,Oi.subtract=Ov,Oi.sum=Uv,Oi.sumBy=Gv,Oi.template=qm,Oi.times=Cv,Oi.toFinite=hr,Oi.toInteger=Ss,Oi.toLength=Nh,Oi.toLower=Xm,Oi.toNumber=jn,Oi.toSafeInteger=Xg,Oi.toString=Ms,Oi.toUpper=Zm,Oi.trim=Ym,Oi.trimEnd=Qm,Oi.trimStart=Km,Oi.truncate=Jm,Oi.unescape=tv,Oi.uniqueId=Ev,Oi.upperCase=ev,Oi.upperFirst=ml,Oi.each=Th,Oi.eachRight=Ph,Oi.first=Sh,wl(Oi,function(){var vi={};return Jn(Oi,function(wi,Si){Ls.call(Oi.prototype,Si)||(vi[Si]=wi)}),vi}(),{chain:!1}),Oi.VERSION=_i,Gn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(vi){Oi[vi].placeholder=Oi}),Gn(["drop","take"],function(vi,wi){Ps.prototype[vi]=function(Si){Si=Si===hi?1:js(Ss(Si),0);var Ti=this.__filtered__&&!wi?new Ps(this):this.clone();return Ti.__filtered__?Ti.__takeCount__=Ks(Si,Ti.__takeCount__):Ti.__views__.push({size:Ks(Si,us),type:vi+(Ti.__dir__<0?"Right":"")}),Ti},Ps.prototype[vi+"Right"]=function(Si){return this.reverse()[vi](Si).reverse()}}),Gn(["filter","map","takeWhile"],function(vi,wi){var Si=wi+1,Ti=Si==Vi||Si==is;Ps.prototype[vi]=function(Mi){var Wi=this.clone();return Wi.__iteratees__.push({iteratee:gs(Mi,3),type:Si}),Wi.__filtered__=Wi.__filtered__||Ti,Wi}}),Gn(["head","last"],function(vi,wi){var Si="take"+(wi?"Right":"");Ps.prototype[vi]=function(){return this[Si](1).value()[0]}}),Gn(["initial","tail"],function(vi,wi){var Si="drop"+(wi?"":"Right");Ps.prototype[vi]=function(){return this.__filtered__?new Ps(this):this[Si](1)}}),Ps.prototype.compact=function(){return this.filter(Dn)},Ps.prototype.find=function(vi){return this.filter(vi).head()},Ps.prototype.findLast=function(vi){return this.reverse().find(vi)},Ps.prototype.invokeMap=As(function(vi,wi){return typeof vi=="function"?new Ps(this):this.map(function(Si){return no(Si,vi,wi)})}),Ps.prototype.reject=function(vi){return this.filter(Qo(gs(vi)))},Ps.prototype.slice=function(vi,wi){vi=Ss(vi);var Si=this;return Si.__filtered__&&(vi>0||wi<0)?new Ps(Si):(vi<0?Si=Si.takeRight(-vi):vi&&(Si=Si.drop(vi)),wi!==hi&&(wi=Ss(wi),Si=wi<0?Si.dropRight(-wi):Si.take(wi-vi)),Si)},Ps.prototype.takeRightWhile=function(vi){return this.reverse().takeWhile(vi).reverse()},Ps.prototype.toArray=function(){return this.take(us)},Jn(Ps.prototype,function(vi,wi){var Si=/^(?:filter|find|map|reject)|While$/.test(wi),Ti=/^(?:head|last)$/.test(wi),Mi=Oi[Ti?"take"+(wi=="last"?"Right":""):wi],Wi=Ti||/^find/.test(wi);Mi&&(Oi.prototype[wi]=function(){var Hi=this.__wrapped__,Xi=Ti?[1]:arguments,Ki=Hi instanceof Ps,os=Xi[0],as=Ki||ys(Hi),hs=function(Ts){var Is=Mi.apply(Oi,pr([Ts],Xi));return Ti&&ds?Is[0]:Is};as&&Si&&typeof os=="function"&&os.length!=1&&(Ki=as=!1);var ds=this.__chain__,ps=!!this.__actions__.length,ms=Wi&&!ds,Es=Ki&&!ps;if(!Wi&&as){Hi=Es?Hi:new Ps(this);var vs=vi.apply(Hi,Xi);return vs.__actions__.push({func:qo,args:[hs],thisArg:hi}),new Nn(vs,ds)}return ms&&Es?vi.apply(this,Xi):(vs=this.thru(hs),ms?Ti?vs.value()[0]:vs.value():vs)})}),Gn(["pop","push","shift","sort","splice","unshift"],function(vi){var wi=xo[vi],Si=/^(?:push|sort|unshift)$/.test(vi)?"tap":"thru",Ti=/^(?:pop|shift)$/.test(vi);Oi.prototype[vi]=function(){var Mi=arguments;if(Ti&&!this.__chain__){var Wi=this.value();return wi.apply(ys(Wi)?Wi:[],Mi)}return this[Si](function(Hi){return wi.apply(ys(Hi)?Hi:[],Mi)})}}),Jn(Ps.prototype,function(vi,wi){var Si=Oi[wi];if(Si){var Ti=Si.name+"";Ls.call(Ur,Ti)||(Ur[Ti]=[]),Ur[Ti].push({name:wi,func:Si})}}),Ur[Go(hi,Li).name]=[{name:"wrapper",func:hi}],Ps.prototype.clone=Jd,Ps.prototype.reverse=t_,Ps.prototype.value=e_,Oi.prototype.at=Rf,Oi.prototype.chain=Df,Oi.prototype.commit=Mf,Oi.prototype.next=Lf,Oi.prototype.plant=Bf,Oi.prototype.reverse=$f,Oi.prototype.toJSON=Oi.prototype.valueOf=Oi.prototype.value=Of,Oi.prototype.first=Oi.prototype.head,Qr&&(Oi.prototype[Qr]=Ff),Oi},Br=Dd();yr?((yr.exports=Br)._=Br,xa._=Br):Zs._=Br}).call(commonjsGlobal)})(lodash,lodash.exports);var lodashExports=lodash.exports;const model="llama-3.3-70b-versatile";window.levels=levels;let groq;function initGroq(fi){groq=new Groq({apiKey:fi,dangerouslyAllowBrowser:!0})}localStorage.getItem("groqApiKey")?initGroq(localStorage.getItem("groqApiKey")):window.location.hash.startsWith("#gsk_")&&window.location.hash.length==57&&initGroq(window.location.hash.slice(1));const messages=[];function groqBanner(){window.term.writeObject({msg:`No es posible activar las funciones generativas.
Para jugar R.O.K.E. con todas sus caractersticas necesitas una API KEY.
Por favor, obtenga una API KEY.`,"dnde?":"Puedes pedirle una a Sebastian (autor de R.O.K.E.) o crear la tuya propia en Groq.com.",listo:"Bien, ahora escribe abajo la API KEY sin nada ms."},"msg")}const converseDeBounced=lodashExports.debounce(converse,2e3);async function converse(fi,ci){if(!groq){groqBanner();return}window.term.loading(!0);let hi;try{hi=await groq.chat.completions.create({messages:[{role:"system",content:`Eres el guionista y dramaturgo de un videojuego llamado R.O.K.E. - 
          que consiste en explorar un espacio infinito del lore del Internet 
          llamado "Backrooms". 
          
          Tu respuesta debe ser un objeto json que contenga al menos:
           "response", "advice" y "demotivationalQuote".

           El input del usuario vendr en el campo "content" y el estatus del
           usuario en el campo "status" del objeto json que recibiris.
          `},...messages,{role:"user",content:JSON.stringify({content:fi,status:ci.status})}],response_format:{type:"json_object"},model,temperature:1.4,max_tokens:5e3,top_p:1,stream:!1,stop:null})}catch(pi){console.error(pi)}finally{window.term.loading(!1)}const _i=JSON.parse(hi.choices[0].message.content);return messages.push(hi.choices[0].message),_i}const getRoomDescriptionDeBounced=lodashExports.debounce(getRoomDescription,5e3);async function getRoomDescription(fi,ci){if(!groq){groqBanner();return}window.term.loading(!0);let hi;try{hi=await groq.chat.completions.create({messages:[{role:"system",content:`Eres el guionista y dramaturgo de un videojuego llamado R.O.K.E. - 
          que consiste en explorar un espacio infinito del lore del Internet 
          llamado "Backrooms". En cada cambio de pantalla el front-end del 
          juego te enviar un json describiendo el nivel y opcionalmente el 
          estatus del jugador. Tu tarea es retornar una prosa del nivel y/o 
          la situacin, muy breve y levemente sarcstica. No alucines.
          
          Piensa bien tu respuesta, que sea narrativa y no mucho ms.
          Usa oraciones completas y gramtica correcta en todos los campos.
          
          El jugador acaba de entrar a: ${ci.status.location.level} - ${ci.status.location.room}.
          Haz una referencia a la habitacin.

          Tu respuesta debe ser un objeto que contenga al menos:
           "shortDescription", "longDescription" y "easterEgg".
           
           Recuerda ser breve.
           `},...messages,{role:"user",content:JSON.stringify({room:fi,player_status:ci.status})}],response_format:{type:"json_object"},model:"llama-3.3-70b-versatile",temperature:1.6,max_tokens:5e3,top_p:1,stream:!1,stop:null})}catch(pi){console.error(pi)}finally{window.term.loading(!1)}const _i=JSON.parse(hi.choices[0].message.content);return messages.push(hi.choices[0].message),window.term.writeObject(_i,"shortDescription"),hi}function simpleChecksum(fi){let ci=0;for(let hi=0;hi<fi.length;hi++)ci+=fi.charCodeAt(hi);return ci%256}function getRoom(fi){const ci=levels.find(_i=>_i.level==fi.status.location.level),hi=fi.status.location.room;return getRoomDescriptionDeBounced(ci,fi),window.visual.flash(u$2(k$3,{children:[u$2("h2",{children:['"',ci.name,'"']}),u$2("h3",{children:["Sector ",hi]})]})),{...ci,checksum:simpleChecksum(ci.level+"#"+hi)}}function getOrSet(fi,ci){return localStorage.getItem(fi)===null&&localStorage.setItem(fi,ci),localStorage.getItem(fi)}window.rng=RNG$1;class Portal extends __webpack_exports__Actor{constructor(ci,hi){super({x:ci,y:hi,width:32,height:48,z:0,collisionType:__webpack_exports__CollisionType.Passive}),this.graphics.add(RNG$1.getItem(portalAnims))}}const room={portals:[]};function addPortal(fi,ci){const hi=new Portal(fi,ci);return window.game.add(hi),room.portals.push(hi),hi}function clearPortals(){room.portals.forEach(fi=>{fi.kill()}),room.portals=[]}class Player extends __webpack_exports__Actor{constructor(hi,_i){super({name:getOrSet("name","Roke"),pos:__webpack_exports__vec(hi,_i),width:36,height:72,anchor:__webpack_exports__vec(.5,.95),scale:__webpack_exports__vec(.4,.4),z:1,collisionType:__webpack_exports__CollisionType.Active});Sl(this,"status",{firstGame:getOrSet("firstGame",Date.now()),location:{level:getOrSet("level","Level 0"),room:parseInt(getOrSet("room",0))}});Sl(this,"world",null);Motion.addListener("accel",pi=>this.handleAccel(pi)),this.world=getRoom(this)}gotoRoom(hi){const _i=window.dsml1.getIntGridLayers()[0].tilemap;this.status.enteredRoom=Date.now(),window.game.stop(),this.status.location={level:this.world.level,room:hi},this.world=getRoom(this);let pi=__webpack_exports__vec(this.pos.x%32+16,this.pos.y%32);window.dsml1.retile(this.world.checksum).then(gi=>{let mi=gi.getRooms()[0],xi=gi.getRooms()[gi.getRooms().length-1];this.pos.x<0?this.pos=__webpack_exports__vec(gi._width*32-32,xi.getBottom()*32).add(pi):this.pos.x>_i.width&&(this.pos=__webpack_exports__vec(0,mi.getBottom()*32).add(pi)),clearPortals();const[yi,Ci]=RNG$1.getItem(gi.getRooms().slice(1)).getCenter();addPortal(yi*32+16,Ci*32),window.game.currentScene.camera.pos=this.pos,window.game.start()})}update(hi){const _i=window.dsml1.getIntGridLayers()[0].tilemap;this.pos.x>=_i.width&&this.gotoRoom(this.status.location.room+1),this.pos.x<=0&&this.gotoRoom(this.status.location.room-1),(hi.input.keyboard.isHeld(__webpack_exports__Keys.Up)||hi.input.gamepads.at(0).getAxes(__webpack_exports__Axes.LeftStickY)>.5)&&this.vel.addEqual(__webpack_exports__vec(0,-10)),(hi.input.keyboard.isHeld(__webpack_exports__Keys.Left)||hi.input.gamepads.at(0).getAxes(__webpack_exports__Axes.LeftStickX)<-.5)&&this.vel.addEqual(__webpack_exports__vec(-10,0)),(hi.input.keyboard.isHeld(__webpack_exports__Keys.Right)||hi.input.gamepads.at(0).getAxes(__webpack_exports__Axes.LeftStickX)>.5)&&this.vel.addEqual(__webpack_exports__vec(10,0)),this.vel.y>90?this.graphics.use(flyMan):Math.abs(this.vel.x)>120?this.graphics.use(runMan):Math.abs(this.vel.x)>2?this.graphics.use(walkMan):this.graphics.use(idleMan),this.vel.x>.1?this.graphics.flipHorizontal=!1:this.vel.x<-.1&&(this.graphics.flipHorizontal=!0)}experiment(){sounds.enter.play(.5)}handleAccel(hi){__webpack_exports__vec(hi.accelerationIncludingGravity.x,hi.accelerationIncludingGravity.y).magnitude>2&&(isSafari?this.vel.addEqual(__webpack_exports__vec(hi.accelerationIncludingGravity.x,-hi.accelerationIncludingGravity.y<0?-hi.accelerationIncludingGravity.y:0)):this.vel.addEqual(__webpack_exports__vec(-hi.accelerationIncludingGravity.x,hi.accelerationIncludingGravity.y<0?hi.accelerationIncludingGravity.y:0)))}}const logo="/roke/assets/logo512-C6TCsj5H.png";var t,r,u,i,o=0,f=[],c=l$2,e=c.__b,a=c.__r,v=c.diffed,l=c.__c,m=c.unmount,s=c.__;function d(fi,ci){c.__h&&c.__h(r,fi,o||ci),o=0;var hi=r.__H||(r.__H={__:[],__h:[]});return fi>=hi.__.length&&hi.__.push({}),hi.__[fi]}function h(fi){return o=1,p(D$1,fi)}function p(fi,ci,hi){var _i=d(t++,2);if(_i.t=fi,!_i.__c&&(_i.__=[hi?hi(ci):D$1(void 0,ci),function(xi){var yi=_i.__N?_i.__N[0]:_i.__[0],Ci=_i.t(yi,xi);yi!==Ci&&(_i.__N=[Ci,_i.__[1]],_i.__c.setState({}))}],_i.__c=r,!r.u)){var pi=function(xi,yi,Ci){if(!_i.__c.__H)return!0;var Ei=_i.__c.__H.__.filter(function(ki){return!!ki.__c});if(Ei.every(function(ki){return!ki.__N}))return!gi||gi.call(this,xi,yi,Ci);var Ai=_i.__c.props!==xi;return Ei.forEach(function(ki){if(ki.__N){var Pi=ki.__[0];ki.__=ki.__N,ki.__N=void 0,Pi!==ki.__[0]&&(Ai=!0)}}),gi&&gi.call(this,xi,yi,Ci)||Ai};r.u=!0;var gi=r.shouldComponentUpdate,mi=r.componentWillUpdate;r.componentWillUpdate=function(xi,yi,Ci){if(this.__e){var Ei=gi;gi=void 0,pi(xi,yi,Ci),gi=Ei}mi&&mi.call(this,xi,yi,Ci)},r.shouldComponentUpdate=pi}return _i.__N||_i.__}function y(fi,ci){var hi=d(t++,3);!c.__s&&C$1(hi.__H,ci)&&(hi.__=fi,hi.i=ci,r.__H.__h.push(hi))}function _(fi,ci){var hi=d(t++,4);!c.__s&&C$1(hi.__H,ci)&&(hi.__=fi,hi.i=ci,r.__h.push(hi))}function A$1(fi){return o=5,T$1(function(){return{current:fi}},[])}function F$1(fi,ci,hi){o=6,_(function(){return typeof fi=="function"?(fi(ci()),function(){return fi(null)}):fi?(fi.current=ci(),function(){return fi.current=null}):void 0},hi==null?hi:hi.concat(fi))}function T$1(fi,ci){var hi=d(t++,7);return C$1(hi.__H,ci)&&(hi.__=fi(),hi.__H=ci,hi.__h=fi),hi.__}function q$1(fi,ci){return o=8,T$1(function(){return fi},ci)}function x$1(fi){var ci=r.context[fi.__c],hi=d(t++,9);return hi.c=fi,ci?(hi.__==null&&(hi.__=!0,ci.sub(r)),ci.props.value):fi.__}function P$1(fi,ci){c.useDebugValue&&c.useDebugValue(ci?ci(fi):fi)}function g$1(){var fi=d(t++,11);if(!fi.__){for(var ci=r.__v;ci!==null&&!ci.__m&&ci.__!==null;)ci=ci.__;var hi=ci.__m||(ci.__m=[0,0]);fi.__="P"+hi[0]+"-"+hi[1]++}return fi.__}function j$1(){for(var fi;fi=f.shift();)if(fi.__P&&fi.__H)try{fi.__H.__h.forEach(z$1),fi.__H.__h.forEach(B$1),fi.__H.__h=[]}catch(ci){fi.__H.__h=[],c.__e(ci,fi.__v)}}c.__b=function(fi){r=null,e&&e(fi)},c.__=function(fi,ci){fi&&ci.__k&&ci.__k.__m&&(fi.__m=ci.__k.__m),s&&s(fi,ci)},c.__r=function(fi){a&&a(fi),t=0;var ci=(r=fi.__c).__H;ci&&(u===r?(ci.__h=[],r.__h=[],ci.__.forEach(function(hi){hi.__N&&(hi.__=hi.__N),hi.i=hi.__N=void 0})):(ci.__h.forEach(z$1),ci.__h.forEach(B$1),ci.__h=[],t=0)),u=r},c.diffed=function(fi){v&&v(fi);var ci=fi.__c;ci&&ci.__H&&(ci.__H.__h.length&&(f.push(ci)!==1&&i===c.requestAnimationFrame||((i=c.requestAnimationFrame)||w$1)(j$1)),ci.__H.__.forEach(function(hi){hi.i&&(hi.__H=hi.i),hi.i=void 0})),u=r=null},c.__c=function(fi,ci){ci.some(function(hi){try{hi.__h.forEach(z$1),hi.__h=hi.__h.filter(function(_i){return!_i.__||B$1(_i)})}catch(_i){ci.some(function(pi){pi.__h&&(pi.__h=[])}),ci=[],c.__e(_i,hi.__v)}}),l&&l(fi,ci)},c.unmount=function(fi){m&&m(fi);var ci,hi=fi.__c;hi&&hi.__H&&(hi.__H.__.forEach(function(_i){try{z$1(_i)}catch(pi){ci=pi}}),hi.__H=void 0,ci&&c.__e(ci,hi.__v))};var k$1=typeof requestAnimationFrame=="function";function w$1(fi){var ci,hi=function(){clearTimeout(_i),k$1&&cancelAnimationFrame(ci),setTimeout(fi)},_i=setTimeout(hi,100);k$1&&(ci=requestAnimationFrame(hi))}function z$1(fi){var ci=r,hi=fi.__c;typeof hi=="function"&&(fi.__c=void 0,hi()),r=ci}function B$1(fi){var ci=r;fi.__c=fi.__(),r=ci}function C$1(fi,ci){return!fi||fi.length!==ci.length||ci.some(function(hi,_i){return hi!==fi[_i]})}function D$1(fi,ci){return typeof ci=="function"?ci(fi):ci}function g(fi,ci){for(var hi in fi)if(hi!=="__source"&&!(hi in ci))return!0;for(var _i in ci)if(_i!=="__source"&&fi[_i]!==ci[_i])return!0;return!1}function E(fi,ci){var hi=ci(),_i=h({t:{__:hi,u:ci}}),pi=_i[0].t,gi=_i[1];return _(function(){pi.__=hi,pi.u=ci,C(pi)&&gi({t:pi})},[fi,hi,ci]),y(function(){return C(pi)&&gi({t:pi}),fi(function(){C(pi)&&gi({t:pi})})},[fi]),hi}function C(fi){var ci,hi,_i=fi.u,pi=fi.__;try{var gi=_i();return!((ci=pi)===(hi=gi)&&(ci!==0||1/ci==1/hi)||ci!=ci&&hi!=hi)}catch{return!0}}function x(fi){fi()}function R(fi){return fi}function w(){return[!1,x]}var k=_;function I(fi,ci){this.props=fi,this.context=ci}function N(fi,ci){function hi(pi){var gi=this.props.ref,mi=gi==pi.ref;return!mi&&gi&&(gi.call?gi(null):gi.current=null),ci?!ci(this.props,pi)||!mi:g(this.props,pi)}function _i(pi){return this.shouldComponentUpdate=hi,g$3(fi,pi)}return _i.displayName="Memo("+(fi.displayName||fi.name)+")",_i.prototype.isReactComponent=!0,_i.__f=!0,_i}(I.prototype=new x$3).isPureReactComponent=!0,I.prototype.shouldComponentUpdate=function(fi,ci){return g(this.props,fi)||g(this.state,ci)};var M=l$2.__b;l$2.__b=function(fi){fi.type&&fi.type.__f&&fi.ref&&(fi.props.ref=fi.ref,fi.ref=null),M&&M(fi)};var T=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function A(fi){function ci(hi){if(!("ref"in hi))return fi(hi,null);var _i=hi.ref;delete hi.ref;var pi=fi(hi,_i);return hi.ref=_i,pi}return ci.$$typeof=T,ci.render=ci,ci.prototype.isReactComponent=ci.__f=!0,ci.displayName="ForwardRef("+(fi.displayName||fi.name)+")",ci}var D=function(fi,ci){return fi==null?null:H$2(H$2(fi).map(ci))},L={map:D,forEach:D,count:function(fi){return fi?H$2(fi).length:0},only:function(fi){var ci=H$2(fi);if(ci.length!==1)throw"Children.only";return ci[0]},toArray:H$2},O=l$2.__e;l$2.__e=function(fi,ci,hi,_i){if(fi.then){for(var pi,gi=ci;gi=gi.__;)if((pi=gi.__c)&&pi.__c)return ci.__e==null&&(ci.__e=hi.__e,ci.__k=hi.__k),pi.__c(fi,ci)}O(fi,ci,hi,_i)};var F=l$2.unmount;function U(fi,ci,hi){return fi&&(fi.__c&&fi.__c.__H&&(fi.__c.__H.__.forEach(function(_i){typeof _i.__c=="function"&&_i.__c()}),fi.__c.__H=null),(fi=function(_i,pi){for(var gi in pi)_i[gi]=pi[gi];return _i}({},fi)).__c!=null&&(fi.__c.__P===hi&&(fi.__c.__P=ci),fi.__c=null),fi.__k=fi.__k&&fi.__k.map(function(_i){return U(_i,ci,hi)})),fi}function V(fi,ci,hi){return fi&&hi&&(fi.__v=null,fi.__k=fi.__k&&fi.__k.map(function(_i){return V(_i,ci,hi)}),fi.__c&&fi.__c.__P===ci&&(fi.__e&&hi.appendChild(fi.__e),fi.__c.__e=!0,fi.__c.__P=hi)),fi}function W(){this.__u=0,this.o=null,this.__b=null}function P(fi){var ci=fi.__.__c;return ci&&ci.__a&&ci.__a(fi)}function j(fi){var ci,hi,_i;function pi(gi){if(ci||(ci=fi()).then(function(mi){hi=mi.default||mi},function(mi){_i=mi}),_i)throw _i;if(!hi)throw ci;return g$3(hi,gi)}return pi.displayName="Lazy",pi.__f=!0,pi}function z(){this.i=null,this.l=null}l$2.unmount=function(fi){var ci=fi.__c;ci&&ci.__R&&ci.__R(),ci&&32&fi.__u&&(fi.type=null),F&&F(fi)},(W.prototype=new x$3).__c=function(fi,ci){var hi=ci.__c,_i=this;_i.o==null&&(_i.o=[]),_i.o.push(hi);var pi=P(_i.__v),gi=!1,mi=function(){gi||(gi=!0,hi.__R=null,pi?pi(xi):xi())};hi.__R=mi;var xi=function(){if(!--_i.__u){if(_i.state.__a){var yi=_i.state.__a;_i.__v.__k[0]=V(yi,yi.__c.__P,yi.__c.__O)}var Ci;for(_i.setState({__a:_i.__b=null});Ci=_i.o.pop();)Ci.forceUpdate()}};_i.__u++||32&ci.__u||_i.setState({__a:_i.__b=_i.__v.__k[0]}),fi.then(mi,mi)},W.prototype.componentWillUnmount=function(){this.o=[]},W.prototype.render=function(fi,ci){if(this.__b){if(this.__v.__k){var hi=document.createElement("div"),_i=this.__v.__k[0].__c;this.__v.__k[0]=U(this.__b,hi,_i.__O=_i.__P)}this.__b=null}var pi=ci.__a&&g$3(k$3,null,fi.fallback);return pi&&(pi.__u&=-33),[g$3(k$3,null,ci.__a?null:fi.children),pi]};var B=function(fi,ci,hi){if(++hi[1]===hi[0]&&fi.l.delete(ci),fi.props.revealOrder&&(fi.props.revealOrder[0]!=="t"||!fi.l.size))for(hi=fi.i;hi;){for(;hi.length>3;)hi.pop()();if(hi[1]<hi[0])break;fi.i=hi=hi[2]}};function H(fi){return this.getChildContext=function(){return fi.context},fi.children}function Z(fi){var ci=this,hi=fi.h;ci.componentWillUnmount=function(){D$3(null,ci.v),ci.v=null,ci.h=null},ci.h&&ci.h!==hi&&ci.componentWillUnmount(),ci.v||(ci.h=hi,ci.v={nodeType:1,parentNode:hi,childNodes:[],contains:function(){return!0},appendChild:function(_i){this.childNodes.push(_i),ci.h.appendChild(_i)},insertBefore:function(_i,pi){this.childNodes.push(_i),ci.h.insertBefore(_i,pi)},removeChild:function(_i){this.childNodes.splice(this.childNodes.indexOf(_i)>>>1,1),ci.h.removeChild(_i)}}),D$3(g$3(H,{context:ci.context},fi.__v),ci.v)}function Y(fi,ci){var hi=g$3(Z,{__v:fi,h:ci});return hi.containerInfo=ci,hi}(z.prototype=new x$3).__a=function(fi){var ci=this,hi=P(ci.__v),_i=ci.l.get(fi);return _i[0]++,function(pi){var gi=function(){ci.props.revealOrder?(_i.push(pi),B(ci,fi,_i)):pi()};hi?hi(gi):gi()}},z.prototype.render=function(fi){this.i=null,this.l=new Map;var ci=H$2(fi.children);fi.revealOrder&&fi.revealOrder[0]==="b"&&ci.reverse();for(var hi=ci.length;hi--;)this.l.set(ci[hi],this.i=[1,0,this.i]);return fi.children},z.prototype.componentDidUpdate=z.prototype.componentDidMount=function(){var fi=this;this.l.forEach(function(ci,hi){B(fi,hi,ci)})};var $=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,q=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,G=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,J=/[A-Z0-9]/g,K=typeof document<"u",Q=function(fi){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(fi)};function X(fi,ci,hi){return ci.__k==null&&(ci.textContent=""),D$3(fi,ci),typeof hi=="function"&&hi(),fi?fi.__c:null}function nn(fi,ci,hi){return E$2(fi,ci),typeof hi=="function"&&hi(),fi?fi.__c:null}x$3.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(fi){Object.defineProperty(x$3.prototype,fi,{configurable:!0,get:function(){return this["UNSAFE_"+fi]},set:function(ci){Object.defineProperty(this,fi,{configurable:!0,writable:!0,value:ci})}})});var tn=l$2.event;function en(){}function rn(){return this.cancelBubble}function un(){return this.defaultPrevented}l$2.event=function(fi){return tn&&(fi=tn(fi)),fi.persist=en,fi.isPropagationStopped=rn,fi.isDefaultPrevented=un,fi.nativeEvent=fi};var on,cn={enumerable:!1,configurable:!0,get:function(){return this.class}},fn=l$2.vnode;l$2.vnode=function(fi){typeof fi.type=="string"&&function(ci){var hi=ci.props,_i=ci.type,pi={},gi=_i.indexOf("-")===-1;for(var mi in hi){var xi=hi[mi];if(!(mi==="value"&&"defaultValue"in hi&&xi==null||K&&mi==="children"&&_i==="noscript"||mi==="class"||mi==="className")){var yi=mi.toLowerCase();mi==="defaultValue"&&"value"in hi&&hi.value==null?mi="value":mi==="download"&&xi===!0?xi="":yi==="translate"&&xi==="no"?xi=!1:yi[0]==="o"&&yi[1]==="n"?yi==="ondoubleclick"?mi="ondblclick":yi!=="onchange"||_i!=="input"&&_i!=="textarea"||Q(hi.type)?yi==="onfocus"?mi="onfocusin":yi==="onblur"?mi="onfocusout":G.test(mi)&&(mi=yi):yi=mi="oninput":gi&&q.test(mi)?mi=mi.replace(J,"-$&").toLowerCase():xi===null&&(xi=void 0),yi==="oninput"&&pi[mi=yi]&&(mi="oninputCapture"),pi[mi]=xi}}_i=="select"&&pi.multiple&&Array.isArray(pi.value)&&(pi.value=H$2(hi.children).forEach(function(Ci){Ci.props.selected=pi.value.indexOf(Ci.props.value)!=-1})),_i=="select"&&pi.defaultValue!=null&&(pi.value=H$2(hi.children).forEach(function(Ci){Ci.props.selected=pi.multiple?pi.defaultValue.indexOf(Ci.props.value)!=-1:pi.defaultValue==Ci.props.value})),hi.class&&!hi.className?(pi.class=hi.class,Object.defineProperty(pi,"className",cn)):(hi.className&&!hi.class||hi.class&&hi.className)&&(pi.class=pi.className=hi.className),ci.props=pi}(fi),fi.$$typeof=$,fn&&fn(fi)};var ln=l$2.__r;l$2.__r=function(fi){ln&&ln(fi),on=fi.__c};var an=l$2.diffed;l$2.diffed=function(fi){an&&an(fi);var ci=fi.props,hi=fi.__e;hi!=null&&fi.type==="textarea"&&"value"in ci&&ci.value!==hi.value&&(hi.value=ci.value==null?"":ci.value),on=null};var sn={ReactCurrentDispatcher:{current:{readContext:function(fi){return on.__n[fi.__c].props.value},useCallback:q$1,useContext:x$1,useDebugValue:P$1,useDeferredValue:R,useEffect:y,useId:g$1,useImperativeHandle:F$1,useInsertionEffect:k,useLayoutEffect:_,useMemo:T$1,useReducer:p,useRef:A$1,useState:h,useSyncExternalStore:E,useTransition:w}}};function vn(fi){return g$3.bind(null,fi)}function dn(fi){return!!fi&&fi.$$typeof===$}function pn(fi){return dn(fi)&&fi.type===k$3}function mn(fi){return!!fi&&!!fi.displayName&&(typeof fi.displayName=="string"||fi.displayName instanceof String)&&fi.displayName.startsWith("Memo(")}function yn(fi){return dn(fi)?G$2.apply(null,arguments):fi}function _n(fi){return!!fi.__k&&(D$3(null,fi),!0)}function bn(fi){return fi&&(fi.base||fi.nodeType===1&&fi)||null}var Sn=function(fi,ci){return fi(ci)},gn=function(fi,ci){return fi(ci)},En=k$3,Cn=dn,xn={useState:h,useId:g$1,useReducer:p,useEffect:y,useLayoutEffect:_,useInsertionEffect:k,useTransition:w,useDeferredValue:R,useSyncExternalStore:E,startTransition:x,useRef:A$1,useImperativeHandle:F$1,useMemo:T$1,useCallback:q$1,useContext:x$1,useDebugValue:P$1,version:"18.3.1",Children:L,render:X,hydrate:nn,unmountComponentAtNode:_n,createPortal:Y,createElement:g$3,createContext:J$2,createFactory:vn,cloneElement:yn,createRef:b$1,Fragment:k$3,isValidElement:dn,isElement:Cn,isFragment:pn,isMemo:mn,findDOMNode:bn,Component:x$3,PureComponent:I,memo:N,forwardRef:A,flushSync:gn,unstable_batchedUpdates:Sn,StrictMode:En,Suspense:W,SuspenseList:z,lazy:j,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:sn},Keyboard;(function(fi){fi.ARROW_DOWN="ArrowDown",fi.ARROW_LEFT="ArrowLeft",fi.ARROW_RIGHT="ArrowRight",fi.ARROW_UP="ArrowUp",fi.END="End",fi.HOME="Home",fi.PAGE_DOWN="PageDown",fi.PAGE_UP="PageUp",fi.DELETE="Delete",fi.BACKSPACE="Backspace",fi.ENTER="Enter"})(Keyboard||(Keyboard={}));var exhaustiveCheck=function(fi){return function(ci){throw new Error("".concat(fi).concat(ci))}},moveActions=[Keyboard.ARROW_LEFT,Keyboard.ARROW_RIGHT,Keyboard.HOME,Keyboard.END],setOfActions$4=new Set(moveActions),isMoveActions=function(fi){return setOfActions$4.has(fi)},moveLeft=function(fi){var ci=fi-1;return ci<0?0:ci},moveRight=function(fi,ci){var hi=fi+1;return hi>ci?ci:hi},moveHome=function(){return 0},moveEnd=function(fi){return fi},checkMoveActions=exhaustiveCheck("Invalid move action: "),newPosition$2=function(fi,ci){var hi=fi.cursorPosition,_i=fi.lastPosition;switch(ci){case Keyboard.ARROW_LEFT:return moveLeft(hi);case Keyboard.ARROW_RIGHT:return moveRight(hi,_i);case Keyboard.HOME:return moveHome();case Keyboard.END:return moveEnd(_i);default:checkMoveActions(ci)}return hi},moveCursor=function(fi,ci){var hi=fi.renderValue,_i=fi.cursorPosition,pi=fi.inputValue,gi=hi.length;return{renderValue:hi,cursorPosition:newPosition$2({cursorPosition:_i,lastPosition:gi},ci),inputValue:pi}},preventedActions=[Keyboard.ARROW_DOWN,Keyboard.ARROW_LEFT,Keyboard.ARROW_RIGHT,Keyboard.ARROW_UP,Keyboard.END,Keyboard.HOME,Keyboard.PAGE_DOWN,Keyboard.PAGE_UP,Keyboard.DELETE,Keyboard.BACKSPACE,Keyboard.ENTER],setOfActions$3=new Set(preventedActions),isPreventedActions=function(fi){return setOfActions$3.has(fi)},preventActions=function(fi){fi.preventDefault()},submitActions=[Keyboard.ENTER],setOfActions$2=new Set(submitActions),isSubmitActions=function(fi){return setOfActions$2.has(fi)},DEFAULT_INPUT="",DEFAULT_RENDER=[],DEFAULT_POSITION=0,submit=function(){return{inputValue:DEFAULT_INPUT,renderValue:DEFAULT_RENDER,cursorPosition:DEFAULT_POSITION}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var __assign=function(){return __assign=Object.assign||function(ci){for(var hi,_i=1,pi=arguments.length;_i<pi;_i++){hi=arguments[_i];for(var gi in hi)Object.prototype.hasOwnProperty.call(hi,gi)&&(ci[gi]=hi[gi])}return ci},__assign.apply(this,arguments)};function __rest(fi,ci){var hi={};for(var _i in fi)Object.prototype.hasOwnProperty.call(fi,_i)&&ci.indexOf(_i)<0&&(hi[_i]=fi[_i]);if(fi!=null&&typeof Object.getOwnPropertySymbols=="function")for(var pi=0,_i=Object.getOwnPropertySymbols(fi);pi<_i.length;pi++)ci.indexOf(_i[pi])<0&&Object.prototype.propertyIsEnumerable.call(fi,_i[pi])&&(hi[_i[pi]]=fi[_i[pi]]);return hi}function __awaiter(fi,ci,hi,_i){function pi(gi){return gi instanceof hi?gi:new hi(function(mi){mi(gi)})}return new(hi||(hi=Promise))(function(gi,mi){function xi(Ei){try{Ci(_i.next(Ei))}catch(Ai){mi(Ai)}}function yi(Ei){try{Ci(_i.throw(Ei))}catch(Ai){mi(Ai)}}function Ci(Ei){Ei.done?gi(Ei.value):pi(Ei.value).then(xi,yi)}Ci((_i=_i.apply(fi,[])).next())})}function __generator(fi,ci){var hi={label:0,sent:function(){if(gi[0]&1)throw gi[1];return gi[1]},trys:[],ops:[]},_i,pi,gi,mi;return mi={next:xi(0),throw:xi(1),return:xi(2)},typeof Symbol=="function"&&(mi[Symbol.iterator]=function(){return this}),mi;function xi(Ci){return function(Ei){return yi([Ci,Ei])}}function yi(Ci){if(_i)throw new TypeError("Generator is already executing.");for(;hi;)try{if(_i=1,pi&&(gi=Ci[0]&2?pi.return:Ci[0]?pi.throw||((gi=pi.return)&&gi.call(pi),0):pi.next)&&!(gi=gi.call(pi,Ci[1])).done)return gi;switch(pi=0,gi&&(Ci=[Ci[0]&2,gi.value]),Ci[0]){case 0:case 1:gi=Ci;break;case 4:return hi.label++,{value:Ci[1],done:!1};case 5:hi.label++,pi=Ci[1],Ci=[0];continue;case 7:Ci=hi.ops.pop(),hi.trys.pop();continue;default:if(gi=hi.trys,!(gi=gi.length>0&&gi[gi.length-1])&&(Ci[0]===6||Ci[0]===2)){hi=0;continue}if(Ci[0]===3&&(!gi||Ci[1]>gi[0]&&Ci[1]<gi[3])){hi.label=Ci[1];break}if(Ci[0]===6&&hi.label<gi[1]){hi.label=gi[1],gi=Ci;break}if(gi&&hi.label<gi[2]){hi.label=gi[2],hi.ops.push(Ci);break}gi[2]&&hi.ops.pop(),hi.trys.pop();continue}Ci=ci.call(fi,hi)}catch(Ei){Ci=[6,Ei],pi=0}finally{_i=gi=0}if(Ci[0]&5)throw Ci[1];return{value:Ci[0]?Ci[1]:void 0,done:!0}}}function __spreadArray(fi,ci,hi){if(hi||arguments.length===2)for(var _i=0,pi=ci.length,gi;_i<pi;_i++)(gi||!(_i in ci))&&(gi||(gi=Array.prototype.slice.call(ci,0,_i)),gi[_i]=ci[_i]);return fi.concat(gi||Array.prototype.slice.call(ci))}var removeActions=[Keyboard.BACKSPACE,Keyboard.DELETE],setOfActions$1=new Set(removeActions),isRemoveActions=function(fi){return setOfActions$1.has(fi)},checkRemoveActions=exhaustiveCheck("Invalid remove action: "),newPosition$1=function(fi,ci){return fi<0?0:fi>ci?ci:fi},newRender$1=function(fi,ci){return __spreadArray(__spreadArray([],fi.slice(0,ci),!0),fi.slice(ci+1),!0)},newValue=function(fi,ci){return"".concat(fi.substring(0,ci)).concat(fi.substring(ci+1))},handleBackspace=function(fi){var ci=fi.renderValue,hi=fi.inputValue,_i=fi.cursorPosition,pi=_i-1;return pi<0?fi:{renderValue:newRender$1(ci,pi),inputValue:newValue(hi,pi),cursorPosition:newPosition$1(pi,ci.length)}},handleDelete=function(fi){var ci=fi.renderValue,hi=fi.inputValue,_i=fi.cursorPosition;return _i===ci.length?fi:{renderValue:newRender$1(ci,_i),inputValue:newValue(hi,_i),cursorPosition:newPosition$1(_i,ci.length-1)}},remove=function(fi,ci){switch(ci){case Keyboard.BACKSPACE:return handleBackspace(fi);case Keyboard.DELETE:return handleDelete(fi);default:checkRemoveActions(ci)}return fi},newPosition=function(fi){var ci=fi.oldLength,hi=fi.newLength,_i=fi.cursorPosition,pi=ci===_i;return pi?hi:_i},newRender=function(fi){var ci=fi.renderValue,hi=fi.cursorPosition,_i=fi.newInput,pi=ci.length,gi=_i.length-ci.length,mi=_i.substring(hi,hi+gi);return __spreadArray(__spreadArray(__spreadArray([],ci.slice(0,hi),!0),mi.split(""),!0),ci.slice(hi,pi),!0)},press=function(fi){var ci=fi.newInput,hi=fi.renderValue,_i=fi.cursorPosition;if(!ci)throw new Error("Cannot press without a new input");if(ci.length<hi.length)throw new Error("New input is shorter then old one");return{inputValue:ci,renderValue:newRender({newInput:ci,renderValue:hi,cursorPosition:_i}),cursorPosition:newPosition({oldLength:hi.length,newLength:ci.length,cursorPosition:_i})}},serviceActions=[Keyboard.ARROW_UP,Keyboard.ARROW_DOWN],setOfActions=new Set(serviceActions),isServiceActions=function(fi){return setOfActions.has(fi)},checkServiceActions=exhaustiveCheck("Invalid service action: "),handleHistoryMove=function(fi){var ci=fi(),hi=ci.length,_i=ci.split("");return{renderValue:_i,inputValue:ci,cursorPosition:hi}},provideService=function(fi,ci){var hi=fi.renderValue,_i=fi.inputValue,pi=fi.cursorPosition,gi=fi.services,mi=gi.nextCommand,xi=gi.prevCommand;switch(ci){case Keyboard.ARROW_UP:return handleHistoryMove(xi);case Keyboard.ARROW_DOWN:return handleHistoryMove(mi);default:checkServiceActions(ci)}return{renderValue:hi,inputValue:_i,cursorPosition:pi}},defaultState$3={renderValue:[],inputValue:"",cursorPosition:0};function useCommandLine(){var fi=h(defaultState$3.inputValue),ci=fi[0],hi=fi[1],_i=h(defaultState$3.renderValue),pi=_i[0],gi=_i[1],mi=h(defaultState$3.cursorPosition),xi=mi[0],yi=mi[1],Ci=function(Li){var Bi=Li.renderValue,Ri=Li.inputValue,$i=Li.cursorPosition;pi!==Bi&&gi(Bi),ci!==Ri&&hi(Ri),xi!==$i&&yi($i)},Ei=function(Li){return preventActions(Li)},Ai=function(Li){return Ci(press({renderValue:pi,inputValue:ci,cursorPosition:xi,newInput:Li}))},ki=function(Li){return Ci({renderValue:Li.split(""),inputValue:Li,cursorPosition:Li.length})},Pi=function(Li){return Ci(remove({renderValue:pi,inputValue:ci,cursorPosition:xi},Li))},Ii=function(Li){return Ci(moveCursor({renderValue:pi,inputValue:ci,cursorPosition:xi},Li))},Di=function(){return Ci(submit())},Fi=function(Li,Bi){return Ci(provideService({renderValue:pi,inputValue:ci,cursorPosition:xi,services:Bi},Li))};return{state:{inputValue:ci,renderValue:pi,cursorPosition:xi},handlers:{preventDefault:Ei,addCharacter:Ai,setInput:ki,moveCommandCursor:Ii,removeCharacter:Pi,submitCommand:Di,provideCommandService:Fi}}}function useCommandLineInput(){var fi=A$1(null),ci=function(_i){fi.current&&(fi.current.selectionStart=_i,fi.current.selectionEnd=_i)},hi=function(){var _i;return(_i=fi.current)===null||_i===void 0?void 0:_i.focus()};return{state:{inputElementRef:fi},handlers:{focus:hi,setInputCursor:ci}}}var DEFAULT_COMMAND="",next$1=function(fi){var ci=fi.commandsHistory,hi=fi.cursorPosition,_i=ci.length-1,pi=hi+1,gi=_i<pi?ci.length:pi,mi=ci[gi]||DEFAULT_COMMAND;return{commandsHistory:ci,cursorPosition:gi,command:mi}},prev=function(fi){var ci=fi.commandsHistory,hi=fi.cursorPosition,_i=hi-1,pi=_i<0?-1:_i,gi=ci[pi]||DEFAULT_COMMAND;return{commandsHistory:ci,cursorPosition:pi,command:gi}},add=function(fi){var ci=fi.commandsHistory,hi=fi.command,_i=fi.maxHistoryCommands,pi=ci.length,gi=pi-1,mi=ci[gi]===hi;if(mi)return{commandsHistory:ci,cursorPosition:pi};var xi=pi<_i;if(xi)return{commandsHistory:__spreadArray(__spreadArray([],ci,!0),[hi],!1),cursorPosition:pi+1};var yi=!!pi;return yi?{commandsHistory:__spreadArray(__spreadArray([],ci.slice(1),!0),[hi],!1),cursorPosition:pi}:{commandsHistory:ci,cursorPosition:pi}},defaultState$2={commandsHistory:[],cursorPosition:0};function useCommandHistory(fi){var ci=fi.maxHistoryCommands,hi=h(defaultState$2.commandsHistory),_i=hi[0],pi=hi[1],gi=h(defaultState$2.cursorPosition),mi=gi[0],xi=gi[1],yi=function(ki){var Pi=ki.commandsHistory,Ii=ki.cursorPosition;_i!==Pi&&pi(Pi),mi!==Ii&&xi(Ii)},Ci=function(ki){yi(add({maxHistoryCommands:ci,commandsHistory:_i,command:ki}))},Ei=function(){var ki=next$1({commandsHistory:_i,cursorPosition:mi}),Pi=ki.command,Ii=__rest(ki,["command"]);return yi(Ii),Pi},Ai=function(){var ki=prev({commandsHistory:_i,cursorPosition:mi}),Pi=ki.command,Ii=__rest(ki,["command"]);return yi(Ii),Pi};return{state:{commandsHistory:_i},handlers:{addCommand:Ci,nextCommand:Ei,prevCommand:Ai}}}var printWords=function(fi){var ci=fi.remainingWords,hi=fi.printedWords,_i=fi.charactersToPrint,pi=ci[0];if(!pi)return{printedWords:hi,remainingWords:null,wordFullyPrinted:!0};var gi=pi.characters.slice(0,_i),mi=gi.length;return mi===_i?mi<pi.characters.length?{printedWords:__spreadArray(__spreadArray([],hi,!0),[__assign(__assign({},pi),{characters:gi})],!1),remainingWords:__spreadArray([__assign(__assign({},pi),{characters:pi.characters.slice(mi)})],ci.slice(1),!0),wordFullyPrinted:!1}:{printedWords:__spreadArray(__spreadArray([],hi,!0),[pi],!1),remainingWords:ci.slice(1),wordFullyPrinted:!0}:printWords({remainingWords:ci.slice(1),printedWords:__spreadArray(__spreadArray([],hi,!0),[pi],!1),charactersToPrint:_i-mi})},combineWords=function(fi){var ci=fi.prevWord,hi=fi.nextWord,_i=fi.wordFullyPrinted;return ci&&hi&&!_i?__assign(__assign({},ci),{characters:ci.characters+hi.characters}):hi},makeWordChunk=function(fi){var ci=fi.firstWord,hi=fi.printedWords;return ci?__spreadArray([ci],hi.slice(1),!0):hi},appendWordChunk=function(fi){var ci=fi.printedWordsPrev,hi=fi.wordChunk,_i=fi.wordFullyPrintedPrev;return __spreadArray(_i?__spreadArray([],ci,!0):__spreadArray([],ci.slice(0,ci.length-1),!0),hi,!0)},getRemainingLine=function(fi){var ci=fi.remainingLine,hi=fi.remainingWords;return hi&&hi.length>0?__assign(__assign({},ci),{words:hi}):null},printLine=function(fi){var ci=fi.remainingLine,hi=fi.printedLine,_i=fi.charactersToPrint,pi=fi.wordFullyPrinted,gi=hi.words,mi=printWords({remainingWords:ci.words,printedWords:[],charactersToPrint:_i}),xi=mi.printedWords,yi=mi.remainingWords,Ci=mi.wordFullyPrinted,Ei=gi[gi.length-1],Ai=xi[0],ki=combineWords({prevWord:Ei,nextWord:Ai,wordFullyPrinted:pi}),Pi=makeWordChunk({firstWord:ki,printedWords:xi});return{remainingLine:getRemainingLine({remainingLine:ci,remainingWords:yi}),printedLine:__assign(__assign({},hi),{words:appendWordChunk({printedWordsPrev:gi,wordChunk:Pi,wordFullyPrintedPrev:pi})}),wordFullyPrinted:Ci}},combinePrintedLines=function(fi){var ci=fi.printedLines,hi=fi.printedLine,_i=fi.newLine;return _i?__spreadArray(__spreadArray([],ci,!0),[hi],!1):__spreadArray(__spreadArray([],ci.slice(0,ci.length-1),!0),[hi],!1)},combineRemainingLines=function(fi){var ci=fi.remainingLines,hi=fi.remainingLine,_i=hi?__spreadArray([hi],ci.slice(1),!0):ci.slice(1);return _i.length>0?_i:null},printMultiline=function(fi){var ci=fi.remainingLines,hi=fi.printedLines,_i=fi.wordFullyPrinted,pi=fi.newLine,gi=fi.charactersToPrint,mi=ci[0];if(!mi)return{newLine:pi,wordFullyPrinted:_i,printedLines:hi,remainingLines:null};var xi=printLine({remainingLine:mi,printedLine:pi?__assign(__assign({},mi),{words:[]}):hi[hi.length-1],charactersToPrint:gi,wordFullyPrinted:_i}),yi=xi.remainingLine,Ci=xi.printedLine,Ei=xi.wordFullyPrinted;return{newLine:!yi,wordFullyPrinted:Ei,printedLines:combinePrintedLines({printedLines:hi,printedLine:Ci,newLine:pi}),remainingLines:combineRemainingLines({remainingLines:ci,remainingLine:yi})}},makeNewState=function(fi){var ci=fi.prevState,hi=fi.printedLinesNext,_i=fi.newLine;return __spreadArray(_i?__spreadArray([],ci,!0):__spreadArray([],ci.slice(0,ci.length-1),!0),hi,!0)},printer=function(fi){var ci=fi.remainingLines,hi=fi.printedLines,_i=fi.state,pi=fi.wordFullyPrinted,gi=fi.newLine,mi=fi.charactersToPrint,xi=printMultiline({remainingLines:ci,printedLines:hi,wordFullyPrinted:pi,newLine:gi,charactersToPrint:mi}),yi=xi.remainingLines,Ci=xi.printedLines,Ei=xi.wordFullyPrinted,Ai=xi.newLine;return{remainingLines:yi,printedLines:Ci,wordFullyPrinted:Ei,newLine:Ai,state:makeNewState({prevState:_i,printedLinesNext:Ci,newLine:gi})}},createPrinterTask=function(fi,ci){return setTimeout(function(){return fi()},ci)},defaultState$1={state:[],remainingLines:null,printedLines:[],wordFullyPrinted:!0,newLine:!0};function usePrinter(fi){var ci=this,hi=fi.printerSpeed,_i=fi.charactersPerTick,pi=fi.afterPrintCallback,gi=fi.onPrintStatusChange,mi=h(!1),xi=mi[0],yi=mi[1],Ci=h(null),Ei=Ci[0],Ai=Ci[1],ki=h(defaultState$1),Pi=ki[0],Ii=ki[1],Di=A$1(null),Fi=function(){Ei&&(clearTimeout(Ei),Ai(null))},Li=function(){Di.current&&(Di.current(!0),Di.current=null)},Bi=function(){var ji=Pi.remainingLines,Ui=Pi.printedLines,qi=Pi.wordFullyPrinted,Ji=Pi.newLine,rs=Pi.state;if(ji){var ss=printer({remainingLines:ji,printedLines:Ji?[]:Ui,wordFullyPrinted:qi,newLine:Ji,state:rs,charactersToPrint:_i});Ii(ss),Ai(null)}},Ri=function(ji){return __awaiter(ci,void 0,void 0,function(){var Ui;return __generator(this,function(qi){return Ui=printer({remainingLines:ji,printedLines:[],state:Pi.state,wordFullyPrinted:!0,newLine:!0,charactersToPrint:_i}),yi(!0),Ii(Ui),gi==null||gi(!0),[2,new Promise(function(Ji){Di.current=Ji})]})})},$i=function(){yi(!1),Li(),gi==null||gi(!1)},Ni=function(){Ii(defaultState$1)};return y(function(){var ji=xi&&!Pi.remainingLines,Ui=xi&&!Ei,qi=!xi&&Ei;return ji?(console.log(Pi),$i(),pi()):Ui?(Ai(createPrinterTask(Bi,hi)),pi()):qi&&Fi(),function(){}},[xi,Ei]),y(function(){return function(){Fi(),Li()}},[]),{state:Pi.state,handlers:{startPrint:Ri,clear:Ni}}}function useCommandScreen(fi){var ci=fi.printerConfig,hi=usePrinter(ci),_i=hi.state,pi=hi.handlers,gi=pi.startPrint,mi=pi.clear;return{state:_i,handlers:{print:gi,clear:mi}}}var WordTypes;(function(fi){fi.ANCHOR="ANCHOR",fi.TEXT="TEXT",fi.BUTTON="BUTTON",fi.COMMAND="COMMAND"})(WordTypes||(WordTypes={}));var textWord=function(fi){var ci=fi.characters,hi=fi.dataAttribute,_i=fi.className,pi=fi.id;return{type:WordTypes.TEXT,characters:ci,dataAttribute:hi,id:pi,className:_i}},buttonWord=function(fi){var ci=fi.characters,hi=fi.onClick,_i=fi.dataAttribute,pi=fi.className,gi=fi.id;return{type:WordTypes.BUTTON,characters:ci,onClick:hi,dataAttribute:_i,id:gi,className:pi}},commandWord=function(fi){var ci=fi.characters,hi=fi.prompt,_i=fi.dataAttribute,pi=fi.className,gi=fi.id;return{type:WordTypes.COMMAND,characters:ci,prompt:hi,dataAttribute:_i,className:pi,id:gi}},LineTypes;(function(fi){fi.TEXT="TEXT",fi.COMMAND="COMMAND"})(LineTypes||(LineTypes={}));var commandLine=function(fi){var ci=fi.words,hi=fi.dataAttribute,_i=fi.className,pi=fi.id;return{type:LineTypes.COMMAND,words:ci,dataAttribute:hi,className:_i,id:pi}},textLine=function(fi){var ci=fi.words,hi=fi.dataAttribute,_i=fi.className,pi=fi.id;return{type:LineTypes.TEXT,words:ci,dataAttribute:hi,className:_i,id:pi}},PrinterEvents;(function(fi){fi.PRINT="PRINT",fi.CLEAR="CLEAR"})(PrinterEvents||(PrinterEvents={}));var defaultQueue$2=[];function usePrinterQueue(){var fi=A$1(defaultQueue$2).current,ci=h(__spreadArray([],defaultQueue$2,!0)),hi=ci[0],_i=ci[1],pi=function(Ci){fi.push(Ci),_i(__spreadArray([],fi,!0))},gi=function(Ci){fi.shift(),_i(__spreadArray([],fi,!0)),Ci()},mi=function(){return hi[0]},xi=function(Ci){pi({type:PrinterEvents.PRINT,payload:Ci})},yi=function(){pi({type:PrinterEvents.CLEAR})};return{state:hi,handlers:{print:xi,clear:yi,dequeue:gi,nextEvent:mi}}}var TerminalEvents;(function(fi){fi.FOCUS="FOCUS",fi.LOCK="LOCK",fi.LOADING="LOADING"})(TerminalEvents||(TerminalEvents={}));var defaultQueue$1=[];function useTerminalQueue(){var fi=A$1(defaultQueue$1).current,ci=h(__spreadArray([],defaultQueue$1,!0)),hi=ci[0],_i=ci[1],pi=function(Ei){fi.push(Ei),_i(__spreadArray([],fi,!0))},gi=function(Ei){fi.shift(),_i(__spreadArray([],fi,!0)),Ei()},mi=function(){return hi[0]},xi=function(){pi({type:TerminalEvents.FOCUS})},yi=function(Ei){pi({type:TerminalEvents.LOCK,payload:Ei})},Ci=function(Ei){pi({type:TerminalEvents.LOADING,payload:Ei})};return{state:hi,handlers:{focus:xi,lock:yi,loading:Ci,dequeue:gi,nextEvent:mi}}}var defaultQueue=[];function useEventQueue(){var fi=A$1(defaultQueue).current,ci=h(__spreadArray([],defaultQueue,!0)),hi=ci[0],_i=ci[1],pi=function(ki){fi.push(ki),_i(__spreadArray([],fi,!0))},gi=function(ki){fi.shift(),_i(__spreadArray([],fi,!0)),ki()},mi=function(){return hi[0]},xi=function(ki){pi({type:PrinterEvents.PRINT,payload:ki})},yi=function(){pi({type:PrinterEvents.CLEAR})},Ci=function(){pi({type:TerminalEvents.FOCUS})},Ei=function(ki){pi({type:TerminalEvents.LOCK,payload:ki})},Ai=function(ki){pi({type:TerminalEvents.LOADING,payload:ki})};return{state:hi,api:{enqueue:pi,dequeue:gi,nextEvent:mi},handlers:{print:xi,clear:yi,focus:Ci,lock:Ei,loading:Ai}}}var printCommandLine=function(fi){var ci=fi.characters,hi=fi.prompt;return commandLine({words:[commandWord({characters:ci,prompt:hi})]})};function useTerminalController(fi){var ci=this,hi=fi.terminalApp,_i=hi.state.inputLocked,pi=hi.handlers.lock,gi=fi.input.handlers,mi=gi.setInputCursor,xi=gi.focus,yi=fi.commandScreen.handlers,Ci=yi.print,Ei=yi.clear,Ai=fi.commandLine,ki=Ai.state,Pi=ki.cursorPosition,Ii=ki.inputValue,Di=Ai.handlers,Fi=Di.preventDefault,Li=Di.addCharacter,Bi=Di.removeCharacter,Ri=Di.moveCommandCursor,$i=Di.submitCommand,Ni=Di.provideCommandService,ji=fi.commandHistory.handlers,Ui=ji.addCommand,qi=ji.nextCommand,Ji=ji.prevCommand,rs=fi.loaderComponent,ss=rs.isLoading,zi=rs.handlers,Gi=zi.startLoading,Vi=zi.endLoading,Qi=fi.interface,is=Qi.onCommand,Zi=Qi.prompt,ts=Qi.banner,cs=Qi.queue.api.enqueue,ls=fi.focusOnMount,us=h(!1),fs=us[0],xs=us[1],bs=function(){xi()},Cs=function(ks){var zs=ss&&!ks;zs||pi(ks)},Ds=function(){return Ei()},Hs=function(ks){return __awaiter(ci,void 0,void 0,function(){return __generator(this,function(zs){switch(zs.label){case 0:return[4,Ci(ks)];case 1:return zs.sent(),[2]}})})},qs=function(ks){var zs=ks&&ks!==_i,ea=!ks&&fs;zs?(pi(!0),xs(!0)):ea&&(pi(!1),xs(!1))},Tn=function(ks){ks&&!ss?(qs(!0),Gi()):!ks&&ss&&(Vi(),qs(!1))},dr=function(ks){_i||Li(ks)},Qs=function(ks){if(isMoveActions(ks)&&Ri(ks),isRemoveActions(ks)&&Bi(ks),isServiceActions(ks)&&Ni(ks,{nextCommand:qi,prevCommand:Ji}),isSubmitActions(ks)){$i();var zs=Ii.trim();zs&&(Ui(zs),cs({type:PrinterEvents.PRINT,payload:[printCommandLine({characters:zs,prompt:Zi})]}),is(zs))}},hn=function(ks){var zs=ks.key;isPreventedActions(zs)&&Fi(ks),_i||Qs(zs)};y(function(){mi(Pi)},[Pi]);var Kn=A$1(!1);return y(function(){ts&&!Kn.current&&(Kn.current=!0,cs({type:PrinterEvents.PRINT,payload:ts})),ls&&xi()},[]),{handlers:{focus:bs,lock:Cs,clear:Ds,print:Hs,handleInputChange:dr,handleKeyboardDown:hn,loading:Tn}}}var defaultState={inputLocked:!1};function useTerminalApp(){var fi=h(defaultState.inputLocked),ci=fi[0],hi=fi[1],_i=A$1(null),pi=function(xi){var yi=xi.inputLocked;ci!==yi&&hi(yi)},gi=function(xi){return pi({inputLocked:xi})},mi=function(){var xi=_i.current;xi&&(xi.scrollTop=xi.scrollHeight)};return{state:{terminalRef:_i,inputLocked:ci},handlers:{lock:gi,scrollDown:mi}}}function useSubscribePrinterQueue(fi){var ci=this,hi=fi.controller,_i=hi.clear,pi=hi.print,gi=fi.queue,mi=gi.state,xi=gi.handlers,yi=xi.dequeue,Ci=xi.nextEvent,Ei=h(null),Ai=Ei[0],ki=Ei[1],Pi=function(){return ki(null)},Ii=function(Di){return __awaiter(ci,void 0,void 0,function(){var Fi;return __generator(this,function(Li){switch(Li.label){case 0:switch(Fi=Di.type,Fi){case PrinterEvents.CLEAR:return[3,1];case PrinterEvents.PRINT:return[3,2]}return[3,4];case 1:return _i(),yi(Pi),[3,4];case 2:return[4,pi(Di.payload)];case 3:return Li.sent(),yi(Pi),[3,4];case 4:return[2]}})})};y(function(){var Di=Ci(),Fi=Ai!==Di;Di&&Fi&&(ki(Di),Ii(Di))},[mi,Ai])}function useSubscribeTerminalQueue(fi){var ci=fi.controller,hi=ci.focus,_i=ci.loading,pi=ci.lock,gi=fi.queue,mi=gi.state,xi=gi.handlers,yi=xi.dequeue,Ci=xi.nextEvent,Ei=h(null),Ai=Ei[0],ki=Ei[1],Pi=function(){return ki(null)},Ii=function(Di){switch(Di.type){case TerminalEvents.FOCUS:hi(),yi(Pi);break;case TerminalEvents.LOADING:_i(Di.payload),yi(Pi);break;case TerminalEvents.LOCK:pi(Di.payload),yi(Pi);break}};y(function(){var Di=Ci(),Fi=Ai!==Di;Di&&Fi&&(ki(Di),Ii(Di))},[mi,Ai])}function useSubscribeEventQueue(fi){var ci=fi.controller,hi=fi.queue,_i=hi.state,pi=hi.api,gi=pi.dequeue,mi=pi.nextEvent,xi=h(null),yi=xi[0],Ci=xi[1],Ei=function(){return Ci(null)},Ai=usePrinterQueue(),ki=Ai.handlers,Pi=ki.print,Ii=ki.clear;useSubscribePrinterQueue({queue:Ai,controller:ci});var Di=useTerminalQueue(),Fi=Di.handlers,Li=Fi.focus,Bi=Fi.loading,Ri=Fi.lock;useSubscribeTerminalQueue({queue:Di,controller:ci});var $i=function(Ni){switch(Ni.type){case TerminalEvents.FOCUS:Li(),gi(Ei);break;case TerminalEvents.LOADING:Bi(Ni.payload),gi(Ei);break;case TerminalEvents.LOCK:Ri(Ni.payload),gi(Ei);break;case PrinterEvents.CLEAR:Ii(),gi(Ei);break;case PrinterEvents.PRINT:Pi(Ni.payload),gi(Ei);break}};y(function(){var Ni=mi(),ji=yi!==Ni;Ni&&ji&&(Ci(Ni),$i(Ni))},[_i,yi])}var DEFAULT_SLIDE="",DEFAULT_SLIDE_INDEX=-1,next=function(fi){var ci=fi.slides,hi=fi.slideIndex,_i=hi+1,pi=ci[_i];return pi?{slideIndex:_i,slide:pi}:{slideIndex:0,slide:ci[0]||DEFAULT_SLIDE}},createLoader=function(fi,ci){return setTimeout(function(){return fi()},ci)};function useLoader(fi){var ci=fi.slides,hi=fi.loaderSpeed,_i=fi.onSetOuterState,pi=h(!1),gi=pi[0],mi=pi[1],xi=h(DEFAULT_SLIDE_INDEX),yi=xi[0],Ci=xi[1],Ei=h(null),Ai=Ei[0],ki=Ei[1],Pi=function(){Ai&&(clearTimeout(Ai),ki(null))},Ii=function(Li){return function(){var Bi=next({slides:ci,slideIndex:yi}),Ri=Bi.slide,$i=Bi.slideIndex;Ci($i),Li(Ri),ki(null)}},Di=function(){mi(!0),Ii(_i)()},Fi=function(){mi(!1),_i(DEFAULT_SLIDE),Ci(DEFAULT_SLIDE_INDEX)};return y(function(){var Li=!gi&&Ai,Bi=gi&&!Ai;return Bi?ki(createLoader(Ii(_i),hi)):Li&&Pi(),function(){}},[gi,Ai]),y(function(){return function(){return Pi()}},[]),{isLoading:gi,handlers:{startLoading:Di,endLoading:Fi}}}function styleInject(fi,ci){ci===void 0&&(ci={});var hi=ci.insertAt;if(!(!fi||typeof document>"u")){var _i=document.head||document.getElementsByTagName("head")[0],pi=document.createElement("style");pi.type="text/css",hi==="top"&&_i.firstChild?_i.insertBefore(pi,_i.firstChild):_i.appendChild(pi),pi.styleSheet?pi.styleSheet.cssText=fi:pi.appendChild(document.createTextNode(fi))}}var css_248z$7=`.printer-line-module_commandLine__estqY {
  padding: 1.4285714286rem 1.4285714286rem 1.4285714286rem 1.4285714286rem;
}

.printer-line-module_textLine__nz4P- {
  padding: 0 1.4285714286rem 0 2.8571428571rem;
}`,classes$7={commandLine:"printer-line-module_commandLine__estqY",textLine:"printer-line-module_textLine__nz4P-"};styleInject(css_248z$7);var checkLines=exhaustiveCheck("Unknown line type: "),PrinterLine=function(ci){var hi=ci.line,_i=ci.children,pi=hi.className,gi=pi===void 0?"":pi,mi=hi.dataAttribute,xi=hi.id;return function(){switch(hi.type){case LineTypes.TEXT:return xn.createElement("div",{id:xi,className:[classes$7.textLine,"crt-text-line",gi].join(" "),"data-crt-terminal":mi},_i);case LineTypes.COMMAND:return xn.createElement("div",{id:xi,className:[classes$7.commandLine,"crt-command-line",gi].join(" "),"data-crt-terminal":mi},_i);default:return checkLines(hi)}}()},css_248z$6=`@-webkit-keyframes character-module_blink-character__xvpwk {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@keyframes character-module_blink-character__xvpwk {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@-webkit-keyframes character-module_scanner__eZs7v {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@keyframes character-module_scanner__eZs7v {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@-webkit-keyframes character-module_pulse-text__PBNwr {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@keyframes character-module_pulse-text__PBNwr {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@-webkit-keyframes character-module_shiver-screen__37A2O {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
@keyframes character-module_shiver-screen__37A2O {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
.character-module_character__MzT4w {
  white-space: pre-wrap;
  word-break: break-all;
}

.character-module_characterSelected__axWlO {
  color: #111010;
  background-color: #d0fc7e;
  -webkit-animation: character-module_blink-character__xvpwk 1s steps(1, end) infinite;
          animation: character-module_blink-character__xvpwk 1s steps(1, end) infinite;
}`,classes$6={character:"character-module_character__MzT4w",characterSelected:"character-module_characterSelected__axWlO","blink-character":"character-module_blink-character__xvpwk",scanner:"character-module_scanner__eZs7v","pulse-text":"character-module_pulse-text__PBNwr","shiver-screen":"character-module_shiver-screen__37A2O"};styleInject(css_248z$6);var Character=function(ci){var hi=ci.children,_i=ci.selected,pi=_i===void 0?!1:_i,gi=ci.className,mi=gi===void 0?"":gi,xi=pi?classes$6.characterSelected:"";return xn.createElement("span",{className:[classes$6.character,xi,mi,"crt-character"].join(" ")},hi)},css_248z$5=`.printer-word-module_commandWord__nSXjX {
  display: inline-block;
}

.printer-word-module_textWord__akJYx {
  display: inline-block;
}

.printer-word-module_buttonWord__iu6fj {
  font-family: "Courier New", courier, monospace;
  font-size: 1rem;
  line-height: 1.5;
  text-shadow: 0 0 1.1428571429rem #d0fc7e, 0 0 1.7142857143rem #d0fc7e;
  color: #d0fc7e;
  margin: 0;
  padding: 0 5px;
  display: inline-block;
  background-color: transparent;
  border: 1px solid #d0fc7e;
  cursor: pointer;
}
.printer-word-module_buttonWord__iu6fj:hover {
  color: #111010;
  background-color: #d0fc7e;
}

.printer-word-module_anchorWord__dLnZB {
  font-family: "Courier New", courier, monospace;
  font-size: 1rem;
  line-height: 1.5;
  text-shadow: 0 0 1.1428571429rem #d0fc7e, 0 0 1.7142857143rem #d0fc7e;
  color: #d0fc7e;
  display: inline-block;
}
.printer-word-module_anchorWord__dLnZB:hover {
  color: white;
}`,classes$5={commandWord:"printer-word-module_commandWord__nSXjX",textWord:"printer-word-module_textWord__akJYx",buttonWord:"printer-word-module_buttonWord__iu6fj",anchorWord:"printer-word-module_anchorWord__dLnZB"};styleInject(css_248z$5);var checkWords=exhaustiveCheck("Unknown word type: "),PrinterWord=function(ci){var hi=ci.word,_i=ci.children,pi=hi.className,gi=pi===void 0?"":pi,mi=hi.dataAttribute,xi=hi.id;return function(){switch(hi.type){case WordTypes.TEXT:return xn.createElement("span",{id:xi,className:[classes$5.textWord,"crt-text-word",gi].join(" "),"data-crt-terminal":mi},xn.createElement(Character,null,_i));case WordTypes.ANCHOR:return xn.createElement("a",{id:xi,className:[classes$5.anchorWord,"crt-anchor-word",gi].join(" "),"data-crt-terminal":mi,href:hi.href,onClick:hi.onClick},xn.createElement(Character,null,_i));case WordTypes.BUTTON:return xn.createElement("button",{type:"button",id:xi,className:[classes$5.buttonWord,"crt-button-word",gi].join(" "),"data-crt-terminal":mi,onClick:hi.onClick},xn.createElement(Character,null,_i));case WordTypes.COMMAND:return xn.createElement("span",{id:xi,className:[classes$5.commandWord,"crt-command-word",gi].join(" "),"data-crt-terminal":mi},xn.createElement(Character,null,hi.prompt),xn.createElement(Character,null,_i));default:return checkWords(hi)}}()},TerminalScreen=N(function(fi){var ci=fi.state;return xn.createElement("div",{className:"crt-screen"},ci.map(function(hi,_i){return xn.createElement(PrinterLine,{line:hi,key:_i},hi.words.map(function(pi,gi){return xn.createElement(PrinterWord,{word:pi,key:gi},pi.characters)}))}))}),css_248z$4=`@-webkit-keyframes overlay-module_blink-character__Ye2qL {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@keyframes overlay-module_blink-character__Ye2qL {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@-webkit-keyframes overlay-module_scanner__jkhjA {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@keyframes overlay-module_scanner__jkhjA {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@-webkit-keyframes overlay-module_pulse-text__KyZ3A {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@keyframes overlay-module_pulse-text__KyZ3A {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@-webkit-keyframes overlay-module_shiver-screen__sjqEZ {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
@keyframes overlay-module_shiver-screen__sjqEZ {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
.overlay-module_overlay__zbWt1 {
  position: absolute;
  z-index: 2;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.overlay-module_scanner__jkhjA {
  position: absolute;
  z-index: 1;
  top: 0;
  right: 0;
  left: 0;
  height: 1.7142857143rem;
  opacity: 0.05;
  background: linear-gradient(180deg, transparent 0, #fffcfc 85%, #d0fc7e 0, transparent);
  -webkit-animation: overlay-module_scanner__jkhjA 8s linear infinite forwards;
          animation: overlay-module_scanner__jkhjA 8s linear infinite forwards;
}

.overlay-module_pixels__m5X6w {
  position: absolute;
  z-index: 2;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  display: block;
  background: linear-gradient(transparent 50%, rgba(0, 0, 0, 0.21) 0), linear-gradient(90deg, rgba(255, 0, 0, 0.055), rgba(0, 255, 0, 0.03), rgba(0, 0, 255, 0.055));
  background-position-y: 0.0714285714rem;
  background-size: 100% 0.2142857143rem, 0.2857142857rem 100%;
}`,classes$4={overlay:"overlay-module_overlay__zbWt1",scanner:"overlay-module_scanner__jkhjA",pixels:"overlay-module_pixels__m5X6w","blink-character":"overlay-module_blink-character__Ye2qL","pulse-text":"overlay-module_pulse-text__KyZ3A","shiver-screen":"overlay-module_shiver-screen__sjqEZ"};styleInject(css_248z$4);var Overlay=function(ci){var hi=ci.scanner,_i=ci.pixels;return xn.createElement("div",{className:[classes$4.overlay,"crt-overlay"].join(" ")},hi&&xn.createElement("div",{className:[classes$4.scanner,"crt-scanner"].join(" ")}),_i&&xn.createElement("div",{className:[classes$4.pixels,"crt-pixels"].join(" ")}))},css_248z$3=`@-webkit-keyframes text-effects-module_blink-character__CrwdV {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@keyframes text-effects-module_blink-character__CrwdV {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@-webkit-keyframes text-effects-module_scanner__EXIFB {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@keyframes text-effects-module_scanner__EXIFB {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@-webkit-keyframes text-effects-module_pulse-text__AVts8 {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@keyframes text-effects-module_pulse-text__AVts8 {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@-webkit-keyframes text-effects-module_shiver-screen__ysQ0c {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
@keyframes text-effects-module_shiver-screen__ysQ0c {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
.text-effects-module_textEffects__OWNjV {
  position: relative;
  width: 100%;
  height: 100%;
  -webkit-animation: text-effects-module_pulse-text__AVts8 5s linear infinite;
          animation: text-effects-module_pulse-text__AVts8 5s linear infinite;
}`,classes$3={textEffects:"text-effects-module_textEffects__OWNjV","pulse-text":"text-effects-module_pulse-text__AVts8","blink-character":"text-effects-module_blink-character__CrwdV",scanner:"text-effects-module_scanner__EXIFB","shiver-screen":"text-effects-module_shiver-screen__ysQ0c"};styleInject(css_248z$3);var TextEffects=function(ci){var hi=ci.enabled,_i=ci.children;return xn.createElement(xn.Fragment,null,hi?xn.createElement("div",{className:[classes$3.textEffects,"crt-text-effects"].join(" ")},_i):_i)},css_248z$2=`@-webkit-keyframes screen-effects-module_blink-character__CftBz {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@keyframes screen-effects-module_blink-character__CftBz {
  50% {
    color: #d0fc7e;
    background-color: transparent;
  }
}
@-webkit-keyframes screen-effects-module_scanner__N91BH {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@keyframes screen-effects-module_scanner__N91BH {
  0% {
    top: 0%;
  }
  50% {
    top: 100%;
  }
  100% {
    top: 100%;
  }
}
@-webkit-keyframes screen-effects-module_pulse-text__awrsE {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@keyframes screen-effects-module_pulse-text__awrsE {
  50% {
    text-shadow: 0 0 1.1428571429rem white, 0 0 1.5714285714rem white;
    color: #c6fc7e;
  }
}
@-webkit-keyframes screen-effects-module_shiver-screen__xieUK {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
@keyframes screen-effects-module_shiver-screen__xieUK {
  0% {
    transform: skewX(0deg);
  }
  4% {
    transform: skewX(0.7deg) scale(1.0001);
  }
  8% {
    transform: skewX(0.2deg) skewY(-0.1deg);
  }
  16% {
    transform: skewX(0.2deg);
  }
  50% {
    transform: skewX(0.2deg);
  }
}
.screen-effects-module_screenEffects__bNTzl {
  width: 100%;
  height: 100%;
  -webkit-animation: screen-effects-module_shiver-screen__xieUK 10s linear infinite;
          animation: screen-effects-module_shiver-screen__xieUK 10s linear infinite;
}`,classes$2={screenEffects:"screen-effects-module_screenEffects__bNTzl","shiver-screen":"screen-effects-module_shiver-screen__xieUK","blink-character":"screen-effects-module_blink-character__CftBz",scanner:"screen-effects-module_scanner__N91BH","pulse-text":"screen-effects-module_pulse-text__awrsE"};styleInject(css_248z$2);var ScreenEffects=function(ci){var hi=ci.enabled,_i=ci.children;return xn.createElement(xn.Fragment,null,hi?xn.createElement("div",{className:[classes$2.screenEffects,"crt-screen-effects"].join(" ")},_i):_i)},InputString=N(function(fi){var ci=fi.cursorPosition,hi=fi.renderValue;return xn.createElement(xn.Fragment,null,hi.map(function(_i,pi){return xn.createElement(Character,{selected:ci===pi,key:pi},_i)}))}),css_248z$1=`.command-line-module_commandLine__lnMf6 {
  padding: 1.4285714286rem 1.4285714286rem 1.4285714286rem 1.4285714286rem;
}

.command-line-module_inputWrap__OpY8r {
  display: inline-block;
}

.command-line-module_input__ZPwEm {
  position: absolute;
  opacity: 0;
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.command-line-module_inputString__J1jZF {
  display: inline-block;
  overflow: visible;
  white-space: normal;
  word-break: break-all;
}`,classes$1={commandLine:"command-line-module_commandLine__lnMf6",inputWrap:"command-line-module_inputWrap__OpY8r",input:"command-line-module_input__ZPwEm",inputString:"command-line-module_inputString__J1jZF"};styleInject(css_248z$1);var CommandLine=xn.forwardRef(function(fi,ci){var hi=fi.state,_i=hi.cursorPosition,pi=hi.renderValue,gi=hi.inputValue,mi=fi.handleKeyboardDown,xi=fi.handleInputChange,yi=fi.prompt,Ci=fi.cursorSymbol,Ei=function(Pi){var Ii=Pi.currentTarget.value;xi(Ii)},Ai=function(Pi){mi(Pi)},ki=_i===pi.length;return xn.createElement("div",{className:[classes$1.commandLine,"crt-command-line"].join(" ")},xn.createElement("span",{className:"crt-command-line__prompt"},yi),xn.createElement("div",{className:[classes$1.inputWrap,"crt-command-line__input-wrapper"].join(" ")},xn.createElement("input",{className:[classes$1.input,"crt-command-line__input"].join(" "),id:"crt-command-line-input",ref:ci,value:gi,onInput:Ei,onKeyDown:Ai,type:"text"}),xn.createElement("div",{className:[classes$1.inputString,"crt-command-line__input-string"].join(" ")},xn.createElement(InputString,{renderValue:pi,cursorPosition:_i}),ki&&xn.createElement(Character,{className:"crt-cursor-symbol",selected:!0},Ci))))}),css_248z=`.terminal-module_terminal__4qfYI {
  font-family: "Courier New", courier, monospace;
  font-size: 1rem;
  line-height: 1.5;
  text-shadow: 0 0 1.1428571429rem #d0fc7e, 0 0 1.7142857143rem #d0fc7e;
  color: #d0fc7e;
  position: relative;
  margin: 0;
  padding: 1.1428571429rem 0.5714285714rem;
  display: block;
  overflow: hidden;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  max-height: 100%;
  background: radial-gradient(50% 50% at 50% 50%, #354228 0, #0f140a 100%);
  border: 1.1428571429rem solid #111010;
  border-radius: 3.4285714286rem;
  box-shadow: 0 0 2.8571428571rem #252925, inset 0 0 2rem 1.4285714286rem #000;
  -webkit-font-smoothing: antialiased;
}
.terminal-module_terminal__4qfYI ::-moz-selection {
  color: #111010;
  background: #d0fc7e;
  -moz-appearance: none;
       appearance: none;
}
.terminal-module_terminal__4qfYI ::selection {
  color: #111010;
  background: #d0fc7e;
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none;
}
.terminal-module_terminal__4qfYI * {
  box-sizing: border-box;
}

.terminal-module_overflowContainer__p2duW {
  position: relative;
  overflow-y: auto;
  width: 100%;
  max-height: 100%;
  border-radius: 1.2857142857rem;
}
.terminal-module_overflowContainer__p2duW::-webkit-scrollbar {
  width: 0.3571428571rem;
  height: 0.3571428571rem;
}
.terminal-module_overflowContainer__p2duW::-webkit-scrollbar-button {
  width: 0;
  height: 0;
}
.terminal-module_overflowContainer__p2duW::-webkit-scrollbar-thumb {
  background: #d0fc7e;
  border: 0 none #fffcfc;
  border-radius: 0.2857142857rem;
}`,classes={terminal:"terminal-module_terminal__4qfYI",overflowContainer:"terminal-module_overflowContainer__p2duW"};styleInject(css_248z);var Terminal=function(ci){var hi=ci.onCommand,_i=ci.queue,pi=ci.banner,gi=ci.prompt,mi=gi===void 0?">":gi,xi=ci.cursorSymbol,yi=xi===void 0?"":xi,Ci=ci.maxHistoryCommands,Ei=Ci===void 0?10:Ci,Ai=ci.loader,ki=Ai===void 0?{}:Ai,Pi=ki.slides,Ii=Pi===void 0?[".","..","..."]:Pi,Di=ki.loaderSpeed,Fi=Di===void 0?1e3:Di,Li=ci.printer,Bi=Li===void 0?{}:Li,Ri=Bi.printerSpeed,$i=Ri===void 0?20:Ri,Ni=Bi.charactersPerTick,ji=Ni===void 0?5:Ni,Ui=Bi.onPrintStatusChange,qi=ci.effects,Ji=qi===void 0?{}:qi,rs=Ji.scanner,ss=rs===void 0?!0:rs,zi=Ji.pixels,Gi=zi===void 0?!0:zi,Vi=Ji.screenEffects,Qi=Vi===void 0?!0:Vi,is=Ji.textEffects,Zi=is===void 0?!0:is,ts=ci.focusOnMount,cs=ts===void 0?!0:ts,ls=useTerminalApp(),us=ls.state.terminalRef,fs=ls.handlers.scrollDown,xs=useCommandScreen({printerConfig:{printerSpeed:$i,charactersPerTick:ji,afterPrintCallback:fs,onPrintStatusChange:Ui}}),bs=xs.state,Cs=xs.handlers,Ds=useCommandLine(),Hs=useCommandLineInput(),qs=Hs.state.inputElementRef,Tn=Hs.handlers,dr=useCommandHistory({maxHistoryCommands:Ei}),Qs=useLoader({slides:Ii,loaderSpeed:Fi,onSetOuterState:Ds.handlers.setInput}),hn=useTerminalController({input:{handlers:Tn},terminalApp:ls,commandHistory:dr,commandLine:Ds,commandScreen:{handlers:Cs},loaderComponent:Qs,interface:{banner:pi,prompt:mi,onCommand:hi,queue:_i},focusOnMount:cs}).handlers,Kn=hn.handleKeyboardDown,ks=hn.handleInputChange;return useSubscribeEventQueue({queue:_i,controller:hn}),xn.createElement("label",{className:[classes.terminal,"crt-terminal"].join(" "),htmlFor:"crt-command-line-input"},xn.createElement(Overlay,{scanner:ss,pixels:Gi}),xn.createElement(ScreenEffects,{enabled:Qi},xn.createElement("div",{ref:us,className:[classes.overflowContainer,"crt-terminal__overflow-container"].join(" ")},xn.createElement(TextEffects,{enabled:Zi},xn.createElement("div",{className:"crt-terminal__screen"},xn.createElement(TerminalScreen,{state:bs})),xn.createElement("div",{className:"crt-terminal__command-line"},xn.createElement(CommandLine,{ref:qs,prompt:mi,cursorSymbol:yi,state:Ds.state,handleKeyboardDown:Kn,handleInputChange:ks}))))))};const bannerText=`
Iniciando R.O.K.E.

`;function CrtTerminal(){const eventQueue=useEventQueue(),{print}=eventQueue.handlers;function onButton(fi,ci){window.term.write(fi+`

`),ci.remove()}function printObject(fi,ci=null){const hi=Object.keys(fi).filter(_i=>_i!=ci);print([textLine({words:[textWord({characters:fi[ci]||"<="})]}),textLine({words:hi.map(_i=>buttonWord({characters:_i,onClick:pi=>onButton(fi[_i].toString(),pi.target)}))})])}window.term={write:fi=>print([textLine({words:[textWord({characters:fi})]})]),writeObject:printObject,...eventQueue.handlers};async function onCommand(command){if(command.startsWith("gsk_")&&command.length==56){localStorage.setItem("groqApiKey",command),initGroq(command),window.term.write("API KEY guardada.");return}let result;try{const res=eval(command);console.log(res),res&&(result={response:res.toString?res.toString():res})}catch(fi){console.error(fi);try{result=await converseDeBounced(command,window.player)}catch(ci){console.error(ci)}}result&&printObject(result,"response")}return u$2("div",{id:"terminal",style:{width:"1000px",height:"550px"},children:u$2(Terminal,{queue:eventQueue,banner:[textLine({words:[textWord({characters:bannerText})]})],onCommand})})}function CrtVisual(){const[fi,ci]=h("");function hi(_i){ci(_i)}return window.visual={flash:hi},u$2("div",{id:"game",children:[u$2("div",{id:"game_overlay",children:fi}),u$2("canvas",{tabIndex:"1",id:"game_canvas"})]})}function commonjsRequire(fi){throw new Error('Could not dynamically require "'+fi+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var gun$1={exports:{}};gun$1.exports;(function(fi){(function(){function ci(_i,pi){return pi?commonjsRequire(_i):_i.slice?ci[gi(_i)]:function(mi,xi){_i(mi={exports:{}}),ci[gi(xi)]=mi.exports};function gi(mi){return mi.split("/").slice(-1).toString().replace(".js","")}}var hi=fi;ci(function(_i){String.random=function(gi,mi){var xi="";for(gi=gi||24,mi=mi||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";gi-- >0;)xi+=mi.charAt(Math.floor(Math.random()*mi.length));return xi},String.match=function(gi,mi){var xi,yi;return typeof gi!="string"?!1:(typeof mi=="string"&&(mi={"=":mi}),mi=mi||{},xi=mi["="]||mi["*"]||mi[">"]||mi["<"],gi===xi?!0:yi!==mi["="]?!1:(xi=mi["*"]||mi[">"],gi.slice(0,(xi||"").length)===xi?!0:yi!==mi["*"]?!1:yi!==mi[">"]&&yi!==mi["<"]?gi>=mi[">"]&&gi<=mi["<"]:yi!==mi[">"]&&gi>=mi[">"]||yi!==mi["<"]&&gi<=mi["<"]))},String.hash=function(gi,mi){if(typeof gi=="string"){if(mi=mi||0,!gi.length)return mi;for(var xi=0,yi=gi.length,Ci;xi<yi;++xi)Ci=gi.charCodeAt(xi),mi=(mi<<5)-mi+Ci,mi|=0;return mi}};var pi=Object.prototype.hasOwnProperty;Object.plain=function(gi){return gi?gi instanceof Object&&gi.constructor===Object||Object.prototype.toString.call(gi).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(gi,mi){for(var xi in gi)if(pi.call(gi,xi)&&(!mi||mi.indexOf(xi)==-1))return!1;return!0},Object.keys=Object.keys||function(gi){var mi=[];for(var xi in gi)pi.call(gi,xi)&&mi.push(xi);return mi},function(){var gi,mi=setTimeout,xi=0,yi=0,Ci=typeof setImmediate!=""+gi&&setImmediate||function(Ai,ki){return typeof MessageChannel==""+gi?mi:((Ai=new MessageChannel).port1.onmessage=function(Pi){Pi.data==""&&ki()},function(Pi){ki=Pi,Ai.port2.postMessage("")})}(),Ei=mi.check=mi.check||typeof performance!=""+gi&&performance||{now:function(){return+new Date}};mi.hold=mi.hold||9,mi.poll=mi.poll||function(Ai){if(mi.hold>=Ei.now()-xi&&yi++<3333){Ai();return}Ci(function(){xi=Ei.now(),Ai()},yi=0)}}(),function(){var gi=setTimeout,mi=gi.turn=gi.turn||function(ki){xi.push(ki)==1&&yi(Ai)},xi=mi.s=[],yi=gi.poll,Ci=0,Ei,Ai=function(){(Ei=xi[Ci++])&&Ei(),(Ci==xi.length||Ci==99)&&(xi=mi.s=xi.slice(Ci),Ci=0),xi.length&&yi(Ai)}}(),function(){var gi,mi=setTimeout,xi=mi.turn;(mi.each=mi.each||function(yi,Ci,Ei,Ai){Ai=Ai||9,function ki(Pi,Ii,Di){if(Ii=(Pi=(yi||[]).splice(0,Ai)).length){for(var Fi=0;Fi<Ii&&gi===(Di=Ci(Pi[Fi]));Fi++);if(gi===Di){xi(ki);return}}Ei&&Ei(Di)}()})()}()})(ci,"./shim"),ci(function(_i){_i.exports=function pi(Ei,mi,xi){if(!Ei)return{to:pi};var yi,Ci=typeof mi=="function",Ei=(this.tag||(this.tag={}))[Ei]||Ci&&(this.tag[Ei]={tag:Ei,to:pi._={next:function(ki){var Pi;(Pi=this.to)&&Pi.next(ki)}}});if(Ci){var Ai={off:pi.off||(pi.off=function(){if(this.next===pi._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=pi._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:pi._,next:mi,the:Ei,on:this,as:xi};return(Ai.back=Ei.last||Ei).to=Ai,Ei.last=Ai}return(Ei=Ei.to)&&yi!==mi&&Ei.next(mi),Ei}})(ci,"./onto"),ci(function(_i){_i.exports=function(pi){return pi===null||typeof pi=="string"||typeof pi=="boolean"||typeof pi=="number"&&pi!=1/0&&pi!=-1/0&&pi===pi||!!pi&&typeof pi["#"]=="string"&&Object.keys(pi).length===1&&pi["#"]}})(ci,"./valid"),ci(function(_i){ci("./shim");function pi(){var Ei=+new Date;return yi<Ei?(mi=0,yi=Ei+pi.drift):yi=Ei+(mi+=1)/xi+pi.drift}pi.drift=0;var gi=-1/0,mi=0,xi=999,yi=gi,Ci;pi.is=function(Ei,Ai,ki){var Pi=Ai&&Ei&&Ei._&&Ei._[">"]||ki;if(Pi)return typeof(Pi=Pi[Ai])=="number"?Pi:gi},pi.ify=function(Ei,Ai,ki,Pi,Ii){(Ei=Ei||{})._=Ei._||{},Ii&&(Ei._["#"]=Ii);var Di=Ei._[">"]||(Ei._[">"]={});return Ci!==Ai&&Ai!=="_"&&(typeof ki=="number"&&(Di[Ai]=ki),Ci!==Pi&&(Ei[Ai]=Pi)),Ei},_i.exports=pi})(ci,"./state"),ci(function(_i){ci("./shim");function pi(gi){var mi={s:{}},xi=mi.s;gi=gi||{max:999,age:1e3*9},mi.check=function(Ci){return xi[Ci]?yi(Ci):!1};var yi=mi.track=function(Ci){var Ei=xi[Ci]||(xi[Ci]={});return Ei.was=mi.now=+new Date,mi.to||(mi.to=setTimeout(mi.drop,gi.age+9)),yi.ed&&yi.ed(Ci),Ei};return mi.drop=function(Ci){mi.to=null,mi.now=+new Date;var Ei=Object.keys(xi);console.STAT&&console.STAT(mi.now,+new Date-mi.now,"dup drop keys"),setTimeout.each(Ei,function(Ai){var ki=xi[Ai];ki&&(Ci||gi.age)>mi.now-ki.was||delete xi[Ai]},0,99)},mi}_i.exports=pi})(ci,"./dup"),ci(function(_i){ci("./onto"),_i.exports=function(mi,xi){if(this.on){var yi=(this.opt||{}).lack||9e3;if(typeof mi!="function"){if(!mi)return;var Ei=mi["#"]||mi,Ci=(this.tag||"")[Ei];return Ci?(xi&&(Ci=this.on(Ei,xi),clearTimeout(Ci.err),Ci.err=setTimeout(function(){Ci.off()},yi)),!0):void 0}var Ei=xi&&xi["#"]||pi(9);if(!mi)return Ei;var Ai=this.on(Ei,mi,xi);return Ai.err=Ai.err||setTimeout(function(){Ai.off(),Ai.next({err:"Error: No ACK yet.",lack:!0})},yi),Ei}};var pi=String.random||function(){return Math.random().toString(36).slice(2)}})(ci,"./ask"),ci(function(_i){function pi(Ii){return Ii instanceof pi?(this._={$:this}).$:this instanceof pi?pi.create(this._={$:this,opt:Ii}):new pi(Ii)}pi.is=function(Ii){return Ii instanceof pi||Ii&&Ii._&&Ii===Ii._.$||!1},pi.version=.202,pi.chain=pi.prototype,pi.chain.toJSON=function(){},ci("./shim"),pi.valid=ci("./valid"),pi.state=ci("./state"),pi.on=ci("./onto"),pi.dup=ci("./dup"),pi.ask=ci("./ask"),function(){pi.create=function(Gi){Gi.root=Gi.root||Gi,Gi.graph=Gi.graph||{},Gi.on=Gi.on||pi.on,Gi.ask=Gi.ask||pi.ask,Gi.dup=Gi.dup||pi.dup();var Vi=Gi.$.opt(Gi.opt);return Gi.once||(Gi.on("in",Ii,Gi),Gi.on("out",Ii,Gi),Gi.on("put",Li,Gi),pi.on("create",Gi),Gi.on("create",Gi)),Gi.once=1,Vi};function Ii(Gi){if(Gi){if(Gi.out===Ii){this.to.next(Gi);return}var Vi=this,Qi=Vi.as,is=Qi.at||Qi,Zi=is.$,ts=is.dup,cs,ls=Gi.DBG;if((cs=Gi["#"])||(cs=Gi["#"]=mi(9)),!ts.check(cs)){if(ts.track(cs),cs=Gi._,Gi._=typeof cs=="function"?cs:function(){},Gi.$&&Gi.$===(Gi.$._||"").$||(Gi.$=Zi),Gi["@"]&&!Gi.put&&Ri(Gi),!is.ask(Gi["@"],Gi))if(ls&&(ls.u=+new Date),Gi.put){Di(Gi);return}else Gi.get&&pi.on.get(Gi,Zi);ls&&(ls.uc=+new Date),Vi.to.next(Gi),ls&&(ls.ua=+new Date),!(Gi.nts||Gi.NTS)&&(Gi.out=Ii,is.on("out",Gi),ls&&(ls.ue=+new Date))}}}function Di(Gi){if(Gi){var Vi=Gi._||"",Qi=Vi.root=((Vi.$=Gi.$||"")._||"").root;if(Gi["@"]&&Vi.faith&&!Vi.miss){Gi.out=Ii,Qi.on("out",Gi);return}Vi.latch=Qi.hatch,Vi.match=Qi.hatch=[];var is=Gi.put,Zi=Vi.DBG=Gi.DBG,ts=+new Date;if(ss=ss||ts,!(is["#"]&&is["."])){Zi&&(Zi.p=ts),Vi["#"]=Gi["#"],Vi.msg=Gi,Vi.all=0,Vi.stun=1;var cs=Object.keys(is);console.STAT&&console.STAT(ts,((Zi||Vi).pk=+new Date)-ts,"put sort");var ls=0,us,fs,xs,bs,Cs,Ds,Hs;(function qs(Tn){if(us!=ls){if(us=ls,!(xs=cs[ls])){console.STAT&&console.STAT(ts,((Zi||Vi).pd=+new Date)-ts,"put"),Bi(Vi);return}(bs=is[xs])?(Hs=bs._)?xs!==Hs["#"]?Ds=Ni+ji(xs)+"soul not same.":(Cs=Hs[">"])||(Ds=Ni+ji(xs)+"no state."):Ds=Ni+ji(xs)+"no meta.":Ds=Ni+ji(xs)+"no node.",fs=Object.keys(bs||{})}if(Ds){Gi.err=Vi.err=Ds,Bi(Vi);return}var dr=0,Qs;for(Tn=Tn||0;Tn++<9&&(Qs=fs[dr++]);)if(Qs!=="_"){var hn=bs[Qs],Kn=Cs[Qs];if(Ai===Kn){Ds=Ni+ji(Qs)+"on"+ji(xs)+"no state.";break}if(!yi(hn)){Ds=Ni+ji(Qs)+"on"+ji(xs)+"bad "+typeof hn+ji(hn);break}Fi(hn,Qs,xs,Kn,Gi),++rs}if((fs=fs.slice(dr)).length){xi(qs);return}++ls,fs=null,qs(Tn)})()}}}pi.on.put=Di;function Fi(Gi,Vi,Qi,is,Zi){var ts=Zi._||"",cs=ts.root,ls=cs.graph,us,fs=ls[Qi]||ki,xs=Ci(fs,Vi,1),bs=fs[Vi],Cs=ts.DBG;(us=console.STAT)&&(!ls[Qi]||!bs)&&(us.has=(us.has||0)+1);var Ds=Ji();if(is>Ds){setTimeout(function(){Fi(Gi,Vi,Qi,is,Zi)},(us=is-Ds)>qi?qi:us),console.STAT&&console.STAT((Cs||ts).Hf=+new Date,us,"future");return}if(!(is<xs)&&!(!ts.faith&&is===xs&&(Gi===bs||Ui(Gi)<=Ui(bs))&&!ts.miss)){ts.stun++;var Hs=Zi["#"]+ts.all++,qs={toString:function(){return Hs},_:ts};qs.toJSON=qs.toString,cs.dup.track(qs)["#"]=Zi["#"],Cs&&(Cs.ph=Cs.ph||+new Date),cs.on("put",{"#":qs,"@":Zi["@"],put:{"#":Qi,".":Vi,":":Gi,">":is},ok:Zi.ok,_:ts})}}function Li(Gi){var Vi;(Vi=(Gi._||"").DBG)&&(Vi.pa=+new Date,Vi.pm=Vi.pm||+new Date);var Qi=this,is=Qi.as,Zi=is.graph,ts=Gi._,cs=Gi.put,ls=cs["#"],us=cs["."],fs=cs[":"],xs=cs[">"];Gi["#"];var bs;(bs=ts.msg)&&(bs=bs.put)&&(bs=bs[ls])&&Ei(bs,us,xs,fs,ls),Zi[ls]=Ei(Zi[ls],us,xs,fs,ls),(bs=(is.next||"")[ls])&&bs.on("in",Gi),Bi(ts),Qi.to.next(Gi)}function Bi(Gi,Vi){var Qi;if(!Gi.stop&&!(!Gi.err&&0<--Gi.stun)&&(Gi.stop=1,!!(Qi=Gi.root))){var is=Gi.match;is.end=1,is===Qi.hatch&&(!(is=Gi.latch)||is.end?delete Qi.hatch:Qi.hatch=is),Gi.hatch&&Gi.hatch(),setTimeout.each(Gi.match,function(Zi){Zi&&Zi()}),!(!(Vi=Gi.msg)||Gi.err||Vi.err)&&(Vi.out=Ii,Gi.root.on("out",Vi),zi())}}function Ri(Gi){var Vi=Gi["@"]||"",Qi;if(!(Qi=Vi._)){var is=(is=Gi.$)&&(is=is._)&&(is=is.root)&&(is=is.dup);if(!(is=is.check(Vi)))return;Gi["@"]=is["#"]||Gi["@"];return}Qi.acks=(Qi.acks||0)+1,(Qi.err=Gi.err)&&(Gi["@"]=Qi["#"],Bi(Qi)),Qi.ok=Gi.ok||Qi.ok,!Qi.stop&&!Qi.crack&&(Qi.crack=Qi.match&&Qi.match.push(function(){$i(Qi)})),$i(Qi)}function $i(Gi){!Gi||!Gi.root||Gi.stun||Gi.acks!==Gi.all||Gi.root.on("in",{"@":Gi["#"],err:Gi.err,ok:Gi.err?Ai:Gi.ok||{"":1}})}var Ni="Error: Invalid graph!",ji=function(Gi){return" '"+(""+Gi).slice(0,9)+"...' "},Ui=JSON.stringify,qi=2147483647,Ji=pi.state,rs=0,ss,zi=function(){rs>999&&rs/-(ss-(ss=+new Date))>1&&(pi.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),zi=function(){rs=0})}}(),function(){pi.on.get=function(Di,Fi){var Li=Fi._,Bi=Di.get,Ri=Bi["#"],$i=Li.graph[Ri],Ni=Bi["."],ji=Li.next||(Li.next={}),Ui=ji[Ri],qi=Di._||{},Ji=qi.DBG=Di.DBG;if(Ji&&(Ji.g=+new Date),!$i)return Li.on("get",Di);if(Ni){if((typeof Ni!="string"||Ai===$i[Ni])&&!((Ui||"").next||"")[Ni]){Li.on("get",Di);return}$i=Ei({},Ni,Ci($i,Ni),$i[Ni],Ri)}$i&&Ii(Di,$i),Li.on("get",Di)};function Ii(Di,Fi){var Li=+new Date,Bi=Di._||{},Ri=Bi.DBG=Di.DBG,$i=Di["#"],Ni=mi(9),ji=Object.keys(Fi||"").sort(),Ui=((Fi||"")._||"")["#"];ji.length;var qi=Di.$._.root,Ji=Fi===qi.graph[Ui];console.STAT&&console.STAT(Li,((Ri||Bi).gk=+new Date)-Li,"got keys"),Fi&&function rs(){Li=+new Date;for(var ss=0,zi,Gi={},Vi;ss<9&&(zi=ji[ss++]);)Ei(Gi,zi,Ci(Fi,zi),Fi[zi],Ui);ji=ji.slice(ss),(Vi={})[Ui]=Gi,Gi=Vi;var Qi;Ji&&(Qi=function(){},Qi.ram=Qi.faith=!0),Vi=ji.length,console.STAT&&console.STAT(Li,-(Li-(Li=+new Date)),"got copied some"),Ri&&(Ri.ga=+new Date),qi.on("in",{"@":$i,"#":Ni,put:Gi,"%":Vi?Ni=mi(9):Ai,$:qi.$,_:Qi,DBG:Ri,FOO:1}),console.STAT&&console.STAT(Li,+new Date-Li,"got in"),Vi&&setTimeout.turn(rs)}(),Fi||qi.on("in",{"@":Di["#"]})}pi.on.get.ack=Ii}(),function(){pi.chain.opt=function(Ii){Ii=Ii||{};var Di=this,Fi=Di._,Li=Ii.peers||Ii;return Object.plain(Ii)||(Ii={}),Object.plain(Fi.opt)||(Fi.opt=Ii),typeof Li=="string"&&(Li=[Li]),Object.plain(Fi.opt.peers)||(Fi.opt.peers={}),Li instanceof Array&&(Ii.peers={},Li.forEach(function(Bi){var Ri={};Ri.id=Ri.url=Bi,Ii.peers[Bi]=Fi.opt.peers[Bi]=Fi.opt.peers[Bi]||Ri})),gi(Ii,function Bi(Ri){var $i=this[Ri];if(this&&this.hasOwnProperty(Ri)||typeof $i=="string"||Object.empty($i)){this[Ri]=$i;return}$i&&$i.constructor!==Object&&!($i instanceof Array)||gi($i,Bi)}),Fi.opt.from=Ii,pi.on("opt",Fi),Fi.opt.uuid=Fi.opt.uuid||function(Ri){return pi.state().toString(36).replace(".","")+String.random(Ri||12)},Di}}();var gi=function(Ii,Di){Object.keys(Ii).forEach(Di,Ii)},mi=String.random,xi=setTimeout.turn,yi=pi.valid,Ci=pi.state.is,Ei=pi.state.ify,Ai,ki={},Pi;pi.log=function(){return!pi.log.off&&Pi.log.apply(Pi,arguments),[].slice.call(arguments).join(" ")},pi.log.once=function(Ii,Di,Fi){return(Fi=pi.log.once)[Ii]=Fi[Ii]||0,Fi[Ii]++||pi.log(Di)},typeof window<"u"&&((window.GUN=window.Gun=pi).window=window);try{typeof hi<"u"&&(hi.exports=pi)}catch{}_i.exports=pi,(pi.window||{}).console=(pi.window||{}).console||{log:function(){}},(Pi=console).only=function(Ii,Di){return Pi.only.i&&Ii===Pi.only.i&&Pi.only.i++&&(Pi.log.apply(Pi,arguments)||Di)},pi.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(ci,"./root"),ci(function(_i){var pi=ci("./root");pi.chain.back=function(xi,yi){var Ci;if(xi=xi||1,xi===-1||xi===1/0)return this._.root.$;if(xi===1)return(this._.back||this._).$;var Ei=this,Ai=Ei._;if(typeof xi=="string"&&(xi=xi.split(".")),xi instanceof Array){var ki=0,Pi=xi.length,Ci=Ai;for(ki;ki<Pi;ki++)Ci=(Ci||gi)[xi[ki]];return mi!==Ci?yi?Ei:Ci:(Ci=Ai.back)?Ci.$.back(xi,yi):void 0}if(typeof xi=="function"){for(var Ii,Ci={back:Ai};(Ci=Ci.back)&&mi===(Ii=xi(Ci,yi)););return Ii}return typeof xi=="number"?(Ai.back||Ai).$.back(xi-1):this};var gi={},mi})(ci,"./back"),ci(function(_i){var pi=ci("./root");pi.chain.chain=function(Bi){var Ri=this,$i=Ri._,Ni=new(Bi||Ri).constructor(Ri),ji=Ni._,Ui;return ji.root=Ui=$i.root,ji.id=++Ui.once,ji.back=Ri._,ji.on=pi.on,ji.on("in",pi.on.in,ji),ji.on("out",pi.on.out,ji),Ni};function gi(Bi){var Ri,$i=this.as,Ni=$i.back,ji=$i.root,Ui;if(Bi.$||(Bi.$=$i.$),this.to.next(Bi),$i.err){$i.on("in",{put:$i.put=Ai,$:$i.$});return}if(Ri=Bi.get){if(ji.pass&&(ji.pass[$i.id]=$i),$i.lex&&Object.keys($i.lex).forEach(function(qi){Ui[qi]=$i.lex[qi]},Ui=Bi.get=Bi.get||{}),Ri["#"]||$i.soul){if(Ri["#"]=Ri["#"]||$i.soul,Bi["#"]||(Bi["#"]=ki(9)),Ni=ji.$.get(Ri["#"])._,Ri=Ri["."]){if(Ii(Ni.put,Ri)&&(Ui=Ni.ask&&Ni.ask[Ri],(Ni.ask||(Ni.ask={}))[Ri]=Ni.$.get(Ri)._,Ni.on("in",{get:Ri,put:{"#":Ni.soul,".":Ri,":":Ni.put[Ri],">":Fi(ji.graph[Ni.soul],Ri)}}),Ui))return}else{if(Ui=Ni.ask&&Ni.ask[""],(Ni.ask||(Ni.ask={}))[""]=Ni,Ai!==Ni.put&&(Ni.on("in",Ni),Ui))return;Bi.$=Ni.$}return ji.ask(Ci,Bi),ji.on("in",Bi)}if(Ri["."])return $i.get?(Bi={get:{".":$i.get},$:$i.$},(Ni.ask||(Ni.ask={}))[$i.get]=Bi.$._,Ni.on("out",Bi)):(Bi={get:$i.lex?Bi.get:{},$:$i.$},Ni.on("out",Bi));if(($i.ask||($i.ask={}))[""]=$i,$i.get)return Ri["."]=$i.get,(Ni.ask||(Ni.ask={}))[$i.get]=Bi.$._,Ni.on("out",Bi)}return Ni.on("out",Bi)}pi.on.out=gi;function mi(Bi,Ri){Ri=Ri||this.as;var $i=Ri.root,Ni=Bi.$||(Bi.$=Ri.$),ji=(Ni||"")._||Ei,Ui=Bi.put||"",qi=Ui["#"],Ji=Ui["."],rs=Ai!==Ui["="]?Ui["="]:Ui[":"],ss=Ui[">"]||-1/0,zi;if(Ai!==Bi.put&&(Ai===Ui["#"]||Ai===Ui["."]||Ai===Ui[":"]&&Ai===Ui["="]||Ai===Ui[">"])){if(!Pi(Ui)){if(!(qi=((Ui||"")._||"")["#"])){console.log("chain not yet supported for",Ui,"...",Bi,Ri);return}return Ni=Ri.root.$.get(qi),setTimeout.each(Object.keys(Ui).sort(),function(Gi){Gi=="_"||Ai===(ss=Fi(Ui,Gi))||Ri.on("in",{$:Ni,put:{"#":qi,".":Gi,"=":Ui[Gi],">":ss},VIA:Bi})})}Ri.on("in",{$:ji.back.$,put:{"#":qi=ji.back.soul,".":Ji=ji.has||ji.get,"=":Ui,">":Fi(ji.back.put,Ji)},via:Bi});return}(Bi.seen||"")[Ri.id]||((Bi.seen||(Bi.seen=function(){}))[Ri.id]=Ri,Ri!==ji&&(Object.keys(Bi).forEach(function(Gi){Ui[Gi]=Bi[Gi]},Ui={}),Ui.get=Ri.get||Ui.get,!Ri.soul&&!Ri.has?Ui.$$$=Ui.$$$||Ri.$:ji.soul&&(Ui.$=Ri.$,Ui.$$=Ui.$$||ji.$),Bi=Ui),yi(Bi,Ri),(Ri.soul||Bi.$$)&&ss>=Fi($i.graph[qi],Ji)&&((Ui=$i.$.get(qi)._).put=Li(Ui.put,Ji,ss,rs,qi)),!ji.soul&&ss>=Fi($i.graph[qi],Ji)&&(zi=($i.$.get(qi)._.next||"")[Ji])&&(zi.put=rs,typeof(Ui=Pi(rs))=="string"&&(zi.put=$i.$.get(Ui)._.put||rs)),this.to&&this.to.next(Bi),Ri.any&&setTimeout.each(Object.keys(Ri.any),function(Gi){(Gi=Ri.any[Gi])&&Gi(Bi)},0,99),Ri.echo&&setTimeout.each(Object.keys(Ri.echo),function(Gi){(Gi=Ri.echo[Gi])&&Gi.on("in",Bi)},0,99),((Bi.$$||"")._||ji).soul&&(zi=Ri.next)&&(zi=zi[Ji])&&(Ui={},Object.keys(Bi).forEach(function(Gi){Ui[Gi]=Bi[Gi]}),Ui.$=(Bi.$$||Bi.$).get(Ui.get=Ji),delete Ui.$$,delete Ui.$$$,zi.on("in",Ui)),xi(Bi,Ri))}pi.on.in=mi;function xi(Bi,Ri){if(Ri=Ri||this.as||Bi.$._,!(Bi.$$&&this!==pi.on)&&!(!Bi.put||Ri.soul)){var $i=Bi.put||"",Ni=$i["="]||$i[":"],Ji,ji=Ri.root,Ui=ji.$.get($i["#"]).get($i["."])._;if(typeof(Ni=Pi(Ni))!="string"){this===pi.on&&((Ui.echo||(Ui.echo={}))[Ri.id]=Ri);return}if(!((Ui.echo||(Ui.echo={}))[Ri.id]&&!(ji.pass||"")[Ri.id])){if(Ji=ji.pass){if(Ji[Ni+Ri.id])return;Ji[Ni+Ri.id]=1}(Ui.echo||(Ui.echo={}))[Ri.id]=Ri,Ri.has&&(Ri.link=Ni);var qi=ji.$.get(Ui.link=Ni)._;(qi.echo||(qi.echo={}))[Ui.id]=Ui;var Ji=Ri.ask||"";(Ji[""]||Ri.lex)&&qi.on("out",{get:{"#":Ni}}),setTimeout.each(Object.keys(Ji),function(rs,ss){!rs||!(ss=Ji[rs])||ss.on("out",{get:{"#":Ni,".":rs}})},0,99)}}}pi.on.link=xi;function yi(Bi,Ri){var $i=Bi.put||"",Ni=Ai!==$i["="]?$i["="]:$i[":"],ji=Ri.root,Ui,qi;if(Ai===Ni){if(Ri.soul&&Ai!==Ri.put||(qi=(Bi.$$||Bi.$||"")._||"",Bi["@"]&&(Ai!==qi.put||Ai!==Ri.put)))return;(Ui=Ri.link||Bi.linked)&&delete(ji.$.get(Ui)._.echo||"")[Ri.id],Ri.has&&(Ri.link=null),Ri.put=Ai,setTimeout.each(Object.keys(Ri.next||""),function(Ji,rs){(rs=Ri.next[Ji])&&(Ui&&delete(ji.$.get(Ui).get(Ji)._.echo||"")[rs.id],rs.on("in",{get:Ji,put:Ai,$:rs.$}))},0,99);return}Ri.soul||Bi.$$||(Ui=Pi(Ni),qi=Bi.$._||"",!((Ui===qi.link||Ri.has&&!qi.link)&&!((ji.pass||"")[Ri.id]&&typeof Ui!="string"))&&(delete(qi.echo||"")[Ri.id],yi({get:Ri.get,put:Ai,$:Bi.$,linked:Bi.linked=Bi.linked||qi.link},Ri)))}pi.on.unlink=yi;function Ci(Bi,Ri){var $i=this.as,Ni=$i.$._;Ni.root;var ji=$i.get||"",Ui=(Bi.put||"")[ji["#"]]||"";if(!Bi.put||typeof ji["."]=="string"&&Ai===Ui[ji["."]]){if(Ai!==Ni.put||!Ni.soul&&!Ni.has)return;Ni.ack=(Ni.ack||0)+1,Ni.on("in",{get:Ni.get,put:Ni.put=Ai,$:Ni.$,"@":Bi["@"]});return}(Bi._||{}).miss=1,pi.on.put(Bi)}var Ei={},Ai,ki=String.random,Pi=pi.valid,Ii=function(Bi,Ri){return Bi&&Object.prototype.hasOwnProperty.call(Bi,Ri)},Di=pi.state,Fi=Di.is,Li=Di.ify})(ci,"./chain"),ci(function(_i){var pi=ci("./root");pi.chain.get=function(Ai,ki,Pi){var Ii,Di;if(typeof Ai=="string"){if(Ai.length==0)return(Ii=this.chain())._.err={err:pi.log("0 length key!",Ai)},ki&&ki.call(Ii,Ii._.err),Ii;var Fi=this,Li=Fi._,Bi=Li.next||yi;(Ii=Bi[Ai])||(Ii=Ai&&gi(Ai,Fi)),Ii=Ii&&Ii.$}else if(typeof Ai=="function"){let qi=function(Ji,rs,ss){if(!qi.stun&&!((Zi=$i.pass)&&!Zi[Ni])){var zi=Ji.$._,Gi=(Ji.$$||"")._,Vi=(Gi||zi).put,Qi=!zi.has&&!zi.soul,is={},Zi;if((Qi||Ei===Vi)&&(Vi=Ei===((Zi=Ji.put)||"")["="]?Ei===(Zi||"")[":"]?Zi:Zi[":"]:Zi["="]),typeof(Zi=pi.valid(Vi))=="string"&&(Vi=Ei===(Zi=$i.$.get(Zi)._.put)?Ri.not?Ei:Vi:Zi),!(Ri.not&&Ei===Vi)){if(Ei===Ri.stun){if((Zi=$i.stun)&&Zi.on&&(Li.$.back(function(ts){if(Zi.on(""+ts.id,is={}),(is.run||0)<qi.id)return is}),!is.run&&Zi.on(""+zi.id,is={}),!is.run&&Gi&&Zi.on(""+Gi.id,is={}),qi.id>is.run&&((!is.stun||is.stun.end)&&(is.stun=Zi.on("stun"),is.stun=is.stun&&is.stun.last),is.stun&&!is.stun.end))){(is.stun.add||(is.stun.add={}))[Ni]=function(){qi(Ji,rs,1)};return}if(Ei===Vi&&(ss=0),(Zi=$i.hatch)&&!Zi.end&&Ei===Ri.hatch&&!ss){if(ji[zi.$._.id])return;ji[zi.$._.id]=1,Zi.push(function(){qi(Ji,rs,1)});return}ji={}}if($i.pass){if($i.pass[Ni+zi.id])return;$i.pass[Ni+zi.id]=1}if(Ri.on){Ri.ok.call(zi.$,Vi,zi.get,Ji,rs||qi);return}if(Ri.v2020){Ri.ok(Ji,rs||qi);return}Object.keys(Ji).forEach(function(ts){Zi[ts]=Ji[ts]},Zi={}),Ji=Zi,Ji.put=Vi,Ri.ok.call(Ri.as,Ji,rs||qi)}}};if(ki===!0)return mi(this,Ai,ki,Pi),this;Ii=this;var Li=Ii._,Ri=ki||{},$i=Li.root,Ni;Ri.at=Li,Ri.ok=Ai;var ji={};return qi.at=Li,(Li.any||(Li.any={}))[Ni=String.random(7)]=qi,qi.off=function(){qi.stun=1,Li.any&&delete Li.any[Ni]},qi.rid=xi,qi.id=Ri.run||++$i.once,Di=$i.pass,($i.pass={})[Ni]=1,Ri.out=Ri.out||{get:{}},Li.on("out",Ri.out),$i.pass=Di,Ii}else{if(typeof Ai=="number")return this.get(""+Ai,ki,Pi);if(typeof(Di=Ci(Ai))=="string")return this.get(Di,ki,Pi);(Di=this.get.next)&&(Ii=Di(this,Ai))}return Ii?(ki&&typeof ki=="function"&&Ii.get(ki,Pi),Ii):((Ii=this.chain())._.err={err:pi.log("Invalid get request!",Ai)},ki&&ki.call(Ii,Ii._.err),Ii)};function gi(Ai,ki){var Pi=ki._,Ii=Pi.next,Di=ki.chain(),Fi=Di._;return Ii||(Ii=Pi.next={}),Ii[Fi.get=Ai]=Fi,ki===Pi.root.$?Fi.soul=Ai:(Pi.soul||Pi.has)&&(Fi.has=Ai),Fi}function mi(Ai,ki,Pi,Ii){var Di=Ai._,Fi=0,Li;return(Li=Di.soul||Di.link)?ki(Li,Ii,Di):Di.jam?Di.jam.push([ki,Ii]):(Di.jam=[[ki,Ii]],Ai.get(function(Ri,$i){if(!(Ei===Ri.put&&!Di.root.opt.super&&(Li=Object.keys(Di.root.opt.peers).length)&&++Fi<=Li)){$i.rid(Ri);var Ni=(Ni=Ri.$)&&Ni._||{},ji=0,Ui;for(Li=Di.jam,delete Di.jam;Ui=Li[ji++];){var qi=Ui[0];Ui=Ui[1],qi&&qi(Ni.link||Ni.soul||pi.valid(Ri.put)||((Ri.put||{})._||{})["#"],Ui,Ri,$i)}}},{out:{get:{".":!0}}}),Ai)}function xi(Ai){var ki=this.at||this.on;if(!Ai||ki.soul||ki.has)return this.off();if(Ai=(Ai=(Ai=Ai.$||Ai)._||Ai).id){ki.map;var Pi;if((Pi=this.seen||(this.seen={}))[Ai])return!0;Pi[Ai]=!0}}var yi={},Ci=pi.valid,Ei})(ci,"./get"),ci(function(_i){var pi=ci("./root");pi.chain.put=function(Ii,Di,Fi){var Li=this,Bi=Li._,Ri=Bi.root;Fi=Fi||{},Fi.root=Bi.root,Fi.run||(Fi.run=Ri.once),gi(Fi,Bi.id),Fi.ack=Fi.ack||Di,Fi.via=Fi.via||Li,Fi.data=Fi.data||Ii,Fi.soul||(Fi.soul=Bi.soul||typeof Di=="string"&&Di);var $i=Fi.state=Fi.state||pi.state();return typeof Ii=="function"?(Ii(function(Ni){Fi.data=Ni,Li.put(Ci,Ci,Fi)}),Li):Fi.soul?(Fi.$=Ri.$.get(Fi.soul),Fi.todo=[{it:Fi.data,ref:Fi.$}],Fi.turn=Fi.turn||Ai,Fi.ran=Fi.ran||mi,function Ni(){var ji=Fi.todo,Ui=ji.pop(),qi=Ui.it;Ui.ref&&Ui.ref._.id;var Ji,rs,ss,zi,Gi;if(gi(Fi,Ui.ref),(zi=Ui.todo)&&(rs=zi.pop(),qi=qi[rs],zi.length&&ji.push(Ui)),rs&&(ji.path||(ji.path=[])).push(rs),!(Ji=ki(qi))&&!(Gi=pi.is(qi))){if(!Object.plain(qi)){mi.err(Fi,"Invalid data: "+yi(qi)+" at "+(Fi.via.back(function(Zi){Zi.get&&zi.push(Zi.get)},zi=[])||zi.join("."))+"."+(ji.path||[]).join("."));return}for(var Vi=Fi.seen||(Fi.seen=[]),Qi=Vi.length;Qi--;)if(qi===(zi=Vi[Qi]).it){Ji=qi=zi.link;break}}if(rs&&Ji)Ui.node=Pi(Ui.node,rs,$i,qi);else{let Zi=function(ts,cs){var ls=ss.link["#"];cs&&(cs.off(),cs.rid(ts));var us=ls||ts.soul||(zi=(ts.$$||ts.$)._||"").soul||zi.link||((zi=zi.put||"")._||"")["#"]||zi["#"]||((zi=ts.put||"")&&ts.$$?zi["#"]:(zi["="]||zi[":"]||"")["#"]);if(!ls&&gi(Fi,ts.$),!us&&!Ui.link["#"]){(Ui.wait||(Ui.wait=[])).push(function(){Zi(ts,cs)});return}us||(us=[],(ts.$$||ts.$).back(function(fs){if(zi=fs.soul||fs.link)return us.push(zi);us.push(fs.get)}),us=us.reverse().join("/")),ss.link["#"]=us,!Gi&&(((Fi.graph||(Fi.graph={}))[us]=ss.node||(ss.node={_:{}}))._["#"]=us),delete Fi.wait[is],ss.wait&&setTimeout.each(ss.wait,function(fs){fs&&fs()}),Fi.ran(Fi)};if(!Fi.seen){mi.err(Fi,"Data at root of graph must be a node (an object).");return}Fi.seen.push(ss={it:qi,link:{},todo:Gi?[]:Object.keys(qi).sort().reverse(),path:(ji.path||[]).slice(),up:Ui}),Ui.node=Pi(Ui.node,rs,$i,ss.link),!Gi&&ss.todo.length&&ji.push(ss);var is=Fi.seen.length;(Fi.wait||(Fi.wait={}))[is]="",zi=(ss.ref=Gi?qi:rs?Ui.ref.get(rs):Ui.ref)._,(zi=qi&&(qi._||"")["#"]||zi.soul||zi.link)?Zi({soul:zi}):ss.ref.get(Zi,{run:Fi.run,v2020:1,out:{get:{".":" "}}})}if(!ji.length)return Fi.ran(Fi);Fi.turn(Ni)}(),Li):(xi(Fi),Li)};function gi(Ii,Di){if(Di){Di=(Di._||"").id||Di;var Fi=Ii.root.stun||(Ii.root.stun={on:pi.on}),Li={},Bi;Ii.stun||(Ii.stun=Fi.on("stun",function(){})),(Bi=Fi.on(""+Di))&&Bi.the.last.next(Li),!(Li.run>=Ii.run)&&Fi.on(""+Di,function(Ri){if(Ii.stun.end){this.off(),this.to.next(Ri);return}Ri.run=Ri.run||Ii.run,Ri.stun=Ri.stun||Ii.stun})}}function mi(Ii){if(Ii.err){mi.end(Ii.stun,Ii.root);return}if(!(Ii.todo.length||Ii.end||!Object.empty(Ii.wait))){Ii.end=1;var Di=Ii.$.back(-1)._,Fi=Di.root,Li=Di.ask(function(Ni){Fi.on("ack",Ni),Ni.err&&!Ni.lack&&pi.log(Ni),++Bi>(Ii.acks||0)&&this.off(),Ii.ack&&Ii.ack(Ni,this)},Ii.opt),Bi=0,Ri=Ii.stun,$i;($i=function(){Ri&&(mi.end(Ri,Fi),setTimeout.each(Object.keys(Ri=Ri.add||""),function(Ni){(Ni=Ri[Ni])&&Ni()}))}).hatch=$i,Ii.ack&&!Ii.ok&&(Ii.ok=Ii.acks||9),Ii.via._.on("out",{put:Ii.out=Ii.graph,ok:Ii.ok&&{"@":Ii.ok+1},opt:Ii.opt,"#":Li,_:$i})}}mi.end=function(Ii,Di){Ii.end=Ei,Ii.the.to===Ii&&Ii===Ii.the.last&&delete Di.stun,Ii.off()},mi.err=function(Ii,Di){(Ii.ack||Ei).call(Ii,Ii.out={err:Ii.err=pi.log(Di)}),Ii.ran(Ii)};function xi(Ii){var Di=Ii.via._,Fi;Ii.via=Ii.via.back(function(Li){if(Li.soul||!Li.get)return Li.$;Fi=Ii.data,(Ii.data={})[Li.get]=Fi}),(!Ii.via||!Ii.via._.soul)&&(Ii.via=Di.root.$.get(((Ii.data||"")._||"")["#"]||Di.$.back("opt.uuid")())),Ii.via.put(Ii.data,Ii.ack,Ii)}function yi(Ii,Di){return Ii&&(Di=Ii.constructor)&&Di.name||typeof Ii}var Ci,Ei=function(){},Ai=setTimeout.turn,ki=pi.valid,Pi=pi.state.ify})(ci,"./put"),ci(function(_i){var pi=ci("./root");ci("./chain"),ci("./back"),ci("./put"),ci("./get"),_i.exports=pi})(ci,"./index"),ci(function(_i){var pi=ci("./index");pi.chain.on=function(xi,yi,Ci,Ei){var Ai=this,ki=Ai._;ki.root;var Pi;if(typeof xi=="string")return yi?(Pi=ki.on(xi,yi,Ci||ki,Ei),Ci&&Ci.$&&(Ci.subs||(Ci.subs=[])).push(Pi),Ai):ki.on(xi);var Ii=yi;return(Ii=Ii===!0?{change:!0}:Ii||{}).not=1,Ii.on=1,Ai.get(xi,Ii),Ai},pi.chain.once=function(xi,yi){if(yi=yi||{},!xi)return gi(this);var Ci=this,Ei=Ci._,Ai=Ei.root;Ei.put;var ki=String.random(7),Pi;return Ci.get(function(Ii,Di,Fi,Li){var Bi=this,Ri=Bi._,$i=Ri.one||(Ri.one={});if(Li.stun||$i[ki]==="")return;if((Pi=pi.valid(Ii))===!0){Ni();return}if(typeof Pi=="string")return;clearTimeout((Ei.one||"")[ki]),clearTimeout($i[ki]),$i[ki]=setTimeout(Ni,yi.wait||99);function Ni(ji){if(!Ri.has&&!Ri.soul&&(Ri={put:Ii,get:Di}),mi===(Pi=Ri.put)&&(Pi=((Fi.$$||"")._||"").put),typeof pi.valid(Pi)=="string"&&(Pi=Ai.$.get(Pi)._.put,Pi===mi&&!ji)){$i[ki]=setTimeout(function(){Ni(1)},yi.wait||99);return}Li.stun||$i[ki]!==""&&($i[ki]="",(Ei.soul||Ei.has)&&Li.off(),xi.call(Bi,Pi,Ri.get),clearTimeout($i[ki]))}},{on:1}),Ci};function gi(xi,yi,Ci){return pi.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(Ci=xi.chain())._.nix=xi.once(function(Ei,Ai){Ci._.on("in",this._)}),Ci._.lex=xi._.lex,Ci}pi.chain.off=function(){var xi=this,yi=xi._,Ci,Ei=yi.back;if(Ei)return yi.ack=0,(Ci=Ei.next)&&Ci[yi.get]&&delete Ci[yi.get],(Ci=Ei.any)&&(delete Ei.any,Ei.any={}),(Ci=Ei.ask)&&delete Ci[yi.get],(Ci=Ei.put)&&delete Ci[yi.get],(Ci=yi.soul)&&delete Ei.root.graph[Ci],(Ci=yi.map)&&Object.keys(Ci).forEach(function(Ai,ki){ki=Ci[Ai],ki.link&&Ei.root.$.get(ki.link).off()}),(Ci=yi.next)&&Object.keys(Ci).forEach(function(Ai,ki){ki=Ci[Ai],ki.$.off()}),yi.on("off",{}),xi};var mi})(ci,"./on"),ci(function(_i){var pi=ci("./index"),gi=pi.chain.get.next;pi.chain.get.next=function(Ci,Ei){var Ai;return Object.plain(Ei)?(Ai=((Ai=Ei["#"])||"")["="]||Ai)?Ci.get(Ai):((Ai=Ci.chain()._).lex=Ei,Ci.on("in",function(ki){String.match(ki.get||(ki.put||"")["."],Ei["."]||Ei["#"]||Ei)&&Ai.on("in",ki),this.to.next(ki)}),Ai.$):(gi||xi)(Ci,Ei)},pi.chain.map=function(Ci,Ei,Ai){var ki=this,Pi=ki._,Ii,Di;return Object.plain(Ci)&&(Ii=Ci["."]?Ci:{".":Ci},Ci=yi),Ci?(pi.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),Di=ki.chain(),ki.map().on(function(Fi,Li,Bi,Ri){var $i=(Ci||xi).call(this,Fi,Li,Bi,Ri);if(yi!==$i){if(Fi===$i)return Di._.on("in",Bi);if(pi.is($i))return Di._.on("in",$i._);var Ni={};Object.keys(Bi.put).forEach(function(ji){Ni[ji]=Bi.put[ji]},Ni),Ni["="]=$i,Di._.on("in",{get:Li,put:Ni})}}),Di):((Di=Pi.each)||((Pi.each=Di=ki.chain())._.lex=Ii||Di._.lex||Pi.lex,Di._.nix=ki.back("nix"),ki.on("in",mi,Di._)),Di)};function mi(Ci){this.to.next(Ci);var Ei=this.as,Ai=Ci.$,ki=Ai._,Pi=Ci.put,Ii;!ki.soul&&!Ci.$$||(Ii=Ei.lex)&&!String.match(Ci.get||(Pi||"")["."],Ii["."]||Ii["#"]||Ii)||pi.on.link(Ci,Ei)}var xi=function(){},yi})(ci,"./map"),ci(function(_i){var pi=ci("./index");pi.chain.set=function(gi,mi,xi){var yi=this,Ci=yi.back(-1),Ei,Ai;return mi=mi||function(){},xi=xi||{},xi.item=xi.item||gi,(Ei=((gi||"")._||"")["#"])&&((gi={})["#"]=Ei),typeof(Ai=pi.valid(gi))=="string"?yi.get(Ei=Ai).put(gi,mi,xi):pi.is(gi)?(yi.put(function(ki){gi.get(function(Pi,Ii,Di){if(!Pi)return mi.call(yi,{err:pi.log('Only a node can be linked! Not "'+Di.put+'"!')});(Ai={})[Pi]={"#":Pi},ki(Ai)},!0)}),gi):(Object.plain(gi)&&(gi=Ci.get(Ei=yi.back("opt.uuid")()).put(gi)),yi.get(Ei||Ci.back("opt.uuid")(7)).put(gi,mi,xi))}})(ci,"./set"),ci(function(_i){ci("./shim");var pi=function(){},gi=JSON.parseAsync||function(Ci,Ei,Ai){var ki,Pi=+new Date;try{Ei(ki,JSON.parse(Ci,Ai),mi.sucks(+new Date-Pi))}catch(Ii){Ei(Ii)}},mi=JSON.stringifyAsync||function(Ci,Ei,Ai,ki){var Pi,Ii=+new Date;try{Ei(Pi,JSON.stringify(Ci,Ai,ki),mi.sucks(+new Date-Ii))}catch(Di){Ei(Di)}};mi.sucks=function(Ci){Ci>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),mi.sucks=pi)};function xi(Ci){var Ei=function(){},Ai=Ci.opt||{};Ai.log=Ai.log||console.log,Ai.gap=Ai.gap||Ai.wait||0,Ai.max=Ai.max||(Ai.memory?Ai.memory*999*999:3e8)*.3,Ai.pack=Ai.pack||Ai.max*.01*.01,Ai.puff=Ai.puff||9;var ki=setTimeout.turn||setTimeout,Pi=Ci.dup,Ii=Pi.check,Di=Pi.track,Fi=Ei.hear=function(Ri,$i){if(Ri){if(Ai.max<=Ri.length)return Ei.say({dam:"!",err:"Message too big!"},$i);Ei===this&&(Fi.d+=Ri.length||0,++Fi.c);var Ni=$i.SH=+new Date,ji=Ri[0],Ui;if(ji==="["){gi(Ri,function(qi,Ji){if(qi||!Ji)return Ei.say({dam:"!",err:"DAM JSON parse error."},$i);console.STAT&&console.STAT(+new Date,Ji.length,"# on hear batch");var rs=Ai.puff;(function ss(){for(var zi=+new Date,Gi=0,Vi;Gi<rs&&(Vi=Ji[Gi++]);)Ei.hear(Vi,$i);Ji=Ji.slice(Gi),console.STAT&&console.STAT(zi,+new Date-zi,"hear loop"),Li($i),Ji.length&&ki(ss,0)})()}),Ri="";return}if(ji==="{"||(Ri["#"]||Object.plain(Ri))&&(Ui=Ri)){if(Ui)return Fi.one(Ui,$i,Ni);gi(Ri,function(qi,Ji){if(qi||!Ji)return Ei.say({dam:"!",err:"DAM JSON parse error."},$i);Fi.one(Ji,$i,Ni)});return}}};Fi.one=function(Ri,$i,ss){var ji,Ui,qi,Ji,rs;if(Ri.DBG&&(Ri.DBG=rs={DBG:Ri.DBG}),rs&&(rs.h=ss),rs&&(rs.hp=+new Date),(ji=Ri["#"])||(ji=Ri["#"]=String.random(9)),!(qi=Ii(ji))&&(Ui=Ri["##"],!(Ui&&(qi=Ri["@"]||Ri.get&&ji)&&Pi.check(Ji=qi+Ui)))){if((Ri._=function(){}).via=Ei.leap=$i,(qi=Ri["><"])&&typeof qi=="string"&&qi.slice(0,99).split(",").forEach(function(zi){this[zi]=1},Ri._.yo={}),qi=Ri.dam){(qi=Ei.hear[qi])&&qi(Ri,$i,Ci),Di(ji);return}(qi=Ri.ok)&&(Ri._.near=qi["/"]);var ss=+new Date;rs&&(rs.is=ss),$i.SI=ji,Di.ed=function(zi){ji===zi&&(Di.ed=0,(zi=Pi.s[ji])&&(zi.via=$i,Ri.get&&(zi.it=Ri)))},Ci.on("in",Ei.last=Ri),rs&&(rs.hd=+new Date),console.STAT&&console.STAT(ss,+new Date-ss,Ri.get?"msg get":Ri.put?"msg put":"msg"),Di(ji),Ji&&Di(Ji),Ei.leap=Ei.last=null}},Fi.c=Fi.d=0,function(){var Ri=0,$i;Ei.hash=function(Ui,qi){var Ji,rs,ss,zi=+new Date;mi(Ui.put,function Gi(Vi,Qi){var is=(rs||(rs=ss=Qi||"")).slice(0,32768);if(Ji=String.hash(is,Ji),rs=rs.slice(32768),rs){ki(Gi,0);return}console.STAT&&console.STAT(zi,+new Date-zi,"say json+hash"),Ui._.$put=ss,Ui["##"]=Ji,Ei.say(Ui,qi),delete Ui._.$put},Ni)};function Ni(Ui,qi){var Ji;return qi instanceof Object?(Object.keys(qi).sort().forEach(ji,{to:Ji={},on:qi}),Ji):qi}function ji(Ui){this.to[Ui]=this.on[Ui]}Ei.say=function(Ui,qi){var Ji;if((Ji=this)&&(Ji=Ji.to)&&Ji.next&&Ji.next(Ui),!Ui)return!1;var rs,ss,zi,Gi=Ui["@"],Vi=Ui._||(Ui._=function(){}),Qi=Ui.DBG,is=+new Date;if(Vi.y=Vi.y||is,qi||Qi&&(Qi.y=is),(rs=Ui["#"])||(rs=Ui["#"]=String.random(9)),!$i&&Di(rs),!(ss=Ui["##"])&&yi!==Ui.put&&!Vi.via&&Gi){Ei.hash(Ui,qi);return}if(!qi&&Gi&&(qi=(Ji=Pi.s[Gi])&&(Ji.via||(Ji=Ji.it)&&(Ji=Ji._)&&Ji.via)||(Ji=Ei.last)&&Gi===Ji["#"]&&Ei.leap),!qi&&Gi)return Pi.s[Gi]?void 0:(console.STAT&&console.STAT(+new Date,++Ri,"total no peer to ack to"),!1);if(Gi&&!Ui.put&&!ss&&((Pi.s[Gi]||"").it||"")["##"])return!1;if(!qi&&Ei.way)return Ei.way(Ui);if(Qi&&(Qi.yh=+new Date),!(zi=Vi.raw)){Ei.raw(Ui,qi);return}if(Qi&&(Qi.yr=+new Date),!qi||!qi.id){if(!Object.plain(qi||Ai.peers))return!1;var is=+new Date;Ai.puff;var Zi=Ai.peers,ts=Object.keys(qi||Ai.peers||{});console.STAT&&console.STAT(is,+new Date-is,"peer keys"),function us(){var fs=+new Date;$i=1;var xs=Vi.raw;Vi.raw=zi;for(var bs=0,Cs;bs<9&&(Cs=(ts||"")[bs++]);)(Cs=Zi[Cs]||(qi||"")[Cs])&&Ei.say(Ui,Cs);Vi.raw=xs,$i=0,ts=ts.slice(bs),console.STAT&&console.STAT(fs,+new Date-fs,"say loop"),ts.length&&(ki(us,0),Gi&&Di(Gi))}();return}if(!qi.wire&&Ei.wire&&Ei.wire(qi),rs!==qi.last){if(qi.last=rs,qi===Vi.via||(Ji=Vi.yo)&&(Ji[qi.url]||Ji[qi.pid]||Ji[qi.id]))return!1;if(console.STAT&&console.STAT(is,((Qi||Vi).yp=+new Date)-(Vi.y||is),"say prep"),!$i&&Gi&&Di(Gi),qi.batch){if(qi.tail=(Ji=qi.tail||0)+zi.length,qi.tail<=Ai.pack){qi.batch+=(Ji?",":"")+zi;return}Li(qi)}qi.batch="[";var cs=+new Date;setTimeout(function(){console.STAT&&console.STAT(cs,+new Date-cs,"0ms TO"),Li(qi)},Ai.gap),Bi(zi,qi),console.STAT&&Gi===qi.SI&&console.STAT(is,+new Date-qi.SH,"say ack")}},Ei.say.c=Ei.say.d=0,Ei.raw=function(Ui,qi){if(!Ui)return"";var Ji=Ui._||{},rs,ss;if(ss=Ji.raw)return ss;if(typeof Ui=="string")return Ui;var zi=Ui["##"],Gi=Ui["@"];if(zi&&Gi){if(!Ji.via&&Ii(Gi+zi))return!1;if(ss=(Pi.s[Gi]||"").it){if(zi===ss["##"])return!1;ss["##"]||(ss["##"]=zi)}}if(!Ui.dam&&!Ui["@"]){var Vi=0,Qi=[];ss=Ai.peers;for(var is in ss){var Zi=ss[is];if(Qi.push(Zi.url||Zi.pid||Zi.id),++Vi>6)break}Vi>1&&(Ui["><"]=Qi.join())}if(Ui.put&&(ss=Ui.ok)&&(Ui.ok={"@":(ss["@"]||1)-1,"/":ss["/"]==Ui._.near?Ei.near:ss["/"]}),rs=Ji.$put){ss={},Object.keys(Ui).forEach(function(cs){ss[cs]=Ui[cs]}),ss.put=":])([:",mi(ss,function(cs,ls){if(!cs){var us=+new Date;ss=ls.indexOf('"put":":])([:"'),ts(yi,ls=ls.slice(0,ss+6)+rs+ls.slice(ss+14)),console.STAT&&console.STAT(us,+new Date-us,"say slice")}});return}mi(Ui,ts);function ts(cs,ls){cs||(Ji.raw=ls,Ei.say(Ui,qi))}}}();function Li(Ri){var $i=Ri.batch,Ni=typeof $i=="string";if(Ni&&($i+="]"),Ri.batch=Ri.tail=null,!!$i&&!(Ni?3>$i.length:!$i.length)){if(!Ni)try{$i=$i.length===1?$i[0]:JSON.stringify($i)}catch(ji){return Ai.log("DAM JSON stringify error",ji)}$i&&Bi($i,Ri)}}function Bi(Ri,$i){try{var Ni=$i.wire;$i.say?$i.say(Ri):Ni.send&&Ni.send(Ri),Ei.say.d+=Ri.length||0,++Ei.say.c}catch{($i.queue=$i.queue||[]).push(Ri)}}return Ei.near=0,Ei.hi=function(Ri){var $i=Ri.wire,Ni;if(!$i){Ei.wire(Ri.length&&{url:Ri,id:Ri}||Ri);return}Ri.id?Ai.peers[Ri.url||Ri.id]=Ri:(Ni=Ri.id=Ri.id||Ri.url||String.random(9),Ei.say({dam:"?",pid:Ci.opt.pid},Ai.peers[Ni]=Ri),delete Pi.s[Ri.last]),Ri.met||(Ei.near++,Ri.met=+new Date,Ci.on("hi",Ri)),Ni=Ri.queue,Ri.queue=[],setTimeout.each(Ni||[],function(ji){Bi(ji,Ri)},0,9)},Ei.bye=function(Ri){Ri.met&&--Ei.near,delete Ri.met,Ci.on("bye",Ri);var $i=+new Date;$i=$i-(Ri.met||$i),Ei.bye.time=((Ei.bye.time||$i)+$i)/2},Ei.hear["!"]=function(Ri,$i){Ai.log("Error:",Ri.err)},Ei.hear["?"]=function(Ri,$i){Ri.pid&&($i.pid||($i.pid=Ri.pid),Ri["@"])||(Ei.say({dam:"?",pid:Ai.pid,"@":Ri["#"]},$i),delete Pi.s[$i.last])},Ei.hear.mob=function(Ri,$i){if(Ri.peers){var Ni=Object.keys(Ri.peers),ji=Ni[Math.random()*Ni.length>>0];ji&&(Ei.bye($i),Ei.hi(ji))}},Ci.on("create",function(Ri){Ri.opt.pid=Ri.opt.pid||String.random(9),this.to.next(Ri),Ri.on("out",Ei.say)}),Ci.on("bye",function(Ri,$i){Ri=Ai.peers[Ri.id||Ri]||Ri,this.to.next(Ri),Ri.bye?Ri.bye():($i=Ri.wire)&&$i.close&&$i.close(),delete Ai.peers[Ri.id],Ri.wire=null}),Ci.on("bye",function(Ri,$i){this.to.next(Ri),($i=console.STAT)&&($i.peers=Ei.near),($i=Ri.url)&&setTimeout(function(){},Ai.lack||9e3)}),Ci.on("hi",function(Ri,$i){if(this.to.next(Ri),($i=console.STAT)&&($i.peers=Ei.near),!Ai.super){var Ni=Object.keys(Ci.next||"");Ni.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(Ni,function(ji){var Ui=Ci.next[ji];if(Ai.super||(Ui.ask||"")[""]){Ei.say({get:{"#":ji}},Ri);return}setTimeout.each(Object.keys(Ui.ask||""),function(qi){qi&&Ei.say({"##":String.hash((Ci.graph[ji]||"")[qi]),get:{"#":ji,".":qi}},Ri)})})}}),Ei}var yi;try{_i.exports=xi}catch{}})(ci,"./mesh"),ci(function(_i){var pi=ci("./index");pi.Mesh=ci("./mesh"),pi.on("opt",function(mi){if(this.to.next(mi),mi.once)return;var xi=mi.opt;if(xi.WebSocket===!1)return;var yi=pi.window||{},Ci=xi.WebSocket||yi.WebSocket||yi.webkitWebSocket||yi.mozWebSocket;if(!Ci)return;xi.WebSocket=Ci;var Ei=xi.mesh=xi.mesh||pi.Mesh(mi);Ei.wire||xi.wire,Ei.wire=xi.wire=Ai;function Ai(Di){try{if(!Di||!Di.url)return Li&&Li(Di);var Fi=Di.url.replace(/^http/,"ws"),Li=Di.wire=new xi.WebSocket(Fi);return Li.onclose=function(){Pi(Di),xi.mesh.bye(Di)},Li.onerror=function(Bi){Pi(Di)},Li.onopen=function(){xi.mesh.hi(Di)},Li.onmessage=function(Bi){Bi&&xi.mesh.hear(Bi.data||Bi,Di)},Li}catch{xi.mesh.bye(Di)}}setTimeout(function(){!xi.super&&mi.on("out",{dam:"hi"})},1);var ki=2*999;function Pi(Di){clearTimeout(Di.defer),xi.peers[Di.url]&&(Ii&&Di.retry<=0||(Di.retry=(Di.retry||xi.retry+1||60)-(-Di.tried+(Di.tried=+new Date)<ki*4?1:0),Di.defer=setTimeout(function Fi(){if(Ii&&Ii.hidden)return setTimeout(Fi,ki);Ai(Di)},ki)))}var Ii=""+gi!=typeof document&&document});var gi})(ci,"./websocket"),ci(function(_i){if(!(typeof Gun>"u")){var pi=function(){},gi;try{gi=(Gun.window||pi).localStorage}catch{}gi||(Gun.log("Warning: No localStorage exists to persist data to!"),gi={setItem:function(xi,yi){this[xi]=yi},removeItem:function(xi){delete this[xi]},getItem:function(xi){return this[xi]}});var mi=JSON.stringifyAsync||function(xi,yi,Ci,Ei){var Ai;try{yi(Ai,JSON.stringify(xi,Ci,Ei))}catch(ki){yi(ki)}};Gun.on("create",function xi(yi){this.to.next(yi);var Ci=yi.opt;yi.graph;var Ei=[],Ai,ki,Pi,Ii;if(Ci.localStorage===!1)return;Ci.prefix=Ci.file||"gun/";try{Ai=xi[Ci.prefix]=xi[Ci.prefix]||JSON.parse(Pi=gi.getItem(Ci.prefix))||{}}catch{Ai=xi[Ci.prefix]={}}Pi=(Pi||"").length,yi.on("get",function(Fi){this.to.next(Fi);var Li=Fi.get,Bi,Ri,$i,Ni;!Li||!(Bi=Li["#"])||(Ri=Ai[Bi]||Ni,Ri&&($i=Li["."])&&!Object.plain($i)&&(Ri=Gun.state.ify({},$i,Gun.state.is(Ri,$i),Ri[$i],Bi)),Gun.on.get.ack(Fi,Ri))}),yi.on("put",function(Fi){this.to.next(Fi);var Li=Fi.put,Bi=Li["#"],Ri=Li["."],$i=Fi["#"],Ni=Fi.ok||"";if(Ai[Bi]=Gun.state.ify(Ai[Bi],Ri,Li[">"],Li[":"],Bi),Ii&&Pi>4999880){yi.on("in",{"@":$i,err:"localStorage max!"});return}!Fi["@"]&&(!Fi._.via||Math.random()<Ni["@"]/Ni["/"])&&Ei.push($i),!ki&&(ki=setTimeout(Di,9+Pi/333))});function Di(){if(!Ei.length&&((setTimeout.turn||"").s||"").length){setTimeout(Di,99);return}var Fi=Ei;clearTimeout(ki),ki=!1,Ei=[],mi(Ai,function(Li,Bi){try{!Li&&gi.setItem(Ci.prefix,Bi)}catch(Ri){Li=Ii=Ri||"localStorage failure"}Li&&(Gun.log(Li+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),yi.on("localStorage:error",{err:Li,get:Ci.prefix,put:Ai})),Pi=Bi.length,setTimeout.each(Fi,function(Ri){yi.on("in",{"@":Ri,err:Li,ok:0})},0,99)})}})}})(ci,"./localStorage")})(),function(){var ss;if(""+ss!=typeof Gun){var ci=function(zi){console.warn("Warning! Deprecated internal utility will break in next version:",zi)},hi=Gun;hi.fn=hi.fn||{is:function(zi){return ci("fn"),!!zi&&typeof zi=="function"}},hi.bi=hi.bi||{is:function(zi){return ci("bi"),zi instanceof Boolean||typeof zi=="boolean"}},hi.num=hi.num||{is:function(zi){return ci("num"),!_i(zi)&&(zi-parseFloat(zi)+1>=0||zi===1/0||zi===-1/0)}},hi.text=hi.text||{is:function(zi){return ci("text"),typeof zi=="string"}},hi.text.ify=hi.text.ify||function(zi){return ci("text.ify"),hi.text.is(zi)?zi:typeof JSON<"u"?JSON.stringify(zi):zi&&zi.toString?zi.toString():zi},hi.text.random=hi.text.random||function(zi,Gi){ci("text.random");var Vi="";for(zi=zi||24,Gi=Gi||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";zi>0;)Vi+=Gi.charAt(Math.floor(Math.random()*Gi.length)),zi--;return Vi},hi.text.match=hi.text.match||function(zi,Gi){var Vi,Qi;return ci("text.match"),typeof zi!="string"?!1:(typeof Gi=="string"&&(Gi={"=":Gi}),Gi=Gi||{},Vi=Gi["="]||Gi["*"]||Gi[">"]||Gi["<"],zi===Vi?!0:Qi!==Gi["="]?!1:(Vi=Gi["*"]||Gi[">"]||Gi["<"],zi.slice(0,(Vi||"").length)===Vi?!0:Qi!==Gi["*"]?!1:Qi!==Gi[">"]&&Qi!==Gi["<"]?zi>=Gi[">"]&&zi<=Gi["<"]:Qi!==Gi[">"]&&zi>=Gi[">"]||Qi!==Gi["<"]&&zi<=Gi["<"]))},hi.text.hash=hi.text.hash||function(zi,Gi){if(ci("text.hash"),typeof zi=="string"){if(Gi=Gi||0,!zi.length)return Gi;for(var Vi=0,Qi=zi.length,is;Vi<Qi;++Vi)is=zi.charCodeAt(Vi),Gi=(Gi<<5)-Gi+is,Gi|=0;return Gi}},hi.list=hi.list||{is:function(zi){return ci("list"),zi instanceof Array}},hi.list.slit=hi.list.slit||Array.prototype.slice,hi.list.sort=hi.list.sort||function(zi){return ci("list.sort"),function(Gi,Vi){return!Gi||!Vi?0:(Gi=Gi[zi],Vi=Vi[zi],Gi<Vi?-1:Gi>Vi?1:0)}},hi.list.map=hi.list.map||function(zi,Gi,Vi){return ci("list.map"),Ji(zi,Gi,Vi)},hi.list.index=1,hi.obj=hi.boj||{is:function(zi){return ci("obj"),zi?zi instanceof Object&&zi.constructor===Object||Object.prototype.toString.call(zi).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},hi.obj.put=hi.obj.put||function(zi,Gi,Vi){return ci("obj.put"),(zi||{})[Gi]=Vi,zi},hi.obj.has=hi.obj.has||function(zi,Gi){return ci("obj.has"),zi&&Object.prototype.hasOwnProperty.call(zi,Gi)},hi.obj.del=hi.obj.del||function(zi,Gi){if(ci("obj.del"),!!zi)return zi[Gi]=null,delete zi[Gi],zi},hi.obj.as=hi.obj.as||function(zi,Gi,Vi,Qi){return ci("obj.as"),zi[Gi]=zi[Gi]||(Qi===Vi?{}:Vi)},hi.obj.ify=hi.obj.ify||function(zi){if(ci("obj.ify"),$i(zi))return zi;try{zi=JSON.parse(zi)}catch{zi={}}return zi},function(){var zi;function Gi(Vi,Qi){ji(this,Qi)&&zi!==this[Qi]||(this[Qi]=Vi)}hi.obj.to=hi.obj.to||function(Vi,Qi){return ci("obj.to"),Qi=Qi||{},Ji(Vi,Gi,Qi),Qi}}(),hi.obj.copy=hi.obj.copy||function(zi){return ci("obj.copy"),zi&&JSON.parse(JSON.stringify(zi))},function(){function zi(Gi,Vi){var Qi=this.n,is;if(!(Qi&&(Vi===Qi||$i(Qi)&&ji(Qi,Vi)))&&is!==Vi)return!0}hi.obj.empty=hi.obj.empty||function(Gi,Vi){return ci("obj.empty"),Gi?!Ji(Gi,zi,{n:Vi}):!0}}(),function(){function zi(Qi,is){if(arguments.length===2){zi.r=zi.r||{},zi.r[Qi]=is;return}zi.r=zi.r||[],zi.r.push(Qi)}var Gi=Object.keys,Vi;Object.keys=Object.keys||function(Qi){return Vi(Qi,function(is,Zi,ts){ts(Zi)})},hi.obj.map=Vi=hi.obj.map||function(Qi,is,Zi){ci("obj.map");var ts,cs=0,ls,us,fs,xs,bs=typeof is=="function";if(zi.r=ts,Gi&&$i(Qi)&&(fs=Gi(Qi),xs=!0),Zi=Zi||{},_i(Qi)||fs)for(ls=(fs||Qi).length;cs<ls;cs++){var Cs=cs+hi.list.index;if(bs){if(us=xs?is.call(Zi,Qi[fs[cs]],fs[cs],zi):is.call(Zi,Qi[cs],Cs,zi),us!==ts)return us}else if(is===Qi[xs?fs[cs]:cs])return fs?fs[cs]:Cs}else for(cs in Qi)if(bs){if(ji(Qi,cs)&&(us=Zi?is.call(Zi,Qi[cs],cs,zi):is(Qi[cs],cs,zi),us!==ts))return us}else if(is===Qi[cs])return cs;return bs?zi.r:hi.list.index?0:-1}}(),hi.time=hi.time||{},hi.time.is=hi.time.is||function(zi){return ci("time"),zi?zi instanceof Date:+new Date().getTime()};var Bi=hi.fn.is,_i=hi.list.is,Ri=hi.obj,$i=Ri.is,ji=Ri.has,Ji=Ri.map,pi={};pi.is=function(zi){return ci("val.is"),zi===ss?!1:zi===null?!0:zi===1/0?!1:xi(zi)||mi(zi)||Ii(zi)?!0:pi.link.is(zi)||!1},pi.link=pi.rel={_:"#"},function(){pi.link.is=function(Gi){if(ci("val.link.is"),Gi&&Gi[gi]&&!Gi._&&$i(Gi)){var Vi={};if(Ji(Gi,zi,Vi),Vi.id)return Vi.id}return!1};function zi(Gi,Vi){var Qi=this;if(Qi.id)return Qi.id=!1;if(Vi==gi&&xi(Gi))Qi.id=Gi;else return Qi.id=!1}}(),pi.link.ify=function(zi){return ci("val.link.ify"),qi({},gi,zi)},hi.obj.has._=".";var gi=pi.link._,ss,mi=hi.bi.is,Ii=hi.num.is,xi=hi.text.is,Ri=hi.obj,$i=Ri.is,qi=Ri.put,Ji=Ri.map;hi.val=hi.val||pi;var yi={_:"_"};yi.soul=function(zi,Gi){return ci("node.soul"),zi&&zi._&&zi._[Gi||Ai]},yi.soul.ify=function(zi,Gi){return ci("node.soul.ify"),Gi=typeof Gi=="string"?{soul:Gi}:Gi||{},zi=zi||{},zi._=zi._||{},zi._[Ai]=Gi.soul||zi._[Ai]||Ei(),zi},yi.soul._=pi.link._,function(){yi.is=function(Gi,Vi,Qi){ci("node.is");var is;return $i(Gi)&&(is=yi.soul(Gi))?!Ji(Gi,zi,{as:Qi,cb:Vi,s:is,n:Gi}):!1};function zi(Gi,Vi){if(Vi!==yi._){if(!pi.is(Gi))return!0;this.cb&&this.cb.call(this.as,Gi,Vi,this.n,this.s)}}}(),function(){yi.ify=function(Gi,Vi,Qi){return ci("node.ify"),Vi?typeof Vi=="string"?Vi={soul:Vi}:typeof Vi=="function"&&(Vi={map:Vi}):Vi={},Vi.map&&(Vi.node=Vi.map.call(Qi,Gi,ss,Vi.node||{})),(Vi.node=yi.soul.ify(Vi.node||{},Vi))&&Ji(Gi,zi,{o:Vi,as:Qi}),Vi.node};function zi(Gi,Vi){var Qi=this.o,is,Zi;if(Qi.map){is=Qi.map.call(this.as,Gi,""+Vi,Qi.node),Zi===is?Ni(Qi.node,Vi):Qi.node&&(Qi.node[Vi]=is);return}pi.is(Gi)&&(Qi.node[Vi]=Gi)}}();var Ri=hi.obj,$i=Ri.is,Ni=Ri.del,Ji=Ri.map,Ci=hi.text,Ei=Ci.random,Ai=yi.soul._,ss;hi.node=hi.node||yi;var ki=hi.state;ki.lex=function(){return ci("state.lex"),ki().toString(36).replace(".","")},ki.to=function(zi,Gi,Vi){ci("state.to");var Qi=(zi||{})[Gi];return $i(Qi)&&(Qi=rs(Qi)),ki.ify(Vi,Gi,ki.is(zi,Gi),Qi,yi.soul(zi))},function(){ki.map=function(Gi,Vi,Qi){ci("state.map");var is,Zi=$i(Zi=Gi||Vi)?Zi:null;return Gi=Bi(Gi=Gi||Vi)?Gi:null,Zi&&!Gi?(Vi=Ii(Vi)?Vi:ki(),Zi[Fi]=Zi[Fi]||{},Ji(Zi,zi,{o:Zi,s:Vi}),Zi):(Qi=Qi||$i(Vi)?Vi:is,Vi=Ii(Vi)?Vi:ki(),function(ts,cs,ls,us){if(!Gi)return zi.call({o:ls,s:Vi},ts,cs),ts;Gi.call(Qi||this||{},ts,cs,ls,us),!(ji(ls,cs)&&is===ls[cs])&&zi.call({o:ls,s:Vi},ts,cs)})};function zi(Gi,Vi){Fi!==Vi&&ki.ify(this.o,Vi,this.s)}}();var Ri=hi.obj;Ri.as;var ji=Ri.has,$i=Ri.is,Ji=Ri.map,rs=Ri.copy,Pi=hi.num,Ii=Pi.is,Di=hi.fn,Bi=Di.is,Fi=yi._,ss,Li={};(function(){Li.is=function(Vi,Qi,is,Zi){return ci("graph.is"),!Vi||!$i(Vi)||Ui(Vi)?!1:!Ji(Vi,zi,{cb:Qi,fn:is,as:Zi})};function zi(Vi,Qi){if(!Vi||Qi!==yi.soul(Vi)||!yi.is(Vi,this.fn,this.as))return!0;this.cb&&(Gi.n=Vi,Gi.as=this.as,this.cb.call(Gi.as,Vi,Qi,Gi))}function Gi(Vi){Vi&&yi.is(Gi.n,Vi,Gi.as)}})(),function(){Li.ify=function(Zi,ts,cs){ci("graph.ify");var ls={path:[],obj:Zi};return ts?typeof ts=="string"?ts={soul:ts}:typeof ts=="function"&&(ts.map=ts):ts={},typeof cs=="string"&&(ts.soul=ts.soul||cs,cs=ss),ts.soul&&(ls.link=pi.link.ify(ts.soul)),ts.shell=(cs||{}).shell,ts.graph=ts.graph||{},ts.seen=ts.seen||[],ts.as=ts.as||cs,zi(ts,ls),ts.root=ls.node,ts.graph};function zi(Zi,ts){var cs;return(cs=is(Zi,ts))?cs:(ts.env=Zi,ts.soul=Vi,yi.ify(ts.obj,Gi,ts)&&(ts.link=ts.link||pi.link.ify(yi.soul(ts.node)),ts.obj!==Zi.shell&&(Zi.graph[pi.link.is(ts.link)]=ts.node)),ts)}function Gi(Zi,ts,cs){var ls=this,us=ls.env,fs,xs;if(yi._===ts&&ji(Zi,pi.link._))return cs._;if(fs=Qi(Zi,ts,cs,ls,us)){if(ts||(ls.node=ls.node||cs||{},ji(Zi,yi._)&&yi.soul(Zi)&&(ls.node._=rs(Zi._)),ls.node=yi.soul.ify(ls.node,pi.link.is(ls.link)),ls.link=ls.link||pi.link.ify(yi.soul(ls.node))),(xs=us.map)&&(xs.call(us.as||{},Zi,ts,cs,ls),ji(cs,ts))){if(Zi=cs[ts],ss===Zi){Ni(cs,ts);return}if(!(fs=Qi(Zi,ts,cs,ls,us)))return}if(!ts)return ls.node;if(fs===!0)return Zi;if(xs=zi(us,{obj:Zi,path:ls.path.concat(ts)}),!!xs.node)return xs.link}}function Vi(Zi){var ts=this,cs=pi.link.is(ts.link),ls=ts.env.graph;ts.link=ts.link||pi.link.ify(Zi),ts.link[pi.link._]=Zi,ts.node&&ts.node[yi._]&&(ts.node[yi._][pi.link._]=Zi),ji(ls,cs)&&(ls[Zi]=ls[cs],Ni(ls,cs))}function Qi(Zi,ts,cs,ls,us){var fs;if(pi.is(Zi))return!0;if($i(Zi))return 1;if(fs=us.invalid)return Zi=fs.call(us.as||{},Zi,ts,cs),Qi(Zi,ts,cs,ls,us);us.err="Invalid value at '"+ls.path.concat(ts).join(".")+"'!",hi.list.is(Zi)&&(us.err+=" Use `.set(item)` instead of an Array.")}function is(Zi,ts){for(var cs=Zi.seen,ls=cs.length,us;ls--;)if(us=cs[ls],ts.obj===us.obj)return us;cs.push(ts)}}(),Li.node=function(zi){ci("graph.node");var Gi=yi.soul(zi);if(Gi)return qi({},Gi,zi)},function(){Li.to=function(Gi,Vi,Qi){if(ci("graph.to"),!!Gi){var is={};return Qi=Qi||{seen:{}},Ji(Gi[Vi],zi,{obj:is,graph:Gi,opt:Qi}),is}};function zi(Gi,Vi){var Qi,is;if(yi._===Vi){if(Ui(Gi,pi.link._))return;this.obj[Vi]=rs(Gi);return}if(!(Qi=pi.link.is(Gi))){this.obj[Vi]=Gi;return}if(is=this.opt.seen[Qi]){this.obj[Vi]=is;return}this.obj[Vi]=this.opt.seen[Qi]=Li.to(this.graph,Qi,this.opt)}}();var Bi=hi.fn.is,Ri=hi.obj,$i=Ri.is,Ni=Ri.del,ji=Ri.has,Ui=Ri.empty,qi=Ri.put,Ji=Ri.map,rs=Ri.copy,ss;hi.graph=hi.graph||Li}}()})(gun$1);var gunExports=gun$1.exports,browser=gunExports;const Gun$1=getDefaultExportFromCjs(browser),gunConfig={peers:["http://roke.educa.juegos/gun"]},gun=Gun$1(gunConfig);function AstralPlane(){return gun.get("astralPlane").once(fi=>{console.log(fi.face)}),u$2(k$3,{})}D$3(u$2(k$3,{children:[u$2(CrtVisual,{}),u$2(CrtTerminal,{}),u$2(AstralPlane,{})]}),document.getElementById("app"));const game=new __webpack_exports__Engine({width:640,height:480,displayMode:__webpack_exports__DisplayMode.Fixed,canvasElementId:"game_canvas",backgroundColor:__webpack_exports__Color.Black,pixelArt:!0,physics:{solver:__webpack_exports__SolverStrategy.Realistic}}),loader=new __webpack_exports__Loader([dsml1,...resources,...Object.values(sounds)]);loader.backgroundColor="#020610";loader.logo=logo;loader.logoHeight=322;loader.logoWidth=512;loader.events.on("loadresourcestart",()=>{loader.logoPosition=__webpack_exports__vec(game.screen.width/2-256,0),loader.loadingBarPosition=__webpack_exports__vec(game.screen.width/2-250,game.screen.height-40)});loader.events.on("useraction",()=>{__webpack_exports__WebAudio.unlock(),addPermission()});loader.loadingBarHeight=10;loader.loadingBarColor=__webpack_exports__Color.Yellow;loader.playButtonText="Enter";window.loader=loader;document.body.addEventListener("click",function fi(){this.removeEventListener("click",fi),addPermission()});document.getElementById("game").onclick=fi=>{fi.target.focus()};game.start(loader).then(()=>{game.currentScene.physics.config.gravity=__webpack_exports__vec(0,200);let fi=new Player(492,60);dsml1.addToScene(game.currentScene);let ci=addPortal(492,50);ci.rotation=-Math.PI/2,game.add(ci),game.add(fi),sounds.enter.play(.5),window.player=fi,game.currentScene.camera.strategy.elasticToActor(fi,.3,.8),game.currentScene.camera.pos=fi.pos,game.currentScene.camera.zoom=4;let hi=new __webpack_exports__BoundingBox(0,0,dsml1.data.levels[0].pxWid,dsml1.data.levels[0].pxHei);game.currentScene.camera.strategy.limitCameraBounds(hi),game.currentScene.camera.zoomOverTime(2,2e3),game.canvas.focus()});window.dsml1=dsml1;window.game=game;window.ex=ex;export{WebPlugin as W};
//# sourceMappingURL=index-DDZKzwbP.js.map
